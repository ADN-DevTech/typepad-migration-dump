---
layout: "post"
title: "Revit Webcam 2012"
date: "2012-02-08 05:00:00"
author: "Jeremy Tammik"
categories:
  - "2012"
  - "AVF"
  - "Events"
  - "External"
  - "Idling"
  - "Migration"
original_url: "https://thebuildingcoder.typepad.com/blog/2012/02/revit-webcam-2012.html "
typepad_basename: "revit-webcam-2012"
typepad_status: "Publish"
---

<p>I recently discussed the 

<a href="http://thebuildingcoder.typepad.com/blog/2012/01/eliminating-compiler-warnings-and-deprecated-calls.html">
elimination of warnings</a> about

use of deprecated API methods from The Building Coder samples.

In a similar vein, and for similar reasons, I also decided to migrate to Revit 2012 and clean up the 

<a href="http://thebuildingcoder.typepad.com/blog/2010/06/display-webcam-image-on-building-element-face.html">
RevitWebcam</a> sample

that I implemented to demonstrate the use of the 

<a href="http://thebuildingcoder.typepad.com/blog/idling">
Idling event</a> when 

it was first introduced in the Revit 2011 API.

<p>Please note that this sample is intentionally not related to any BIM specific workflow.
A webcam just provides an obvious and accessible sample of a continuously updated and changing graphical dataset driven by something outside of Revit.
I use this to demonstrate that we can sample this data and create a graphical display of it within the Revit model with no user interaction whatsoever.
Other add-ins such as the MultithreadedCalculation Revit SDK sample simulate an externally changing data source.
A real-world example might be displaying the graphical analysis visualisation of an asynchronous cloud-based calculation.

<p>I migrated the 2011 version to 2012 in several steps:

<ol>
<li><a href="#1">Flat migration</a> and <a href="#2">adaption of Idling event handler</a>
<li>Removal of <a href="#3">obsolete API warnings</a>
<li>Final <a href="#4">clean-up</a>
</ol>


<a name="1"></a>

<h4>Flat migration</h4>

<p>I could have simply copied the existing project and source code files and modified them one by one as required for the 2012 API.

<p>Instead, I used a different approach that I find more efficient, since it requires less manual steps:
I created a completely new project using the Visual Studio 

<a href="http://thebuildingcoder.typepad.com/blog/2011/10/product-and-add-in-wizard-updates.html">
Revit add-in wizard</a> and

then copied the relevant bits of source code that I wished to preserve from the original project to the new one.

<p>Since the add-in wizard creates all the required settings, including generating and installing the add-in manifest, all in one single click, this approach requires less manual intervention.
As an additional bonus, it also guarantees that all the application settings are up-to-date and nothing is forgotten.

<!-- It is also more complete and radical, which is probably a good thing. -->

<p>Here is 


<span class="asset  asset-generic at-xid-6a00e553e168978833016300eea556970d"><a href="http://thebuildingcoder.typepad.com/files/revitwebcam2012_1_initial_migration.zip">RevitWebcam2012_1_initial_migration.zip</a></span> containing

the result of the flat migration, which compiles all right but exhibits one little problem when executed:


<a name="2"></a>

<h4>Adaption of the Idling Event Handler</h4>

<p>The flat migration enables the add-in to be compiled successfully.
On running it, though, an exception is immediately thrown on the first call to the Idling event handler, since the type of the 'sender' argument changed from Application in the Revit 2011 API to UIApplication in the Revit 2012 API.

<!--
639_modeless_loose_connectors.htm
652_modeless_loose_connectors.htm
-->

<p>I presented a fully transparent method to support both of these versions simultaneously in the

<a href="http://thebuildingcoder.typepad.com/blog/2011/08/modeless-loose-connector-navigator-update.html#2">
modeless loose connector navigator update</a> plus its

<a href="http://thebuildingcoder.typepad.com/blog/2011/09/yet-another-modeless-update.html">
subsequent enhancement</a>.

<p>The code is still making use of some obsolete API calls, though, so I continued the migration to remove those as well:


<a name="3"></a>

<h4>Removal of Obsolete API Warnings</h4>

<p>Compiling the flat migrated code described above results in the following warnings (copy and paste to an editor to see the untruncated lines):

<pre>
------ Rebuild All started: Project: RevitWebcam, Configuration: Debug Any CPU ------
C:\a\src\revit\webcam\RevitWebcam\RevitWebcam\RevitWebcam\Command.cs(232,11): warning CS0618: 'Autodesk.Revit.DB.Analysis.AnalysisDisplayLegendSettings.SetTextTypeId(Autodesk.Revit.DB.ElementId, Autodesk.Revit.DB.Document)' is obsolete: 'this method will be obsolete from 2012.'
C:\a\src\revit\webcam\RevitWebcam\RevitWebcam\RevitWebcam\Command.cs(398,11): warning CS0618: 'Autodesk.Revit.DB.Analysis.SpatialFieldManager.UpdateSpatialFieldPrimitive(int, Autodesk.Revit.DB.Analysis.FieldDomainPoints, Autodesk.Revit.DB.Analysis.FieldValues)' is obsolete: 'This method is obsolete in Revit 2012; use the overload accepting the result index instead.'
C:\a\src\revit\webcam\RevitWebcam\RevitWebcam\RevitWebcam\Command.cs(386,23): warning CS0618: 'Autodesk.Revit.DB.Reference.GeometryObject' is obsolete: 'Property will be removed. Use Element.GetGeometryObjectFromReference(Reference) instead'
C:\a\src\revit\webcam\RevitWebcam\RevitWebcam\RevitWebcam\Command.cs(431,31): warning CS0618: 'Autodesk.Revit.DB.Reference.Element' is obsolete: 'Property will be removed. Use Document.GetElement(Reference) instead'
C:\a\src\revit\webcam\RevitWebcam\RevitWebcam\RevitWebcam\Command.cs(434,31): warning CS0618: 'Autodesk.Revit.DB.Reference.GeometryObject' is obsolete: 'Property will be removed. Use Element.GetGeometryObjectFromReference(Reference) instead'

Compile complete -- 0 errors, 5 warnings
</pre>

<p>To analyse the exact changes made to fix these, unpack the initial migration and the final version below in two directories side-by-side and use a file comparison tool.


<a name="4"></a>

<h4>Final Clean-up</h4>

<p>Final clean-up included changes to comments and line breaks.

<p>Here is 

<span class="asset  asset-generic at-xid-6a00e553e168978833016300ee9cc8970d"><a href="http://thebuildingcoder.typepad.com/files/revitwebcam2012_3_final_cleanup.zip">RevitWebcam2012_3_final_cleanup.zip</a></span> containing

the cleaned up code with all obsolete API usage removed.

<p>Here is a snapshot of RevitWebcam up and running in Revit 2012:</p>

<center>

<a style="display: inline;" href="http://thebuildingcoder.typepad.com/.a/6a00e553e168978833016300ee9657970d-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false"><img class="asset  asset-image at-xid-6a00e553e168978833016300ee9657970d image-full" alt="RevitWebcam in Revit 2012" title="RevitWebcam in Revit 2012" src="/assets/image_01557b.jpg" border="0" /></a><br />

</center>

<p>The image is upside-down now, which does not worry me, since this is all about getting it to display and update automatically at regular intervals, and all else is of no concern to us.


<p><strong>Disclaimer:</strong> This application does not adhere to the 

<a href="http://thebuildingcoder.typepad.com/blog/2011/09/yet-another-modeless-update.html">
recommended rules</a> for 

interacting with an external asynchronous process, e.g. a modeless dialogue, so this code should not be used as is for production use.

<p>The code presented here is just a test showing some aspects of possible uses of the Revit API functionality. 
It is by no means a production-level solution. 
This actually applies to all the code provided in this blog anyway.
In truth, it applies just as well to many a commercial application that I find myself forced to use, much to my chagrin  :-)
