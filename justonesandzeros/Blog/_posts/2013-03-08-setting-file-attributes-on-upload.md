---
layout: "post"
title: "Setting File Attributes on Upload"
date: "2013-03-08 09:20:55"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2013/03/setting-file-attributes-on-upload.html "
typepad_basename: "setting-file-attributes-on-upload"
typepad_status: "Publish"
---

<p><img alt="" src="/assets/TipsAndTricks3.png" /></p>
<p>A while back, I wrote <a href="http://justonesandzeros.typepad.com/blog/2010/02/setting-file-attributes-on-download.html" target="_blank">an article</a> on the extra steps you need to do on download in order to avoid the “edited out of turn” status <img alt="" src="/assets/Out_of_turn.png" />.&#0160; Unfortunately, I neglected to provide the extra steps you need to do on upload.</p>
<p>When adding or checking in a file from the working folder, you should set the file to read-only.&#0160; This makes the file less likely to get updated by accident.&#0160; It also insures the correct file status in Vault Explorer.&#0160; </p>
<p>You should also set the create date on the local file so that it matches the CreateDate value from the File object returned from Vault.&#0160; This part is a bit confusing because File.CreateDate is the datetime that the version was created (aka. the check-in time).&#0160; So your file on disk will have a create date larger than the last modified date.</p>
<p>Those are the two basic things to set: read-only and create date.&#0160; They are same two steps are used for download.&#0160; Here is some example code:</p>
<table border="1" cellpadding="2" cellspacing="0" width="470">
<tbody>
<tr>
<td valign="top" width="470">
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">// C#</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span style="font-size: 9pt;">File</span></span></span><span><span style="font-size: 9pt; color: #000000;"> file = m_svcMgr.DocumentService.AddFile(</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">folder.Id, filename, comment,</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.GetLastWriteTime(localpath),</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">FileClassification</span></span><span style="color: #000000;">.None, </span><span><span style="color: #0000ff;">false</span></span><span style="color: #000000;">, byteArray);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span style="font-size: 9pt;">FileAttributes</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> baseAttr = System.IO.</span><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.GetAttributes(localpath);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span style="font-size: 9pt;">FileAttributes</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> rwAttr = baseAttr &amp; ~</span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;">.ReadOnly;</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span style="font-size: 9pt;">FileAttributes</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> readOnlyAttr = baseAttr </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;">.ReadOnly;</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">// clear the read-only bit if it is there</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetAttributes(localpath, rwAttr);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="mso-spacerun: yes;"><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160; </span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">// set create time to match Vault</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetCreationTime(localpath, file.CreateDate);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">// set the read-only bit</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetAttributes(localpath, readOnlyAttr);</span></span></span></span></p>
</td>
</tr>
<tr>
<td valign="top" width="470">
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">&#39; VB</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span style="font-size: 9pt;">Dim</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> file </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;"> = m_svcMgr.DocumentService.AddFile( _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">folder</span></span><span style="color: #000000;">.Id, filename, comment, _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.GetLastWriteTime(localpath), _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">Nothing</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">Nothing</span></span><span style="color: #000000;">, _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">FileClassification</span></span><span style="color: #000000;">.None, </span><span><span style="color: #0000ff;">False</span></span><span style="color: #000000;">, byteArray)</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span style="font-size: 9pt;">Dim</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> baseAttr </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;"> = _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.GetAttributes(localpath)</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span style="font-size: 9pt;">Dim</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> rwAttr </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;"> = _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">baseAttr </span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">And</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">Not</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;">.[ReadOnly]</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span style="font-size: 9pt;">Dim</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> readOnlyAttr </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;"> = _</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">baseAttr </span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">Or</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">FileAttributes</span></span><span style="color: #000000;">.[ReadOnly]</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">&#39; clear the read-only bit if it is there</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetAttributes(localpath, rwAttr)</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">&#39; set create time to match Vault</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetCreationTime(localpath, file.CreateDate)</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #008000;">&#39; set the read-only bit</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="font-size: 9pt;">System.IO.</span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.SetAttributes(localpath, readOnlyAttr)</span></span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p>If you are uploading from a location other than the working folder, you don’t need to worry about these steps.&#0160; The Vault status will be empty since it won’t find a match on the local file system.&#0160; If you are checking in and keeping the file checked out, you can also ignore these steps.&#0160; </p>
<p><img alt="" src="/assets/TipsAndTricks3-1.png" /></p>
