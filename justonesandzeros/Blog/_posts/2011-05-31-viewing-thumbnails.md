---
layout: "post"
title: "Viewing Thumbnails"
date: "2011-05-31 16:10:23"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2011/05/viewing-thumbnails.html "
typepad_basename: "viewing-thumbnails"
typepad_status: "Publish"
---

<p><img alt="" src="/assets/TipsAndTricks3.png" /></p>
<p><strong>Updated for Vault 2012</strong>: New image types are now supported for thumbnails.&#0160; In Vault 2011 and earlier, Metafile was the only image type.&#0160; In Vault 2012, anything that can be streamed into System.Drawing.Image is supported.&#0160;</p>
<p>This post contains the updated code.&#0160; <a href="http://justonesandzeros.typepad.com/blog/2009/09/viewing-thumbnails.html" target="_blank">The old code can be found here</a>.</p>
<hr noshade="noshade" style="color: #ff5a00;" />
<p>Basically there are two possible algorithms, and you don&#39;t know which one to use upfront.&#0160; So the code tries one algorithm.&#0160; If it fails, the second algorithm is run.</p>
<table border="1" cellpadding="2" cellspacing="0" width="480">
<tbody>
<tr>
<td valign="top" width="480">
<p class="MsoNormalCxSpFirst"><span style="color: #0000ff; font-size: xx-small;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">private</span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span> GetImage(<span style="color: #2b91af;"><span style="color: #2b91af;">PropInst</span></span> prop, <span style="color: #0000ff;"><span style="color: blue;">int</span></span> width, <span style="color: #0000ff;"><span style="color: blue;">int</span></span> height)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;">{                <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">byte</span></span>[] thumbnailRaw = (<span style="color: #0000ff;"><span style="color: blue;">byte</span></span>[])prop.Val;                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span>System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span> retVal = <span style="color: #0000ff;"><span style="color: blue;">null</span></span>;                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">using</span></span> (System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">MemoryStream</span></span> ms = <span style="color: #0000ff;"><span style="color: blue;">new</span></span> System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">MemoryStream</span></span>(thumbnailRaw))                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span>{                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">// we don&#39;t know what format the image is in, so we try a couple of formats                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">try                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>{                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">// try the meta file format                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>ms.Seek(12, System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">SeekOrigin</span></span>.Begin);                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.Drawing.Imaging.<span style="color: #2b91af;"><span style="color: #2b91af;">Metafile</span></span> metafile =&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">new</span></span> System.Drawing.Imaging.<span style="color: #2b91af;"><span style="color: #2b91af;">Metafile</span></span>(ms);                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = metafile.GetThumbnailImage(width, height,&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">new</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.<span style="color: #2b91af;"><span style="color: #2b91af;">GetThumbnailImageAbort</span></span>(GetThumbnailImageAbort),&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.<span style="color: #2b91af;"><span style="color: #2b91af;">IntPtr</span></span>.Zero);                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>}                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">catch</span></span>&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>{                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">// I guess it&#39;s not a metafile                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = <span style="color: #0000ff;"><span style="color: blue;">null</span></span>;                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>}                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">&#0160;</span></p>
<span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">if</span></span> (retVal == <span style="color: #0000ff;"><span style="color: blue;">null</span></span>)               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>{               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">try                <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>{               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">// try to stream to System.Drawing.Image                <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>ms.Seek(0, System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">SeekOrigin</span></span>.Begin);               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span> rawImage = System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.FromStream(ms, <span style="color: #0000ff;"><span style="color: blue;">true</span></span>);               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = rawImage.GetThumbnailImage(width, height,&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">new</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.<span style="color: #2b91af;"><span style="color: #2b91af;">GetThumbnailImageAbort</span></span>(GetThumbnailImageAbort),&#0160; <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.<span style="color: #2b91af;"><span style="color: #2b91af;">IntPtr</span></span>.Zero);               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>}               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">catch                <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>{               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">// not compatible Image object                <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = <span style="color: #0000ff;"><span style="color: blue;">null</span></span>;               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>}               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>}               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span>}               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">return</span></span> retVal;               <br /></span></span><span style="font-size: xx-small;"><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">}              <br /> <br /></span></span><span style="color: #0000ff; font-size: xx-small;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">private</span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"> <span style="color: #0000ff;"><span style="color: blue;">static</span></span> <span style="color: #0000ff;"><span style="color: blue;">bool</span></span> GetThumbnailImageAbort()               <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;">{              <br /></span></span><span style="font-size: xx-small;"><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">return</span></span> <span style="color: #0000ff;"><span style="color: blue;">false</span></span>;               <br /></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">}</span></span></td>
</tr>
<tr>
<td valign="top" width="480">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="font-size: xx-small;"><span style="color: #0000ff; font-size: xx-small;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">Private</span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"> <span style="color: #0000ff;"><span style="color: blue;">Function</span></span> GetImage(<span style="color: #0000ff;"><span style="color: blue;">ByVal</span></span> prop <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #2b91af;"><span style="color: #2b91af;">PropInst</span></span>, <span style="color: #0000ff;"><span style="color: blue;">ByVal</span></span> width <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">Integer</span></span>, _                   <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;"><span style="color: blue;">ByVal</span></span> height <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">Integer</span></span>)</span> _                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">As</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Dim</span></span> thumbnailRaw <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">Byte</span></span>() = <span style="color: #0000ff;"><span style="color: blue;">DirectCast</span></span>(prop.Val, <span style="color: #0000ff;"><span style="color: blue;">Byte</span></span>())                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Dim</span></span> retVal <span style="color: #0000ff;"><span style="color: blue;">As</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span> = <span style="color: #0000ff;"><span style="color: blue;">Nothing                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Using</span></span> ms <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">New</span></span> System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">MemoryStream</span></span>(thumbnailRaw)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;"> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;"><span style="color: green;">&#39; we don&#39;t know what format the image is in, so we try a couple of formats                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Try                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;"><span style="color: green;">&#39; try the meta file format                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>ms.Seek(12, System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">SeekOrigin</span></span>.Begin)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Dim</span></span> metafile <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">New</span></span> System.Drawing.Imaging.<span style="color: #2b91af;"><span style="color: #2b91af;">Metafile</span></span>(ms)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = metafile.GetThumbnailImage(width, height, _                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">New</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.<span style="color: #2b91af;"><span style="color: #2b91af;">GetThumbnailImageAbort</span></span>( _                 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;"><span style="color: blue;">AddressOf</span></span> GetThumbnailImageAbort), _                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.<span style="color: #2b91af;"><span style="color: #2b91af;">IntPtr</span></span>.Zero)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Catch                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;"><span style="color: green;">&#39; I guess it&#39;s not a metafile                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = <span style="color: #0000ff;"><span style="color: blue;">Nothing                    <br /></span></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">End</span></span> <span style="color: #0000ff;"><span style="color: blue;">Try</span></span> </span> </span></p>
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">If</span></span> retVal <span style="color: #0000ff;"><span style="color: blue;">Is</span></span> <span style="color: #0000ff;"><span style="color: blue;">Nothing</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Then                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Try                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">&#39; try a serialized System.Drawing.Image                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>ms.Seek(0, System.IO.<span style="color: #2b91af;"><span style="color: #2b91af;">SeekOrigin</span></span>.Begin)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Dim</span></span> rawImage <span style="color: #0000ff;"><span style="color: blue;">As</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span> = System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.FromStream(ms, <span style="color: #0000ff;"><span style="color: blue;">True</span></span>)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = rawImage.GetThumbnailImage(width, height, _                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">New</span></span> System.Drawing.<span style="color: #2b91af;"><span style="color: #2b91af;">Image</span></span>.<span style="color: #2b91af;"><span style="color: #2b91af;">GetThumbnailImageAbort</span></span>( _                 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="color: #0000ff;"><span style="color: blue;">AddressOf</span></span> GetThumbnailImageAbort), _                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.<span style="color: #2b91af;"><span style="color: #2b91af;">IntPtr</span></span>.Zero)                 <br /></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Catch                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;"><span style="font-size: xx-small;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="color: #008000; font-size: xx-small;"><span style="color: green;">&#39; not a serialized Image object                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>retVal = </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Nothing                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">End</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Try                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">End</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">If                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">End</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Using                  <br /></span></span></span><span style="font-size: xx-small;"><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Return</span></span> retVal                 <br /></span><span style="color: #0000ff;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">End</span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Function                  <br /> <br /></span></span></span><span style="color: #0000ff; font-size: xx-small;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">Private</span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"> <span style="color: #0000ff;"><span style="color: blue;">Shared</span></span> <span style="color: #0000ff;"><span style="color: blue;">Function</span></span> GetThumbnailImageAbort() <span style="color: #0000ff;"><span style="color: blue;">As</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">Boolean                  <br /></span></span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"><span style="font-size: xx-small;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Return</span></span> </span><span style="color: #0000ff; font-size: xx-small;"><span style="color: blue;">False                  <br /></span></span></span><span style="font-size: xx-small;"><span style="color: #0000ff;"><span style="font-family: consolas; color: blue; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;">End</span></span><span style="font-family: consolas; font-size: 9.5pt; mso-bidi-font-family: consolas; mso-bidi-language: ar-sa;"> <span style="color: #0000ff;"><span style="color: blue;">Function </span> </span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p><img alt="" src="/assets/TipsAndTricks3-1.png" /></p>
