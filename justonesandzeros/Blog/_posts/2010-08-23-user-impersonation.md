---
layout: "post"
title: "User Impersonation"
date: "2010-08-23 08:20:46"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2010/08/user-impersonation.html "
typepad_basename: "user-impersonation"
typepad_status: "Publish"
---

<p>&#0160;<img src="/assets/TipsAndTricks2.png" /> </p> <p>Here is a common problem.&#0160; You have a custom command that you want people to use, but it does something that requires admin privileges.&#0160; Making everyone an administrator is a bad idea.&#0160; A better solution is for your command to perform an action as another user.</p> <p>Vault doesn&#39;t support a true impersonation model, but there is a workaround that works pretty well.&#0160; Just have your program log in as another user to perform the special task.&#0160; Log out as soon as the task is done and let the rest of the operations be performed by the logged-in user.</p> <p>Recycle Bin 2.0 makes liberal use of this technique.&#0160; The whole program rests on a special &quot;Recycle Bin&quot; folder where files go before they are deleted.&#0160; Obviously this folder needs to be locked down from normal use.&#0160; All interaction with the Recycle Bin folder needs to be through one of the custom commands.&#0160; To enforce this, the administrator needs to designate a special Recycle Bin User, which is the only one allowed to interact with the Recycle Bin folder.&#0160; Any time a Recycle Bin command is executed, the code logs in as the Recycle Bin user in order to interact with the folder.</p> <p><strong>Considerations:</strong></p> <p>First, your code needs a way to know how to log in as the impersonated user.&#0160; In practice the impersonated user is usually an administrator, so you have to keep the password hidden from the end user.&#0160; There are various ways to fix this.&#0160; You can hard-code the password, or you can encrypt the password and put it in a common location.&#0160; </p> <p>Next, there is the issue of licensing.&#0160; If you log in as two different users, you will consume 2 licenses.&#0160; If licenses are tight, then impersonation might not be an option.&#0160; Logging out the original user is not a good idea because what if all the licenses are used up when the operation is over an they try to log back in?&#0160; <br />The best approach is to use the impersonated user only as long as needed.&#0160; When the operation is over, log out immediately to free up the license.&#0160; If all goes well, it shouldn&#39;t have a noticeable impact on the licenses being consumed.   <br />Also, make sure to handle errors properly.&#0160; If errors come up during the operation, you still want to make sure the impersonated user get logged out at the end.</p> <p>Lastly, impersonation has an impact on data history.&#0160; Let&#39;s say you have an operation that uses impersonation to move a file to the Released state.&#0160; Later in time you want to see who released a certain file.&#0160; That becomes hard to do since the history of the item will show the impersonated user as the one who made the change.&#0160; What you want to see is the actual user.&#0160; <br />This can be solved by storing the actual user as a piece of meta-data, such as a UDP value.&#0160; It&#39;s not a perfect workaround because the data you want is not in the place where you expect it to be.&#0160; </p>
