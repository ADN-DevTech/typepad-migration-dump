---
layout: "post"
title: "Replication - Introduction"
date: "2010-08-03 08:44:08"
author: "Doug Redmond"
categories:
  - "Concepts"
original_url: "https://justonesandzeros.typepad.com/blog/2010/08/replication---introduction.html "
typepad_basename: "replication---introduction"
typepad_status: "Publish"
---

<p><img src="/assets/Concepts2.png" /> </p> <p>Replication.  <br />Replication.   <br />Also known as Connected Workgroups, Replication is the feature where you can create multiple, working copies of the Vault database.&#0160; The main reason you would want to do this is if you have multiple locations working on the same vault where your network latency is too large between locations.&#0160; Replication speeds things up by allowing users to work exclusively with their local location.&#0160; In the background, the data gets synchronized with the other site.&#0160; This article will go into more details on this process because it has an impact on application development.</p> <p>To understand Vault replication, you need to first understand the SQL Server replication since that is the underlying technology.&#0160; As a rule, I try to avoid database details.&#0160; But for replication, that rule is trumped by a bigger rule: <em>Give developers the information they need to write Vault applications.&#0160; </em></p> <p><strong>SQL Server Replication</strong>   <br />In a nutshell, the concept is that you have separate databases on separate servers with the same data.&#0160; This sounds simple, but it&#39;s actually one of the most complex things in database programming.&#0160; </p> <p>As you probably already know, most of the Vault data is in a database.&#0160; So when you are viewing the Where Used on a part file, for example, you are just seeing a representation of a bunch of database rows.&#0160; What SQL Server does is keep track of all the rows that change.&#0160; These changes then get transferred to the other SQL Servers via a background process, and that&#39;s how data stays in sync.</p> <p>One important thing about this transfer: <strong>it is not instantaneous</strong>.&#0160; Even if you have a fast connection, you can expect there to be a delay of at least 1 minute before changes get transferred.&#0160; This delay can also be longer if you have a slow connection or the network is under heavy load.&#0160; </p> <p>Here is where things start getting complex, because it&#39;s possible for data to be legal in one SQL Server but illegal when replicated.&#0160; For example, in Vault, two people on different workgroups add a file called A.dwg to the same folder at the same time.&#0160; Everything works fine until the data is replicated.&#0160; Now you have two files with the same name in the same folder, which violates the rules on how Vault data should be structured.&#0160; Problems like these are called <strong>conflicts</strong>.&#0160; </p> <p><strong>Ownership</strong>  <br />There are various ways to deal with conflicts.&#0160; For Vault, we took the approach of preventing conflicts from happening in the first place.&#0160; We do this through the concept of <strong>ownership</strong>.&#0160; If you want to make <span style="text-decoration: underline;">any</span> edit in Vault, your workgroup needs the proper ownership.&#0160; So my earlier example is not possible.&#0160; You can only add A.dwg to a folder if your workgroup (aka. SQL instance) has ownership of the folder.&#0160; The workgroup without ownership will get an error if the try to add a file to the folder (also, the folder will show up as locked).</p> <p>The granularity of ownership varies depending on what you are working with.&#0160; There&#39;s the concept of <strong>Entity Ownership</strong>, where a workgroup has control of specific entities.&#0160; Files, folders, items and change orders are the only entities that can be owned in this way.&#0160; Everything else uses the concept of <strong>Database Ownership</strong>, which means that a workgroup owns all data in the database which is not controlled via entity ownership.&#0160; This covers things like property definitions, users, groups, categories, and so on.&#0160; Mostly administrator settings are controlled this way.</p> <p>Transferring ownership between two workgroups involves a handshake between the two servers.</p> <ol>
  <li>Workgroup A has ownership.</li>
  <li>Workgroup B requests ownership from A.</li>
  <li>Workgroup A changes ownership to B.&#0160; But this change is only recorded in A&#39;s database.</li>
  <li>Data is replicated to B via the SQL Server background process.</li>
  <li>Workgroup B has ownership. </li>
 </ol>
 <p>Some things to note about this process:</p> <ul>
  <li>Ownership transfer is not instant.&#0160; The requesting workgroup needs to wait for a replication cycle before it has ownership.</li>
  <li>Between steps 3 and 4 things are in a strange state.&#0160; A thinks B has ownership and B thinks A has ownership.&#0160; Effectively, this means that nobody has ownership.</li>
 </ul>
 <p><strong>Leases</strong>  <br />The last concept I want to talk about here is the <strong>lease</strong> concept.&#0160; Basically a lease prevents ownership from being transferred for a set length of time.&#0160; The rationale is that if you just grabbed ownership of something, you probably want to work on it for a while.&#0160; You don&#39;t another workgroup grabbing it away from you a few seconds later.&#0160; So when you transfer ownership, you set a lease period.&#0160; Until that lease expires, nobody can change the ownership.&#0160; Once the lease expires, it is still owned by the same workgroup.&#0160; Only when another workgroup requests ownership will the ownership change.</p> <p>I think by default you have a 1 day lease on entities you create.&#0160; If you grab ownership from somewhere else, you get a 1 hour lease.&#0160; If you have ownership of something, you can fully edit the lease.&#0160; You can extend or shorten the lease time.&#0160; You can remove the lease on an item or you can add a lease on something that does not have one.&#0160; You can&#39;t edit the lease of something not owned by your workgroup.</p>
