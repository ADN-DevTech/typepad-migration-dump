---
layout: "post"
title: "Caching"
date: "2013-01-25 11:25:34"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2013/01/caching.html "
typepad_basename: "caching"
typepad_status: "Publish"
---

<p><img alt="" src="/assets/TipsAndTricks3.png" /></p>
<p>If you’ve looked at any of the source code for my apps, first, let me apologize.&#0160; I went for quantity over quality on those apps.&#0160; So I didn’t structure the code for people not named Doug Redmond.&#0160; Even if you are a professional programmer, I’m guessing you don’t want to spend hours of your time deciphering a bunch of uncommented C#.&#0160; It’s probably best if I explain some techniques in the more human-readable blog format.</p>
<p>For this article, I’d like to talk about a caching technique that I’ve found useful in some of my apps.&#0160; <a href="http://en.wikipedia.org/wiki/Cache_%28computing%29" target="_blank">Caching</a> is pretty much a necessity when working with Vault.&#0160; You are constantly running into cases where you have an ID and you need to look up the object.&#0160; For things like Categories, Property Definitions and Lifecycle States the objects are unlikely to change.&#0160; So the optimial thing to do is store them in memory to reduce the number of API calls.</p>
<p>I like to call my cache Cache.&#0160; It contains two main things: The WebServiceManager and collections of cached Vault data.</p>
<p>For the collections of cached data, I usually use <a class="zem_slink" href="http://en.wikipedia.org/wiki/Lazy_initialization" rel="wikipedia" target="_blank" title="Lazy initialization">lazy initialization</a>.&#0160; That way I don’t look up something if I don’t have to.&#0160; The first request for the data triggers the API call.&#0160; Any further requests for the data use the cache.</p>
<p>The data structure I use depends on how I want to use it.&#0160; Just because Vault returns an array doesn’t mean I have to store it that way in the cache.&#0160; Frequently I’ll store it as a dictionary using the ID or system name as the key.&#0160; The ToDictionary feature in LINQ is a nice little trick.</p>
<p>Example code from <a href="http://justonesandzeros.typepad.com/blog/2012/07/deco-custom-ui-without-custom-code.html" target="_blank">DECO</a>:</p>
<table border="1" cellpadding="2" cellspacing="0" width="470">
<tbody>
<tr>
<td valign="top" width="470">
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span style="font-size: 9pt;">public</span></span></span><span><span style="font-size: 9pt;"><span style="color: #000000;"> </span><span><span style="color: #0000ff;">class</span></span><span style="color: #000000;"> </span></span><span><span style="font-size: 9pt; color: #2b91af;">Cache</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">{</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">private</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Lazy</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">Dictionary</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">&gt;&gt; m_custEntDefsBySysName;</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Dictionary</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">&gt; CustEntDefsBySysName</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">get</span></span><span style="color: #000000;"> { </span><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;"> m_custEntDefsBySysName.Value; }</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">}</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="mso-spacerun: yes;"><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> Cache(WebServiceManager mgr)</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">m_custEntDefsBySysName = </span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;"><span style="mso-spacerun: yes;">&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Lazy</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">Dictionary</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">&gt;&gt;(GetCustEntDef_SysName_Map);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">}</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">private</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Dictionary</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">&gt; GetCustEntDef_SysName_Map()</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">Dictionary</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">&gt; retVal = </span><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">;</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #2b91af;">CustEntDef</span></span><span style="color: #000000;">[] defs = Mgr.CustomEntityService.GetAllCustomEntityDefinitions();</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">retVal = defs.ToDictionary(n =&gt; n.Name);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 9pt;"><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;"> retVal;</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9pt;">}</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #000000;">}</span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p>My Cache object also contains a WebServiceManager.&#0160; First, the lazy initializers need to run API commands.&#0160; Second, I find it easier to manage.&#0160; If the manager and the cache were two separate things, that’s two things I have pass around all the time and keep track of in the code.&#0160; By putting the manager in the cache, I only have one object to track.&#0160; The objects work well together too.&#0160; For example, if you ever need to dispose your WebServiceManager, you will probably want to clear out your cache too.</p>
<p>There are some other cases where you will want to clear your cache.&#0160; Mainly, if the data you are caching gets updated.&#0160; In my <a href="http://justonesandzeros.typepad.com/blog/2013/01/effective-permissions-2013.html" target="_blank">Effective Permissions</a> app, I cache all the all the user and group information.&#0160; But it’s reasonable that an admin might run Effective Permissions, update the user and group settings, then run Effective Permissions again.&#0160; So I need to clear my cache, but the Vault API doesn’t give me a way to know that users or groups were updated.&#0160; </p>
<p>My solution was to clear the cache whenever the Global Settings command is invoked.&#0160; Even though I don’t know for sure that anything changed, I clear the cache anyway, just to be safe.&#0160; This technique isn’t 100%.&#0160; It’s possible that another custom command updated the data, or another admin updated the data from their Vault client.&#0160; In the case of Effective Permissions, I didn&#39;t feel a 100% solution was needed.</p>
<p><img alt="" src="/assets/TipsAndTricks3-1.png" /></p>
