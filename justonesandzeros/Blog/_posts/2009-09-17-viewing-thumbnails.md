---
layout: "post"
title: "Viewing Thumbnails"
date: "2009-09-17 08:02:51"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2009/09/viewing-thumbnails.html "
typepad_basename: "viewing-thumbnails"
typepad_status: "Publish"
---

<p><img alt="" border="0" src="/assets/TipsAndTricks3.png" /></p>
<p class="asset asset-image"><strong>Update for Vault 2012</strong>:&#0160; Additional image formats supported. This post applies to Vault 2011 and earlier. <a href="http://justonesandzeros.typepad.com/blog/2011/05/viewing-thumbnails.html" target="_self">Go here for the Vault 2012 code</a>.</p>
<p><img alt="" border="0" src="/assets/TipsAndTricks3-1.png" /></p>
<p class="asset asset-image">Here is how you view thumbnail data from Vault.<br /><br /><strong>Background:</strong><br />Thumbnails are stored as metafiles, which must be rendered to a display context.&#0160; This is a bit different from a jpeg because metafiles have no fixed size.&#0160; This is nice because the image can be scaled to any size without loss of detail.<br /><br /><strong>Sample Code:</strong><br />Once you have found the PropInst object with the thumbnail value, here is how you can render it to a System.Drawing.Image object.<br /><br />C#:</p>
<p class="asset asset-image">&#0160;</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">
<tbody>
<tr>
<td valign="top"><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;summary&gt;<br />///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> Takes a thumbnail property from Vault and renders it to an Image</span><br /><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;/summary&gt;</span><br /><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">private</span><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"> System.Drawing.<span style="color: #2b91af;">Image</span> RenderThumbnailToImage(Document.<span style="color: #2b91af;">PropInst</span> propInst, <span style="color: blue;">int</span> width, <span style="color: blue;">int</span> height)<br />{<br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">// convert the property value to a byte array</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">byte</span>[] thumbnailRaw = (<span style="color: blue;">byte</span>[])propInst.Val; <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">// load the data into a stream but skip the first 12 bytes</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: #2b91af;">Stream</span> stream = <span style="color: blue;">new</span> <span style="color: #2b91af;">MemoryStream</span>(thumbnailRaw, 12, thumbnailRaw.Length - 12); <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">// create the Metafile object</span><br /><span>&#0160;&#0160;&#0160; </span>System.Drawing.Imaging.<span style="color: #2b91af;">Metafile</span> metafile = <span style="color: blue;">new</span> System.Drawing.Imaging.<span style="color: #2b91af;">Metafile</span>(stream); <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">// render the Metafile to an Image object and display in the picture box</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: #2b91af;">Image</span> retVal = metafile.GetThumbnailImage(width, height, <span style="color: blue;">new</span> <span style="color: #2b91af;">Image</span>.<span style="color: #2b91af;">GetThumbnailImageAbort</span>(GetThumbnailImageAbort), <span style="color: #2b91af;">IntPtr</span>.Zero);<br /><span>&#0160;&#0160;&#0160; </span>stream.Close();&#0160;<br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">return</span> retVal;<br />} <br /></span>
<p class="MsoNormal"><br /><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;summary&gt;<br />///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> Delagate for the GetThumnailImage function.</span><br /><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">///</span><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;"> </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;/summary&gt;</span><br /><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">private</span><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"> <span style="color: blue;">static</span> <span style="color: blue;">bool</span> GetThumbnailImageAbort()<br />{<br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">return</span> <span style="color: blue;">false</span>;<span>&#0160; </span><span style="color: green;">// do nothing</span></span><br /><span style="font-size: 10pt; line-height: 115%; font-family: &#39;Courier New&#39;;">}</span></p>
</td>
</tr>
</tbody>
</table>
<p class="asset asset-image"><br />VB.NET:</p>
<p class="asset asset-image">&#0160;</p>
<table border="1" cellpadding="2" cellspacing="2" width="100%">
<tbody>
<tr>
<td valign="top"><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;">&#39;&#39;&#39; </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;summary&gt;</span><br /><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;">&#39;&#39;&#39; Takes a thumbnail property from Vault and renders it to an Image<br />&#39;&#39;&#39; </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;/summary&gt;</span><br /><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">Private</span><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"> <span style="color: blue;">Function</span> RenderThumbnailToImage(<span style="color: blue;">ByVal</span> propInst <span style="color: blue;">As</span> Document.PropInst, <span style="color: blue;">ByVal</span> width <span style="color: blue;">As</span> <span style="color: blue;">Integer</span>, <span style="color: blue;">ByVal</span> height <span style="color: blue;">As</span> <span style="color: blue;">Integer</span>) <span style="color: blue;">As</span> System.Drawing.Image<br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">&#39; convert the property value to a byte array</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Dim</span> thumbnailRaw <span style="color: blue;">As</span> <span style="color: blue;">Byte</span>() = <span style="color: blue;">CType</span>(propInst.Val, <span style="color: blue;">Byte</span>()) <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">&#39; load the data into a stream but skip the first 12 bytes</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Dim</span> stream <span style="color: blue;">As</span> System.IO.Stream = <span style="color: blue;">New</span> System.IO.MemoryStream(thumbnailRaw, 12, thumbnailRaw.Length - 12) <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">&#39; create the Metafile object</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Dim</span> metafile <span style="color: blue;">As</span> System.Drawing.Imaging.Metafile = <span style="color: blue;">New</span> System.Drawing.Imaging.Metafile(stream) <br /><br /><span>&#0160;&#0160;&#0160; </span><span style="color: green;">&#39; render the Metafile to an Image object and display in the picture box</span><br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Dim</span> retVal <span style="color: blue;">As</span> Image = metafile.GetThumbnailImage(width, height, <span style="color: blue;">New</span> Image.GetThumbnailImageAbort(<span style="color: blue;">AddressOf</span> GetThumbnailImageAbort), IntPtr.Zero) <br /><br /><span>&#0160;&#0160;&#0160; </span>stream.Close()&#0160;<br /><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Return</span> retVal</span><br /><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">End</span><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"> <span style="color: blue;">Function</span></span><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;"> <br /></span><br /><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;">&#39;&#39;&#39; </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;summary&gt;</span><br /><span style="font-size: 10pt; color: green; font-family: &#39;Courier New&#39;;">&#39;&#39;&#39; Delagate for the GetThumnailImage function.<br />&#39;&#39;&#39; </span><span style="font-size: 10pt; color: gray; font-family: &#39;Courier New&#39;;">&lt;/summary&gt;</span><br /><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">Private</span><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"> <span style="color: blue;">Shared</span> <span style="color: blue;">Function</span> GetThumbnailImageAbort() <span style="color: blue;">As</span> <span style="color: blue;">Boolean</span></span><span style="font-size: 10pt; color: blue; font-family: &#39;Courier New&#39;;">&#0160;</span><br /><span style="font-size: 10pt; font-family: &#39;Courier New&#39;;"><span>&#0160;&#0160;&#0160; </span><span style="color: blue;">Return</span> <span style="color: blue;">False</span><span>&#0160; </span><span style="color: green;">&#39; do nothing</span></span><br /><span style="font-size: 10pt; color: blue; line-height: 115%; font-family: &#39;Courier New&#39;;">End</span><span style="font-size: 10pt; line-height: 115%; font-family: &#39;Courier New&#39;;"> <span style="color: blue;">Function</span></span></td>
</tr>
</tbody>
</table>
<p><img alt="" border="0" src="/assets/TipsAndTricks3-1.png" /></p>
