---
layout: "post"
title: "Vault on Metro"
date: "2013-08-16 12:00:09"
author: "Doug Redmond"
categories:
  - "Sample Applications"
  - "Vault"
original_url: "https://justonesandzeros.typepad.com/blog/2013/08/vault-on-metro.html "
typepad_basename: "vault-on-metro"
typepad_status: "Publish"
---

<p><img alt="" src="/assets/Vault3.png" /></p>
<p><img alt="" src="/assets/SampleApp3.png" /></p>
<p><strong>Update</strong>:&#0160; I&#39;ve just been informed that Microsoft stopped using the word using the term Metro.&#0160; The current term is &quot;Windows Store Apps&quot; or something like that.&#0160; </p>
<p>Last December, my Christmas present to myself was a Windows Surface tablet.&#0160; In typical me-style, I decided to write an app for it.&#0160; Overall, it was a pain getting the app to work.&#0160; I expected it to be easy to write a Microsoft tablet app using Microsoft Visual Studio and the Vault API, which is built on Microsoft .NET.&#0160; Alas, no, it was a pain to get the app working.&#0160; </p>
<p><img alt="" src="/assets/screenshot.png" /></p>
<p>Requirements:</p>
<ul>
<li>Visual Studio 2012</li>
<li>Windows 8</li>
<li>Vault 2014</li>
</ul>
<p><a href="http://justonesandzeros.typepad.com/Apps/Metro/VaultFolderBrowse-src.zip" target="_blank">Click here for the source code</a>    <br />Compiled app not available</p>
<hr noshade="noshade" style="color: #013181;" />
<p>The app itself is a simple folder browser.&#0160; Nothing fancy.&#0160; I just wanted to figure out the steps for getting the Vault API to work.&#0160; I basically took the “Grid App” template project from VS and modified it to work with Vault. Let me take you through the app...</p>
<p><strong>None of the Vault SDK libraries work</strong></p>
<p>The Connection object, the WebServiceManager, IExplorerUtils, none of those work for a Metro app.&#0160; The Vault SDK DLLs require .NET libraries not present in Metro.&#0160; If you want the Vault objects, you will have to go “old school” and set of the service references directly.&#0160; </p>
<p>It’s always annoying going from a full set of libraries (Winforms/XAML) to a subset of libraries (Metro).&#0160; I understand why this is needed, but it baffles me why some things are left out.&#0160; Android has a reduced set of Java libraries, but it doesn’t <em>feel</em> that way when you are programming with it.&#0160; In a perfect world, Metro would be that way too.  </p>
<p>Anyway, to set up your Vault service objects (DocumentService, AuthService, etc), you need to add Service References in your VS project.&#0160; You do this by right-clicking on your project and selecting Add Service Reference.</p>
<p><img alt="" src="/assets/ServiceSetup-scaled.png" /></p>
<p>First, you need to insert the address of the web service.&#0160; In Vault 2014, there are 2 main locations for web services.&#0160; <a href="http://justonesandzeros.typepad.com/blog/2013/06/vault-filestore-server.html" target="_blank">Filestore services</a> are located at     <br /><span style="color: #c0504d;">http://[serverName]/autodeskdm/services/<strong>filestore</strong>/v18/[serviceName].svc</span>.&#0160; And all other web services are at     <br /><span style="color: #c0504d;">http://[serverName]/autodeskdm/services/v18/[serviceName].svc</span> .</p>
<p>If everything goes well, clicking Go should show you a list of functions for that service.&#0160; Before you click OK, make sure you set the namespace to something useful.&#0160; You are going to have multiple services for any given Vault app, so the namespace needs to be clear.</p>
<p>To log in you will need the AuthService, which is in the filestore URL path.</p>
<hr noshade="noshade" style="color: #013181;" />
<p><strong>The SecurityHeader</strong></p>
<p>VS generated the SecurityHeader class, but it didn’t hook it up to anything.&#0160; The SecurityHeader is pretty important.&#0160; It contains your user’s session information.&#0160; Vault requires this information on almost every web service call.&#0160; That’s how Vault knows that who you are so that it can apply permissions.&#0160; If you can’t send the SecurityHeader, you can’t use the Vault API.&#0160; Period.</p>
<p>If you set a Service Reference in a normal VS project, the SecurityHeader is hooked up for you automatically.&#0160; I have no idea why a Metro app is different.&#0160; I had to spend most of my time, searching around on how to manually read/write header data on your web service calls.</p>
<p>&#0160;</p>
<p><strong>Step 1:&#0160; Set the [XMLRoot] attribute      <br /></strong>When you set up a Service Reference, Visual Studio auto-generates a bunch of files.&#0160; Go into the Reference.cs file for your AuthService.&#0160; You will need to “Show All Files” if you want to see it in your VS project.&#0160; Find the SecurityHeader class and replace the [System.Xml.Serialization.XmlTypeAttribute] attribute with this:</p>
<table border="1" cellpadding="2" cellspacing="0" width="470">
<tbody>
<tr>
<td valign="top" width="470"><span style="font-family: Consolas;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"><span style="font-size: 9.5pt;">[System.Xml.Serialization.</span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">XmlRoot</span></span><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;">(Namespace=</span></span><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #a31515;">http://AutodeskDM/Services</span></span></span><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">)]</span></span></span></td>
</tr>
</tbody>
</table>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;">   <br />Since this is an auto-generated file, you need to be on the lookout.&#0160; Actions in VS, like changing the project settings, may trigger an update of this file, which overwrites the change.</p>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;">&#0160;</p>
<p><span style="color: #232323;"><strong>Step 2:&#0160; Logging in        <br /></strong></span>When you call the Login function, you don’t get back a direct result.&#0160; However, there is a SecurityHeader object in the header XML.&#0160; You have to go through through some hoops in order to read that header in a Metro app.&#0160; Actually, <em>I </em>had to go through the hoops; <em>you</em> can just copy my code.</p>
<table border="1" cellpadding="2" cellspacing="0" width="470">
<tbody>
<tr>
<td valign="top" width="470">
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;"><span style="font-size: 9.5pt;">using</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> System.ServiceModel;</span></span></span></p>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;"><span style="font-family: Consolas;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;"><span style="font-size: 9.5pt;">using</span></span></span><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> System.ServiceModel.Channels;</span></span></span><span style="line-height: 11pt;">&#0160;</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;"><span style="font-size: 9.5pt;">public</span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">void</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> Login(</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">string</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> server, </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">string</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> vault, </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">string</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> username, </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">string</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> password)</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">{</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #008000;">// sign into Vault and remember the security header</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;">&#0160;</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">using</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> (</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContextScope</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> scope = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">new</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContextScope</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">(authClient.InnerChannel))</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContext</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> current = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContext</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">.Current;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">authClient.SignInAsync(server, vault, username, password).Wait();</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">HttpResponseMessageProperty</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> httpResponseProperty = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">new</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">HttpResponseMessageProperty</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">();</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">XmlDictionaryReader</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> dict = current.IncomingMessageHeaders.GetReaderAtHeader(0);</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">string</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> securityStr = dict.ReadOuterXml();</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">XmlSerializer</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> serializer = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">new</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">XmlSerializer</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;">(</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">typeof</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;">(AuthSvc.</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">SecurityHeader</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">));</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">System.IO.</span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">StringReader</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> reader = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">new</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> System.IO.</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">StringReader</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">(securityStr);</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">securityHeader = serializer.Deserialize(reader) </span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">as</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> AuthSvc.</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">SecurityHeader</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">}</span></span></span></span></p>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">}</span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p>Save that securityHeader object. You will need it for all other Vault calls.</p>
<p>&#0160;</p>
<p><strong>Step 3: Using the header</strong></p>
<p>Now that we are logged in, we can actually start reading/writing Vault data.&#0160; On every call we need to set the securityHeader.&#0160; It’s basically the same steps from part 2 but in reverse.</p>
<p>In my sample, I wrap all the calls in a delegate.&#0160; </p>
<table border="1" cellpadding="2" cellspacing="0" width="470">
<tbody>
<tr>
<td valign="top" width="470">
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;"><span style="font-size: 9.5pt;">private</span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> T DoWebServiceCall&lt;T&gt;(</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">Func</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">&lt;T&gt; a)</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">{</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">using</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> (</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContextScope</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> scope = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">new</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContextScope</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">(docClient.InnerChannel))</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #008000;">// set the security header and make the web service call</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;">&#0160;</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContext</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> current = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">OperationContext</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">.Current;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">MessageHeader</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> header = </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">MessageHeader</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;">.CreateHeader(</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #a31515;">&quot;SecurityHeader&quot;</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;">, </span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #a31515;">&quot;http://AutodeskDM/Services&quot;</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;">, securityHeader);</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">current.OutgoingMessageHeaders.Add(header);</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">&#0160;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">return</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> a();</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">}</span></span></span></span></p>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">}</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;"><span style="font-size: 9.5pt;">public</span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> DocumentSvc.</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #2b91af;">Folder</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> GetFolderById(</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">long</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> folderId)</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">{</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">return</span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #000000;"> DoWebServiceCall(</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #0000ff;">delegate</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">{</span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: Consolas;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span><span style="font-size: 9.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="color: #0000ff;">return</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-size: 9.5pt; color: #000000;"> docClient.GetFolderByIdAsync(folderId).Result;</span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 9.5pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 9.5pt;">});</span></span></span></span></p>
<p class="MsoNormal" style="line-height: 13pt; margin: 0in 0in 10pt;"><span style="background-image: none; line-height: 11pt; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-highlight: white;"><span style="font-family: Consolas;"><span style="font-size: 9.5pt; color: #000000;">}</span></span></span></p>
</td>
</tr>
</tbody>
</table>
<hr noshade="noshade" style="color: #013181;" />
<p><strong>Conclusion:</strong></p>
<p>That’s it for now.&#0160; I used up all my time figuring out the security header stuff, so the app itself isn’t much to speak of.&#0160; I left out a bunch of things like multi-threading, logging out of Vault, error handling, cashing and useful functionality.&#0160; I’ll leave it to you to figure all of those things out if you want to write a Metro app.</p>
<p><img alt="" src="/assets/SampleApp3-1.png" /></p>
