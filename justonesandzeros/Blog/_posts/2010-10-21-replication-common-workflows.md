---
layout: "post"
title: "Replication - Common Workflows"
date: "2010-10-21 09:01:51"
author: "Doug Redmond"
categories:
  - "Tips and Tricks"
original_url: "https://justonesandzeros.typepad.com/blog/2010/10/replication-common-workflows.html "
typepad_basename: "replication-common-workflows"
typepad_status: "Publish"
---

<p><img alt="" src="/assets/TipsAndTricks2.png" /></p>
<p>Here are some code snippets to help you out when dealing with replicated environments.</p>
<p><strong>Finding out your local workgroup</strong></p>
<p>One of the first things you will probably want to do is figure out which workgroup you are connected to.&#0160; This one is pretty easy, just call <strong>GetLocalWorkgroup</strong>() in the ReplicationService.</p>
<p>If you want to get the list of all the workgroups connected to your local workgroup, you can call <strong>GetAllWorkgroups</strong>().&#0160; If replication is running, there should be only 1 publisher and the rest should be subscribers.</p>
<p><strong>Finding out the entity&#39;s owner</strong></p>
<p>The next thing you will probably want to do is figure out which workgroup owns the thing you want to work on.&#0160; The best way is to use <strong>GetOwnershipByEntityId</strong>.</p>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">// C#               <br />// get the ownership for a file, folder, item                 <br /></span></span><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">//<span style="mso-spacerun: yes;">&#0160; </span>and change order</span></span><span style="color: #2b91af; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: #2b91af; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> <br />EntOwn</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> [] ownerhips =                <br />replSvc.GetOwnershipByEntityId( </span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #0000ff;"><span style="color: blue;">long</span></span>[]                 <br />{                 <br />&#0160;&#0160;&#0160; </span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">file.MasterId, folder.Id, </span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">item.MasterId, co.Id&#0160; <br />});</span></span></p>
</td>
</tr>
</tbody>
</table>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">&#39; VB.NET               <br />&#39; get the ownership for a file, folder, item                 <br /></span></span><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">&#39;<span style="mso-spacerun: yes;">&#0160; </span>and change order                 <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Dim</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> ownerhips <span style="color: #0000ff;"><span style="color: blue;">As</span></span> EntOwn() = replSvc.GetOwnershipByEntityId(<span style="color: #0000ff;"><span style="color: blue;">New</span></span> <span style="color: #0000ff;"><span style="color: blue;">Long</span></span>() {file.MasterId, folder.Id, item.MasterId, co.Id})</span></span></p>
</td>
</tr>
</tbody>
</table>
<p>For files, items and change orders you can use the &quot;Current Owner&quot; property, but the result is designed more for human readability.&#0160; It&#39;s not very good for program logic because there are a couple of string formats that are used depending on the workgroup settings.</p>
<p><strong>Error 322</strong> <br />This is the error you get whenever you try to do something on an Entity that you don&#39;t own.&#0160; You can minimize the chance of getting this error by checking the &quot;Locked&quot; property on the object.&#0160; However it won&#39;t hit all cases and some Entities don&#39;t have a Locked property.</p>
<p>First you need to detect the error.&#0160; You can do this the same way you look up any <a href="http://justonesandzeros.typepad.com/blog/2009/11/errors-and-restrictions.html" target="_blank">other error code</a>.&#0160; There&#39;s nothing special here.</p>
<p>Next you need to decide how to handle the error.&#0160; This one is up to you and what make sense for your application.&#0160; Common options include A) displaying the error to the user and B) automatically attempt to gain ownership.</p>
<p><strong>Transferring Ownership</strong> <br />Here is how you transfer ownership of specific Entities.&#0160; You can transfer things in groups, which mean that all Entities in the group transfer or none do at all.&#0160; This feature is useful if you have a group of things that you need to work on.&#0160;</p>
<p>If you are transferring multiple groups, it&#39;s possible for one group to fail while another succeeds.&#0160; So you need to check the XferStatus to make sure the transfer succeeded.</p>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">// transfer a file and item together                <br /></span></span><span style="color: #2b91af; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: #2b91af; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">LongArray</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> group = <span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #2b91af;"><span style="color: #2b91af;">LongArray</span></span>();                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">group.Items = <span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #0000ff;"><span style="color: blue;">long</span></span>[]                 <br />&#0160;&#0160; { file.MasterId, item.MasterId };                 <br /> <br /></span></span><span style="color: #2b91af; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: #2b91af; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">XferStatus</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> [] status =                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160; </span>replSvc.TransferEntityGroupOwnership(                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160; </span>destWorkgroup.Id, <span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #2b91af;"><span style="color: #2b91af;">LongArray</span></span>[] { group }, 60);                 <br /> <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">if</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> (status.Any(n =&gt; !n.IsSuccess))                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #2b91af;"><span style="color: #2b91af;">MessageBox</span></span>.Show(                 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #a31515;"><span style="color: #a31515;">&quot;One or more ownership transfers failed&quot;</span></span>);                 <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">else                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #2b91af;"><span style="color: #2b91af;">MessageBox</span></span>.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Ownership transfers succeeded&quot;</span></span>);</span></span></p>
</td>
</tr>
</tbody>
</table>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">&#39; transfer a file and item together                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Dim</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> group <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">New</span></span> LongArray()                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">group.Items = <span style="color: #0000ff;"><span style="color: blue;">New</span></span> <span style="color: #0000ff;"><span style="color: blue;">Long</span></span>() {file.MasterId, item.MasterId}                <br /> <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Dim</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> status <span style="color: #0000ff;"><span style="color: blue;">As</span></span> XferStatus() = replSvc.TransferEntityGroupOwnership(destWorkgroup.Id, <span style="color: #0000ff;"><span style="color: blue;">New</span></span> LongArray() {group}, 60)                <br /> <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">If</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> status.Any(<span style="color: #0000ff;"><span style="color: blue;">Function</span></span>(n) <span style="color: #0000ff;"><span style="color: blue;">Not</span></span> n.IsSuccess) <span style="color: #0000ff;"><span style="color: blue;">Then                   <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span>MessageBox.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;One or more ownership transfers failed&quot;</span></span>)                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Else               <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span>MessageBox.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Ownership transfers succeeded&quot;</span></span>)                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">End</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> <span style="color: #0000ff;"><span style="color: blue;">If</span></span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p><strong>Using Newly Transferred Entities</strong> <br />So your code just transferred file ownership to your local workgroup.&#0160; You can start working on it, right?&#0160; <strong>Wrong!</strong></p>
<p>You need to wait for SQL to replicate the Entity data before you can start using.&#0160; The reason is because the Transfer function you called edited data on the <strong>remote workgroup</strong>, not your local workgroup.&#0160; Every other API function that edits data does the edit on the local database, but the Transfer functions are special.</p>
<p>So how do know when you have ownership for real?&#0160; The only way is to constantly check the ownership until it shows that your local workgroup owns it.</p>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">status = replSvc.TransferEntityGroupOwnership                <br />&#0160; (localWorkgroup.Id, <span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #2b91af;"><span style="color: #2b91af;">LongArray</span></span>[] { group }, 0);                 <br /> <br /></span></span><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">// TODO: check status<br /><br />// check the ownership.<span style="mso-spacerun: yes;">&#0160; </span>Give up after 120 seconds.                 <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">for</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> (<span style="color: #0000ff;"><span style="color: blue;">int</span></span> i = 0; i &lt; 12; i++)                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">{                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span>ownerhips = replSvc.GetOwnershipByEntityId(                 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;"><span style="color: blue;">new</span></span> <span style="color: #0000ff;"><span style="color: blue;">long</span></span>[] { file.MasterId});                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> <br />&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">if</span></span> (!ownerhips[0].IsLocalOwn)                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.Threading.<span style="color: #2b91af;"><span style="color: #2b91af;">Thread</span></span>.Sleep(10000);                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">else                    <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">break</span></span>;                 <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">}                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> <br />if</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> (!ownerhips[0].IsLocalOwn)                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #2b91af;"><span style="color: #2b91af;">MessageBox</span></span>.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Timeout expired&quot;</span></span>);                 <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">else                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160; </span><span style="color: #2b91af;"><span style="color: #2b91af;">MessageBox</span></span>.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Transfer complete&quot;</span></span>);</span></span></p>
</td>
</tr>
</tbody>
</table>
<table border="1" cellpadding="2" cellspacing="0" width="450">
<tbody>
<tr>
<td valign="top" width="450">
<p class="MsoNormal" style="line-height: normal; margin-bottom: 0pt; mso-layout-grid-align: none;"><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">status = replSvc.TransferEntityGroupOwnership(localWorkgroup.Id, <span style="color: #0000ff;"><span style="color: blue;">New</span></span> LongArray() {group}, 0)                <br /> <br /></span></span><span style="color: #008000; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: green; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">&#39; TOOD: check status<br /><br />&#39; check the ownership.<span style="mso-spacerun: yes;">&#0160; </span>Give up after 120 seconds.                 <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">For</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> i <span style="color: #0000ff;"><span style="color: blue;">As</span></span> <span style="color: #0000ff;"><span style="color: blue;">Integer</span></span> = 0 <span style="color: #0000ff;"><span style="color: blue;">To</span></span> 11                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span>ownerhips = replSvc.GetOwnershipByEntityId(<span style="color: #0000ff;"><span style="color: blue;">New</span></span> <span style="color: #0000ff;"><span style="color: blue;">Long</span></span>() {file.MasterId})                <br /> <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">If</span></span> <span style="color: #0000ff;"><span style="color: blue;">Not</span></span> ownerhips(0).IsLocalOwn <span style="color: #0000ff;"><span style="color: blue;">Then                   <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 2;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>System.Threading.Thread.Sleep(10000)                <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Else                   <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 2;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">Exit</span></span> <span style="color: #0000ff;"><span style="color: blue;">For                   <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000ff;"><span style="color: blue;">End</span></span> <span style="color: #0000ff;"><span style="color: blue;">If                   <br /></span></span></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Next               <br /> <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">If</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> <span style="color: #0000ff;"><span style="color: blue;">Not</span></span> ownerhips(0).IsLocalOwn <span style="color: #0000ff;"><span style="color: blue;">Then                   <br /></span></span></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span>MessageBox.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Timeout expired&quot;</span></span>)                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">Else               <br /></span></span><span style="font-family: Courier New; font-size: x-small;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"><span style="mso-tab-count: 1;">&#0160;&#0160;&#0160;&#0160;&#0160; </span>MessageBox.Show(<span style="color: #a31515;"><span style="color: #a31515;">&quot;Transfer complete&quot;</span></span>)                <br /></span></span><span style="color: #0000ff; font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; color: blue; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;">End</span></span><span style="font-family: Courier New; font-size: x-small;"><span style="line-height: 115%; font-family: &quot;Courier New&quot;; font-size: 10pt; mso-bidi-language: ar-sa; mso-no-proof: yes;"> <span style="color: #0000ff;"><span style="color: blue;">If</span></span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p>Note:&#0160; Make sure that your loop has an exit.&#0160; If the network goes down between the two workgroups, your program would be halted indefinitely.</p>
