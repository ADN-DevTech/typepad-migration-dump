<!DOCTYPE html>
<head>
  <!-- head-common-bootstrap-individual -->
     <meta charset="utf-8">
     <meta name="generator" content="http://www.typepad.com/" />
     <meta name="description" content="Sometimes you may need to know if a given material is used within the scene or not. In Compact Material Editor it is usually marked with the UI giving you certain clues. For example, in the screen capture below, the gray corners indicate the material is used in the scene...." />
     <link rel="canonical" href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene.html" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<meta property="og:title" content="How to properly check if a material is used in a scene?" />
<meta property="og:site_name" content="GetCOREInterface" />
<meta property="og:type" content="blog" />
<meta property="og:url" content="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene.html" />
<meta property="og:description" content="Sometimes you may need to know if a given material is used within the scene or not. In Compact Material Editor it is usually marked with the UI giving you certain clues. For example, in the screen capture below, the gray corners indicate the material is used in the scene...." />
<meta property="fb:admins" content="" />
<meta property="fb:app_id" content="55753818692" /><meta property="og:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb0974d5ca970d-600wi" />
<meta property="og:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb098f042b970d-600wi" />
<meta property="og:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01b8d25bfecf970c-600wi" />



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="">
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="How to properly check if a material is used in a scene?">
<meta name="twitter:description" content="Sometimes you may need to know if a given material is used within the scene or not. In Compact Material Editor it is usually marked with the UI giving you certain clues. For example, in the screen capture below, the gray corners indicate the material is used in the scene...."><meta name="twitter:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb0974d5ca970d-600wi" />
<meta name="twitter:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb098f042b970d-600wi" />
<meta name="twitter:image" content="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01b8d25bfecf970c-600wi" />



     <!-- Custom fonts for this template -->

    <!-- Bootstrap core CSS -->
    <link href="/.shared/themes/common/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Bootstrap bridge -->
    <link href="/.shared/themes/common/bootstrap/css/bootstrap-bridge.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="https://getcoreinterface.typepad.com/blog/styles.css?v=6" type="text/css" media="screen" />
    <style>.navbar-header, .nav { display:block !important; }</style>

        <link rel="stylesheet" href="https://static.typepad.com/.shared/themes/common/print.css" type="text/css" media="print" />
        <link rel="alternate" type="application/atom+xml" title="Posts on 'GetCOREInterface' (Atom)" href="https://getcoreinterface.typepad.com/blog/atom.xml" />
        <link rel="alternate" type="application/rss+xml" title="Posts on 'GetCOREInterface' (RSS 1.0)" href="https://getcoreinterface.typepad.com/blog/index.rdf" />
        <link rel="alternate" type="application/rss+xml" title="Posts on 'GetCOREInterface' (RSS 2.0)" href="https://getcoreinterface.typepad.com/blog/rss.xml" />

    <script src="//code.jquery.com/jquery.js"></script>

        <script type="text/javascript">
                var TPApp = {};
                TPApp.app_uri = "https://www.typepad.com/";
        </script>
<!-- why does this load from prod? -->
        <script type="text/javascript" src="https://static.typepad.com/.shared/js/yui/yahoo-dom-event.js,/js/app/thumbnail-gallery-min.js,/js/app/flyouts-min.js"></script>

<!--- head google analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-225723-36', 'auto', {'name': 'Typepad'}, {'allowLinker': true} );  // Separate tracker for Typepad.
ga('Typepad.require', 'linker');
ga('Typepad.linker:autoLink', ['none']);
ga('Typepad.set', 'dimension1', '6a019104a31725970c019104a321e0970c');
ga('Typepad.set', 'dimension2', 'Individual');
ga('Typepad.send', 'pageview');
</script>



    <script type="text/javascript" src="//tags.tiqcdn.com/utag/autodesk/typepad/prod/utag.js"></script>


        <link rel="alternate" type="application/atom+xml" title="Comments on 'How to properly check if a material is used in a scene?' (Atom)" href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene/comments/atom.xml" />
        <link rel="alternate" type="application/rss+xml" title="Comments on 'How to properly check if a material is used in a scene?' (RSS 2.0)" href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene/comments/rss.xml" />
        <title>How to properly check if a material is used in a scene? - GetCOREInterface</title>
        <link rel="start" href="https://getcoreinterface.typepad.com/blog/" title="Home" />
        <link rel="prev" href="https://getcoreinterface.typepad.com/blog/2017/02/querying-the-3ds-max-version.html?no_prefetch=1" title="Querying the 3ds Max version" />
        <link rel="next" href="https://getcoreinterface.typepad.com/blog/2017/04/3ds-max-2018-sdk-changes.html?no_prefetch=1" title="3ds Max 2018 SDK Changes" />

    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
</head>



<body class="layout-two-column-right post">
	
	<div id="container" class="container">
		<div id="container-inner" class="pkg">
			
                <div class="row">
     


<a id="home"></a>
   

              <div id="banner" class="jumbotron">
                <h1><a href="https://getcoreinterface.typepad.com/blog/" accesskey="1">GetCOREInterface</a></h1>
                <h2>3ds Max customization, automation, plug-in development, and related ramblings!</h2>
              </div>

     
     
      <div id="autocollapse" class="navbar navbar-default navbar-fixed-top">

<div class="navbar-inner">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
          </button>
         <a class="navbar-brand" href="https://getcoreinterface.typepad.com/blog/">home</a>
        </div>

        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
<li><a href="https://getcoreinterface.typepad.com/blog/archives.html">archives</a></li>
<li><a href="https://getcoreinterface.typepad.com/blog/kevin-vandecar.html">profile</a></li>
<li><a href="https://getcoreinterface.typepad.com/blog/atom.xml">subscribe</a></li>
<li><a href="https://twitter.com/kevinvandecar">twitter</a></li>
<li><a href="http://area.autodesk.com/">area</a></li>
<li><a href="http://area.autodesk.com/forum/autodesk-3ds-max/programming">forum</a></li>
<li><a href="http://www.autodesk.com/me-sdk-docs">api docs</a></li>

          </ul><!-- end main navbar -->
        </div><!--/.nav-collapse-->
</div><!--/.navbar-inner-->

      </div><!--/.navbar-->

     



			<div id="pagebody">


				<div id="pagebody-inner" class="pkg">
                                        <div id="alpha" class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
						<div id="alpha-inner" class="pkg">
							<!-- the plain version removes the extra jquery -->
<!-- content nav -->
<p class="content-nav">
	<a class="content-nav-prev" href="https://getcoreinterface.typepad.com/blog/2017/02/querying-the-3ds-max-version.html">&laquo; Querying the 3ds Max version</a> |
	<a class="content-nav-main" href="https://getcoreinterface.typepad.com/blog/">Main</a>
	| <a class="content-nav-next" href="https://getcoreinterface.typepad.com/blog/2017/04/3ds-max-2018-sdk-changes.html">3ds Max 2018 SDK Changes &raquo;</a>
</p>
<script type="text/javascript">
   $(function(){
       var query = window.location.search.substring(1);
       if( query == "pintix=1" ) {
          var e=document.createElement('script');e.setAttribute('type','text/javascript');e.setAttribute('charset','UTF-8');e.setAttribute('src','https://static.typepad.com/.shared//js/pinmarklet.js?r='+Math.random()*99999999);document.body.appendChild(e);
       }
   });
</script>
<!-- entry -->

	<h2 class="date-header">04/10/2017</h2>


<div class="entry-category-c entry-category-debug entry-category-tiptrick entry-author-denis_grigor entry-type-post entry" id="entry-6a019104a31725970c01b8d25bff39970c">
   <div class="entry-inner">
			<h3 class="entry-header">How to properly check if a material is used in a scene?</h3>
	



	<div class="entry-content">
		<div class="entry-body">
			<p>Sometimes you may need to know if a given material is used within the scene or not. In Compact Material Editor it is usually marked with the UI giving you certain clues. For example, in the screen capture below, the gray corners indicate the material is used in the scene. Corners that are filled in white, indicate the material is used, and also is being used by a selected scene object. The white rectangle indicates it is the currently selected material.</p>
<p><a class="asset-img-link" href="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb0974d5ca970d-pi" style="display: inline;"><img alt="Image" border="0" class="asset  asset-image at-xid-6a019104a31725970c01bb0974d5ca970d img-responsive" src="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb0974d5ca970d-800wi" style="display: block; margin-left: auto; margin-right: auto;" title="Image" /></a></p>
<p>The same indicators are found in the Slate Material editor. They will display on the preview of the material.</p>
<p>&#0160;</p>
<p><a class="asset-img-link" href="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb098f042b970d-pi" style="display: inline;"><img alt="Image (2)" class="asset  asset-image at-xid-6a019104a31725970c01bb098f042b970d img-responsive" src="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01bb098f042b970d-500wi" style="display: block; margin-left: auto; margin-right: auto;" title="Image (2)" /></a></p>
<p>&#0160;</p>
<p>The obvious question now is how to retrieve this information using the C++ SDK? Let&#39;s take a look at how to do it.<br /> <br /> The very first step is to have a look at the <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_class_mtl_base_html">MtlBase class</a> where you will notice the<strong><em> int TestMtlFlag(int mask)</em></strong> that&#0160;<em>&quot;Tests the specified flags. Returns nonzero if the flags are set; otherwise zero”</em>&#0160;. Among the available <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_group__material_flags_html">Materials flags</a> we can notice the <em><strong>MTL_IN_SCENE&#0160;</strong></em>flag, that seems to be exactly what we need.<br /> <br /> Thus, to test if a material is used or not we can easily do:</p>
<div style="font-family: &#39;Roboto Condensed&#39;, Tauri, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, STHeiti, SimSun, &#39;Lucida Grande&#39;, &#39;Lucida Sans Unicode&#39;, &#39;Lucida Sans&#39;, &#39;Segoe UI&#39;, AppleSDGothicNeo-Medium, &#39;Malgun Gothic&#39;, Verdana, Tahoma, sans-serif; font-size: 15px; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 20px; background-color: #ffffff; color: #222222; line-height: 1.6; -webkit-font-smoothing: antialiased; background: #ffffff;">
<pre style="border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; border: 1px solid #cccccc; overflow: auto; padding: 0.5em; display: block; overflow-x: auto; color: #657b83; background: #fdf6e3;"><code class="cpp" data-origin="&lt;pre&gt;&lt;code class=&quot;cpp&quot;&gt;if(my_material-&amp;gt;TestMtlFlag(MTL_IN_SCENE))
{
    \\ It is used
}else
{
    \\it is not
}
&lt;/code&gt;&lt;/pre&gt;" style="border: 1px solid #cccccc; display: block; font-family: Consolas, Inconsolata, Courier, monospace; font-weight: bold; white-space: pre; margin: 0px 2px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; padding: 0px 5px; font-size: 1em; letter-spacing: -1px;"><span class="hljs-keyword" style="color: #859900;">if</span>(my_material-&gt;TestMtlFlag(MTL_IN_SCENE))
{
    \\ It is used
} <span class="hljs-keyword" style="color: #859900;">else</span>
{
    \\it is not
}
</code></pre>
</div>
<p>Hurrah! Job is done, let&#39;s go home.<br /> <br /> Not so fast.<br /> <br />The <strong>MTL_IN_SCENE</strong> flag is useful only if somebody sets this flag (calling <em>MtlBase::SetMtlFlag</em>), but it turns out that nobody sets this specific flag, like ever. Thus, it will always return 0, no matter what, and even if you have assigned this material to dozens of objects in the scene, it is never accurate, unless someone sets it (maybe you set it in your plugin, but is seems none of the default materials are doing this.)<br /> <br /> Other <em>(Materials)</em> flags seems to be working fine, thus being useful, but not this one. So, let&#39;s get back to work.<br /> <br /> This question is not new, and there are lot of <em>(mostly MAXScript)</em> recipes on how to check whenever a given material is used somewhere in the scene, and the common algorithm is to get the scene materials and check if the material in question is found among them.<br /> <br /> That should be piece of cake, as the <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_class_interface_html">Interface Class</a> offers us the <strong><em>GetSceneMtls</em></strong> method, and the returned <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_class_mtl_base_lib_html">MtlBaseLib</a> has the handy <em><strong>FindMaterial</strong></em> method for finding a material by name:</p>
<div style="font-family: &#39;Roboto Condensed&#39;, Tauri, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, STHeiti, SimSun, &#39;Lucida Grande&#39;, &#39;Lucida Sans Unicode&#39;, &#39;Lucida Sans&#39;, &#39;Segoe UI&#39;, AppleSDGothicNeo-Medium, &#39;Malgun Gothic&#39;, Verdana, Tahoma, sans-serif; font-size: 15px; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 20px; background-color: #ffffff; color: #222222; line-height: 1.6; -webkit-font-smoothing: antialiased; background: #ffffff;">
<pre style="border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; border: 1px solid #cccccc; overflow: auto; padding: 0.5em; display: block; overflow-x: auto; color: #657b83; background: #fdf6e3;"><code class="cpp" data-origin="&lt;pre&gt;&lt;code class=&quot;cpp&quot;&gt;bool materialIsUsed(MtlBase* this_material)
{
   MtlBaseLib* scene_materials = GetCOREInterface()-&amp;gt;GetSceneMtls();

   return (scene_materials-&amp;gt;FindMtl(this_material) != -1) ? true : false;
}
&lt;/code&gt;&lt;/pre&gt;" style="border: 1px solid #cccccc; display: block; font-family: Consolas, Inconsolata, Courier, monospace; font-weight: bold; white-space: pre; margin: 0px 2px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; padding: 0px 5px; font-size: 1em; letter-spacing: -1px;"><span class="hljs-function"><span class="hljs-keyword" style="color: #859900;">bool</span> <span class="hljs-title" style="color: #268bd2;">materialIsUsed</span><span class="hljs-params">(MtlBase* this_material)</span>
</span>{
   MtlBaseLib* scene_materials = GetCOREInterface()-&gt;GetSceneMtls();

   <span class="hljs-keyword" style="color: #859900;">return</span> (scene_materials-&gt;FindMtl(this_material) != -<span class="hljs-number" style="color: #2aa198;">1</span>) ? <span class="hljs-keyword" style="color: #859900;">true</span> : <span class="hljs-keyword" style="color: #859900;">false</span>;
}
</code></pre>
</div>
<p>Easy say, easy do - can we go home now?<br />Not yet ... not yet ...<br /> <br />It turns out that this approach is not very reliable <em>(noticed by many developers)</em>, and the reason is that there is no dynamic tracking of the materials in the scene, thus the material library returned by the<em><strong> Interface::GetSceneMtls</strong></em> might not contain the latest information.<br /> <br /> There is a way to manually reset and rebuilding the scene lib, but unfortunately it is available <u>only</u> in MAXScript as ‘<strong><em>UpdateSceneMaterialLib()</em></strong>’method, and there is not yet a C++ SDK equivalent.<br /> <br /> <em>&quot;So, what it is the big deal? We can execute MAXScript from C++, we can live with that.&quot;</em><br /> <br /> Well ... there is yet another problem.<br /> <br /> If the material in question is a part of a sub-material, then you can check in the scene materials lib whenever you want, it will not show up, because <em>(in a manner of speaking)</em> it contains only the “first level” materials and will not contain the materials that are part/contained in other materials (g.e. multi-material).<br /> <br /> <em>“Then, what could be the solution?”</em><br /> <br /> The solution is given us by the <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__files_GUID_C11C8544_C5D5_4BA4_81A7_B00E8F508A03_htm">Reference System</a>, because if we look at MtlBase inheritance diagram:</p>
<p><a class="asset-img-link" href="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01b8d25bfecf970c-pi" style="display: inline;"><img alt="Image (1)" border="0" class="asset  asset-image at-xid-6a019104a31725970c01b8d25bfecf970c img-responsive" src="https://getcoreinterface.typepad.com/.a/6a019104a31725970c01b8d25bfecf970c-800wi" style="display: block; margin-left: auto; margin-right: auto;" title="Image (1)" /></a></p>
<p>we notice the obvious aspect, that any material <em>(like many other classes in 3ds Max SDK)</em> is also a <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_class_reference_target_html">Reference Target</a>. <br /> <br /> This is obvious, because logically, a material has to have dependents, that are notified upon change <em>(i.e. change the diffuse color)</em>.<br /> <br /> Thus, what is left is to iterate through these dependents, using the dedicated <a href="http://help.autodesk.com/view/3DSMAX/2017/ENU/?guid=__cpp_ref_class_dependent_iterator_html">DependentIterator Class</a> and recursively check the dependents.<br /> <br /> Easy say, but not so obviously done:</p>
<div style="font-family: &#39;Roboto Condensed&#39;, Tauri, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, STHeiti, SimSun, &#39;Lucida Grande&#39;, &#39;Lucida Sans Unicode&#39;, &#39;Lucida Sans&#39;, &#39;Segoe UI&#39;, AppleSDGothicNeo-Medium, &#39;Malgun Gothic&#39;, Verdana, Tahoma, sans-serif; font-size: 15px; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 20px; background-color: #ffffff; color: #222222; line-height: 1.6; -webkit-font-smoothing: antialiased; background: #ffffff;">
<pre style="border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; border: 1px solid #cccccc; overflow: auto; padding: 0.5em; display: block; overflow-x: auto; color: #657b83; background: #fdf6e3;"><code class="cpp" data-origin="&lt;pre&gt;&lt;code class=&quot;cpp&quot;&gt;static bool  isNodeInScene(INode* node)
{
       for (INode* par = node-&amp;gt;GetParentNode();
              par != nullptr;
              node = par, par = node-&amp;gt;GetParentNode()) {
       }
       return node == GetCOREInterface()-&amp;gt;GetRootNode();
}

 static bool isUsedInScene(ReferenceTarget *mt)
{
       DependentIterator di(mt);
       RefMakerHandle rm;

       if (mt-&amp;gt;SuperClassID() == BASENODE_CLASS_ID) {
              return isNodeInScene(static_castINode*&amp;gt;(mt));
       }

       while ((rm = di.Next()) != NULL) {
              if (rm != mt &amp;amp;&amp;amp; rm-&amp;gt;IsRefTarget()
                     &amp;amp;&amp;amp; isUsedInScene(static_castReferenceTarget*&amp;gt;(rm)))
                     return true;
       }
       return false;
}
&lt;/code&gt;&lt;/pre&gt;" style="border: 1px solid #cccccc; display: block; font-family: Consolas, Inconsolata, Courier, monospace; font-weight: bold; white-space: pre; margin: 0px 2px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; padding: 0px 5px; font-size: 1em; letter-spacing: -1px;"><span class="hljs-function"><span class="hljs-keyword" style="color: #859900;">static</span> <span class="hljs-keyword" style="color: #859900;">bool</span>  <span class="hljs-title" style="color: #268bd2;">isNodeInScene</span><span class="hljs-params">(INode* node)</span>
</span>{
       <span class="hljs-keyword" style="color: #859900;">for</span> (INode* par = node-&gt;GetParentNode();
              par != <span class="hljs-keyword" style="color: #859900;">nullptr</span>;
              node = par, par = node-&gt;GetParentNode()) {
       }
       <span class="hljs-keyword" style="color: #859900;">return</span> node == GetCOREInterface()-&gt;GetRootNode();
}

 <span class="hljs-function"><span class="hljs-keyword" style="color: #859900;">static</span> <span class="hljs-keyword" style="color: #859900;">bool</span> <span class="hljs-title" style="color: #268bd2;">isUsedInScene</span><span class="hljs-params">(ReferenceTarget *mt)</span>
</span>{
       <span class="hljs-function">DependentIterator <span class="hljs-title" style="color: #268bd2;">di</span><span class="hljs-params">(mt)</span></span>;
       RefMakerHandle rm;

       <span class="hljs-keyword" style="color: #859900;">if</span> (mt-&gt;SuperClassID() == BASENODE_CLASS_ID) {
              <span class="hljs-keyword" style="color: #859900;">return</span> isNodeInScene(static_castINode*&gt;(mt));
       }

       <span class="hljs-keyword" style="color: #859900;">while</span> ((rm = di.Next()) != NULL) {
              <span class="hljs-keyword" style="color: #859900;">if</span> (rm != mt &amp;&amp; rm-&gt;IsRefTarget()
                     &amp;&amp; isUsedInScene(static_castReferenceTarget*&gt;(rm)))
                     <span class="hljs-keyword" style="color: #859900;">return</span> <span class="hljs-keyword" style="color: #859900;">true</span>;
       }
       <span class="hljs-keyword" style="color: #859900;">return</span> <span class="hljs-keyword" style="color: #859900;">false</span>;
}
</code></pre>
</div>
<p>Thus, to check if a given material is used in the scene or not, it suffice to call:</p>
<div style="font-family: &#39;Roboto Condensed&#39;, Tauri, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, STHeiti, SimSun, &#39;Lucida Grande&#39;, &#39;Lucida Sans Unicode&#39;, &#39;Lucida Sans&#39;, &#39;Segoe UI&#39;, AppleSDGothicNeo-Medium, &#39;Malgun Gothic&#39;, Verdana, Tahoma, sans-serif; font-size: 15px; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 20px; background-color: #ffffff; color: #222222; line-height: 1.6; -webkit-font-smoothing: antialiased; background: #ffffff;">
<pre style="border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; border: 1px solid #cccccc; overflow: auto; padding: 0.5em; display: block; overflow-x: auto; color: #657b83; background: #fdf6e3;"><code class="cpp" data-origin="&lt;pre&gt;&lt;code class=&quot;cpp&quot;&gt;if(isUsedInScene(my_material))
{
    \\ It is used
}else
{
    \\it is not
}
&lt;/code&gt;&lt;/pre&gt;" style="border: 1px solid #cccccc; display: block; font-family: Consolas, Inconsolata, Courier, monospace; font-weight: bold; white-space: pre; margin: 0px 2px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: break-word; padding: 0px 5px; font-size: 1em; letter-spacing: -1px;"><span class="hljs-keyword" style="color: #859900;">if</span>(isUsedInScene(my_material))
{
    \\ It is used
}<span class="hljs-keyword" style="color: #859900;">else</span>
{
    \\it is not
}
</code></pre>
</div>
<p>and the cool thing with this approach is that <em>(I guess you already noticed)</em> it can be used with anything that is “referable” <em>(i.e. is a ReferenceTarget)</em>, and that could be more interesting than just for materials.</p>
		</div>
		

                        <!-- SIGNATURE -->
                        

		
	</div>

	<div class="entry-footer">
			<p class="entry-footer-info">
				<span class="post-footers">Posted by <a rel="author" href="https://profile.typepad.com/6p01b8d176f91e970c">Denis Grigor</a> at 03:32 PM in <a href="https://getcoreinterface.typepad.com/blog/c/">C++</a>, <a href="https://getcoreinterface.typepad.com/blog/debug/">debug</a>, <a href="https://getcoreinterface.typepad.com/blog/tiptrick/">Tip/Trick</a> </span> <span class="separator">|</span> <a class="permalink" href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene.html">Permalink</a>
			</p>
		
		<!-- technorati tags -->


		<!-- post footer links -->
	<p class="entry-footer-share entry-footer-share-buttons">
		<span class="entry-footer-links-twitter">
     <a href="https://twitter.com/share?url=https%3A%2F%2Fgetcoreinterface.typepad.com%2Fblog%2F2017%2F04%2Fhow-to-properly-check-if-a-material-is-used-in-a-scene.html&text=How%20to%20properly%20check%20if%20a%20..." target="_blank"><img src="/.shared/images/circle-twitter.png" alt="Twitter" /></a>
</span>
	</p>


	</div>
   </div>
</div>



        
        
        <a id="comments"></a>
	<div class="comments" id="all-comments">
		<h3 class="comments-header">Comments</h3>
					<div class="comments-info">
				<p><a href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene/comments/atom.xml"><img src="https://static.typepad.com/.shared/images/feed.png" alt="Feed" width="10" height="10" /></a> You can follow this conversation by subscribing to the <a href="https://getcoreinterface.typepad.com/blog/2017/04/how-to-properly-check-if-a-material-is-used-in-a-scene/comments/atom.xml">comment feed</a> for this post.</p>
			</div>
		
		<div class="comments-content" id="comments-content">
                <!-- comment list -->

		</div>
        
	</div>
<script type="text/javascript">var c943723d42e77e9214eb884a1d898ea="</form>";</script>
<script type="text/javascript">var ffe51c373e0873b7778b6324a0b5533 = '<form id="comment-form" action="';</script>
<script type="text/javascript">var c943723d42e77e9214eb884a1d898za = '" method="post"><input type="hidden" name="entry_xid" id="comment-entry-xid" value="6a019104a31725970c01b8d25bff39970c" \/><input type="hidden" name="token" value="1756834710-126d2638efd41b9b1b97db30a9726e17aa83967a:megRNFOQ9EGhmARI" \/>';</script>
<script type="text/javascript">var OOcd55d4dc47109d7b462b01c7dd4dab = "aHR0cHM6Ly9nZXRjb3JlaW50ZXJmYWNlLnR5cGVwYWQuY29tLy5zZXJ2aWNlcy9jb21tZW50cw";</script>
<script type="text/javascript">var bad4dd7c10b264b7d90174cd4d55dc00 = atob(OOcd55d4dc47109d7b462b01c7dd4dab);</script>

<!-- comment-form-atp -->


<p class="comments-closed font-entrybody">
	The comments to this entry are closed.
</p>





    
    




						</div>
					</div>
                                        <div id="beta" class="well col-xs-12 col-sm-4 col-md-4 col-lg-4">
						<div id="beta-inner" class="pkg">
							
<!-- sidebar -->


	<div class="module-archives module">
		<h2 class="module-header"><a href="https://getcoreinterface.typepad.com/blog/archives.html">Archives</a></h2>
		<div class="module-content">
												<ul class="module-list">
				
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2025/05/index.html">May 2025</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2024/01/index.html">January 2024</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/06/index.html">June 2023</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/04/index.html">April 2023</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/02/index.html">February 2023</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/01/index.html">January 2023</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2022/04/index.html">April 2022</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2021/05/index.html">May 2021</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2021/04/index.html">April 2021</a></li>
				
							
				<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2020/05/index.html">May 2020</a></li>
									</ul>
									<p class="module-more"><a href="https://getcoreinterface.typepad.com/blog/archives.html">More...</a></p>
				
				
			
		</div>
	</div>

<!-- list_inlcude.tt  -->
<div id="about" class="module-typelist module">
<h2 class="module-header">About</h2>
	<div class="typelist-plain module-content">
		<ul class="module-list">
							<li class="module-list-item"><div class="typelist-note"><table> <tr> 
	<td> 
	<a href="https://getcoreinterface.typepad.com/blog/kevin-vandecar.html"> <img src="https://getcoreinterface.typepad.com/blog/KDV_Fall_Color_100.jpg"></a> <a href="https://getcoreinterface.typepad.com/blog/kevin-vandecar.html">Kevin Vandecar</a> <br> <br> 
	<a href="https://getcoreinterface.typepad.com/blog/denis-grigor.html"> <img src="https://getcoreinterface.typepad.com/blog/denis_grigor.jpg"></a> 
	<a href="https://getcoreinterface.typepad.com/blog/denis-grigor.html">Denis Grigor</a> <br> <br> 
	<a href="https://getcoreinterface.typepad.com/blog/allan-koech.html"> <img src="https://getcoreinterface.typepad.com/blog/allan-koech.jpg"></a> 
	<a href="https://getcoreinterface.typepad.com/blog/allan-koech.html">Allan Koech</a> 

	</td> </tr> </table> 
	
	<br> <a href="http://www.autodesk.com/joinadn" title="Information on the Autodesk Developer Network"> <img src="https://getcoreinterface.typepad.com/blog/join_adn.png" border="0" /> </a> <link rel="icon" href="/favicon.ico" type="image/x-icon" /> <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /> <link rel="icon" type="image/gif" href="/favicon.gif" /> <meta name="application-name" content="GetCOREInterface" /> <meta name="msapplication-tooltip" content="Open GetCOREInterface blog" /> <meta name="msapplication-starturl" content="http://getcoreinterface.typepad.com" /> <meta name="msapplication-window" content="width=1024;height=768" /> <meta name="msapplication-navbutton-color" content="#000000" /> <meta name="msapplication-task" content="name=Search TtIf;action-uri=http://www.google.com/search?btnG=%C2%BB&domains=getcoreinterface.typepad.com&sitesearch=getcoreinterface.typepad.com;icon-uri=http://google.com/favicon.ico" /></div></li>
			
		</ul><!-- last /ul -->
	</div>
</div>
<!-- end list_include.tt -->

<!-- list_inlcude.tt  -->
<div id="google_search" class="module-typelist module">
<h2 class="module-header">Google Search</h2>
	<div class="typelist-plain module-content">
		<ul class="module-list">
							<li class="module-list-item"><div class="typelist-note"><script>
  (function() {
    var cx = '001717393972716514223:-ybiyil2pts';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search></div></li>
			
		</ul><!-- last /ul -->
	</div>
</div>
<!-- end list_include.tt -->

<!-- list_inlcude.tt  -->
<div id="translate" class="module-typelist module">
<h2 class="module-header">Translate</h2>
	<div class="typelist-plain module-content">
		<ul class="module-list">
							<li class="module-list-item"><div class="typelist-note"><div id='MicrosoftTranslatorWidget' class='Dark' style='color:white;background-color:#555555'>
</div>
<script type='text/javascript'>setTimeout(function(){{var s=document.createElement('script');s.type='text/javascript';s.charset='UTF-8';s.src=((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=ueOIGRSKkd965FeEGM5JtQ**&ctf=True&ui=true&settings=Manual&from=en';var p=document.getElementsByTagName('head')[0]||document.documentElement;p.insertBefore(s,p.firstChild); }},0);</script>
</div></li>
			
		</ul><!-- last /ul -->
	</div>
</div>
<!-- end list_include.tt -->

<div class="module-calendar module">
	<h2 class="module-header">May 2025</h2>
	<div class="module-content table-responsive">
		<table class="table" summary="Monthly calendar with links to each day's posts">
                        <tr>
                                                                 <th>Sun</th>
                                                                 <th>Mon</th>
                                                                 <th>Tue</th>
                                                                 <th>Wed</th>
                                                                 <th>Thu</th>
                                                                 <th>Fri</th>
                                                                 <th>Sat</th>
                                
                        </tr>
                                                   <tr>
                                        <td>&nbsp;</td>
                                
                                                   
                                        <td>&nbsp;</td>
                                
                                                   
                                        <td>&nbsp;</td>
                                
                                                   
                                        <td>&nbsp;</td>
                                
                                                   
                                        <td>1</td>
                                
                                                   
                                        <td>2</td>
                                
                                                   
                                        <td>3</td>
                                </tr>
                                                   <tr>
                                        <td>4</td>
                                
                                                   
                                        <td>5</td>
                                
                                                   
                                        <td>6</td>
                                
                                                   
                                        <td>7</td>
                                
                                                   
                                        <td>8</td>
                                
                                                   
                                        <td>9</td>
                                
                                                   
                                        <td>10</td>
                                </tr>
                                                   <tr>
                                        <td>11</td>
                                
                                                   
                                        <td>12</td>
                                
                                                   
                                        <td>13</td>
                                
                                                   
                                        <td>14</td>
                                
                                                   
                                        <td>15</td>
                                
                                                   
                                        <td>16</td>
                                
                                                   
                                        <td>17</td>
                                </tr>
                                                   <tr>
                                        <td>18</td>
                                
                                                   
                                        <td>19</td>
                                
                                                   
                                        <td>20</td>
                                
                                                   
                                        <td>21</td>
                                
                                                   
                                        <td>22</td>
                                
                                                   
                                        <td>23</td>
                                
                                                   
                                        <td>24</td>
                                </tr>
                                                   <tr>
                                        <td>25</td>
                                
                                                   
                                        <td>26</td>
                                
                                                   
                                        <td>27</td>
                                
                                                   
                                        <td><a href="https://getcoreinterface.typepad.com/blog/2025/05/whats-new-in-3ds-max-2026.html">28</a></td>
                                
                                                   
                                        <td>29</td>
                                
                                                   
                                        <td><a href="https://getcoreinterface.typepad.com/blog/2025/05/upgrading-3ds-max-net-projects-from-net-framework-to-net-8.html">30</a></td>
                                
                                                   
                                        <td>31</td>
                                </tr>
                        
		</table>
	</div>
</div>
<!-- list_inlcude.tt  -->
<div id="rss_feed" class="module-typelist module">
<h2 class="module-header">RSS Feed</h2>
	<div class="typelist-plain module-content">
		<ul class="module-list">
							<li class="module-list-item"><div class="typelist-note"><a href="http://feeds.feedburner.com/autodesk/GetCoreInterface"><img src="https://getcoreinterface.typepad.com/feed.png" border="0" align="absmiddle">
&nbsp;Subscribe</a></div></li>
			
		</ul><!-- last /ul -->
	</div>
</div>
<!-- end list_include.tt -->

<div class="module-search module">
    <h2 class="module-header">Search</h2>
    <div class="module-content">
        <form id="search-blog" method="get" action="https://getcoreinterface.typepad.com/.services/blog/6a019104a31725970c019104a321e0970c/search" class="form-search form-inline" role="search">
            
<div class="form-group"><input type="search" name="filter.q" results="5" value="" class="form-control" placeholder="Search" /></div><button type="submit" value="Search" class="btn btn-default">Submit</button>

        </form>
    </div>
</div>
<!-- END Blog Search Module -->
	<div class="module-archives module">
		<h2 class="module-header">Recent Posts</h2>
		<div class="module-content">
			<ul class="module-list">
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2025/05/upgrading-3ds-max-net-projects-from-net-framework-to-net-8.html">Upgrading 3ds Max .NET projects from .NET Framework to .NET 8</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2025/05/whats-new-in-3ds-max-2026.html">What's new in 3ds Max 2026?</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2025/05/porting-plugins-from-3ds-max-2024-to-3ds-max-2025.html">Porting Plugins from 3ds Max 2024 to 3ds Max 2025</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2024/01/saving-qwidget-docking-states-per-3ds-max-scene.html">Saving QWidget Docking States per 3ds Max Scene</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/06/porting-maxplus-to-pymxs-what-you-need-to-know-1.html">Porting MaxPlus to pymxs - What you need to know</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/04/3ds-max-2024-released.html">3ds Max 2024 Released!</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/02/learning-3ds-max-sdk-my-journey.html">Learning 3ds Max SDK - My Journey</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2023/01/custom-valuetype-maxscript.html">MAXScript Custom Value Types from 3ds MAX SDK</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2022/04/3ds-max-2023-released.html">3ds Max 2023 Released!</a></li>
					
				
									<li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/2021/05/tips-for-troubleshooting-visual-studio-output-and-getting-qt-to-work-with-3ds-max-sdk.html">Tips for troubleshooting Visual Studio output and getting Qt to work with 3ds Max SDK</a></li>
					
				
			</ul>
		</div>
	</div>
<div class="module-categories module">
	<h2 class="module-header"><a href="https://getcoreinterface.typepad.com/blog/archives.html">Categories</a></h2>
	<div class="module-content">
                   <ul class="module-list">


                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/net-api/">.NET API <span class="category-count">(15)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/announcement/">Announcement <span class="category-count">(24)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/c/">C++ <span class="category-count">(21)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/cloud-service/">Cloud Service <span class="category-count">(4)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/cuiactioncommandadapter/">CuiActionCommandAdapter <span class="category-count">(4)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/debug/">debug <span class="category-count">(4)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/design-automation/">Design Automation <span class="category-count">(2)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/devdocs/">DevDocs <span class="category-count">(3)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/event/">Event <span class="category-count">(10)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/forge/">Forge <span class="category-count">(7)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/job/">job <span class="category-count">(2)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/maxscript/">MAXScript <span class="category-count">(11)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/open-position/">open position <span class="category-count">(1)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/python/">Python <span class="category-count">(8)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/qt/">qt <span class="category-count">(7)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/samples-1/">Samples <span class="category-count">(3)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/tiptrick/">Tip/Trick <span class="category-count">(10)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/training/">Training <span class="category-count">(4)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/webcast/">webcast <span class="category-count">(3)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/weblogs/">Weblogs <span class="category-count">(1)</span></a></li>



                        <li class="module-list-item"><a href="https://getcoreinterface.typepad.com/blog/wpf/">WPF <span class="category-count">(2)</span></a></li>
</span>
		</ul>

<a style="font-size:85%;display:none;" class="cat-more" href="https://getcoreinterface.typepad.com/blog/archives.html">See More</a>
	</div>
</div>





						</div>
					</div>
				</div>
			</div>
</div> <!-- row -->
			


<!-- container-footer -->
<div id="footer">
<div class="row well"><div class="col-md-12">
	<div id="footer-inner">
		<ul class="footer-list pkg list-inline" >
			<li class="last-footer-list-item footer-list-item"><a href="https://getcoreinterface.typepad.com/blog/">GetCOREInterface</a></li>
		</ul>
	</div>
</div></div>
</div>

		</div>
	</div>
	








    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="/.shared/themes/common/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
     function autocollapse() {
        var navbar = jQuery('#autocollapse'); navbar.removeClass('collapsed');
            if(navbar.innerHeight() > 50) {
               navbar.addClass('collapsed');
               $('.navbar button').css("visibility","visible");
             }
     }
autocollapse();

$('.navbar-nav,.navbar-header').fadeIn('slow');
jQuery(window).on('resize', autocollapse);
</script>





<script type="text/javascript">
function resizebanner() {
     var $div = $('#banner');
     bg = $div.css('background-image');
       if (bg) {
         var src = bg.replace(/(^url\()|(\)$|[\"\'])/g, '');
           $img = $('<img>').attr('src', src).on('load', function() {
              var img = new Image;
              img.src = src;
              var imgW = img.width;
              var imgH = img.height;             
              var newW = $('#banner').width();
              var newH = imgH / imgW * newW;
       $('#banner').height(newH);
       $('#banner').css('visibility', 'visible');
      });//end when loaded
  }//end if bg
}//end 
    (function($) {
       $(document).on('ready', resizebanner);
       $(window).on('resize', resizebanner);
    })(jQuery);
</script>



<script type="text/javascript">
<!--
var extra_happy = Math.floor(1000000000 * Math.random());
document.write('<img src="https://www.typepad.com/t/stats?blog_id=112876564355520268&amp;user_id=&amp;page=' + escape(location.href) + '&amp;referrer=' + escape(document.referrer) + '&amp;i=' + extra_happy + '" width="1" height="1" alt="" style="position: absolute; top: 0; left: 0;" />');
// -->
</script>




<!-- Begin disqus Tag -->

<!-- End disqus Tag -->
</body>
</html>

<!-- ph=1 -->
