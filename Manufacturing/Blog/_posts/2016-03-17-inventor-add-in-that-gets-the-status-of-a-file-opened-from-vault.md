---
layout: "post"
title: "Inventor Add-In that gets the status of a file opened from Vault"
date: "2016-03-17 11:58:17"
author: "Wayne Brill"
categories:
  - "Inventor"
  - "Vault"
  - "Wayne Brill"
original_url: "https://adndevblog.typepad.com/manufacturing/2016/03/inventor-add-in-that-gets-the-status-of-a-file-opened-from-vault.html "
typepad_basename: "inventor-add-in-that-gets-the-status-of-a-file-opened-from-vault"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/wayne-brill.html" target="_self">Wayne Brill</a></p>
<p>You may want to get the status of a file that was opened from Vault. See this <a href="http://justonesandzeros.typepad.com/blog/2013/08/getting-the-status-icon.html">blog post</a> for a discussion on a way to do this.</p>
<p>This Inventor 2016 AddIn example uses the <em>EntityStatusImageInfo</em> to get the status of the Inventor active document. The example is only getting the status of a part but could be enhanced to get other file types.&#0160; (The reason it is only working with parts is because the button is added to the &quot;PMxPartFeatureCmdBar&quot; command bar).</p>
<p>A form is used to display the image returned from this call.</p>
<p><em>EntityStatusImageInfo.GetImage()</em></p>
<p>The Graphics.DrawImage() of the Windows.Forms.PaintEventArgs passed into the Paint event for the form is used to show the image on the form.</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c825d92d970b-pi"><img alt="image" border="0" height="234" src="/assets/image_1f2f3f.jpg" style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="image" width="341" /></a></p>
<p>&#0160;</p>
<p>Download the Inventor Add-In (Visual Studio 2013 project)</p>
<p>&#0160; <span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d1b02b7f970c img-responsive"><a href="http://adndevblog.typepad.com/files/vault_lab_10_complete_addin_add_to_ribbon.zip">Download Vault_Lab_10_Complete_AddIn_Add_To_Ribbon</a></span></p>
<p>&#0160;</p>
<p>Click this button the Add-In adds to the ribbon to run the code.</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c825d932970b-pi"><img alt="image" border="0" height="176" src="/assets/image_5ab97e.jpg" style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="image" width="376" /></a></p>
<p>&#0160;</p>
<p>Here is the procedure that gets the vault connection, the name of the active document and then uses a FileIteration to get the status. The FileIteration object is returned by using the name of the document. (that code is not shown here).</p>
<p>&#0160;</p>
<div style="font-size: 10pt; font-family: consolas, &#39;Courier New&#39;, courier, monospace; color: #000; border: #000080 1px solid;">
<div style="overflow: auto; white-space: nowrap; color: #000000; max-height: 300px; background-color: #eeeeee; padding: 2px 5px 2px 5px;"><span style="color: #0000ff;">Public</span> <span style="color: #0000ff;">Sub</span> test_Vault()<br /><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> myConnection <span style="color: #0000ff;">As</span> VDF.Vault.Currency.Connections.<span style="color: #2b91af;">Connection</span> = <span style="color: #0000ff;">Nothing</span><br />&#0160;&#0160;&#0160; <span style="color: #008000;">&#39; Get the Vault connection from </span><br />&#0160;&#0160;&#0160; <span style="color: #008000;">&#39; the Inventor Vault log in</span><br />&#0160;&#0160;&#0160; myConnection =<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Connectivity.Application.VaultBase.<span style="color: #2b91af;">ConnectionManager</span>.Instance.Connection()<br /><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">If</span> myConnection <span style="color: #0000ff;">Is</span> <span style="color: #0000ff;">Nothing</span> <span style="color: #0000ff;">Then</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; System.Windows.Forms.<span style="color: #2b91af;">MessageBox</span>.Show _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (<span style="color: #a31515;">&quot;Unable to get Vault connection, logged into Vault?&quot;</span>)<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #008000;">&#39; Debug.Print(&quot;Unable to get Vault connection&quot;)</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Return</span><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">End</span> <span style="color: #0000ff;">If</span><br /><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">Try</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #008000;">&#39;Get the name of the Inventor active document</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> strFullNameOfDoc <span style="color: #0000ff;">As</span> <span style="color: #0000ff;">String</span> =<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_inventorApplication.ActiveDocument.FullFileName<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> strFileName <span style="color: #0000ff;">As</span> <span style="color: #0000ff;">String</span> = System.IO.<span style="color: #2b91af;">Path</span>.GetFileName(strFullNameOfDoc)<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> _FileIteration <span style="color: #0000ff;">As</span> VDF.Vault.Currency.Entities.<span style="color: #2b91af;">FileIteration</span> = <span style="color: #0000ff;">Nothing</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _FileIteration = getFileIteration(strFileName, myConnection)<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">If</span> <span style="color: #0000ff;">Not</span> _FileIteration <span style="color: #0000ff;">Is</span> <span style="color: #0000ff;">Nothing</span> <span style="color: #0000ff;">Then</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> props <span style="color: #0000ff;">As</span> <span style="color: #2b91af;">PropertyDefinitionDictionary</span> =<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; myConnection.PropertyManager.GetPropertyDefinitions _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (VDF.Vault.Currency.Entities.<span style="color: #2b91af;">EntityClassIds</span>.Files, _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Nothing</span>, <span style="color: #2b91af;">PropertyDefinitionFilter</span>.IncludeAll)<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> statusProp <span style="color: #0000ff;">As</span> <span style="color: #2b91af;">PropertyDefinition</span> =<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; props(<span style="color: #2b91af;">PropertyDefinitionIds</span>.<span style="color: #2b91af;">Client</span>.VaultStatus)<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> _status <span style="color: #0000ff;">As</span> <span style="color: #2b91af;">EntityStatusImageInfo</span> =<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">TryCast</span>(myConnection.PropertyManager.GetPropertyValue _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (_FileIteration, statusProp, <span style="color: #0000ff;">Nothing</span>), <span style="color: #2b91af;">EntityStatusImageInfo</span>)<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; System.Windows.Forms.<span style="color: #2b91af;">MessageBox</span>.Show _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (<span style="color: #a31515;">&quot;Status =&#0160;&#0160; &quot;</span> &amp; _status.Status.ToString())<br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _img = _status.GetImage()<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #008000;">&#39;Display a form that will show the Image</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Dim</span> _Frm <span style="color: #0000ff;">As</span> <span style="color: #2b91af;">Form1</span> = <span style="color: #0000ff;">New</span> <span style="color: #2b91af;">Form1</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _Frm.Show()<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">Else</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; System.Windows.Forms.<span style="color: #2b91af;">MessageBox</span>.Show _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (<span style="color: #a31515;">&quot;Did not find &quot;</span> &amp; strFileName &amp; <span style="color: #a31515;">&quot; in the vault&quot;</span>)<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">End</span> <span style="color: #0000ff;">If</span><br /><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">Catch</span> ex <span style="color: #0000ff;">As</span> System.<span style="color: #2b91af;">Exception</span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; System.Windows.Forms.<span style="color: #2b91af;">MessageBox</span>.Show(<span style="color: #a31515;">&quot;Error occurred:&#0160; &quot;</span> &amp; ex.ToString())<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #008000;">&#39;Debug.Print(&quot;unable to get Folder.&#0160; &quot; &amp; ex.ToString())</span><br /><br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">End</span> <span style="color: #0000ff;">Try</span><br /><br /><span style="color: #0000ff;">End</span> <span style="color: #0000ff;">Sub</span></div>
</div>
