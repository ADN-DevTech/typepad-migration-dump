---
layout: "post"
title: "Assigning a date-type property in C++"
date: "2012-07-30 07:42:50"
author: "Philippe Leefsma"
categories:
  - "Inventor"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/07/assigning-a-date-type-property-in-c.html "
typepad_basename: "assigning-a-date-type-property-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p><b>Q:</b></p>  <p>How to convert a FILETIME structure to a CComVariant object to be stored in any of the Inventor date-type Properties?</p>  <p><a name="section2"></a></p>  <p><b>A:</b></p>  <p>If you have a&#160; FILETIME structure and want to store its contents into one of the date-type Properties for example &quot;Creation Time&quot; Property of the &quot;Design Tracking Properties&quot; PropertySet,&#160; a COleDateTime object has to be used as an intermediate object of conversion. One of the constructors of the ColeDateTime class can take a FILETIME structure pointer. With the COleDateTime object created, this can be assigned to a CComVariant object. The CComVariant object can then be passed to the Property-&gt;PutValue method.</p>  <p>&#160;</p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">HRESULT AddDateProp(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;ApprenticeServerDocument&gt;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160; pApprenticeServerDocument)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>HRESULT hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Get property sets</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PropertySets&gt; pPropSets;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pApprenticeServerDocument-&gt;get_PropertySets(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;pPropSets);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New"></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr) </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Get &quot;Design Tracking Properties&quot; property set</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PropertySet&gt; pPropSet;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPropSets-&gt;get_Item(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>CComVariant(</font><span style="color: "><font color="#a31515">&quot;Design Tracking Properties&quot;</font></span><font color="#000000">),</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;pPropSet);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Get &quot;Creation Time&quot; property</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;Property&gt; pProp;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPropSet-&gt;get_Item(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CComVariant(</font><span style="color: "><font color="#a31515">&quot;Creation Time&quot;</font></span><font color="#000000">), &amp;pProp);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr) </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Creates FILETIME structure</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>FILETIME filetime;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>filetime.dwHighDateTime = 200;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>filetime.dwLowDateTime = 100;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Create a COleDateTime object </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="color: "><font color="#008000">&#160;&#160;&#160;&#160;&#160; // based on the FILETIME structure</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>COleDateTime newtime(filetime);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Put the value in the date-type Property</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pProp-&gt;put_Value(CComVariant(newtime));</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New"></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr) </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Save changes to the properties</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPropSets-&gt;FlushToFile();</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New"></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr) </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Close the Apprentice object</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pApprenticeServerDocument-&gt;Close();</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New"></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> FAILED(hr) </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">}</font></span></p>
