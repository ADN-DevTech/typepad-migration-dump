---
layout: "post"
title: "Notes for migrating C++ add-in to registry free"
date: "2012-10-10 01:30:55"
author: "Xiaodong Liang"
categories:
  - "Inventor"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/10/notes-for-migrating-c-add-in-to-registry-free.html "
typepad_basename: "notes-for-migrating-c-add-in-to-registry-free"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>More are more developers are migrating their add-in to registry-free. There is a post on the migration of .NET add-in: <a href="http://modthemachine.typepad.com/my_weblog/2012/02/migrate-net-add-ins-to-registry-free.html"><span style="color: #232323">&#0160;</span>Migrate .Net Add-Ins to registry free</a>. The basic steps are similar with C++ add-in. In this post, we will highlight some details which are C++ specific.</p>  <p>Assume you have a project created by the previous wizard. </p>  <p>1. remove the *.rgs file which is relevant with registry. <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e9365970b-pi"><img alt="image" border="0" height="351" src="/assets/image_bb646d.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="497" /></a> </p>  <p>2. comment out the codes for registry</p>  <p>&#0160;&#0160; - DllRegistryServer</p>  <p>&#0160;&#0160; - DllUnregistryServer&#0160; </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017ee4125c48970d-pi"><img alt="image" border="0" height="350" src="/assets/image_b75403.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="495" /></a> </p>  <p>&#0160;</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0c55970c-pi"><img alt="image" border="0" height="343" src="/assets/image_82853d.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="506" /></a> </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0c8d970c-pi"><img alt="image" border="0" height="218" src="/assets/image_fd19fc.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="492" /></a> </p>  <p>3. remove post-build events for registry.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e949c970b-pi"><img alt="image" border="0" height="250" src="/assets/image_d0315f.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="512" /></a> </p>  <p>4. make sure to enable “embed manifest”.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0cf8970c-pi"><img alt="image" border="0" height="208" src="/assets/image_66c606.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="515" /></a> </p>  <p>5. On some machine, it will need to disable UAC with the project.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0d36970c-pi"><img alt="image" border="0" height="192" src="/assets/image_383300.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="516" /></a> </p>  <p>6. Add manifest file and *.addin to the project. Here the template file for the two files are attached. Please firstly change the file name with your project name if you want to use them.</p>  <p><a href="http://adndevblog.typepad.com/files/cppsampletest.x.manifest">Download CPPSampleTest.X</a>&#0160;</p>  <p><a href="http://adndevblog.typepad.com/files/autodesk.cppsampletest.inventor.addin">Download Autodesk.CPPSampleTest.Inventor</a>&#0160;&#0160;&#0160;&#0160; </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0d5e970c-pi"><img alt="image" border="0" height="109" src="/assets/image_1f3630.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="519" /></a> </p>  <p>7. add the manifest file to the project</p>  <p>&#0160;&#0160; <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e9547970b-pi"><img alt="image" border="0" height="398" src="/assets/image_1da925.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="395" /></a> </p>  <p>&#0160;</p>  <p>8. Edit the manifest content according to the project information. <span style="color: #ff4040">Note: the format of manifest of C++ add-in is NOT same to .NET add-in. </span>With the template above, you will need to update:</p>  <p>- name: the project name    <br />- file name: the result dll name </p>  <p>&#0160;</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e9588970b-pi"><img alt="image" border="0" height="147" src="/assets/image_953708.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="469" /></a> </p> - clsid: this can be found at *.idl file of the project   <br />  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017ee4125e29970d-pi"><img alt="image" border="0" height="246" src="/assets/image_3bf60b.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="473" /></a> </p>  <p>- tlbid: this can be found at *.idl file of the project</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0e67970c-pi"><img alt="image" border="0" height="262" src="/assets/image_d8674e.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="470" /></a></p>  <p>&#0160;</p>  <p>After modification, the manifest becomes:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e9649970b-pi"><img alt="image" border="0" height="205" src="/assets/image_4f5e7a.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="464" /></a>&#0160; </p>  <p>9. edit the *.addin file with the corresponding information.</p>  <p>-ClassId    <br />-ClientId     <br />-DisplayName     <br />-Assembly:&#0160; absolute or relative path to indicate where the dll locates in    <br />- others options you want to change</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326e969e970b-pi"><img alt="image" border="0" height="238" src="/assets/image_a29ad5.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="473" /></a> </p>  <p>&#0160;</p>  <p>10. Build the project to see if there is any error. Next, copy the *.addin file to the specific path which Inventor will load add-in there. In this post, we put it to the %AppData%\Autodesk\ApplicationPlugins.</p>  <p>You can also add a script in post-build event to copy the *.addin file and *.dll to the specific path (if the *.addin file specifies to load the *.dll with relative path).</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0f36970c-pi"><img alt="image" border="0" height="130" src="/assets/image_fec6c2.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="494" /></a> </p>  <p>&#0160;</p>  <p>11. Now launch Inventor, it should load the add-in.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d0f6f970c-pi"><img alt="image" border="0" height="392" src="/assets/image_efe175.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="310" /></a></p>  <p>12.Known issues</p>  <p>&#0160; 1) remind again that the format of manifest of C++ is not same to .NET   <br />&#0160; 2) The newest add-in wizard will create registry-free add-in. If you speficied the RDS name, the result *.dll will contain the name. But the manifest file ignores RDS string. So please make sure the two are consistent. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c326ea8a8970b-pi"><img alt="image" border="0" height="249" src="/assets/image_f23968.jpg" style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" width="443" /></a> </p>  <p>3) In default, the add-in wizard will create the add-in using IDispatch interfaces. BUT such registry-free add-in cannot work on XP OS (no matter 32bit or 64bit). The add-in can be seen in Inventor, but it is not loaded. In addition, it will throw exception when debugging it. The workaround is to use Vtable interfaces. So if you have an existing add-in which uses IDispatch interfaces, you need to convert it to use Vtable interfaces for XP OS.</p>  <p>&#0160;</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3c9d200e970c-pi"><img alt="image" border="0" height="209" src="/assets/image_588718.jpg" style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" width="452" /></a></p>
