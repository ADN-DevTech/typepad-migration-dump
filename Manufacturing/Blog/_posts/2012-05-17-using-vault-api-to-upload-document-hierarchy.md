---
layout: "post"
title: "Using Vault API to Upload Document Hierarchy"
date: "2012-05-17 23:21:06"
author: "Barbara Han"
categories:
  - "Barbara Han"
  - "Vault"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/05/using-vault-api-to-upload-document-hierarchy.html "
typepad_basename: "using-vault-api-to-upload-document-hierarchy"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/barbara-han.html" target="_self">Barbara Han</a></p>
<p>Adding a single file to Vault through API is not complex. The complex part is to have uploaded files associated to each other as the hierarchy as present as they are open in CAD software, and items can be created properly when performing ‘assign item’. To achieve this goal, you need to perform the following steps:-    <br />1. Create a proper document hierarchy when adding files to the Vault. The parameter <em>associations </em>of the AddFile from DocumentService can be used for this.     <br />2. When adding files to Vault, its necessary to supply valid BOM data. Documents without BOM data are promoted to ‘Document’ items, instead of ‘Part’, ‘Assembly’.     <br />3. For part documents the BOM.CompArray should contain one element containing the following fields for &quot;this&quot; document - UniqueID (guid), CompTyp (Part), XRefId (-1), XRefTyp (internal).     <br />4. For assembly documents the BOM.CompArray should include information for &quot;this&quot; document plus some elements for child documents. The BOMComp for child information should containt UniqueID (same as UniqueID of the corresponding document), XrefId (File.Id of document), XrefTyp (external).     <br />5. For assembly documents the BOM.InstArray should be also filled. It should describe complete document hierarchy up to current level (children-parent relationship using indices to BOM.CompArray).     <br />6. When populating Vault, it’s necessary to start with leaf nodes (deepest children) and the continue with their parents and so on.     <br />7. Other BOM fields are optional, however in real cases BOM.PropArray, BOM.SchmArray and BOM.SchmOccArray would be also filled.     <br />&#0160; <br />If you use Assign Item for such documents, Vault will create assembly &amp; part items.&#0160; <br />&#0160;&#0160; <br />The sample application allows you create a hierarchy of any documents. They can be promoted to assembly &amp; part items. You can use any files - the entire hierarchy is built programmatically.</p>
<p><span class="asset  asset-generic at-xid-6a0167607c2431970b0163059ffc57970d"><a href="http://adndevblog.typepad.com/files/hierarchybuilder.zip">Download HierarchyBuilder</a></span></p>
<p><span class="asset  asset-generic at-xid-6a0167607c2431970b0163059ffc57970d"><a href="http://adndevblog.typepad.com/files/hierarchybuilder.zip"></a></span> <span class="asset  asset-generic at-xid-6a0167607c2431970b01676693d95f970b"><a href="http://adndevblog.typepad.com/files/dataset.zip">Download DataSet</a></span><br />How to use:     <br />1. Run the application.     <br />2. Connect to Vault.     <br />3. Use browse button to locate a Vault folder where the hierarchy should be uploaded.     <br />4. Move the cursor to the tree view area and press RMB (right mouse button), then select Add Item.     <br />5. Locate assembly.txt file from the sample data set (see Dataset.zip). It will add the new item to root of the tree.     <br />6. Select assembly.txt node, then use RMB again to build a tree hierarchy of files.     <br />7. When you&#39;re done with your hierarchy, click on the Upload button. It will add the files to the Vault.     <br />&#0160; <br />Notes:     <br />- Assumption is that files don&#39;t already exist in the Vault     <br />- The goal of the sample is to show how to set up a &quot;minimal&quot; BOM when building a hierarchy     <br />- The most important class is HierarchyItem, which handles document upload. It also builds BOM data for documents.</p>
