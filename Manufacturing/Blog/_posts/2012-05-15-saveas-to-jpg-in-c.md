---
layout: "post"
title: "SaveAs to jpg in C++"
date: "2012-05-15 23:05:35"
author: "Xiaodong Liang"
categories:
  - "Inventor"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/05/saveas-to-jpg-in-c.html "
typepad_basename: "saveas-to-jpg-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p> The demo code is as below. Please note: A BSTR cannot be directly assigned a string literal. A BSTR is a length prefixed Unicode string, so an assignment like this has virtually zero chance of marshaling across processes because the length prefix is completely arbitrary. The best way is to initialize the BSTR by CComBSTR.   <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> HRESULT test1()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{ </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; HRESULT hr = S_OK;</span><span style="line-height: 140%">&#160;&#160;&#160; </span>&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// assume we have got Inventor application&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// the code opens a part document and </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160; // saves it to a jpg file</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; CComPtr&lt;Documents&gt; pDocs;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; hr =m_pApplication-&gt;get_Documents(&amp;pDocs);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (FAILED(hr)) </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> hr;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; _bstr_t&#160; docName(</span><span style="line-height: 140%; color: #a31515">&quot;C:\\Part1.ipt&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; CComPtr&lt;Document&gt; pDoc;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; hr = pDocs-&gt;Open(docName,VARIANT_TRUE,&amp;pDoc);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (FAILED(hr)) </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> hr;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span>&#160;</p>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; CComBSTR sjpgname(L</span><span style="line-height: 140%; color: #a31515">&quot;C:\\Part1.ipt.jpg&quot;</span><span style="line-height: 140%">);</span></p>      <p style="margin: 0px"><span style="line-height: 140%"></span></p>   </div>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; hr = pDoc-&gt;SaveAs(sjpgname,VARIANT_TRUE);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (FAILED(hr)) </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> hr;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; hr = pDoc-&gt;Close(VARIANT_TRUE);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (FAILED(hr)) </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> hr;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
