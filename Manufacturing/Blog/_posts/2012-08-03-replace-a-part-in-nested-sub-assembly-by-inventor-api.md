---
layout: "post"
title: "Replace a Part in Nested Sub-assembly by Inventor API"
date: "2012-08-03 01:55:33"
author: "Barbara Han"
categories:
  - "Barbara Han"
  - "Inventor"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/08/replace-a-part-in-nested-sub-assembly-by-inventor-api.html "
typepad_basename: "replace-a-part-in-nested-sub-assembly-by-inventor-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/barbara-han.html" target="_self">Barbara Han</a></p>  <p>Assuming you have a assembly structure as shown below:</p>  <p>Main Assembly   <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; +---Part1    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ----sub-assembly    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; |    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; +---Part1</p>  <p>Now you want to replace part1.ipt in the sub-assembly by selecting it in the browser tree and then use the Replace command to replace it with Part2.ipt.&#160; <br />How can we do the replacing through code? First, you have to traverse the assembly tree and check whether an occurrence is the selected one; then get the parent occurrence of the selected occurrence, that will be the sub-assembly, then use the index to get the occurrence from the definition of the parent occurrence; finally call the ComponentOccurrence.Replace() method. </p>  <p>The following sample code shown below demonstrates this. To test the code you need to create a similar assembly structure.</p>  <p><strong>VBA code:</strong></p>  <p><font size="1" face="Courier New">Public Sub ReplacePart()     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; ' Get an occurrence from the select set.      <br />&#160;&#160;&#160; On Error Resume Next      <br />&#160;&#160;&#160; Dim oOccurrence As ComponentOccurrence      <br />&#160;&#160;&#160; Set oOccurrence = ThisApplication.ActiveDocument.SelectSet.Item(1)      <br />&#160;&#160;&#160; If Err Then      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;An occurrence must be selected.&quot;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Err.Clear      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; On Error GoTo 0      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub      <br />&#160;&#160;&#160; End If</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160; 'get the parent of this occurrence     <br />&#160;&#160;&#160; Dim oParentOcc As ComponentOccurrence      <br />&#160;&#160;&#160; Set oParentOcc = oOccurrence.ParentOccurrence      <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; ' Now get the selected occurrence in scope of parent definition      <br />&#160;&#160;&#160; ' Make sure you got parent occurrence</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160; If (Not oParentOcc Is Nothing) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Call getOccInScopeOfSubAsmDef(oParentOcc, oOccurrence)      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If (oOccurrence Is Nothing) Then      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If      <br />&#160;&#160;&#160; End If      <br />&#160;&#160;&#160; ' Now replace will work as desired      <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; On Error Resume Next      <br />&#160;&#160;&#160; oOccurrence.Replace &quot;d:\temp\replacetest\part2.ipt&quot;, False      <br />&#160;&#160;&#160; If Err Then      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Err.Clear      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; On Error GoTo 0      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;Failed to replace component&quot;      <br />&#160;&#160;&#160; End If      <br />End Sub</font></p>  <p><font size="1" face="Courier New">Private Sub getOccInScopeOfSubAsmDef(oParentOcc As ComponentOccurrence, ByRef oOccurrence As ComponentOccurrence)     <br />&#160;&#160;&#160; Dim indx As Integer      <br />&#160;&#160;&#160; indx = 1      <br />&#160;&#160;&#160; Dim bFound As Boolean      <br />&#160;&#160;&#160; bFound = False      <br />&#160;&#160;&#160; Dim oOcc As ComponentOccurrence      <br />&#160;&#160;&#160; For Each oOcc In oParentOcc.SubOccurrences      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If oOcc Is oOccurrence Then      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bFound = True      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit For      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; indx = indx + 1      <br />&#160;&#160;&#160; Next      <br />&#160;&#160;&#160; If (bFound) Then      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set oOccurrence = oParentOcc.Definition.Occurrences(indx)      <br />&#160;&#160;&#160; Else      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set oOccurrence = Nothing      <br />&#160;&#160;&#160; End If      <br />End Sub</font></p>  <p><strong>VB.NET code:</strong></p>  <p><font size="1" face="Courier New">public static void ReplacePart()     <br />{      <br />&#160;&#160;&#160; try      <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Inventor.Application app = (Inventor.Application)System.Runtime.InteropServices.Marshal.GetActiveObject(&quot;Inventor.Application&quot;);</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Get an occurrence from the select set.     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComponentOccurrence oOccurrence = app.ActiveDocument.SelectSet[1] as ComponentOccurrence;</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; //get the parent of this occurrence     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComponentOccurrence oParentOcc = oOccurrence.ParentOccurrence;</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; //Now get the selected occurrence in scope of parent definition      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Make sure you got parent occurrence      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (oParentOcc != null)      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; getOccInScopeOfSubAsmDef(oParentOcc, ref oOccurrence);</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (oOccurrence != null)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oOccurrence.Replace(&quot;c:\\temp\\replacetest\\part2.ipt&quot;, false);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160; }      <br />&#160;&#160;&#160; catch      <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160; }      <br />}      <br />public static void getOccInScopeOfSubAsmDef(ComponentOccurrence oParentOcc, ref ComponentOccurrence oOccurrence)      <br />{      <br />&#160;&#160;&#160; int indx = 1;      <br />&#160;&#160;&#160; bool bFound = false;</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160; foreach(ComponentOccurrence oOcc in oParentOcc.SubOccurrences)     <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(oOcc == oOccurrence)      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bFound = true;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; break;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; indx = indx + 1;     <br />&#160;&#160;&#160; }</font></p>  <p><font size="1" face="Courier New">&#160;&#160;&#160; if (bFound)     <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; oOccurrence = oParentOcc.Definition.Occurrences[indx];      <br />&#160;&#160;&#160; }      <br />&#160;&#160;&#160; else      <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; oOccurrence = null;      <br />&#160;&#160;&#160; }      <br />}</font></p>
