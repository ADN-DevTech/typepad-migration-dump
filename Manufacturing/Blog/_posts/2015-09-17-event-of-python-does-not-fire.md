---
layout: "post"
title: "Event of Python does not Fire"
date: "2015-09-17 07:46:01"
author: "Xiaodong Liang"
categories: []
original_url: "https://adndevblog.typepad.com/manufacturing/2015/09/event-of-python-does-not-fire.html "
typepad_basename: "event-of-python-does-not-fire"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><strong>Question</strong>:    <br />I created a script by JavaScript as below. It delegates the event workspaceActivated. It works well. When switching the workspace, the event will be fired.</p>  <table border="1" cellspacing="0" cellpadding="2" width="400"><tbody>     <tr>       <td valign="top" width="400">         <p> //define event handler            <br /> var MyWorkspaceActivatedHandler = function(args) {            <br />&#160;&#160;&#160;&#160;&#160; var ws = args.workspace;            <br />&#160;&#160;&#160;&#160;&#160; var app = adsk.core.Application.get();            <br />&#160;&#160;&#160;&#160;&#160; var ui&#160; = app.userInterface;            <br />&#160;&#160;&#160;&#160;&#160; ui.messageBox(â€œactive workspace is: (JavaScript).'             <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; +ws.name );&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; };            <br />&#160; <br />function run(context) {            <br />&#160;&#160;&#160;&#160;&#160; var app = adsk.core.Application.get();            <br />&#160;&#160;&#160;&#160;&#160; var ui = app.userInterface;            <br />&#160;&#160;&#160;&#160;&#160; //delegate the event with the handler            <br />&#160;&#160;&#160;&#160;&#160; ui.workspaceActivated.add(MyWorkspaceActivatedHandler);&#160; <br />&#160; }             <br />}             <br />&#160;</p>       </td>     </tr>   </tbody></table>  <p>But the similar code of Python does not work. It looks it successfully delegates the event, but the event is not fired when switching workspace.</p>  <table border="1" cellspacing="0" cellpadding="2" width="400"><tbody>     <tr>       <td valign="top" width="400">         <p>import adsk.core, adsk.fusion, traceback</p>          <p>#global event handlers           <br />handlers = []</p>          <p>#define event class           <br />class MyWorkspaceActivatedHandler(adsk.core.WorkspaceEventHandler):            <br />&#160;&#160;&#160;&#160;&#160; def __init__(self):            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; super().__init__()             <br />&#160;&#160;&#160;&#160;&#160; def notify(self, args):            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #fire for the event            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ws = args.workspace            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; app = adsk.core.Application.get()            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui&#160; = app.userInterface            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui.messageBox(' active workspace is: (Python).' + ws.name ) </p>          <p>def run(context):           <br />&#160;&#160;&#160; ui = None            <br />&#160;&#160;&#160; try:            <br />&#160;&#160;&#160;&#160;&#160;&#160; app = adsk.core.Application.get()            <br />&#160;&#160;&#160;&#160;&#160;&#160; ui&#160; = app.userInterface            <br />&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160; #delegate the event with the handlers            <br />&#160;&#160;&#160;&#160;&#160;&#160; onWorkspaceActivated = MyWorkspaceActivatedHandler()            <br />&#160;&#160;&#160;&#160;&#160;&#160; ui.workspaceActivated.add(onWorkspaceActivated)            <br />&#160;&#160;&#160;&#160;&#160;&#160; handlers.append(onWorkspaceActivated)&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160; except:            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if ui:            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui.messageBox('Failed:\n{}'.format(traceback.format_exc()))</p>       </td>     </tr>   </tbody></table>  <p><strong>Solution</strong>:</p>  <p>When the JavaScript code above runs, it connects the event and then continues to run in the background, allowing its handler to be called and respond to the event. But for a Python script (not an add-in) , it will automatically terminate when it runs. To allow the script to continue to run so it can react the event, adsk.autoTerminate(false) will need to call at the end of run fuction. The argument False indicates Fusion that the script should continue to run in the background.</p>  <table border="1" cellspacing="0" cellpadding="2" width="400"><tbody>     <tr>       <td valign="top" width="400">         <p>import adsk.core, adsk.fusion, traceback</p>          <p>#global event handlers           <br />handlers = []</p>          <p>#define event class           <br />class MyWorkspaceActivatedHandler(adsk.core.WorkspaceEventHandler):            <br />&#160;&#160;&#160;&#160;&#160; def __init__(self):            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; super().__init__()             <br />&#160;&#160;&#160;&#160;&#160; def notify(self, args):            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #fire for the event            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ws = args.workspace            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; app = adsk.core.Application.get()            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui&#160; = app.userInterface            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui.messageBox(' active workspace is: (Python).' + ws.name ) </p>          <p>def run(context):           <br />&#160;&#160;&#160; ui = None            <br />&#160;&#160;&#160; try:            <br />&#160;&#160;&#160;&#160;&#160;&#160; app = adsk.core.Application.get()            <br />&#160;&#160;&#160;&#160;&#160;&#160; ui&#160; = app.userInterface            <br />&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160; #delegate the event with the handlers            <br />&#160;&#160;&#160;&#160;&#160;&#160; onWorkspaceActivated = MyWorkspaceActivatedHandler()            <br />&#160;&#160;&#160;&#160;&#160;&#160; ui.workspaceActivated.add(onWorkspaceActivated)            <br />&#160;&#160;&#160;&#160;&#160;&#160; handlers.append(onWorkspaceActivated)             <br />&#160;&#160;&#160;&#160;&#160;&#160; <br /><font style="background-color: #ffff00">&#160;&#160;&#160;&#160;&#160;&#160; #if it is a script, call adsk.autoTerminate to indicate             <br />&#160;&#160;&#160;&#160;&#160;&#160; #Fusion to continue run the script.               <br />&#160;&#160;&#160;&#160;&#160;&#160; #if it is an add-in, this line is not required.               <br />&#160;&#160;&#160;&#160;&#160;&#160; adsk.autoTerminate(False)              <br /></font>&#160;&#160;&#160; except:            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if ui:            <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ui.messageBox('Failed:\n{}'.format(traceback.format_exc()))</p>       </td>     </tr>   </tbody></table>
