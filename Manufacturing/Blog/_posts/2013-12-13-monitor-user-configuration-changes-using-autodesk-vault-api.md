---
layout: "post"
title: "Monitor User Configuration Changes Using Autodesk Vault API"
date: "2013-12-13 01:43:38"
author: "Daniel Du"
categories:
  - "Daniel Du"
  - "Vault"
original_url: "https://adndevblog.typepad.com/manufacturing/2013/12/monitor-user-configuration-changes-using-autodesk-vault-api.html "
typepad_basename: "monitor-user-configuration-changes-using-autodesk-vault-api"
typepad_status: "Draft"
---

<pre>By <a href="http://adndevblog.typepad.com/manufacturing/Daniel-Du.html">Daniel Du</a></pre><pre>&nbsp;</pre>
<p>As you know, it is possbile to write event handler to customize the business logic. These handlers will receive notification whenever a Vault client on that machine does an action that you subscribed to. For example if a program tries to check in a file, your code can get notified of that action.&nbsp; Then you can proceed to block the operation or perform additional tasks.&nbsp; As demoed in the “RestrictOperations” sample in Vault SDK, many services provide many events which can be hooked to do customization. One user is asking how to monitor user configiruation changes, for example, When a new user is created and added to a group, or when a existing user's ACL has been modified, a email notification should be sent to administrator, or create a configuration changes log into database.
<p>It is natrual to look into AdminService or SecurtyService, expecting some specfic events like DocumentService, ItemService ,etc. Unfortunatly, AdminService or SecurtyService does not expose such specific events, but they do have some events:
<p>Public Event <strong>PostInvokeEvents</strong> Subscribe to this event to get a notification after every web service call.&nbsp; <br>Public Event <strong>PreInvokeEvents</strong>&nbsp;&nbsp; Subscribe to this event to get a notification before every web service call.&nbsp; <p>The event handler receives an argument of type WebServiceInvokeEventArgs containing data related to this event. The following WebServiceInvokeEventArgs properties provide information specific to this event.</p>
<table cellspacing="0" cellpadding="2" width="697" border="0">
<tbody>
<tr>
<td valign="top" width="200">MethodName</td>
<td valign="top" width="495">The name of the method being called.</td></tr>
<tr>
<td valign="top" width="200">Parameters</td>
<td valign="top" width="495">The method parameters</td></tr>
<tr>
<td valign="top" width="200">ReturnValue</td>
<td valign="top" width="495">The return values. The first element will be the standard return. Elements after are from [out] parameters.</td></tr></tbody></table>
<p>PostInvokeEvents will be triggered after every single service methods is call, PreInvokeEvents will be triggered before a service method is called. We can create our own event hander, in which we can check the MethodName so that we know which method is called, then take some necessory action to customize the business logic. 
<p>To monistor user related changes, we need to hook up AdminService.PreInvokeEvents or AdminService.PostInvokeEvents, for ACL changes, we need to hook up SecurityServices.PreInvokeEvents and SecurityService.PostInvokeEvents.
<p>Here is a sample :
<p></p>
<p></p><pre style="font-size: 13px; font-family: consolas; background: white; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//register events</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connection.WebServiceManager.AdminService.PreInvokeEvents += AdminService_PreInvokeEvents;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connection.WebServiceManager.AdminService.PostInvokeEvents += AdminService_PostInvokeEvents;<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; connection.WebServiceManager.SecurityService.PostInvokeEvents += SecurityService_PostInvokeEvents;</pre><pre>&nbsp;</pre><pre style="font-size: 13px; font-family: consolas; background: white; color: black">&nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> SecurityService_PostInvokeEvents(<span style="color: blue">object</span> sender, <span style="color: #2b91af">WebServiceInvokeEventArgs</span> e)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">//do something according to e.MethodName </span><br>&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> AdminService_PostInvokeEvents(<span style="color: blue">object</span> sender, <span style="color: #2b91af">WebServiceInvokeEventArgs</span> e)<br>&nbsp;&nbsp;&nbsp; {<br> <br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> para = <span style="color: #a31515">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; e.Parameters.Length; i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; para += e.Parameters[i].ToString() + <span style="color: #a31515">"\n"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> msg = <span style="color: #a31515">"MethodName : "</span> + e.MethodName + <span style="color: #a31515">"\n"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + <span style="color: #a31515">"Parameters :"</span> + para + <span style="color: #a31515">"\n"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + <span style="color: #a31515">"ReturnValue :"</span> + e.ReturnValue + <span style="color: #a31515">"\n"</span>;<br> <br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">MessageBox</span>.Show(msg + <span style="color: #a31515">" Excution complete"</span>);<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// if a new use added</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (e.MethodName == <span style="color: #a31515">"AddUser"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">MessageBox</span>.Show(<span style="color: #a31515">"A new user is added."</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> AdminService_PreInvokeEvents(<span style="color: blue">object</span> sender, <span style="color: #2b91af">WebServiceInvokeEventArgs</span> e)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> para = <span style="color: #a31515">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; e.Parameters.Length; i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; para += e.Parameters[i].ToString() + <span style="color: #a31515">"\n"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> msg = <span style="color: #a31515">"MethodName : "</span> + e.MethodName + <span style="color: #a31515">"\n"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + <span style="color: #a31515">"Parameters :"</span> + para + <span style="color: #a31515">"\n"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + <span style="color: #a31515">"ReturnValue :"</span> + e.ReturnValue + <span style="color: #a31515">"\n"</span>;<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">MessageBox</span>.Show(msg + <span style="color: #a31515">" will run."</span>);<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (e.MethodName == <span style="color: #a31515">"AddUser"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">MessageBox</span>.Show(<span style="color: #a31515">"A new user will be added."</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }</pre>
