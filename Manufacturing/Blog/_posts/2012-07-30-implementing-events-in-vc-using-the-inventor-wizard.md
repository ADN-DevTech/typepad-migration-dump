---
layout: "post"
title: "Implementing Events in VC++ Using the Inventor Wizard"
date: "2012-07-30 07:08:06"
author: "Philippe Leefsma"
categories:
  - "Events"
  - "Inventor"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/07/implementing-events-in-vc-using-the-inventor-wizard.html "
typepad_basename: "implementing-events-in-vc-using-the-inventor-wizard"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>Run the <b>Add –&gt; Class </b>command from the right-click menu in Visual Studio. This will display the dialog shown below. From the category list select <b>Inventor</b> and then click the <b>Add </b>button.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017616e112e2970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="pic1" border="0" alt="pic1" src="/assets/image_3d4d5e.jpg" width="490" height="271" /></a></p>  <p>In the <b>Short Name</b> field, enter the name for the class you want to create that will handle the events. This name should not be the same as the Inventor object that supports the event or a name clash will occur. For example, in this case I want to connect to the ApplicationEvents. I cannot use this name and have instead chosen “AppEvents” for the name of the class for this example.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017616e11304970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="pic2" border="0" alt="pic2" src="/assets/image_6be2c9.jpg" width="492" height="416" /></a></p>  <p>On the <b>Inventor Events</b> tab you select which event sink you want to implement. The wizard provides a list of the possible event sinks. In this case the ApplicationEventsSink has been chosen.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017743c77cb3970d-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="pic3" border="0" alt="pic3" src="/assets/image_f9e8f4.jpg" width="491" height="416" /></a></p>  <p>Once you’ve specified the name and selected the event sink to implement you can click the OK button. This will add two additional files to your project and insert some additional code. There are also some additional manual steps that you’ll need to perform to complete the implementation.</p>  <p>The first step is to declare an instance of the class that was created by the ATL Wizard to handle these events. In this example the name specified when using the Inventor Add-In Wizard to create the project was “test”. The declaration of the event sink object is done in the .h file of the add-in class definition. The shaded line below illustrates the additional code that was added to testAddInServer.h.</p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font color="#000000"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt">//----- </font></font></span><span style="font-family: "><font face="Tahoma"><font style="font-size: 11pt">testAddInServer.h</font></font></span><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt">: Declaration of the CtestAddInServer</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">#include &quot;resource.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">#include &quot;AppEvents.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font style="font-size: 9pt" color="#000000">public:</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160;&#160; </font></span><font style="font-size: 9pt">CComPtr&lt;Application&gt; m_pApplication ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160;&#160; </font></span><font style="font-size: 9pt">CComPtr&lt;ApplicationAddInSite&gt; m_pAddInSite ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160;&#160; </font></span><font style="font-size: 9pt">CComPtr&lt;ApplicationEventsObject&gt; mpAppEvents ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160;&#160; </font></span><font style="font-size: 9pt">CComObject&lt;CAppEvents&gt; *mpAppSinkObject ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-spacerun: yes">&#160;</span>//{{AFX_INV_VARS_DECL(CtestAddInServer)</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9pt">&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//}}AFX_INV_VARS_DECL</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font color="#000000" face="Courier New"></font></span></p>  <p>The second step is to connect to the event source. The shaded code below was added to testAddInServer.cpp. The code in the Activate method connects to the event source while the code in the Deactivate method disconnects from the event source and cleans up.</p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font color="#000000"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt">//----- </font></font></span><span style="font-family: "><font face="Tahoma"><font style="font-size: 11pt">testAddInServer</font></font></span><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt">.cpp : Implementation of CtestAddInServer</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------#include &quot;StdAfx.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">#include &quot;test.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">#include &quot;testAddInServer.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">#include &quot;AppEvents.h&quot;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">STDMETHODIMP CtestAddInServer::Activate (IDispatch *pDisp, VARIANT_BOOL FirstTime)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">AFX_MANAGE_STATE (AfxGetStaticModuleState ()) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( pDisp == NULL )</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return E_INVALIDARG ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">HRESULT hr =pDisp-&gt;QueryInterface (__uuidof (m_pAddInSite),</font></font></font></span></p>  <p style="line-height: normal; text-indent: 0.5in; margin: 0in 0in 0pt 2in" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">reinterpret_cast&lt;void**&gt;(&amp;m_pAddInSite)) ;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">ATLASSERT( SUCCEEDED( hr ) ) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( FAILED( hr ) )</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return hr ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><span style="mso-tab-count: 1"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//----- Get the application object.</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">hr =m_pAddInSite-&gt;get_Application (&amp;m_pApplication) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">ATLASSERT( SUCCEEDED( hr ) ) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( FAILED( hr ) )</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return hr ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//{{AFX_INV_INIT_EVENTS(CtestAddInServer)</font><span class="msoIns"><ins datetime="2004-03-02T15:56" cite="mailto:venkatt"></ins></span></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">hr = m_pApplication-&gt;get_ApplicationEvents(&amp;mpAppEvents) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>CComObject&lt;CAppEvents&gt;::CreateInstance(&amp;mpAppSinkObject) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>mpAppSinkObject-&gt;AddRef() ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">mpAppSinkObject-&gt;DispEventAdvise(mpAppEvents) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//}}AFX_INV_INIT_EVENTS</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//{{AFX_INV_INIT_CMDS(CtestAddInServer)</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//}}AFX_INV_INIT_CMDS</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return S_OK ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">}</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">STDMETHODIMP CtestAddInServer::Deactivate ()</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">AFX_MANAGE_STATE (AfxGetStaticModuleState ()) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//{{AFX_INV_DEACT_EVENTS(CtestAddInServer)</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( mpAppSinkObject != NULL ) </font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>{</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>mpAppSinkObject-&gt;DispEventUnadvise (</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; mpAppEvents) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>mpAppSinkObject-&gt;Release () ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>mpAppSinkObject =NULL ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160;&#160; </span>mpAppEvents.Release () ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 3"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">mpAppEvents =NULL ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//}}AFX_INV_DEACT_EVENTS</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//{{AFX_INV_DEL_CMDS(CtestAddInServer)</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">//}}AFX_INV_DEL_CMDS</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">m_pAddInSite.Release () ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">m_pApplication.Release () ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return S_OK ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">}</font></font></span></p>  <p>The final step is to add the implementation for the event. The code below is a section from the AppEvents.cpp file that was created by the ATL Object Wizard. This file contains the sink methods for all of the events supported the event set chosen in the ATL Object Wizard. By default, none of them are implemented. To implement any of the events you just add your code and change the return code from E_NOTIMPL to S_OK. The shaded section of code is the code that was modified in the OnNewDocument method.</p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----- AppEvents.cpp : Implementation of CAppEvents</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">//----------------------------------------------------------------</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">STDMETHODIMP CAppEvents::OnNewDocument (</font></font></span></p>  <blockquote>   <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "></span><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">struct Document *pDocumentObject, </font></font></span></p>    <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font face="Courier New"><font color="#000000"><span style="font-family: "><font style="font-size: 9pt">enum EventTimingEnum BeforeOrAfter,</font></span></font></font></p> </blockquote>  <blockquote>   <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font face="Courier New"><font color="#000000"><span style="font-family: "></span></font></font><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">struct NameValueMap *pContext, </font></font></span></p>    <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "></span><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">enum HandlingCodeEnum *pHandlingCode) </font></font></span></p>    <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "></span><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">{</font></font></span></p> </blockquote>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( pHandlingCode == NULL )</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return (E_POINTER) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">if ( BeforeOrAfter == kAfter ){</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">AFX_MANAGE_STATE (AfxGetStaticModuleState ()) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">AfxMessageBox (_T(&quot;New Document Created.&quot;), MB_OK) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; background: #d9d9d9" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1"><font style="font-size: 9pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9pt">return (S_OK) ;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">}</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font face="Courier New"><font style="font-size: 9pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: "><font color="#000000" face="Courier New"></font></span></p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:f08e75d3-7135-4d3a-9c2a-0638ed81cc5e" class="wlWriterEditableSmartContent"><p> <a href="http://adndevblog.typepad.com/inveventscpp-1.zip" target="_blank">InvEventsCpp.zip</a></p></div>
