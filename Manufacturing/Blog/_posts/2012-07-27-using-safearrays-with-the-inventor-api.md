---
layout: "post"
title: "Using SAFEARRAYS with the Inventor API"
date: "2012-07-27 02:38:07"
author: "Philippe Leefsma"
categories:
  - "Inventor"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/07/using-safearrays-with-the-inventor-api.html "
typepad_basename: "using-safearrays-with-the-inventor-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>SAFEARRAYS are a Microsoft device to help control multi-dimensional arrays, and avoid memory leaks. Each dimension of the array may have a differing number of elements. SAFEARRAYS and associated functions are documented by Microsoft. Please find more on MSDN website.</p>  <p>SAFEARRAYS are returned/passed in as parameters to some of the methods in the Inventor API, and thus may be unavoidable for some applications.</p>  <p>In order to help illustrate the usage of SAFEARRAYS as parameters to the API methods let us consider the example of getting the facet information from the surface body of a part model.</p>  <p>The SurfaceBody-&gt;GetFacets() method returns the facet information as SAFEARRAYS. Before the actual facet information can be accessed, the tolerance values must be obtained. This is also returned in a SAFEARRAY. </p>  <p>The following code section shows how to declare and use SAFEARRAYS. The acceptable tolerance values for the facets are returned in the ExistTols SAFEARRAY. We could choose any element from the one-dimensional array as the desired tolerance value for the&#160; facets. The facet information is also returned as SAFEARRAYS. </p>  <p>The contents of the arrays can be accessed using the SafeArrayAccessData method(remember to do SafeArrayUnaccessData to unlock later). This is shown in Method1 of the code segment. But, when we use SafeArrayAccessData, it does not tell us how the array is organized (dimensions, elements etc..) but, just returns the contents. In our case, the arrays have just one dimension. For example, the vertex coordinates has the following structure:&#160;&#160; <br />X1,Y1,Z1, X2,Y2,Z2,X3,Y3,Z3 …….. Xn,Yn,Zn where n is the no. of vertices (Vertices)    <br />With this structure known, you could access the contents of the array and store them in a double array. This is shown in Method2.</p>  <p>Finally, remember to deallocate memory and destroy the SAFEARRAYS.</p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">///////////////////////////////////////////////////////////////////////////////</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">// Use: SAFEARRAY demo</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">//</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">///////////////////////////////////////////////////////////////////////////////</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Courier New"><span style="font-family: ; color: ; mso-no-proof: yes"><font color="#0000ff">void</font></span><span style="font-family: ; mso-no-proof: yes"><font color="#000000"> SafeArrayDemo(</font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Courier New"><font color="#000000"><span style="font-family: ; mso-no-proof: yes"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span></span><span style="font-family: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR">CComPtr&lt;Application&gt; pInventorApp,</span></font></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PartDocument&gt; pPartDoc)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>HRESULT hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PartComponentDefinition&gt; pPartDef;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPartDoc-&gt;get_ComponentDefinition(&amp;pPartDef);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;SurfaceBodies&gt; pSurfBodies;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPartDef-&gt;get_SurfaceBodies(&amp;pSurfBodies);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> index = 1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;SurfaceBody&gt; pSurfBody;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBodies-&gt;get_Item(index,&amp;pSurfBody);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Use raw SAFEARRAYS</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// get the existing tolerance values</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// declare a SAFEARRAY (has no contents)</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SAFEARRAY *ExistTols = NULL;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">//get the existing tolerance values</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> TolCount;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBody-&gt;GetExistingFacetTolerances(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;TolCount, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;ExistTols);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Get the first tolerance value, </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// you can choose from existing values </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="color: "><font color="#008000">&#160;&#160;&#160;&#160;&#160; // if there is more than one</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> TolIndex;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> nTolCount=0;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = SafeArrayGetElement(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ExistTols, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;nTolCount, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;TolIndex);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Now get the facets information</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// no. of vertices and facets</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> Vertices, Facets;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SAFEARRAY *VertexCoords = NULL;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SAFEARRAY *NormalVects = NULL;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SAFEARRAY *VertexIndices = NULL;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Call the method to get facet information</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBody-&gt;GetExistingFacets(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>TolIndex, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;Vertices,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;Facets,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;VertexCoords,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;NormalVects,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;VertexIndices);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// From the SAFEARRAY get the contents</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Method1 (SafeArrayAccessData)</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// declare an array of doubles </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="color: "><font color="#008000">&#160;&#160;&#160;&#160;&#160; // to store vertex coordinates</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">* vertexcoords1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = SafeArrayAccessData(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; VertexCoords, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">**)&amp; vertexcoords1);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// remember to do SafeArrayUnaccessData </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// after accessing the SAFEARRAY contents</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = SafeArrayUnaccessData(VertexCoords);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Method2 (SafeArrayGetElement)</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> *vertexcoords2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2 = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[Vertices*3];</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> i=0; i&lt;Vertices; i++)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> x_index = i*3;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> x;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>SafeArrayGetElement(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; VertexCoords, &amp;x_index, (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;x);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> y_index = i*3 + 1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> y;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>SafeArrayGetElement(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; VertexCoords, &amp;y_index, (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;y);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> z_index = i*3 + 2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> z;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>SafeArrayGetElement(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; VertexCoords, &amp;z_index, (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;z);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[x_index] = x;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[y_index] = y;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[z_index] = z;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>}</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">//remember to deallocate SAFERRAYS</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SafeArrayDestroy(ExistTols);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SafeArrayDestroy(VertexCoords);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SafeArrayDestroy(NormalVects);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>SafeArrayDestroy(VertexIndices);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000">[] vertexcoords2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">}</font></font></span></p>  <p>Apart from the method of dealing with the raw SAFEARRAYS, you could also use the CSafeArray class declared in the Inventor SDK (&lt;SDK_PATH&gt;\Include\SafeArrayUtil.h). This class is very useful because it simplifies the use of SAFEARRAYS by wrapping the contents of the array and providing methods that allow easy access to the contents of the array.</p>  <p>The CSafeArray also provides methods that allow you to easily initialize and copy SAFEARRAYs. In essence, it stores the SAFEARRAY as a private data member and provides useful wrapper methods, these wrapper methods internally deal with the actual creation/manipulation of the contents of the SAFEARRAY. Thus, by using the methods of the class, the cumbersome work of having to deal with SAFEARRAYs is delegated to these wrapper methods.</p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">///////////////////////////////////////////////////////////////////////////////</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font face="Courier New"><font color="#008000">// Use: CSafeArray demo (SafeArrayUtil.h)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font face="Courier New"><font color="#008000">//</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font face="Courier New"><font color="#008000">///////////////////////////////////////////////////////////////////////////////</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Courier New"><span style="font-family: ; color: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font color="#0000ff">void</font></span><span style="font-family: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font color="#000000"> CSafeArrayDemo(</font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;Application&gt; pInventorApp,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-ansi-language: fr; mso-no-proof: yes" lang="FR"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PartDocument&gt; pPartDoc)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>HRESULT hr;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;PartComponentDefinition&gt; pPartDef;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPartDoc-&gt;get_ComponentDefinition(&amp;pPartDef);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;SurfaceBodies&gt; pSurfBodies;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pPartDef-&gt;get_SurfaceBodies(&amp;pSurfBodies);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> index = 1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CComPtr&lt;SurfaceBody&gt; pSurfBody;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBodies-&gt;get_Item(index,&amp;pSurfBody);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> TolCount;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CSafeArrayDouble ExistTols;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBody-&gt;GetExistingFacetTolerances(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;TolCount,&amp;ExistTols);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> TolIndex;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> nTolCount=0;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>TolIndex = ExistTols.</font><span style="color: "><font color="#0000ff">operator</font></span><font color="#000000"> [](nTolCount);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> Vertices, Facets;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CSafeArrayDouble VertexCoords;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CSafeArrayDouble NormalVects;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>CSafeArrayDouble VertexIndices;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>hr = pSurfBody-&gt;GetExistingFacets(</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>TolIndex, </font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;Vertices,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;Facets,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;VertexCoords,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;NormalVects,</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&amp;VertexIndices);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// From the SAFEARRAY get the contents</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// METHOD1 (equivalent of SafeArrayAccessData)</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// declare an array of doubles </font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="color: "><font color="#008000">&#160;&#160;&#160;&#160;&#160; // to store vertex coordinates</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> *vertexcoords1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>vertexcoords1 = VertexCoords.DataBase();</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">//the above calls SafeArrayAccessData internally</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font color="#008000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// METHOD2 (equivalent of SafeArrayGetElement)</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">* vertexcoords2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2 = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[Vertices*3];</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> i=0; i&lt;Vertices; i++)</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> x_index = i*3;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> x;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>x = VertexCoords.</font><span style="color: "><font color="#0000ff">operator</font></span><font color="#000000"> [](x_index);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> y_index = i*3 + 1;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> y;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>y = VertexCoords.</font><span style="color: "><font color="#0000ff">operator</font></span><font color="#000000"> [](y_index);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> z_index = i*3 + 2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 2"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> z;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>z = VertexCoords.</font><span style="color: "><font color="#0000ff">operator</font></span><font color="#000000"> [](z_index);</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[x_index] = x;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[y_index] = y;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 2">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>vertexcoords2[z_index] = z;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><font color="#000000"><span style="mso-tab-count: 1">&#160;&#160;&#160;&#160;&#160; </span>}</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// No need to destroy CSafeArray's</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// the destructor destroys the internal SAFEARRAY</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-no-proof: yes"><font color="#008000" face="Courier New">&#160;</font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">//delete double arrays</font></span></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font face="Courier New"><span style="mso-tab-count: 1"><font color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000">[] vertexcoords2;</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><span style="font-family: ; mso-no-proof: yes"><font color="#000000" face="Courier New">}</font></span></p>
