---
layout: "post"
title: "How to handle &quot;Error 300 - BadAuthenticationToken&quot;?"
date: "2012-05-14 01:34:30"
author: "Barbara Han"
categories:
  - "Barbara Han"
  - "Vault"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/05/how-to-handle-error-300-badauthenticationtoken.html "
typepad_basename: "how-to-handle-error-300-badauthenticationtoken"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/barbara-han.html" target="_self">Barbara Han</a></p>  <p>Sometimes an &quot;Error 300 - BadAuthenticationToken&quot; occurs when executing our program. What is the cause of this error and how can we handle it?</p>  <p>The server has a security feature introduced since Vault 2008. When users log in they get an encrypted security ticket.&#160; In Vault R5 this ticket will be valid forever. Starting from Vault 2008, the server is allowed to change its encryption key which effectively invalidates the security ticket. What this means for a client developer is that at any time, the user's security information could be suddenly invalidated.&#160; Almost every API call requires a security ticket so your program needs to handle the situation where the security ticket is invalid.</p>  <p>How to reproduce:    <br />1 - Sign in to Vault through your application and do a couple of basic operations.     <br />2 - Run &quot;iisreset /restart&quot; from the command line on the server.&#160; This will cause IIS to reset and the encryption key to change.     <br />3 - Go back to your program.&#160; Everything that involves a Vault API call should now fail with the 300 error.</p>  <p>How to solve:    <br />The best way to deal with this is for your application is to silently re-authenticate and re-run the API call.&#160; If all goes well the user will never know that an error occurred.</p>  <p>With Vault 2008 ~ 2010, you can leverage partial classes feature from .NET 2.0 to create a single choke point per service. </p>  <p>For each class you can create the following partial implementation:</p>  <p>C#:</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">namespace</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// TODO: set namespace same as service class </font></span></font></p>    <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{ </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">partial</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">class</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">DocumentServiceWse</font></span><font color="#000000"> </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">protected</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">object</font></span><font color="#000000">[] Invoke(</font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> methodName, </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">object</font></span><font color="#000000">[] parameters) </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">try</font></span><font color="#000000"> </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">base</font></span><font color="#000000">.Invoke(methodName, parameters); </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (Exception ex) </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> errorCodeString = GetErrorCodeString(ex); </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (errorCodeString != </font><span style="color: "><font color="#a31515">&quot;300&quot;</font></span><font color="#000000">) </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// TODO:&#160; handle or re-throw the error </font></span></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Ran into error 300.&#160; </font></span></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Log in again and re-run the command </font></span></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">try</font></span><font color="#000000"> </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// TODO: re-authenticate </font></span></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">base</font></span><font color="#000000">.Invoke(methodName, parameters); </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (Exception) </font></font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// TODO:&#160; handle or re-throw the error </font></span></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; } </font></font></p>      <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>   </div>    <p style="margin: 0px">VB.NET:</p> </div>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">Namespace</font></font></span><font style="font-size: 8pt" color="#000000"> ' TODO: set namespace same as service class </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Partial</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Class</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#2b91af">DocumentServiceWse</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Protected</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Shadows</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Function</font></span><font color="#000000"> Invoke(</font><span style="color: "><font color="#0000ff">ByVal</font></span><font color="#000000"> methodName </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">String</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">ByVal</font></span><font color="#000000"> parameters </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Object</font></span><font color="#000000">()) </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Object</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">MyBase</font></span><font color="#000000">.Invoke(methodName, parameters)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Catch</font></span><font color="#000000"> ex </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> Exception</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> errorCodeString </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">String</font></span><font color="#000000"> = GetErrorCodeString(ex)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">If</font></span><font color="#000000"> (errorCodeString &lt;&gt; </font><span style="color: "><font color="#a31515">&quot;300&quot;</font></span><font color="#000000">) </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' TODO:&#160; Handle or re-throw the error </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' Ran into error 300&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' Log in again and re-run the command </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' TODO: re-authenticate </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">MyBase</font></span><font color="#000000">.Invoke(methodName, parameters)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Catch</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' TODO:&#160; Handle or re-throw the error </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Function</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Class</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Namespace</font></span></font></p> </div>  <p>With Vault 2011 and afterward releases, you can use the Autodesk.Connectivity.WebServices.dll. Partial classes won't work with DLLs, so please use subclasses instead. For more details of Autodesk.Connectivity.WebServices.dll, please see:</p>  <p><a href="http://justonesandzeros.typepad.com/blog/2010/04/autodeskconnectivitywebservicesdll.htm">http://justonesandzeros.typepad.com/blog/2010/04/autodeskconnectivitywebservicesdll.htm</a></p>  <p>There is another new dll “Autodesk.Connectivity.WebServicesTools.dll” having been added starting from Vault 2012. This DLL is a set of tools built on top of the WebServices DLL. The main tool is the WebServiceManager, which makes it easier to construct new IWebService objects, also adds the re-signin feature, which automatically logs your user back in if a timeout occurs, so the recommended way is to use WebServiceManager to take care of this issue.</p>
