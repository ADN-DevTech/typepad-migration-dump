---
layout: "post"
title: "Custom File Dialog with Open Express"
date: "2014-01-07 22:07:29"
author: "Xiaodong Liang"
categories:
  - "Inventor"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/manufacturing/2014/01/custom-file-dialog-with-open-express.html "
typepad_basename: "custom-file-dialog-with-open-express"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><em>From Inventor 2014, you are allowed to open assembly in “Express Mode” which is essentially a light weight model. The benefits of this, are that you can open models faster and that you can open, and work with lots of complex geometry that may have previously been a bit too much for your graphics card to process. </em></p>  <p>   <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; - from <a href="http://www.cadlinecommunity.co.uk/Blogs/Blog.aspx?ScoId=1a78bf7d-dc3b-4af7-afda-49b2b3f1c31b">Clinton Brown's Blog</a></p>    <p>When you open an assembly, you can see an option [Open Express] which indicates whether opening in express mode or not. </p>    <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a5108ce931970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_792223.jpg" width="391" height="318" /></a></p> </p>  <p>&#160;</p>  <p>API can override the built-in open dialog with the custom behaviors. But some developers found even though the custom dialog is opened correctly, the [Open Express] option is missed. </p>  <p>Actually, the issue is because the FileDialog.InsertMode property is true (this is the default value). We don't support opening in Express mode for insert (e.g. place component). If it is appropriate, this will happen automatically. The solution is to set the InsertMode to false prior to showing the dialog. Then the Express checkbox will be shown and enabled as appropriate. The API help reference is not well documented at this point. </p>  <p>In addition, when InsertMode = false, the custom file dialog will know the choice of the user of the option [Open Express]. But you need to tell Inventor if opening assembly in express or not. Otherwise, the assembly will still be opened in full mode.</p>  <p>The following is a VBA demo:</p>  <p><em><font size="1">‘*****module******</font></em></p>  <p><em><font size="1">Option Explicit</font></em></p>  <p><em><font size="1">Private oEventHandler As Class1</font></em></p>  <p><em><font size="1">Private Sub StartFileOpen()       <br />&#160;&#160; Set oEventHandler = New Class1        <br />End Sub        <br />&#160;&#160; <br />Private Sub EndFileOpen()        <br />&#160;&#160;&#160; Set oEventHandler = Nothing        <br />End Sub        <br /></font></em></p>  <p><em><font size="1"></font></em></p>  <p><em><font size="1">‘****even class *******</font></em></p>  <p><em><font size="1">Option Explicit</font></em></p>  <p><em><font size="1">Private WithEvents oEvents As FileUIEvents       <br />Private inCustomDlg As Boolean</font></em></p>  <p>   <br /><em><font size="1">Private Sub Class_Initialize()       <br />Set oEvents = ThisApplication.FileUIEvents        <br /> inCustomDlg = False        <br />End Sub</font></em></p>  <p>   <br /><em><font size="1">Private Sub Class_Terminate()       <br />Set oEvents = Nothing        <br />End Sub</font></em></p>  <p><em><font size="1">Private Sub oEvents_OnFileOpenDialog(FileTypes() As String, ByVal ParentHWND As Long, FileName As String, ByVal Context As NameValueMap, HandlingCode As HandlingCodeEnum)</font></em></p>  <p><em><font size="1">If inCustomDlg = False Then '&#160; to avoid recursive callback       <br />&#160;&#160;&#160; inCustomDlg = True        <br />&#160;&#160;&#160; Dim oFileLocations As FileLocations        <br />&#160;&#160;&#160; Set oFileLocations = ThisApplication.FileLocations        <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; Dim FileOpenForm As FileDialog        <br />&#160;&#160;&#160; Call ThisApplication.CreateFileDialog(FileOpenForm)        <br />&#160;&#160;&#160; <strong><font style="background-color: #ffff00">FileOpenForm.InsertMode = False           <br /></font></strong>&#160;&#160;&#160; FileOpenForm.InitialDirectory = oFileLocations.Workspace        <br />&#160;&#160;&#160; With FileOpenForm        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Set the initial Directory        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .InitialDirectory = oFileLocations.Workspace        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .DialogTitle = &quot;My File Open&quot;        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .Filter = &quot;Part File (*.ipt)|*.ipt&quot; _        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;|Assembly File (*.iam)|*.iam&quot; _        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;|Presentation File (*.ipn)|*.ipn&quot; _        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;|Drawing File (*.idw)|*.idw&quot; _        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;|Design element File (*.ide)|*.ide&quot; _</font></em></p>  <p><em><font size="1"></font></em></p>  <p><em><font size="1">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .FilterIndex = 2&#160;&#160;&#160; ' *.iam files       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .OptionsEnabled = True        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; '.Flags = cdlOFNHideReadOnly        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .ShowOpen        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End With        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; FileName = FileOpenForm.FileName        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If FileOpenForm.OptionValues.Count &gt;= 6 Then        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' assembly has 6 options        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim index As Integer        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim oKey As String        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; For index = 1 To FileOpenForm.OptionValues.Count        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oKey = FileOpenForm.OptionValues.Name(index)        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If oKey = &quot;OpenExpressMode&quot; Then        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' this is a Boolean for OpenExpress/Don't open Express        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If FileOpenForm.OptionValues.Item(index) Then        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 'if OpenExpress was specified, pass it back through the context        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Context.Add &quot;ExpressModeBehavior&quot;, &quot;OpenExpress&quot;        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If</font></em></p>  <p><em><font size="1">&#160;&#160;&#160;&#160;&#160;&#160;&#160; If FileName = &quot;&quot; Then       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; HandlingCode = kEventCanceled        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Else        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; HandlingCode = kEventHandled        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; inCustomDlg = False        <br />End If        <br />End Sub        <br /></font></em></p>
