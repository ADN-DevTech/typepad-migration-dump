---
layout: "post"
title: "get thumbnail image by Metafile"
date: "2012-07-21 06:37:05"
author: "Xiaodong Liang"
categories:
  - "Inventor"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/07/get-thumbnail-image-by-metafile.html "
typepad_basename: "get-thumbnail-image-by-metafile"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>A couple of blogs below introduce how to get thumbnail of a document. </p>  <p><a title="Accessing Thumbnail Images" href="http://modthemachine.typepad.com/my_weblog/2010/06/accessing-thumbnail-images.html">Accessing Thumbnail Images</a></p>  <p><a title="Document Thumbnails and Button Icons" href="http://modthemachine.typepad.com/my_weblog/2010/03/document-thumbnails-and-button-icons.html">Document Thumbnails and Button Icons</a></p>  <p><a title="Accessing iProperties" href="http://modthemachine.typepad.com/my_weblog/2010/02/accessing-iproperties.html">Accessing iProperties</a>&#160;</p>  <p>In this post, we use one more way which takes advantage of Metafile of System.Drawing.Imaging.</p>  <p>The code assumes there is one picturebox and one button in one Windows form application. When the button clicks, a file dialog will ask you to select an Inventor file, and the picturebox will display its thumbnail.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <div style="font-family: courier new; background: white; color: black; font-size: 8pt">       <p style="margin: 0px"><span style="color: blue">using</span> Inventor;</p>        <p style="margin: 0px"><span style="color: blue">using</span> System.Windows.Forms;</p>        <p style="margin: 0px"><span style="color: blue">using</span> System.Drawing;</p>        <p style="margin: 0px"><span style="color: blue">using</span> System.Drawing.Imaging;</p>        <p style="margin: 0px"><span style="color: blue">using</span> stdole;</p>        <p style="margin: 0px">&#160;</p>     </div>      <p style="margin: 0px"><span style="color: green"></span></p>      <p style="margin: 0px"><span style="color: green">// callback function for GetThumbnailImageAbort</span></p>      <p style="margin: 0px"><span style="color: blue">bool</span> ThumbnailCallback()</p>      <p style="margin: 0px">{</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">false</span>;</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// button event to get thumbnail</span></p>      <p style="margin: 0px"><span style="color: blue">private</span> <span style="color: blue">void</span> btnOpen_Click(<span style="color: blue">object</span> sender, <span style="color: #2b91af">EventArgs</span> e)</p>      <p style="margin: 0px">{</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">OpenFileDialog</span> oFDlg = <span style="color: blue">new</span> <span style="color: #2b91af">OpenFileDialog</span>();</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (oFDlg.ShowDialog() == System.Windows.Forms.<span style="color: #2b91af">DialogResult</span>.OK)</p>      <p style="margin: 0px">&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ApprenticeServerComponent</span> oApprenticeApp = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">ApprenticeServerComponent</span>();</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ApprenticeServerDocument</span> oDoc;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDoc = oApprenticeApp.Open(oFDlg.FileName);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span> (<span style="color: #2b91af">Exception</span> ex)</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">MessageBox</span>.Show(<span style="color: #a31515">&quot;cannot open the file!&quot;</span>);</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; stdole.<span style="color: #2b91af">IPictureDisp</span> oPD =&#160; oDoc.Thumbnail;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Metafile</span> oMF = <span style="color: blue">new</span>&#160; <span style="color: #2b91af">Metafile</span>(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">IntPtr</span>(oPD.Handle),</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">WmfPlaceableFileHeader</span>());</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Image</span>.<span style="color: #2b91af">GetThumbnailImageAbort</span> oCallBack = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span>&#160;&#160; <span style="color: #2b91af">Image</span>.<span style="color: #2b91af">GetThumbnailImageAbort</span>(ThumbnailCallback);</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pictureBox1.Image = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oMF.GetThumbnailImage(pictureBox1.Width, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pictureBox1.Height,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oCallBack, <span style="color: #2b91af">IntPtr</span>.Zero);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>   </div>    <p style="margin: 0px">&#160; <p></p>      <p>&#160;</p>   </p> </div>
