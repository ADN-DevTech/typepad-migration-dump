---
layout: "post"
title: "AddRestriction() is not added correctly for several events in the Vault 2012 RestrictOperations SDK sample"
date: "2012-06-19 16:54:56"
author: "Wayne Brill"
categories:
  - "Vault"
  - "Wayne Brill"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/06/addrestriction-is-not-added-correctly-for-several-events-in-the-vault-2012-restrictoperations-sdk-sample.html "
typepad_basename: "addrestriction-is-not-added-correctly-for-several-events-in-the-vault-2012-restrictoperations-sdk-sample"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/wayne-brill.html" target="_self">Wayne Brill</a></p>  <p>Applies to:    <br />Autodesk® Vault Collaboration 2012     <br />Autodesk® Vault Professional 2012     <br />Autodesk® Vault Workgroup 2012     <br /></p>  <p><b>Issue</b></p>  <p>I am using the RestrictOperations SDK sample. AddRestriction() is not getting added for the UpdateFileLifeCycleState event even though it is checked in the Configurator. Is there a way to get this to work in the sample? </p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>There is a typo in Configulator tool, and was fixed in the 2013 release.</p>  <p>This code snippet is from Form1.cs and is a list of strings that is used to determine which event will be restricted by a call to AddRestriction(). Notice that the &quot;c&quot; in &quot;UpdateFileLifecycleState&quot; is lower case. </p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> <span style="color: #2b91af">Form1</span> : <span style="color: #2b91af">Form</span></p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160; <span style="color: blue">private</span> <span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt; m_commands = </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt;()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// File commands</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;AddFile&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;CheckinFile&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;CheckoutFile&quot;</span> ,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;DeleteFile&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;DownloadFile&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;UpdateFileLife<strong>c</strong>ycleState&quot;</span>,</p> </div>  <p>&#160;</p>  <p>This code from EventHandlers.cs compares the event type name with the setting stored by Configulator tool to determine if AddRestriction() should be called. The Contains() function returns false because the commandName string is UpdateFileLife<strong>C</strong>ycleState which has an upper case &quot;C&quot;, but the stored setting is “UpdateFileLifecycleState” which has a lower case. This causes the AddRestriction not to be called. </p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px"><span style="color: blue">private</span> <span style="color: blue">void</span> </p>    <p style="margin: 0px">&#160; RestrictOperation</p>    <p style="margin: 0px">&#160; (<span style="color: #2b91af">WebServiceCommandEventArgs</span> eventArgs)</p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160; <span style="color: blue">string</span> commandName = eventArgs.GetType().Name;</p>    <p style="margin: 0px">&#160;&#160; <span style="color: blue">if</span> (commandName.EndsWith(<span style="color: #a31515">&quot;CommandEventArgs&quot;</span>))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; commandName = commandName.Remove </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (commandName.Length - </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;CommandEventArgs&quot;</span>.Length);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #2b91af">RestrictSettings</span> settings = </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RestrictSettings</span>.Load();</p>    <p style="margin: 0px">&#160;&#160; <span style="color: blue">if</span> (settings.RestrictedOperations.Contains</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (commandName))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160; eventArgs.AddRestriction</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">new</span> <span style="color: #2b91af">ExtensionRestriction</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #a31515">&quot;&quot;</span>, <span style="color: #a31515">&quot;Test restriction&quot;</span>));</p>    <p style="margin: 0px">&#160;&#160; }</p> </div>
