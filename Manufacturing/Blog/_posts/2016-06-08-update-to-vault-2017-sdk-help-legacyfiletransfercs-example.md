---
layout: "post"
title: "Update to Vault 2017 SDK help LegacyFileTransfer.cs example"
date: "2016-06-08 14:24:41"
author: "Wayne Brill"
categories:
  - "Vault"
  - "Wayne Brill"
original_url: "https://adndevblog.typepad.com/manufacturing/2016/06/update-to-vault-2017-sdk-help-legacyfiletransfercs-example.html "
typepad_basename: "update-to-vault-2017-sdk-help-legacyfiletransfercs-example"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/wayne-brill.html" target="_self">Wayne Brill</a></p> <p>The topic “ How To Acquire Files” in the the Vault 2017 SDK has a section titled: “File Transfer - Doing it the Hard Way”. In that section there are a couple of links to C# and VB examples. The DownloadFile function in these examples will not work with Vault 2017 due to the change to the DownloadFilePart method. It has changed in 2017 and doesn't return a byte array anymore, but a stream instead.</p> <p>Here is an update to the DownloadFile function that works with the 2017 API. </p> <div style="font-size: 10pt; border-top: #000080 1px solid; font-family: consolas, 'Courier New', courier, monospace; border-right: #000080 1px solid; border-bottom: #000080 1px solid; color: #000; border-left: #000080 1px solid"> <div style="overflow: auto; white-space: nowrap; color: #000000; padding-bottom: 2px; padding-top: 2px; padding-left: 5px; padding-right: 5px; max-height: 300px; background-color: #eeeeee"><span style="color: #0000ff">private</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span> DownloadFile(vltutil.WebServiceManager mgr, <span style="color: #0000ff">out</span> <span style="color: #0000ff">byte</span>[] fileContents,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vltobj.ByteArray downloadTicket, <span style="color: #0000ff">bool</span> allowSync)<br>{<br>&nbsp;&nbsp;&nbsp; mgr.FilestoreService.CompressionHeaderValue = <span style="color: #0000ff">new</span> vltobj.CompressionHeader();<br>&nbsp;&nbsp;&nbsp; mgr.FilestoreService.CompressionHeaderValue.Supported = vltobj.Compression.None;<br>&nbsp;&nbsp;&nbsp; mgr.FilestoreService.FileTransferHeaderValue = <span style="color: #0000ff">new</span> vltobj.FileTransferHeader();<br>&nbsp;&nbsp;&nbsp; mgr.FilestoreService.FileTransferHeaderValue = <span style="color: #0000ff">null</span>;<br><br>&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">using</span> (System.IO.<span style="color: #2b91af">MemoryStream</span> stream = <span style="color: #0000ff">new</span> System.IO.<span style="color: #2b91af">MemoryStream</span>())<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">long</span> bytesRead = 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">while</span> (mgr.FilestoreService.FileTransferHeaderValue == <span style="color: #0000ff">null</span> ||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !mgr.FilestoreService.FileTransferHeaderValue.IsComplete)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">using</span> (Stream filePart = mgr.FilestoreService.DownloadFilePart(downloadTicket.Bytes,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytesRead, bytesRead + MAX_FILE_PART_SIZE - 1, allowSync))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">int</span> chunkSize = (mgr.FilestoreService.FileTransferHeaderValue != <span style="color: #0000ff">null</span>) ?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mgr.FilestoreService.FileTransferHeaderValue.UncompressedSize : 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span> (chunkSize &gt; 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; filePart.CopyTo(stream);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytesRead += chunkSize;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fileContents = <span style="color: #0000ff">new</span> <span style="color: #0000ff">byte</span>[bytesRead];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">if</span> (bytesRead &gt; 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stream.Seek(0, System.IO.<span style="color: #2b91af">SeekOrigin</span>.Begin);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stream.Read(fileContents, 0, (<span style="color: #0000ff">int</span>)bytesRead);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</div></div>
