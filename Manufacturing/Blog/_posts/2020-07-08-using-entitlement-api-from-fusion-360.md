---
layout: "post"
title: "Using Entitlement API from Fusion 360"
date: "2020-07-08 02:55:58"
author: "Sajith Subramanian"
categories:
  - "Fusion 360"
  - "Sajith Subramanian"
original_url: "https://adndevblog.typepad.com/manufacturing/2020/07/using-entitlement-api-from-fusion-360.html "
typepad_basename: "using-entitlement-api-from-fusion-360"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/sajith-subramanian.html" target="_self">Sajith Subramanian</a></p><p>If you have an app on the <a href="https://apps.autodesk.com/en">Autodesk App Store</a> then you might want to check if the user actually paid for and downloaded your app from the store or just copied it from someone else's computer. This what the Entitlement API can help you with. </p><p>This article will focus on the Windows OS. If you wish to achieve this on a MacOS, please navigate to the below link:</p><p><a href="https://modthemachine.typepad.com/my_weblog/2015/10/use-entitlement-api-from-fusion.html">https://modthemachine.typepad.com/my_weblog/2015/10/use-entitlement-api-from-fusion.html</a></p><p><br></p><p>The <strong>Entitlement API</strong> is a simple <strong>RESTful API</strong> where you just need to send an <strong>HTTP</strong> <strong>GET</strong> request to the <strong>App Store</strong> server.</p><p>Since the Fusion API supports both <strong>C++</strong> and <strong>Python</strong>, this article shall be covering both, should the need arise.</p><p><strong><br></strong></p><p><strong>1. C++:</strong></p><p>There are many library options that you could choose to make an HTTP request using C++. For this example, I installed this <a href="https://github.com/mrtazz/restclient-cpp">RestClient</a> (which is a wrapper for the <a href="https://curl.haxx.se/libcurl/c/libcurl.html">cURL</a> library) and installed it using <a href="https://github.com/microsoft/vcpkg">vcpkg</a>.</p><p><strong>Tip</strong>: When using vcpkg, it usually defaults to 32-bit platform. To set it to a 64-bit platform, you can set the environment variable as below:</p><p><code>VCPKG_DEFAULT_TRIPLET=x64-windows</code></p><p>I have also used this <a href="https://github.com/open-source-parsers/jsoncpp">JsonCPP</a> library to help parse the HTTP response.</p><p>Below are the steps that I needed to follow for implementation:</p><p><strong>&gt;</strong> Create a C++ Fusion add-in and edit it so it opens in Visual Studio. For detailed steps on how to create an add-in please refer: <a href="http://help.autodesk.com/view/fusion360/ENU/?guid=GUID-9701BBA7-EC0E-4016-A9C8-964AA4838954">Creating a Script or Add-In</a>.</p><p><strong>&gt;</strong> In Visual Studio, navigate to <strong>Project â€“&gt;</strong>&nbsp;<strong>Properties -&gt; Configuration Properties -&gt; VC++ Directories -&gt; Include directories.</strong></p><p>Here add the full path to the<strong> Include</strong> directories where you have installed the libraries. For e.g. </p><blockquote><p>C:\vcpkg\packages\restclient-cpp_x64-windows\include<br>
C:\vcpkg\packages\jsoncpp_x64-windows\include</p></blockquote><div>Next, in the same window, navigate to <strong>Library directories.</strong></div><p>Here, add the full path to the <strong>Lib </strong>folder. For e.g.</p><blockquote><p>
C:\vcpkg\packages\restclient-cpp_x64-windows\lib</p><p>C:\vcpkg\packages\jsoncpp_x64-windows\lib</p></blockquote><p><a href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0263e9553447200b-pi"><img width="726" height="452" title="image" style="display: inline; background-image: none;" alt="image" src="/assets/image_f4bd29.jpg" border="0"></a></p><p><br></p><p><strong>&gt; </strong>Now navigate to <strong>Linker &gt; Input &gt; Additional Dependencies, </strong>and add the full path to the required lib files:</p><blockquote><p>C:\vcpkg\packages\restclient-cpp_x64-windows\lib\restclient-cpp.lib<br>
C:\vcpkg\packages\jsoncpp_x64-windows\lib\jsoncpp.lib</p></blockquote><p><a href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0263e955344b200b-pi"><img width="748" height="466" title="image" style="display: inline; background-image: none;" alt="image" src="/assets/image_b5b00c.jpg" border="0"></a></p><p><br></p><p><strong>&gt;</strong> Now add the following statements at the top of the <strong>CPP</strong> file. </p><blockquote><p>#include &lt;restclient-cpp/restclient.h&gt;<br>
#include &lt;json/json.h&gt;</p><p><br></p><p>using namespace std;</p></blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Followed by:</p><blockquote><p>extern "C" XI_EXPORT bool run(const char* context)<br>
{<br>&nbsp;&nbsp; try<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp; app = Application::get();<br>&nbsp;&nbsp;&nbsp;&nbsp; if (!app)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;</p>
<p>&nbsp;&nbsp;&nbsp; ui = app-&gt;userInterface();<br>&nbsp;&nbsp;&nbsp;&nbsp; if (!ui)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;</p>
<p>&nbsp;&nbsp;&nbsp; string userId = app-&gt;userId();<br>&nbsp;&nbsp;&nbsp;&nbsp; string appId = "1006119760063675415";&nbsp; // App ID<br>&nbsp;&nbsp;&nbsp;&nbsp; string url =&nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp;&nbsp; "<a href="https://apps.exchange.autodesk.com/webservices/checkentitlement%22">https://apps.exchange.autodesk.com/webservices/checkentitlement"</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + string("?userid=") + userId + string("&amp;appid=") + appId;<br>&nbsp;&nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp;&nbsp;&nbsp; RestClient::Response response = RestClient::get(url);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Json::Reader reader;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Json::Value root;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; bool isparseSuccessful = reader.parse(response.body, root);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!isparseSuccessful)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui-&gt;messageBox("Error parsing the string");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((root["IsValid"].asString()) == "true")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui-&gt;messageBox("IsValid is True");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui-&gt;messageBox("IsValid is False");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp; catch (exception ex)<br>&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; return true;<br>
}</p></blockquote><p><strong>&gt;</strong> You can easily figure out the <strong>id </strong>of your app by finding it on the <strong>App Store</strong> and then checking the <strong>URL</strong> in the browser. That will contain an <strong>id</strong> parameter which is what you need in the <strong>appId</strong> variable used in the above code.</p><p><a href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0263e9553450200b-pi"><img width="750" height="627" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/assets/image_9a5196.jpg" border="0"></a></p><p>Now based on whether the app has been downloaded or not, you should either see:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0264e2e763f4200d-pi"><img width="125" height="118" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/assets/image_988cf4.jpg" border="0"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>&nbsp; <a href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0263ec26cdd7200c-pi"><img width="127" height="115" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="/assets/image_4a7fba.jpg" border="0"></a></p><p><br></p><p><strong>2. Python:</strong></p><p>To achieve the same using Python, download the <a href="https://pypi.python.org/pypi/requests#downloads">Requests</a> module. I have also used the built-in <a href="https://docs.python.org/3/library/json.html">JSON</a> package to help parse the HTTP response. </p><p>Add the below lines to import the packages at the top of your <strong>.py</strong> file.</p><blockquote><p>from .modules import requests<p>import json</p></blockquote><p>Followed by:<blockquote><p>def run(context):<p>&nbsp;&nbsp;&nbsp; ui = None<p>try:<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app = adsk.core.Application.get()<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui&nbsp; = app.userInterface<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userId = app.userId<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; appId ="1006119760063675415"<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url&nbsp; = "https://apps.exchange.autodesk.com/webservices/checkentitlement" +<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "?userid=" + userId + "&amp;appid=" + appId<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r = requests.get(url)<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resp_dict = json.loads(r.text)<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val = resp_dict.get('IsValid')<p>if val:<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui.messageBox("IsValid is True")<p>else:<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui.messageBox("IsValid is False")<p>except:<p>if ui:<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui.messageBox('Failed:\n{}'.format(traceback.format_exc()))</p></blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You can find the full source code here:&nbsp; </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a title="https://github.com/sajith-subramanian/EntitlementAPI-for-Fusion-360" href="https://github.com/sajith-subramanian/EntitlementAPI-for-Fusion-360">https://github.com/sajith-subramanian/EntitlementAPI-for-Fusion-360</a></p>
