---
layout: "post"
title: "Avoid Repeating Commands"
date: "2012-05-27 22:28:03"
author: "Barbara Han"
categories:
  - "Barbara Han"
  - "Inventor"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/05/avoid-repeating-commands.html "
typepad_basename: "avoid-repeating-commands"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/barbara-han.html" target="_self">Barbara Han</a></p>  <p><strong>Issue</strong>    <br />In our application, we have command that are context sensitive. These commands can run only if, e.g. a drawing view is selected. Unfortunately Inventor add my command to the repeat last command menu, so my command can be called when no drawing view is selected. Is there a way to avoid the context command from repeating?</p>  <p><strong>Solution</strong>    <br />If adding the context sensitive command to the command category &quot;Context Menu&quot;, this will prevent the command from repeating. The API help document has the following statement:</p>  <p><em>Remarks</em>    <br />Since Autodesk Inventor now has a &quot;repeat last command&quot; context menu feature, care should be exercised when adding custom commands that should execute only in very specific circumstances. â€¦Commands which are in the Context Menu category will not participate in command repeat or customization.</p>  <p>The following VB.NET sample code snippet demonstrates this way:</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><span style="line-height: 11pt; color: "><font face="Courier New"><font style="font-size: 8pt" color="#008000">' Inventor application object.</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> m_inApp </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> Inventor.</font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">Application</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt; color: "><font face="Courier New"><font style="font-size: 8pt" color="#008000">'ButtonDefinitions</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> myButtonDef </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">ButtonDefinition</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> Activate(</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> addInSiteObject </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> Inventor.</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">ApplicationAddInSite</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> firstTime </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">Boolean</font></span><span style="line-height: 11pt"><font color="#000000">) </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">Implements</font></span><span style="line-height: 11pt"><font color="#000000"> Inventor.</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">ApplicationAddInServer</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Activate</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' This method is called by Inventor when it loads the AddIn.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' The AddInSiteObject provides access to the Inventor Application object.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' Initialize AddIn members.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000"></font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000"></font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; m_inApp = addInSiteObject.Application</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> UIEvts </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">UserInputEvents</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> = m_inApp.CommandManager.UserInputEvents</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">AddHandler</font></span><span style="line-height: 11pt"><font color="#000000"> UIEvts.OnContextMenu, </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">AddressOf</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> oUserInput_OnContextMenu</font></span></font></p>    <p style="margin: 0px"><font color="#000000" face="Courier New"><span style="line-height: 11pt"></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' Retrieve the GUID of this class for later use</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> addInCLS </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">GuidAttribute</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; addInCLS = </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">CType</font></span><span style="line-height: 11pt"><font color="#000000">(System.</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">Attribute</font></span><span style="line-height: 11pt"><font color="#000000">.GetCustomAttribute(</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">GetType</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">StandardAddInServer</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">), _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">GetType</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">GuidAttribute</font></span><span style="line-height: 11pt"><font color="#000000">)), </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">GuidAttribute</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> addInCLSIDString </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">String</font></span><span style="line-height: 11pt"><font color="#000000"> = </font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;{&quot;</font></span><span style="line-height: 11pt"><font color="#000000"> &amp; addInCLS.Value &amp; </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#a31515">&quot;}&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' Create the button definition objects</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; myButtonDef = m_inApp.CommandManager.ControlDefinitions.AddButtonDefinition( _</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;Test&quot;</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;vbButton:cloneBtn&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">CommandTypesEnum</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.kShapeEditCmdType, _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; addInCLSIDString, </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;test&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' Link the button objects with the event</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">AddHandler</font></span><span style="line-height: 11pt"><font color="#000000"> myButtonDef.OnExecute, </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">AddressOf</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> MyButtonDefinition_OnExecute</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pCategory </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">CommandCategory</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pCategory = m_inApp.CommandManager.CommandCategories.Item(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;fwxcontextmenucategory&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pCategory.Add(myButtonDef)</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">' End UI customization.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font color="#0000ff" face="Courier New"><span style="line-height: 11pt; color: "></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> oUserInput_OnContextMenu(</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> SelectionDevice </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">SelectionDeviceEnum</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">ByVal</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> AdditionalInfo </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">NameValueMap</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">ByVal</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> CommandBar </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">CommandBar</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> obj </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">Object</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">If</font></span><span style="line-height: 11pt"><font color="#000000"> m_inApp.ActiveDocument.SelectSet.Count = 1 </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; obj = m_inApp.ActiveDocument.SelectSet.Item(1)</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">If</font></span><span style="line-height: 11pt"><font color="#000000"> obj.Type = </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">ObjectTypeEnum</font></span><span style="line-height: 11pt"><font color="#000000">.kDrawingViewObject </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">'add this menu to the context menu</font></span></font></p>    <p style="margin: 0px"><font color="#008000" face="Courier New"><span style="line-height: 11pt; color: "></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">Call</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CommandBar.Controls.AddButton(myButtonDef, 0)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>
