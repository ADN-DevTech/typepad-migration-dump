---
layout: "post"
title: "Maintaining persistent links to objects across Inventor sessions using ReferenceKeys"
date: "2012-12-03 23:22:01"
author: "Vladimir Ananyev"
categories:
  - "Inventor"
  - "Vladimir Ananyev"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/12/maintaining-persistent-links-to-objects-across-inventor-sessions-using-referencekeys.html "
typepad_basename: "maintaining-persistent-links-to-objects-across-inventor-sessions-using-referencekeys"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/manufacturing/vladimir-ananyev.html">Vladimir Ananyev</a></p>  <p><b>Issue</b></p>  <p>How do we use Inventor ReferenceKeys to bind back to Inventor objects between Inventor sessions?</p>  <p>How do we create and store ReferenceKeys, and how do we then obtain our original objects in new Inventor sessions using ReferenceKeys?</p>  <p><a name="section2"></a><b>Solution</b></p>  <p>Many Inventor objects have a unique ID called a 'Reference Key', and these Reference keys are persistent across Inventor sessions. The Inventor API allows you to obtain these Reference keys through the ReferenceKeyManager in the Document object. Through this Reference key it is possible to bind back to the original object at any time.</p>  <p>One of the most common application of Reference Keys is to save the Reference Key associated with individual objects and later bind back to these objects through those Keys. For example we can iterate through all Faces in the SurfaceBody object, and store Reference Keys into some persistent storage. Later on we need not iterate through all the faces of the SurfaceBody again, we can simply read the keys from the persistent storage and obtain the original faces using the Reference Keys.</p>  <p>The Reference Keys also have a 'context' associated with them. The context is used to reduce the size of the Reference Key when binding to BRep entities. At present it can be ignored for other entity types. The context can be thought of as a table of Inventor objects, with a Reference Key being an index into this table.</p>  <p>For saving and restoring the keys we need to follow some basic guidelines as outlined below.</p>  <p>Saving the Reference Keys:</p>  <p>1. Get the ReferenceKeyManager from the Document object.    <br />2. Create the context using ReferenceKeyManager.     <br />3. Obtain the Reference Key from desired objects.     <br />4. Store the Reference Keys into persistent storage (e.g. text file on disk).     <br />5. Save the context into array (ReferenceKeyManager.SaveContextToArray).     <br />6. Store the Context Array into persistent storage</p>  <p>Reading the Reference Keys and binding back to the original object -</p>  <p>1. Read the Reference Keys.</p>  <p>2. Read context array.</p>  <p>3. Create the context from context array (using ReferenceKeyManager.LoadContextFromArray) .    <br />4. Bind back to the original objects is now available using Reference Keys and context (via ReferenceKeyManager.BindKeyToObject).</p>  <p>Note: similar tasks often can be solved using Inventor attributes. </p>  <p>Here are VB.NET and C# standalone exe samples that connect to Inventor from out of process and demonstrate the use of Reference keys.</p>  <p>&#160;</p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">VB .NET</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Runtime.InteropServices</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.IO</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> Inventor</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Class</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Form1</font></span></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Name of the file for saving reference keys </font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> _Filename </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">String</font></span><font color="#000000"> = </font></font><span><font style="font-size: 8pt" color="#a31515">&quot;c:\temp\keydata.txt&quot;</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> _oApp </font><span><font color="#0000ff">As</font></span><font color="#000000"> Inventor.</font></font><span><font style="font-size: 8pt" color="#2b91af">Application</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> Form1_Load(sender </font><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">Object</font></span><font color="#000000">, _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">e </font></font><font style="font-size: 8pt"><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">EventArgs</font></span><font color="#000000">) _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Handles</font></span><font color="#000000"> </font><span><font color="#0000ff">MyBase</font></span><font color="#000000">.Load</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">_oApp = </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Marshal</font></span><font color="#000000">.GetActiveObject(</font><span><font color="#a31515">&quot;Inventor.Application&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Catch</font></span><font color="#000000"> ex </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Exception</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">Beep()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Can't get Inventor&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">End</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#008000">'Load</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> btn_GetKeys_Click(sender </font><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">Object</font></span><font color="#000000">, _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">e </font></font><font style="font-size: 8pt"><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">EventArgs</font></span><font color="#000000">) _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Handles</font></span><font color="#000000"> btn_GetKeys.Click</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Call</font></span><font color="#000000"> GetKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> btn_UseKeys_Click(sender </font><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">Object</font></span><font color="#000000">, _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">e </font></font><font style="font-size: 8pt"><span><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span><font color="#2b91af">EventArgs</font></span><font color="#000000">) _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Handles</font></span><font color="#000000"> btn_UseKeys.Click</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Call</font></span><font color="#000000"> ReadFaceKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Private</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> GetKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">If</font></span><font color="#000000"> _oApp.Documents.Count = 0 </font></font><span><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Exit Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">If</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">If</font></span><font color="#000000"> _oApp.ActiveDocument.DocumentType &lt;&gt; _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">DocumentTypeEnum</font></span><font color="#000000">.kPartDocumentObject </font></font><span><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Open or Activate Part Document&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Exit Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">If</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oDoc </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">PartDocument</font></span><font color="#000000"> = _oApp.ActiveDocument</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oDef </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">PartComponentDefinition</font></span><font color="#000000"> = oDoc.ComponentDefinition</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oRefKeyMgr </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">ReferenceKeyManager</font></span><font color="#000000"> = oDoc.ReferenceKeyManager</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' The keys will be written to binary file for later access</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> binWriter </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BinaryWriter</font></span><font color="#000000">( _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">System.IO.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">File</font></span><font color="#000000">.Open(_Filename, </font><span><font color="#2b91af">FileMode</font></span><font color="#000000">.Create))</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> lContext </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Long</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> byContext() </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000"> = </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000">() {}<span style="mso-spacerun: yes">&#160; </span></font></font><span><font style="font-size: 8pt" color="#008000">' initilization</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' The conext should be created only once</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">lContext = oRefKeyMgr.CreateKeyContext</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Dump the number of faces in this model</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(oDef.SurfaceBodies(1).Faces.Count())</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Iterate through all faces and dump key</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oFace </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Face</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">For</font></span><font color="#000000"> </font><span><font color="#0000ff">Each</font></span><font color="#000000"> oFace </font><span><font color="#0000ff">In</font></span><font color="#000000"> oDef.SurfaceBodies(1).Faces</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' get key from oFace</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> byKey() </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000"> = </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000">() {}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oFace.GetReferenceKey(byKey, lContext)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' save the key size and key in the file</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byKey.Length)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byKey)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Next</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' We have finished creating all the keys, </font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' now save the long context as byte array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Context should be saved after creating all the keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oRefKeyMgr.SaveContextToArray(lContext, byContext)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Dump the size and context array into file</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byContext.Length)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byContext)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Catch</font></span><font color="#000000"> ex </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">SystemException</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(ex.ToString())</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Finally</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Close()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Reference Keys are Saved in the file:&quot;</font></span><font color="#000000"> &amp; vbNewLine &amp; _Filename)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oRefKeyMgr = </font></font><span><font style="font-size: 8pt" color="#0000ff">Nothing</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oDoc = </font></font><span><font style="font-size: 8pt" color="#0000ff">Nothing</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#008000">'GetKeys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Sub</font></span><font color="#000000"> ReadFaceKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">If</font></span><font color="#000000"> _oApp.Documents.Count = 0 </font></font><span><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Exit Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">If</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">If</font></span><font color="#000000"> _oApp.ActiveDocument.DocumentType &lt;&gt; _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">DocumentTypeEnum</font></span><font color="#000000">.kPartDocumentObject </font></font><span><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Open or Activate Part Document&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Exit Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">If</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oDoc </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">PartDocument</font></span><font color="#000000"> = _oApp.ActiveDocument</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oDef </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">PartComponentDefinition</font></span><font color="#000000"> = oDoc.ComponentDefinition</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oRefKeyMgr </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">ReferenceKeyManager</font></span><font color="#000000"> = oDoc.ReferenceKeyManager</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> lContext </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Long</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> byContext() </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000"> = </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000">() {}<span style="mso-spacerun: yes">&#160; </span></font></font><span><font style="font-size: 8pt" color="#008000">' initilization</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Open the File to read the Face keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> binReader </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BinaryReader</font></span><font color="#000000">( _</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">System.IO.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">File</font></span><font color="#000000">.Open(_Filename, </font><span><font color="#2b91af">FileMode</font></span><font color="#000000">.Open))</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Reset the position in the stream to zero.</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binReader.BaseStream.Seek(0, </font></font><font style="font-size: 8pt"><span><font color="#2b91af">SeekOrigin</font></span><font color="#000000">.Begin)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> nFaces </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Long</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Create collection object to hold all keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oKeysColl </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Collection</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Read the number of faces</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nFaces = binReader.ReadInt32</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span><font style="font-size: 8pt"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span></font></font><span><font style="font-size: 8pt" color="#008000">'Read All keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> nSize </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Int32</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">For</font></span><font color="#000000"> ii </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">Int16</font></span><font color="#000000"> = 1 </font><span><font color="#0000ff">To</font></span><font color="#000000"> nFaces</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> byKey() </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000"> = </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000">() {}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Read the key Size</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nSize = binReader.ReadInt32</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Read the key</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">byKey = binReader.ReadBytes(nSize)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oKeysColl.Add(byKey)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Next</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Read the size of context Array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nSize = binReader.ReadInt32()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">byContext = binReader.ReadBytes(nSize)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Finally</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binReader.Close()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">' Now create the long context from context array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">lContext = oRefKeyMgr.LoadContextFromArray(byContext)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">'visualize faces associated with reference keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oHSet </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">HighlightSet</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet = oDoc.HighlightSets.Add</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.SetColor(0, 255, 0)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> FoundFaces </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Integer</font></span><font color="#000000"> = 0</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">For</font></span><font color="#000000"> i </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Integer</font></span><font color="#000000"> = 1 </font><span><font color="#0000ff">To</font></span><font color="#000000"> nFaces</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oFace </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">Face</font></span><font color="#000000"> = </font></font><span><font style="font-size: 8pt" color="#0000ff">Nothing</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> oKey() </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#0000ff">Byte</font></span><font color="#000000"> = </font><span><font color="#0000ff">CType</font></span><font color="#000000">(oKeysColl.Item(i), </font><span><font color="#0000ff">Byte</font></span><font color="#000000">())</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oFace = oRefKeyMgr.BindKeyToObject(oKey, lContext)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.AddItem(oFace)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">FoundFaces += 1</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Catch</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Unable to to Bind Key to Object&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Exit Sub</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Next</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">If</font></span><font color="#000000"> FoundFaces = nFaces </font></font><span><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;All faces bound back successfully&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.Clear()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">Else</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">MsgBox(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Couldn't find &quot;</font></span><font color="#000000"> &amp; nFaces - FoundFaces &amp; </font><span><font color="#a31515">&quot; faces&quot;</font></span><font color="#000000">)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">If</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#008000">'ReadFaceKeys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Class</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#008000">'Form1</font></span></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">C#</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt" class="MsoNoSpacing"><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Collections.Generic;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.ComponentModel;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Data;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Drawing;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Linq;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Text;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Windows.Forms;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> Inventor;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.Runtime.InteropServices;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> System.IO;</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><font face="Lucida Console"><span style="font-family: ; mso-bidi-font-family: consolas"><font color="#0000ff"><font style="font-size: 8pt">namespace</font></font></span><span style="font-family: ; mso-bidi-font-family: consolas"><font style="font-size: 8pt" color="#000000"> RefKeys_CSharp_2</font></span></font></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">public</font></span><font color="#000000"> </font><span><font color="#0000ff">partial</font></span><font color="#000000"> </font><span><font color="#0000ff">class</font></span><font color="#000000"> </font><span><font color="#2b91af">Form1</font></span><font color="#000000"> : </font></font><span><font style="font-size: 8pt" color="#2b91af">Form</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Reference to Inventor application</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">Inventor.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">Application</font></span><font color="#000000"> oApp = </font><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">private</font></span><font color="#000000"> </font><span><font color="#0000ff">string</font></span><font color="#000000"> _Title = </font><span><font color="#a31515">&quot;Reference Keys Demo&quot;</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">private</font></span><font color="#000000"> </font><span><font color="#0000ff">string</font></span><font color="#000000"> _Filename<span style="mso-spacerun: yes">&#160; </span>= </font><span><font color="#a31515">@&quot;c:\temp\keydata.txt&quot;</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">public</font></span><font color="#000000"> Form1()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">InitializeComponent();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oApp = (Inventor.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">Application</font></span><font color="#000000">)</font><span><font color="#2b91af">Marshal</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">.GetActiveObject(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;Inventor.Application&quot;</font></span><font color="#000000">);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">catch</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Can't get Inventor session.&quot;</font></span><font color="#000000">, </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#a31515">&quot;Reference Keys Demo&quot;</font></span><font color="#000000">);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">private</font></span><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> btn_GetKeys_Click(</font><span><font color="#0000ff">object</font></span><font color="#000000"> sender, </font><span><font color="#2b91af">EventArgs</font></span><font color="#000000"> e)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">SaveFaceKeys();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">private</font></span><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> btn_FindFaces_Click(</font><span><font color="#0000ff">object</font></span><font color="#000000"> sender, </font><span><font color="#2b91af">EventArgs</font></span><font color="#000000"> e)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">FindFacesByKeys();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">/////////////////////////////////////////////////////////////</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">//<span style="mso-spacerun: yes">&#160; </span>Extract reference keys from faces and save them on disk</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">/////////////////////////////////////////////////////////////</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">void</font></span><font color="#000000"> SaveFaceKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// verify if part document is active</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (oApp.Documents.Count == 0)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (oApp.ActiveDocument.DocumentType != </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">DocumentTypeEnum</font></span><font color="#000000">.kPartDocumentObject)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">PartDocument</font></span><font color="#000000"> oDoc = (</font><span><font color="#2b91af">PartDocument</font></span><font color="#000000">)oApp.ActiveDocument;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">PartComponentDefinition</font></span><font color="#000000"> oDef = oDoc.ComponentDefinition;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">ReferenceKeyManager</font></span><font color="#000000"> oRefKeyMgr = oDoc.ReferenceKeyManager;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span><font style="font-size: 8pt"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span></font></font><span><font color="#008000"><font style="font-size: 8pt">// The keys will be written to binary file for later access</font><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span></font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">BinaryWriter</font></span><font color="#000000"> binWriter = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">BinaryWriter</font></span><font color="#000000">( </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">System.IO.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">File</font></span><font color="#000000">.Open(_Filename, </font><span><font color="#2b91af">FileMode</font></span><font color="#000000">.Create));</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// The conext should be created only once</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">int</font></span><font color="#000000"> lContext = oRefKeyMgr.CreateKeyContext();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">byte</font></span><font color="#000000">[] byContext = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#0000ff">byte</font></span><font color="#000000">[] {}; </font></font><span><font style="font-size: 8pt" color="#008000">// initilization</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font color="#008000"><font style="font-size: 8pt">// Dump the number of faces in this model</font><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span></font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(oDef.SurfaceBodies[1].Faces.Count);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><span style="mso-spacerun: yes"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Iterate through all faces and dump key</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span><font color="#2b91af">Face</font></span><font color="#000000"> oFace </font><span><font color="#0000ff">in</font></span><font color="#000000"> oDef.SurfaceBodies[1].Faces)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// get key from oFace</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">byte</font></span><font color="#000000">[] byKey = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#0000ff">byte</font></span><font color="#000000">[] { };</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oFace.GetReferenceKey(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">ref</font></span><font color="#000000"> byKey, lContext);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Dump the key size and key in file</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byKey.Length);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byKey);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">//<span style="mso-spacerun: yes">&#160; </span>We have finished creating all the keys, </font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// now save the long context as byte array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Context should be saved after creating all the keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oRefKeyMgr.SaveContextToArray(lContext, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">ref</font></span><font color="#000000"> byContext);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Dump the size and context array into file</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byContext.Length);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Write(byContext);</font><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160; </font></span></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">catch</font></span><font color="#000000"> (</font><span><font color="#2b91af">Exception</font></span><font color="#000000"> ex)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// show error message</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(ex.ToString(), _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">finally</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{ </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binWriter.Close();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Reference Keys are Saved in the file: \n&quot;</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">+ _Filename, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oRefKeyMgr = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oDoc = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}<span style="mso-spacerun: yes">&#160; </span></font></font><span><font style="font-size: 8pt" color="#008000">//SaveFaceKeys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><span style="mso-spacerun: yes"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; </font></font></span></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">/////////////////////////////////////////////////////////////</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">//<span style="mso-spacerun: yes">&#160; </span>Read reference keys from file and find associated faces</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">/////////////////////////////////////////////////////////////</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">private</font></span><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> FindFacesByKeys()</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// verify if part document is active</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (oApp.Documents.Count == 0)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span><font style="font-size: 8pt"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span></font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (oApp.ActiveDocument.DocumentType != </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">DocumentTypeEnum</font></span><font color="#000000">.kPartDocumentObject)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Open Part Document&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">PartDocument</font></span><font color="#000000"> oDoc = (</font><span><font color="#2b91af">PartDocument</font></span><font color="#000000">)oApp.ActiveDocument;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">PartComponentDefinition</font></span><font color="#000000"> oDef = oDoc.ComponentDefinition;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">ReferenceKeyManager</font></span><font color="#000000"> oRefKeyMgr = oDoc.ReferenceKeyManager;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">int</font></span><font color="#000000"> lContext;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">byte</font></span><font color="#000000">[] byContext = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#0000ff">byte</font></span><font color="#000000">[] { }; </font></font><span><font color="#008000"><font style="font-size: 8pt">// initilization</font><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span></font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Open the File to read the Face keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">BinaryReader</font></span><font color="#000000"> binReader = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">BinaryReader</font></span><font color="#000000">(</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">System.IO.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">File</font></span><font color="#000000">.Open(_Filename, </font><span><font color="#2b91af">FileMode</font></span><font color="#000000">.Open));</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Reset the position in the stream to zero.</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binReader.BaseStream.Seek(0, </font></font><font style="font-size: 8pt"><span><font color="#2b91af">SeekOrigin</font></span><font color="#000000">.Begin);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">int</font></span><font color="#000000"> nFaces = 0;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Create collection object to hold all keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">var</font></span><font color="#000000"> oKeysColl = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">List</font></span><font color="#000000">&lt;</font><span><font color="#0000ff">byte</font></span><font color="#000000">[]&gt; { };</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#0000ff">try</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read the number of faces</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nFaces = binReader.ReadInt32();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read All keys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">int</font></span><font color="#000000"> nSize;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">for</font></span><font color="#000000"> (</font><span><font color="#0000ff">int</font></span><font color="#000000"> i = 1; i &lt;= nFaces; i++)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160; </font></span><font style="font-size: 8pt"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160; </span>{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">byte</font></span><font color="#000000">[] byKey = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#0000ff">byte</font></span><font color="#000000">[] { };</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read the key Size</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nSize = binReader.ReadInt32();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read the key</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">byKey = binReader.ReadBytes(nSize);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oKeysColl.Add(byKey);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read the size of context array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">nSize = binReader.ReadInt32();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Read the context array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">byContext = binReader.ReadBytes(nSize);</font><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">finally</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">binReader.Close();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><span style="mso-spacerun: yes"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; </font></font></span></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// Now create the long context from context array</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">lContext = oRefKeyMgr.LoadContextFromArray(byContext);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span><font style="font-size: 8pt" color="#008000">// visualize faces</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">HighlightSet</font></span><font color="#000000"> oHSet = oDoc.HighlightSets.Add();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.SetColor(0, 255, 0);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">for</font></span><font color="#000000"> (</font><span><font color="#0000ff">int</font></span><font color="#000000"> i = 1; i &lt;= nFaces; i++)</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">Face</font></span><font color="#000000"> oFace = </font><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">try</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{ </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">byte</font></span><font color="#000000">[] oRefKey = (</font><span><font color="#0000ff">byte</font></span><font color="#000000">[])oKeysColl[i-1];</font></font><span style="mso-spacerun: yes"><font style="font-size: 8pt" color="#000000">&#160; </font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">object</font></span><font color="#000000"> MatchType = </font><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oFace = oDoc.ReferenceKeyManager.BindKeyToObject(</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">ref</font></span><font color="#000000"> oRefKey, lContext, </font><span><font color="#0000ff">out</font></span><font color="#000000"> MatchType) </font><span><font color="#0000ff">as</font></span><font color="#000000"> </font><span><font color="#2b91af">Face</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.AddItem(oFace);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">catch</font></span><font color="#000000"> </font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">{</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;Unable to to Bind Key to Object&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">}</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font><span><font color="#a31515">&quot;All faces found back successfully&quot;</font></span><font color="#000000">, _Title);</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oHSet.Clear();</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oRefKeyMgr = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 8pt">oDoc = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">} </font></font><span><font style="font-size: 8pt" color="#008000">//FindFacesByKeys</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">&#160;</font></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160; </font></span><font style="font-size: 8pt">} </font></font><span><font style="font-size: 8pt" color="#008000">//Form1</font></span></font></span></p>  <p style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; mso-bidi-font-family: consolas"><font face="Lucida Console"><font style="font-size: 8pt" color="#000000">} </font></font></span><span style="mso-bidi-font-size: 11.0pt"><font face="Calibri"><font style="font-size: 16pt" color="#000000">&#160;</font></font></span></p>
