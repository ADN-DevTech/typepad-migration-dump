---
layout: "post"
title: "use Reference Keys in C#"
date: "2012-06-10 07:58:16"
author: "Xiaodong Liang"
categories:
  - "Inventor"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/manufacturing/2012/06/use-reference-keys-in-c.html "
typepad_basename: "use-reference-keys-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><b>Issue</b></p>  <p>My compiler complains about the type of the parameters I need to provide to the &quot;ReferenceKeyManager.SaveContextToArray&quot; and &quot;ReferenceKeyManager.BindKeyToObject&quot; methods. Could you give the right syntax when using C# ?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>The C sharp&#160; illustrates how to create a ReferenceKey for the selected Face and how to retrieve this object using the created key. The code can easily be extended to handle different types of BRep entities. </p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: blue">using</span> Inventor;</p> </div>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="color: green">// demo how to get reference key of a face</span></p>      <p style="margin: 0px"><span style="color: blue">void</span> GetFaceReferenceKey(<span style="color: #2b91af">Document</span> oDoc, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Face</span> oFace, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: #2b91af">Array</span> oRefKey, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: #2b91af">Array</span> oContextData)</p>      <p style="margin: 0px">{</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Create a key context </span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// (required to obtain ref keys for BRep entities)</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">int</span> KeyContext = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDoc.ReferenceKeyManager.CreateKeyContext();</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Get a reference key for the face</span></p>      <p style="margin: 0px">&#160;&#160;&#160; oFace.GetReferenceKey(<span style="color: blue">ref</span> oRefKey, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; KeyContext);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Save KeyContext as a byte array for future use</span></p>      <p style="margin: 0px">&#160;&#160;&#160; oDoc.ReferenceKeyManager.</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SaveContextToArray(KeyContext, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oContextData);</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// demo how to locate a face by its reference key</span></p>      <p style="margin: 0px"><span style="color: #2b91af">Face</span> GetFaceFromReferenceKey(<span style="color: #2b91af">Document</span> oDoc,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: #2b91af">Array</span> oRefKey, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: #2b91af">Array</span> oContextData)</p>      <p style="margin: 0px">{</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Retrieve ContextKey from byte array</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">int</span> oKeyContext = oDoc.ReferenceKeyManager.</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LoadContextFromArray(<span style="color: blue">ref</span> oContextData);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Bind reference key to the Face object</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">object</span> MatchType;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Face</span> oFace =</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDoc.ReferenceKeyManager.BindKeyToObject(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oRefKey,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oKeyContext, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">out</span> MatchType) <span style="color: blue">as</span> <span style="color: #2b91af">Face</span>;</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">//Return result</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">return</span> oFace;</p>      <p style="margin: 0px">}</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px"><span style="color: green">// demo get and use reference key</span></p>      <p style="margin: 0px"><span style="color: blue">private</span> <span style="color: blue">void</span> button1_Click(<span style="color: blue">object</span> sender, <span style="color: #2b91af">EventArgs</span> e)</p>      <p style="margin: 0px">{</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Array</span> oRefKey = <span style="color: blue">new</span> <span style="color: #2b91af">Byte</span>[] { };</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Array</span> oContextData = <span style="color: blue">new</span> <span style="color: #2b91af">Byte</span>[] { };</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (mApplication.ActiveDocument.SelectSet.Count != 1)</p>      <p style="margin: 0px">&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.Windows.Forms.<span style="color: #2b91af">MessageBox</span>.Show(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;A unique face must be selected...&quot;</span>);</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// assume we have selected a face</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Face</span> oFace = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mApplication.ActiveDocument.SelectSet[1] <span style="color: blue">as</span> <span style="color: #2b91af">Face</span>;</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (oFace == <span style="color: blue">null</span>)</p>      <p style="margin: 0px">&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.Windows.Forms.<span style="color: #2b91af">MessageBox</span>.Show(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;A unique face must be selected...&quot;</span>);</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; GetFaceReferenceKey(mApplication.ActiveDocument,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; oFace, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oRefKey, </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oContextData);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Face</span> retFace = </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; GetFaceFromReferenceKey(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; mApplication.ActiveDocument,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oRefKey,</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> oContextData);</p>      <p style="margin: 0px">&#160;</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// locate the face by its reference key.</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// compare if the face from key is same to what we have </span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// selected</span></p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (System.<span style="color: #2b91af">Object</span>.ReferenceEquals(oFace, retFace))</p>      <p style="margin: 0px">&#160;&#160;&#160; {</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.Windows.Forms.<span style="color: #2b91af">MessageBox</span>.Show(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Face retrieved from ref key...&quot;</span>);</p>      <p style="margin: 0px">&#160;&#160;&#160; }</p>      <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">else</span> </p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.Windows.Forms.<span style="color: #2b91af">MessageBox</span>.Show(</p>      <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Error: Invalid face...&quot;</span>);</p>      <p style="margin: 0px">}</p>   </div>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160; <p>&#160;</p>   </p> </div>
