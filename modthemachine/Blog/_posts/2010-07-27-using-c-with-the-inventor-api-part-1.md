---
layout: "post"
title: "Using C# with the Inventor API (Part 1)"
date: "2010-07-27 19:47:34"
author: "Adam Nagy"
categories:
  - "Brian"
original_url: "https://modthemachine.typepad.com/my_weblog/2010/07/using-c-with-the-inventor-api-part-1.html "
typepad_basename: "using-c-with-the-inventor-api-part-1"
typepad_status: "Publish"
---

<p>My <a href="http://modthemachine.typepad.com/my_weblog/2010/07/sketch-curve-as-line-segments-in-vbnet-and-c.html#scrollDown">last post</a> contained VB.Net and C# versions of a VBA program from an <a href="http://modthemachine.typepad.com/my_weblog/2010/07/approximating-a-sketch-curve-with-line-segments.html#tp">earlier post</a>.&#160; Converting the VBA program to VB.Net was relatively easy.&#160; The conversion to C# wasn’t as easy.&#160; In this post I want to begin covering many of the issues you’ll run into when converting VBA code to C#.</p>  <p>One question that might come to mind is why would you want to convert from VBA and not just write everything in C# to begin with?&#160; The first reason is that many of the programming samples you’ll find for the Inventor API are written using VBA.&#160; The second reason is that VBA remains the fastest and easiest way to access and use the Inventor API.&#160; Having said that, it does have a lot of other shortcomings so I wouldn’t recommend it for general development, but if you’re not using it for prototyping you’re missing out on a very powerful tool.</p>  <p>To go from VBA to C#, I’ve found the simplest method is to first convert the code to VB.Net.&#160; This is typically fairly easy, particularly if the VBA code was written with going to VB.Net in mind.&#160; For example, all arrays should be 0 based.&#160; In many cases it’s just a copy and paste and Visual Studio will automatically do some syntax conversion.&#160; Some of the manual changes that were required I went over in the <a href="http://modthemachine.typepad.com/my_weblog/2010/07/sketch-curve-as-line-segments-in-vbnet-and-c.html">previous post</a>.&#160; The next step is to go from VB.Net to C#.&#160; There are some converters that do a pretty good job of automatically converting the VB.Net code to C#.&#160; I found an online converter using Google that worked great.&#160; (For any syntax issues that might still come up, here’s a <a href="http://www.harding.edu/fmccown/vbnet_csharp_comparison.html">good comparison of VB.Net and C#</a>.)&#160; Next you’ll need to account for other differences that are typically specific to a COM Automation API, like Inventor’s.&#160; It’s those issues that this series of posts will attempt to cover.</p>  <p><strong><em>Item Property</em>       <br /></strong>C# hides the fact that there’s an Item property on the Inventor collection objects so&#160; you access the contents of the collection as if it was a read-only array, except the first item has an index of 1. </p> VBA   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">&#160;&#160;&#160; Dim body As SurfaceBody&#160; <br />&#160;&#160;&#160; Set body = partDef.SurfaceBodies.Item(1) </div>  <br />C#   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">&#160;&#160;&#160; SurfaceBody body;    <br />&#160;&#160;&#160; body = partDef.SurfaceBodies[1];     <br /></div>  <p><strong>     <br /><em>Comparing Two Objects</em>       <br /></strong>Sometimes you need to check if two variables referencing objects are referring to the same object.&#160; Here’s how you do it in VBA and C# </p> VBA   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get a parameter using two different collections.        <br /></strong></font>&#160;&#160;&#160; Dim var1 As Parameter     <br />&#160;&#160;&#160; Set var1 = partDef.Parameters.Item(&quot;Length&quot;)     <br />&#160;&#160;&#160; Dim var2 As ModelParameter     <br />&#160;&#160;&#160; Set var2 = partDef.Parameters.ModelParameters.Item(&quot;Length&quot;)&#160;&#160; <br />    <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Verify that the variables are referencing the same parameter.        <br /></strong></font>&#160;&#160;&#160; If var1 Is var2 Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;The two variables reference the same object.&quot;     <br />&#160;&#160;&#160; End If </div>  <br />C#   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160; // Get a parameter using two different collections.&#160; <br /></strong></font>&#160; Parameter var1 = partDef.Parameters[&quot;Length&quot;];&#160; <br />&#160; ModelParameter var2;     <br />&#160; var2 = partDef.Parameters.ModelParameters[&quot;Length&quot;];&#160; <br />    <br /><font color="#0000ff"><strong>&#160; // Verify that the variables are referencing the same parameter.&#160; <br /></strong></font>&#160; if (var1 == var2)&#160; <br />&#160; {&#160; <br />&#160;&#160;&#160; MessageBox.Show(&quot;The two variables reference the same object.&quot;);&#160; <br />&#160; } </div>  <p>   <br /><strong><em>Checking the Type of an Object</em></strong>     <br />Sometimes it’s useful to be able to check if an object is a certain type.&#160; Both VBA and C# provide an easy way to do this. </p> VBA   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the selected object.&#160; <br />&#160;&#160;&#160; ' This will fail if nothing is selected.         <br /></strong></font>&#160;&#160;&#160; Dim selectedObject As Object     <br />&#160;&#160;&#160; Set selectedObject = _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThisApplication.ActiveDocument.SelectSet.Item(1)     <br />    <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Check that the selected object is a sketch line.        <br /></strong></font>&#160;&#160;&#160; If TypeOf selectedObject Is SketchLine Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;Selected object is a sketch line&quot;     <br />&#160;&#160;&#160; Else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;Something besides a sketch line is selected.&quot;     <br />&#160;&#160;&#160; End If </div>  <br />C#   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160;&#160;&#160; // Get the selected object.&#160; <br />&#160;&#160;&#160; // This will fail if nothing is selected.         <br /></strong></font>&#160;&#160;&#160; object selectedObject = invApp.ActiveDocument.SelectSet[1];     <br />    <br /><font color="#0000ff"><strong>&#160;&#160;&#160; // Check that the selected object is a sketch line.        <br /></strong></font>&#160;&#160;&#160; if (selectedObject is SketchLine)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MessageBox.Show(&quot;Selected object is a sketch line&quot;);     <br />&#160;&#160;&#160; else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MessageBox.Show(&quot;Something besides a sketch line is     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; selected.&quot;); </div>  <p></p>  <p><strong><em>       <br />Iterating Through the Contents of a Collection</em></strong>     <br />Using a For Each loop is the most efficient way to iterate through the contents of a collection.&#160; In some cases it can be much faster than using the collection’s Count and Item properties. </p> VBA   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160;&#160;&#160; ' Iterate over all of the faces in the primary body.        <br /></strong></font>&#160;&#160;&#160; Dim area As Double     <br />&#160;&#160;&#160; Dim partFace As Face     <br />&#160;&#160;&#160; For Each partFace In partDef.SurfaceBodies.Item(1).Faces     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; area = area + partFace.Evaluator.area     <br />&#160;&#160;&#160; Next     <br />    <br />&#160;&#160;&#160; MsgBox &quot;Total surface area: &quot; &amp; area &amp; &quot; cm^2&quot;</div>  <br />C#   <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new"><font color="#0000ff"><strong>&#160;&#160;&#160; // Iterate over all of the faces in the primary body.        <br /></strong></font>&#160;&#160;&#160; double area = 0;     <br />&#160;&#160;&#160; foreach( Face partFace in partDef.SurfaceBodies[1].Faces)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; area += partFace.Evaluator.Area;     <br />&#160;&#160;&#160; }     <br />    <br />&#160;&#160;&#160; MessageBox.Show(&quot;Total surface area: &quot; + area + &quot; cm^2&quot;);</div>
