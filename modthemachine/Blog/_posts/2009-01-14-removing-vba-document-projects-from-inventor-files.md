---
layout: "post"
title: "Removing VBA Document Projects From Inventor Files"
date: "2009-01-14 03:52:47"
author: "Adam Nagy"
categories:
  - "Brian"
  - "Visual Basic for Applications (VBA)"
original_url: "https://modthemachine.typepad.com/my_weblog/2009/01/removing-vba-document-projects-from-inventor-files.html "
typepad_basename: "removing-vba-document-projects-from-inventor-files"
typepad_status: "Publish"
---

<p>I received an email recently with a question that relates back to a series of past postings in this blog.&#0160; They used the previous blog postings to migrate their document macros to an add-in but are now wondering how to remove their document macros from their files.&#0160; There are three approaches that I&#39;m aware of to do this.&#0160; With all of these make sure you have a back up of the file before deleting the macros.</p>
<p>First, you can manually open each document and use the VBA editor to delete the code from the document project.&#0160; This is fine if you only have a handful of documents but is tedious if you have many documents.&#0160; The advantages to this approach is that it&#39;s simple and also gives you the flexibility to look at the macros within the document and decide one-by-one whether to delete and/or to copy the macro to the application project.</p>
<p>Second, you can use a VBA macro to automate the deletion.&#0160; Here&#39;s a VBA macro that I wrote using the functionality provided by Inventor&#39;s API and the VBA Extensibility library to manipulate a VBA project.&#0160; It either comments or deletes all automatic macros from the specified VBA project.&#0160; You could easily wrap this to open, process, and save many documents.&#0160; This will leave any other macros in the project alone.&#0160; There are some cases where you might have a regular macro (vs. an auto macro) that is specific to that document and you don&#39;t want to delete it.&#0160; To use the macro below, copy and paste it into your application project and add a reference to the <strong>Microsoft Visual Basic for Applications Extensibility 5.3</strong> library. <br /></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">
<p><strong><font color="#0000ff">&#39; Sub to test the DeleteAutoMacros sub. <br /></font></strong>Public Sub TestDeleteAutoMacros() <br />&#0160;&#0160;&#0160; Dim oActiveDocument As Document <br />&#0160;&#0160;&#0160; Set oActiveDocument = ThisApplication.activeDocument <br />&#0160;&#0160;&#0160; Call DeleteAutoMacros(oActiveDocument.VBAProject, True) <br />End Sub <br /><br /><br /></p>
<p><strong><font color="#0000ff">&#39; Given an Inventor VBA project as input, this <br />&#39; deletes or comments the code for all of the <br />&#39; automatic macros contained within the project. <br /></font></strong>Private Sub DeleteAutoMacros( _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal VBAProject As InventorVBAProject, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Optional ByVal Comment As Boolean = True) <br /><font color="#0000ff"><strong>&#0160;&#0160; &#39; Iterate through the modules of the document project. <br /></strong></font>&#0160;&#0160; Dim oModule As InventorVBAComponent <br />&#0160;&#0160; For Each oModule In VBAProject.InventorVBAComponents <br /><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Check to see if this is a code module or document module. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160; If oModule.VBComponent.Type = vbext_ct_StdModule Or _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oModule.VBComponent.Type = vbext_ct_Document Then <br /><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Look for any auto macros. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim oFunction As InventorVBAMember <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; For Each oFunction In oModule.InventorVBAMembers <br /><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Check that this is an automatic macro. <br /></font>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Select Case LCase(oFunction.Name) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Case &quot;autosave&quot;, &quot;autoopen&quot;, &quot;autonew&quot;, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &quot;autoclose&quot;, &quot;autoedit&quot; <br /><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Get the VBIDE object that represents the module. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim oVBCodeModule As codeModule <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set oVBCodeModule = oModule.VBComponent.codeModule </p>
<p><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Get the start line and length of the module. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim iStartLine As Long <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iStartLine = oVBCodeModule.ProcStartLine( _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oFunction.Name, vbext_pk_Proc) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim iNumLines As Long <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iNumLines = oVBCodeModule.ProcCountLines( _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oFunction.Name, vbext_pk_Proc) </p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; If Comment Then <br /><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Get the macro as a string. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim strMacroLines As String <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; strMacroLines = oVBCodeModule.Lines( _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iStartLine, iNumLines) </p>
<p><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Insert a comment at the beginning line. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; strMacroLines = &quot;&#39; &quot; &amp; strMacroLines </p>
<p><font color="#0000ff"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Add a comment at the beginning of each line. <br /></strong></font>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; strMacroLines = Replace(strMacroLines, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vbCrLf, vbCr &amp; &quot;&#39; &quot;) </p>
<p><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Delete the existing macro. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Call oVBCodeModule.DeleteLines(iStartLine, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iNumLines) </p>
<p><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Add the commented version of the macro. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Call oVBCodeModule.InsertLines(iStartLine, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; strMacroLines) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Else <br /><strong><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Delete the lines. <br /></font></strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Call oVBCodeModule.DeleteLines(iStartLine, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iNumLines) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; End If <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; End Select <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Next <br />&#0160;&#0160;&#0160;&#0160;&#0160; End If <br />&#0160;&#0160; Next <br />End Sub</p></div>
<br />
<p>The third option is to use this <a href="http://modthemachine.typepad.com/files/deletevba-1.zip">Delete VBA</a> utility to completely remove the VBA project from the document.&#0160; It&#39;s a command line utility.&#0160; Just supply the filename of the Inventor file as an argument when run from the command line.&#0160; The zip file in the link contains the program and the source code.&#0160; To use it you only need the DeleteVBA.exe file.&#0160; If you&#39;re sure you don&#39;t have any other VBA code in the document that you care about this is the best option.</p>
