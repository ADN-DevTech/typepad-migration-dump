---
layout: "post"
title: "Writing Work Points to an Excel File"
date: "2011-06-27 20:20:48"
author: "Adam Nagy"
categories:
  - "Brian"
original_url: "https://modthemachine.typepad.com/my_weblog/2011/06/writing-work-points-to-an-excel-file.html "
typepad_basename: "writing-work-points-to-an-excel-file"
typepad_status: "Publish"
---

<p>Here’s a solution to another problem that was recently posed.&#160; A customer is creating work points in a part and then needs an Excel file that has the coordinates of the work points.&#160; Here’s a VBA macro that will create a .csv file that contains the coordinates of the work points.&#160; If you select any work points before running the macro, it will give you the option of exporting only the selected work points or exporting all of the work points.&#160; If no work points are selected, then it will export all work points.&#160; Let me know if you find any issues or have suggestions on how to improve it.</p>  <p><font style="background-color: #ffff00">Update: Since I first posted this I received a question about how to have the macro use the current length units of the document.&#160; I’ve modified it so it now does that.&#160; Previously it was using the internal length unit of centimeters.&#160; It now uses the length specified for the document, but it ignores the number of decimal places specified for the document and always writes out up to 8 decimal places.</font></p>  <p style="line-height: 140%; font-family: courier new; background: #eeeeee; color: black; font-size: 8pt">Public Sub ExportWorkPoints()    <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the active part document.        <br /></strong></font>&#160;&#160;&#160; Dim partDoc As PartDocument     <br />&#160;&#160;&#160; If ThisApplication.ActiveDocumentType = kPartDocumentObject Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set partDoc = ThisApplication.ActiveDocument     <br />&#160;&#160;&#160; Else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;A part must be active.&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub     <br />&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Check to see if any work points are selected.        <br /></strong></font>&#160;&#160;&#160; Dim points() As WorkPoint     <br />&#160;&#160;&#160; Dim pointCount As Long     <br />&#160;&#160;&#160; pointCount = 0     <br />&#160;&#160;&#160; If partDoc.SelectSet.Count &gt; 0 Then     <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Dimension the array so it can contain the full        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' list of selected items.         <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ReDim points(partDoc.SelectSet.Count - 1)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim selectedObj As Object     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; For Each selectedObj In partDoc.SelectSet     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If TypeOf selectedObj Is WorkPoint Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set points(pointCount) = selectedObj     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pointCount = pointCount + 1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ReDim Preserve points(pointCount - 1)     <br />&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Ask to see if it should operate on the selected points        <br />&#160;&#160;&#160; ' or all points.         <br /></strong></font>&#160;&#160;&#160; Dim getAllPoints As Boolean     <br />&#160;&#160;&#160; getAllPoints = True     <br />&#160;&#160;&#160; If pointCount &gt; 0 Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim result As VbMsgBoxResult     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; result = MsgBox(&quot;Some work points are selected.&#160; &quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;Do you want to export only the &quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;selected work points?&#160; (Answering &quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;&quot;&quot;No&quot;&quot; will export all work points)&quot;, _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vbQuestion + vbYesNoCancel)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If result = vbCancel Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If result = vbYes Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; getAllPoints = False     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; Else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If MsgBox(&quot;No work points are selected.&#160; All work points&quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot; will be exported.&#160; Do you want to continue?&quot;, _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vbQuestion + vbYesNo) = vbNo Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; Dim partDef As PartComponentDefinition     <br />&#160;&#160;&#160; Set partDef = partDoc.ComponentDefinition     <br />&#160;&#160;&#160; If getAllPoints Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ReDim points(partDef.WorkPoints.Count - 2)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Get all of the workpoints, skipping the first,        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' which is the origin point.         <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim i As Integer     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; For i = 2 To partDef.WorkPoints.Count     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set points(i - 2) = partDef.WorkPoints.Item(i)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next     <br />&#160;&#160;&#160; End If     <br />&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the filename to write to.        <br /></strong></font>&#160;&#160;&#160; Dim dialog As FileDialog     <br />&#160;&#160;&#160; Dim filename As String     <br />&#160;&#160;&#160; Call ThisApplication.CreateFileDialog(dialog)     <br />&#160;&#160;&#160; With dialog     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .DialogTitle = &quot;Specify Output .CSV File&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .Filter = &quot;Comma delimited file (*.csv)|*.csv&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .FilterIndex = 0     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .OptionsEnabled = False     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .MultiSelectEnabled = False     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .ShowSave     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; filename = .filename     <br />&#160;&#160;&#160; End With     <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; If filename &lt;&gt; &quot;&quot; Then     <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Write the work point coordinates out to a csv file.        <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; On Error Resume Next     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Open filename For Output As #1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Err.Number &lt;&gt; 0 Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;Unable to open the specified file. &quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;It may be open by another process.&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit Sub     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Get a reference to the object to do unit conversions.       <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim uom As UnitsOfMeasure     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set uom = partDoc.UnitsOfMeasure     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Write the points, taking into account the current default       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' length units of the document.        <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; For i = 0 To UBound(points)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim xCoord As Double     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; xCoord = uom.ConvertUnits(points(i).Point.X, _&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kCentimeterLengthUnits, kDefaultDisplayLengthUnits)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim yCoord As String     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; yCoord = uom.ConvertUnits(points(i).Point.Y, _&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kCentimeterLengthUnits, kDefaultDisplayLengthUnits)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim zCoord As String     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; zCoord = uom.ConvertUnits(points(i).Point.Z, _&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kCentimeterLengthUnits, kDefaultDisplayLengthUnits)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Print #1, points(i).Name &amp; &quot;,&quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Format(xCoord, &quot;0.00000000&quot;) &amp; &quot;,&quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Format(yCoord, &quot;0.00000000&quot;) &amp; &quot;,&quot; &amp; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Format(zCoord, &quot;0.00000000&quot;)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Close #1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;Finished writing data to &quot;&quot;&quot; &amp; filename &amp; &quot;&quot;&quot;&quot;     <br />&#160;&#160;&#160; End If     <br />End Sub</p>
