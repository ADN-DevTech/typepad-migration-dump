---
layout: "post"
title: "3D equivalent of a 2d curve on a surface"
date: "2012-06-12 02:31:09"
author: "Wayne Brill"
categories:
  - "Inventor"
  - "Parts"
  - "Visual Basic for Applications (VBA)"
  - "Wayne"
original_url: "https://modthemachine.typepad.com/my_weblog/2012/06/3d-equivalent-of-a-2d-curve-on-a-surface.html "
typepad_basename: "3d-equivalent-of-a-2d-curve-on-a-surface"
typepad_status: "Publish"
---

<p>The Inventor 2013 API has several new methods for SurfaceEvaluator. One of these new methods allows you to get the equivalent 3D curve for a 2D curve defined in the parametric space of the surface.</p>
<p><strong>New 2013 method:&#0160; </strong></p>
<ul>
<li>SurfaceEvaluator.Get3dCurveFrom2dCurve()</li>
</ul>
<p><strong>VBA Example: </strong></p>
<p>Keep in mind that we only recommend using VBA for prototyping and learning the API but do not recommend using VBA in production.</p>
<p>To use this example have a part file open and run the code. First it will prompt you to select a face. (The second time the code is run it will prompt to find out if you want to keep the existing client graphics).</p>
<p><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340163066d5bce970d-pi"><img alt="image" border="0" height="319" src="/assets/image_112291.jpg" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" width="436" /></a></p>
<p>It will then create several curves in the 2d parametric space. Then it gets the equivalent 3D curves, and creates those as client graphics to allow you to view the results. You can see the curves lie on the surface now, but they were originally defined as circle and five lines, but they came back as curves, because the surface is curved.</p>
<p><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc68834017615568f5c970c-pi"><img alt="image" border="0" height="266" src="/assets/image_449195.jpg" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" width="423" /></a></p>
<p>&#0160;</p>
<p><strong>VBA Code:</strong></p>
<p><span style="color: #0000ff;">&#39; Demonstrates the conversion of a 2d parameteric <br />&#39; space curve into the &#39; equivalent 3d model space <br />&#39; curve.&#0160; To use this sample you must have a part <br />&#39; open.&#0160; You can select any face and 3D curves <br />&#39; will be drawn on the face using client graphics</span> <br />Public Sub ParamCurveto3D() <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Have the user select a face whose parametric <br />&#0160;&#0160;&#0160; &#39; space will be used</span> <br />&#0160;&#0160;&#0160; Dim testFace As Face <br />&#0160;&#0160;&#0160; Set testFace = ThisApplication. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; CommandManager.Pick _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (kPartFaceFilter, &quot;Select a face&quot;) <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">&#39; Get the surface evaluator from the face</span> <br />&#0160;&#0160;&#0160; Dim surfEval As SurfaceEvaluator <br />&#0160;&#0160;&#0160; Set surfEval = testFace.Evaluator <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #0000ff;">&#39; Get the parametric range of the face</span> <br />&#0160;&#0160;&#0160; Dim paramRange As Box2d <br />&#0160;&#0160;&#0160; Set paramRange = surfEval.ParamRangeRect <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Get the transient geometry object</span> <br />&#0160;&#0160;&#0160; Dim tg As TransientGeometry <br />&#0160;&#0160;&#0160; Set tg = ThisApplication.TransientGeometry <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Get the active document.&#0160; This assumes <br />&#0160;&#0160;&#0160; &#39; a part is active <br /></span>&#0160;&#0160;&#0160; Dim partDoc As PartDocument <br />&#0160;&#0160;&#0160; Set partDoc = ThisApplication.ActiveDocument <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Create a client graphics object.&#0160; If one <br />&#0160;&#0160;&#0160; &#39; already exists, give the user <br />&#0160;&#0160;&#0160; &#39; the option of re-using it, or creating <br />&#0160;&#0160;&#0160; &#39; a new one. <br /></span>&#0160;&#0160;&#0160; Dim graphics As ClientGraphics <br />&#0160;&#0160;&#0160; On Error Resume Next <br />&#0160;&#0160;&#0160; Set graphics = partDoc.ComponentDefinition. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ClientGraphicsCollection.Item(&quot;Test&quot;) <br />&#0160;&#0160;&#0160; If Err Then <br />&#0160;&#0160;&#0160;&#0160; Set graphics = partDoc.ComponentDefinition. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ClientGraphicsCollection.Add(&quot;Test&quot;) <br />&#0160;&#0160;&#0160; Else <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; If MsgBox(&quot;Yes add to existing graphics No = new&quot;, _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vbYesNo + vbQuestion) = vbNo Then <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; graphics.Delete <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set graphics = partDoc.ComponentDefinition. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ClientGraphicsCollection.Add(&quot;Test&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; End If <br />&#0160;&#0160;&#0160; End If <br />&#0160;&#0160;&#0160; <br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; &#39; Create a new graphics node. <br /></span>&#0160;&#0160;&#0160; Dim node As GraphicsNode <br />&#0160;&#0160;&#0160; Set node = graphics.AddNode(1)</p>
<p><span style="color: #0000ff;">&#0160;&#0160;&#0160; &#39; Do a loop that creates 5 lines that go <br />&#0160;&#0160;&#0160; &#39; from the minimum range point to <br />&#0160;&#0160;&#0160; &#39; five points along the maximum u parameter. <br /></span>&#0160;&#0160;&#0160; Dim startPnt As Point2d <br />&#0160;&#0160;&#0160; Set startPnt = paramRange.MinPoint <br />&#0160;&#0160;&#0160; Dim endPnt As Point2d <br />&#0160;&#0160;&#0160; Dim i As Integer <br />&#0160;&#0160;&#0160; For i = 1 To 5 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">&#39; Create the 2d line in parametric space <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set endPnt = tg.CreatePoint2d _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (paramRange.MaxPoint.X, (((paramRange. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; MaxPoint.y - paramRange.MinPoint.y) _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; / 4) * (i - 1)) + paramRange.MinPoint.y) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim surfCurve As LineSegment2d <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set surfCurve = tg.CreateLineSegment2d _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (startPnt, endPnt) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">&#39; Get the equivalent 3d curve in model space</span> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim resultCurve As Object <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set resultCurve = surfEval. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Get3dCurveFrom2dCurve(surfCurve) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">&#39; Create client graphics for this curve <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Dim crvGraphics As CurveGraphics <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Set crvGraphics = node.AddCurveGraphics _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (resultCurve) <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; crvGraphics.DepthPriority = 2 <br />&#0160;&#0160;&#0160; Next <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Create a 2d circle in parametric space</span> <br />&#0160;&#0160;&#0160; Dim center As Point2d <br />&#0160;&#0160;&#0160; Set center = tg.CreatePoint2d _ <br />&#0160;&#0160;&#0160;&#0160;&#0160; ((paramRange.MaxPoint.X + paramRange.MinPoint.X) _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; / 2, (paramRange.MaxPoint.y + _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; paramRange.MinPoint.y) / 2) <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160; Dim radius As Double <br />&#0160;&#0160;&#0160; radius = (paramRange.MaxPoint.X - _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; paramRange.MinPoint.X) * 0.25 <br />&#0160;&#0160;&#0160; Dim paramCircle As Circle2d <br />&#0160;&#0160;&#0160; Set paramCircle = tg.CreateCircle2d(center, radius) <br />&#0160;&#0160;&#0160; <br />&#0160; <span style="color: #0000ff;">&#0160; &#39; Get the equivalent 3d curve in model space</span> <br />&#0160;&#0160;&#0160; Set resultCurve = surfEval. _ <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Get3dCurveFrom2dCurve(paramCircle) <br />&#0160;&#0160;&#0160; <br />&#0160;&#0160; <span style="color: #0000ff;">&#39; Create client graphics for this curve</span> <br />&#0160;&#0160;&#0160; Set crvGraphics = node.AddCurveGraphics(resultCurve) <br />&#0160;&#0160;&#0160; crvGraphics.DepthPriority = 2 <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160; ThisApplication.ActiveView.Update <br />&#0160;&#0160;&#0160; ThisApplication.ActiveView.Fit <br />End Sub</p>
<p>-Wayne</p>
