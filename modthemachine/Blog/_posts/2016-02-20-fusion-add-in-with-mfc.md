---
layout: "post"
title: "Fusion Add-In with MFC"
date: "2016-02-20 18:54:47"
author: "Adam Nagy"
categories:
  - "Adam"
  - "Add-In Creation"
  - "C++"
  - "Fusion 360"
original_url: "https://modthemachine.typepad.com/my_weblog/2016/02/fusion-add-in-with-mfc.html "
typepad_basename: "fusion-add-in-with-mfc"
typepad_status: "Publish"
---

<p>It is possible to&nbsp;use <strong>MFC</strong> functionality inside your <strong>Fusion</strong> add-in on <strong>Windows</strong>. <br />First I tried going down the path of creating a <strong>C++</strong>&nbsp;add-in inside the "<strong>Scripts and Add-Ins</strong>" <strong>Fusion</strong> dialog and then add <strong>MFC</strong> support to the created <strong>Visual Studio C++</strong> project. However, that&nbsp;proved quite difficult and I just gave up and went the other way: created an <strong>MFC DLL</strong>&nbsp;project and turned it into a <strong>Fusion</strong> add-in. That was much simpler.&nbsp;</p>
<p>1) Create an&nbsp;<strong>MFC DLL</strong> project</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c818179a970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c818179a970b img-responsive" title="MfcCreate1" src="/assets/image_671272.jpg" alt="MfcCreate1" /></a></p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401bb08bce21c970d-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401bb08bce21c970d img-responsive" title="MfcCreate2" src="/assets/image_241222.jpg" alt="MfcCreate2" /></a></p>
<p>2) Add a <strong>Dialog</strong> resource to it</p>
<p>Open <strong>CustomMfcUi.rc</strong>, right-click and choose "<strong>Add Resource...</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b8d1a23cfa970c-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b8d1a23cfa970c img-responsive" title="MfcResource" src="/assets/image_722570.jpg" alt="MfcResource" /></a></p>
<p>... then select "<strong>Dialog</strong>" and click "<strong>New</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181859970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181859970b img-responsive" title="MfcResourceNew" src="/assets/image_833270.jpg" alt="MfcResourceNew" /></a></p>
<p>3) Double-click the "<strong>OK</strong>" button of the newly added <strong>Dialog</strong> so that the "<strong>MFC Add Class Wizard</strong>" dialog will pop up:&nbsp;</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c818189f970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c818189f970b img-responsive" title="MfcWizard" src="/assets/image_655094.jpg" alt="MfcWizard" /></a></p>
<p>Fill it in and click "<strong>Finish</strong>"</p>
<p>4) Rename <strong>IDD_DIALOG1</strong>&nbsp;to <strong>IDD_MYDIALOG</strong> just to keep things tidy</p>
<p>You can use the "<strong>Find and Replace</strong>" dialog of <strong>Visual Studio</strong> for that:</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181a52970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181a52970b img-responsive" title="MfcFind1" src="/assets/image_161595.jpg" alt="MfcFind1" /></a></p>
<p>There should be <strong>4</strong> instances replaced at the end:</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b8d1a23f3c970c-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b8d1a23f3c970c img-responsive" title="MfcFind2" src="/assets/image_187118.jpg" alt="MfcFind2" /></a></p>
<p>5) Add a function to show our dialog</p>
<p>a) Inside <strong>CustomMfcUi.cpp</strong> add this code:</p>
<div style="line-height: 110%; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: #0000ff;">void</span><span style="background: #ffffff; color: #000000;"> showDialog()</span><br /> <span style="background: #ffffff; color: #000000;">{&nbsp;&nbsp;</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #008000;">// Always call this macro first thing in any function that</span><br /><span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #008000;">// will use MFC functionality </span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #6f008a;">AFX_MANAGE_STATE</span><span style="background: #ffffff; color: #000000;">(AfxGetStaticModuleState());</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #2b91af;">CMyDialog</span><span style="background: #ffffff; color: #000000;"> myDialog; </span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;myDialog.DoModal();</span><br /> <span style="background: #ffffff; color: #000000;">};</span></div>
</div>
<p>b) Inside&nbsp;<strong>CustomMfcUi.h</strong>&nbsp;add this code at the top:</p>
<div style="line-height: 110%; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: #0000ff;">#include</span> <span style="background: #ffffff; color: #a31515;">"MyDialog.h"</span><br /> <br /> <span style="background: #ffffff; color: #0000ff;">void</span><span style="background: #ffffff; color: #000000;"> showDialog();</span></div>
</div>
<p>6) Add <strong>Fusion</strong> functionality&nbsp;</p>
<p>Add&nbsp;a new <strong>C++</strong> file to the project called <strong>FusionCode.cpp</strong>&nbsp;</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401bb08bce611970d-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401bb08bce611970d img-responsive" title="FusionCode" src="/assets/image_627316.jpg" alt="FusionCode" /></a></p>
<p>Fill it with this code:</p>
<div style="line-height: 110%; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt;">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: #0000ff;">#include</span> <span style="background: #ffffff; color: #a31515;">"stdafx.h"</span><br /> <br /> <span style="background: #ffffff; color: #0000ff;">#include</span> <span style="background: #ffffff; color: #a31515;">&lt;Core/CoreAll.h&gt;</span><br /> <span style="background: #ffffff; color: #0000ff;">#include</span> <span style="background: #ffffff; color: #a31515;">&lt;Fusion/FusionAll.h&gt;</span><br /> <br /> <span style="background: #ffffff; color: #008000;">// XI_WIN is a macro added by Fusion headers</span><br /><span style="background: #ffffff; color: #008000;">// to show if the project is a Windows project</span><br /><span style="background: #ffffff; color: #0000ff;">#ifdef</span><span style="background: #ffffff; color: #000000;"> XI_WIN</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">#include</span> <span style="background: #ffffff; color: #a31515;">"CustomMfcUi.h"</span><br /> <span style="background: #ffffff; color: #0000ff;">#endif</span><br /> <br /> <span style="background: #ffffff; color: #0000ff;">using</span> <span style="background: #ffffff; color: #0000ff;">namespace</span><span style="background: #ffffff; color: #000000;"> adsk::core;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span> <span style="background: #ffffff; color: #0000ff;">namespace</span><span style="background: #ffffff; color: #000000;"> adsk::fusion;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">Ptr&lt;Application&gt; app;</span><br /> <span style="background: #ffffff; color: #000000;">Ptr&lt;UserInterface&gt; ui;</span><br /> <br /> <span style="background: #ffffff; color: #0000ff;">extern</span> <span style="background: #ffffff; color: #a31515;">"C"</span><span style="background: #ffffff; color: #000000;"> XI_EXPORT </span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> run(</span><span style="background: #ffffff; color: #0000ff;">const</span> <span style="background: #ffffff; color: #0000ff;">char</span><span style="background: #ffffff; color: #000000;">* context)</span><br /> <span style="background: #ffffff; color: #000000;">{</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;app = Application::get();</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (!app)</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">return</span> <span style="background: #ffffff; color: #0000ff;">false</span><span style="background: #ffffff; color: #000000;">;</span><br /><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;ui = app-&gt;userInterface();</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (!ui)</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">return</span> <span style="background: #ffffff; color: #0000ff;">false</span><span style="background: #ffffff; color: #000000;">;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;showDialog();</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">return</span> <span style="background: #ffffff; color: #0000ff;">true</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">}</span><br /> <br /> <span style="background: #ffffff; color: #0000ff;">extern</span> <span style="background: #ffffff; color: #a31515;">"C"</span><span style="background: #ffffff; color: #000000;"> XI_EXPORT </span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> stop(</span><span style="background: #ffffff; color: #0000ff;">const</span> <span style="background: #ffffff; color: #0000ff;">char</span><span style="background: #ffffff; color: #000000;">* context)</span><br /> <span style="background: #ffffff; color: #000000;">{</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (ui)</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;{</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;ui-&gt;messageBox(</span><span style="background: #ffffff; color: #a31515;">"in stop"</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;ui = </span><span style="background: #ffffff; color: #0000ff;">nullptr</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&nbsp;&nbsp;</span><span style="background: #ffffff; color: #0000ff;">return</span> <span style="background: #ffffff; color: #0000ff;">true</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">}</span></div>
</div>
<p>7) Make the project compile as <strong>64 bit</strong> since <strong>Fusion 360</strong> is <strong>64 bit&nbsp;</strong>too</p>
<p>Inside the<strong>&nbsp;</strong>"<strong>Configuration Manager</strong>" dialog, under "<strong>Active solution platform</strong>" select "<strong>&lt;New...&gt;</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181e35970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181e35970b img-responsive" title="Config1" src="/assets/image_310334.jpg" alt="Config1" /></a></p>
<p>... and add the "<strong>x64</strong>" platform</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181e42970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181e42970b img-responsive" title="Config2" src="/assets/image_26510.jpg" alt="Config2" /></a></p>
<p>8) Add references to <strong>Fusion</strong> <strong>headers</strong> and <strong>libraries</strong> so that our project will compile</p>
<p>a) Inside the project settings, under "<strong>C/C++</strong>"&nbsp;&gt;&gt; "<strong>Additional Include Directories</strong>" add "<strong>$(APPDATA)/Autodesk/Autodesk Fusion 360/API/CPP/include</strong>"&nbsp;</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181c37970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181c37970b img-responsive" title="MfcProject1" src="/assets/image_656114.jpg" alt="MfcProject1" /></a></p>
<p>b) Under "<strong>Linker</strong>" &gt;&gt; "<strong>Additional Library Directories</strong>" add "<strong>$(APPDATA)/Autodesk/Autodesk Fusion 360/API/CPP/lib</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b8d1a241cf970c-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b8d1a241cf970c img-responsive" title="MfcProject2" src="/assets/image_623688.jpg" alt="MfcProject2" /></a></p>
<p>c) Under "<strong>Linker</strong>" &gt;&gt; "<strong>Additional Dependencies</strong>" add "<strong>core.lib;fusion.lib;</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8181d1f970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8181d1f970b img-responsive" title="MfcProject3" src="/assets/image_453416.jpg" alt="MfcProject3" /></a></p>
<p>9) Let <strong>Fusion</strong>&nbsp;find our project</p>
<p>a) Under "<strong>$(APPDATA)\Autodesk\Autodesk Fusion 360\API\AddIns</strong>" create a folder named the same as our <strong>dll</strong>&nbsp;"<strong>CustomMfcUi</strong>"&nbsp;</p>
<p>Add to that folder a <strong>manifest file</strong> with the same name, i.e. "<strong>CustomMfcUi.manifest</strong>" and add the following content to it in any text editor:</p>
<pre>{
"autodeskProduct":"Fusion360",
"type":"addin",
"author":"",
"description":{"":""},
"supportedOS":"windows",
"editEnabled":false,
"id":"38EE9339-591A-4F72-AFFF-7B20111CC10C",
"version":"1.0.0",
"runOnStartup":false
}</pre>
<p>The "<strong>id</strong>" part in the above text needs to be <strong>unique</strong>. You could use e.g.&nbsp;<strong>Visual Studio</strong>'s "<strong>Create GUID</strong>" dialog for that. Just remove the curly braces from the generated string</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b8d1a24620970c-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b8d1a24620970c img-responsive" title="Guid" src="/assets/image_326629.jpg" alt="Guid" /></a></p>
<p>I'm setting the&nbsp;"<strong>runOnStartup</strong>" option&nbsp;above to <strong>false</strong> because it would not be a good idea to pop up a modal dialog while <strong>Fusion</strong> is starting up. That would halt the startup process.</p>
<p>b) Make our project output the created <strong>dll</strong> into the <strong>Add-In</strong> folder we just created. Inside the project settings under "<strong>General</strong>" &gt;&gt; "<strong>Output Directory</strong>" add the path of our&nbsp;folder "<strong>$(APPDATA)\Autodesk\Autodesk Fusion 360\API\AddIns\CustomMfcUi</strong>" &nbsp;&nbsp;</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8182155970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8182155970b img-responsive" title="Output" src="/assets/image_81766.jpg" alt="Output" /></a></p>
<p>10) Test it</p>
<p><strong>Compile</strong> the project and inside the&nbsp;"<strong>Scripts and Add-Ins</strong>" dialog of <strong>Fusion</strong>, select our <strong>add-in</strong> and click "<strong>Run</strong>"</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401bb08bceeea970d-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401bb08bceeea970d img-responsive" title="MfcTest" src="/assets/image_580097.jpg" alt="MfcTest" /></a></p>
<p>Our dialog should pop up</p>
<p><a class="asset-img-link" href="http://modthemachine.typepad.com/.a/6a00e553fcbfc6883401b7c8182452970b-popup" onclick="window.open( this.href, '_blank', 'width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0' ); return false" style="display: inline;"><img class="asset  asset-image at-xid-6a00e553fcbfc6883401b7c8182452970b img-responsive" title="MfcTest2" src="/assets/image_630992.jpg" alt="MfcTest2" /></a></p>
<p>The sample project can be found here:<br /><a href="https://github.com/AutodeskFusion360/NativeUI">https://github.com/AutodeskFusion360/NativeUI</a></p>
<p>-Adam&nbsp;</p>
