---
layout: "post"
title: "Balloon Renumbering Across Sheets"
date: "2011-02-17 06:39:00"
author: "Adam Nagy"
categories:
  - "Brian"
  - "Drawings"
original_url: "https://modthemachine.typepad.com/my_weblog/2011/02/balloon-renumbering-across-sheets.html "
typepad_basename: "balloon-renumbering-across-sheets"
typepad_status: "Publish"
---

<p>I recently received a challenge from an Autodesk dealer that I couldn’t let sit since it seemed like it shouldn’t be too hard to solve. The problem he’s trying to solve is the case where the first sheet of a drawing contains a full assembly which is ballooned.&#160; Other sheets in the drawing contains subassemblies and parts that are used in the full assembly.&#160; What he wants is that the balloon numbers on the later sheets all match the numbers on the first sheet.&#160; By default, each document gets its own set of part numbers so each subassembly will begin numbering it parts at 1.</p>  <p>The following VBA code is my attempt at a solution.&#160; I didn’t put it through a lot of testing but it worked on what I did throw at it.&#160; To use it, just have a drawing open and run the macro.&#160; It can be re-run at any point to update the balloons is balloons on the first sheet are added or renumbered.</p>  <p>The program assumes the full assembly is on the first sheet and it examines all of the balloons on the first sheet getting the number and the document associated with the part the balloon is pointing at.&#160; The program also determines the highest number used by any of the balloons on the first sheet.&#160; The program then looks through the other sheets, examining each balloon to see if it points to any of same parts that were ballooned in the full assembly.&#160; If it is a part already ballooned, the program overrides the balloon number using the number from the full assembly.&#160; If the part or subassembly isn’t represented in the large assembly, it assigns it the next highest number.</p>  <p style="line-height: 140%; font-family: courier new; background: #eeeeee; color: black; font-size: 8pt"><strong><font color="#0000ff">' User-defined type used in the code code below.       <br /></font></strong>Private Type udtPartInfo     <br />&#160;&#160; Number As Integer     <br />&#160;&#160; ReferencedFile As String     <br />End Type     <br />    <br />    <br />Public Sub RenumberBalloonsToFirstSheet()     <br />&#160;&#160; <font color="#0000ff"><strong>' Get the active drawing document.</strong></font>     <br />&#160;&#160; If ThisApplication.ActiveDocumentType &lt;&gt; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kDrawingDocumentObject Then     <br />&#160;&#160;&#160;&#160;&#160; MsgBox &quot;A drawing must be active.&quot;     <br />&#160;&#160;&#160;&#160;&#160; Exit Sub     <br />&#160;&#160; End If     <br />&#160; <br />&#160;&#160; Dim drawDoc As DrawingDocument     <br />&#160;&#160; Set drawDoc = ThisApplication.ActiveDocument     <br />&#160;&#160;&#160; <br />&#160;&#160; <strong><font color="#0000ff">' Get the first sheet</font></strong>     <br />&#160;&#160; Dim baseSheet As Sheet     <br />&#160;&#160; Set baseSheet = drawDoc.Sheets.Item(1)     <br />&#160;&#160;&#160; <br /><strong><font color="#0000ff">&#160;&#160; ' Get the drawing BOM from a balloon.&#160; An assumption is that        <br />&#160;&#160; ' there is only one assembly represented on the sheet since         <br />&#160;&#160; ' this is arbitrarily using the BOM data of assembly associated         <br />&#160;&#160; ' with the first balloon found.        <br /></font></strong>&#160;&#160; Dim valSet As BalloonValueSet    <br />&#160;&#160; Set valSet = baseSheet.Balloons.Item(1).BalloonValueSets.Item(1)    <br />&#160;&#160; Dim drawBOM As DrawingBOM     <br />&#160;&#160; Set drawBOM = valSet.ReferencedRow.Parent     <br />&#160;&#160; Dim partInfo() As udtPartInfo     <br />&#160;&#160; ReDim partInfo(drawBOM.DrawingBOMRows.Count - 1)     <br />&#160;&#160; <br /><strong><font color="#0000ff">&#160;&#160; ' Determine which column contains the item number information.        <br /></font></strong>&#160;&#160; Dim itemColumn As Integer     <br />&#160;&#160; Dim i As Integer     <br />&#160;&#160; For i = 1 To drawBOM.DrawingBOMColumns.Count     <br />&#160;&#160;&#160;&#160;&#160; If drawBOM.DrawingBOMColumns.Item(i).PropertyType = _    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kItemPartsListProperty Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; itemColumn = i     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit For     <br />&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160; Next     <br />&#160;&#160; <br />&#160;&#160; For i = 1 To drawBOM.DrawingBOMRows.Count     <br />&#160;&#160;&#160;&#160;&#160; Dim drawBOMRow As DrawingBOMRow     <br />&#160;&#160;&#160;&#160;&#160; Set drawBOMRow = drawBOM.DrawingBOMRows.Item(i)    <br />    <br /><strong><font color="#0000ff">&#160;&#160;&#160;&#160;&#160; ' Get the filename of the file associated with this        <br />&#160;&#160;&#160;&#160;&#160; ' row of the BOM.         <br /></font></strong>&#160;&#160;&#160;&#160;&#160; Dim partDef As PartComponentDefinition    <br />&#160;&#160;&#160;&#160;&#160; Set partDef = drawBOMRow.BOMRow.ComponentDefinitions.Item(1)    <br />&#160;&#160;&#160;&#160;&#160; partInfo(i - 1).ReferencedFile = partDef.Document.FullFileName     <br />&#160;&#160;&#160;&#160;&#160; <br /><strong><font color="#0000ff">&#160;&#160;&#160;&#160;&#160; ' Get the part number from the drawing BOM.&#160; This could        <br />&#160;&#160;&#160;&#160;&#160; ' be different than the assembly BOM since it can be         <br />&#160;&#160;&#160;&#160;&#160; ' overridden in the drawing.         <br /></font></strong>&#160;&#160;&#160;&#160;&#160; partInfo(i - 1).Number = drawBOMRow.Item(itemColumn).Value     <br />&#160;&#160; Next     <br />&#160;&#160;&#160; <br /><strong><font color="#0000ff">&#160;&#160; ' Iterate through the other sheets setting the balloon values        <br />&#160;&#160; ' to match these. If a balloon to a new part is found it will         <br />&#160;&#160; ' be set to the next highest value so all parts have unique         <br />&#160;&#160; ' balloon values.         <br /></font></strong>&#160;&#160; For i = 2 To drawDoc.Sheets.Count     <br />&#160;&#160;&#160;&#160;&#160; Dim currentSheet As Sheet     <br />&#160;&#160;&#160;&#160;&#160; Set currentSheet = drawDoc.Sheets.Item(i)    <br />    <br /><strong><font color="#0000ff">&#160;&#160;&#160;&#160;&#160; ' Look through the balloons on this sheet.        <br /></font></strong>&#160;&#160;&#160;&#160;&#160; Dim checkBalloon As Balloon     <br />&#160;&#160;&#160;&#160;&#160; For Each checkBalloon In currentSheet.Balloons     <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Initialize the flag indicating a match was found.        <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim matchFound As Boolean     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; matchFound = False     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim valueSet As BalloonValueSet     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Set valueSet = checkBalloon.BalloonValueSets.Item(1)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim checkFilename As String     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; checkFilename = _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; valueSet.ReferencedFiles.Item(1).FullFileName&#160; <br />    <br /><strong><font color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Find the data that matches this balloon.        <br /></font></strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim j As Integer    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; For j = 0 To UBound(partInfo)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If checkFilename = partInfo(j).ReferencedFile Then     <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Override the balloon value to match, if        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' it's different.         <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; matchFound = True     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If valueSet.ItemNumber &lt;&gt; partInfo(j).Number Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; valueSet.OverrideValue = partInfo(j).Number     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Exit For     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next     <br />&#160;&#160;&#160;&#160;&#160; Next     <br />&#160;&#160; Next     <br />End Sub     <br /></p>  <p>&#160;</p>  <p><strong>Updates:     <br /></strong>Feb. 22, 2011: Revised the code because of some problems pointed out in the previous version.&#160; The previous version was dependent on a balloon being present on the first sheet for every part in the assembly, which is not realistic.&#160; The new code relies on the BOM, which will include every part. </p>
