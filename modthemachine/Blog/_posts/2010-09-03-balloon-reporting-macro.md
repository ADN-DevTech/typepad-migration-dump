---
layout: "post"
title: "Balloon Reporting Macro"
date: "2010-09-03 00:38:44"
author: "Adam Nagy"
categories:
  - "Brian"
original_url: "https://modthemachine.typepad.com/my_weblog/2010/09/balloon-reporting-macro.html "
typepad_basename: "balloon-reporting-macro"
typepad_status: "Publish"
---

<p>There was a question on the <a href="http://forums.autodesk.com/t5/Autodesk-Inventor-Customization/bd-p/120">Autodesk Inventor Customization newsgroup</a> this morning that caught my interest.&#160; The question was about creating a report, (in their case editing a column in the BOM), that lists all of the balloons in a drawing along with what sheet they’re on and the zone on the sheet they’re located within,</p>  <p>The macro below does this.&#160; The output is simple since it just writes out the result as a file, but you’ll likely want to edit the program to do something else with the result like incorporate it into the BOM, create a custom table, or some other thing I would never have thought of.&#160; The macro assumes that the border was created as a default border.&#160; With a default border it’s a simple matter to get the number of zones on a sheet and determine whether to use numbers or characters for the zone labels.&#160; If you’re using a border you’ve created then you’ll need to edit the program and specify this information.</p>  <p>I tested the macro using the Engine MKII sample assembly shown below.&#160; The drawing that comes with that sample has three sheets and balloons on two of the sheets.</p>  <p><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340133f38931dd970b-pi"><img title="BalloonDrawing" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="298" alt="BalloonDrawing" src="/assets/image_900862.jpg" width="454" border="0" /></a> </p>  <p>Here are the contents of the report created by the macro. </p>  <div style="font-size: 8pt; background: #ffeeee; color: black; line-height: 140%; font-family: courier new">   <p>==== Balloon Report ====      <br />&#160; Sheet: Sheet:1       <br />&#160;&#160;&#160; Balloon: 8, (7, B)       <br />&#160;&#160;&#160; Balloon: 7, (1, A)       <br />&#160;&#160;&#160; Balloon: 11, (7, B)       <br />&#160;&#160;&#160; Balloon: 12, (7, B)       <br />&#160;&#160;&#160; Balloon: 23, (7, A)       <br />&#160;&#160;&#160; Balloon: 19, (7, A)       <br />&#160;&#160;&#160; Balloon: 28, (7, A)       <br />&#160;&#160;&#160; Balloon: 26, (7, A)       <br />&#160;&#160;&#160; Balloon: 18, (8, A)       <br />&#160;&#160;&#160; Balloon: 20, (8, A)       <br />&#160;&#160;&#160; Balloon: 110, (3, B)       <br />&#160;&#160;&#160; Balloon: 81, (3, A)       <br />&#160;&#160;&#160; Balloon: 112, (4, A)       <br />&#160; Sheet: Sheet:2       <br />&#160;&#160;&#160; Balloon: 18, (2, B)       <br />&#160;&#160;&#160; Balloon: 19, (3, A)       <br />&#160;&#160;&#160; Balloon: 9, (5, C)       <br />&#160;&#160;&#160; Balloon: 1, (5, D)       <br />&#160;&#160;&#160; Balloon: 3, (5, D)       <br />&#160;&#160;&#160; Balloon: 8, (5, C)       <br />&#160;&#160;&#160; Balloon: 5, (5, D)       <br />&#160;&#160;&#160; Balloon: 7, (5, C)       <br />&#160;&#160;&#160; Balloon: 6, (5, C)       <br />&#160;&#160;&#160; Balloon: 4, (5, D)       <br />&#160;&#160;&#160; Balloon: 31, (5, B)       <br />&#160;&#160;&#160; Balloon: 29, (2, B)       <br />&#160;&#160;&#160; Balloon: 30, (2, B)       <br />&#160;&#160;&#160; Balloon: 28, (2, B)       <br />&#160;&#160;&#160; Balloon: 24, (2, B)       <br />&#160;&#160;&#160; Balloon: 27, (2, B)       <br />&#160;&#160;&#160; Balloon: 25, (2, B)       <br />&#160;&#160;&#160; Balloon: 26, (2, B)       <br />&#160;&#160;&#160; Balloon: 12, (5, B)       <br />&#160;&#160;&#160; Balloon: 11, (5, B)       <br />&#160;&#160;&#160; Balloon: 10, (5, B)       <br />&#160;&#160;&#160; Balloon: 16, (2, C)       <br />&#160;&#160;&#160; Balloon: 18, (3, D)       <br />&#160;&#160;&#160; Balloon: 17, (3, D)       <br />&#160;&#160;&#160; Balloon: 14, (2, C)       <br />&#160;&#160;&#160; Balloon: 13, (2, C)       <br />&#160;&#160;&#160; Balloon: 9, (2, C)       <br />&#160;&#160;&#160; Balloon: 15, (3, D)       <br />&#160;&#160;&#160; Balloon: 20, (3, A)       <br />&#160;&#160;&#160; Balloon: 23, (2, A)       <br />&#160;&#160;&#160; Balloon: 22, (3, A)       <br />&#160;&#160;&#160; Balloon: 21, (3, A)       <br />&#160; Sheet: Sheet:3</p> </div>  <p>Here’s the VBA macro.&#160; To use it, just copy and paste the code below into a VBA code module, have a drawing open, and run it.&#160; If you’re not familiar with VBA, instructions to do this are available <a href="http://modthemachine.typepad.com/my_weblog/2010/05/using-vba-sample-code-for-the-non-programmer.html">here</a>.</p>  <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">   <p>Public Sub BalloonReport()&#160; <br /><font color="#0000ff"><strong>&#160; ' Get the active drawing document.&#160; <br /></strong></font>&#160; Dim drawDoc As DrawingDocument&#160; <br />&#160; Set drawDoc = ThisApplication.ActiveDocument&#160; <br />      <br /><font color="#0000ff"><strong>&#160; ' Open a file to write the results into.&#160; <br /></strong></font>&#160; Dim filename As String&#160; <br />&#160; filename = &quot;C:\Temp\BalloonReport.txt&quot;&#160; <br />&#160; Open filename For Output As #1&#160; <br />      <br /><font color="#0000ff"><strong>&#160; ' Print out the header for the report, both to the&#160; <br />&#160; ' output file and the immediate window in VBA.&#160; <br /></strong></font>&#160; Debug.Print &quot;&quot;&#160; <br />&#160; Debug.Print &quot;==== Balloon Report ====&quot;&#160; <br />&#160; Print #1, &quot;==== Balloon Report ====&quot;&#160; <br />      <br /><font color="#0000ff"><strong>&#160; ' Iterate through the sheets.&#160; <br /></strong></font>&#160; Dim drawSheet As sheet&#160; <br />&#160; For Each drawSheet In drawDoc.Sheets&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Print out the sheet name.&#160; <br /></strong></font>&#160;&#160;&#160; Debug.Print &quot;&#160; Sheet: &quot; &amp; drawSheet.Name&#160; <br />&#160;&#160;&#160; Print #1, &quot;&#160; Sheet: &quot; &amp; drawSheet.Name&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Determine the zones within this sheet.&#160; This assumes that         <br />&#160;&#160;&#160; ' the border was created as a standard border where the          <br />&#160;&#160;&#160; ' zones are explicitly defined.&#160; If this is a custom border          <br />&#160;&#160;&#160; ' then some other mechanism will need to be created to&#160; <br />&#160;&#160;&#160; ' define the zones.&#160; <br /></strong></font>&#160;&#160;&#160; Dim border As DefaultBorder&#160; <br />&#160;&#160;&#160; Set border = drawSheet.border&#160; <br />&#160;&#160;&#160; Dim XZoneWidth As Double&#160; <br />&#160;&#160;&#160; Dim YZoneWidth As Double&#160; <br />&#160;&#160;&#160; XZoneWidth = drawSheet.Width / border.HorizontalZoneCount&#160; <br />&#160;&#160;&#160; YZoneWidth = drawSheet.Height / border.VerticalZoneCount&#160; <br />&#160;&#160;&#160; Dim XZoneIsNumber As Boolean&#160; <br />&#160;&#160;&#160; If border.HorizontalZoneLabelMode = kBorderLabelModeNumeric Then&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; XZoneIsNumber = True&#160; <br />&#160;&#160;&#160; Else&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; XZoneIsNumber = False&#160; <br />&#160;&#160;&#160; End If&#160; <br />      <br />&#160;&#160;&#160; Dim YZoneIsNumber As Boolean&#160; <br />&#160;&#160;&#160; If border.VerticalZoneLabelMode = kBorderLabelModeNumeric Then&#160; <br />&#160;&#160;&#160;&#160;&#160; YZoneIsNumber = True&#160; <br />&#160;&#160;&#160; Else&#160; <br />&#160;&#160;&#160;&#160;&#160; YZoneIsNumber = False&#160; <br />&#160;&#160;&#160; End If&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Iterate through the balloons on this sheet.&#160; <br /></strong></font>&#160;&#160;&#160; Dim drawBalloon As Balloon&#160; <br />&#160;&#160;&#160; For Each drawBalloon In drawSheet.Balloons&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Because the border is numbered in the X direction from&#160; <br />&#160;&#160;&#160;&#160;&#160; ' right to left and the sheet coordinate system is from&#160; <br />&#160;&#160;&#160;&#160;&#160; ' left to right, this reverses the X coordinate so the&#160; <br />&#160;&#160;&#160;&#160;&#160; ' zone computation will be correct.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim newXPosition As Double&#160; <br />&#160;&#160;&#160;&#160;&#160; newXPosition = drawSheet.Width - drawBalloon.position.X&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Determine the X zone.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim XZone As Integer&#160; <br />&#160;&#160;&#160;&#160;&#160; XZone = Int(newXPosition / XZoneWidth)&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the X zone as a string.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim XZoneValue As String&#160; <br />      <br />&#160;&#160;&#160;&#160;&#160; If XZoneIsNumber Then&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; XZoneValue = XZone + 1&#160; <br />&#160;&#160;&#160;&#160;&#160; Else&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; XZoneValue = Chr(XZone + 65)&#160; <br />&#160;&#160;&#160;&#160;&#160; End If&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Determine Y zone.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim YZone As Integer&#160; <br />&#160;&#160;&#160;&#160;&#160; YZone = Int(drawBalloon.position.Y / YZoneWidth)&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the Y zone as a string.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim YZoneValue As String&#160; <br />&#160;&#160;&#160;&#160;&#160; If YZoneIsNumber Then&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; YZoneValue = YZone + 1&#160; <br />&#160;&#160;&#160;&#160;&#160; Else&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; YZoneValue = Chr(YZone + 65)&#160; <br />&#160;&#160;&#160;&#160;&#160; End If&#160; <br />      <br /><strong><font color="#0000ff">&#160;&#160;&#160;&#160;&#160; ' Iterate through each value set associated with this balloon.&#160; <br /></font></strong>&#160;&#160;&#160;&#160;&#160; Dim valueSet As BalloonValueSet&#160; <br />&#160;&#160;&#160;&#160;&#160; For Each valueSet In drawBalloon.BalloonValueSets&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Print out the results for this value set.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Debug.Print &quot;&#160;&#160;&#160; Balloon: &quot; &amp; valueSet.value &amp; _&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;, (&quot; &amp; XZoneValue &amp; &quot;, &quot; &amp; YZoneValue &amp; &quot;)&quot;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Print #1, &quot;&#160;&#160;&#160; Balloon: &quot; &amp; valueSet.value &amp; _&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;, (&quot; &amp; XZoneValue &amp; &quot;, &quot; &amp; YZoneValue &amp; &quot;)&quot;&#160; <br />&#160;&#160;&#160;&#160;&#160; Next&#160; <br />&#160;&#160;&#160; Next&#160; <br />&#160; Next&#160; <br />      <br /><font color="#0000ff"><strong>&#160; ' Close the output file.&#160; <br /></strong></font>&#160; Close #1&#160; <br />      <br />&#160; MsgBox &quot;Report written to: &quot;&quot;&quot; &amp; filename &amp; &quot;&quot;&quot;&quot;       <br />End Sub</p> </div>
