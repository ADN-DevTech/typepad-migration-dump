---
layout: "post"
title: "Accessing Thumbnail Images"
date: "2010-06-10 00:29:12"
author: "Adam Nagy"
categories:
  - "Brian"
  - "iProperties"
original_url: "https://modthemachine.typepad.com/my_weblog/2010/06/accessing-thumbnail-images.html "
typepad_basename: "accessing-thumbnail-images"
typepad_status: "Publish"
---

<p>I’ve had a few recent posts that have talked briefly about using thumbnail images (<a href="http://modthemachine.typepad.com/my_weblog/2010/03/document-thumbnails-and-button-icons.html">Document Thumbnails and Button Icons</a>, <a href="http://modthemachine.typepad.com/my_weblog/2010/02/parts-list-with-thumbnail-image.html">Parts List with Thumbnail Image</a>, and <a href="http://modthemachine.typepad.com/my_weblog/2010/02/accessing-iproperties.html">Accessing iProperties</a>).&#160; If you need to get a thumbnail image from an Inventor document there are several possibilities.&#160; I want to briefly cover those here.</p>  <p><strong><font size="3">Thumbnail as an iProperty        <br /></font></strong>The thumbnail is stored as an iProperty within an Inventor document.&#160; One way to access the thumbnail is as an iProperty.&#160; The following VBA code accesses the thumbnail as an iProperty and writes it as a bmp file to disk.&#160; (This code won’t work on a 64-bit Inventor because of the issues discussed in this <a href="http://modthemachine.typepad.com/my_weblog/2010/03/document-thumbnails-and-button-icons.html">post</a>.)</p>  <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">   <p>Public Sub WriteThumbnail()      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the currently active document.          <br /></strong></font>&#160;&#160;&#160; Dim doc As Document       <br />&#160;&#160;&#160; Set doc = ThisApplication.ActiveDocument       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the Summary Information property set.          <br /></strong></font>&#160;&#160;&#160; Dim summaryInfo As PropertySet       <br />&#160;&#160;&#160; Set summaryInfo = doc.PropertySets.Item( _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;Inventor Summary Information&quot;)       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the thumbnail property.&#160; When using VBA, this will          <br />&#160;&#160;&#160; ' only work with 32-bit Inventor.           <br /></strong></font>&#160;&#160;&#160; Dim thumbProp As Property       <br />&#160;&#160;&#160; Set thumbProp = summaryInfo.Item(&quot;Thumbnail&quot;)       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Get the thumbnail image.          <br /></strong></font>&#160;&#160;&#160; Dim thumbnail As IPictureDisp       <br />&#160;&#160;&#160; Set thumbnail = thumbProp.Value       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160; ' Check that an image was returned.&#160; It's possible for a          <br />&#160;&#160;&#160; ' file to not have a thumbnail.           <br /></strong></font>&#160;&#160;&#160; If Not thumbnail Is Nothing Then       <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ' Write the thumbnail to disk.          <br /></strong></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Call SavePicture(thumbnail, &quot;C:\Temp\Thumb.bmp&quot;)       <br />&#160;&#160;&#160; Else       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox &quot;The active document doesn't have a thumbnail.&quot;       <br />&#160;&#160;&#160; End If       <br />End Sub</p> </div>  <p>Because Apprentice provides access to iProperties, you can use it instead of Inventor to access the thumbnail.&#160; Below is some VB.Net code that uses Apprentice to read a thumbnail from an Inventor document and display it within a picture box.</p>  <p>To use the code below, create a new “Windows Form Application”.&#160; On the form add a button (Button1) and a picture box (PictureBox1).&#160; Set the <strong>SizeMode</strong> property of the picture box to <strong>StretchImage</strong>.&#160; My dialog is shown below.</p>  <p><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340133f084ab40970b-pi"><img title="ThumbnailDialogBefore" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="293" alt="ThumbnailDialogBefore" src="/assets/image_52849.jpg" width="243" border="0" /></a> </p>  <p>You’ll also need to add references to the following components using the .Net tab of the <strong>Add Reference</strong> dialog:</p>  <blockquote>   <p>Autodesk.Inventor.Interop      <br />Microsoft.VisualBasic.Compatibility       <br />stdole</p> </blockquote>  <p>Here’s my implementation for the form and the button click sub.</p>  <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">   <p>Imports Inventor      <br />Imports Microsoft.VisualBasic </p>    <p>Public Class Form1&#160; <br />&#160;&#160; Private Sub Button1_Click(ByVal sender As System.Object, _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ByVal e As System.EventArgs) Handles Button1.Click&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Create an instance of Apprentice.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim apprentice As New ApprenticeServerComponent       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Open a document.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim doc As ApprenticeServerDocument&#160; <br />&#160;&#160;&#160;&#160;&#160; doc = apprentice.Open(&quot;C:\Temp\Part1.ipt&quot;)&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the Summary Information property set.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim summaryInfo As PropertySet&#160; <br />&#160;&#160;&#160;&#160;&#160; summaryInfo = doc.PropertySets.Item( _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;Inventor Summary Information&quot;)&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the thumbnail property.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim thumbProp As Inventor.Property&#160; <br />&#160;&#160;&#160;&#160;&#160; thumbProp = summaryInfo.Item(&quot;Thumbnail&quot;)&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the thumbnail image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim thumbnail As stdole.IPictureDisp&#160; <br />&#160;&#160;&#160;&#160;&#160; thumbnail = thumbProp.Value&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Convert the IPictureDisp object to an Image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim img As Image = _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Compatibility.VB6.IPictureDispToImage(thumbnail)       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Display the image in the picture box.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; PictureBox1.Image = img&#160; <br />&#160;&#160; End Sub       <br />End Class</p> </div>  <p>And here’s the result.    <br /><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340133f084ab95970b-pi"><img title="ThumbnailDialogAfter" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="290" alt="ThumbnailDialogAfter" src="/assets/image_768773.jpg" width="240" border="0" /></a>    <br /></p>  <p><font size="3"><strong>Document.Thumbnail Property        <br /></strong></font>There’s another way you can get the thumbnail that’s simpler than going through the iProperty objects.&#160; Both the Document and ApprenticeServerDocument objects&#160; support the Thumbnail property.&#160; Here’s a modified version of the program above that uses the Thumbnail property.</p>  <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">   <p>Imports Inventor      <br />Imports Microsoft.VisualBasic </p>    <p>Public Class Form1&#160; <br />&#160;&#160; Private Sub Button1_Click(ByVal sender As System.Object, _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ByVal e As System.EventArgs) Handles Button1.Click&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Create an instance of Apprentice.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim apprentice As New ApprenticeServerComponent       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Open a document.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim doc As ApprenticeServerDocument&#160; <br />&#160;&#160;&#160;&#160;&#160; doc = apprentice.Open(&quot;C:\Temp\Part1.ipt&quot;)&#160;&#160; <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the thumbnail image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim thumbnail As stdole.IPictureDisp&#160; <br />&#160;&#160;&#160;&#160;&#160; thumbnail = doc.Thumbnail       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Convert the IPictureDisp object to an Image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim img As Image = _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Compatibility.VB6.IPictureDispToImage(thumbnail)       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Display the image in the picture box.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; PictureBox1.Image = img&#160; <br />&#160;&#160; End Sub       <br />End Class</p> </div>  <p>A big difference between using the Document.Thumbnail property and accessing the thumbnail as an iProperty is that the Document.Thumbnail property is read-only while the iProperty is writable.&#160; This means you can push any image you would like into the iProperty to be used as the thumbnail for that document.&#160; However, this is only supported in Inventor and setting the value of the thumbnail iProperty will fail when using Apprentice.</p>  <p><font size="3"><strong>ThumbnailView Component        <br /></strong></font>There’s one other way of accessing a thumbnail.&#160; Because iProperties are stored using some Microsoft standards, it’s possible to use Windows functionality to directly access the thumbnail without using Inventor or Apprentice.&#160; It requires some more advanced programming to do it this way, so to make it easier there’s a&#160; component delivered as part of the Inventor SDK that you can use rather than write the code yourself.&#160; The source code is also provided to serve as a sample for those that want to include this functionality within their applications.</p>  <p>To use this component you need to first install the <strong>DeveloperTools.msi</strong> package.&#160; This is in the Inventor SDK directory (C:\Program Files\Autodesk\Inventor 2011\SDK on WinNT and C:\Users\Public\Documents\Autodesk\Inventor 2011\SDK on Vista or Win7).&#160; Installing this will create an SDK\DeveloperTools\Tools\ThumbnailView directory that contains the component, its source code, and some samples demonstrating its use.</p>  <p>To use the component, go into the Bin directory and run the Register.bat file to register the component.&#160; In your project where you’ll be using the component you’ll need to add a reference to it.&#160; I typically use the Browse option and browse to the InventorThumbnailView.dll file.&#160; Here’s a version of the previous program that uses this component to get the thumbnail.</p>  <div style="font-size: 8pt; background: #eeeeee; color: black; line-height: 140%; font-family: courier new">   <p>Imports Microsoft.VisualBasic </p>    <p>Public Class Form1&#160; <br />&#160;&#160; Private Sub Button1_Click(ByVal sender As System.Object, _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ByVal e As System.EventArgs) Handles Button1.Click&#160; <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Create an instance of the ThumbnailProvider component.         <br />&#160;&#160;&#160;&#160;&#160; </strong></font>Dim thumbView As New InventorThumbnailViewLib.ThumbnailProvider </p>    <p><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Get the thumbnail image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim thumbnail As stdole.IPictureDisp&#160; <br />&#160;&#160;&#160;&#160;&#160; thumbnail = thumbView.GetThumbnail(&quot;C:\Temp\Part1.ipt&quot;)      <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Convert the IPictureDisp object to an Image.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; Dim img As Image = _       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Compatibility.VB6.IPictureDispToImage(thumbnail)       <br />      <br /><font color="#0000ff"><strong>&#160;&#160;&#160;&#160;&#160; ' Display the image in the picture box.&#160; <br /></strong></font>&#160;&#160;&#160;&#160;&#160; PictureBox1.Image = img&#160; <br />&#160;&#160; End Sub       <br />End Class</p> </div>  <p>One thing important to notice is that there’s no longer a reference to the Inventor component required since this isn’t using the Inventor API.</p>  <p><font size="3"><strong>Inventor 2011 and ThumbnailView       <br /></strong></font><font size="2">The ThumbnailView component has been provided as a sample for several releases of Inventor.&#160; However, an issue was discovered soon after Inventor 2011 was shipped where it was found the component doesn’t work with Inventor 2011 files.&#160; In Inventor 2011 a change was made to how the thumbnail image is stored within the iProperty value.&#160; Previously to Inventor 2011 it was stored as a bmp image.&#160; In Inventor 2011 it’s now saved as a png image.&#160; All of the other functionality that deals with the thumbnail, iProperties and the Document.Thumbnail property, were updated to account for this change.&#160; However, the ThumbnailView utility slipped through the cracks and was not updated.&#160; You can <a href="http://modthemachine.typepad.com/ThumbnailView.zip">access an updated version of the component here</a> that works with Inventor 2011 and previous files.</font></p>
