---
layout: "post"
title: "Converting VBA Auto Macros to an Add-In"
date: "2008-10-03 00:56:53"
author: "Adam Nagy"
categories:
  - "Add-In Creation"
  - "Brian"
  - "Visual Basic for Applications (VBA)"
original_url: "https://modthemachine.typepad.com/my_weblog/2008/10/converting-vba-auto-macros-to-an-add-in.html "
typepad_basename: "converting-vba-auto-macros-to-an-add-in"
typepad_status: "Publish"
---

<p>This posting assumes you have a VBA auto macro and want to quit using the auto macro functionality and convert it to an add-in. See the previous posting <a href="http://modthemachine.typepad.com/my_weblog/2008/09/vba-document-projects.html">VBA Document Projects</a> as to why you might want to do this.&#0160; Without a lot of explanation, here are the prerequisites and the steps required to create the add-in.</p>
<p>Here is an example of an automatic macro that exists within a drawing document. It automatically writes out dwf and pdf files of the drawing whenever the drawing is saved.&#0160; The rest of this post looks at the process to create an add-in to replace this auto macro.</p>
<p></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">Public Sub AutoSave() <br /><font color="#0000ff">&#0160;&#0160;&#0160; &#39; Get the filename minus the extension.</font> <br />&#0160;&#0160;&#0160; Dim strFilename As String <br />&#0160;&#0160;&#0160; strFilename = ThisDocument.FullFileName <br />&#0160;&#0160;&#0160; strFilename = Left(strFilename, Len(strFilename) - 4) <br /><br /><font color="#0000ff">&#0160;&#0160;&#0160; &#39; Save the current SilentOperation and then turn it on. <br />&#0160;&#0160;&#0160; &#39; This will suppress the dwf viewer from being displayed. </font><br />&#0160;&#0160;&#0160; Dim currentSetting As Boolean <br />&#0160;&#0160;&#0160; currentSetting = ThisApplication.SilentOperation <br />&#0160;&#0160;&#0160; ThisApplication.SilentOperation = True <br /><br /><font color="#0000ff">&#0160;&#0160;&#0160; &#39; Save the file as dwf. </font><br />&#0160;&#0160;&#0160; Call ThisDocument.SaveAs(strFilename &amp; &quot;.dwf&quot;, True) <br /><br /><font color="#0000ff">&#0160;&#0160;&#0160; &#39; Reset SilentOperation back to its previous value.</font> <br />&#0160;&#0160;&#0160; ThisApplication.SilentOperation = currentSetting <br /><br /><font color="#0000ff">&#0160;&#0160;&#0160; &#39; Save the file as pdf. </font><br />&#0160;&#0160;&#0160; Call ThisDocument.SaveAs(strFilename &amp; &quot;.pdf&quot;, True) <br />End Sub</div>
<p></p>
<p><strong><font size="3">What You&#39;ll Need</font></strong></p>
<p><strong>A Programming Language</strong> - To write an add-in you need to use a language that supports creating COM components. For this example I&#39;ll illustrate the process using both Visual Basic 2008 and C# 2008. Microsoft provides free Express versions of both of these languages. You can install them from the <a href="http://www.microsoft.com/express/download/">Microsoft web site</a>. Microsoft also provides online training resources for learning these languages. If this is all new to you and you don&#39;t know which one to get I would recommend Visual Basic, but it really is a personal preference.</p>
<p><strong>Inventor SDK Developer Tools</strong> - You&#39;ll also need some Inventor specific development tools.&#0160; This is delivered when you install Inventor but you need to run its setup to install it. Assuming you&#39;re using Inventor 2009, locate the following file in Explorer and run it:</p>
<blockquote>
<p>C:\Program Files\Autodesk\Inventor 2009\SDK\DeveloperTools.msi</p></blockquote>
<p>Inventor 2009 was released when Visual Studio 2005 was the current development platform. Because of that the Add-In wizard provided with it does not get installed for use with Visual Studio 2008.&#0160; To work around this you can copy the files below to the specified directories.&#0160; Don&#39;t unzip the files but just copy the file as-is.</p>
<blockquote>
<p><strong>VB 2008</strong> <br />Copy <a href="http://modthemachine.typepad.com/my_weblog/files/VBInventorAddInTemplate.zip">VBInventorAddInTemplate.zip</a> to&#0160; <br />&quot;My Documents\Visual Studio 2008\Templates\ProjectTemplates&quot;</p>
<p><strong>C# 2008</strong> <br />Copy <a href="http://modthemachine.typepad.com/my_weblog/files/VCSInventorAddInTemplate.zip">VCSInventorAddInTemplate.zip</a> to&#0160; <br />&quot;My Documents\Visual Studio 2008\Templates\ProjectTemplates&quot;</p></blockquote>
<p><strong><font size="3">Creating the Add-In</font></strong></p>
<p style="text-align: left">The add-in is created using the add-in template. Start VB or C# and choose to create a new project. For the template choose &quot;Autodesk Inventor AddIn&quot;, as shown below. You can also specify the name of the add-in at this point, (&quot;AutoSaveAddIn&quot; in the example below).</p>
<p style="text-align: center"><br />&#0160;<a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340105351af8e2970b-pi" target="_blank"><img alt="New add-in project." border="0" height="223" src="/assets/image_404323.jpg" style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" width="360" /></a> </p>
<p style="text-align: left"><br />In the Visual Studio Solution Explorer you&#39;ll see the various files listed that were created for the project. For a Visual Basic add-in, most of the code is in the StandardAddInServer.vb file and for a C# add-in it is in the StandardAddInServer.cs file. Double-click on this file to open it in the code editor. You should see something very similar to one of the pictures below. Your GuidAttribute value will be different than those shown below since that is unique for every add-in. <br /></p>
<p style="text-align: center"><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340105351af8e8970b-pi"><img alt="AddInStartVB" border="0" height="330" src="/assets/image_220392.jpg" style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" width="456" /></a>&#0160; <br />Visual Basic Code Window <br /><br /><br /></p>
<p style="text-align: center"><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340105351af8ec970b-pi"><img alt="AddInStartCS" border="0" height="432" src="/assets/image_777681.jpg" style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" width="463" /></a> <br />Visual C# Code Window <br /><br /><br /></p>
<p style="text-align: left"><strong><font size="3">Editing the Name and Description of the Add-In</font></strong></p>
<p style="text-align: left">One common thing you&#39;ll want to do when creating an add-in is to define the name and description of the add-in as it will be seen in the Add-In Manager. You do this by editing the code in the &quot;COM Registration&quot; block of the code. Click on the &quot;+&quot; next to this region to expand it. The code in red is the portion I&#39;ve changed to modify the name and the description. The code below is from the VB add-in but the C# code is almost identical and it will be obvious what to edit. <br /></p>
<p></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">Public Shared Sub Register(ByVal t As Type) <br />&#0160;&#0160; Dim clssRoot As RegistryKey = Registry.ClassesRoot <br />&#0160;&#0160; Dim clsid As RegistryKey = Nothing <br />&#0160;&#0160; Dim subKey As RegistryKey = Nothing <br />&#0160;&#0160; Try <br />&#0160;&#0160;&#0160;&#0160;&#0160; clsid = clssRoot.CreateSubKey(&quot;CLSID\&quot; + AddInGuid(t)) <br />&#0160;&#0160;&#0160;&#0160;&#0160; clsid.SetValue(Nothing, <font color="#ff0000"><strong>&quot;Automated DWF and PDF Save&quot;</strong></font>) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey = clsid.CreateSubKey( _&#0160;&#0160; <br />&#0160;&#0160;&#0160; &quot;Implemented Categories\{39AD2B5C-7A29-11D6-8E0A-0010B541CAA8}&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.Close()&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; subKey = clsid.CreateSubKey(&quot;Settings&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.SetValue(&quot;AddInType&quot;, &quot;Standard&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.SetValue(&quot;LoadOnStartUp&quot;, &quot;1&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39;subKey.SetValue(&quot;SupportedSoftwareVersionLessThan&quot;, &quot;&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.SetValue(&quot;SupportedSoftwareVersionGreaterThan&quot;, &quot;12..&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39;subKey.SetValue(&quot;SupportedSoftwareVersionEqualTo&quot;, &quot;&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39;subKey.SetValue(&quot;SupportedSoftwareVersionNotEqualTo&quot;, &quot;&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39;subKey.SetValue(&quot;Hidden&quot;, &quot;0&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39;subKey.SetValue(&quot;UserUnloadable&quot;, &quot;1&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.SetValue(&quot;Version&quot;, 0) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.Close() <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey = clsid.CreateSubKey(&quot;Description&quot;) <br />&#0160;&#0160;&#0160;&#0160;&#0160; subKey.SetValue(Nothing, <font color="#ff0000"><strong>&quot;Saves drawings as DWF and PDF.&quot;</strong></font>) <br />&#0160;&#0160; Catch ex As Exception <br />&#0160;&#0160;&#0160;&#0160;&#0160; System.Diagnostics.Trace.Assert(False) <br />&#0160;&#0160; Finally <br />&#0160;&#0160;&#0160;&#0160;&#0160; If Not subKey Is Nothing Then subKey.Close() <br />&#0160;&#0160;&#0160;&#0160;&#0160; If Not clsid Is Nothing Then clsid.Close() <br />&#0160;&#0160;&#0160;&#0160;&#0160; If Not clssRoot Is Nothing Then clssRoot.Close() <br />&#0160;&#0160; End Try <br />End Sub <br /></div>
<p></p>
<p></p>
<p></p>
<p></p>
<p><font size="4"><strong>
<p style="text-align: left"><br /><font size="3">Reacting to Events in Visual Basic</font></p></strong></font></p>
<p style="text-align: left">Now we can add the code that will react anytime a document is saved. For a VB add-in, add the code below that&#39;s shown in red. The second line is in the &quot;ApplicationAddInServer Members&quot; code region so you&#39;ll need to expand that region to see the code.&#0160; The code consists of a declaration and an assignment. <br /></p>
<p></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">Public Class StandardAddInServer <br />&#0160;&#0160; Implements Inventor.ApplicationAddInServer <br />&#0160;&#0160; &#39; Inventor application object. <br />&#0160;&#0160; Private m_inventorApplication As Inventor.Application <br />&#0160;&#0160; <font color="#ff0000"><strong>Private WithEvents m_appEvents As Inventor.ApplicationEvents <br /></strong></font><br />#Region &quot;ApplicationAddInServer Members&quot; <br />&#0160;&#0160; Public Sub Activate( _</div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal addInSiteObject As Inventor.ApplicationAddInSite, _&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal firstTime As Boolean) _</div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Implements Inventor.ApplicationAddInServer.Activate <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; Initialize AddIn members. <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_inventorApplication = addInSiteObject.Application <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#ff0000"><strong>m_appEvents = m_inventorApplication.ApplicationEvents</strong></font> <br />&#0160;&#0160; End Sub</div>
<p></p>
<p></p>
<p></p>
<p><br />At the top of the code window are two combo boxes. The one on the left displays a list of classes and the one on the right displays a list of methods for the selected class. Choose &quot;m_appEvents&quot; on the left and &quot;OnSaveDocument&quot; on the right, as shown below. This will insert the sub m_appEvents_OnsaveDocument as shown below. This is the event handler for the OnSaveDocument event will be called whenever a document is saved in Inventor.</p>
<br />
<p style="text-align: center"><a href="http://modthemachine.typepad.com/.a/6a00e553fcbfc688340105351af8f2970b-pi"><img alt="OnSaveEventVB" border="0" height="134" src="/assets/image_107029.jpg" style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" width="490" /></a> </p>
<p style="text-align: center">&#0160;</p>
<p></p>
<p>Here&#39;s code that&#39;s equivalent to the original AutoSave macro. This performs a couple of additional checks that the original automatic macro didn&#39;t need to do. First, the OnSaveDocument is fired before and after the document is actually saved.&#0160; This listens for when the event is fired after the Inventor save. The event is also fired whenever any document is saved. This looks for and only handles drawing documents.</p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">Private Sub m_appEvents_OnSaveDocument( _&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal DocumentObject As Inventor._Document, _&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal BeforeOrAfter As Inventor.EventTimingEnum, _&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByVal Context As Inventor.NameValueMap, _&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ByRef HandlingCode As Inventor.HandlingCodeEnum) _&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Handles m_appEvents.OnSaveDocument&#0160; <br /><font color="#ff0000">&#0160; If BeforeOrAfter = EventTimingEnum.kAfter Then&#0160; <br />&#0160;&#0160;&#0160; If DocumentObject.DocumentType = DocumentTypeEnum.kDrawingDocumentObject Then&#0160; <br /></font>&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#0000ff">&#39; Get the filename minus the extension.</font>&#0160; <br /><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160; Dim filename As String&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; filename = DocumentObject.FullFileName&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; filename = Left(filename, Len(filename) - 4)&#0160; <br /></font><br />&#0160;<font color="#0000ff">&#0160;&#0160;&#0160;&#0160; &#39; Save the current SilentOperation and then turn it on.&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; &#39; This will suppress the dwf viewer from being displayed.&#0160;&#0160; <br /></font><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160; Dim currentSetting As Boolean&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; currentSetting = m_inventorApplication.SilentOperation&#0160;&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; m_inventorApplication.SilentOperation = True&#0160; <br /></font><br />&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#0000ff">&#39; Save the file as dwf.</font>&#0160;&#0160; <br /><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160; DocumentObject.SaveAs(filename &amp; &quot;.dwf&quot;, True)&#0160;&#0160; <br /></font><br />&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#0000ff">&#39; Save the file as pdf.</font>&#0160;&#0160; <br /><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160; DocumentObject.SaveAs(filename &amp; &quot;.pdf&quot;, True)&#0160;&#0160; <br /></font><br />&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#0000ff">&#39; Reset SilentOperation back to its previous value.</font>&#0160;&#0160; <br /><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160; m_inventorApplication.SilentOperation = currentSetting</font>&#0160; <br /><font color="#ff0000">&#0160;&#0160;&#0160; End If&#0160;&#0160; <br />&#0160; End If <br /></font>End Sub</div>
<br />
<p><strong><font size="3">Reacting to Events in C#</font></strong></p>
<p>The code highlighted in red below was added to support handling the save event in C#.&#0160; The last two lines are in the &quot;ApplicationAddInServer Members&quot; code region so you&#39;ll need to expand that region to see the code.&#0160; The line where the delegate is created to handle the event is mostly created by using Intellisense.&#0160; Go slowly as you type and you&#39;ll see options pop up that allow you to press the tab key to create much of the code.</p>
<p></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">private Inventor.Application m_inventorApplication; <br /><font color="#ff0000"><strong>private Inventor.ApplicationEvents m_appEvents = null; <br /></strong></font><br />public StandardAddInServer() <br />{ <br />} <br />#region ApplicationAddInServer Members <br /><br />public void Activate(</div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Inventor.ApplicationAddInSite addInSiteObject, </div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bool firstTime) <br />{ <br />&#0160;&#0160; <font color="#0000ff">// Initialize AddIn members.</font> <br />&#0160;&#0160; m_inventorApplication = addInSiteObject.Application; <br />&#0160;&#0160; <font color="#ff0000"><strong>m_appEvents = m_inventorApplication.ApplicationEvents; <br /></strong></font><br />&#0160;<font color="#ff0000"><strong>&#0160; <font color="#0000ff">// Create the delegate object to handle the event.</font> <br />&#0160;&#0160; m_appEvents.OnSaveDocument += new&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ApplicationEventsSink_OnSaveDocumentEventHandler(</strong></font></div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new"><font color="#ff0000"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_appEvents_OnSaveDocument);</strong></font> <br />}</div>
<p><br />Intellisense can also create the event implementation code as you&#39;re typing the line above.&#0160; Below is the code it created with the additional code in red that I added to save the dwf and pdf files. <br /></p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">void m_appEvents_OnSaveDocument(_Document DocumentObject, </div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; EventTimingEnum BeforeOrAfter,</div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; NameValueMap Context, </div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; out HandlingCodeEnum HandlingCode) <br />{ <br /><font color="#ff0000"></font><font color="#0000ff">&#0160;&#0160; // A value has to be returned for the handling code.</font><font color="#ff0000"> <br />&#0160;&#0160; HandlingCode = HandlingCodeEnum.kEventNotHandled; <br /><br />&#0160;&#0160; if (BeforeOrAfter == EventTimingEnum.kAfter) <br />&#0160;&#0160; { <br />&#0160;&#0160;&#0160;&#0160;&#0160; if (DocumentObject.DocumentType == DocumentTypeEnum.kDrawingDocumentObject) <br />&#0160;&#0160;&#0160;&#0160;&#0160; { <br /></font><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; // Get the filename minus the extension.</font><font color="#ff0000"> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; String filename = DocumentObject.FullFileName; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; filename = filename.Substring(0, filename.Length - 4); <br /><br />&#0160;</font><font color="#0000ff">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; // Save the current SilentOperation and then turn it on. <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; // This will suppress the dwf viewer from being displayed.</font><font color="#ff0000"> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Boolean currentSetting = m_inventorApplication.SilentOperation; <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_inventorApplication.SilentOperation = true; <br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font><font color="#0000ff">// Save the file as dwf.</font><font color="#ff0000"> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; DocumentObject.SaveAs(filename + &quot;.dwf&quot;, true);&#0160; <br /><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font><font color="#0000ff">// Save the file as pdf.</font><font color="#ff0000"> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; DocumentObject.SaveAs(filename + &quot;.pdf&quot;, true); </font>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#0000ff">// Reset SilentOperation back to its previous value.</font> <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <font color="#ff0000">m_inventorApplication.SilentOperation = currentSetting;</font>&#0160; <font color="#ff0000"><br />&#0160;&#0160;&#0160;&#0160;&#0160; } <br />&#0160;&#0160; } <br /></font>}</p></div>
<p><strong><font size="4"></font></strong></p>
<p><strong><font size="4"></font></strong></p>
<p><strong><font size="4"><br /></font><font size="3">Cleaning Up</font></strong></p>
<p>Finally, just a bit of code to clean up everything when the add-in is unloaded.&#0160; This is in the Deactivate method of the add-in.&#0160; The code I added is in red.</p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">Public Sub Deactivate() Implements Inventor.ApplicationAddInServer.Deactivate <br />&#0160;&#0160; &#39; Release objects. <br /><font color="#ff0000"><strong>&#0160;&#0160; Marshal.ReleaseComObject(m_appEvents) <br />&#0160;&#0160; m_appEvents = Nothing <br /></strong></font><br />&#0160;&#0160; Marshal.ReleaseComObject(m_inventorApplication) <br />&#0160;&#0160; m_inventorApplication = Nothing <br /><br />&#0160;&#0160; System.GC.WaitForPendingFinalizers() <br />&#0160;&#0160; System.GC.Collect() <br />End Sub</div>
<p></p>
<br />
<p>Here&#39;s the equivalent code for C#. </p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">public void Deactivate() <br />{ <br />&#0160;&#0160; <font color="#0000ff">// Disconnect the event delegate.</font> <br />&#0160;<font color="#ff0000">&#0160; m_appEvents.OnSaveDocument -= new <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ApplicationEventsSink_OnSaveDocumentEventHandler(</font></div>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new"><font color="#ff0000">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_appEvents_OnSaveDocument); <br /></font><br />&#0160;<font color="#0000ff">&#0160; // Release objects.</font> <br />&#0160;<font color="#ff0000">&#0160; Marshal.ReleaseComObject(m_appEvents); <br />&#0160;&#0160; m_appEvents = null; <br /></font>&#0160;&#0160; Marshal.ReleaseComObject(m_inventorApplication); <br />&#0160;&#0160; m_inventorApplication = null; <br /><br />&#0160;&#0160; GC.WaitForPendingFinalizers(); <br />&#0160;&#0160; GC.Collect(); <br />} <br /></div>
<p><strong><font size="4"><br /></font><font size="3">Using the Add-In</font></strong></p>
<p>Now all you need to do is build the add-in.&#0160;&#0160; Building the add-in creates the dll and also registers it.&#0160; When you run Inventor you should see the add-in in the Add-In Manager and when you save a drawing document the corresponding pdf and dwf files will also be created.</p>
<p>To use the add-in on another computer you need to copy the add-in dll to that computer and register it.&#0160; Below are some commands you can use within .bat files to both register and unregister the add-in for 32 and 64-bit installations.</p>
<p><strong>Register on 32-bit</strong> </p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">@echo off <br />C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\RegAsm.exe /codebase AutoSaveAddIn.dll <br />PAUSE <br /></div>
<p><strong><br />Unregister on 32-bit</strong> </p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">@echo off <br />C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\RegAsm.exe /unregister AutoSaveAddIn.dll <br />PAUSE <br /></div>
<p><br /><strong>Register on 64-bit</strong> </p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">@echo off <br />C:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\RegAsm.exe /codebase AutoSaveAddIn.dll <br />PAUSE <br /></div>
<p><strong><br />Unregister on 64-bit</strong> </p>
<div style="FONT-SIZE: 8pt; BACKGROUND: #eeeeee; COLOR: black; LINE-HEIGHT: 140%; FONT-FAMILY: courier new">@echo off <br />C:\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\RegAsm.exe /unregister AutoSaveAddIn.dll <br />PAUSE</div>
<p>When you test the add-in you can&#39;t just open an existing drawing, immediately save it, and expect to see the dwf and pdf files.&#0160; The reason is because the drawing hasn&#39;t changed so clicking the save button doesn&#39;t do anything.&#0160; If you make any change to the drawing, i.e. edit an iProperty or move a view or dimension, the OnSaveDocument event is fired and the additional files will be created.</p>
