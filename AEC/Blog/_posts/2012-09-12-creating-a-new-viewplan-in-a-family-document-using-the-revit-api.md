---
layout: "post"
title: "Creating a New ViewPlan in a Family Document using the Revit API"
date: "2012-09-12 11:13:14"
author: "Saikat Bhattacharya"
categories:
  - ".NET"
  - "Revit"
  - "Saikat Bhattacharya"
original_url: "https://adndevblog.typepad.com/aec/2012/09/creating-a-new-viewplan-in-a-family-document-using-the-revit-api.html "
typepad_basename: "creating-a-new-viewplan-in-a-family-document-using-the-revit-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/saikat-bhattacharya.html">Saikat Bhattacharya</a></p>
<p>In Revit family documents, unlike with Revit project documents, we cannot use the Document.FamilyCreate.NewViewPlan() to create a new ViewPlan. It throws an exception of <em>InvalidOperationException</em> type<em>. </em>This is not totally a surprise. If we open up a specific family document in Revit using the Revit user interface (UI), we can see that there is no way to create a new plan view using the UI. And since API mostly enables workflows that are supported by UI in most cases, it is not surprising that we cannot create new floor plans using the API in those family documents. </p>
<p>Alternatively, the Revit UI does allow users to create a duplicate of views and if this is acceptable by the API users, we can consider using this workflow for creating new floor plans in family documents. The approach to do this is to filter out the desired view (view plan) that needs to be duplicated and use the View.Duplicate() method to create a duplicate of the view. While using this method, you can see that it provides three options for the duplicate method via the ViewDuplicateOption enum and this imitates the functionality available from the UI too – which is to create a duplicate, duplicate with detailing and duplicate as dependent. Once the view has been duplicated, the parameters of the new view can be altered – the snippet below shows how we can change the name, for example. </p>
<div style="background: white;">
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> System;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> System.Collections.Generic;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> System.Text;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> System.Linq;</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> Autodesk.Revit.Attributes;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> Autodesk.Revit.DB;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">using</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> Autodesk.Revit.UI;</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">namespace</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> Revit.SDK.Samples.HelloRevit.CS</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">{</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; [</span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;">(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">TransactionMode</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">.Manual)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">public</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">class</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Command</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> : </span></span></span><span style="line-height: 11pt;"><span style="color: #2b91af; font-size: 8pt;">IExternalCommand</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">public</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Result</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Execute(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ExternalCommandData</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> commandData,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">ref</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">string</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> message,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">ElementSet</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> elements)</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">Document</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> doc = commandData.Application.ActiveUIDocument.Document;</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="line-height: 11pt;"><span style="color: #008000; font-size: 8pt;">// Filter views that match the required criteria</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">FilteredElementCollector</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> collector</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; = </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">new</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">FilteredElementCollector</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">(doc)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; .OfClass(</span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">typeof</span></span><span style="line-height: 11pt;"><span style="color: #000000;">(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">));</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="line-height: 11pt;"><span style="color: #008000; font-size: 8pt;">// Get the specific view(s)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">IEnumerable</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&lt;</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">&gt; views</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; = </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">from</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Autodesk.Revit.DB.</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> f</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">in</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> collector</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">where</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (f.ViewType == </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ViewType</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">.FloorPlan</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &amp;&amp; !f.IsTemplate &amp;&amp; f.ViewName.Equals(</span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #a31515;">&quot;Ref. Level&quot;</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">))</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">select</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> f;</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> trans = </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">new</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;">(doc, </span></span><span style="line-height: 11pt;"><span style="color: #a31515;">&quot;ViewDuplicate&quot;</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">))</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; trans.Start();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">foreach</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> vw </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">in</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> views)</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="line-height: 11pt;"><span style="color: #008000; font-size: 8pt;">// Duplicate the existing ViewPlan view</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> newView = doc.GetElement(vw.Duplicate(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ViewDuplicateOption</span></span><span style="line-height: 11pt;"><span style="color: #000000;">.Duplicate)) </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">as</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">View</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="line-height: 11pt;"><span style="color: #008000; font-size: 8pt;">// Assign the desired name</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">if</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (</span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">null</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;"> != newView)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; newView.ViewName = </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #a31515;">&quot;MyViewName&quot;</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">;</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; trans.Commit();</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="line-height: 11pt;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">return</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Result</span></span></span><span style="line-height: 11pt;"><span style="color: #000000; font-size: 8pt;">.Succeeded;</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">&#0160; }&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000; font-size: 8pt;">}</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="font-family: Courier New; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="color: #000000;">And the new viewplan can be confirmed via the Revit UI, as shown below:</span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;">&#0160;</span><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt;"></span></p>
<p style="margin: 0px;"><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017744aec3ad970d-pi"><img alt="image" border="0" height="128" src="/assets/image_141647.jpg" style="background-image: none; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-top: 0px; border: 0px;" title="image" width="244" /></a></p>
</div>
