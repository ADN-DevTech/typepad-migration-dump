---
layout: "post"
title: "convert value of InwSimpleVertex to float in C#"
date: "2012-05-13 22:55:24"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/05/convert-value-of-inwsimplevertex-to-float-in-c.html "
typepad_basename: "convert-value-of-inwsimplevertex-to-float-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>Last week, we posted an article on how to <a href="http://adndevblog.typepad.com/aec/2012/05/get-primitive-from-solid-of-navisworks.html">get primitives from solid of Navisworks</a>. We got a good question on how to convert value of InwSimpleVertex to float. The value of InwSimpleVertex (corrd) is defined as variant. Before Navisworks 2013, they can be got by an array like below:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> Triangle(COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v1, </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v2, </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v3)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// do your work</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// get the first value of the vertex</span></p>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; float</span> fVal_nw2012_VS2010 = (<span style="color: blue">float</span>)(((<span style="color: #2b91af">Array</span>)v1.coord)).GetValue(1);</p>      <p style="margin: 0px">}</p>   </div> </div>  <p>&#160;</p>  <p>However, this does not work with Navisworks 2013. You will receive an error ‘Unable to cast object of type 'System.Single[*]' to type 'System.Single[]'. The reason is all to do with the interaction between none ‘0 based’ SAFEARRAYS and recent .NET 4.0 C# dynamics. All our COM Api SAFEARRAYs&#160; are 1 based, and the Dot NET dynamic system really doesn’t like this one little bit. Behind the scenes it makes a multi-dimensional Single[*] array with just one dimension, it then tries to cast it to a single-dimensional Single[] array and thus explodes. The VS2010 debugger confuses things as it ‘debatably wrongly’ reports the array as Single[] rather than Single[*].&#160; The solution is as below:</p>  <p>&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> Triangle(COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v1, </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v2, </p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; COMApi.<span style="color: #2b91af">InwSimpleVertex</span> v3)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// do your work</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// get the first value of the vertex</span></p>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="color: #2b91af">&#160;&#160;&#160; Array</span> array_v1 = (<span style="color: #2b91af">Array</span>)(<span style="color: blue">object</span>)v1.coord;</p>   </div>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; float</span> fVal_nw2013_VS2010 = (<span style="color: blue">float</span>)(array_v1.GetValue(1));<span style="color: green">&#160; </span></p>   </div>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="color: blue">&#160;</span></p>      <p style="margin: 0px">}</p>   </div> </div>  <p>&#160;</p>  <p>Note: You must use GetValue() rather than [] indexer.</p>  <p>This is similar to other variant if it is an array such as InwLTransform3f. </p>
