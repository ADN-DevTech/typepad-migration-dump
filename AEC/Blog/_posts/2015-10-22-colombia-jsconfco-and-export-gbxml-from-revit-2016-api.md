---
layout: "post"
title: "Colombia #JSconfCo and Export gbXML from Revit 2016 API"
date: "2015-10-22 13:53:49"
author: "Jaime Rosales"
categories: []
original_url: "https://adndevblog.typepad.com/aec/2015/10/colombia-jsconfco-and-export-gbxml-from-revit-2016-api.html "
typepad_basename: "colombia-jsconfco-and-export-gbxml-from-revit-2016-api"
typepad_status: "Publish"
---

<p><a href="http://adndevblog.typepad.com/aec/jaime-rosales.html">By Jaime Rosales</a> (@<a href="https://twitter.com/AfroJme">afrojme</a>)</p>  <p>Last weekend I traveled to Medellin – Colombia, as one of my colleagues called it, “<em>High tech capital of northern South America</em>” and boy, he was right about it.     <br />I arrived after a connection from JFK to Bogota, on Wednesday the 14th. The reason of my travel, well I was selected to be a Speaker and to give a work shop at the conference (happening for the 2nd time in Medellin, more details here <a href="http://jsconf.co">JsConfCo</a>). A weekend full of activities kicked off with DevFest on Thursday, and the Workshop day for the JSConf on Friday. I had the chance to share my knowledge using the View and Data API (WebGL and Three.js based) and demonstrate through a couple of steps how easy is to now add 3D content to your websites. After a 1 hour and a half workshop, the feedback started to be shown in, what is now one of my favorite social networks, Twitter. The comments were very encouraging to continue what I’ve been doing and Colombians reminded me of the people from my home country. So eager to learn, to achieve more and demonstrate what Colombia has to offer in the Technology field.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08857bc4970d-pi"><img title="IMG_1597" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="IMG_1597" src="/assets/image_327284.jpg" width="300" height="226" /></a><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7e1b8ce970b-pi"><img title="IMG_3219" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="IMG_3219" src="/assets/image_312349.jpg" width="300" height="226" /></a></p>  <p>On Saturday, the talks kicked off with a very special guest, <a href="https://twitter.com/BrendanEich">Brendan Eich</a>. For those of you who don’t know who he is, well basically the Darth Vader of the Web, yes the Creator of JavaScript, and a fun fact about him, he created JS in 10 days. So imagine my feeling when I found out that the main speaker at the conference where I was also presenting was him, trust me it was an incredible feeling. Also many new friends were made and catch up with old ones are always a great experience. Nodebots rock stars like <a href="https://twitter.com/rockbot">Raquel Velez</a> and <a href="https://twitter.com/dtex">Donovan Buck</a>, showed us how you can create robots with JS. Also a German DJ/Dev. <a href="https://twitter.com/TimPietrusky">Tim Pietrusky</a>, showed us his project called <a href="https://twitter.com/NERDDISCO">NerdDisco</a> all using JS, who definitely rocked the stage. For being my first JS Conf to attend I will say it went pretty good.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08857bca970d-pi"><img title="IMG_4258" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="IMG_4258" src="/assets/image_86743.jpg" width="300" height="226" /></a><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d16b84f6970c-pi"><img title="IMG_0005" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="IMG_0005" src="/assets/image_972250.jpg" width="300" height="226" /></a></p>  <p>Medellin, it is a beautiful place in Colombia, Coffee is amazing and Technology definitely is overcoming their dark past, and trust me it looks pretty good. I’m very thankful to the organizers of <a href="https://twitter.com/jsconfco">jsconfco</a>, and the attendees who gave me the opportunity of sharing a bit of my knowledge with 3D web, and looking forward to see them in the near future, once again Gracias Parses!</p>  <p>--------------------------------------------</p>  <p>Ok, enough of my traveling, Let’s get back to Revit API. This week I’ve been helping a developer with a plugin to export to gbXML from the API. Also, there was another case with a very similar question.I will post both questions and both responses which target to the same code answer. </p>  <p><strong>1st case Question</strong>:In Revit 2016, the gbXML export through the Document.Export function appears to generate a faulty XML file. In the attached example, an XML file with only one room is generated even though the project contains three rooms. Exporting through the Revit export menu generates the correct XML file with three rooms. In Revit 2015, the problem does not occur -- both XML files are identical. Here's the code used in our application to start the gbXML export in Revit 2016: </p>  <blockquote>   <div class="code"><font color="#000000">GBXMLExportOptions</font><font color="#808080">&#160;</font><font color="#000000">gbxmloptions</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#0000ff">new</font><font color="#808080">&#160;</font><font color="#000000">GBXMLExportOptions()</font><font color="#0000ff">;</font><font color="#808080">&#160; <br /></font><font color="#000000">gbxmloptions.ExportEnergyModelType</font><font color="#808080">&#160;</font></div>    <div class="code"><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">ExportEnergyModelType.SpatialElement</font><font color="#0000ff">;</font><font color="#808080">&#160; <br />        <br /></font><font color="#006400">// new in Revit 2016:&#160; <br /></font><font color="#000000">EnergyAnalysisDetailModelOptions</font><font color="#808080">&#160;</font><font color="#000000">energyOptions</font><font color="#808080">&#160;</font></div>    <div class="code"><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#0000ff">new</font><font color="#808080">&#160;</font><font color="#000000">EnergyAnalysisDetailModelOptions()</font><font color="#0000ff">;</font><font color="#808080">&#160; <br /></font><font color="#000000">EnergyAnalysisDetailModel.Create(doc,</font><font color="#808080">&#160;</font><font color="#000000">energyOptions)</font><font color="#0000ff">;</font><font color="#808080">&#160; <br />        <br /></font><font color="#0000ff">bool</font><font color="#808080">&#160;</font><font color="#000000">exported</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">doc.Export(exportFolder,</font><font color="#808080">&#160;</font><font color="#000000">filename,</font><font color="#808080">&#160;</font><font color="#000000">gbxmloptions)</font><font color="#0000ff">;</font><font color="#808080">&#160;</font> </div> </blockquote>  <p>&#160;</p>  <p>Why is the gbXML file created this way incomplete? </p>  <p><strong>1st case Answer</strong>: After reaching out to our Revit Engineers, they have confirmed that your 2016 models are saved with a stale energy model (with only 1 analytical space in it). They suggested to as a best practice always regenerate the energy model before exporting it to gbXML. Here is a snippet of code they provided in order to do so. I have already tested and I can confirmed the fix on it.</p>  <blockquote>   <div class="code"><font color="#0000ff">public</font><font color="#808080">&#160;</font><font color="#000000">Result</font><font color="#808080">&#160;</font><font color="#000000">Execute(</font><font color="#808080">        <br />&#160;&#160;&#160; </font><font color="#000000">ExternalCommandData</font><font color="#808080">&#160;</font><font color="#000000">commandData,</font><font color="#808080">        <br />&#160;&#160;&#160; </font><font color="#0000ff">ref</font><font color="#808080">&#160;</font><font color="#0000ff">string</font><font color="#808080">&#160;</font><font color="#000000">message,</font><font color="#808080">        <br />&#160;&#160;&#160; </font><font color="#000000">ElementSet</font><font color="#808080">&#160;</font><font color="#000000">elements)</font><font color="#808080">        <br />&#160;&#160;&#160; </font><font color="#000000">{</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">UIApplication</font><font color="#808080">&#160;</font><font color="#000000">uiapp</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">commandData.</font><font color="#2b91af">Application</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">UIDocument</font><font color="#808080">&#160;</font><font color="#000000">uidoc</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">uiapp.ActiveUIDocument</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#2b91af">Application</font><font color="#808080">&#160;</font><font color="#000000">app</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">uiapp.</font><font color="#2b91af">Application</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">Document</font><font color="#808080">&#160;</font><font color="#000000">doc</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">uidoc.Document</font><font color="#0000ff">;</font><font color="#808080">        <br />        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">GBXMLExportOptions</font><font color="#808080">&#160;</font><font color="#000000">gbxmloptions</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">new</font><font color="#808080">&#160;</font><font color="#000000">GBXMLExportOptions()</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">gbxmloptions.ExportEnergyModelType</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">ExportEnergyModelType.SpatialElement</font><font color="#0000ff">;</font><font color="#808080">        <br />        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#006400">// regenerate energy model        <br /></font><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">EnergyAnalysisDetailModel</font><font color="#808080">&#160;</font><font color="#000000">eadm</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">EnergyAnalysisDetailModel.GetMainEnergyAnalysisDetailModel(doc)</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">if</font><font color="#808080">&#160;</font><font color="#000000">(eadm</font><font color="#808080">&#160;</font><font color="#000000">!</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#0000ff">null</font><font color="#000000">)</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">doc.Delete(eadm.Id)</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#006400">// new in Revit 2016:        <br /></font><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">EnergyAnalysisDetailModelOptions</font><font color="#808080">&#160;</font><font color="#000000">energyOptions</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">new</font><font color="#808080">&#160;</font><font color="#000000">EnergyAnalysisDetailModelOptions()</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">EnergyAnalysisDetailModel.Create(doc,</font><font color="#808080">&#160;</font><font color="#000000">energyOptions)</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">bool</font><font color="#808080">&#160;</font><font color="#000000">exported</font><font color="#808080">&#160;</font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">doc.Export</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">(</font><font color="#808080">&quot;C:\\Desktop&quot;</font><font color="#000000">,</font><font color="#808080"> &quot;FixingModelSample2016&quot;</font><font color="#000000">,</font><font color="#808080">&#160;</font><font color="#000000">gbxmloptions)</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">return</font><font color="#808080">&#160;</font><font color="#000000">Result.Succeeded</font><font color="#0000ff">;</font><font color="#808080">        <br />&#160;&#160;&#160; </font><font color="#000000">}</font> </div> </blockquote>  <div class="code">&#160;</div>  <p>Please try it and let me know.</p>  <p><strong>1st case Response</strong>: That worked, thank you problem solved!</p>  <p>So 1 out of 2 cases done.</p>  <p><strong>2nd case Question:</strong>I've had an gbXML export based on the 2015 SDK samples provided by Autodesk, these were located in the &quot;ImportExport&quot; project. And that worked fine in 2015, but when I now use my own export under 2016 it's doesn't work anymore and throws an error &quot;There is no main EnergyAnalysisDetailModel in the document.&quot;. I've tried the gbXML export in the 2016 SDK and that throws the same error, so the sample doesn't work anymore either. I've looked at the API changes in 2016 and it say you have to create an EnergyAnalysisDetailModel if you want to export gbXML. So I've added the following code to my project, before calling the export function: </p>  <blockquote>   <div class="code"><font color="#000000">EnergyAnalysisDetailModelOptions</font><font color="#808080">&#160;</font><font color="#000000">energyAnalysisDetailModelOptions</font><font color="#808080">&#160;</font></div>    <div class="code"><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#0000ff">new</font><font color="#808080">&#160;</font><font color="#000000">EnergyAnalysisDetailModelOptions()</font><font color="#0000ff">;</font><font color="#808080">&#160; </font></div>    <div class="code"><font color="#808080">       <br /></font><font color="#000000">EnergyAnalysisDetailModel</font><font color="#808080">&#160;</font><font color="#000000">energyAnalysisDetailModel</font><font color="#808080">&#160;</font></div>    <div class="code"><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#0000ff">=</font><font color="#808080">&#160;</font><font color="#000000">EnergyAnalysisDetailModel.Create(m_activeDoc,</font><font color="#808080">&#160;</font></div>    <div class="code"><font color="#808080">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font color="#000000">energyAnalysisDetailModelOptions)</font><font color="#0000ff">;</font><font color="#808080">&#160;</font> </div> </blockquote>  <div class="code">&#160;</div>  <p>Note that the GbXml get's exported but when I commit my transaction, I get the following warning:    <br />&quot;The energy analysis model does not contain any roof surfaces! If there are roofs in your model, please verify that they are space bounding, and make sure that the space offsets are high enough to include the roofs.&quot; What is the best way to create a simple function in Revit 2016 that exports my project to gbXML. I hope you'll have an answer. </p>  <p><strong>2nd case Answer</strong>: Thank you for the RVT model you provided. At first sight I can see that you are missing very important things in your model in order to make it available to be Exported as gbXML, how do I know? Well you can try simply exporting it from the UI, and you will notice that there are many alert messages telling you what you are missing in order to be able to export.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08857bd2970d-pi" target="_blank"><img title="Screen Shot 2015-10-22 at 2.07.02 PM" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Screen Shot 2015-10-22 at 2.07.02 PM" src="/assets/image_396483.jpg" width="266" height="157" /></a><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08857bda970d-pi" target="_blank"><img title="Screen Shot 2015-10-22 at 2.07.22 PM" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Screen Shot 2015-10-22 at 2.07.22 PM" src="/assets/image_338695.jpg" width="230" height="156" /></a><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08857be2970d-pi" target="_blank"><img title="Screen Shot 2015-10-22 at 2.07.36 PM" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Screen Shot 2015-10-22 at 2.07.36 PM" src="/assets/image_160420.jpg" width="231" height="156" /></a></p>  <p>When using the command Export &gt; gbXML, there must be rooms or spaces placed in the project. In the Export gbXML dialog you can also choose which project phase to export (the selected phase needs to have rooms/spaces otherwise an error message displays).</p>  <p>In Revit we export the Revit model according to the gbXML schema.    <br /><a href="http://help.autodesk.com/view/RVT/2016/ENU/?guid=GUID-586B9574-64DA-47BC-B8EC-DEF2D565928F">Here</a> you can read more about the process to create and export the right gbXML file. </p>  <p>After modifying your sample model, adding a Room and a Roof to it, and also making sure the Room Bounding is setup correctly, I'm able to export your model both from UI and the Code I provided you. Best practice will be, Do it first from the UI, so you can make sure there is a good chance it will work from your code. Other than that you tend to be shooting blind. I hope this helps you and please let me know how it goes. </p>  <p>I still haven’t heard back from the developer, I will update the post once I hear back, but for what I can see, everything is working as excepted even when I used the RVT project he provided. </p>  <p>Hope this helps you with your next gbXML exporter plugin. Cheers, until next time.</p>
