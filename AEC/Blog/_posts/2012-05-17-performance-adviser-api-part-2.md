---
layout: "post"
title: "Performance Adviser API &ndash; Part 2"
date: "2012-05-17 08:00:00"
author: "Saikat Bhattacharya"
categories:
  - ".NET"
  - "Revit"
  - "Saikat Bhattacharya"
original_url: "https://adndevblog.typepad.com/aec/2012/05/performance-adviser-api-part-2.html "
typepad_basename: "performance-adviser-api-part-2"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/saikat-bhattacharya.html" target="_self">Saikat Bhattacharya</a></p>
<p>In this post, we shall look the steps involved in executing a performance adviser rule.</p>
<p>While listing all the existing performance adviser rules, we can use the name of a rule to search for a specific rule that we wish to execute. Another approach for selecting rules for execution, is to create a dialog with a list of registered rules and provide the ability for users to select one or more rules for execution from the dialog. The Revit SDK sample called PerformanceAdviserControl sample uses a similar approach by providing a list of rules for the users to select from, for execution.</p>
<p>Once we know the rules that we are interested in, we can use PerformanceAdviser.ExecuteRules() method to execute the given rules using the rule ids. ExecuteRules() method takes a document and a set of rule ids as input arguments. It returns a list of FailureMessages, which we can iterate through and display, for instance, in a standard Revit warning dialog using Document.PostFailure() method.</p>
<p>The following command shows a simple example of executing “Overlapping walls” performance adviser rule:&#0160;</p>
<div style="background: white;">
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> System;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> System.Collections.Generic;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> System.Linq;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> System.Text;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Autodesk.Revit.UI;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Autodesk.Revit.DB;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">using</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Autodesk.Revit.Attributes;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #0000ff;">namespace</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> PASample</span></span></span></p>
<p style="margin: 0px;"><span style="font-size: 8pt;"><span style="line-height: 11pt;"><span style="font-family: Courier New;"><span style="color: #000000;">{</span></span></span><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160; [</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;">(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">TransactionMode</span></span><span style="line-height: 11pt;"><span style="color: #000000;">.Manual)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">public</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">class</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ExecutePerformanceRule</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> : </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">IExternalCommand</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">public</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Result</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> Execute(</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ExternalCommandData</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> commandData,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">ref</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">string</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> message, </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">ElementSet</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> elements)</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Document</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> doc =</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; commandData.Application.ActiveUIDocument.Document;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #008000;">// Get access to the Performance Adviser object</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviser</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> adviser =</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviser</span></span><span style="line-height: 11pt;"><span style="color: #000000;">.GetPerformanceAdviser();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #008000;">// List all the rules </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">IList</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&lt;</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviserRuleId</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&gt; ruleIds =</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; adviser.GetAllRuleIds();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #008000;">// Create an empty list for the rules to be executed</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">IList</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&lt;</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviserRuleId</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&gt; rulesIdsToExecute =</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">new</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">List</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&lt;</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviserRuleId</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&gt;();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #008000;">// Iterate through each </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">foreach</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">PerformanceAdviserRuleId</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> ruleId </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">in</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> ruleIds)</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">if</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (adviser.GetRuleName(ruleId).Equals(</span></span><span style="line-height: 11pt;"><span style="color: #a31515;">&quot;Overlapping walls&quot;</span></span><span style="line-height: 11pt;"><span style="color: #000000;">))</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rulesIdsToExecute.Add(ruleId);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">break</span></span><span style="line-height: 11pt;"><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #008000;">// Now we need to post the results</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">IList</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&lt;</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">FailureMessage</span></span><span style="line-height: 11pt;"><span style="color: #000000;">&gt; failureMessages = adviser.ExecuteRules(</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc, rulesIdsToExecute);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">foreach</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> (</span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">FailureMessage</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> fm </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">in</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> failureMessages)</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> trans = </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">new</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Transaction</span></span><span style="line-height: 11pt;"><span style="color: #000000;">(doc, </span></span><span style="line-height: 11pt;"><span style="color: #a31515;">&quot;Failure Reporting&quot;</span></span><span style="line-height: 11pt;"><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; trans.Start();</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.PostFailure(fm);</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; trans.Commit();</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;"><span style="line-height: 11pt;"><span style="color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="line-height: 11pt;"><span style="color: #0000ff;">return</span></span><span style="line-height: 11pt;"><span style="color: #000000;"> </span></span><span style="line-height: 11pt;"><span style="color: #2b91af;">Result</span></span><span style="line-height: 11pt;"><span style="color: #000000;">.Succeeded;</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New;"><span style="color: #000000;">&#0160;&#0160;&#0160; }</span></span></span></p>
<p style="margin: 0px;"><span style="line-height: 11pt; font-size: 8pt;"><span style="font-family: Courier New; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New; font-size: 8pt;">}</span></p>
</div>
<p>In the next post and the last post on this series on this topic, we shall look at defining a custom rule.</p>
