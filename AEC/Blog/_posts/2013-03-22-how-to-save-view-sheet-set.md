---
layout: "post"
title: "How to save view sheet set"
date: "2013-03-22 08:51:21"
author: "Joe Ye"
categories:
  - ".NET"
  - "Revit"
original_url: "https://adndevblog.typepad.com/aec/2013/03/how-to-save-view-sheet-set.html "
typepad_basename: "how-to-save-view-sheet-set"
typepad_status: "Draft"
---

<p>By <a href="http://adndevblog.typepad.com/aec/joe-ye.html">Joe Ye</a></p>  <p>&#160;</p>  <p>It is a common question how to save view sheet set programmatically.&#160; Using the Revit UI command, users can save view sheet set to a specified name. We can do this via Revit API. </p>  <p>Here is a full command code showing how to save view sheet set.</p>  <p>&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">[</span><span style="line-height: 140%; color: #2b91af">TransactionAttribute</span><span style="line-height: 140%">(Autodesk.Revit.Attributes.</span><span style="line-height: 140%; color: #2b91af">TransactionMode</span><span style="line-height: 140%">.Manual)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">RevitCommand4</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">IExternalCommand</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Result</span><span style="line-height: 140%"> Execute(</span><span style="line-height: 140%; color: #2b91af">ExternalCommandData</span><span style="line-height: 140%"> commandData, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ref</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> messages, </span><span style="line-height: 140%; color: #2b91af">ElementSet</span><span style="line-height: 140%"> elements)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">UIApplication</span><span style="line-height: 140%"> app = commandData.Application;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc = app.ActiveUIDocument.Document;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> trans = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%">(doc, </span><span style="line-height: 140%; color: #a31515">&quot;ExComm&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; trans.Start();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">FilteredElementCollector</span><span style="line-height: 140%"> collector = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">FilteredElementCollector</span><span style="line-height: 140%">(doc);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; collector.OfClass(</span><span style="line-height: 140%; color: blue">typeof</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">ViewPlan</span><span style="line-height: 140%">)).OfCategory(</span><span style="line-height: 140%; color: #2b91af">BuiltInCategory</span><span style="line-height: 140%">.OST_Views);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ViewSet</span><span style="line-height: 140%"> vs = app.Application.Create.NewViewSet();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">foreach</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">Element</span><span style="line-height: 140%"> elem </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> collector)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ViewPlan</span><span style="line-height: 140%"> plan = elem </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ViewPlan</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (plan.IsTemplate == </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; vs.Insert(plan);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">PrintManager</span><span style="line-height: 140%"> pm = doc.PrintManager;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> viewSheetSetName = </span><span style="line-height: 140%; color: #a31515">&quot;asPlans1333355&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ViewSheetSetting</span><span style="line-height: 140%"> setting = pm.ViewSheetSetting;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; setting.SaveAs(viewSheetSetName);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; setting.CurrentViewSheetSet.Views = vs;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; setting.Save();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//pm.ViewSheetSetting.SaveAs(viewSheetSetName);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//pm.ViewSheetSetting.CurrentViewSheetSet.Views = vs;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//pm.ViewSheetSetting.Save();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pm.PrintRange = </span><span style="line-height: 140%; color: #2b91af">PrintRange</span><span style="line-height: 140%">.Select;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pm.CombinedFile = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pm.PrintToFile = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; trans.Commit();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pm.SubmitPrint();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Result</span><span style="line-height: 140%">.Succeeded;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p>&#160;</p>  <p>Several notes about this code.</p>  <p>1. SaveAs ViewSheetSetting, assign views to ViewSheetSet, and save the ViewSheetSetting code should be within a transaction. These actions actually changed the document. So transaction is necessary.</p>  <p>2.&#160;&#160; The following three line cannot be replaced by the three lines after it.</p>  <p>//pm.ViewSheetSetting.SaveAs(viewSheetSetName);    <br />//pm.ViewSheetSetting.CurrentViewSheetSet.Views = vs;     <br />//pm.ViewSheetSetting.Save();</p>  <p>setting.SaveAs(viewSheetSetName);    <br />setting.CurrentViewSheetSet.Views = vs;     <br />setting.Save();</p>  <p>Reason:&#160; every time we call pm.ViewSheetSetting, it returns a new ViewSheetSetting instance. So for the following three lines, the three actions take place to three different ViewSheetingSetting objects. That is not we expected.</p>  <p>//pm.ViewSheetSetting.SaveAs(viewSheetSetName);    <br />//pm.ViewSheetSetting.CurrentViewSheetSet.Views = vs;     <br />//pm.ViewSheetSetting.Save();</p>  <p>We want the three actions take place to the same ViewSheetSetting object, so we first get a ViewSheetSetting instance, then operate on this ViewSheetSetting instance.</p>  <p>Simillarly, Document.PrintManager returns different PrintManager if you call it one after another. </p>  <p>So the following two lines take place to two different PrintManager object.</p>  <p>Doc.PrintManager.PrintRange = PrintRange.Select;    <br />Doc.PrintManager..CombinedFile = true;</p>  <p>Make sure to return one PrintManager assign it a a PrintManager variable first, then operate on this variable.</p>
