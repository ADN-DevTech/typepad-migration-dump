---
layout: "post"
title: "NWcreate: Color of Geometry does not take effect on Cylinder"
date: "2012-07-13 01:48:40"
author: "Xiaodong Liang"
categories:
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/07/nwcreate-color-of-geometry-does-not-take-effect-on-cylinder.html "
typepad_basename: "nwcreate-color-of-geometry-does-not-take-effect-on-cylinder"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><strong>Issue</strong>     <br />I'm using nwcreate API and having a problem with setting color for geometry stream. It's ok when set color for creating Conic, but no effect when set color for creating Cylinder like this:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LiNwcGeometryStreamBegin (stream, LI_NWC_VERTEX_COLOR);&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LiNwcGeometryStreamColor(stream,1,0,0,0);&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LiNwcGeometryStreamCylinder(stream,centerPt,centerPt1,Radius);</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span>&#160;</p> </div> <strong>Solution   <br /></strong>  <p>It is because the Cylinder functions are creating parametric primitives (as opposed to the Conic function which is just making a standard primitive). Parametric primitives don't currently support per-vertex colors. We normally recommend you set the color of an item by attaching a material attribute to the node. The code snippet below is a demo.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> doExport()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// the nwc file to export</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtWideString wfilename&#160; = L</span><span style="line-height: 140%; color: #a31515">&quot;test.nwc&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// nwc scene</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtNwcScene scene;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//nwc Geometry</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtNwcGeometry geom; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// nwc stream</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtNwcGeometryStream stream;&#160;&#160;&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//create the Scene</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; scene = LiNwcSceneCreate();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// create the geometry</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; geom = LiNwcGeometryCreate();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// open the stream to define the geometric data that</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// will be stored in a geometry node.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; stream = LiNwcGeometryOpenStream(geom);&#160;&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//define the parameters</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtPoint centerPt = { 10, 10, 0 };</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtPoint centerPt1 = { 10, 10, 50 };</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LtUnitVector vector = {0,0,1};</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> Radius = 10;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// ** wrong way if the geometry creates parametric primitives **</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//LiNwcGeometryStreamBegin (stream, LI_NWC_VERTEX_COLOR);&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//LiNwcGeometryStreamColor(stream,1,0,0,0);&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//LiNwcGeometryStreamCylinder(stream,centerPt,centerPt1,Radius);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//**********************</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//**** worked way******</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//start defining a piece of geometry </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcGeometryStreamBegin (stream, 0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// draw a cylinder</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcGeometryStreamCylinder(stream,centerPt,centerPt1,Radius); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// end</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcGeometryStreamEnd(stream);&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// define the material</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LtNwcMaterial _material;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; _material = LiNwcMaterialCreate();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcMaterialSetDiffuseColor(_material, 0.9,0.0,0.0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcMaterialSetAmbientColor(_material, 0.9,0.0,0.0); </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//Add an attribute of color to the node </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcNodeAddAttribute(geom, _material);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcMaterialDestroy(_material);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//*****************</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//close the stream</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcGeometryCloseStream( geom, stream);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//add the geometry to the scene and cleanup geom</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcSceneAddNode (scene, geom);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcGeometryDestroy(geom);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">//write out the NWC file</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; LiNwcSceneWriteCacheEx(scene, wfilename, wfilename, 0, 0); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LiNwcSceneDestroy(scene);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
