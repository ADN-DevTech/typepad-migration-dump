---
layout: "post"
title: "use CreatePicture in .NET"
date: "2012-05-30 01:25:07"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/05/use-createpicture-in-net.html "
typepad_basename: "use-createpicture-in-net"
typepad_status: "Publish"
---

<p style="font-family: courier new; background: white; color: black; font-size: 8pt">By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>Issue    <br />We use automation to start the Navisworks manage and then create a snapshot by CreatePicture. This program worked on 32bits, but failed on 64bits OS.</p>  <p> Solution CreatePicture can only be used by in-process application because the output is IPictureDisp which cannot be passed across process boundaries. The MSDN knowledge base tells more: http://support.microsoft.com/kb/150034/en-us Following is the code snippet of a .NET plugin. </p>  <p style="font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.Navisworks.Api;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.Navisworks.Api.Plugins;</span>&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> ComApi = Autodesk.Navisworks.Api.Interop.ComApi;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> ComApiBridge = Autodesk.Navisworks.Api.ComApi;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span></p> </div>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> createPic()</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">{</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpState10</span><span style="line-height: 140%"> state;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; state = ComApiBridge.</span><span style="line-height: 140%; color: #2b91af">ComApiBridge</span><span style="line-height: 140%">.State;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; stdole.</span><span style="line-height: 140%; color: #2b91af">IPictureDisp</span><span style="line-height: 140%"> img;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hbitmap;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; System.Drawing.</span><span style="line-height: 140%; color: #2b91af">Bitmap</span><span style="line-height: 140%"> bm = </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; img = (stdole.</span><span style="line-height: 140%; color: #2b91af">IPictureDisp</span><span style="line-height: 140%">)state.CreatePicture(state.CurrentView, </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">, 640, 800);</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (img.Handle != 0)</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; {</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; hbitmap = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> System.</span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%">(img.Handle);</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; bm = System.Drawing.</span><span style="line-height: 140%; color: #2b91af">Bitmap</span><span style="line-height: 140%">.FromHbitmap(hbitmap);</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; bm.Save(</span><span style="line-height: 140%; color: #a31515">&quot;c:\\dem_test.bmp&quot;</span><span style="line-height: 140%">);</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; }</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">&#160; img = </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt">&#160;</p>  <p style="margin: 0px; font-family: courier new; background: white; color: black; font-size: 8pt"><span style="line-height: 140%">}</span></p>  <p><span style="line-height: 140%"></span></p>  <p style="margin: 0px"><span style="line-height: 140%">&#160;</span></p>
