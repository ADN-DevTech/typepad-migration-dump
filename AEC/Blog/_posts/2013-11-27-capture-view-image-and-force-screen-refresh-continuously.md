---
layout: "post"
title: "Capture view image and force screen refresh continuously"
date: "2013-11-27 22:06:28"
author: "Xiaodong Liang"
categories: []
original_url: "https://adndevblog.typepad.com/aec/2013/11/capture-view-image-and-force-screen-refresh-continuously.html "
typepad_basename: "capture-view-image-and-force-screen-refresh-continuously"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p>A few months ago, one developer tried to change view state (such as change object color/transparency, hide some objects etc), and save the <a href="http://adndevblog.typepad.com/aec/2012/05/use-createpicture-in-net.html">capture image</a> file per view in a loop. This happens continuously. But, view state is not updated on screen as expected at once. e.g. the item color is set to red, but the item is still the older color in the screen (wrong), while the item in the snapshot is red (correct). He wanted to know the way to force screen refresh.</p>
<p>My colleaguge <a href="http://adndevblog.typepad.com/technology_perspective/toshiaki-isezaki.html">Toshiaki Isezaki</a> spent some time to invesigate with engineer team and worked out the solutions. I am just writing down his achievements.</p>
<p>The Navisworks screen refresh happens when the UI message loop delivers a paint event. If you have some code running that sits in a loop doing lots of work (for example rendering 100 images to file) then there’s no way for the UI message loop to deliver a paint event.</p>
<p>In theory, there’s a couple of ways to approach this</p>
<p>#1. Break the process up. When the button is pressed hide everything and subscribe to Application.Idle event. When the idle event fires make one item visible and create a picture. Control returns to UI message loop after each picture created, paint event is delivered, Navisworks redraws then idle gets raised again.</p>
<p>#2. Manually force a redraw during the loop. Navisworks API doesn’t directly support this – you would need to use Windows level API. For example, run the message loop until all events processed or find view window and manually send it a paint message.</p>
<p>#3. Display the rendered image yourself. For example, add some space to the dialog and after creating the picture, load the image in and show it. This also saves having to render the image twice.</p>
<p>By experiment, the working solutions with Navisworks plugin are #1 and #3.</p>
<p><strong>Solution #1</strong>: code should use a <span style="color: #6000bf;">modeless dialog</span> and code should look like:</p>
<p>OnButtonPressed</p>
<p>· Hide everything <br />· Subscribe to idle event <br />· DoOnePicture <br />OnIdleEvent <br />· DoOnePicture <br />· If this is last picture unsubscribe from idle event, run end of process code</p>
<p>The idle event happens when there is no more processing, so don’t do all the processing in one go.</p>
<p>The following is the snippet from the attached demo project. <span class="asset  asset-generic at-xid-6a0167607c2431970b019b01c4168d970c"><a href="http://adndevblog.typepad.com/files/capture2013.zip">Download Capture2013</a></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span style="font-family: &#39;Times New Roman&#39;;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="color: #0000ff;"><span style="font-size: 8pt;">public</span></span></span><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-size: 8pt;"><span><span style="color: #0000ff;">partial</span></span><span><span style="color: #0000ff;">class</span></span><span><span style="color: #2b91af;">Form1</span></span><span style="color: #000000;"> : </span></span><span><span style="font-size: 8pt; color: #2b91af;">Form</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">{</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// index to record the the count </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// which has been performed with hidden </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">static</span></span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> m_Index = 0;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//the items collection to be hidden</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">static</span></span><span><span style="color: #2b91af;">Collection</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">ModelItemCollection</span></span><span style="color: #000000;">&gt; m_hiddens = </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">new</span></span><span><span style="color: #2b91af;">Collection</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">ModelItemCollection</span></span><span style="color: #000000;">&gt;();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">[</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">DllImport</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;user32.dll&quot;</span></span><span style="color: #000000;">)]</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">static</span></span><span><span style="color: #0000ff;">extern</span></span><span><span style="color: #0000ff;">bool</span></span><span style="color: #000000;"> InvalidateRect(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> hWnd, </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> lpRect, </span><span><span style="color: #0000ff;">bool</span></span><span style="color: #000000;"> bErase);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">[</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">DllImport</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;user32.dll&quot;</span></span><span style="color: #000000;">)]</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">static</span></span><span><span style="color: #0000ff;">extern</span></span><span><span style="color: #0000ff;">bool</span></span><span style="color: #000000;"> UpdateWindow(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> hWnd);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> Form1()</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">InitializeComponent();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">private</span></span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> button1_Click(</span><span><span style="color: #0000ff;">object</span></span><span style="color: #000000;"> sender, </span><span><span style="color: #2b91af;">EventArgs</span></span><span style="color: #000000;"> e)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">m_hiddens.Clear();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">foreach</span></span><span style="color: #000000;"> (</span><span><span style="color: #2b91af;">ModelItem</span></span><span style="color: #000000;"> item </span><span><span style="color: #0000ff;">in</span></span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">ActiveDocument.Models.RootItemDescendantsAndSelf)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (item.IsLayer)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="color: #008000;"><span style="font-size: 8pt;">// to make simpler, only check the item which is layer</span><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">ModelItemCollection</span></span><span style="color: #000000;"> hidden = </span><span><span style="color: #0000ff;">new</span></span><span><span style="color: #2b91af;">ModelItemCollection</span></span><span style="color: #000000;">();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">hidden.Add(item);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//add this item to the hidden collection</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span style="mso-spacerun: yes;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span>m_hiddens.Add(hidden);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//perform hidden on the items</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// in this case, it means to hide everything</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">ActiveDocument.Models.SetHidden(hidden, </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//Subscribe to idle event</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.Idle +=</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">new</span></span><span><span style="color: #2b91af;">EventHandler</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">EventArgs</span></span><span style="color: #000000;">&gt;(Idle_EventHandler);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">static</span></span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> Idle_EventHandler(</span><span><span style="color: #0000ff;">object</span></span><span style="color: #000000;"> sender, </span><span><span style="color: #2b91af;">EventArgs</span></span><span style="color: #000000;"> e)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//get handle of Navisworks window</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> hWnd = Autodesk.Navisworks.Api.</span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.Gui.MainWindow.Handle;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="mso-spacerun: yes;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (m_Index &lt; m_hiddens.Count)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// if this is NOT the last view we need to create image</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// make one item visible</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.ActiveDocument.</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Models.SetHidden(m_hiddens.ElementAt(m_Index), </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">false</span></span><span style="color: #000000;">);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// inform Navisworks screen refreshing</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">InvalidateRect(hWnd, </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;">.Zero, </span><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">UpdateWindow(hWnd);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//Create the picture</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">ComApi.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">InwOpState10</span></span><span style="color: #000000;"> state;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">state = ComApiBridge.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">ComApiBridge</span></span><span style="color: #000000;">.State;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">stdole.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IPictureDisp</span></span><span style="color: #000000;"> img;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> hbitmap;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">System.Drawing.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Bitmap</span></span><span style="color: #000000;"> bm = </span><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Document</span></span><span style="color: #000000;"> doc = Autodesk.Navisworks.Api.</span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.ActiveDocument;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;"> h = doc.ActiveView.Height;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;"> w = doc.ActiveView.Width;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">img = (stdole.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IPictureDisp</span></span><span style="color: #000000;">)state.CreatePicture(state.CurrentView, </span><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">, w, h);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (img.Handle != 0)</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;"> strName = </span><span><span style="color: #a31515;">&quot;c:\\Temp\\TestImages\\&quot;</span></span><span style="color: #000000;"> + m_Index.ToString() + </span><span><span style="color: #a31515;">&quot;_&quot;</span></span><span style="color: #000000;"> + m_hiddens.ElementAt(m_Index).First.DisplayName + </span><span><span style="color: #a31515;">&quot;.png&quot;</span></span><span style="color: #000000;">;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">hbitmap = </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> System.</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;">(img.Handle);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">bm = System.Drawing.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Bitmap</span></span><span style="color: #000000;">.FromHbitmap(hbitmap);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">bm.Save(strName, </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">ImageFormat</span></span><span style="color: #000000;">.Png);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">bm.Dispose();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">img = </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//increase the index</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">m_Index++;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #0000ff;">else</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">{</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//If this is last picture unsubscribe from idle event, </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">// run end of process code</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">Autodesk.Navisworks.Api.</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.Idle -= </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">new</span></span><span><span style="color: #2b91af;">EventHandler</span></span><span style="color: #000000;">&lt;</span><span><span style="color: #2b91af;">EventArgs</span></span><span style="color: #000000;">&gt;(Idle_EventHandler);</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//clear the hidden collection, for next use</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">m_hiddens.Clear();</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: yes;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span></span><span><span style="font-size: 8pt; color: #008000;">//reset index</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">m_Index = 0;</span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">} </span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="color: #000000;"><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;">}</span><span style="mso-spacerun: yes;"><span style="font-size: 8pt;">&#0160;&#0160; </span></span></span></span></span></p>
<p align="left" class="MsoNormal" style="line-height: normal; margin: 0cm 0cm 0pt; mso-layout-grid-align: none;"><span lang="EN-US" style="mso-fareast-font-family: &#39;Arial Unicode MS&#39;; mso-font-kerning: 0pt;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 8pt; color: #000000;">}</span></span></span></p>
<p align="justify" class="MsoNormal" style="text-justify: inter-ideograph; line-height: normal; margin: 0cm 0cm 0pt;">&#0160;</p>
<p align="justify" class="MsoNormal" style="text-justify: inter-ideograph; line-height: normal; margin: 0cm 0cm 0pt;">I will introduce the solution #3 in the other article because it is not only for the question in this article, but also could be a good sample to do simulation in the custom dialog.</p>
