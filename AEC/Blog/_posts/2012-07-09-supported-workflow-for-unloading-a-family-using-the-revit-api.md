---
layout: "post"
title: "Supported workflow for unloading a family using the Revit API"
date: "2012-07-09 13:25:53"
author: "Saikat Bhattacharya"
categories:
  - ".NET"
  - "Revit"
  - "Saikat Bhattacharya"
original_url: "https://adndevblog.typepad.com/aec/2012/07/supported-workflow-for-unloading-a-family-using-the-revit-api.html "
typepad_basename: "supported-workflow-for-unloading-a-family-using-the-revit-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/saikat-bhattacharya.html" target="_self">Saikat Bhattacharya</a></p>  <p>In any given Revit model, if we wish to unload a family, we can delete the family from the model itself. This will unload the family from the model and this can be confirmed via the removal of the family name from the Family node in the Project Browser tree. However, while deleting the family from the model, we should not be using a workflow in which we are filtering all the loaded families and then iterating through each of the family to access the exact family we are looking to unload (using family name, category, etc) and then deleting the desired family. This workflow can cause unexpected behaviors since deleting elements from within element iteration is not a supported workflow. Instead, we should be extracting the desired family precisely (ideally, using its name, category etc. in the filter itself) and then performing the delete operation after completing the loaded family iteration. The code below illustrates this approach in detail:</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Collections.Generic</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Autodesk.Revit.ApplicationServices</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Autodesk.Revit.Attributes</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Autodesk.Revit.DB</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Autodesk.Revit.UI</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&lt;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">Transaction</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#2b91af">TransactionMode</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Manual)&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Class</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#2b91af">clsCommand</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Implements</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#2b91af">IExternalCommand</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Function</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Execute(</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> commandData </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">ExternalCommandData</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">,</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">ByRef</font></span><span style="line-height: 11pt"><font color="#000000"> message </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">String</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">,</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> elements </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">ElementSet</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">) _</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Result</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Implements</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">IExternalCommand</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Execute</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> uiDoc </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">UIDocument</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> =</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; commandData.Application.ActiveUIDocument</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> doc </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Document</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> = uiDoc.Document</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> collector </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">FilteredElementCollector</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> =</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">New</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">FilteredElementCollector</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(doc).OfClass(</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">GetType</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#2b91af">Family</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">))</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> results </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">IEnumerable</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> =</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">From</font></span><span style="line-height: 11pt"><font color="#000000"> d </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Family</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">In</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> collector</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Where</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> d.FamilyCategory.Name.Equals(</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Generic Annotations&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Where</font></span><span style="line-height: 11pt"><font color="#000000"> d.Name.Equals(</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;AnnotationName&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> family </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Family</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> = results(0)</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> T </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">New</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Transaction</font></span><span style="line-height: 11pt"><font color="#000000">(doc, </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;Delete&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; T.Start()</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; doc.Delete(family)</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; T.Commit()</font></font></span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Catch</font></span><span style="line-height: 11pt"><font color="#000000"> ex </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#2b91af">Exception</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">TaskDialog</font></span><span style="line-height: 11pt"><font color="#000000">.Show(</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;Error&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, ex.Message)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Return</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Result</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Succeeded</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Function</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Class</font></span></font></p> </div>
