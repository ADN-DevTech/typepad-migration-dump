---
layout: "post"
title: "Determine if the an Revit element in a shared model is owned by the current user"
date: "2014-03-27 01:49:16"
author: "Joe Ye"
categories: []
original_url: "https://adndevblog.typepad.com/aec/2014/03/determine-if-the-an-revit-element-in-a-shared-model-is-owned-by-the-current-user.html "
typepad_basename: "determine-if-the-an-revit-element-in-a-shared-model-is-owned-by-the-current-user"
typepad_status: "Publish"
---

<p><a href="http://adndevblog.typepad.com/aec/joe-ye.html">Joe Ye</a></p>  <p>How can we identify whether the element we trying to modify is owned by me before commit the command, if so prompt to synchronize.</p>  <p>&#160;</p>  <p>For any visible element in a Revit shared model, we can get this element’s work set work set id by Document.GetWorksetId() method. Then you can retrieve the corresponding WorkSet object by WorkSetTable.GetWorkSet() method. WorkSet.Owner returns the work set’s owner name. Finally compare the work set owner with Revit current user name.</p>  <p>Here is the simplest code to show the process.</p>  <div style="font-size: 9pt; font-family: 新宋体; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Collections.Generic;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Text;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Windows.Forms;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.Revit.DB;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.Revit.UI;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.Revit.ApplicationServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.Revit.Attributes;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.Revit.UI.Selection;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">[<span style="color: #2b91af">TransactionAttribute</span>(<span style="color: #2b91af">TransactionMode</span>.Manual)]</p>    <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">RevitCommand</span> : <span style="color: #2b91af">IExternalCommand</span></p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">Result</span> Execute(<span style="color: #2b91af">ExternalCommandData</span> commandData,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">string</span> messages, <span style="color: #2b91af">ElementSet</span> elements)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">UIApplication</span> app = commandData.Application;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Document</span> doc = app.ActiveUIDocument.Document;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Transaction</span> trans = <span style="color: blue">new</span> <span style="color: #2b91af">Transaction</span>(doc);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; trans.Start(<span style="color: #a31515">&quot;testComamnd&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Selection</span> sel = app.ActiveUIDocument.Selection;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Reference</span> ref1 = sel.PickObject(<span style="color: #2b91af">ObjectType</span>.Element, <span style="color: #a31515">&quot;pick an element&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Element</span> elem = doc.GetElement(ref1);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// code changing this element here. </span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// for simplicity, no change here. </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//Get the workset information.</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">WorksetId</span> idWS = doc.GetWorksetId(elem.Id);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">WorksetTable</span> table = doc.GetWorksetTable();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Workset</span> ws = table.GetWorkset(idWS);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> owner = ws.Owner;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; trans.Commit();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//Compare with the current user.</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (owner == app.Application.Username)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">TaskDialog</span>.Show(<span style="color: #a31515">&quot;Synchronize reminder&quot;</span>, <span style="color: #a31515">&quot;The picked element was updated, please synchronize the document&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #2b91af">Result</span>.Succeeded;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"></p> </div>
