---
layout: "post"
title: "Reading Loss Methods available on Revit MEP"
date: "2015-06-24 04:13:28"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "Revit MEP"
original_url: "https://adndevblog.typepad.com/aec/2015/06/reading-loss-methods-available-on-revit-mep.html "
typepad_basename: "reading-loss-methods-available-on-revit-mep"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>At this <a href="http://adndevblog.typepad.com/aec/2015/05/reading-ashrae-table-information-from-elements.html">previous blog post</a> you can find how to read ASHRAE table of a specific element. Basically a GUID is stored at the Built in parameter as a string: RBS_DUCT_FITTING_LOSS_METHOD_SERVER_PARAM</p>  <p>But where can we get the list of Loss Methods available?</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d12d3a3c970c-pi"><img title="Loss Methods available" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="Loss Methods available" src="/assets/image_189597.jpg" width="313" height="110" /></a> </p>  <p>The following sample show the <strong>getLossMethods</strong> function that will read the ExternalServer that holds that information and create a list of names and guids of each loss method available. The most important is the guid of each method as this is the information required on the parameter. </p>  <p>For this sample, it will create a simple list of LossCoef data structure, that contains the value pair (and you may replace this with a hash list, or a winform that show the options, etc). Also note this sample is for Ducts (type of the server, see <a href="http://adndevblog.typepad.com/aec/2015/05/reading-ashrae-table-information-from-elements.html">previous post</a> for Pipes)</p>  <p><span style="color: green">// temp structure to hold data</span>     <br /><span style="color: blue">struct</span>&#160;<span style="color: #2b91af">LossCoef</span>{<span style="color: blue">public</span>&#160;<span style="color: #2b91af">Guid</span> id; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> name;}     <br />    <br /><span style="color: blue">private</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">LossCoef</span>&gt; getLossMethods(<span style="color: #2b91af">ExternalServiceId</span> serviceId)     <br />{     <br />&#160; <span style="color: #2b91af">MultiServerService</span> service = <span style="color: #2b91af">ExternalServiceRegistry</span>.     <br />&#160;&#160;&#160; GetService(serviceId) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">MultiServerService</span>;     <br />&#160; <span style="color: #2b91af">IList</span>&lt;<span style="color: #2b91af">Guid</span>&gt; serverIds = service.GetRegisteredServerIds();     <br />&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">LossCoef</span>&gt; list = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">LossCoef</span>&gt;();&#160;&#160;&#160;&#160;&#160; <br />&#160; <span style="color: blue">foreach</span> (<span style="color: #2b91af">Guid</span> serverId <span style="color: blue">in</span> serverIds)     <br />&#160; {     <br />&#160;&#160;&#160; <span style="color: #2b91af">IExternalServer</span> server = getServerById(serverId, serviceId);     <br />&#160;&#160;&#160; <span style="color: #2b91af">IDuctFittingAndAccessoryPressureDropServer</span> ductServer =     <br />&#160;&#160;&#160;&#160;&#160; server <span style="color: blue">as</span>&#160;<span style="color: #2b91af">IDuctFittingAndAccessoryPressureDropServer</span>;     <br />    <br />&#160;&#160;&#160; <span style="color: #2b91af">LossCoef</span> lc = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">LossCoef</span>();     <br />&#160;&#160;&#160; lc.id = serverId;     <br />&#160;&#160;&#160; lc.name = ductServer.GetName();     <br />    <br />&#160;&#160;&#160; list.Add(lc);     <br />&#160; }     <br />&#160; <span style="color: blue">return</span> list;     <br />}     <br />    <br /><span style="color: blue">private</span>&#160;<span style="color: #2b91af">IExternalServer</span> getServerById(<span style="color: #2b91af">Guid</span> serverGUID,     <br />&#160; <span style="color: #2b91af">ExternalServiceId</span> serviceId)     <br />{     <br />&#160; <span style="color: green">//get the service first, and then get the server</span>     <br />&#160; <span style="color: #2b91af">MultiServerService</span> service = <span style="color: #2b91af">ExternalServiceRegistry</span>.     <br />&#160;&#160;&#160; GetService(serviceId) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">MultiServerService</span>;     <br />&#160; <span style="color: blue">if</span> (service != <span style="color: blue">null</span> &amp;&amp; serverGUID != <span style="color: blue">null</span>)     <br />&#160; {     <br />&#160;&#160;&#160; <span style="color: #2b91af">IExternalServer</span> server = service.GetServer(serverGUID);     <br />&#160;&#160;&#160; <span style="color: blue">if</span> (server != <span style="color: blue">null</span>)     <br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> server;     <br />&#160; }     <br />&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">null</span>;     <br />}</p>  <p>And here is Execute method showing how to use it. In this case will change the Loss Method by setting the parameter value (as a GUID string value).</p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black"><span style="color: blue">public</span>&#160;<span style="color: #2b91af">Result</span> Execute(<br />&#160; <span style="color: #2b91af">ExternalCommandData</span> commandData,<br />&#160; <span style="color: blue">ref</span>&#160;<span style="color: blue">string</span> message,<br />&#160; <span style="color: #2b91af">ElementSet</span> elements)<br />{<br />&#160; <span style="color: #2b91af">UIApplication</span> uiapp = commandData.Application;<br />&#160; <span style="color: #2b91af">UIDocument</span> uidoc = uiapp.ActiveUIDocument;<br />&#160; <span style="color: #2b91af">Application</span> app = uiapp.Application;<br />&#160; <span style="color: #2b91af">Document</span> doc = uidoc.Document;<br /> <br />&#160; <span style="color: blue">foreach</span> (<span style="color: #2b91af">ElementId</span> eleId <span style="color: blue">in</span> uidoc.Selection.GetElementIds())<br />&#160; {<br />&#160;&#160;&#160; <span style="color: #2b91af">FamilyInstance</span> fitting = doc.GetElement(eleId) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">FamilyInstance</span>;<br />&#160;&#160;&#160; <span style="color: blue">if</span> (fitting == <span style="color: blue">null</span>) <span style="color: blue">continue</span>;<br />&#160;&#160;&#160; <span style="color: #2b91af">Parameter</span> param = fitting.get_Parameter(<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">BuiltInParameter</span>.RBS_DUCT_FITTING_LOSS_METHOD_SERVER_PARAM);<br />&#160;&#160;&#160; <span style="color: blue">if</span> (param == <span style="color: blue">null</span>) <span style="color: blue">continue</span>;<br /><br /> <br />&#160;&#160;&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">LossCoef</span>&gt; lc = getLossMethods(<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ExternalServices</span>.<span style="color: #2b91af">BuiltInExternalServices</span>.<br />&#160;&#160;&#160;&#160;&#160; DuctFittingAndAccessoryPressureDropService);</pre>

<pre style="font-size: 13px; font-family: consolas; background: white; color: black"><br />&#160;&#160;&#160; <span style="color: green">// the 4th item should be &quot;Specific Loss&quot;</span><br />&#160;&#160;&#160; <span style="color: green">// but you may double check</span><br />&#160;&#160;&#160; param.Set(lc[3].id.ToString()); <br />&#160; }<br /> <br />&#160; <span style="color: blue">return</span>&#160;<span style="color: #2b91af">Result</span>.Succeeded;<br />}</pre>
