---
layout: "post"
title: "Adjusting analytical model"
date: "2012-06-11 02:22:27"
author: "Katsuaki Takamizawa"
categories:
  - "Katsuaki Takamizawa"
original_url: "https://adndevblog.typepad.com/aec/2012/06/adjusting-analytical-model.html "
typepad_basename: "adjusting-analytical-model"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/katsuaki-takamizawa.html" target="_self">Katsuaki Takamizawa</a></p> <p>You can adjust analytical lines to adjust the analytical model using API. Basically, AnalyticalModel.ManuallyAdjust method can mimic Analyze tab&gt;Analytical Model Tools panel&gt;Analytical Adjust feature in UI. </p>  <p>For adjusting the anlytical model, pleae take a look at “Adjusting Columns to Beams” in Revit WikiHelp.</p>  <p>Here is the sample code for an usage of AnalyticalModel.ManuallyAdjust method.</p>  <p>   <br /><font size="1"><font color="#000000">[TransactionAttribute(</font><span><font color="#2b91af">TransactionMode</font></span></font><font size="1"><font color="#000000">.Manual)]       <br /></font><span><font color="#0000ff">public</font></span><font color="#000000">&#160;</font><span><font color="#0000ff">class</font></span><font color="#000000">&#160;</font><span><font color="#2b91af">RevitCommand</font></span><font color="#000000"> : </font><span><font color="#2b91af">IExternalCommand</font></span>      <br /></font><font size="1"><font color="#000000">{       <br />&#160; </font><span><font color="#0000ff">public</font></span><font color="#000000">&#160;</font><span><font color="#2b91af">Result</font></span></font><font size="1"><font color="#000000"> Execute(       <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#2b91af">ExternalCommandData</font></span></font><font size="1"><font color="#000000"> commandData,&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#0000ff">ref</font></span><font color="#000000">&#160;</font><span><font color="#0000ff">string</font></span></font><font size="1"><font color="#000000"> messages,&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#2b91af">ElementSet</font></span></font><font size="1"><font color="#000000"> elements)       <br />&#160; {        <br />         <br />&#160;&#160;&#160; </font><span><font color="#2b91af">UIApplication</font></span></font><font size="1"><font color="#000000"> app = commandData.Application;       <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Document</font></span></font><font size="1"><font color="#000000"> doc = app.ActiveUIDocument.Document;       <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Transaction</font></span><font color="#000000"> trans = </font><span><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span><font color="#2b91af">Transaction</font></span><font color="#000000">(doc, </font><span><font color="#a31515">&quot;TEST&quot;</font></span></font><font size="1"><font color="#000000">);       <br />&#160;&#160;&#160; trans.Start();        <br />         <br />&#160;&#160;&#160; </font><span><font color="#008000">//pick the source analytical model.</font></span>      <br /><font color="#000000">&#160;&#160;&#160; </font><span><font color="#008000">//</font></span>      <br /></font><font size="1"><font color="#000000">&#160;&#160;&#160; Selection sel = app.ActiveUIDocument.Selection;       <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Reference</font></span></font><font size="1"><font color="#000000"> refAnalytical = sel.PickObject(       <br />&#160;&#160;&#160;&#160;&#160; ObjectType.Element,&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#a31515">&quot;Please pick the source analytical line&quot;</font></span></font><font size="1"><font color="#000000">);       <br />&#160;&#160;&#160; AnalyticalModel aModel =&#160; <br />&#160;&#160;&#160;&#160;&#160; doc.GetElement(refAnalytical) </font><span><font color="#0000ff">as</font></span></font><font size="1"><font color="#000000"> AnalyticalModel;       <br />         <br />         <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Curve</font></span></font><font size="1"><font color="#000000"> aCurve = aModel.GetCurve();       <br />         <br />&#160;&#160;&#160; AnalyticalModelSelector aSelector =&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#0000ff">new</font></span></font><font size="1"><font color="#000000"> AnalyticalModelSelector(aCurve);       <br />&#160;&#160;&#160; aSelector.CurveSelector = AnalyticalCurveSelector.EndPoint;        <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Reference</font></span></font><font size="1"><font color="#000000"> refSource = aModel.GetReference(aSelector);       <br />         <br />&#160;&#160;&#160; </font><span><font color="#008000">//pick the target analytical model </font></span>      <br /><font color="#000000">&#160;&#160;&#160; </font><span><font color="#008000">//</font></span>      <br /><font color="#000000">&#160;&#160;&#160; </font><span><font color="#2b91af">Reference</font></span></font><font size="1"><font color="#000000"> refAnalytical2 = sel.PickObject(       <br />&#160;&#160;&#160;&#160;&#160; ObjectType.Element,&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#a31515">&quot;Please pick the target analytical line&quot;</font></span></font><font size="1"><font color="#000000">);       <br />&#160;&#160;&#160; AnalyticalModel aModel2 =&#160; <br />&#160;&#160;&#160;&#160;&#160; doc.GetElement(refAnalytical2) </font><span><font color="#0000ff">as</font></span></font><font size="1"><font color="#000000"> AnalyticalModel;       <br />         <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Curve</font></span></font><font size="1"><font color="#000000"> aCurve2 = aModel2.GetCurve();       <br />         <br />&#160;&#160;&#160; AnalyticalModelSelector aSelector2 =&#160; <br />&#160;&#160;&#160;&#160;&#160; </font><span><font color="#0000ff">new</font></span></font><font size="1"><font color="#000000"> AnalyticalModelSelector(aCurve2);       <br />&#160;&#160;&#160; aSelector2.CurveSelector =        <br />&#160;&#160;&#160;&#160;&#160; AnalyticalCurveSelector.StartPoint;        <br />&#160;&#160;&#160; </font><span><font color="#2b91af">Reference</font></span></font><font size="1"><font color="#000000"> refTarget = aModel2.GetReference(aSelector2);       <br />         <br />&#160;&#160;&#160; aModel.ManuallyAdjust(refSource, refTarget, </font><span><font color="#0000ff">true</font></span></font><font size="1"><font color="#000000">);       <br />         <br />         <br />&#160;&#160;&#160; trans.Commit();        <br />&#160;&#160;&#160; </font><span><font color="#0000ff">return</font></span><font color="#000000">&#160;</font><span><font color="#2b91af">Result</font></span></font><font color="#000000" size="1">.Succeeded;     <br />&#160; }      <br />}</font></p>  <p><font color="#000000" face="ＭＳ ゴシック"></font></p>  <p>As shown at the step 3 of “Adjusting Columns to Beams” in Revit WikiHelp, this code automatically adjust the analytical line. In this case, you need to know which is start and end point, and set AnalyticalCurveSelector. </p>  <p>If you use AnalyticalCurveSelector.WholeCurve for the anlytical line of the beam, the analytical line of the column is projected to the analytical line of the beam (not the end point) for the adjustment.</p>  <p>An end point of the analytical line can be moved by AnalyticalModel.SetOffset.   </p>
