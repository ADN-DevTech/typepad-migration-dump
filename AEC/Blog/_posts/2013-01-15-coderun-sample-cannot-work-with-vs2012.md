---
layout: "post"
title: "CodeRun sample cannot work with VS2012"
date: "2013-01-15 18:34:38"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2013/01/coderun-sample-cannot-work-with-vs2012.html "
typepad_basename: "coderun-sample-cannot-work-with-vs2012"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><strong>Issue</strong>    <br />I am able to run the AppInfo sample project, but not able to run the CodeRun example in the Navisworks 2013 API. What I did is open the Examples.sln solution with all the examples in <strong>VS2012</strong>. I have put the CodeRun.ADSK.dll and CodeRunLib.dll in the correct folder. I am able to open the CodeRun addin in Navisworks and get the code template, but when I click the &quot;Run&quot;, it output the following error message: </p>  <p><em><font color="#400080" size="1">System.NullReferenceException: Object reference not set to an instance of an object.       <br />Stack Trace:&#160;&#160; at CodeRunLib.BaseGenerator.Generate(CodeDomProvider codeProvider, String sourceCode, String classToCreate, String callFunction, String&amp; errors, String&amp; consoleOutput)        <br />&#160;&#160; at CodeRunLib.CodeRunCSharp.Generate(String code, String fullClassName, String mainFunction, String&amp; errors, String&amp; consoleOutput)        <br />&#160;&#160; at CodeRun.Control.CodeRunControl.Generate(CodeRun codeRunner, String code, String fullClassName, String mainFunction, String&amp; errors, String&amp; consoleOutput)</font></em></p>  <p>If I tested on a machine with VS2010 installed only and built the sample in VS2010. It can work well.&#160; So it looks there is an issue with VS2012. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d4003c41e970c-pi"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/image_383717.jpg" width="493" height="477" /></a> </p>  <p>&#160;</p>  <p><strong>Solution</strong>    <br />VS2012 uses .NET 4.5. It appears that there’s a problem fixed around System.Reflection.Assembly.Location, in that querying this property for a dynamically generated assembly should throw a NotSupportedException (either that or something changed that no longer silently absorbs this exception). This then gets translated to a NullReferenceException subsequently by later code.</p>  <p>The fix is to update line 60 of BaseGenerator.cs in the CodeRunLib example from:</p>  <p class="MsoNormal"><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">if</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB"> (!parameters.ReferencedAssemblies.Contains(asm.Location) &amp;&amp; asm.Location != </span><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">null</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB"> &amp;&amp; asm.Location != </span><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">string</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">.Empty)</span><span style="color: #1f497d; mso-ansi-language: en-gb" lang="EN-GB">     <p></p>   </span></p>  <p>to</p>  <p class="MsoNormal"><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">if</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB"> (!asm.IsDynamic &amp;&amp; !parameters.ReferencedAssemblies.Contains(asm.Location) &amp;&amp; asm.Location != </span><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">null</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB"> &amp;&amp; asm.Location != </span><span style="font-family: consolas; background: white; color: blue; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">string</span><span style="font-family: consolas; background: white; color: black; font-size: 9.5pt; mso-highlight: white; mso-ansi-language: en-gb; mso-fareast-language: en-gb" lang="EN-GB">.Empty)</span><span style="color: #1f497d; mso-ansi-language: en-gb" lang="EN-GB">     <p></p>   </span></p> i.e. Dynamically generated assemblies have no location &amp; can’t be added to the compiler’s reference list.
