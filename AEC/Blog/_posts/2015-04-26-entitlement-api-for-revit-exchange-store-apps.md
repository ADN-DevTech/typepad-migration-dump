---
layout: "post"
title: "Entitlement API for Revit Exchange Store Apps "
date: "2015-04-26 00:30:00"
author: "Mikako Harada"
categories:
  - ".NET"
  - "Mikako Harada"
  - "Revit"
original_url: "https://adndevblog.typepad.com/aec/2015/04/entitlement-api-for-revit-exchange-store-apps.html "
typepad_basename: "entitlement-api-for-revit-exchange-store-apps"
typepad_status: "Publish"
---

<p>Revit 2016 has added two properties to help exchange store app publishers to check if the current user has purchased the given app or not. Those two properties are:&#0160;</p>
<ul>
<li><span style="font-family: &#39;courier new&#39;, courier;">Application.IsLoggedIn</span></li>
<li><span style="font-family: &#39;courier new&#39;, courier;">Application.LoginUserId</span></li>
</ul>
<p><span style="font-family: &#39;courier new&#39;, courier;">IsLoggedIn</span> checks if the user is logged in to his/her Autodesk account from the current Revit session. <span style="font-family: &#39;courier new&#39;, courier;">LoginUserId</span> returns the user identifier of Autodesk account that the user is currently logged in.&#0160;</p>
<p>Note that the user identifier returned here is an internal presentation of the user and it has human unrecognizable form. It’s not the same as the User ID that the user actually types to the login dialog.</p>
<p>These properties are used to get the user identifier, which is in turn used in the Autodesk Exchange Store Entitlement API, a single REST call to the web service. A publisher of an the Exchange Store app &#0160;can verify if the current user has purchase their app from the store.&#0160;</p>
<p>For the Entitlement API side, Daniel Du has written <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html" target="_self" title="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html">a blog post about the Entitlement AP</a>I. Please refer to it for more detailed explanation.</p>
<p>I made a small sample to demonstrate the usage in Revit 2016 and copy it below.&#0160;You can also download the code from here:&#0160;<span class="asset  asset-generic at-xid-6a0167607c2431970b01b7c77fcf70970b img-responsive"><a href="http://adndevblog.typepad.com/files/entitlementapirevit-1.zip">Download EntitlementAPIRevit</a></span></p>
<p>In the sample code, I’m using a library called RestSharp to takes care of REST client call. If you are not familiar with the RestSharp, you may want to take a look at <a href="http://the360view.typepad.com/blog/2015/01/lab1-hello-glue-world.html" target="_self" title="http://the360view.typepad.com/blog/2015/01/lab1-hello-glue-world.html">my another blog</a>; the first part of the blog explains about how to use RestSharp in Visual Studio.&#0160;For more detail about RestSharp, please refer to <a href="http://restsharp.org/" target="_self" title="http://restsharp.org/">RestSharp.org</a>.&#0160;</p>
<div style="border: #000080 1px solid; color: #000; font-family: &#39;Courier New&#39;, Courier, Monospace; font-size: 10pt;">
<div style="background: #000080; color: #fff; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px;">Entitlement API in Revit&#0160;</div>
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System.Collections.Generic;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System.Linq;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System.Text;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System.Threading.Tasks;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> System.Net; </span><span style="background: #ffffff; color: #008000;">// for HttpStatusCode </span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit.DB;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit.UI;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit.ApplicationServices;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit.Attributes;</span><br /> <span style="background: #ffffff; color: #008000;">// Added for REST API</span><br /> <span style="background: #ffffff; color: #008000;">// We are using C# REST library called RestShap</span><br /> <span style="background: #ffffff; color: #008000;">// See http://restsharp.org/ for detail</span><br /> <span style="background: #ffffff; color: #008000;">//&#0160;&#0160;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> RestSharp;</span><br /> <span style="background: #ffffff; color: #0000ff;">using</span><span style="background: #ffffff; color: #000000;"> RestSharp.Deserializers;</span><br /> <br /> <span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> Revit 2016 has added two methods to help exchange store app publishers </span><br /> <span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> to check a store app entitlement, i.e., to check if the user has purchase or not. </span><br /> <span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> This is a minimum sample to show the usage.</span><br /> <span style="background: #ffffff; color: #808080;">///</span><br /> <span style="background: #ffffff; color: #0000ff;">namespace</span><span style="background: #ffffff; color: #000000;"> EntitlementAPIRevit</span><br /> <span style="background: #ffffff; color: #000000;">{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;[</span><span style="background: #ffffff; color: #2b91af;">Transaction</span><span style="background: #ffffff; color: #000000;">(</span><span style="background: #ffffff; color: #2b91af;">TransactionMode</span><span style="background: #ffffff; color: #000000;">.Automatic)]</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">class&#0160;</span><span style="background: #ffffff; color: #2b91af;">EntitlementAPI</span><span style="background: #ffffff; color: #000000;">: </span><span style="background: #ffffff; color: #2b91af;">IExternalCommand</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Set values specific to the environment </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">const&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> _baseApiUrl = </span><span style="background: #ffffff; color: #a31515;">@&quot;https://apps.exchange.autodesk.com/&quot;</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// This is the id of your app.</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// e.g., </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">//public const string _appId = @&quot;appstore.exchange.autodesk.com:TransTips-for-Revit:en&quot;; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">const&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> _appId = </span><span style="background: #ffffff; color: #a31515;">@&quot;&lt;the id of your app comes here&gt;&quot;</span><span style="background: #ffffff; color: #000000;">;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Command to check an entitlement </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public</span><span style="background: #ffffff; color: #000000;"> Autodesk.Revit.UI.</span><span style="background: #ffffff; color: #2b91af;">Result</span><span style="background: #ffffff; color: #000000;"> Execute(</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">ExternalCommandData</span><span style="background: #ffffff; color: #000000;"> commandData,</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">ref&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> message, </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;Autodesk.Revit.DB.</span><span style="background: #ffffff; color: #2b91af;">ElementSet</span><span style="background: #ffffff; color: #000000;"> elements)</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Get hold of the top elements </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">UIApplication</span><span style="background: #ffffff; color: #000000;"> uiApp = commandData.Application;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">Application</span><span style="background: #ffffff; color: #000000;"> rvtApp = uiApp.Application;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Check to see if the user is logged in.</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;">(!</span><span style="background: #ffffff; color: #2b91af;">Application</span><span style="background: #ffffff; color: #000000;">.IsLoggedIn) {</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">TaskDialog</span><span style="background: #ffffff; color: #000000;">.Show(</span><span style="background: #ffffff; color: #a31515;">&quot;Entitlement API&quot;</span><span style="background: #ffffff; color: #000000;">, </span><span style="background: #ffffff; color: #a31515;">&quot;Please login to Autodesk 360 first\n&quot;</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">return&#0160;</span><span style="background: #ffffff; color: #2b91af;">Result</span><span style="background: #ffffff; color: #000000;">.Failed; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Get the user id, and check entitlement </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> userId = rvtApp.LoginUserId; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> isValid = CheckEntitlement(_appId, userId);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (isValid)</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// The usert has a valid entitlement, i.e., </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// if paid app, purchase the app from the store.</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// For now, display the result</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> msg = </span><span style="background: #ffffff; color: #a31515;">&quot;userId = &quot;</span><span style="background: #ffffff; color: #000000;"> + userId</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;+ </span><span style="background: #ffffff; color: #a31515;">&quot;\nappId = &quot;</span><span style="background: #ffffff; color: #000000;"> + _appId </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;+ </span><span style="background: #ffffff; color: #a31515;">&quot;\nisValid = &quot;</span><span style="background: #ffffff; color: #000000;"> + isValid.ToString(); </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">TaskDialog</span><span style="background: #ffffff; color: #000000;">.Show(</span><span style="background: #ffffff; color: #a31515;">&quot;Entitlement API&quot;</span><span style="background: #ffffff; color: #000000;">, msg); </span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">return&#0160;</span><span style="background: #ffffff; color: #2b91af;">Result</span><span style="background: #ffffff; color: #000000;">.Succeeded; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;">========================================================</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> URL: https://apps.exchange.autodesk.com/webservices/checkentitlement</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> Method: GET</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> Parameter: </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;">&#0160;&#0160;&#0160;userid</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;">&#0160;&#0160;&#0160;appid </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;">&#0160;&#0160;&#0160;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> Sample response </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> {</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> &quot;UserId&quot;:&quot;2N5FMZW9CCED&quot;,</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> &quot;AppId&quot;:&quot;appstore.exchange.autodesk.com:autodesk360:en&quot;,</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> &quot;IsValid&quot;:false,</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> &quot;Message&quot;:&quot;Ok&quot;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> }</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #808080;">///</span><span style="background: #ffffff; color: #008000;"> ========================================================</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">private&#0160;</span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> CheckEntitlement(</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> appId, </span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> userId)</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// REST API call for the entitlement API.</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// We are using RestSharp for simplicity.</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// You may choose to use other library. </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// (1) Build request </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">var</span><span style="background: #ffffff; color: #000000;"> client = </span><span style="background: #ffffff; color: #0000ff;">new&#0160;</span><span style="background: #ffffff; color: #2b91af;">RestClient</span><span style="background: #ffffff; color: #000000;">();</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;client.BaseUrl = </span><span style="background: #ffffff; color: #0000ff;">new</span><span style="background: #ffffff; color: #000000;"> System.</span><span style="background: #ffffff; color: #2b91af;">Uri</span><span style="background: #ffffff; color: #000000;">(_baseApiUrl);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Set resource/end point</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">var</span><span style="background: #ffffff; color: #000000;"> request = </span><span style="background: #ffffff; color: #0000ff;">new&#0160;</span><span style="background: #ffffff; color: #2b91af;">RestRequest</span><span style="background: #ffffff; color: #000000;">();</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;request.Resource = </span><span style="background: #ffffff; color: #a31515;">&quot;webservices/checkentitlement&quot;</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;request.Method = </span><span style="background: #ffffff; color: #2b91af;">Method</span><span style="background: #ffffff; color: #000000;">.GET;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Add parameters </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;request.AddParameter(</span><span style="background: #ffffff; color: #a31515;">&quot;userid&quot;</span><span style="background: #ffffff; color: #000000;">, userId);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;request.AddParameter(</span><span style="background: #ffffff; color: #a31515;">&quot;appid&quot;</span><span style="background: #ffffff; color: #000000;">, appId);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// (2) Execute request and get response</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">IRestResponse</span><span style="background: #ffffff; color: #000000;"> response = client.Execute(request);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// (3) Parse the response and get the value of IsValid. </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> isValid = </span><span style="background: #ffffff; color: #0000ff;">false</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (response.StatusCode == </span><span style="background: #ffffff; color: #2b91af;">HttpStatusCode</span><span style="background: #ffffff; color: #000000;">.OK)</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">JsonDeserializer</span><span style="background: #ffffff; color: #000000;"> deserial = </span><span style="background: #ffffff; color: #0000ff;">new&#0160;</span><span style="background: #ffffff; color: #2b91af;">JsonDeserializer</span><span style="background: #ffffff; color: #000000;">();</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">EntitlementResponse</span><span style="background: #ffffff; color: #000000;"> entitlementResponse = deserial.Deserialize&lt;</span><span style="background: #ffffff; color: #2b91af;">EntitlementResponse</span><span style="background: #ffffff; color: #000000;">&gt;(response);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;isValid = entitlementResponse.IsValid;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">return</span><span style="background: #ffffff; color: #000000;"> isValid; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;[</span><span style="background: #ffffff; color: #2b91af;">Serializable</span><span style="background: #ffffff; color: #000000;">] </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">class&#0160;</span><span style="background: #ffffff; color: #2b91af;">EntitlementResponse</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> UserId { </span><span style="background: #ffffff; color: #0000ff;">get</span><span style="background: #ffffff; color: #000000;">; </span><span style="background: #ffffff; color: #0000ff;">set</span><span style="background: #ffffff; color: #000000;">; }</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> AppId { </span><span style="background: #ffffff; color: #0000ff;">get</span><span style="background: #ffffff; color: #000000;">; </span><span style="background: #ffffff; color: #0000ff;">set</span><span style="background: #ffffff; color: #000000;">; }&#0160;&#0160;&#0160;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">bool</span><span style="background: #ffffff; color: #000000;"> IsValid { </span><span style="background: #ffffff; color: #0000ff;">get</span><span style="background: #ffffff; color: #000000;">; </span><span style="background: #ffffff; color: #0000ff;">set</span><span style="background: #ffffff; color: #000000;">; }</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">public&#0160;</span><span style="background: #ffffff; color: #0000ff;">string</span><span style="background: #ffffff; color: #000000;"> Message { </span><span style="background: #ffffff; color: #0000ff;">get</span><span style="background: #ffffff; color: #000000;">; </span><span style="background: #ffffff; color: #0000ff;">set</span><span style="background: #ffffff; color: #000000;">; } </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;}</span><br /> <span style="background: #ffffff; color: #000000;">}</span></div>
</div>
<p>To run this, please modify the app id to match your app id. &#0160;&#0160;</p>
<p>Mikako</p>
