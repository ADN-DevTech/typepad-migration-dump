---
layout: "post"
title: "Snowmagguedon, QueensJS meetup, PrintManager Setup"
date: "2015-03-06 14:30:37"
author: "Jaime Rosales"
categories:
  - ".NET"
  - "Announcements"
  - "Cloud"
  - "Jaime Rosales"
  - "Revit"
  - "Revit Architecture"
  - "Revit MEP"
  - "Revit Structure"
original_url: "https://adndevblog.typepad.com/aec/2015/03/snowmagguedon-queensjs-meetup-printmanager-setup.html "
typepad_basename: "snowmagguedon-queensjs-meetup-printmanager-setup"
typepad_status: "Publish"
---

<p><a href="http://adndevblog.typepad.com/aec/jaime-rosales.html" target="_blank">By Jaime Rosales</a></p>
<p>After 3 flights cancelled because of the &quot;snowmagguedon&quot; in NYC yesterday, I was able to catch a flight earlier this morning to start my 2 weeks on the road business adventure, with the first stop being the AEC Hackathon in Chicago this weekend. Can&#39;t wait for the cool projects and mind blowing ideas that will come out this weekend.</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c75b90d6970b-pi"><img alt="IMG_7547" border="0" height="360" src="/assets/image_882166.jpg" style="display: inline; border-width: 0px;" title="IMG_7547" width="480" /></a></p>
<p>On Wednesday I gave a presentation on View and Data API, to a group of enthusiastic, web developers and JS lovers, by doing this I became part of the Alumni group of the QueensJS meetup, such a great honor to be part of this community. The presentation had a lot of very positive feedback and I can&#39;t wait to see what will come out from these great community of developers, when they start to play with it, which I know some of them already are. Some lucky attendees got their hands on some VR Dodocases and of course our I &lt;3 3D shirts which they were thrilled about it. It was such a great way to start the tech evangelism of this great new technology in the NYC boroughs, next ones will be BrooklynJS or ManhattanJS, will see where do I end up going first.</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c75b90da970b-pi"><img alt="IMG_7524" border="0" height="360" src="/assets/image_861447.jpg" style="display: inline; border-width: 0px;" title="IMG_7524" width="480" /></a></p>
<p>So lets talk about some Revit API, and what a nice case I had the chance to work on this past week, since I know many developers out there have looked for a solution like this for quite some time. Here is the breakdown of the case I mentioned.</p>
<p><strong>Question</strong>: When exporting a view to dwfx we can set some options with the DWFxExportSetting, ie:</p>
<pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro;"><span style="color: #4ec9b0;">DWFXExportOptions</span>&#0160;<span style="color: white;">options</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">new</span>&#0160;<span style="color: #4ec9b0;">DWFXExportOptions</span>()<br />{<br />&#0160; <span style="color: white;">CropBoxVisible</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">false</span>,<br />&#0160; <span style="color: white;">ExportingAreas</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">true</span>,<br />&#0160; <span style="color: white;">ExportObjectData</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">false</span>,<br />&#0160; <span style="color: white;">ImageFormat</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">DWFImageFormat</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Lossless</span>,<br />&#0160; <span style="color: white;">StopOnError</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">false</span>,<br />&#0160; <span style="color: white;">PortraitLayout</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">papersize</span><span style="color: #b4b4b4;">.</span><span style="color: white;">U</span>&#0160;<span style="color: #b4b4b4;">&lt;</span>&#0160;<span style="color: white;">papersize</span><span style="color: #b4b4b4;">.</span><span style="color: white;">V</span>,<br />&#0160; <span style="color: white;">PaperFormat</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">ExportPaperFormat</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Default</span>,<br />};</pre>
<p>However, we cannot set the paper placement and zoom options which exists in the print setup dialog. These current/in-session print settings still influence our export(!), and we cannot change them from the API. <br />This means that for instance, large sheets (for some reason larger than A0) will be cropped when exported. <br />I then tried to hack around with the print manager to change the used settings, but no real luck. Something like</p>
<pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro;"><span style="color: #4ec9b0;">PrintManager</span>&#0160;<span style="color: white;">pm</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">document</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintManager</span>;<br /><span style="color: #4ec9b0;">PrintSetup</span>&#0160;<span style="color: white;">ps</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">pm</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span>;<br /><span style="color: #4ec9b0;">PrintParameters</span>&#0160;<span style="color: white;">pp</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">ps</span><span style="color: #b4b4b4;">.</span><span style="color: white;">CurrentPrintSetting</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintParameters</span>;<br /><span style="color: white;">pp</span><span style="color: #b4b4b4;">.</span><span style="color: white;">ZoomType</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">ZoomType</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Zoom</span>;<br /><span style="color: white;">pp</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Zoom</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b5cea8;">100</span>;<br /><span style="color: white;">pp</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PaperPlacement</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">PaperPlacementType</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Center</span>;<br /><span style="color: white;">ps</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Save</span>();</pre>
<p>This will work the very first time after starting up, where I only got current settings, not subsequently with in-session settings, which I&#39;m not allowed to save. And then the settings are not modified for the exporter.. <br />Generally, it&#39;s kind of hard to see the point of the PrintSetup methods Save(), SaveAs(), Delete(), since there is no Load() etc. <br />So, how can we control these settings for our dwfx export?</p>
<p>&#0160;</p>
<p>I want to thank Phil Xia one of our Revit Engineers, for the guideline on solving such a trivial problem developers have encountered in the past.</p>
<p><strong>Answer</strong>: Thank you so much for all your patience, I got a solution from one of our Revit Engineers, where he suggest to create a new print setup and activate it. As you will notice the setup for the PaperPlacement and the ZoomType is something that will be helpful for your solution.</p>
<p>Here is a sample created for you.</p>
<pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro;"><span style="color: #569cd6;">var</span>&#0160;<span style="color: white;">doc</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">this</span><span style="color: #b4b4b4;">.</span><span style="color: white;">ActiveUIDocument</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Document</span>;<br /><span style="color: #569cd6;">var</span>&#0160;<span style="color: white;">newPsName</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #d69d85;">&quot;new_printsettings5&quot;</span>;<br /><span style="color: #569cd6;">using</span> (<span style="color: #4ec9b0;">Transaction</span>&#0160;<span style="color: white;">t</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">new</span>&#0160;<span style="color: #4ec9b0;">Transaction</span><br />&#0160;&#0160;&#0160;&#0160;&#0160; (<span style="color: white;">doc</span>, <span style="color: #d69d85;">&quot;print setting&quot;</span>))<br />{<br />&#0160; <span style="color: white;">t</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Start</span>();<br />&#0160; <span style="color: #608b4e;">// 1. create a new print settings.</span><br />&#0160; <span style="color: #569cd6;">var</span>&#0160;<span style="color: white;">printMgr</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">doc</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintManager</span>;<br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">CurrentPrintSetting</span>&#0160;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">InSession</span>;<br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">SaveAs</span>(<span style="color: white;">newPsName</span>);<br /> <br />&#0160; <span style="color: #608b4e;">// 2. get this new print settings from document filter.</span><br />&#0160; <span style="color: #4ec9b0;">FilteredElementCollector</span>&#0160;<span style="color: white;">col</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<br />&#0160;&#0160;&#0160; <span style="color: #569cd6;">new</span>&#0160;<span style="color: #4ec9b0;">FilteredElementCollector</span>(<span style="color: white;">doc</span>);<br />&#0160; <span style="color: white;">col</span><span style="color: #b4b4b4;">.</span><span style="color: white;">OfClass</span>(<span style="color: #569cd6;">typeof</span>(<span style="color: #4ec9b0;">PrintSetting</span>));<br />&#0160; <span style="color: #4ec9b0;">PrintSetting</span>&#0160;<span style="color: white;">set1</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #569cd6;">null</span>;<br />&#0160; <span style="color: #569cd6;">foreach</span> (<span style="color: #4ec9b0;">PrintSetting</span>&#0160;<span style="color: white;">ps</span>&#0160;<span style="color: #569cd6;">in</span>&#0160;<span style="color: white;">col</span><span style="color: #b4b4b4;">.</span><span style="color: white;">ToElements</span>())<br />&#0160; {<br />&#0160;&#0160;&#0160; <span style="color: #569cd6;">if</span> (<span style="color: white;">ps</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Name</span>&#0160;<span style="color: #b4b4b4;">==</span>&#0160;<span style="color: white;">newPsName</span>)<br />&#0160;&#0160;&#0160; {<br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: white;">set1</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">ps</span>;<br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #569cd6;">break</span>;<br />&#0160;&#0160;&#0160; }<br />&#0160; }<br />&#0160; <span style="color: #608b4e;">// 3. activate it.</span><br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">CurrentPrintSetting</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: white;">set1</span>;<br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Apply</span>();<br />&#0160; <span style="color: #608b4e;">// 4. modify its parameters.&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">CurrentPrintSetting</span><span style="color: #b4b4b4;">.</span><br />&#0160; <span style="color: white;">PrintParameters</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PaperPlacement</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">PaperPlacementType</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Margins</span>;<br />&#0160; <br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">CurrentPrintSetting</span><span style="color: #b4b4b4;">.</span><br />&#0160; <span style="color: white;">PrintParameters</span><span style="color: #b4b4b4;">.</span><span style="color: white;">ZoomType</span>&#0160;<span style="color: #b4b4b4;">=</span>&#0160;<span style="color: #b8d7a3;">ZoomType</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Zoom</span>;<br />&#0160; <br />&#0160; <span style="color: white;">printMgr</span><span style="color: #b4b4b4;">.</span><span style="color: white;">PrintSetup</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Save</span>();<br />&#0160; <span style="color: white;">t</span><span style="color: #b4b4b4;">.</span><span style="color: white;">Commit</span>();<br />}</pre>
<p>Please take a look at it, Let me know how it goes and also if this works for you, Cheers.</p>
<p>Thanks again for reading, until next time.</p>
