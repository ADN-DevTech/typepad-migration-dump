---
layout: "post"
title: "Do CSG operations by Nwcreate"
date: "2012-07-13 03:28:30"
author: "Xiaodong Liang"
categories:
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/07/do-csg-operations-by-nwcreate.html "
typepad_basename: "do-csg-operations-by-nwcreate"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>In Nwcreate, all geometry will be eventually created by LiNwcGeometryStream. The B-rep API is there for file loaders that need to construct complex B-reps, optionally perform Boolean CSG on them, and then facet them into triangles. You will see there is a method LiNwcGeometryStreamBRepEntity(), which is used to add a B-rep to a geometry stream.&#160; The geometry stream doesn't have any methods for performing CSG operations (do operation of sum or subtraction), only for faceting a B-rep entity. A B-rep operation will take two existing B-reps and generate a third, the result.&#160; </p>  <p>Note: the BRep functions only works in Loaders, not in the standalone Nwcreate.</p>  <p>The code below is based on the SDK sample &lt;Navisworks Install Path&gt;\api\nwcreate\examples\loader, replacing the original function geometry_cb. The code subtracts a cylinder from a box to create a new entity.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> doCSG(LcNwcGeometryStream stream)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">// Two B-rep entities, a box and a cylinder.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LtNwcBRepEntity box = LiNwcBRepCreateBox(10, 10, 10);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LtNwcBRepEntity cyl = LiNwcBRepCreateCylinder(5, 20);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Subtract the cylinder from the box to create a new entity.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; LtNwcBRepEntity diff = LiNwcBRepCreateDifference(box, cyl);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Facet the result.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LiNwcGeometryStreamBRepEntity(stream, diff);&#160;&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> LtBoolean LI_NWC_API</span></p>    <p style="margin: 0px"><span style="line-height: 140%">geometry_cb(LtNwcGeometry geometry, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LtNwcGeometryStream stream_handle, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%">* user_data)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; LcNwcGeometryStream stream(stream_handle);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; doCSG(stream);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> TRUE;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
