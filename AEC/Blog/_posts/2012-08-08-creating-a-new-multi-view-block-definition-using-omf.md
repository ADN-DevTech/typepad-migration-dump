---
layout: "post"
title: "Creating a new Multi-View Block definition using OMF"
date: "2012-08-08 19:55:24"
author: "Katsuaki Takamizawa"
categories:
  - "AutoCAD Architecture"
  - "Katsuaki Takamizawa"
  - "OMF"
original_url: "https://adndevblog.typepad.com/aec/2012/08/creating-a-new-multi-view-block-definition-using-omf.html "
typepad_basename: "creating-a-new-multi-view-block-definition-using-omf"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/katsuaki-takamizawa.html" target="_self">Katsuaki Takamizawa</a></p> <p>Issue:</p>  <p>We would like to create a new Multi-View Block definition. Our program will fill in Name and Description and will need to create &quot;General&quot;, &quot;Model&quot;, &quot;Plan 1-100&quot;, &quot;Plan 1-50&quot; and &quot;Reflected&quot; on Display Representation list box. For &quot;General&quot; and &quot;Model&quot;, they will have view block names in View Blocks list box with View Directions assigned. Just like one can do in 'Multi-View Block Definition Properties' dialog box. Please provide some sample.</p>  <p>Solution:</p>  <p>A sample code below demonstrates how to create a MultiView block definition from OMF. This sample adds a new MultiViewBlock definition named &quot;myMvBlockDefOMF&quot;. It assumes that a block definition named &quot;myBlock&quot; exists. Please make one beforehand. (Just a circle would do.) This sample adds only one AecMvBlockDispRepDef, but you can add more as you need. Same for AecMvBlockViewDefinition. Try changing the value in the code below and compare them in UI. You will see the correspondence between UI and OMF code.</p>  <p><font face="Calibri"><font color="#000000"><font style="font-size: 7.8pt"></font></font></font></p>  <p><font face="Calibri"><font color="#000000">&#160; AcDbDatabase* pDb = acdbHostApplicationServices()-&gt;workingDatabase();        <br />&#160; Acad::ErrorStatus es;&#160; <br />        <br />&#160; </font><span><font color="#008000">// hard coding the name of MvBlock definition for simplicity. </font></span>      <br /><font color="#000000">&#160; AecRmCString sMvBlockDefName=_T(</font><span><font color="#a31515">&quot;myMvBlockDefOMF&quot;</font></span></font><font face="Calibri"><font color="#000000">);&#160; <br />        <br />&#160; </font><span><font color="#008000">// get the MvBlock Def dictionary. </font></span>      <br /></font><font face="Calibri"><font color="#000000">&#160; AecDictMvBlockDef dictMvBlockDef(pDb);        <br />&#160; </font><span><font color="#0000ff">if</font></span></font><font face="Calibri"><font color="#000000">(!dictMvBlockDef.isValid()){        <br />&#160;&#160;&#160; acutPrintf(_T(</font><span><font color="#a31515">&quot;failed to get the MultiBlock definition dictionary!\n&quot;</font></span></font><font face="Calibri"><font color="#000000">));        <br />&#160;&#160;&#160; </font><span><font color="#0000ff">return</font></span></font><font face="Calibri"><font color="#000000"> ;        <br />&#160; }         <br />        <br />&#160; </font><span><font color="#008000">// add a record to the dictionary. </font></span>      <br /></font><font face="Calibri"><font color="#000000">&#160; AecDbMvBlockDef *pMvBlockDef = AecDbMvBlockDef::cast(dictMvBlockDef.newEntry());        <br />&#160; </font><span><font color="#0000ff">if</font></span></font><font face="Calibri"><font color="#000000">(pMvBlockDef == NULL) {        <br />&#160;&#160;&#160; acutPrintf(_T(</font><span><font color="#a31515">&quot;failed to create a new MvBlockDef dictionary record.\n&quot;</font></span></font><font face="Calibri"><font color="#000000">));&#160; <br />&#160;&#160;&#160; </font><span><font color="#0000ff">return</font></span></font><font face="Calibri"><font color="#000000">;        <br />&#160; }         <br />&#160; es = dictMvBlockDef.addNewRecord(sMvBlockDefName, pMvBlockDef);         <br />&#160; </font><span><font color="#0000ff">if</font></span></font><font face="Calibri"><font color="#000000">(es != Acad::eOk){        <br />&#160;&#160;&#160; acutPrintf(_T(</font><span><font color="#a31515">&quot;failed to add a new MvBlockDef \&quot;%s\&quot; \n&quot;</font></span></font><font face="Calibri"><font color="#000000">), sMvBlockDefName.c_str());        <br />&#160;&#160;&#160; </font><span><font color="#0000ff">delete</font></span></font><font face="Calibri"><font color="#000000"> pMvBlockDef;        <br />&#160;&#160;&#160; </font><span><font color="#0000ff">return</font></span></font><font face="Calibri"><font color="#000000">;        <br />&#160; }         <br />        <br />&#160; </font><span><font color="#008000">//&#160; Now, we need to fill in MvBlockDef. </font></span>      <br /><font color="#000000">&#160; </font><span><font color="#008000">//&#160; </font></span>      <br /></font><font face="Calibri"><font color="#000000">       <br />&#160; </font><span><font color="#008000">//&#160; fill in the description </font></span>      <br /><font color="#000000">&#160; pMvBlockDef-&gt;setDescription(_T(</font><span><font color="#a31515">&quot;This is MvBlock Definition added from OMF.&quot;</font></span></font><font face="Calibri"><font color="#000000">));        <br />        <br />&#160; </font><span><font color="#008000">//&#160; create a new MvBlock's DispRepDef. </font></span>      <br /><font color="#000000">&#160; </font><span><font color="#008000">//&#160; you can create more than one if you want. </font></span>      <br /><font color="#000000">&#160; AecMvBlockDispRepDef* pMvBlockDispRepDef = </font><span><font color="#0000ff">new</font></span></font><font face="Calibri"><font color="#000000"> AecMvBlockDispRepDef;        <br />        <br />&#160; </font><span><font color="#008000">//&#160; get a list of disp rep works with MvBlock. </font></span>      <br /></font><font face="Calibri"><font color="#000000">&#160; AecDispRepMgr *pDRM = AecBaseServices::service()-&gt;dispRepMgr(pDb);        <br />        <br />&#160; AcDbObjectIdArray ids;         <br />&#160; pDRM-&gt;getAllViewsFor(AecDbMvBlockRef::desc(), ids);         <br />        <br />&#160; </font><span><font color="#008000">//&#160; for the simplicity we will use the first rep only. </font></span>      <br /><font color="#000000">&#160; </font><span><font color="#0000ff">if</font></span></font><font face="Calibri"><font color="#000000">(ids.length()&gt;0) pMvBlockDispRepDef-&gt;setDisplayRep(ids[0]);&#160; <br />        <br />&#160; AecMvBlockViewDefinition *pMvBlockViewDef = </font><span><font color="#0000ff">new</font></span></font><font face="Calibri"><font color="#000000"> AecMvBlockViewDefinition;        <br />&#160; AcDbObjectId blockObjId;&#160; <br />&#160; es = Aec::getBlockTableRecordId(_T(</font><span><font color="#a31515">&quot;myBlock&quot;</font></span><font color="#000000">), pDb, blockObjId);&#160;&#160; </font><span><font color="#008000">// we assume we have it defined. </font></span>      <br /></font><font face="Calibri"><font color="#000000">       <br />&#160; pMvBlockViewDef-&gt;setBlockId(blockObjId);         <br />&#160; pMvBlockViewDef-&gt;setViewOn(Aec::ViewDirection::kViewDirTop, Adesk::kTrue);         <br />&#160; pMvBlockViewDef-&gt;setViewOn(Aec::ViewDirection::kViewDirBottom, Adesk::kTrue);         <br />        <br />&#160; es = pMvBlockDispRepDef-&gt;addViewBlock(pMvBlockViewDef);         <br />        <br />&#160; es = pMvBlockDef-&gt;addDispRepDef(pMvBlockDispRepDef);         <br />        <br />&#160; </font><span><font color="#008000">//&#160; finishing up.&#160; </font></span>      <br /></font><font face="Calibri"><font color="#000000">&#160; es = pMvBlockDef-&gt;close();        <br />        <br />&#160; </font><span><font color="#008000">// We have a new MultiBlock definition now. </font></span>      <br /><font color="#000000">&#160; acutPrintf(_T(</font><span><font color="#a31515">&quot;\nA new MultiBlock definiton \&quot;%s\&quot; is created. \n&quot;</font></span><font color="#000000">), sMvBlockDefName.c_str());</font></font></p>  <p><font face="Calibri"><font color="#000000">       <br /></font></font></p>
