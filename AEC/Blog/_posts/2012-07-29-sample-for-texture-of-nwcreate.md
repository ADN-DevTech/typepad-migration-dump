---
layout: "post"
title: "sample for texture of NwCreate"
date: "2012-07-29 19:51:59"
author: "Xiaodong Liang"
categories:
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/07/sample-for-texture-of-nwcreate.html "
typepad_basename: "sample-for-texture-of-nwcreate"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>Creating textures using NWcreate is complicated. The code below is extracted from the attached project.</p>  <p><span class="asset  asset-generic at-xid-6a0167607c2431970b017616dd24ad970c"><a href="http://adndevblog.typepad.com/files/adn_mynwcreate_texture-1.zip">Download ADN_mynwcreate_texture</a></span></p>  <p> It is a very small sample that should create a basic texture map. This is built with Navisworks 2012. To work with the sample,</p>  <p>1)&#0160; copy the project to&#0160; &lt;Navisworks Manage 2012&gt;\api\nwcreate\examples, thus the project setting does not need to modify</p>  <p>2)&#0160; switch the configuration to Win32 or X64 per your machine OS</p>  <p>3)&#0160;&#0160; The EXE will be exported to</p>  <p>&#0160;&#0160;&#0160;&#0160;&#0160; Win32:&#0160;&#0160;&#0160; &lt;Navisworks Manage 2012&gt;\api\nwcreate\release</p>  <p>&#0160;&#0160;&#0160;&#0160;&#0160; X64:&#0160;&#0160;&#0160;&#0160; &lt;Navisworks Manage 2012&gt;\api\nwcreate\release\X64</p>  <p>4)&#0160; on X64, make a copy&#0160;&#0160; of &lt;Navisworks Manage 2012&gt;\api\nwcreate\release\nwcreate_data to &lt;Navisworks Manage 2012&gt;\api\nwcreate\release\X64. These are required files, but installation missed to make a copy in release\X64.</p>  <p>5) build and run, you should get a file called &quot;test.nwc&quot; in the same directory as the source code,</p>  <p>6) load the nwc ro Navisworks you should see a material in Presenter.</p>  <p>7)&#0160; switch into full render by ViewPoint tab &gt;&gt; Render Style to see the geometry with the texture.</p>  <p>&#0160;</p>  <p>The sample code creates a basic Presenter material with a texture map that is repeated (&quot;wrapped image&quot;), and it just specifies a basic &quot;phong&quot; reflectance shader. You should be able to attach the Presenter material to a node using LiNwcNodeAddAttribute</p>  <p>Additional information:</p>  <p>- A Presenter material has 5 classes of shader. You normally have to specify at least the &quot;color&quot; shader, the other shaders are optional.</p>  <p>- Best way to understand is probably to switch your Presenter into &quot;Advanced&quot; mode (Global Options -&gt; Tools -&gt; Presenter -&gt; Profile -&gt; Advanced). Then load a file that contains some Presenter materials (I think the Ice Stadium example file does). Then double-click on a material, and you should see a tab for each type of shader (e.g. color, reflectance...).</p>  <p>- Each shader type (or class) can have one of several shaders, and each shader has different arguments. The complete list is described in the &quot;shaders.chm&quot; file that ships with the product (you should be able to find it, think it&#39;s in the COM/documentation) directory. Should be pretty straightforward to understand.</p>  <p>&#0160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">#include</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;stdafx.h&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">#include</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&lt;nwcreate/LiNwcAll.h&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">#include</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&lt;stdio.h&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">#include</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&lt;stdlib.h&gt;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">#define</span><span style="line-height: 140%"> LI_NWC_NO_PROGRESS_CALLBACKS NULL</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">#define</span><span style="line-height: 140%"> LI_NWC_NO_USER_DATA NULL</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">LcNwcPresenterMaterial* create_texture(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; LtWideString filename)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LcNwcPresenterMaterial *material = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> LcNwcPresenterMaterial;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; material-&gt;SetName(L</span><span style="line-height: 140%; color: #a31515">&quot;Texture&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Setup the colour shader.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; material-&gt;SetShader(LI_NWC_SHADER_CLASS_COLOR,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; L</span><span style="line-height: 140%; color: #a31515">&quot;wrapped image&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LcNwcPresenterData data;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; data.SetString(filename);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; material-&gt;SetShaderArg(LI_NWC_SHADER_CLASS_COLOR,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; L</span><span style="line-height: 140%; color: #a31515">&quot;file name&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; data);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Let&#39;s just got for a basic phong reflectance shader.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; material-&gt;SetShader(LI_NWC_SHADER_CLASS_REFLECTANCE,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; L</span><span style="line-height: 140%; color: #a31515">&quot;phong&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> material;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> doExport()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LtWideString wfilename&#0160; = L</span><span style="line-height: 140%; color: #a31515">&quot;test.nwc&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LtNwcScene scene;&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LtNwcGeometry geom; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LtNwcGeometryStream stream;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//create scene and geometry</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; scene = LiNwcSceneCreate();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; geom = LiNwcGeometryCreate();</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//open geometry stream, draw a triangle, close stream</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; stream = LiNwcGeometryOpenStream(geom);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryStreamBegin (stream, 0);&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryStreamTriangleVertex(stream, 1, 0, 0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryStreamTriangleVertex(stream, 2, 0, 10); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryStreamTriangleVertex(stream, 3, 10, 10);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//********texture********</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LcNwcPresenterMaterial *mat = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; create_texture(L</span><span style="line-height: 140%; color: #a31515">&quot;TestLayout.bmp&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcNodeAddAttribute(geom, *mat);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">delete</span><span style="line-height: 140%"> mat;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryStreamEnd(stream);&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryCloseStream( geom, stream);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//add the geometry to the scene and cleanup geom</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcSceneAddNode (scene, geom);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcGeometryDestroy(geom);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">//write out the NWC file</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcSceneWriteCacheEx(scene, wfilename, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wfilename, 0, 0);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcSceneDestroy(scene);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> main(</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> argc, </span><span style="line-height: 140%; color: blue">char</span><span style="line-height: 140%">* argv[])</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Initialise low-level API first. </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcApiErrorInitialise();</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Then initialise the rest of the API. </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">switch</span><span style="line-height: 140%"> (LiNwcApiInitialise())</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> LI_NWC_API_OK:</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doExport();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> LI_NWC_API_NOT_LICENSED:&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 1;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> LI_NWC_API_INTERNAL_ERROR:</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: blue">default</span><span style="line-height: 140%">:&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 1;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; } </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160; LiNwcApiTerminate();</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 0;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p> </div>
