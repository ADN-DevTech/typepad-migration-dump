---
layout: "post"
title: "Extracting the size of a pipe in AME using .NET API"
date: "2012-10-25 22:22:00"
author: "Saikat Bhattacharya"
categories:
  - ".NET"
  - "AutoCAD MEP"
  - "Saikat Bhattacharya"
original_url: "https://adndevblog.typepad.com/aec/2012/10/extracting-the-size-of-a-pipe-in-ame-using-net-api.html "
typepad_basename: "extracting-the-size-of-a-pipe-in-ame-using-net-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/saikat-bhattacharya.html">Saikat Bhattacharya</a></p>  <p>How can we extract the diameter or size of a pipe in AME using the .NET API?</p>  <p>The diameter or size of a given pipe (as seen from the AME user interface) can be calculated using two approaches. The first approach uses the profile definition from the style of a pipe and by accessing the NominalWidth property of the pipe. The second approach to extract the size information of a given pipe is to use its PartData (style). The following code illustrates both these approaches for extracting the pipe size.</p>  <p><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">CommandMethod</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;GetPipeSize&quot;</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span><span style="line-height: 11pt"><font color="#2b91af">CommandFlags</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Modal)]</font></span></font></p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">static</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">void</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> GetPipeSize()</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">Editor</font></span><span style="line-height: 11pt"><font color="#000000"> ed = </font></span><span style="line-height: 11pt"><font color="#2b91af">AcadApp</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.DocumentManager.MdiActiveDocument.Editor;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">PromptEntityOptions</font></span><span style="line-height: 11pt"><font color="#000000"> peo = </font></span><span style="line-height: 11pt"><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">PromptEntityOptions</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;\nPick a pipe&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; peo.SetRejectMessage(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\nMust select an Pipe&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; peo.AddAllowedClass(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">typeof</font></span><span style="line-height: 11pt"><font color="#000000">(Pipe), </font></span><span style="line-height: 11pt"><font color="#0000ff">false</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">PromptEntityResult</font></span><span style="line-height: 11pt"><font color="#000000"> per = </font></span><span style="line-height: 11pt"><font color="#2b91af">AcadApp</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.DocumentManager.MdiActiveDocument</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .Editor.GetEntity(peo);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000"> (per.Status != </font></span><span style="line-height: 11pt"><font color="#2b91af">PromptStatus</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.OK)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">return</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">Database</font></span><span style="line-height: 11pt"><font color="#000000"> db = </font></span><span style="line-height: 11pt"><font color="#2b91af">HostApplicationServices</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.WorkingDatabase;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">using</font></span><span style="line-height: 11pt"><font color="#000000"> (</font></span><span style="line-height: 11pt"><font color="#2b91af">Transaction</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> trans = db.TransactionManager.StartTransaction())</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Pipe pipe = trans.GetObject(per.ObjectId, </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">OpenMode</font></span><span style="line-height: 11pt"><font color="#000000">.ForRead) </font></span><span style="line-height: 11pt"><font color="#0000ff">as</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Pipe;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Approach 1 : Use the Profile Definition from pipe's style</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Autodesk.AutoCAD.DatabaseServices.</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">ObjectId</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> styleOid = pipe.StyleId;</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; PipeStyle pipeStyle = (PipeStyle)trans.GetObject(pipe.StyleId,</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">OpenMode</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ForRead);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000"> (pipeStyle != </font></span><span style="line-height: 11pt"><font color="#0000ff">null</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Autodesk.Aec.Building.DatabaseServices.</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">ProfileDefinition</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> proDef =</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (Autodesk.Aec.Building.DatabaseServices.</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">ProfileDefinition</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; trans.GetObject(pipeStyle.ProfileDefinitionId, </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">OpenMode</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ForRead);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000"> (proDef != </font></span><span style="line-height: 11pt"><font color="#0000ff">null</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\nPipe size from profile definition: &quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> +</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; proDef.NominalWidth.ToString());</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Approach 2 : Access the Part data of the pipe</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">DataRecord</font></span><span style="line-height: 11pt"><font color="#000000"> memRec = </font></span><span style="line-height: 11pt"><font color="#2b91af">PartManager</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.GetPartData(pipe);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">DataField</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> df = memRec.DataFields.FindByContext(</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#2b91af">Context</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ConnectionSizeNominalDiameter);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#a31515">&quot;\nPipe size from Part data: &quot;</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; + df.ValueDouble.ToString());</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; trans.Commit();</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></span></p> </div>
