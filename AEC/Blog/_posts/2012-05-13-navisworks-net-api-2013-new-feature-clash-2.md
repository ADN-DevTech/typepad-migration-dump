---
layout: "post"
title: "Navisworks .NET API 2013 new feature - Clash 2"
date: "2012-05-13 23:13:12"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/05/navisworks-net-api-2013-new-feature-clash-2.html "
typepad_basename: "navisworks-net-api-2013-new-feature-clash-2"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>Continue with <a href="http://adndevblog.typepad.com/aec/2012/05/navisworks-net-api-2013-new-feature-part-1.html">last post</a>, we will look further on the API of Clash Detective.&#160; </p>  <p>&#160;</p>  <p><strong>Update Clash</strong></p>  <p>To add or modify clash, we cannot manipulate the properties of the existing objects directly. We need to use the document part: <a href="file:///C:\Users\liangx\Documents\01_NW\Article\ClashTest-Net-2013\T_Autodesk_Navisworks_Api_Clash_DocumentClashTests.htm">DocumentClashTests</a>. It provides various methods to update the Clash. If there is no corresponding method to update one property such as, say,&#160; selection of a test, we need to create a copy of the existing object, modify the copied instance and update the existing object with the copied one. The code below changes the display name and SelectionA of one ClashTest, also changes the status of one ClashResult. </p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> modifyClash()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> document = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.ActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClash</span><span style="line-height: 140%"> documentClash = document.GetClash();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClashTests</span><span style="line-height: 140%"> oDCT = documentClash.TestsData;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%"> t = oDCT.Tests[0] </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (t != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//change the name of one ClashTest</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDCT.TestsEditDisplayName(t, </span><span style="line-height: 140%; color: #a31515">&quot;NewName&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; t.DisplayName);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashResult</span><span style="line-height: 140%"> rt = t.Children[0] </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashResult</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//change the status of one result to Approved</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (rt != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDCT.TestsEditResultStatus(rt, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashResultStatus</span><span style="line-height: 140%">.Approved);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//change the SelectionA of the Clash Test.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%"> oCopyt = t.CreateCopy() </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//modify SelectionA with the current selection</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oCopyt.SelectionA.Selection.CopyFrom(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; document.CurrentSelection.SelectedItems);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//modify SelectionA with the current selection </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (document.CurrentSelection.SelectedItems.Count &gt; 0)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; oCopyt.SelectionA.Selection.CopyFrom(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; document.CurrentSelection.SelectedItems);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//update the existing test</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDCT.TestsEditTestFromCopy(t, oCopyt);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span></p> </div>  <p>Similarly to modifying clash tests, we can add new clash tests by either creating a new test, or copying from an existing test, and adding it using the methods of <a href="file:///C:\Users\liangx\Documents\01_NW\Article\ClashTest-Net-2013\T_Autodesk_Navisworks_Api_Clash_DocumentClashTests.htm">DocumentClashTests</a>.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: green">//Sample: Add Clash Test</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> addClashTest()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> document = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.ActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClash</span><span style="line-height: 140%"> documentClash = document.GetClash();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClashTests</span><span style="line-height: 140%"> oDCT = documentClash.TestsData;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//create a ClashTest</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%"> oNewTest = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oNewTest.DisplayName = </span><span style="line-height: 140%; color: #a31515">&quot;myTest&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//Set SelectionA and SelectionB of the ClashTest</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%"> oSelA = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%"> oSelB = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//assume the first and second model item are not null.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ModelItemEnumerableCollection</span><span style="line-height: 140%"> oModelCollect =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; document.Models[0].RootItem.Children;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%">(oModelCollect.Count&lt;</span><span style="line-height: 140%; color: #2b91af">ModelItem</span><span style="line-height: 140%">&gt;() &gt; 1)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oSelA.Add( oModelCollect .ElementAt&lt;</span><span style="line-height: 140%; color: #2b91af">ModelItem</span><span style="line-height: 140%">&gt;(0));&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oSelB.Add( oModelCollect .ElementAt&lt;</span><span style="line-height: 140%; color: #2b91af">ModelItem</span><span style="line-height: 140%">&gt;(1));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oNewTest.SelectionA.Selection.CopyFrom(oSelA);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oNewTest.SelectionB.Selection.CopyFrom(oSelB);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//set other properties of the test â€¦-}</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; oDCT.TestsAddCopy(oNewTest);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span></p>    <p>&#160;</p> </div>  <p>The following sample illustrates how we can reorganize the Clash Results by grouping them with ClashResultGroup </p>  <p>&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt"></div>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: green">// Sample:&#160; Add Clash Result Group. Moves all 'NEW' top level results into a group named &quot;Grouped:NEW&quot;,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> addResultsGroup()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClash</span><span style="line-height: 140%"> documentClash = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.ActiveDocument.GetClash();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">DocumentClashTests</span><span style="line-height: 140%"> oDCT = documentClash.TestsData;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%"> t = oDCT.Tests[0] </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashTest</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//add new group if required</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashResultGroup</span><span style="line-height: 140%"> group;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> groupNdx = t.Children.IndexOfDisplayName(</span><span style="line-height: 140%; color: #a31515">&quot;Grouped:NEW&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (-1 == groupNdx)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashResultGroup</span><span style="line-height: 140%"> newGroup = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashResultGroup</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; newGroup.DisplayName = </span><span style="line-height: 140%; color: #a31515">&quot;Grouped:NEW&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDCT.TestsInsertCopy(t, 0, newGroup);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; group = (</span><span style="line-height: 140%; color: #2b91af">ClashResultGroup</span><span style="line-height: 140%">)t.Children[0];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; group = (</span><span style="line-height: 140%; color: #2b91af">ClashResultGroup</span><span style="line-height: 140%">)t.Children[groupNdx];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//moves all 'NEW' top level issues into the group</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> resultsCount = t.Children.Count;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">for</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> i = resultsCount - 1; i &gt;= 0; i--)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">SavedItem</span><span style="line-height: 140%"> issue = (</span><span style="line-height: 140%; color: #2b91af">SavedItem</span><span style="line-height: 140%">)t.Children[i];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ClashResult</span><span style="line-height: 140%"> rt = issue </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ClashResult</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%"> != rt)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">ClashResultStatus</span><span style="line-height: 140%">.New == rt.Status)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oDCT.TestsMove(t, i, group, 0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p>The content in this article should help you get started with the Clash API. Please refer to API help document for more details. All the codes have been tested with the SDK model clashtest.nwd. </p>  <p>In the next post, we will introduce viewpoints and saved viewpoints.</p>
