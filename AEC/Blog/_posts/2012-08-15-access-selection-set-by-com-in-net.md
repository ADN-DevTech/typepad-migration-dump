---
layout: "post"
title: "Access Selection Set by COM in .NET"
date: "2012-08-15 01:58:26"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "COM"
  - "Navisworks"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/aec/2012/08/access-selection-set-by-com-in-net.html "
typepad_basename: "access-selection-set-by-com-in-net"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/aec/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><b>Issue</b></p>  <p>I wanted to manipulate Selection Set in .NET. e.g. get some Selection Sets and add them to current selection.</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>From 2012, .NET API provides the object SelectionSet. Before 2012, the related objects are exposed in COM API.&#160; </p>  <p>The code below assumes you open the SDK sample gatehouse.nwd and want to highlight the first two selection sets in first level of the Selection Sets tree.</p>  <p>1) InwOpSelectionSet: Selection Set   <br />2) InwSelectionSetFolder: folder of selection sets    <br />3) state.SelectionSetsEx lists the selection sets and folders in first level of the Selection Sets tree    <br />4) InwSelectionSetFolder. SelectionSets returns the selection sets and folders within this folder </p>  <p>&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: green">// access selection set</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> test()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpState10</span><span style="line-height: 140%"> state;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">state = ComApiBridge.</span><span style="line-height: 140%; color: #2b91af">ComApiBridge</span><span style="line-height: 140%">.State;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// model items collection to store the</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// items of selection set</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%"> modelItemCollectionIn = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ModelItemCollection</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// Selection Set Collection</span></p>    <p style="margin: 0px"><span style="line-height: 140%">ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetExColl</span><span style="line-height: 140%"> oSSExColl = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; state.SelectionSetsEx();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">for</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> i = 1; i &lt;= oSSExColl.Count; i++)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// if this is a selection set</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (oSSExColl[i] </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%"> oSet = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%">)oSSExColl[i];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; state.CurrentSelection = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oSet.selection;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelection</span><span style="line-height: 140%"> oCopySelection = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelection</span><span style="line-height: 140%">)oSet.selection.Copy();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">foreach</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">ModelItem</span><span style="line-height: 140%"> oItem </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApiBridge.</span><span style="line-height: 140%; color: #2b91af">ComApiBridge</span><span style="line-height: 140%">.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ToModelItemCollection(oSet.selection))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// store each item</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; modelItemCollectionIn.Add(oItem);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//this is just an example on gatehouse.nwd. </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// we checked two sets only </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (i &gt; 2) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (oSSExColl[i] </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%">) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//if this is folder.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%"> oSSFolder = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%">)oSSExColl[i];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// recurse the folder</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; recurseFolderSS(oSSFolder);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">//set the current selection</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// highlight the selection of the set</span></p>    <p style="margin: 0px"><span style="line-height: 140%">Autodesk.Navisworks.Api.</span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.ActiveDocument.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; CurrentSelection.CopyFrom(modelItemCollectionIn);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// recurse a selection set folder</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> recurseFolderSS(ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%"> folder)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpState10</span><span style="line-height: 140%"> state;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; state = ComApiBridge.</span><span style="line-height: 140%; color: #2b91af">ComApiBridge</span><span style="line-height: 140%">.State;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetExColl</span><span style="line-height: 140%"> oSSExColl = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; folder.SelectionSets();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">for</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> i = 1; i &lt;= oSSExColl.Count; i++)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (oSSExColl[i] </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%"> oSet =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (ComApi.</span><span style="line-height: 140%; color: #2b91af">InwOpSelectionSet</span><span style="line-height: 140%">)oSSExColl[i]; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">//you can collect the sets from the folder.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// .....</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (oSSExColl[i] </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// if this is a folder, recurse </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%"> oSSFolder = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (ComApi.</span><span style="line-height: 140%; color: #2b91af">InwSelectionSetFolder</span><span style="line-height: 140%">)oSSExColl[i];</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; recurseFolderSS(oSSFolder);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">} </span></p> </div>
