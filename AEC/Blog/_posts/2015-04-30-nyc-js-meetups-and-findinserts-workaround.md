---
layout: "post"
title: "NYC JS Meetups and FindInserts workaround"
date: "2015-04-30 18:24:19"
author: "Jaime Rosales"
categories:
  - ".NET"
  - "Events"
  - "Jaime Rosales"
  - "Jeremy Tammik"
  - "Off-topic"
  - "Revit"
  - "Revit Architecture"
  - "Revit MEP"
  - "Revit Structure"
original_url: "https://adndevblog.typepad.com/aec/2015/04/nyc-js-meetups-and-findinserts-workaround.html "
typepad_basename: "nyc-js-meetups-and-findinserts-workaround"
typepad_status: "Publish"
---

<p><a href="http://adndevblog.typepad.com/aec/jaime-rosales.html">By Jaime Rosales</a> (@<a href="https://twitter.com/AfroJme">afroJme</a>),</p>  <p>Last week we had the visit from our ADN Senior Director Jim Quanci (@<a href="https://twitter.com/jimquanci">jimquanci</a>), Tech Evangelist Shiya Lou (@<a href="https://twitter.com/ShiyaLuo">shiyalou</a>) and ADN Manager Natalia Polikarpova (@<a href="https://twitter.com/nataliapolikar1">nataliapolikar1</a>), Since we were hosting 3 meetups in the NYC area for the Web development community. We had the chance to share the View and Data API, a WebGL and three.js API that we are promoting, which allows you to add 3D content to your web application, but is not only a pretty picture, it also allows you to obtain the metadata from any 3D design model you have, and the best part about it is that it will support up to 50+ different file formats including non-Autodesk files. Don’t believe me? try it yourself <a href="https://360.autodesk.com/viewer">here</a>. </p>  <p>&#160;&#160;&#160;&#160;&#160; <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0826d13b970d-pi" target="_blank"><img title="WebGL meetup" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="WebGL meetup" src="/assets/image_225350.jpg" width="181" height="181" /></a> <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0826d143970d-pi" target="_blank"><img title="Getting the pizza ready!" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Getting the pizza ready!" src="/assets/image_50090.jpg" width="240" height="180" /></a> </p>  <p>On Tuesday the 21st, we hosted the meetup to the NYC WebGL group at Code &amp; Design Academy, where Jim Quanci and Shiya Lou, talked about our API and how attractive is to have 3D content in your web now at days. We had many knowledgeable guys in WebGL, and knowing that this is not an easy technology to master, we got great positive feedback on how the API works now, You want to check it out? head over to <a href="http://lmv.rocks">LMV rocks</a>, a URL created by our engineering team that tends to have continues changes since this is what the development team uses to show off what the viewer is capable of doing, pretty cool website. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c782c981970b-pi"><img title="AngularJS Workshop 2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="AngularJS Workshop 2" src="/assets/image_40442.jpg" width="239" height="179" /></a> <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c782c985970b-pi"><img title="AngularJS Workshop" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="AngularJS Workshop" src="/assets/image_338764.jpg" width="240" height="180" /></a> </p>  <p>On Wednesday the 22nd (Happy belated Earth Day btw) we hosted at our Autodesk Office located near Flatiron building, the AngularJS meetup group, where together with Tech Evangelist, Shiya Lou we ran a small workshop on how to get started with the View and Data API using AngularJS. If you missed it, don’t worry, you can still go over the small workshop we put together for you to try it, here is the <a href="https://github.com/Developer-Autodesk/angular-viewer">link</a> for you to try it.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0826d148970d-pi"><img title="Me Presenting to the Swabbies" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Me Presenting to the Swabbies" src="/assets/image_959065.jpg" width="240" height="180" /></a><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c782c994970b-pi"><img title="Jim Quanci, showing LMV on Iphone and Android" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Jim Quanci, showing LMV on Iphone and Android" src="/assets/image_96673.jpg" width="240" height="180" /></a> </p>  <p>After a busy week we got until Thursday, where we hosted a full house at our NYC office again, this time we had over the group of Swabbies from the #weekofcode event hosted by Code Crew. This time Jim Quanci and yours truly had the opportunity of sharing how to add 3D content to your web application. Showing how attractive this topic is, for not only developers, but for Designers and eCommerce as well. Great connections were made, new friendships with the attendees and the start of a good relationship with the attendees of the meetups to start many collaborations with the NYC web developers community definitely got a good start. </p>  <p>-------------------------------------------------------------</p>  <p>Back to Revit API. This week I had the chance to work on an interesting case of developer from Russia. He is using the FindInserts method in order to find family Instances in his Hosted Object. In his case, wants to identify the Id’s of the doors that are part of what walls. But currently he is having the difficulty that when the length of the wall is close to the size of the door, the FindInsters method (<em>which gets the ids of the instances inserted into the host object</em>) is returning the Id’s of the neighbor’s walls. </p>  <p><strong>Question</strong>: I've found strange behavior of HostObject.FindInserts method in some cases in Revit 2015 UR7. I don't know exactly, if it is a bug or just my misunderstanding of this method conception.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c782c99c970b-pi" target="_blank"><img title="Screen Shot 2015-04-28 at 11.22.17 AM" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Screen Shot 2015-04-28 at 11.22.17 AM" src="/assets/image_143694.jpg" width="484" height="255" /></a> </p>  <p>The addin command illustrate the problem, that wall.FindInserts method finds the door with id = 211299 for three different walls in Revit project.    <br /></p>  <pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro"><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Collections</span><span style="color: #b4b4b4">.</span><span style="color: white">Generic</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Text</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">Attributes</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">DB</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">UI</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Linq</span>;<br /> <br /><span style="color: #569cd6">namespace</span>&#160;<span style="color: white">FindInsertsMisunderstandingOrBugSample</span><br />{<br />&#160; [<span style="color: #4ec9b0">Transaction</span>(<span style="color: #b8d7a3">TransactionMode</span><span style="color: #b4b4b4">.</span><span style="color: white">Manual</span>)]<br />&#160; <span style="color: #569cd6">public</span>&#160;<span style="color: #569cd6">class</span>&#160;<span style="color: #4ec9b0">Command</span> : <span style="color: #b8d7a3">IExternalCommand</span><br />&#160; {<br />&#160; <span style="color: #569cd6">public</span>&#160;<span style="color: #b8d7a3">Result</span>&#160;<span style="color: white">Execute</span>(<br />&#160;&#160;&#160; <span style="color: #4ec9b0">ExternalCommandData</span>&#160;<span style="color: white">commandData</span>,<br />&#160;&#160;&#160; <span style="color: #569cd6">ref</span>&#160;<span style="color: #569cd6">string</span>&#160;<span style="color: white">message</span>,<br />&#160;&#160;&#160; <span style="color: #4ec9b0">ElementSet</span>&#160;<span style="color: white">elements</span>)<br />&#160; {<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">uiapp</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">commandData</span><span style="color: #b4b4b4">.</span><span style="color: white">Application</span>;<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">uidoc</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">uiapp</span><span style="color: #b4b4b4">.</span><span style="color: white">ActiveUIDocument</span>;<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">doc</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">uidoc</span><span style="color: #b4b4b4">.</span><span style="color: white">Document</span>;<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">collector</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">FilteredElementCollector</span>(<span style="color: white">doc</span>);<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">walls</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">collector</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b4b4b4">.</span><span style="color: white">OfClass</span>(<span style="color: #569cd6">typeof</span> (<span style="color: #4ec9b0">Wall</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b4b4b4">.</span><span style="color: white">OfType</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">Wall</span><span style="color: #b4b4b4">&gt;</span>();<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">wallsIdsByInsertIds</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">Dictionary</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span>,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b8d7a3">IList</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;&gt;</span>();<br />&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">wall</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">walls</span>)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">insId</span>&#160;<span style="color: #569cd6">in</span>&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wall</span><span style="color: #b4b4b4">.</span><span style="color: white">FindInserts</span>(<span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b8d7a3">IList</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;</span>&#160;<span style="color: white">wallsIdsList</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">if</span> (<span style="color: #b4b4b4">!</span><span style="color: white">wallsIdsByInsertIds</span><span style="color: #b4b4b4">.</span><span style="color: white">TryGetValue</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: white">insId</span>, <span style="color: #569cd6">out</span>&#160;<span style="color: white">wallsIdsList</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsList</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">List</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;</span>();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsByInsertIds</span><span style="color: #b4b4b4">.</span><span style="color: white">Add</span>(<span style="color: white">insId</span>, <span style="color: white">wallsIdsList</span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsList</span><span style="color: #b4b4b4">.</span><span style="color: white">Add</span>(<span style="color: white">wall</span><span style="color: #b4b4b4">.</span><span style="color: white">Id</span>);<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">sb</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">StringBuilder</span>();<br />&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">insert</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">wallsIdsByInsertIds</span>)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">AppendLine</span>(<span style="color: #569cd6">string</span><span style="color: #b4b4b4">.</span><span style="color: white">Format</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #d69d85">&quot;inserted element with id={0} founded in walls:&quot;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; , <span style="color: white">insert</span><span style="color: #b4b4b4">.</span><span style="color: white">Key</span>));<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">wallId</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">insert</span><span style="color: #b4b4b4">.</span><span style="color: white">Value</span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">AppendLine</span>(<span style="color: #569cd6">string</span><span style="color: #b4b4b4">.</span><span style="color: white">Format</span>(<span style="color: #d69d85">&quot; - {0}&quot;</span>, <span style="color: white">wallId</span>));<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: #4ec9b0">TaskDialog</span><span style="color: #b4b4b4">.</span><span style="color: white">Show</span>(<span style="color: #d69d85">&quot;inserts&quot;</span>, <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">ToString</span>());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; <span style="color: #569cd6">return</span>&#160;<span style="color: #b8d7a3">Result</span><span style="color: #b4b4b4">.</span><span style="color: white">Succeeded</span>;<br />&#160; }<br />&#160; }<br />}</pre>

<p>So, please let me know, if it is a bug (and if it is not represented in 2016, I can't test it in Revit 2016 right now) or a feature (please enlighten me in this case))</p>

<p><strong>Answer</strong>:Thank you for your query. I tried your project with the model you provided. I'm able to reproduce what you mentioned, but then after I tried doing a model myself, and I get back only the Id of the host object that contains the door. This raises the question, are you doing anything specific to your walls? is there some kind of openings in the walls? and that being the reason you get back the Id of the three nearby walls. Maybe you could explain a bit more how are you drawing these walls. </p>

<p>I found a couple of posts by our Revit API Evangelist - Jeremy Tammik, where he goes through the use of FindInserts, and in one part of the post, I found something that might give you a better idea on how this works. Here is the link and a reference to what I mentioned: </p>

<p>&quot;<i>works great on walls with hosted families but not with walls that had structure separated with lining walls, e.g., three walls making up one wall with the linings walls joined the structural wall.</i>&quot;</p>

<p><a href="http://thebuildingcoder.typepad.com/blog/2015/03/findinserts-retrieves-all-openings-in-all-wall-types.html">http://thebuildingcoder.typepad.com/blog/2015/03/findinserts-retrieves-all-openings-in-all-wall-types.html</a> </p>

<p>Because based on the comments in there it seems like the behavior you are getting, should be the correct one. Since this method will get the ids of openings when you provide it with a wall. Also I'm attaching the result that I got when trying your command with my model and yours next to it. </p>

<p>Also I tried your plug-in in Revit 2016, there needs to be a change in the code since it seems that .OfType() got removed from the API, but after that the functionality keeps being the same.</p>

<p>Here is how it looks now. </p>

<pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro"><span style="color: #569cd6">var</span>&#160;<span style="color: white">walls</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">collector</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b4b4b4">.</span><span style="color: white">OfClass</span>(<span style="color: #569cd6">typeof</span>(<span style="color: #4ec9b0">Wall</span>));<br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">wallsIdsByInsertIds</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">Dictionary</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span>, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b8d7a3">IList</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;&gt;</span>();<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #4ec9b0">HostObject</span>&#160;<span style="color: white">wall</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">walls</span>)</pre>

<p>Let me know what you think. </p>

<p><strong>Response</strong>:Thank you for your answer. I know Jeremy Tammik and his blog, thank you, and practically the happy combination of the <a href="http://thebuildingcoder.typepad.com/blog/2015/03/findinserts-retrieves-all-openings-in-all-wall-types.html">http://thebuildingcoder.typepad.com/blog/2015/03/findinserts-retrieves-all-openings-in-all-wall-types.html</a>&#160; blog post and some programming tasks led me to explore FindInserts method and its usage.</p>

<p>After several attempts, I've reproduced the case.First of all, you need a short wall, it length should be a little more, than door width, secondly with &quot;wall joins&quot; tool change wall joins as shown in the attached &quot;reproduced.png&quot; file 
  <br />Also, if the wall with a door length is a little more, the case is not reproduced (please, see attached &quot;notreproduced.png&quot; file).</p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0826d150970d-pi" target="_blank"><img title="reproduced" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="reproduced" src="/assets/image_597541.jpg" width="231" height="139" /></a> <a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d10c533e970c-pi" target="_blank"><img title="notreproduced" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; margin-left: 0px; display: inline; border-top-width: 0px; margin-right: 0px" border="0" alt="notreproduced" src="/assets/image_804307.jpg" width="244" height="120" /></a> </p>

<p><strong>Answer 2</strong>:&#160; After further investigation, we have found that currently your walls overlap with the door, being this a good cause on why you are getting the Id's of the host object neighbor's walls. Also when the walls are placed orthogonally, it does not happen. Also, when I modify the style of the door temporarily and put it back to its original value (such as trim width), then it does not happen.</p>

<p>I will suggest to keep using your workaround to be able to continue with you development, That for each Id, returned by wall.FindInserts method get the element and check if it’s Host.Id equals Wall.Id</p>

<p>Here is how it looks now. </p>

<pre style="font-size: 13px; font-family: consolas; background: #1e1e1e; color: gainsboro"><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Collections</span><span style="color: #b4b4b4">.</span><span style="color: white">Generic</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Text</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">Attributes</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">DB</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">Autodesk</span><span style="color: #b4b4b4">.</span><span style="color: white">Revit</span><span style="color: #b4b4b4">.</span><span style="color: white">UI</span>;<br /><span style="color: #569cd6">using</span>&#160;<span style="color: white">System</span><span style="color: #b4b4b4">.</span><span style="color: white">Linq</span>;<br /> <br /><span style="color: #569cd6">namespace</span>&#160;<span style="color: white">FindInsertsMisunderstandingOrBugSample</span><br />{<br />&#160; [<span style="color: #4ec9b0">Transaction</span>(<span style="color: #b8d7a3">TransactionMode</span><span style="color: #b4b4b4">.</span><span style="color: white">Manual</span>)]<br />&#160; <span style="color: #569cd6">public</span>&#160;<span style="color: #569cd6">class</span>&#160;<span style="color: #4ec9b0">Command</span> : <span style="color: #b8d7a3">IExternalCommand</span><br />&#160; {<br />&#160; <span style="color: #569cd6">public</span>&#160;<span style="color: #b8d7a3">Result</span>&#160;<span style="color: white">Execute</span>(<br />&#160;&#160;&#160; <span style="color: #4ec9b0">ExternalCommandData</span>&#160;<span style="color: white">commandData</span>,<br />&#160;&#160;&#160; <span style="color: #569cd6">ref</span>&#160;<span style="color: #569cd6">string</span>&#160;<span style="color: white">message</span>,<br />&#160;&#160;&#160; <span style="color: #4ec9b0">ElementSet</span>&#160;<span style="color: white">elements</span>)<br />&#160; {<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">uiapp</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">commandData</span><span style="color: #b4b4b4">.</span><span style="color: white">Application</span>;<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">uidoc</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">uiapp</span><span style="color: #b4b4b4">.</span><span style="color: white">ActiveUIDocument</span>;<br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">doc</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">uidoc</span><span style="color: #b4b4b4">.</span><span style="color: white">Document</span>;<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">collector</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">FilteredElementCollector</span>(<span style="color: white">doc</span>);<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">walls</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">collector</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b4b4b4">.</span><span style="color: white">OfClass</span>(<span style="color: #569cd6">typeof</span> (<span style="color: #4ec9b0">Wall</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b4b4b4">.</span><span style="color: white">OfType</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">Wall</span><span style="color: #b4b4b4">&gt;</span>();<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">wallsIdsByInsertIds</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">Dictionary</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span>,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b8d7a3">IList</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;&gt;</span>();<br />&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">wall</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">walls</span>)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">insId</span>&#160;<span style="color: #569cd6">in</span>&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wall</span><span style="color: #b4b4b4">.</span><span style="color: white">FindInserts</span>(<span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>, <span style="color: #569cd6">false</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #b8d7a3">IList</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;</span>&#160;<span style="color: white">wallsIdsList</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">if</span> (<span style="color: #b4b4b4">!</span><span style="color: white">wallsIdsByInsertIds</span><span style="color: #b4b4b4">.</span><span style="color: white">TryGetValue</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: white">insId</span>, <span style="color: #569cd6">out</span>&#160;<span style="color: white">wallsIdsList</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsList</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">List</span><span style="color: #b4b4b4">&lt;</span><span style="color: #4ec9b0">ElementId</span><span style="color: #b4b4b4">&gt;</span>();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsByInsertIds</span><span style="color: #b4b4b4">.</span><span style="color: white">Add</span>(<span style="color: white">insId</span>, <span style="color: white">wallsIdsList</span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #608b4e">// workaround check for Host Id</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #4ec9b0">FamilyInstance</span>&#160;<span style="color: white">fi</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: white">doc</span><span style="color: #b4b4b4">.</span><span style="color: white">GetElement</span>(<span style="color: white">insId</span>) <span style="color: #569cd6">as</span>&#160;<span style="color: #4ec9b0">FamilyInstance</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">if</span> (<span style="color: white">fi</span><span style="color: #b4b4b4">.</span><span style="color: white">Host</span><span style="color: #b4b4b4">.</span><span style="color: white">Id</span>&#160;<span style="color: #b4b4b4">==</span>&#160;<span style="color: white">wall</span><span style="color: #b4b4b4">.</span><span style="color: white">Id</span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">wallsIdsList</span><span style="color: #b4b4b4">.</span><span style="color: white">Add</span>(<span style="color: white">wall</span><span style="color: #b4b4b4">.</span><span style="color: white">Id</span>);<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: #569cd6">var</span>&#160;<span style="color: white">sb</span>&#160;<span style="color: #b4b4b4">=</span>&#160;<span style="color: #569cd6">new</span>&#160;<span style="color: #4ec9b0">StringBuilder</span>();<br />&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">insert</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">wallsIdsByInsertIds</span>)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">AppendLine</span>(<span style="color: #569cd6">string</span><span style="color: #b4b4b4">.</span><span style="color: white">Format</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #d69d85">&quot;inserted element with id={0} founded in walls:&quot;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; , <span style="color: white">insert</span><span style="color: #b4b4b4">.</span><span style="color: white">Key</span>));<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #569cd6">foreach</span> (<span style="color: #569cd6">var</span>&#160;<span style="color: white">wallId</span>&#160;<span style="color: #569cd6">in</span>&#160;<span style="color: white">insert</span><span style="color: #b4b4b4">.</span><span style="color: white">Value</span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">AppendLine</span>(<span style="color: #569cd6">string</span><span style="color: #b4b4b4">.</span><span style="color: white">Format</span>(<span style="color: #d69d85">&quot; - {0}&quot;</span>, <span style="color: white">wallId</span>));<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: #4ec9b0">TaskDialog</span><span style="color: #b4b4b4">.</span><span style="color: white">Show</span>(<span style="color: #d69d85">&quot;inserts&quot;</span>, <span style="color: white">sb</span><span style="color: #b4b4b4">.</span><span style="color: white">ToString</span>());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; <span style="color: #569cd6">return</span>&#160;<span style="color: #b8d7a3">Result</span><span style="color: #b4b4b4">.</span><span style="color: white">Succeeded</span>;<br />&#160; }<br />&#160; }<br />}<br /></pre>

<p>Thank you very much for all your patience and collaboration. </p>

<p>Thanks for reading, until next time.</p>
