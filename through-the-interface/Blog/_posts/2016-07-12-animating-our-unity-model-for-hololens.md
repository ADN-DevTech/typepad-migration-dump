---
layout: "post"
title: "Animating our Unity model for HoloLens"
date: "2016-07-12 10:42:15"
author: "Kean Walmsley"
categories:
  - "Augmented Reality"
  - "HoloLens"
  - "Robotics"
  - "Unity3D"
original_url: "https://www.keanw.com/2016/07/animating-our-unity-model-for-hololens.html "
typepad_basename: "animating-our-unity-model-for-hololens"
typepad_status: "Publish"
---

<p>Now that we have <a href="http://through-the-interface.typepad.com/through_the_interface/2016/07/displaying-your-unity-model-in-3d-using-hololens.html" target="_blank">our basic model of the ABB 6620 industrial robot inside HoloLens</a>, it’s time to make it move.</p> <p>Tom Eriksson kindly provided some basic scripts to perform rotations on the various parts in the base model. I went ahead and consolidated these into a single “Rotate” script, with parameters (the speed, axis and min/max angles of the rotation) that vary depending on the part being rotated.</p> <p>For instance, some parts can rotate freely around their main axis while others are physically constrained to move between certain angle limits. This is taken care of by the below C# script:</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: blue">using</span> UnityEngine;</p> <p style="margin: 0px"><span style="color: blue">using</span> System.Collections;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Rotate</span> : MonoBehaviour</p> <p style="margin: 0px">{</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Parameters provided by Unity that will vary per object</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">float</span> speed = 50f; <span style="color: green">// Speed of the rotation</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> Vector3 axis = Vector3.up; <span style="color: green">// Axis of rotation</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">float</span> maxRot = 170f; <span style="color: green">// Minimum angle of rotation (to contstrain movement)</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">float</span> minRot = -170f; <span style="color: green">// Maximim angle of rotation (if == min then unconstrained)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Internal variable to track overall rotation (if constrained)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">float</span> rot = 0f;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> Update()</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Calculate the rotation amount as speed x time</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// (may get reduced to a smaller amount if near the angle limits)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> locRot = speed * Time.deltaTime;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// If we're constraining movement (via min &amp; max angles)...</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (minRot != maxRot)</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Then track the overall rotation</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (locRot + rot &lt; minRot)</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Don't go below the minimum angle</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; locRot = minRot - rot;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">else</span> <span style="color: blue">if</span> (locRot + rot &gt; maxRot)</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Don't go above the maximum angle</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; locRot = maxRot - rot;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rot += locRot;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// And reverse the direction if we're at a limit</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (rot &lt;= minRot || rot &gt;= maxRot)</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; speed = -speed;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Perform the rotation itself</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transform.Rotate(axis, locRot);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>An interesting downside to using a single script, rather than having the parameters hardcoded in separate scripts, relates to deployment: the scripts exist in a separate DLL that is really quick to update (it weighs in at around 4MB versus 165MB for the whole scene). Unless I’ve missed something, making small changes – such as tweaking parameter settings – in the Unity project leads to the whole package being redeployed – essentially transferred to the HoloLens device via wifi – rather than just the script DLL. But it’s more elegant/maintainable to have a single script, so I’m choosing to put up with this minor inconvenience.</p> <p>Once assigned to each of the parts to be rotated, the script needs the various parameters assigned. Here are the various sets of parameters for the robot model:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c87a6c50970b-pi" target="_blank"><img title="Unity script assignments on HoloLens robot" style="float: none; margin: 30px auto; display: block" alt="Unity script assignments on HoloLens robot" src="/assets/image_544016.jpg" width="500" height="404"></a></p> <p>As each of the parts has a different duration for their rotation – they’re of different sizes and have different angle limits &amp; rotation speeds – the result is quite interesting. Basically it looks as if the robot is moving in a random “dance”.</p> <p>&nbsp;</p> <p><iframe height="281" src="https://www.youtube-nocookie.com/embed/vv38JjAXfXk?rel=0&amp;showinfo=0" frameborder="0" width="500" allowfullscreen></iframe></p> <p>&nbsp;</p> <p>If I can work out how to have external audio influence the timing/duration of the rotations, we’ll really have a dancing robot. That would be awesome. :-)</p>
