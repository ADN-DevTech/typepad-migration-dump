---
layout: "post"
title: "Creating a 3D viewer for our Apollonian service using iOS &ndash; Part 2"
date: "2012-05-09 14:09:02"
author: "Kean Walmsley"
categories:
  - "iOS"
  - "JSON"
  - "Mobile"
  - "REST"
  - "SaaS"
original_url: "https://www.keanw.com/2012/05/creating-a-3d-viewer-for-our-apollonian-service-using-ios-part-2.html "
typepad_basename: "creating-a-3d-viewer-for-our-apollonian-service-using-ios-part-2"
typepad_status: "Publish"
---

<p>In <a href="http://through-the-interface.typepad.com/through_the_interface/2012/05/creating-a-3d-viewer-for-our-apollonian-service-using-ios-part-1.html" target="_blank">the last post</a>, we saw some code to implement a simple 3D viewer of data coming from <a href="http://apollonian.cloudapp.net" target="_blank">our Apollonian web-service</a> on iOS. In this post, we’ll add support for touch gestures, as well as a simple message box announcing when the web-service is unavailable.</p>  <p>When compared with Android, iOS provides much higher-level gesture information via <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIKit_Framework/_index.html" target="_blank">its UIKit framework</a>: you basically get callbacks to indicate when the screen has been tapped or swiped, or when pinch or rotate gestures have been performed. This is all very helpful, in the sense that you don’t have to do so much low-level running around in your code – and risk that different apps respond to touch in a different way – but it does come at the expense of flexibility. For instance, if you want to support swipe gestures, you can really only do so in the four main directions (up, down, left, right) and <a href="http://stackoverflow.com/questions/3319209/setting-direction-for-uiswipegesturerecognizer" target="_blank">you need a separate recognizer object for at least vertical and horizontal directions, and quite possibly all four</a>.</p>  <p>In the Android version of this app, we had to decide how swipe gestures would be implemented at a fairly low level, but the upside was that we could calculate a more precise direction and use that to adjust the spin of our model. Now I’m sure that it’s possible with iOS to hook into events at a lower level, to essentially do the same as with Android, but there are a couple of reasons I’ve decided not to. The first is that I don’t really need feature parity between the two viewers – as this is mostly research-related – but more importantly I have doubts that I’ll have the same ability to rotate our model in an arbitrary direction, as Dennis Ippel kindly enabled for us in his Rajawali framework (I haven’t seen the same capabilities, necessarily, in iSGL3D, and have less hope of getting them implemented). I’d ideally like to specify a rotation around an axis that’s perpendicular to the swipe direction – perhaps using a quaternion – and then apply that additively to the model.</p>  <p>Again, it’s probably something that I could implement myself, given enough time and effort, but I’ve decided to keep things simple. The addition of the rotate gesture – even if it gets reset when the model starts to spin – seems a reasonable complement to the existing behaviour of spinning in one of four directions, at least.</p>  <p>Before we look at the updated code, here’s a quick video of the application in action on the iOS Simulator:</p> <object id="scPlayer" width="470" height="366" type="application/x-shockwave-flash"
    data="http://through-the-interface.typepad.com/presentations/jingswfplayer.swf">     <param name="movie" value="http://through-the-interface.typepad.com/presentations/jingswfplayer.swf" />     <param name="quality" value="high" />     <param name="bgcolor" value="#FFFFFF" />     <param name="flashVars" value="thumb=http://through-the-interface.typepad.com/presentations/ApollonianFirstFrame.jpg&amp;containerwidth=470&amp;containerheight=366&amp;content=http://through-the-interface.typepad.com/presentations/Apollonian%20Viewer%20on%20iOS.swf&amp;blurover=false" />     <param name="allowFullScreen" value="true" />     <param name="scale" value="showall" />     <param name="allowScriptAccess" value="always" />     <param name="base" value="http://through-the-interface.typepad.com/presentations/" />     Unable to display content. Adobe Flash is required. </object>  <p>And with that, on to the code. Here’s the updated Objective-C implementation of our Apollonian Viewer. As you’ll have seen in the video, I’ve gone ahead and added a splash-screen and icons to <a href="http://through-the-interface.typepad.com/files/ApollonianViewer-iOS.zip" target="_blank">the project</a>, even if we don’t have much else by way of a UI, still.</p>  <p>Here’s the updated <em>ApollonianViewer.h</em> file:</p>  <p class="p1"><span class="s1">#import </span>&quot;isgl3d.h&quot;</p>  <p class="p2"></p>  <p class="p3"><span class="s2">@interface</span> ApollonianViewer : <span class="s3">Isgl3dBasic3DView</span></p>  <p class="p3">{</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>@private</p>  <p class="p2"></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">NSMutableArray</span> * _materials;<span class="Apple-tab-span"> </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s5">Isgl3dNode</span> * _container;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s5">Isgl3dSphere</span> * _sphereMesh;</p>  <p class="p2"></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">bool</span> _preSpin;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">bool</span> _paused;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">float</span> _rotation;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">bool</span> _spinAroundY;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">int</span> _spinIncrement;</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">int</span> _initialSpinAmount;</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UITapGestureRecognizer</span> * _tapGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UISwipeGestureRecognizer</span> * _swipeLeftGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UISwipeGestureRecognizer</span> * _swipeRightGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UISwipeGestureRecognizer</span> * _swipeUpGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UISwipeGestureRecognizer</span> * _swipeDownGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UIPinchGestureRecognizer</span> *_pinchGestureRecognizer;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UIRotationGestureRecognizer</span> *_rotationGestureRecognizer;</p>  <p class="p3">}</p>  <p class="p3">-(<span class="s2">void</span>)createSphere</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s2">double</span>)radius</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>x:(<span class="s2">double</span>)x y:(<span class="s2">double</span>)y z:(<span class="s2">double</span>)z</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>level:(<span class="s2">int</span>)level;</p>  <p class="p6">@end</p>  <p class="p2"></p>  <p class="p8"><span class="s2">@interface</span><span class="s4"> </span><span class="s3">ApollonianViewer</span><span class="s4"> () &lt;</span>UIGestureRecognizerDelegate<span class="s4">&gt;</span></p>  <p class="p3">- (<span class="s2">void</span>)tapGesture:(<span class="s3">UITapGestureRecognizer</span> *)gestureRecognizer;</p>  <p class="p3">- (<span class="s2">void</span>)swipeGesture:(<span class="s3">UISwipeGestureRecognizer</span> *)gestureRecognizer;</p>  <p class="p3">- (<span class="s2">void</span>)pinchGesture:(<span class="s3">UIPinchGestureRecognizer</span> *)gestureRecognizer;</p>  <p class="p3">- (<span class="s2">void</span>)rotationGesture:(<span class="s3">UIRotationGestureRecognizer</span> *)gestureRecognizer;</p>  <p class="p6">@end</p>  <p>And here’s the updated <em>ApollonianViewer.m</em> file:</p>  <p class="p1"><span class="s1">#import </span>&quot;ApollonianViewer.h&quot;</p>  <p class="p2"></p>  <p class="p3"><span class="s2">@implementation</span> ApollonianViewer</p>  <p class="p2"></p>  <p class="p4">// Our data member for the received data</p>  <p class="p2"></p>  <p class="p3"><span class="s3">NSMutableData</span> * _receivedData = <span class="s2">NULL</span>;</p>  <p class="p2"></p>  <p class="p4">// A response has been received from our web-service call</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)connection:(<span class="s3">NSURLConnection</span> *)connection</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>didReceiveResponse:(<span class="s3">NSURLResponse</span> *)response</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Initialise our member variable receiving data</p>  <p class="p2"></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span></span><span class="s2">if</span><span class="s4"> (</span>_receivedData<span class="s4"> == </span><span class="s2">NULL</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s5">_receivedData</span> = [[<span class="s3">NSMutableData</span> <span class="s6">alloc</span>] <span class="s6">init</span>];</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>else</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_receivedData<span class="s4"> </span><span class="s6">setLength</span><span class="s4">:</span><span class="s7">0</span><span class="s4">];</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Data has been received from our web-service call</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)connection:(<span class="s3">NSURLConnection</span> *)connection</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>didReceiveData:(<span class="s3">NSData</span> *)data</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Append the received data to our member</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span>[</span>_receivedData<span class="s4"> </span><span class="s6">appendData</span><span class="s4">:data];</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// The web-service connection failed</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)connection:(<span class="s3">NSURLConnection</span> *)connection</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>didFailWithError:(<span class="s3">NSError</span> *)error</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Report an error in the log</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160; </span></span><span class="s6">NSLog</span><span class="s4">(</span>@&quot;Connection failed: %@&quot;<span class="s4">, [error </span><span class="s6">description</span><span class="s4">]);</span></p>  <p class="p2"></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">UIAlertView</span>* alert =</p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[[</span>UIAlertView<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s6">initWithTitle</span><span class="s4">:</span>@&quot;Apollonian Viewer&quot;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s6">message</span>:</p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>@&quot;Unable to access the web-service. &quot;</p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>&quot;Please check you have internet connectivity.&quot;</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>delegate<span class="s4">:</span><span class="s2">self</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>cancelButtonTitle<span class="s4">:</span><span class="s8">@&quot;Close&quot;</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>otherButtonTitles<span class="s4">:</span><span class="s2">nil</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>] </span>autorelease<span class="s4">];</span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>[alert <span class="s6">show</span>];</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)alertView</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s3">UIAlertView</span> *)alertView</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>clickedButtonAtIndex:(<span class="s3">NSInteger</span>)buttonIndex</p>  <p class="p3">{</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> (buttonIndex == <span class="s7">0</span>) <span class="s6">exit</span> (<span class="s7">0</span>); <span class="Apple-converted-space">&#160;</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// The call to our web-service has completed</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)connectionDidFinishLoading</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>:(<span class="s3">NSURLConnection</span> *)connection</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Release the connection</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>[connection <span class="s6">release</span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Get the response string from our data member then</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// release it</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">NSString</span> * responseString =</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[<span class="s3">NSString</span> <span class="s6">alloc</span>]</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s6">initWithData</span><span class="s4">:</span>_receivedData</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>encoding<span class="s4">:</span>NSUTF8StringEncoding</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span>[</span>_receivedData<span class="s4"> </span><span class="s6">release</span><span class="s4">];</span></p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Extract JSON data from our response string</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">NSData</span> * jsonData =</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[responseString</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>dataUsingEncoding<span class="s4">:</span>NSUTF8StringEncoding<span class="s4">];</span></p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Extract an array from our JSON data</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">NSError</span> * e = <span class="s2">nil</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s3">NSArray</span> * jsonArray =</p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>NSJSONSerialization</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>JSONObjectWithData<span class="s4">: jsonData</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>options<span class="s4">: </span>NSJSONReadingMutableContainers</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s6">error</span>: &amp;e</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> (!jsonArray)</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s6">NSLog</span><span class="s4">(</span>@&quot;Error parsing JSON: %@&quot;<span class="s4">, e);</span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>else</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Loop through our JSON array, extracting spheres</p>  <p class="p2"></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s2">for</span> (<span class="s3">NSDictionary</span> *item <span class="s2">in</span> jsonArray)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// We'll need this data for each sphere</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">double</span> x, y, z, radius;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">int</span> level;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// We use a single NSNumber to extract the data</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s3">NSNumber</span> *num;</p>  <p class="p2"></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>num = [item <span class="s6">objectForKey</span>:<span class="s8">@&quot;X&quot;</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>x = [num <span class="s6">doubleValue</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>num = [item <span class="s6">objectForKey</span>:<span class="s8">@&quot;Y&quot;</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>y = [num <span class="s6">doubleValue</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>num = [item <span class="s6">objectForKey</span>:<span class="s8">@&quot;Z&quot;</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>z = [num <span class="s6">doubleValue</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>num = [item <span class="s6">objectForKey</span>:<span class="s8">@&quot;R&quot;</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>radius = [num <span class="s6">doubleValue</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>num = [item <span class="s6">objectForKey</span>:<span class="s8">@&quot;L&quot;</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>level = [num <span class="s6">intValue</span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// Only create spheres for those at the edge of the</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// outer sphere</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">double</span> length = <span class="s6">sqrt</span>(x*x + y*y + z*z);</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (length + radius &gt; <span class="s7">0.99f</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>[<span class="s2">self</span> <span class="s9">createSphere</span>:radius <span class="s9">x</span>:x <span class="s9">y</span>:y <span class="s9">z</span>:z <span class="s9">level</span>:level];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Remove our progress meter</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>UIActivityIndicatorView<span class="s4"> * vw =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>(</span>UIActivityIndicatorView<span class="s4"> *)</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">].</span>openGLView<span class="s4"> </span><span class="s6">viewWithTag</span><span class="s4">:</span><span class="s7">1</span><span class="s4">];</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[vw </span>removeFromSuperview<span class="s4">];</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Trigger the rotation updates</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[<span class="s2">self</span> <span class="s9">schedule</span>:<span class="s2">@selector</span>(tick:)];</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Our main scene initialization method</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">id</span>) init</p>  <p class="p3">{ <span class="Apple-converted-space">&#160;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> ((<span class="s2">self</span> = [<span class="s2">super</span> <span class="s9">init</span>]))</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s5">_preSpin</span> = <span class="s2">true</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s5">_paused</span> = <span class="s2">false</span>;</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_rotation<span class="s4"> = </span><span class="s7">0.0</span><span class="s4">;</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_initialSpinAmount<span class="s4"> = </span><span class="s7">2</span><span class="s4">;</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Create recognizers handling scene-level gestures</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Tap</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_tapGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UITapGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(tapGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_tapGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">; <span class="Apple-converted-space">&#160;&#160; </span></span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_tapGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Swipe</p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// (Add a recognizer for each of 4 directions)</p>  <p class="p2"></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeLeftGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UISwipeGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(swipeGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeLeftGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">;</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_swipeLeftGestureRecognizer</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>setDirection<span class="s4">:</span>UISwipeGestureRecognizerDirectionLeft</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>]; <span class="Apple-converted-space">&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_swipeLeftGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeRightGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UISwipeGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(swipeGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeRightGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">;</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_swipeRightGestureRecognizer</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>setDirection<span class="s4">:</span>UISwipeGestureRecognizerDirectionRight</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>]; <span class="Apple-converted-space">&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_swipeRightGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeUpGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UISwipeGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(swipeGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeUpGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">;</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_swipeUpGestureRecognizer</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>setDirection<span class="s4">:</span>UISwipeGestureRecognizerDirectionUp</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>]; <span class="Apple-converted-space">&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_swipeUpGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeDownGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UISwipeGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(swipeGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_swipeDownGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">;</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_swipeDownGestureRecognizer</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>setDirection<span class="s4">:</span>UISwipeGestureRecognizerDirectionDown</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>]; <span class="Apple-converted-space">&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_swipeDownGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Pinch</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_pinchGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UIPinchGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(pinchGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_pinchGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">; <span class="Apple-converted-space">&#160;&#160; </span></span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_pinchGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Rotate</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_rotationGestureRecognizer<span class="s4"> =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span>UIRotationGestureRecognizer<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithTarget<span class="s4">:</span><span class="s2">self</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s6">action</span>:<span class="s2">@selector</span>(rotationGesture:)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_rotationGestureRecognizer<span class="s4">.</span><span class="s3">delegate</span><span class="s4"> = </span><span class="s2">self</span><span class="s4">; <span class="Apple-converted-space">&#160;&#160; </span></span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[[</span>Isgl3dDirector<span class="s4"> </span><span class="s9">sharedInstance</span><span class="s4">]</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s9">addGestureRecognizer</span><span class="s4">:</span>_rotationGestureRecognizer</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">forNode</span>:<span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Set up our web-service call</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s3">NSURL</span> * url =</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[<span class="s3">NSURL</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>URLWithString<span class="s4">:</span></p>  <p class="p1"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>@&quot;http://apollonian.cloudapp.net/api/spheres/1/7&quot;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>NSMutableURLRequest<span class="s4"> *request =</span></p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[</span>NSMutableURLRequest</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>requestWithURL<span class="s4">:url</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>cachePolicy<span class="s4">:</span>NSURLRequestUseProtocolCachePolicy</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>timeoutInterval<span class="s4">:</span><span class="s7">60.0</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[request <span class="s6">setHTTPMethod</span>:<span class="s8">@&quot;GET&quot;</span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s3">NSURLConnection</span> * connection =</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span><span class="s3">NSURLConnection</span><span class="s4"> </span>alloc<span class="s4">]</span>initWithRequest<span class="s4">:request </span>delegate<span class="s4">:</span><span class="s2">self</span><span class="s4">];</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s2">if</span> (connection)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_receivedData</span> = [[<span class="s3">NSMutableData</span> <span class="s6">data</span>] <span class="s6">retain</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>} <span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Move the default camera to the initial position</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[<span class="s2">self</span>.<span class="s5">camera</span> <span class="s9">setPosition</span>:<span class="s1">iv3</span>(<span class="s7">0</span>, <span class="s7">0</span>, -<span class="s7">5</span>)];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Create a container for our spheres</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_container<span class="s4"> = [</span><span class="s2">self</span><span class="s4">.</span>scene<span class="s4"> </span><span class="s9">createNode</span><span class="s4">];</span></p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// We'll maintain an array of materials for our</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// levels. Define the colors for those levels</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s3">NSArray</span> * colors =</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[</span><span class="s3">NSArray</span><span class="s4"> </span>arrayWithObjects<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* white */</span> <span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;FFFFFF&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* red */</span> <span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;FF0000&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* yellow */</span><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;FFFF00&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* green */</span> <span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;00FF00&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* cyan */</span><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;00FFFF&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* blue */</span><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;0000FF&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* magenta */</span> <span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s8">@&quot;FF00FF&quot;</span>,</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>/* dark gray */<span class="s4"> <span class="Apple-converted-space">&#160; </span></span><span class="s8">@&quot;A9A9A9&quot;</span><span class="s4">,</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* gray */</span><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;808080&quot;</span>,</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>/* light gray */<span class="s4"><span class="Apple-converted-space">&#160; </span></span><span class="s8">@&quot;D3D3D3&quot;</span><span class="s4">,</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s10">/* white */</span> <span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s8">@&quot;FFFFFF&quot;</span>,</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s2">nil</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Create and populate the array of materials</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s5">_materials</span> = [[<span class="s3">NSMutableArray</span> <span class="s6">alloc</span>] <span class="s6">init</span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s2">for</span> (<span class="s2">int</span> i=<span class="s7">0</span>; i &lt; <span class="s7">12</span>; i++)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// Anything we don't have a color for will be white</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s3">NSString</span> *col =</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>(i &lt;= <span class="s7">10</span>) ? [colors <span class="s6">objectAtIndex</span>:i] : <span class="s8">@&quot;FFFFFF&quot;</span>;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// For simplicity, make the colors the same for</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// ambient, diffuse and specular lighting</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>Isgl3dColorMaterial<span class="s4"> * mat =</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>[[</span>Isgl3dColorMaterial<span class="s4"> </span><span class="s6">alloc</span><span class="s4">]</span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>initWithHexColors<span class="s4">:col</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s9">diffuse</span>:col</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s9">specular</span>:col</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s9">shininess</span>:<span class="s7">0.7</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[<span class="s5">_materials</span> <span class="s6">addObject</span>:mat];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p2"></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Create a single sphere mesh</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_sphereMesh<span class="s4"> =</span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[[</span><span class="s5">Isgl3dSphere</span><span class="s4"> </span><span class="s6">alloc</span><span class="s4">] </span>initWithGeometry<span class="s4">:</span><span class="s7">1</span><span class="s4"> </span>longs<span class="s4">:</span><span class="s7">9</span><span class="s4"> </span>lats<span class="s4">:</span><span class="s7">9</span><span class="s4">];</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Create a directional white light and add it to the scene</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s5">Isgl3dLight</span> * light =</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[</span>Isgl3dLight</p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>lightWithHexColor<span class="s4">:</span><span class="s8">@&quot;A0A0A0&quot;</span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>diffuseColor<span class="s4">:</span><span class="s8">@&quot;E9E9E9&quot;</span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>specularColor<span class="s4">:</span><span class="s8">@&quot;C0C0C0&quot;</span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>attenuation<span class="s4">:</span><span class="s7">0</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>light.</span><span class="s5">lightType</span><span class="s4"> = </span>DirectionalLight<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>light.<span class="s5">position</span> = <span class="s1">iv3</span>(<span class="s7">4</span>, <span class="s7">0</span>, <span class="s7">8</span>);</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[light <span class="s9">setDirection</span>:<span class="s7">1</span> <span class="s9">y</span>:<span class="s7">2</span> <span class="s9">z</span>:-<span class="s7">5</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[<span class="s2">self</span>.<span class="s5">scene</span> <span class="s9">addChild</span>:light];</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Set the scene ambient color</p>  <p class="p2"></p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span><span class="s2">self</span><span class="s4"> </span>setSceneAmbient<span class="s4">:</span><span class="s8">@&quot;000000&quot;</span><span class="s4">];</span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>return<span class="s4"> </span>self<span class="s4">;</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Create a single sphere at the desired position with</p>  <p class="p4">// the desired radius and level</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)createSphere</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s2">double</span>)radius</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>x:(<span class="s2">double</span>)x y:(<span class="s2">double</span>)y z:(<span class="s2">double</span>)z</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>level:(<span class="s2">int</span>)level</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Create the sphere based on our single mesh</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>Isgl3dMeshNode<span class="s4"> * sphere =</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[</span>_container</p>  <p class="p9"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>createNodeWithMesh<span class="s4">:</span><span class="s5">_sphereMesh</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s9">andMaterial</span>:[<span class="s5">_materials</span> <span class="s6">objectAtIndex</span>:level]</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>];</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Position and scale it</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>sphere.<span class="s5">position</span> = <span class="s1">iv3</span>(x, y, z);</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>[sphere <span class="s9">setScale</span>:radius];</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>) dealloc</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Make sure we release our materials and sphere mesh</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span>[</span>_materials<span class="s4"> </span><span class="s6">release</span><span class="s4">];</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span>[</span>_sphereMesh<span class="s4"> </span><span class="s6">release</span><span class="s4">];</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160; </span>[</span><span class="s2">super</span><span class="s4"> </span>dealloc<span class="s4">];</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Respond to our timer tick by rotating the model</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>) tick:(<span class="s2">float</span>)dt</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Rotate around the appropriate axis</p>  <p class="p2"></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span></span><span class="s2">if</span><span class="s4"> (!</span>_paused<span class="s4"> &amp;&amp; !</span>_preSpin<span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Reset any rotation around Z, first</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">if</span><span class="s4"> (</span><span class="s6">abs</span><span class="s4">(</span>_container<span class="s4">.</span>rotationZ<span class="s4">) &gt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>_container<span class="s4">.</span>rotationZ<span class="s4"> = </span><span class="s7">0</span><span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_rotation</span> = <span class="s7">0</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">if</span><span class="s4"> (</span>_spinAroundY<span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// If spinning around Y, reset any X rotation</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s2">if</span><span class="s4"> (</span><span class="s6">abs</span><span class="s4">(</span>_container<span class="s4">.</span>rotationX<span class="s4">) &gt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_container<span class="s4">.</span>rotationX<span class="s4"> = </span><span class="s7">0</span><span class="s4">;</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>_container<span class="s4">.</span>rotationY<span class="s4"> += </span>_spinIncrement<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span><span class="s2">else</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>// If spinning around X, reset any Y rotation</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span><span class="s2">if</span><span class="s4"> (</span><span class="s6">abs</span><span class="s4">(</span>_container<span class="s4">.</span>rotationY<span class="s4">) &gt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_container<span class="s4">.</span>rotationY<span class="s4"> = </span><span class="s7">0</span><span class="s4">;</span></p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></span>_container<span class="s4">.</span>rotationX<span class="s4"> += </span>_spinIncrement<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Method to specify combination of gesture recognizers</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">BOOL</span>)gestureRecognizer:</p>  <p class="p3">(<span class="s3">UIGestureRecognizer</span> *)gestureRecognizer</p>  <p class="p3">shouldRecognizeSimultaneouslyWithGestureRecognizer:</p>  <p class="p3">(<span class="s3">UIGestureRecognizer</span> *)otherGestureRecognizer</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// If the gesture recognizers are on different views,</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// don't allow simultaneous recognition</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> (gestureRecognizer.<span class="s3">view</span> != otherGestureRecognizer.<span class="s3">view</span>)</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>return<span class="s4"> </span>NO<span class="s4">;</span></p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Also stop combination of rotation with other gestures</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> ((gestureRecognizer == <span class="s5">_rotationGestureRecognizer</span>) ||</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>(otherGestureRecognizer == <span class="s5">_rotationGestureRecognizer</span>))</p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>return<span class="s4"> </span>NO<span class="s4">;</span></p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>return<span class="s4"> </span>YES<span class="s4">;</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Action methods for our gestures</p>  <p class="p2"></p>  <p class="p4">// Tap-pause/play</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)tapGesture</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s3">UITapGestureRecognizer</span> *)gestureRecognizer</p>  <p class="p3">{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160; </span></span>// Toggle pause (if we have already had at least one spin)</p>  <p class="p2"><span class="Apple-converted-space">&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160; </span></span><span class="s2">if</span><span class="s4"> (!</span>_preSpin<span class="s4">)</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>_paused<span class="s4"> = !</span>_paused<span class="s4">;</span></p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Swipe-spin</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)swipeGesture</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s3">UISwipeGestureRecognizer</span> *)gestureRecognizer</p>  <p class="p3">{</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">switch</span>(gestureRecognizer.<span class="s3">direction</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{ <span class="Apple-converted-space">&#160;&#160; </span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">case</span><span class="s4"> </span>UISwipeGestureRecognizerDirectionDown<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_preSpin<span class="s4"> || </span>_spinAroundY<span class="s4"> ||</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>(!</span>_spinAroundY<span class="s4"> &amp;&amp; </span>_spinIncrement<span class="s4"> &gt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Reset the axis and spin amount</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinAroundY</span> = <span class="s2">false</span>;</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_spinIncrement<span class="s4"> = -</span>_initialSpinAmount<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">else</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Speed up the rate of spin</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (<span class="s6">abs</span>(<span class="s5">_spinIncrement</span> * <span class="s7">2</span>) &lt; <span class="s7">10</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinIncrement</span> *= <span class="s7">2</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_preSpin</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_paused</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">break</span>;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">case</span><span class="s4"> </span>UISwipeGestureRecognizerDirectionUp<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_preSpin<span class="s4"> || </span>_spinAroundY<span class="s4"> ||</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>(!</span>_spinAroundY<span class="s4"> &amp;&amp; </span>_spinIncrement<span class="s4"> &lt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Reset the axis and spin amount</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinAroundY</span> = <span class="s2">false</span>;</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_spinIncrement<span class="s4"> = </span>_initialSpinAmount<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">else</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Speed up the rate of spin</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (<span class="s6">abs</span>(<span class="s5">_spinIncrement</span> * <span class="s7">2</span>) &lt; <span class="s7">10</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinIncrement</span> *= <span class="s7">2</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_preSpin</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_paused</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">break</span>;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">case</span><span class="s4"> </span>UISwipeGestureRecognizerDirectionLeft<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_preSpin<span class="s4"> || !</span>_spinAroundY<span class="s4"> ||</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>(</span>_spinAroundY<span class="s4"> &amp;&amp; </span>_spinIncrement<span class="s4"> &gt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Reset the axis and spin amount</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinAroundY</span> = <span class="s2">true</span>;</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_spinIncrement<span class="s4"> = -</span>_initialSpinAmount<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">else</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Speed up the rate of spin</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (<span class="s6">abs</span>(<span class="s5">_spinIncrement</span> * <span class="s7">2</span>) &lt; <span class="s7">10</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinIncrement</span> *= <span class="s7">2</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_preSpin</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_paused</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">break</span>;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">case</span><span class="s4"> </span>UISwipeGestureRecognizerDirectionRight<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_preSpin<span class="s4"> || !</span>_spinAroundY<span class="s4"> ||</span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>(</span>_spinAroundY<span class="s4"> &amp;&amp; </span>_spinIncrement<span class="s4"> &lt; </span><span class="s7">0</span><span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Reset the axis and spin amount</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinAroundY</span> = <span class="s2">true</span>;</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>_spinIncrement<span class="s4"> = </span>_initialSpinAmount<span class="s4">;</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">else</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span>// Speed up the rate of spin</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s2">if</span> (<span class="s6">abs</span>(<span class="s5">_spinIncrement</span> * <span class="s7">2</span>) &lt; <span class="s7">10</span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_spinIncrement</span> *= <span class="s7">2</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_preSpin</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_paused</span> = <span class="s2">false</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">break</span>;</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p6"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>default<span class="s4">:</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s2">break</span>;</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Pinch-zoom</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)pinchGesture</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>:(<span class="s3">UIPinchGestureRecognizer</span> *)gestureRecognizer</p>  <p class="p3">{</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> (</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[gestureRecognizer </span>state<span class="s4">] == </span>UIGestureRecognizerStateBegan<span class="s4"> ||</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[gestureRecognizer </span>state<span class="s4">] == </span>UIGestureRecognizerStateChanged</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Adjust the camera position based on the zoom scale</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[<span class="s2">self</span>.<span class="s5">camera</span> <span class="s9">setZ</span>:<span class="s2">self</span>.<span class="s5">camera</span>.<span class="s5">z</span> * (<span class="s7">1</span>/gestureRecognizer.<span class="s3">scale</span>)];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[gestureRecognizer <span class="s6">setScale</span>:<span class="s7">1</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p3">}</p>  <p class="p2"></p>  <p class="p4">// Rotate-rotate :-)</p>  <p class="p2"></p>  <p class="p3">- (<span class="s2">void</span>)rotationGesture</p>  <p class="p8"><span class="s4"><span class="Apple-converted-space">&#160; </span>:(</span>UIRotationGestureRecognizer<span class="s4"> *)gestureRecognizer</span></p>  <p class="p3">{</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span><span class="s2">if</span> (</p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[gestureRecognizer </span>state<span class="s4">] == </span>UIGestureRecognizerStateBegan<span class="s4"> ||</span></p>  <p class="p7"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span>[gestureRecognizer </span>state<span class="s4">] == </span>UIGestureRecognizerStateChanged</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>)</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>{</p>  <p class="p4"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span>// Adjust the rotation around Z based on the rotation amount</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160; </span></p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160; </span></span><span class="s2">if</span><span class="s4"> (</span>_paused<span class="s4"> || </span>_preSpin<span class="s4">)</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>{</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span><span class="s5">_rotation</span> += (gestureRecognizer.<span class="s3">rotation</span> * <span class="s7">180.0</span> / <span class="s1">M_PI</span>);</p>  <p class="p5"><span class="s4"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[</span>_container<span class="s4"> </span><span class="s9">setRotationZ</span><span class="s4">:</span>_rotation<span class="s4">];</span></p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span>[gestureRecognizer <span class="s6">setRotation</span>:<span class="s7">0</span>];</p>  <p class="p3"><span class="Apple-converted-space">&#160;&#160;&#160; </span>}</p>  <p class="p3"><span class="Apple-converted-space">&#160; </span>}</p>  <p class="p3">}</p>  <p class="p2"><span class="Apple-converted-space">&#160;&#160;&#160;&#160;&#160; </span></p>  <p class="p6">@end</p>  <p>I’ve managed to get into the Apple Developer Program via an Autodesk subscription, but there are some delays with me being able to test the app directly on a physical device. I’m still waiting to do so before I determine what additional UI needs to be implemented (in terms of progress bars, particularly), although I could probably go ahead and add some level-selection capability, at least. I may just move on to other things and revisit this at some point in the future – we’ll see.</p>
