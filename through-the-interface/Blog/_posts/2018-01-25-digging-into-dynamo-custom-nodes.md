---
layout: "post"
title: "Digging into Dynamo custom nodes"
date: "2018-01-25 18:32:20"
author: "Kean Walmsley"
categories:
  - "Autodesk"
  - "Autodesk Research"
  - "DesignScript"
  - "Dynamo"
  - "Generative design"
original_url: "https://www.keanw.com/2018/01/digging-into-dynamo-custom-nodes.html "
typepad_basename: "digging-into-dynamo-custom-nodes"
typepad_status: "Publish"
---

<p>As mentioned in <a href="http://through-the-interface.typepad.com/through_the_interface/2018/01/thinking-about-light.html" target="_blank">a recent post</a>, I’m currently working on a project using Dynamo Studio. It’s fun getting back into Dynamo and DesignScript: I <a href="http://through-the-interface.typepad.com/through_the_interface/2012/10/designscript-now-available-for-download-from-autodesk-labs.html" target="_blank">helped prototype the initial implementation of DesignScript inside AutoCAD</a> about a decade ago, and I love seeing how the technology has evolved in the meantime.</p><p>There are a few of us from Autodesk Research working on the project, which is also fun, but in a less literal way. Dynamo doesn’t work especially well with source control, as far as I can tell, so there’s a fair amount of manual merging of nodes into the master graph. One way to mitigate this – and to simplify the overall graph – is to use custom nodes. These are sub-graphs with inputs and outputs that can encapsulate repeated operations, hiding complexity.</p><p>To give you an idea of what we’re talking about, here’s a quick view of the overall graph we’re working on:</p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c9492093970b-pi" target="_blank"><img width="500" height="64" title="The Dynamo graph I'm currently working on" style="margin: 30px auto; border-image: none; float: none; display: block; background-image: none;" alt="The Dynamo graph I'm currently working on" src="/assets/image_603861.jpg" border="0"></a></p><p>There are some limitations when working with custom nodes, however. So far I’ve found that it’s not straightforward to debug problems with custom nodes, so it’s probably best not to use heaps of custom nodes until the logic problems have mostly been ironed out. For instance, I’m going through a highly complex graph and creating custom nodes for patterns of graphs that show up multiple times – with the intention of reducing maintenance effort – but so far I haven’t created custom nodes just to make the overall graph simpler: groups of nodes is mostly good enough for that.</p><p>Creating a custom node for a sub-graph in Dynamo Studio is very simple: you select the nodes you want to pull out, right-click the workspace and select “Create Custom Node”. Once you’ve entered a few fields of metadata – name, description and category – the new node definition will be opened in a new document tab and an instance wired into the main graph.</p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c9492097970b-pi" target="_blank"><img width="500" height="299" title="Create Custom Node" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Create Custom Node" src="/assets/image_437277.jpg" border="0"></a></p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c94920a0970b-pi" target="_blank"><img width="500" height="297" title="Custom Node Properties" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Custom Node Properties" src="/assets/image_1319.jpg" border="0"></a>If all is well the graph should execute in exactly the same way as before. I was hitting a gnarly issue, though: it would work initially, right after creating the new custom node, but in a new instance of Dynamo Studio the saved and reopened graph would fail. The outputs from the custom node would either be null or a list of nulls. As soon as I edited the custom node – even doing something simple, like changing the type annotations for one of the input parameters from var to int (or vice-versa) – the graph would suddenly start to execute properly. Until I saved and reopened, of course.</p><p>After a few days of struggling with this, <a href="https://twitter.com/colinmccrone" target="_blank">Colin McCrone</a> kindly pointed out the likely problem: he suggested the custom node might contain some DesignScript code that calls a globally defined function. On closer inspection I found he was exactly right: there was a “ListToPairs” function defined in a global code block. Once I extracted this into its own custom node – and then changed the outer custom node to call this – everything worked perfectly. If you find a newly extracted custom node is returning null and causing your graph to fail, be sure to check whether you’re hitting the same problem!</p>
