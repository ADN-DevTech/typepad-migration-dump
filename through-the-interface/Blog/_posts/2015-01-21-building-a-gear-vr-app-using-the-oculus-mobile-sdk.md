---
layout: "post"
title: "Building a Gear VR app using the Oculus Mobile SDK"
date: "2015-01-21 17:10:42"
author: "Kean Walmsley"
categories:
  - "Autodesk"
  - "PaaS"
  - "Virtual Reality"
original_url: "https://www.keanw.com/2015/01/building-a-gear-vr-app-using-the-oculus-mobile-sdk.html "
typepad_basename: "building-a-gear-vr-app-using-the-oculus-mobile-sdk"
typepad_status: "Publish"
---

<p>Today we’re following on from <a href="http://through-the-interface.typepad.com/through_the_interface/2015/01/a360-viewer-samsung-gear-vr.html" target="_blank">last week’s post introducing this project</a> where we want to convert <a href="http://autode.sk/gcbs" target="_blank">the Google Cardboard A360 samples</a> to work in a more integrated manner with the Samsung Gear VR.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d0c54c8d970c-pi" target="_blank"><img title="" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="" src="/assets/image_970204.jpg" width="394" height="263" /></a></p>  <p>The main purpose of the project is to see how we can hook up the existing, web-based samples to take advantage of the Gear VR’s hardware. We definitely don’t want to re-implement any of the visualization stack to be native; if we can use UI hardware events to control the web-based samples in a meaningful way, that’ll be just fine for this proof-of-concept.</p>  <p>It took some work but I was able to get the Oculus software running on the Note 4 inside Gear VR. I had to downgrade the software for it to work, though – and to a version that has some quirks – but it’s definitely usable. And it’s impressive: the Oculus team have done a great job implementing a nausea-free experience. You can view 360-degree videos and panoramic photos, and even watch a movie while sitting in a virtual cinema. Very neat!</p>  <p>The next step, for this project to work, was to build an Android app using the <a href="https://www.oculus.com/blog/oculus-mobile-sdk-now-available/" target="_blank">Oculus Mobile SDK</a>. As mentioned last time, until the Note 4 device I’m using runs Android Lollipop, I’m not actually going to be able to effectively load a page containing the A360 viewer – which is WebGL-based – inside a WebView control, but I could at least work on the UI plumbing in the meantime.</p>  <p>It took me about a day of work to get the initial project building properly. I had to install a <u>lot</u> of software, including…</p>  <ul>   <li>JDK – the Java SE Development Kit 8 </li>    <li>Eclipse Juno (I first tried Indigo, but that didn’t work, and it seems Android Studio isn’t yet supported) </li>    <li>ADT Plugin for Eclipse (this is no longer easy to get hold of, now that Android Studio is the supported Android development IDE) </li>    <li>Android NDK (we’re not really using native C/C++ code in our sample, but we’re basing our project in a native – rather than Unity-based – sample </li>    <li>Android 4.4.2 SDK (API 19) </li> </ul>  <p>I then had to create a basic project using the VrTemplate project: there’s a handy script to stamp out versions of this template project with your own company and app name. Again, while this has a native component to it, we’re going to avoid using C/C++ code unless we really have to.</p>  <p>There were quite a few dead-ends I followed to get to this point. Getting an .apk built ended up being quite an achievement: getting it to install and load was another one…</p>  <p>I eventually managed to get the app to launch on the Note 4 via USB debugging, but clearly relying on a USB cable to deploy the app meant it couldn’t be mounted in the Gear VR headset at the same time. I could use this approach to work out how to get input from the Bluetooth gamepad, at least, but it was only going to get me so far.</p>  <p>One important step was to <a href="https://developer.oculus.com/tools/osig" target="_blank">generate a device-specific signature file</a>, but in the end it’s <a href="https://forums.oculus.com/viewtopic.php?f=67&amp;t=18021" target="_blank">this forum thread</a> that got me to the point where I can effectively deploy and run the app inside the Gear VR headset. I needed to enable wifi debugging for adb – which allowed me to get freedom from the USB cable – but also to make some changes to the application’s manifest to make sure it had the “vr_only” flag set (the docs stated that “vr_dual” was needed for testing as a normal Android app or as a VR app, but in reality “dual” really ended up meaning “vanilla Android only”. Setting “vr_only” meant that launching the app brought it up directly inside the VR environment. Perfect!</p>  <p>Now for a look at what’s now working, and where the app needs to go…</p>  <p>I modified the main activity to include a WebView control which then gets pointed at <a href="http://safe-reef-1847.herokuapp.com/stereo-gear.html" target="_blank">an updated set of samples for Gear VR</a>. This version of the samples has some cosmetic differences: rather than having a single menu of models to pick from, this version has it duplicated, one for each eye. I’ve also adjusted the colours to make the page less visually jarring when viewed in an immersive environment.</p>  <p>Now for the main point of the post… I was able to hook up the UI events provided by the Oculus Mobile and Android SDKs – whether from the Bluetooth gamepad or from the touchpad on the side of the headset – and wire these into the HTML samples. Basically we call JavaScript functions in the WebView whenever we need to, and this controls the HTML page. </p>  <p>Here’s a quick video of the gamepad controlling the UI, as a “for instance”.</p>  <br /><iframe height="264" src="//www.youtube.com/embed/5jH6XblhubE?rel=0&amp;showinfo=0" frameborder="0" width="470" allowfullscreen="allowfullscreen"></iframe>  <br />  <br />  <p>Here’s the current state of the main Java file in the sample, showing how the WebView is created and how the Gear VR hardware is able to communicate with it.</p> <script src="https://gist.github.com/KeanW/bf640892132c0a363eff.js"></script>  <p>The next step is to enable the use of the controls once viewing a particular model: especially zoom and explode. But at this stage that’s a relatively simple problem to solve: the plumbing should now all be in place for this to happen.</p>  <p>At some point I’d like to look at changing the model-selection page away from HTML, integrating it more tightly with the Oculus menuing system (which is much easier on the eyes… having a menu that stays fixed in 3D space – at least as far as your brain is concerned – is much easier to look at than one that follows your eyes). But that would involve some duplication: right now having the models enumerated only in HTML is much simpler to update.</p> <font color="#a5a5a5">photo credit: </font><a href="https://www.flickr.com/photos/bestboyzde/15249886561/"><font color="#a5a5a5">TechStage</font></a><font color="#a5a5a5"> via </font><a href="http://photopin.com"><font color="#a5a5a5">photopin</font></a><font color="#a5a5a5"> </font><a href="http://creativecommons.org/licenses/by-nd/2.0/"><font color="#a5a5a5">cc</font></a>
