---
layout: "post"
title: "Adding a cursor badge in AutoCAD 2015 using .NET"
date: "2014-05-02 14:24:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Graphics system"
  - "Selection"
original_url: "https://www.keanw.com/2014/05/adding-a-cursor-badge-in-autocad-2015-using-net.html "
typepad_basename: "adding-a-cursor-badge-in-autocad-2015-using-net"
typepad_status: "Publish"
---

<p>I have to say that I’m having an absolute blast getting to know the new API features in AutoCAD 2015. It turns out I’d barely scratched the surface with <a href="http://through-the-interface.typepad.com/through_the_interface/2014/03/autocad-2015-for-developers.html" target="_blank">my original post about the impact for developers</a>. It’s a release <a href="http://through-the-interface.typepad.com/through_the_interface/2014/03/autocad-2015-calling-commands.html" target="_blank">that</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2014/04/supporting-autocad-2015s-dark-theme.html" target="_blank">just</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2014/04/autocad-2015s-updated-javascript-api.html" target="_blank">keeps</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2014/04/per-document-data-in-autocad-net-applications-part-3.html" target="_blank">on</a>&#0160;<a href="http://through-the-interface.typepad.com/through_the_interface/2014/04/adding-a-web-page-as-a-document-tab-in-autocad-2015-using-net.html" target="_blank">giving</a>. :-)</p>  <p>One new feature that I’ve had a lot of fun playing with is the “cursor badge” capability, something you may have seen <a href="http://architects-desktop.blogspot.ch/2014/04/autocad-2015-cursor-badges.html" target="_blank">blogged about from a user’s perspective</a>. The good news is that the ability to add your own cursor badges is provided in the public API (although I did end up using an internal – but publicly accessible – method to convert to the required image format for the badge itself).</p>  <p>Rather than loading and using a bitmap resource – and yes, I could have added my head to the AutoCAD cursor, but that would have been a bit much now that <a href="http://through-the-interface.typepad.com/through_the_interface/2014/04/adding-a-web-page-as-a-document-tab-in-autocad-2015-using-net.html" target="_blank">my blog is there inside the AutoCAD frame</a> – I decided to generate a bitmap programmatically and convert that into the format needed for a cursor badge. If you do end up loading your own bitmap resource for this and find that it’s flipped, you might also try using ConvertBitmapToAcGiImageBGRA32Ex() (instead of ConvertBitmapToAcGiImageBGRA32() that I used), to see if that helps.</p>  <p>I discovered a few useful tricks while putting this together: to draw a transparent background for your badge – and you will want to – it needs to be magenta (R=255, G=0, B=255). I think I knew this before, but then I’d gotten used to thinking about the colour needed for transparent pixels in ribbon icons – R=192, G=192, B=192 – and so had to relearn it. I also found that you need to set a cursor badge’s priority to a value such as 1 or 2 if you want your badge to be replaced by system badges (at least the window selection-related ones) or 3 if you want it to take precedence. There may be other priority values to take into consideration, but that’s what I’ve found out for now.</p>  <p>I decided to add the cursor badge in one command and remove it in another – as much to see the way things work when you start a window selection, as anything – but it would be more typical to add the badge just before starting a jig (say) and remove it immediately afterwards. You’d also probably want to add a smaller cursor badge than the one shown below, of course. :-)</p>  <p>Here’s the C# code:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.EditorInput;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.GraphicsInterface;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Internal;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Drawing;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> CursorBadges</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#0160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Commands</span></p>    <p style="margin: 0px">&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">private</span> <span style="color: #2b91af">ImageBGRA32</span> _img = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;ACB&quot;</span>)]</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">void</span> AddCursorBadge()</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (_img == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">using</span> (<span style="color: blue">var</span> bmp = <span style="color: blue">new</span> <span style="color: #2b91af">Bitmap</span>(85, 85))</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">using</span> (<span style="color: blue">var</span> g = <span style="color: #2b91af">Graphics</span>.FromImage(bmp))</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// The transparent colour used for these badges is</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Magenta, I&#39;ve found. Let&#39;s use that as a background</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// and then draw three concentric, filled circles</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// (looking a bit like the RAF logo)</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; g.Clear(<span style="color: #2b91af">Color</span>.Magenta);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; g.FillEllipse(<span style="color: #2b91af">Brushes</span>.Blue, 5, 5, 60, 60);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; g.FillEllipse(<span style="color: #2b91af">Brushes</span>.White, 15, 15, 40, 40);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; g.FillEllipse(<span style="color: #2b91af">Brushes</span>.Red, 25, 25, 20, 20);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _img = <span style="color: #2b91af">Utils</span>.ConvertBitmapToAcGiImageBGRA32(bmp);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Adding the badge with a priority of 1 means that it</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// will get replaced by selection-related badges. Changing</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// this to 3 is enough to give it precedence over these</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// (a higher number still will increase the chances</span></p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// of it staying shown)</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> cbu = <span style="color: blue">new</span> <span style="color: #2b91af">CursorBadgeUtilities</span>();</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; cbu.AddSupplementalCursorImage(_img, 1);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; }</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;RCB&quot;</span>)]</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">void</span> RemoveCursorBadge()</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; {</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> cbu = <span style="color: blue">new</span> <span style="color: #2b91af">CursorBadgeUtilities</span>();</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (cbu.HasSupplementalCursorImage() &amp;&amp; _img != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; cbu.RemoveSupplementalCursorImage(_img);</p>    <p style="margin: 0px">&#0160;&#0160;&#0160; }</p>    <p style="margin: 0px">&#0160; }</p>    <p style="margin: 0px">}</p> </div>  <p>When you run the ACB command you’ll find a badge that looks somewhat like the <a href="http://en.wikipedia.org/wiki/Royal_Air_Force" target="_blank">RAF</a>&#0160;<a href="http://en.wikipedia.org/wiki/Royal_Air_Force_roundels" target="_blank">roundel</a> added to the cursor. Selecting the drawing background will cause it to be replaced by the window selection cursor badges, and you can use the RCB command to remove it completely.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a511a93429970c-pi"><img alt="RAF cursor badge" height="366" src="/assets/image_434273.jpg" style="display: inline" title="RAF cursor badge" width="470" /></a></p>
