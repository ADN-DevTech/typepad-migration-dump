---
layout: "post"
title: "Invoking AutoCAD's MText editor programmatically using .NET"
date: "2010-06-11 05:37:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Drawing structure"
  - "Jigs"
  - "User interface"
original_url: "https://www.keanw.com/2010/06/invoking-autocads-mtext-editor-programmatically-using-net.html "
typepad_basename: "invoking-autocads-mtext-editor-programmatically-using-net"
typepad_status: "Publish"
---

<p>First we saw <a href="http://through-the-interface.typepad.com/through_the_interface/2010/06/creating-an-autocad-mtext-object-containing-different-colours-using-net.html" target="_blank">some simple code to create a pretty multi-line text object</a>, then we saw <a href="http://through-the-interface.typepad.com/through_the_interface/2010/06/allowing-interactive-dragging-of-a-selection-of-autocad-objects-using-net.html" target="_blank">some code to place it using a “drag jig”</a>, now we’re going to launch AutoCAD’s In-Place Editor (IPE) for MText once the object has been placed. To do this we’re going to make use of the InplaceTextEditor object added to the Autodesk.AutoCAD.ApplicationServices namespace in AutoCAD 2011.</p>  <p>There’s very little work needed to do this – I had concerns about whether it could work safely with a newly-created, transaction-resident object, but it seems to work very well, as far as I can tell.</p>  <p>Here’s the updated C# code with the new/modified lines in <font color="#ff0000">red</font> (you can also get <a href="http://through-the-interface.typepad.com/files/mtext-ipe.cs" target="_blank">the source file without line numbers here</a>):</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 1</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 2</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 3</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 4</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 5</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 6</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; <font color="#ff0000">7</font></span>&#0160;<span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> MTextCreationAndEditing</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 8</span>&#0160;<span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 9</span>&#0160;<span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 10</span>&#0160;<span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; <font color="#ff0000">11</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;COLTXT3&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 12</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> CreateColouredMText()</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 13</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 14</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 15</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 16</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db = doc.Database;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 17</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Editor</span><span style="line-height: 140%"> ed = doc.Editor;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 18</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 19</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Variables for our MText entity&#39;s identity</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 20</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// and location</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 21</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 22</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectId</span><span style="line-height: 140%"> mtId;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 23</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Point3d</span><span style="line-height: 140%"> mtLoc = </span><span style="line-height: 140%; color: #2b91af">Point3d</span><span style="line-height: 140%">.Origin;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 24</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 25</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> tr =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 26</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.TransactionManager.StartTransaction();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 27</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> (tr)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 28</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 29</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Create our new MText and set its properties</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 30</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 31</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">MText</span><span style="line-height: 140%"> mt = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">MText</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 32</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mt.Location = mtLoc;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 33</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mt.Contents =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 34</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;Some text in the default colour...\\P&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 35</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;{\\C1;Something red}\\P&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 36</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;{\\C2;Something yellow}\\P&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 37</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;{\\C3;And} {\\C4;something} &quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 38</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;{\\C5;multi-}{\\C6;coloured}\\P&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 39</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 40</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Open the block table, the model space and</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 41</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// add our MText</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 42</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 43</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">BlockTable</span><span style="line-height: 140%"> bt =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 44</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">BlockTable</span><span style="line-height: 140%">)tr.GetObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 45</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.BlockTableId,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 46</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForRead</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 47</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 48</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 49</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">BlockTableRecord</span><span style="line-height: 140%"> ms =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 50</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">BlockTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 51</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bt[</span><span style="line-height: 140%; color: #2b91af">BlockTableRecord</span><span style="line-height: 140%">.ModelSpace],</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 52</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForWrite</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 53</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 54</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 55</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mtId = ms.AppendEntity(mt);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 56</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(mt, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 57</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 58</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Select the last entity added (our MText)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 59</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 60</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptSelectionResult</span><span style="line-height: 140%"> psr = ed.SelectLast();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 61</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 62</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Assuming that worked, we&#39;ll drag it</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 63</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 64</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (psr.Status == </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 65</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 66</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Launch our drag jig</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 67</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 68</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptPointResult</span><span style="line-height: 140%"> ppr =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 69</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.Drag(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 70</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 71</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nSelect text location: &quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 72</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">delegate</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">Point3d</span><span style="line-height: 140%"> pt, </span><span style="line-height: 140%; color: blue">ref</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Matrix3d</span><span style="line-height: 140%"> mat)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 73</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 74</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// If no change has been made, say so</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 75</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 76</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (mtLoc == pt)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 77</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.NoChange;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 78</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 79</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 80</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Otherwise we return the displacement</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 81</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// matrix for the current position</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 82</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 83</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mat =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 84</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Matrix3d</span><span style="line-height: 140%">.Displacement(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 85</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mtLoc.GetVectorTo(pt)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 86</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 87</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 88</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.OK;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 89</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 90</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 91</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 92</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Assuming it works, transform our MText</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 93</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// appropriately</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 94</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 95</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (ppr.Status == </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 96</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 97</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Get the final translation matrix</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 98</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 99</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Matrix3d</span><span style="line-height: 140%"> mat =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 100</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Matrix3d</span><span style="line-height: 140%">.Displacement(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 101</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mtLoc.GetVectorTo(ppr.Value)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 102</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 103</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 104</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Transform our MText</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 105</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 106</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mt.TransformBy(mat);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 107</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">108</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Launch the in-place MText editor</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">109</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// with the default settings</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">110</font></span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">111</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">InplaceTextEditor</span><span style="line-height: 140%">.Invoke(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">112</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mt,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">113</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">InplaceTextEditorSettings</span><span style="line-height: 140%">()</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; <font color="#ff0000">114</font></span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 115</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 116</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Finally we commit our transaction</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 117</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 118</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 119</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 120</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 121</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 122</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 123</span>&#0160;<span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 124</span>&#0160;<span style="line-height: 140%">}</span></p> </div>   <p>When we run our new COLTXT3 command, we can see the MText IPE gets invoked once we’ve placed our object:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201348382ceb3970c-pi"><img alt="Editing our multi-coloured multi-line text" border="0" height="224" src="/assets/image_755392.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Editing our multi-coloured multi-line text" width="485" /></a> </p>  <p>We can then use it to “correct” spelling errors (such as my British use of “colour”, although for some reason the second instance, “coloured” doesn’t get a red squiggle):</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201348382ced6970c-pi"><img alt="Our corrected multi-coloured multi-line text" border="0" height="223" src="/assets/image_876400.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Our corrected multi-coloured multi-line text" width="485" /></a></p>
