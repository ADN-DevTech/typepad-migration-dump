---
layout: "post"
title: "Loading blocked and network-hosted assemblies with .NET 4"
date: "2011-07-28 10:16:03"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Inventor"
  - "Revit"
original_url: "https://www.keanw.com/2011/07/loading-blocked-and-network-hosted-assemblies-with-net-4.html "
typepad_basename: "loading-blocked-and-network-hosted-assemblies-with-net-4"
typepad_status: "Publish"
---

<p>As you’re probably mostly aware, many of our 2012 products use .NET 4 as standard. This has proven “interesting” (i.e. challenging) when it comes to loading – for example – plugin DLLs downloaded from the web, due to .NET’s updated security model.</p>  <p>Our <a href="http://labs.autodesk.com/utilities/ADN_plugins/" target="_blank">ADN Plugins of the Month</a> on <a href="http://labs.autodesk.com/" target="_blank">Autodesk Labs</a> are a prime example: most were posted prior to AutoCAD 2012 shipping, but when downloaded locally and NETLOADed into AutoCAD 2012, very often a security error gets reported:</p>  <blockquote>   <p><em>Cannot load assembly. Error details: System.IO.FileLoadException: Could not load file or assembly 'file:///C:\Program Files\Autodesk\AutoCAD 2012 – English\ADNPlugin-QRCodes.dll' or one of its dependencies. Operation is not supported. (Exception from HRESULT: 0x80131515) File name: 'file:/// C:\Program Files\Autodesk\AutoCAD 2012 – English\ADNPlugin-QRCodes.dll ' ---&gt; System.NotSupportedException: An attempt was made to load an assembly from a network location which would have caused the assembly to be sandboxed in previous versions of the .NET Framework. This release of the .NET Framework does not enable CAS policy by default, so this load may be dangerous. If this load is not intended to sandbox the assembly, please enable the loadFromRemoteSources switch. See <a href="http://go.microsoft.com/fwlink/?LinkId=155569" target="_blank">http://go.microsoft.com/fwlink/?LinkId=155569</a> for more information.</em></p> </blockquote>  <p>It also happens in our other products making use of .NET 4 (Revit, in particular).</p>  <p>This is now by far the most common problem reported regarding these plugins, in spite of efforts to <a href="http://labs.blogs.com/its_alive_in_the_lab/2011/05/unblock-net.html" target="_blank">document the problem and the solution</a>. (There’s also <a href="http://msdn.microsoft.com/en-us/library/ee890038.aspx" target="_blank">some helpful information on MSDN</a>, in case.)</p>  <p>When this problem first arose, it took a while for it to be understood (by me, at least). If you build the DLLs locally, clearly there isn’t a problem. And if *.autodesk.com happens to be in your trusted sites zone in Internet Explorer (which it is for most Autodesk employees, understandably) then the issue doesn’t happen, either. Luckily it doesn’t occur for the Exchange Store as every app is wrapped in a simple installer and so doesn’t suffer from this issue.</p>  <p>Anyway, to make life easier when working with these plugins, I make use of a little trick – modifying acad.exe.config, to add <a href="http://msdn.microsoft.com/en-us/library/dd409252.aspx" target="_blank">the loadFromRemoteSources element</a> – to stop the issue from occurring. Here’s my current acad.exe.config, which also includes the change to reduce debugger output noise <a href="http://through-the-interface.typepad.com/through_the_interface/2011/03/making-autocad-less-noisy-when-debugging.html" target="_blank">mentioned previously</a>:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;</span><span style="line-height: 140%; color: #a31515">configuration</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;</span><span style="line-height: 140%; color: #a31515">startup</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">useLegacyV2RuntimeActivationPolicy</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">supportedRuntime</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">version</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">v4.0</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">/&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">startup</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;</span><span style="line-height: 140%; color: #a31515">runtime</span><span style="line-height: 140%; color: blue">&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">loadFromRemoteSources</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">enabled</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">/&gt; </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">runtime</span><span style="line-height: 140%; color: blue">&gt;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;</span><span style="line-height: 140%; color: #a31515">system.diagnostics</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">sources</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">source</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">name</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">System.Windows.Data</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">switchName</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">SourceSwitch</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">listeners</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">remove</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">name</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Default</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">listeners</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">source</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">sources</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">system.diagnostics</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;/</span><span style="line-height: 140%; color: #a31515">configuration</span><span style="line-height: 140%; color: blue">&gt;</span></p> </div>  <p>The loadFromRemoteSources change works well for Revit, too. Interestingly it doesn’t have any effect in Inventor 2012, which is still using .NET 3.5.</p>  <p>One other important thing to note: this allows you to <em><strong>load .NET assemblies from network locations</strong></em>, something that <a href="http://through-the-interface.typepad.com/through_the_interface/2009/11/updated-version-of-screenshot-now-available.html" target="_blank">has been an issue for a long time</a>. This is especially needed now that I’m working inside Parallels on my MacBook Pro: I don’t store data inside my Windows 7 installation, I leave it on the native hard-drive which gets mapped through to Windows as a network location. Which means I can now load .NET DLLs from that drive into AutoCAD and Revit (but not into Inventor, as yet).</p>  <p>I will say that making this change could potentially leave your (or – more importantly – your users’) system(s) more open to the execution of malicious, so make it <strong>at your own risk</strong>.</p>
