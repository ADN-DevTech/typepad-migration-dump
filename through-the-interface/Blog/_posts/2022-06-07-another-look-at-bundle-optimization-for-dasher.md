---
layout: "post"
title: "Another look at bundle optimization for Dasher"
date: "2022-06-07 16:08:14"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
  - "Web/Tech"
original_url: "https://www.keanw.com/2022/06/another-look-at-bundle-optimization-for-dasher.html "
typepad_basename: "another-look-at-bundle-optimization-for-dasher"
typepad_status: "Publish"
---

<p><a href="https://www.keanw.com/2021/09/bundle-optimization-in-project-dasher.html" target="_blank">Back in September</a> I talked a bit about using a <a href="https://www.npmjs.com/package/rollup-plugin-visualizer" target="_blank">plugin</a> for <a href="https://rollupjs.org/" target="_blank">Rollup</a> – the package bundler we use for <a href="https://dasher360.com" target="_blank">Project Dasher</a> – to start optimizing the bundling and delivery of JavaScript code.</p><p>Over the last few days I’ve come back to this topic, as I felt it was time to dig into some issues.</p><p>Dasher has three primary pages:</p><ol><li>The <em>index</em> page, where you arrive when you visit the site.<a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a30d3e2b5a200b-pi" target="_blank"><img width="501" height="371" title="The index page" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The index page" src="/assets/image_800489.jpg" border="0"></a></li><li>The <em>projects dashboard</em>, which you can access if you have login credentials for the site.<a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a308d0c293200c-pi" target="_blank"><img width="501" height="371" title="Projects dashboard" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Projects dashboard" src="/assets/image_792577.jpg" border="0"></a></li><li>The <em>Dasher viewer</em> page itself, which most of you will have accessed via the demo link on the index page.<a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a308d0c297200c-pi" target="_blank"><img width="501" height="371" title="The Dasher viewer" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The Dasher viewer" src="/assets/image_400356.jpg" border="0"></a></li></ol><p>Each of these pages has its own supporting JavaScript bundle, which gets transpiled and bundled from TypeScript source code by our build process.</p><p>Until recently these modules weighed in at 2MB, 10.69MB and 10.3MB, respectively. What’s worse is that the main Dasher viewer also included the bundle for the index page – which has significant overlap with the Dasher viewer’s bundle – so there was quite a lot of redundant and unused JavaScript being loaded.</p><p>Rollup does a pretty good job of minimising the size of bundles via a process called tree-shaking. This strips out unused code, but I found it doesn’t do well with statements such as “import * from ‘module’;”. I found we’d done this in quite a few places, and more selective use of import helped bring the size down quite a bit. In fact that’s the beauty of the visualization output for the various bundles, in that it often helps us identify which source file is causing a module to be included, but also helps work out whether tweaking an import statement makes a significant change or not.</p><p>Anyway, by some iterative tweaking, it was possible to bring the bundle sizes down to 700K, 2.22MB and 9.87MB. So the least impacted was the main viewer page, but then we were able to remove the use of the index bundle, so we stripped off a touch over 2MB. All in all a worthwhile exercise.</p><p>Here are some GIFs showing the “before and after” analyses of the bundles for our various pages.</p><p>Firstly the index page:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a30d3e2b80200b-pi" target="_blank"><img width="500" height="288" title="Index" style="margin: 30px auto; float: none; display: block;" alt="Index" src="/assets/image_557564.jpg"></a></p><p>And the projects dashboard:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a2eec6c4bf200d-pi" target="_blank"><img width="500" height="288" title="Projects" style="margin: 30px auto; float: none; display: block;" alt="Projects" src="/assets/image_454906.jpg"></a></p><p>And the Dasher viewer page:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a2eec6c4db200d-pi" target="_blank"><img width="500" height="288" title="Dasher viewer" style="margin: 30px auto; float: none; display: block;" alt="Dasher viewer" src="/assets/image_541813.jpg"></a></p><p>Given the reduced bundle size, the build process is also quite a bit quicker. Here we are before optimization:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a2eec6c48f200d-pi" target="_blank"><img width="500" height="160" title="Old build times" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Old build times" src="/assets/image_776280.jpg" border="0"></a></p><p>And here we are afterwards:<br></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e202a30d3e2b62200b-pi" target="_blank"><img width="477" height="159" title="New build times" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="New build times" src="/assets/image_728079.jpg" border="0"></a></p><p>It was definitely long overdue to do a little spring cleaning on Dasher’s JS bundles – it certainly feels good once it’s done, too!</p>
