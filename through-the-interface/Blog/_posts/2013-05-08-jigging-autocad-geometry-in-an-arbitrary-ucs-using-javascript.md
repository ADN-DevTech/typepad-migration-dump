---
layout: "post"
title: "Jigging AutoCAD geometry in an arbitrary UCS using JavaScript"
date: "2013-05-08 06:32:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Geometry"
  - "JavaScript"
  - "Jigs"
  - "Runtime"
original_url: "https://www.keanw.com/2013/05/jigging-autocad-geometry-in-an-arbitrary-ucs-using-javascript.html "
typepad_basename: "jigging-autocad-geometry-in-an-arbitrary-ucs-using-javascript"
typepad_status: "Publish"
---

<p>I’ve learned a few things since the last post, where we <a href="http://through-the-interface.typepad.com/through_the_interface/2013/05/complementing-autocads-javascript-api-using-net.html" target="_blank">complemented AutoCAD’s new JavaScript API with some additional .NET functionality</a> to work around an issue that existed in the code we’d developed in the previous <a href="http://through-the-interface.typepad.com/through_the_interface/2013/05/jigging-an-autocad-circle-using-javascript.html" target="_blank">two</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/05/jigging-an-autocad-circle-from-a-javascript-defined-command.html" target="_blank">posts</a>.</p>  <p>Firstly, I found out there’s a better way for your jig to display transient graphics than via “manual” calls to addTransient(), updateTransient() and eraseTransient(). Acad.Jig exposes an update() function you can call, passing in the xml fragment representing your geometry. The jig will manage the display of the transient and clear it at the end. (Thanks to Sherry Tan for pointing me in this direction.) To make this work, you’ll need to assign your jig to a variable that’s in scope during its execution.</p>  <p>The problem is that this mechanism still exhibits the issue we had to work around last time: when you click on the circumference of a transient circle, the click doesn’t make it through. So I’ve modified the comments in today’s code to reflect the ideal implementation, but it doesn’t change our need to work around the current problematic behaviour.</p>  <p>The other two things I learned are that the jig – as we implemented it last time – doesn’t work well with a non-standard (i.e. non-world) UCS and that it causes very bad things to happen when you try to run it in two separate drawing windows at the same time. The first of these is a problem we’ll address in today’s post, the second is something I need to check in with some colleagues on: it may simply be a limitation of the current implementation that it doesn’t work well in an MDI context. We’ll see.</p>  <p>So, how do we get the jig working properly in an arbitrary UCS? There’s a handy method available that allows us to transform from the current UCS to WCS, e.g.:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">wcsPoint = Acad.Editor.CurrentViewport.ucsToWorld(ucsPoint);</span></p> </div>  <p>We only need to use this to transform the picked centre-point of the circle into WCS.</p>  <p>One thing I struggled with: I had trouble getting distance acquisition to work properly in an arbitrary UCS inside our jig, so I ended up ditching it in favour of acquiring a second point and then calculating the distance to the centre-point manually. Which is why we now have a distanceBetween() function that uses <a href="http://en.wikipedia.org/wiki/Pythagorean_theorem" target="_blank">Pythagoras’ theorem</a> to calculate the distance between two points.</p>  <p>No changes were needed to the C# code we saw last time (which is still needed), but here are the updates to <a href="http://through-the-interface.typepad.com/files/CircleJigUcs.js" target="_blank">the JavaScript code</a>. Its CJ command should now work well in any User Coordinate System you can define inside AutoCAD:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> doc = Acad.Application.activedocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> center = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.Point3d(0, 0, 0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> ucsCenter;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> radius = 0;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> jig;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> pointToString(pt) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> ret =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; pt.x.toString() + </span><span style="line-height: 140%; color: maroon">&quot;,&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; pt.y.toString() + </span><span style="line-height: 140%; color: maroon">&quot;,&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; pt.z.toString();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> ret;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> distanceBetween(pt1, pt2) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> dist =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; Math.sqrt(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (pt2.x - pt1.x) * (pt2.x - pt1.x) +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (pt2.y - pt1.y) * (pt2.y - pt1.y) +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (pt2.z - pt1.z) * (pt2.z - pt1.z)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> dist;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> createCircle(cen, rad, first) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: #006400">// Build an XML string containing data to create</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: #006400">// an AcGiTransient that represents the circle</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> cursor = </span><span style="line-height: 140%; color: maroon">&#39;&#39;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> drawable =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#39;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;&lt;drawable &#39;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;xmlns=&quot;http://www.autodesk.com/AutoCAD/drawstream.xsd&quot; &#39;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;xmlns:t=&quot;http://www.autodesk.com/AutoCAD/transient.xsd&quot; &#39;</span><span style="line-height: 140%">+</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;t:onmouseover=&quot;onmouseover&quot;&#39;</span><span style="line-height: 140%"> + cursor + </span><span style="line-height: 140%; color: maroon">&#39;&gt;&#39;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;&lt;graphics id=&quot;id1&quot;&gt;&lt;circle center =&quot;&#39;</span><span style="line-height: 140%"> + pointToString(cen) +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;&quot; radius =&quot;&#39;</span><span style="line-height: 140%"> + rad.toString() + </span><span style="line-height: 140%; color: maroon">&#39;&quot;/&gt;&#39;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;&lt;/graphics&gt;&lt;/drawable&gt;&#39;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> drawable;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> circleJig() {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onJigUpdate(args) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> res = JSON.parse(args);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (res) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// We calculate the distance in the WCS</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// (using distance input we&#39;d just do this:</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">//&#0160; radius = res.distance; )</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> point =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.Point3d(res.point.x, res.point.y, res.point.z);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; radius = distanceBetween(center, point);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// Use it to create the XML for a transient</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// circle and ask for it to be displayed</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">//var x = createCircle(center, radius);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">//jig.update(x, onJigContinue, onJigError);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; drawCircle(center, radius);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onJigComplete(args) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; clearCircle();</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> res = JSON.parse(args);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (res &amp;&amp; res.dragStatus == Acad.DragStatus.kNormal) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Acad.Editor.executeCommandAsync(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&#39;_.CIRCLE &#39;</span><span style="line-height: 140%"> + pointToString(ucsCenter) + </span><span style="line-height: 140%; color: maroon">&#39; &#39;</span><span style="line-height: 140%"> + radius</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onJigContinue(args) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onJigError(args) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; clearCircle();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; write(</span><span style="line-height: 140%; color: maroon">&#39;\nUnable to create circle: &#39;</span><span style="line-height: 140%"> + args);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onPointSelected(args) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">try</span><span style="line-height: 140%"> {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> res = JSON.parse(args);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (res) {</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// Extract and transform our circle&#39;s center</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ucsCenter =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.Point3d(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.value.x,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.value.y,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.value.z</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; center = Acad.Editor.CurrentViewport.ucsToWorld(ucsCenter);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// Draw the circle with an initial 0 radius</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; drawCircle(center, 0);</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// Set up our jig options</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> opts =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.JigPromptPointOptions(</span><span style="line-height: 140%; color: maroon">&#39;Point on radius&#39;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; opts.userInputControls =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Acad.UserInputControls.kAccept3dCoordinates;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #006400">// Run the jig to select the distance</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; jig = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.DrawJig(onJigUpdate, opts);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Acad.Editor.drag(jig).then(onJigComplete, onJigError);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">catch</span><span style="line-height: 140%"> (ex) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; write(</span><span style="line-height: 140%; color: maroon">&#39;\nException: &#39;</span><span style="line-height: 140%"> + ex + </span><span style="line-height: 140%; color: maroon">&#39;\n&#39;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onPointError(args) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; write(</span><span style="line-height: 140%; color: maroon">&#39;\nUnable to select point: &#39;</span><span style="line-height: 140%"> + args);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: #006400">// Ask the user to select the center point before we</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: #006400">// start the jig</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> opts = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Acad.PromptPointOptions(</span><span style="line-height: 140%; color: maroon">&#39;Select center&#39;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; Acad.Editor.getPoint(opts).then(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; onPointSelected, onPointError</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: #006400">// Our extensions to the AutoCAD Shaping Layer</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> drawCircle(cen, rad) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; execAsync(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; JSON.stringify({</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; functionName: </span><span style="line-height: 140%; color: maroon">&#39;NetDrawCircle&#39;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; invokeAsCommand: </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; functionParams: {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; center: cen,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius: rad</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; onInvokeSuccess,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; onInvokeError</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> clearCircle() {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; execAsync(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; JSON.stringify({</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; functionName: </span><span style="line-height: 140%; color: maroon">&#39;NetClearCircle&#39;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; invokeAsCommand: </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; functionParams: undefined</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; onInvokeSuccess,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; onInvokeError</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; );</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onInvokeSuccess(result) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; write(</span><span style="line-height: 140%; color: maroon">&quot;\n&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">function</span><span style="line-height: 140%"> onInvokeError(result) {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; write(</span><span style="line-height: 140%; color: maroon">&quot;\nOnInvokeError: &quot;</span><span style="line-height: 140%"> + result);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">Acad.Editor.addCommand(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: maroon">&quot;JIG_CMDS&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: maroon">&quot;CJ&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: maroon">&quot;CJ&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; Acad.CommandFlag.MODAL,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; circleJig</span></p>    <p style="margin: 0px"><span style="line-height: 140%">);</span></p> </div>
