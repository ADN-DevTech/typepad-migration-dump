---
layout: "post"
title: "JavaScript in AutoCAD: Isometric views of 3D solids"
date: "2014-05-23 10:24:19"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "HTML"
  - "JavaScript"
  - "JSON"
  - "Solid modeling"
  - "Web/Tech"
original_url: "https://www.keanw.com/2014/05/javascript-in-autocad-isometric-views-of-3d-solids.html "
typepad_basename: "javascript-in-autocad-isometric-views-of-3d-solids"
typepad_status: "Publish"
---

<p>After <a href="http://through-the-interface.typepad.com/through_the_interface/2014/05/javascript-in-autocad-introducing-the-series.html" target="_blank">introducing the series</a> and <a href="http://through-the-interface.typepad.com/through_the_interface/2014/05/javascript-in-autocad-revision-clouds-using-paperjs.html" target="_blank">looking at a sample 2D JavaScript application</a>, it’s time to go 3D. Well, 2.5D, anyway. We’re going to implement a simple sample using <a href="http://jdan.github.io/isomer" target="_blank">the Isomer library</a> that extracts bounding box information about 3D solids – which could be extended to get more detailed topological information, albeit with quite some work – and displays them in an isometric view in the HTML canvas.</p>  <p>This time we’re only going to have a single button in our UI allowing model updates to be refreshed in our isometric view. I decided to leave this as a manual operation, but it’s certainly possible to do make this more automatic, pulling down updated data when relevant changes have been made to the model. But that’s for another day.</p>  <p>The other notable point about the implementation is the (admittedly somewhat crude) approach I’ve taken to help the results appear properly. Isomer draws the solids in the order you ask it to, so as it stands you really need to manage “draw order” in your own application. The below code has some additional logic that sorts the solids – or at least their bounding boxes – in a list keyed off the distance between the camera point and the centre of their nearest face. This is based on the current camera position in the relevant AutoCAD drawing – assuming its Editor object can be accessed – so you can tweak the results by changing the view (even if the isometric view is always what we’d consider “south-west isometric” in AutoCAD parlance.</p>  <p>Otherwise the C# code is actually much simpler than for the Paper.js integration (and shares a fair amount of commonality with it).</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.ApplicationServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.DatabaseServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Geometry;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Windows;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Newtonsoft.Json;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Collections.Generic;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.IO;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Reflection;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Text;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> JavaScriptExtender</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Commands</span></p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">PaletteSet</span> _isops = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">Document</span> _launchDoc = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">Point3d</span> _camPos = <span style="color: #2b91af">Point3d</span>.Origin;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">JavaScriptCallback</span>(<span style="color: #a31515">&quot;GetSolids&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> GetSolids(<span style="color: blue">string</span> jsonArgs)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = GetActiveDocument(<span style="color: #2b91af">Application</span>.DocumentManager);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If we didn't find a document, return</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #a31515">&quot;&quot;</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We could probably get away without locking the document</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// - as we only need to read - but it's good practice to</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// do it anyway</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> dl = doc.LockDocument())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We'll sort our list of extents objects based on a</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// distance value</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> sols = <span style="color: blue">new</span> <span style="color: #2b91af">SortedList</span>&lt;<span style="color: blue">double</span>, <span style="color: #2b91af">Extents3d</span>&gt;();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tr = doc.TransactionManager.StartTransaction())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Start by getting the modelspace</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ms =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">BlockTableRecord</span>)tr.GetObject(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">SymbolUtilityServices</span>.GetBlockModelSpaceId(db),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForRead</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If in palette mode we can get the camera from the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Editor, otherwise we rely on what was provided when</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the HTML document was launched</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> camPos = _camPos;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (_launchDoc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> view = ed.GetCurrentView();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; _camPos = view.Target + view.ViewDirection;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get each Solid3d in modelspace and add its extents</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// to the sorted list keyed off the distance from the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// closest face of the solid (not necessarily true,</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// but this only really is a crude approximation)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> id <span style="color: blue">in</span> ms)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> obj = tr.GetObject(id, <span style="color: #2b91af">OpenMode</span>.ForRead);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> sol = obj <span style="color: blue">as</span> <span style="color: #2b91af">Solid3d</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (sol != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ext = sol.GeometricExtents;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> tmp =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ext.MinPoint + 0.5 * (ext.MaxPoint - ext.MinPoint);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> mid = <span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(ext.MinPoint.X, tmp.Y, tmp.Z);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> dist = camPos.DistanceTo(mid);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sols.Add(dist, ext);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> GetSolidsString(sols);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">Document</span> GetActiveDocument(<span style="color: #2b91af">DocumentCollection</span> dm)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If we're called from an HTML document, the active</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// document may be null</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = dm.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; doc = _launchDoc;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> doc;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Helper function to build a JSON string containing our</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// sorted extents list</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">string</span> GetSolidsString(<span style="color: #2b91af">SortedList</span>&lt;<span style="color: blue">double</span>, <span style="color: #2b91af">Extents3d</span>&gt; lst)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> sb = <span style="color: blue">new</span> <span style="color: #2b91af">StringBuilder</span>(<span style="color: #a31515">&quot;{\&quot;retCode\&quot;:0, \&quot;result\&quot;:[&quot;</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> keys = lst.Keys;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = keys.Count - 1; i &gt;= 0; i--)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (i &lt; keys.Count - 1)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.Append(<span style="color: #a31515">&quot;,&quot;</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ext = lst[keys[i]];</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; sb.Append(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>.Format(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;{{\&quot;min\&quot;:{0},\&quot;max\&quot;:{1}}}&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">JsonConvert</span>.SerializeObject(ext.MinPoint),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">JsonConvert</span>.SerializeObject(ext.MaxPoint)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; sb.Append(<span style="color: #a31515">&quot;]}&quot;</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> sb.ToString();</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;ISODOC&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> IsomerDocument()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _launchDoc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> view = _launchDoc.Editor.GetCurrentView();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _camPos = view.Target + view.ViewDirection;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _launchDoc.BeginDocumentClose +=</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (s, e) =&gt; { _launchDoc = <span style="color: blue">null</span>; };</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Application</span>.DocumentWindowCollection.AddDocumentWindow(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Isomer Document&quot;</span>, GetHtmlPathIso()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;ISOMER&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> IsomerPalette()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _launchDoc = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _camPos = <span style="color: #2b91af">Point3d</span>.Origin;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _isops =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ShowPalette(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; _isops,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">Guid</span>(<span style="color: #a31515">&quot;280D8D13-AA13-4A62-AD9F-33D479308DFD&quot;</span>),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;ISOMER&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Isomer Examples&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GetHtmlPathIso()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Helper function to show a palette</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">PaletteSet</span> ShowPalette(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">PaletteSet</span> ps, <span style="color: #2b91af">Guid</span> guid, <span style="color: blue">string</span> cmd, <span style="color: blue">string</span> title, <span style="color: #2b91af">Uri</span> uri</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ps == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ps = <span style="color: blue">new</span> <span style="color: #2b91af">PaletteSet</span>(cmd, guid);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ps.Visible)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> ps;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ps.Count != 0)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ps[0].PaletteSet.Remove(0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ps.Add(title, uri);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ps.Visible = <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> ps;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Helper function to get the path to our HTML files</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">string</span> GetHtmlPath()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Use this approach if loading the HTML from the same</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// location as your .NET module</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">//var asm = Assembly.GetExecutingAssembly();</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">//return Path.GetDirectoryName(asm.Location) + &quot;\\&quot;;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #a31515">&quot;http://through-the-interface.typepad.com/files/&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">Uri</span> GetHtmlPathIso()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">Uri</span>(GetHtmlPath() + <span style="color: #a31515">&quot;isosolids.html&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p> </div>  <p>Here’s the code in action:</p>  <br /><iframe height="264" src="//www.youtube.com/embed/mQ1Rvg8_wII?rel=0" frameborder="0" width="470" allowfullscreen="allowfullscreen"></iframe>  <br />  <br />  <p>And now for the supporting files from the blog. Firstly, <a href="http://through-the-interface.typepad.com/files/isosolids.html" target="_blank">the HTML file</a>:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: maroon">!doctype</span> <span style="color: red">html</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: maroon">html</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160; <span style="color: blue">&lt;</span><span style="color: maroon">head</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">title</span><span style="color: blue">&gt;</span>Isometric Solids<span style="color: blue">&lt;/</span><span style="color: maroon">title</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">link</span> <span style="color: red">rel</span><span style="color: blue">=&quot;stylesheet&quot;</span> <span style="color: red">href</span><span style="color: blue">=&quot;style.css&quot;&gt;</span></p>    <p style="margin: 0px">&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">head</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160; <span style="color: blue">&lt;</span><span style="color: maroon">body</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span> <span style="color: red">src</span><span style="color: blue">=&quot;js/isomer.min.js&quot;&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: red">src</span><span style="color: blue">=&quot;http://app.autocad360.com/jsapi/v2/Autodesk.AutoCAD.js&quot;&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span> <span style="color: red">src</span><span style="color: blue">=&quot;js/acadext.js&quot;&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span> <span style="color: red">src</span><span style="color: blue">=&quot;js/isosolids.js&quot;&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">body</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: maroon">html</span><span style="color: blue">&gt;</span></p> </div>  <p>This sample also uses <a href="http://through-the-interface.typepad.com/files/js/isosolids.js" target="_blank">an external JavaScript file</a>:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">var</span> iso;</p>    <p style="margin: 0px"><span style="color: blue">var</span> Point = Isomer.Point;</p>    <p style="margin: 0px"><span style="color: blue">var</span> Path = Isomer.Path;</p>    <p style="margin: 0px"><span style="color: blue">var</span> Shape = Isomer.Shape;</p>    <p style="margin: 0px"><span style="color: blue">var</span> Color = Isomer.Color;</p>    <p style="margin: 0px"><span style="color: blue">var</span> offX = 0, offY = 0;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> init() {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Get our solids from AutoCAD</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; sols = getSolidsFromAutoCAD();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Get the overall bounding box</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> minX = Infinity,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; minY = Infinity,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; minZ = Infinity,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; maxX = -Infinity,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; maxY = -Infinity,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; maxZ = -Infinity;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">for</span> (<span style="color: blue">var</span> sol <span style="color: blue">in</span> sols) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">var</span> s = sols[sol];</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; minX = Math.min(minX, s.min.X, s.max.X);</p>    <p style="margin: 0px">&#160;&#160;&#160; minY = Math.min(minY, s.min.Y, s.max.Y);</p>    <p style="margin: 0px">&#160;&#160;&#160; minZ = Math.min(minZ, s.min.Z, s.max.Y);</p>    <p style="margin: 0px">&#160;&#160;&#160; maxX = Math.max(maxX, s.min.X, s.max.X);</p>    <p style="margin: 0px">&#160;&#160;&#160; maxY = Math.max(maxY, s.min.Y, s.max.Y);</p>    <p style="margin: 0px">&#160;&#160;&#160; maxZ = Math.max(maxZ, s.min.Z, s.max.X);</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> delX = Math.abs(maxX - minX),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; delY = Math.abs(maxY - minY),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; delZ = Math.abs(maxZ - minZ);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Establish an offset for our geometry, so it all</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// gets displayed properly</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; offX = -minX,</p>    <p style="margin: 0px">&#160; offY = -minY;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Get the diagonal length from min to max</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> diag = Math.sqrt(delX * delX + delY * delY + delZ * delZ);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Scale the Isomer canvas based on the size of this diagonal</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> canvas = document.createElement(<span style="color: #a31515">'canvas'</span>);</p>    <p style="margin: 0px">&#160; canvas.width = window.innerWidth - 25,</p>    <p style="margin: 0px">&#160; canvas.height = window.innerHeight - 65;</p>    <p style="margin: 0px">&#160; document.body.appendChild(canvas);</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> smaller = Math.min(canvas.width, canvas.height);</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> scale = smaller / diag;</p>    <p style="margin: 0px">&#160; iso = <span style="color: blue">new</span> Isomer(canvas, { scale: scale });</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> container = document.createElement(<span style="color: #a31515">'div'</span>);</p>    <p style="margin: 0px">&#160; container.setAttribute(<span style="color: #a31515">'id'</span>, <span style="color: #a31515">'control'</span>);</p>    <p style="margin: 0px">&#160; container.style.background = <span style="color: #a31515">'#FFFFFF'</span>;</p>    <p style="margin: 0px">&#160; document.body.appendChild(container);</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> Commands() {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">Commands.refresh = <span style="color: blue">function</span> () {</p>    <p style="margin: 0px">&#160; iso.canvas.clear();</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> sols = getSolidsFromAutoCAD();</p>    <p style="margin: 0px">&#160; <span style="color: blue">for</span> (<span style="color: blue">var</span> sol <span style="color: blue">in</span> sols) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">var</span> s = sols[sol];</p>    <p style="margin: 0px">&#160;&#160;&#160; iso.add(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; Shape.Prism(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> Point(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; offX + s.min.X, offY + s.min.Y, s.min.Z</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Math.abs(s.max.X - s.min.X),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Math.abs(s.max.Y - s.min.Y),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Math.abs(s.max.Z - s.min.Z)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}; </p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">(<span style="color: blue">function</span> () {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; init();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> panel = document.getElementById(<span style="color: #a31515">'control'</span>);</p>    <p style="margin: 0px">&#160; <span style="color: blue">for</span> (<span style="color: blue">var</span> fn <span style="color: blue">in</span> Commands) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">var</span> button = document.createElement(<span style="color: #a31515">'div'</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; button.classList.add(<span style="color: #a31515">'cmd-btn'</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; button.innerHTML = fn;</p>    <p style="margin: 0px">&#160;&#160;&#160; button.onclick = (<span style="color: blue">function</span> (fn) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">function</span> () { fn(); };</p>    <p style="margin: 0px">&#160;&#160;&#160; })(Commands[fn]);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; panel.appendChild(button);</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; Commands.refresh();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">})();</p> </div>  <p>Here’s the accompanying <a href="http://through-the-interface.typepad.com/files/js/acadext.js" target="_blank">extension to AutoCAD’s Shaping Layer</a>:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">function</span> getSolidsFromAutoCAD() {</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> jsonResponse =</p>    <p style="margin: 0px">&#160;&#160;&#160; exec(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; JSON.stringify({</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; functionName: <span style="color: #a31515">'GetSolids'</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; invokeAsCommand: <span style="color: blue">false</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; functionParams: undefined</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; })</p>    <p style="margin: 0px">&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> jsonObj = JSON.parse(jsonResponse);</p>    <p style="margin: 0px">&#160; <span style="color: blue">if</span> (jsonObj.retCode !== Acad.ErrorStatus.eJsOk) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">throw</span> Error(jsonObj.retErrorString);</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160; <span style="color: blue">return</span> jsonObj.result;</p>    <p style="margin: 0px">}</p> </div>  <p><a href="http://through-the-interface.typepad.com/files/style.css" target="_blank">The stylesheet</a> is the same as the one we we saw last time.</p>  <p>Clearly there are lots of places this could go. Supporting more elaborate topology is one area for enhancement, whether via native objects or (and this would be pretty darn cool) decomposing them into <a href="http://minecraft.net" target="_blank">Minecraft</a>-style blocks. The code is also not handling different orientations of geometry – we’re just displaying bounding boxes aligned with WCS: we could support object-level transformations as well as views from different angles (which would mean transforming the entire model before adding it to the Isomer canvas, presumably). And having more control over the zoom factor and position of the resultant geometry would be helpful, of course.</p>  <p>That’s it for this week. Next week we’re going to look at a sample that has a lot of similarities to this one at the code level – we use the same GetSolids() function, for instance – but this time we’re going to visualize the bounding boxes in full 3D using Three.js. We’ll also take the opportunity to take a sneak peak at some <u>really</u> interesting things Autodesk is doing in this space.</p>
