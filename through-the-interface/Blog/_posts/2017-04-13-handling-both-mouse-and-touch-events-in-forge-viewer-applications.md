---
layout: "post"
title: "Handling both mouse and touch events in Forge viewer applications"
date: "2017-04-13 17:04:29"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "JavaScript"
  - "Mobile"
original_url: "https://www.keanw.com/2017/04/handling-both-mouse-and-touch-events-in-forge-viewer-applications.html "
typepad_basename: "handling-both-mouse-and-touch-events-in-forge-viewer-applications"
typepad_status: "Publish"
---

<p>To follow up on <a href="http://through-the-interface.typepad.com/through_the_interface/2017/04/fixing-pinch-zoom-in-forge-viewer-applications.html" target="_blank">the last post</a> – where we talked about adding a custom tool to provide better support for pinch gestures – today we’re going to talk about some other possibilities for supporting touch in the Forge viewer. Once again we’re using <a href="https://developer.autodesk.com/en/docs/viewer/v2/reference/javascript/toolcontroller/" target="_blank">Autodesk.Viewing.ToolController</a> &amp; <a href="https://developer.autodesk.com/en/docs/viewer/v2/reference/javascript/toolinterface/" target="_blank">ToolInterface</a>.</p> <p>The Forge viewer uses <a href="http://hammerjs.github.io" target="_blank">Hammer.js</a> internally to support touch, so that’s one good place to look for clues on how things work. (Groan – I’ve just realised why it’s called “Hammer”… “<a href="https://www.youtube.com/watch?v=otCpCn0l4Wo" target="_blank">you CAN touch this!</a>” :-)</p> <p>I was looking into how to support both “touch-capable” (i.e. they also have mouse &amp; keyboard input) and “touch-only” (your typical phone or tablet) devices. Going from how Hammer.js works – and <a href="http://stackoverflow.com/questions/3974827/detecting-touch-screen-devices-with-javascript/33604438" target="_blank">some info on Stack Overflow</a> – I ended up creating these two utility functions in TypeScript:</p> <p>&nbsp;</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: blue">export</span> <span style="color: blue">function</span> isTouchDevice(): boolean {</p> <p style="margin: 0px">&nbsp; <span style="color: blue">return</span> <span style="color: #a31515">'ontouchstart'</span> <span style="color: blue">in</span> window || !!navigator.maxTouchPoints;</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: blue">export</span> <span style="color: blue">function</span> isTouchOnlyDevice(): boolean {</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> mobileRegEx = <span style="color: maroon">/mobile|tablet|ip(ad|hone|od)|android/i</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">return</span> isTouchDevice() &amp;&amp; mobileRegEx.test(navigator.userAgent);</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>I’ve found when using the Forge viewer in <a href="http://dasher360.com" target="_blank">Dasher 360</a> that sometimes you get both mouse and touch events for the same operation, but at other times it has decided only to send touch events. And this was when running the page on my phone, which was more than a little confusing. It wasn’t fully clear what logic – or sequence of operations – led to these two scenarios occurring.</p> <p>Rather than using the above functions – which have come in handy for other things, such as showing larger sensor dots on touch-only devices – I decided to set a simple flag in the handleSingleClick() event and then look for it later in the handleSingleTap() event. (The first is a mouse event, the second a touch event.) This way I can perform the operation “on click”, set the flag, and then if I get “on tap” I can choose not to repeat it and then reset the flag. This way if only touch events come through I can perform the event each time as the flag hasn’t been set.</p> <p>This approach seems to work fairly well for my needs. I also very much like the fact that I can return true from various event handlers to prevent stray clicks, taps and double-clicks/-taps from doing strange things – like selecting objects or zooming into an area – in the Forge viewer. This has done a lot for our user experience, in my opinion.</p> <p>Here are a few screenshots of how Dasher 360 is currently looking on mobile (these changes are on staging, but will soon make it into the live site):</p> <p>&nbsp;</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d2776bf9970c-pi"><img title="Dasher 360 on mobile" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="Dasher 360 on mobile" src="/assets/image_432900.jpg" width="500" height="281"></a></p> <p>&nbsp;</p> <p>On a side note, the <a href="https://developer.autodesk.com/en/docs/viewer/v2/reference/javascript/toolcontroller/" target="_blank">Autodesk.Viewing.ToolController</a>/<a href="https://developer.autodesk.com/en/docs/viewer/v2/reference/javascript/toolinterface/" target="_blank">ToolInterface</a> implementation is proving to be very handy indeed: I’m also using it to avoid adding mouse handlers directly on the document or canvas, as I was doing previously. This makes for a much more elegant implementation: if you haven’t already looked at this mechanism, I strongly recommend doing so.</p>
