---
layout: "post"
title: "AU Handouts: There's More to .DWG Than AutoCAD&reg; - Part 1"
date: "2007-10-17 17:01:15"
author: "Kean Walmsley"
categories:
  - "AU"
  - "AutoCAD"
  - "AutoCAD .NET"
  - "RealDWG"
  - "Training"
  - "Visual Studio"
original_url: "https://www.keanw.com/2007/10/au-handouts-the.html "
typepad_basename: "au-handouts-the"
typepad_status: "Publish"
---

<p>[<em>As mentioned in <a href="http://through-the-interface.typepad.com/through_the_interface/2007/10/autodesk-univer.html">the last post</a>, I'll be publishing chunks of the handouts for my AU classes via this blog over the coming weeks]</em></p>  <p><span style="font-size: 1.2em"><strong>Introduction</strong></span></p>  <p>This session focuses on downstream technologies that can be used to access DWG content outside of AutoCAD-based products. We’re going to start by creating a basic model inside AutoCAD comprised of 3D solid objects, and then look at a simple AutoCAD .NET application to access information about those solids. We will then take the same code and build a non-graphical (in terms of geometry - it does, after all, have a GUI) application around it using Autodesk RealDWG. Later on we’ll look at the same code running inside a custom-branded design application built using AutoCAD OEM.</p>  <p>We will also spend time looking at DWG TrueView and the DWG HOOPS viewer, to understand how they might be used to enhance the graphical display of DWGs without the editing overhead introduced with AutoCAD-based products.</p>  <p>Firstly, why are we using 3D solids in this example? The choice was somewhat arbitrary – the point is really to demonstrate the ability to access properties of objects stored in a DWG file without AutoCAD running – but it does suit our overall purpose for a few reasons:</p>  <ol>   <li>As 3D entities, 3D solids allow us to evaluate the 3D capabilities of the viewing technologies we’re looking at. </li>    <li>They provide precise data that is of interest to us – in this case we’re going to mine their volume – and can also have data attached of a less precision-oriented nature, such as materials. </li>    <li>Regarding both the above points, they also feed into the fact that this demo continues in another AU session, <em>“DE401-2: Enriching Your DWF™”</em>, which focuses on working with DWF data that is published from AutoCAD. In that session we’ll look at how to harness both 2D and 3D data to implement rich applications focused on published – rather than native – data. </li> </ol>  <p>A quick word on the programming technology used in this demonstration. The code samples are all in VB.NET: regular readers of my blog (<a href="http://blogs.autodesk.com/through-the-interface">http://blogs.autodesk.com/through-the-interface</a>) will know I have a preference for C#, having spent years working with C++, but I’m sticking with VB.NET for this demonstration: we originally developed the material using VB.NET to reach the broader audience of Visual Basic professionals.</p>  <p>These handouts, along with the sample projects demonstrated within them, have been posted to my blog: <a href="http://blogs.autodesk.com/through-the-interface">http://blogs.autodesk.com/through-the-interface</a>. Only significant portions of code will be highlighted in this document, and even those should not need to be typed back in. :-)</p>  <p><em>[You can download the source used in this demo from </em><a href="http://through-the-interface.typepad.com/through_the_interface/files/autocad_project.zip"><em>here for the AutoCAD application</em></a><em> and </em><a href="http://through-the-interface.typepad.com/through_the_interface/files/realdwg_project.zip"><em>here for the RealDWG application.</em></a><em>]</em></p>  <p><strong>Create a simple 3D model in AutoCAD and access it using .NET</strong></p>  <p>There are various 3D modeling commands available in AutoCAD, of which detailed review is outside the scope of this session. We simply want to populate a model with a number of 3D solids with materials attached. Here’s the kind of thing we’re looking for:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=800,height=733,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/17/3d_model.png"><img title="3d_model" border="0" alt="3d_model" src="/assets/3d_model.png" width="300" height="274" /></a> </p>  <p><em>Figure 1 – a simple set of 3D solids inside AutoCAD</em></p>  <p>Now we’re ready to start looking at the code we’ll use inside an AutoCAD application, as well as within RealDWG and AutoCAD OEM, to access the information in this model.</p>  <p>Here’s code from a file called SolidInfo.vb to represent a data structure we’ll use to collect information about our 3D solids – their type, location, ID (the AutoCAD handle) and volume.</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.DatabaseServices</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.Geometry</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.Interop</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.Interop.Common</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> System.Math</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: green">' The SolidData class encapsulates the data we</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">' want to collect and display for Solid3d objects</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Public</span> <span style="color: blue">Class</span> SolidData</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: green">' We care about Type, Location, ID &amp; Volume</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> m_Type <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> m_Location <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> m_Id <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> m_Volume <span style="color: blue">As</span> <span style="color: blue">Double</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Property</span> Type()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Return</span> m_Type</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Set</span>(<span style="color: blue">ByVal</span> value)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_Type = value</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Set</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Property</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Property</span> Location()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Return</span> m_Location</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Set</span>(<span style="color: blue">ByVal</span> value)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_Location = value</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Set</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Property</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Property</span> Id()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Return</span> m_Id</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Set</span>(<span style="color: blue">ByVal</span> value)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_Id = value</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Set</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Property</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Property</span> Volume()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Return</span> m_Volume</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Set</span>(<span style="color: blue">ByVal</span> value)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_Volume = value</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Set</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Property</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">End</span> <span style="color: blue">Class</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: green">' The SolidList class is simply a list of SolidData</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">' (used when defining the data a grid is bound to)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Public</span> <span style="color: blue">Class</span> SolidList</p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Inherits</span> System.ComponentModel.BindingList(<span style="color: blue">Of</span> SolidData)</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">End</span> <span style="color: blue">Class</span></p> </div>  <p>Now we have a function that will take a database and iterate through its contents, collecting information about 3D solid objects and adding them to a Data-Bound Grid passed in as the second argument. This grid should be created in the UI to be bound to objects of type SolidList (defined above).</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Public</span> <span style="color: blue">Module</span> SolidFunctions</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: green">' This function will get SolidData for each Solid3d</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: green">' in a Database and add them to a BindingSource (a grid</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: green">' in a form, typically). It also returns the total volume</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: green">' of Solid3ds in the Database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Function</span> AnalyzeDatabase _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; (<span style="color: blue">ByVal</span> db <span style="color: blue">As</span> Database, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">ByRef</span> sl <span style="color: blue">As</span> System.Windows.Forms.BindingSource) _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">As</span> <span style="color: blue">Double</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">' We will return the total volume of solids</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">' in the modelspace of this Database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> vol <span style="color: blue">As</span> <span style="color: blue">Double</span> = 0</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; sl.Clear()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> tr <span style="color: blue">As</span> Transaction = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; db.TransactionManager.StartTransaction()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Using</span> tr</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Try</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> bt <span style="color: blue">As</span> BlockTable = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (db.BlockTableId(), _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; OpenMode.ForRead)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> btr <span style="color: blue">As</span> BlockTableRecord = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (bt(BlockTableRecord.ModelSpace), _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; OpenMode.ForRead)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Loop for each entity in the modelspace</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">For</span> <span style="color: blue">Each</span> entId <span style="color: blue">As</span> ObjectId <span style="color: blue">In</span> btr</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> ent <span style="color: blue">As</span> Entity = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(entId, OpenMode.ForRead)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' If it's a solid, then gather its data</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">If</span> <span style="color: blue">TypeOf</span> (ent) <span style="color: blue">Is</span> Solid3d <span style="color: blue">Then</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> solid <span style="color: blue">As</span> Solid3d = <span style="color: blue">CType</span>(ent, Solid3d)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> mp <span style="color: blue">As</span> Solid3dMassProperties = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; solid.MassProperties()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> sd <span style="color: blue">As</span> <span style="color: blue">New</span> SolidData</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Use the COM API to access the type string</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' (exposed through neither ObjectARX nor .NET)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> oSolid <span style="color: blue">As</span> Acad3DSolid</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; oSolid = <span style="color: blue">CType</span>(solid.AcadObject, Acad3DSolid)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sd.Type = oSolid.SolidType</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Use the centroid for the location</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sd.Location = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Round(mp.Centroid.X, 4).ToString() + <span style="color: maroon">&quot;, &quot;</span> + _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Round(mp.Centroid.Y, 4).ToString() + <span style="color: maroon">&quot;, &quot;</span> + _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Round(mp.Centroid.Y, 4).ToString()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sd.Id = solid.Handle.ToString</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sd.Volume = Round(mp.Volume, 4)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Add each solid's info to the list</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sl.Add(sd)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' And add its volume to the total</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vol += sd.Volume()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">If</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Next</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Committing is cheaper than aborting,</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' even if we didn't change the drawing</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Catch</span> ex <span style="color: blue">As</span> Exception</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox(<span style="color: maroon">&quot;Error: &quot;</span> + ex.Message)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Try</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Using</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; AnalyzeDatabase = Math.Round(vol, 2)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Function</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">End</span> <span style="color: blue">Module</span></p> </div>  <p>We will now build the code into a complete AutoCAD .NET application which defines two commands – the first, <strong>SD</strong>, launches a dockable AutoCAD palette listing the 3D solids in our model and totaling their volume, and the second, <strong>SD2</strong>, does the same from a standard dialog:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=319,height=428,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/3d_solids_palette_2.png"><img title="3d_solids_palette_2" style="float: left; margin: 0px 5px 5px 0px" border="0" alt="3d_solids_palette_2" src="/assets/3d_solids_palette_2.png" width="200" height="268" /></a></p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=490,height=467,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/3d_solids_dialog.png"><img title="3d_solids_dialog" border="0" alt="3d_solids_dialog" src="/assets/3d_solids_dialog.png" width="300" height="285" /></a> </p>  <p><em>Figure 2 - the dialogs displayed by the SD and SD2 custom commands</em></p>  <p>These two dialogs share a common implementation: they both contain a UserControl that contains a DataGridView and a BindingNavigator to browse the contained records. There’s an optional “Analysis” button in the control, which allows the analysis operation to be launched manually. This is hidden when within the Dialog version, as it was primarily intended as a modal interface which launches the analysis automatically on load.</p>  <p><strong>Build a RealDWG application from the AutoCAD .NET code</strong></p>  <p>Now we will take the basic code from the SolidInfo.vb file and reuse it in a RealDWG application. It is also possible to use the User Control directly (defined in SolidUserControl.vb, SolidUserControl.Designer.vb and SolidUserControl.resx) but I thought it would be of more interest to demonstrate building the steps needed to build a RealDWG application and how it differs from a standard AutoCAD .NET module.</p>  <p>We start by creating a new Windows Application in Visual Studio 2005:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=681,height=495,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/new_realdwg_project.png"><img title="New_realdwg_project" border="0" alt="New_realdwg_project" src="/assets/new_realdwg_project.png" width="300" height="218" /></a> </p>  <p><em>Figure 3 – creating a new project for our RealDWG application</em></p>  <p>The first step is to copy across the SolidInfo.vb file into our project folder and add it into the project as an existing item. To get the project to build you will need to select two project references: one for the RealDWG managed assembly, and one for the COM type library:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=467,height=382,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/add_reference_to_realdwg_managed_as.png"><img title="Add_reference_to_realdwg_managed_as" border="0" alt="Add_reference_to_realdwg_managed_as" src="/assets/add_reference_to_realdwg_managed_as.png" width="299" height="245" /></a> </p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=467,height=382,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/add_reference_to_com_type_library.png"><img title="Add_reference_to_com_type_library" border="0" alt="Add_reference_to_com_type_library" src="/assets/add_reference_to_com_type_library.png" width="299" height="245" /></a> </p>  <p><em>Figure 4 - adding project references to the RealDWG managed assembly &amp; COM type-library</em></p>  <p>We need the COM type library to work around a specific limitation in the .NET API to AutoCAD and in ObjectARX, its underlying API. These APIs do not provide access to the type of a solid – whether it’s a sphere, a cylinder or a pyramid, for instance – so we need to use COM to retrieve the information.</p>  <p>New VB.NET Windows Application projects contain a default form, Form1.vb. Rename this to MainForm.vb and design a simple user interface with a TextBox for a filename (named <strong>DwgFileToAnalyze</strong>), a Button to browse to the file (named <strong>BrowseButton</strong>) and a DataGridView (called whatever you like :-). When you come to adding the DataGridView you will be prompted to define a Data Source. Select “Add a New Data Source” of type “Object”. From here you will be able to browse down to our SolidList class:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=571,height=386,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/adding_the_datagridview.png"><img title="Adding_the_datagridview" border="0" alt="Adding_the_datagridview" src="/assets/adding_the_datagridview.png" width="300" height="202" /></a> </p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=575,height=451,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/adding_a_data_source.png"><img title="Adding_a_data_source" border="0" alt="Adding_a_data_source" src="/assets/adding_a_data_source.png" width="300" height="235" /></a></p>  <p><em>Figure 5 – adding a DataGridView and its associated Data Source</em></p>  <p>Now just add a Label (named <strong>TotalVolumeText</strong>) at the bottom (going the whole width of the dialog, setting the AutoSize property to “False”, the Font to something nice and visible and TextAlign to “MiddleRight”). You can leave the contents blank, as we’ll be setting those programmatically.</p>  <p>I always like the UI to behave well on resize, even with a sample app, so I’d suggest editing the Anchor property of the GroupBox and the TextBox to “Top, Left, Right”, of the DataGridView to “Top, Bottom, Left, Right”, and of the VolumeText to “Bottom, Left, Right”.</p>  <p>I’d also change the following DataGridView properties: AllowUserToAddRows to “False”, AllowUserTo DeleteRows to “False” and AutoSizeColumnsMode to “Fill”.</p>  <p>The User Interface is now done – we’re ready to flesh out the application functionality to call our AnalyzeDatabase() from SolidInfo.vb.</p>  <p>First we need to implement some code to make our RealDWG application valid. We’ll add a new file called Program.vb and populate it with a base HostApplicationServices object:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.Runtime</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.DatabaseServices</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: green">'&lt;Assembly: SecuredApplication(&quot;&lt;Placeholder for the clear text license&gt;&quot;, &quot;&lt;Placeholder for the Autodesk encrypted text license&gt;&quot;, &quot;&lt;Placeholder for the client encrypted text license&gt;&quot;, &quot;&lt;Placeholder for the client public key&gt;&quot;)&gt; </span></p>    <p style="font-size: 8pt; margin: 0px">&lt;Assembly: SecuredApplication( _</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: maroon">&quot;THIS IS AN OBJECTDBX (TM) VERSION 2007 CLIENT LICENSE FOR THE EXCLUSIVE USE OF Kean Walmsley. YOUR USE OF OBJECTDBX(TM) IS GOVERNED BY THE SOFTWARE LICENSE INCLUDED IN THE PRODUCT. USE OF THIS SOFTWARE IN VIOLATION OF THE SOFTWARE LICENSE IS A VIOLATION OF U.S. AND/OR INTERNATIONAL COPYRIGHT LAWS AND TREATIES AND YOU MAY BE SUBJECT TO CRIMINAL PENALTIES FOR SUCH USE.&quot;</span>, _</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: green">' Lines deleted - you will need to be a valid RealDWG license holder to get this text</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Public</span> <span style="color: blue">Class</span> MyHostApplicationServices</p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Inherits</span> HostApplicationServices</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Public</span> <span style="color: blue">Overrides</span> <span style="color: blue">Function</span> FindFile _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; (<span style="color: blue">ByVal</span> fileName <span style="color: blue">As</span> <span style="color: blue">String</span>, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">ByVal</span> database <span style="color: blue">As</span> Database, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">ByVal</span> hint <span style="color: blue">As</span> FindFileHint) _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; FindFile = <span style="color: blue">Nothing</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Function</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">End</span> <span style="color: blue">Class</span></p> </div>  <p>I've edited the above text to delete my personal RealDWG license keys – you will need to license RealDWG to receive valid license keys of your own for this code to work. The FindFile function is needed to help RealDWG find supporting files such as fonts. As we’re only accessing information about 3D solid objects it is not important for us to implement this completely.</p>  <p>Now we go to the code window for MainForm.vb – either by double-clicking the form, the browse button, or by selecting View Code from the Solution Explorer when right-clicking on the file. We replace the default implementation with the following: </p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.DatabaseServices</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Imports</span> Autodesk.AutoCAD.Runtime</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">Public</span> <span style="color: blue">Class</span> MainForm</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> <span style="color: blue">Sub</span> MainForm_Load _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; (<span style="color: blue">ByVal</span> sender <span style="color: blue">As</span> System.Object, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">ByVal</span> e <span style="color: blue">As</span> System.EventArgs) _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Handles</span> <span style="color: blue">MyBase</span>.Load</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">' Initialize RealDWG host subsystem</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; RuntimeSystem.Initialize _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">New</span> MyHostApplicationServices(), 1033)</p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Sub</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">Private</span> <span style="color: blue">Sub</span> BrowseButton_Click _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; (<span style="color: blue">ByVal</span> sender <span style="color: blue">As</span> System.Object, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">ByVal</span> e <span style="color: blue">As</span> System.EventArgs) _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Handles</span> BrowseButton.Click</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> dlg <span style="color: blue">As</span> <span style="color: blue">New</span> System.Windows.Forms.OpenFileDialog()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; dlg.InitialDirectory = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; System.Environment.CurrentDirectory</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; dlg.Filter = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;DWG files (*.dwg)|*.dwg|All files (*.*)|*.*&quot;</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> oc <span style="color: blue">As</span> Cursor = <span style="color: blue">Me</span>.Cursor</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">If</span> dlg.ShowDialog() = Windows.Forms.DialogResult.OK <span style="color: blue">Then</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Me</span>.Cursor = Cursors.WaitCursor</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; DwgFileToAnalyze.Text = dlg.FileName()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Me</span>.Refresh()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">If</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">If</span> DwgFileToAnalyze.Text &lt;&gt; <span style="color: maroon">&quot;&quot;</span> <span style="color: blue">Then</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Let's read the selected DWG</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> db <span style="color: blue">As</span> Database = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">New</span> Database(<span style="color: blue">False</span>, <span style="color: blue">True</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Using</span> db</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; db.ReadDwgFile _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (DwgFileToAnalyze.Text, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; IO.FileShare.None, _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">False</span>, <span style="color: blue">Nothing</span>)</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; HostApplicationServices.WorkingDatabase = db</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">' Analyze it and display the results</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Dim</span> vol <span style="color: blue">As</span> <span style="color: blue">Double</span> = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; AnalyzeDatabase(db, SolidListBindingSource)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; TotalVolumeText.Text = _</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;Total Volume = &quot;</span> + vol.ToString()</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">Me</span>.Cursor = oc</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Using</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">If</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Sub</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">End</span> <span style="color: blue">Class</span></p> </div>  <p>Our code is now ready to build. There is, however, one additional step needed for the application to run. When you receive a license key for RealDWG, you should also receive a public license file (client.snk) that needs to be bound to your application. There’s a utility that ships in RealDWG’s Utils folder – bindmgd – which does just that:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px">bindmgd -b &lt;YourApp&gt;.exe client.snk</p> </div>  <p>Now our application should run. All being well, when we select the DWG file we created earlier, we should now see the grid populated with data extracted from the 3D solids contained within it:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=359,height=457,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/10/22/3d_solids_realdwg_app.png"><img title="3d_solids_realdwg_app" border="0" alt="3d_solids_realdwg_app" src="/assets/3d_solids_realdwg_app.png" width="300" height="381" /></a> </p>  <p><em>Figure 6 - our RealDWG application accessing the 3D solid data</em></p>
