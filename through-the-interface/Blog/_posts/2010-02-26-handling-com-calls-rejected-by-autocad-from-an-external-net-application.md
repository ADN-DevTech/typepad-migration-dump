---
layout: "post"
title: "Handling COM calls rejected by AutoCAD from an external .NET application"
date: "2010-02-26 11:39:54"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Visual Basic &amp; VBA"
original_url: "https://www.keanw.com/2010/02/handling-com-calls-rejected-by-autocad-from-an-external-net-application.html "
typepad_basename: "handling-com-calls-rejected-by-autocad-from-an-external-net-application"
typepad_status: "Publish"
---

<p>We’ve had a few reports from people implementing external .NET applications to drive AutoCAD – as shown in <a href="http://through-the-interface.typepad.com/through_the_interface/2009/05/interfacing-an-external-com-application-with-a-net-module-in-process-to-autocad-redux.html">this previous post</a> – experiencing intermittent failures once AutoCAD 2010 Update 1 has been applied. Here’s a typical error message:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201310f3db3a6970c-pi"><img alt="Exception after installing AutoCAD 2010 Update 1" border="0" height="140" src="/assets/image_735708.jpg" style="border-right-width: 0px; margin: 20px auto; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Exception after installing AutoCAD 2010 Update 1" width="399" /></a> </p>  <p>It contains the text “Problem executing component: Call was rejected by callee. (Exception from HRESULT: 0x80010001 (RPC_E_CALL_REJECTED))” (to help people Googling this error message :-).</p>  <p>This “problem” was introduced as we addressed an issue with the way our WPF components in AutoCAD handle inbound messages, largely due to Microsoft’s decision <a href="http://blogs.msdn.com/nickkramer/archive/2006/05/06/591252.aspx">not to support nested message loops in WPF</a>. If WPF is in the middle of performing some kind of <a href="http://msdn.microsoft.com/en-us/library/ms745058.aspx">layout</a> processing operation (which leads to <a href="http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.disableprocessing.aspx">Dispatcher.DisableProcessing()</a> being called) and there’s an incoming COM call, then we were previously respecting it which could lead to a crash. Now we do the right thing and reject the COM call: effectively asking the caller to try again later.</p>  <p>The problem is that – while the VB6 runtime was very good at automatically retrying calls such as CreateObject() – WinForm applications are not. We need to implement <a href="http://msdn.microsoft.com/en-us/library/ms693740(VS.85).aspx">an additional interface</a> from our WinForm application to make sure it can handle failure (I could probably do with adding that one myself ;-).</p>  <p>As it’s hopefully clear: while the problem is likely to be more visible in AutoCAD 2010 once Update 1 has been applied, this is ultimately about correctly inappropriate expectations on the side of the calling application and teaching it to do the right thing.</p>  <p>Here’s the updated C# code from the previous post, with the changed lines in <font color="#ff0000">red</font>, and here’s <span class="asset asset-generic at-xid-6a00d83452464869e201310f3db5e7970c"><a href="http://through-the-interface.typepad.com/files/drivingautocad.zip">the source project</a></span>.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 1</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Interop;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 2</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Windows.Forms;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 3</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Runtime.InteropServices;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 4</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Reflection;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 5</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 6</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> LoadableComponent;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 7</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160;&#0160; 8</span>&#0160;<span style="line-height: 140%; color: green">// For more information on IMessageFilter:</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160;&#0160; 9</span>&#0160;<span style="line-height: 140%; color: green">// http://msdn.microsoft.com/en-us/library/ms693740(VS.85).aspx</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 10</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 11</span>&#0160;<span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> DrivingAutoCAD</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 12</span>&#0160;<span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 13</span>&#0160;<span style="line-height: 140%">&#0160; [</span><span style="line-height: 140%; color: #2b91af">ComImport</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 14</span>&#0160;<span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">InterfaceType</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">ComInterfaceType</span><span style="line-height: 140%">.InterfaceIsIUnknown),</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 15</span>&#0160;<span style="line-height: 140%">&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Guid</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;00000016-0000-0000-C000-000000000046&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 16</span>&#0160;<span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">interface</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 17</span>&#0160;<span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 18</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">PreserveSig</span><span style="line-height: 140%">]</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 19</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> HandleInComingCall(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 20</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwCallType, </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCaller,</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 21</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> lpInterfaceInfo</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 22</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 23</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">PreserveSig</span><span style="line-height: 140%">]</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 24</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> RetryRejectedCall(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 25</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCallee, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwRejectType</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 26</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 27</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">PreserveSig</span><span style="line-height: 140%">]</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 28</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> MessagePending(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 29</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCallee, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwPendingType</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 30</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 31</span>&#0160;<span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 32</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 33</span>&#0160;<span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">partial</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Form1</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">Form</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 34</span>&#0160;<span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 35</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">DllImport</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;ole32.dll&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 36</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">extern</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> CoRegisterMessageFilter(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 37</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%"> lpMessageFilter,</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 38</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">out</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%"> lplpMessageFilter</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 39</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 40</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 41</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> Form1()</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 42</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 43</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; InitializeComponent();</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 44</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%"> oldFilter;</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 45</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; CoRegisterMessageFilter(</span><span style="line-height: 140%; color: blue">this</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: blue">out</span><span style="line-height: 140%"> oldFilter);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 46</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 47</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 48</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> button1_Click(</span><span style="line-height: 140%; color: blue">object</span><span style="line-height: 140%"> sender, </span><span style="line-height: 140%; color: #2b91af">EventArgs</span><span style="line-height: 140%"> e)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 49</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 50</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">const</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> progID = </span><span style="line-height: 140%; color: #a31515">&quot;AutoCAD.Application.18&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 51</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 52</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">AcadApplication</span><span style="line-height: 140%"> acApp = </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 53</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">try</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 54</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 55</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; acApp =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 56</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">AcadApplication</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">Marshal</span><span style="line-height: 140%">.GetActiveObject(progID);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 57</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 58</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">catch</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 59</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 60</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">try</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 61</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 62</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Type</span><span style="line-height: 140%"> acType =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 63</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Type</span><span style="line-height: 140%">.GetTypeFromProgID(progID);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 64</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; acApp =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 65</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">AcadApplication</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">Activator</span><span style="line-height: 140%">.CreateInstance(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 66</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; acType,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 67</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">true</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 68</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 69</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 70</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">catch</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 71</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 72</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">MessageBox</span><span style="line-height: 140%">.Show(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 73</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;Cannot create object of type \&quot;&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 74</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; progID + </span><span style="line-height: 140%; color: #a31515">&quot;\&quot;&quot;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 75</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 76</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 77</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 78</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (acApp != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 79</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 80</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">try</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 81</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 82</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// By the time this is reached AutoCAD is fully</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 83</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// functional and can be interacted with through code</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 84</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 85</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; acApp.Visible = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 86</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 87</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; INumberAddition app =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 88</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (INumberAddition)acApp.GetInterfaceObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 89</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;LoadableComponent.Commands&quot;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 90</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 91</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 92</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Now let&#39;s call our method</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 93</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 94</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> res = app.AddNumbers(5, 6.3);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 95</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 96</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; acApp.ZoomAll();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 97</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 98</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">MessageBox</span><span style="line-height: 140%">.Show(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 99</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">this</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 100</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;AddNumbers returned: &quot;</span><span style="line-height: 140%"> + res</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 101</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 102</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 103</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">catch</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">Exception</span><span style="line-height: 140%"> ex)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 104</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 105</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">MessageBox</span><span style="line-height: 140%">.Show(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 106</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">this</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 107</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;Problem executing component: &quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 108</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ex.Message</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 109</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 110</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 111</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 112</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 113</span>&#0160;<span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; #region</span><span style="line-height: 140%"> IMessageFilter Members</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 114</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160; 115</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%">.HandleInComingCall(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 116</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwCallType, </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCaller,</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 117</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> lpInterfaceInfo</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 118</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 119</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 120</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 0; </span><span style="line-height: 140%; color: green">// SERVERCALL_ISHANDLED</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 121</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 122</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160; 123</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%">.RetryRejectedCall(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 124</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCallee, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwRejectType</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 125</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 126</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 127</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 1000; </span><span style="line-height: 140%; color: green">// Retry in a second</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 128</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 129</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160; 130</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">IMessageFilter</span><span style="line-height: 140%">.MessagePending(</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 131</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">IntPtr</span><span style="line-height: 140%"> hTaskCallee, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwTickCount, </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> dwPendingType</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 132</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 133</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 134</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> 1; </span><span style="line-height: 140%; color: green">// PENDINGMSG_WAITNOPROCESS</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 135</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 136</span>&#0160;</p>    <p style="margin: 0px"><span style="color: red">&#0160; 137</span>&#0160;<span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; #endregion</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 138</span>&#0160;<span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 139</span>&#0160;<span style="line-height: 140%">}</span></p> </div>   <p>There’s nothing really to see, in terms of modified behaviour, other than that you should no longer experience the crash.</p>
