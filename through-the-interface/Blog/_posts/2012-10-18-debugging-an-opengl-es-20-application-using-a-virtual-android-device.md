---
layout: "post"
title: "Debugging an OpenGL ES 2.0 application using a virtual Android device"
date: "2012-10-18 21:07:39"
author: "Kean Walmsley"
categories:
  - "Android"
  - "AU"
  - "Mobile"
  - "SaaS"
original_url: "https://www.keanw.com/2012/10/debugging-an-opengl-es-20-application-using-a-virtual-android-device.html "
typepad_basename: "debugging-an-opengl-es-20-application-using-a-virtual-android-device"
typepad_status: "Publish"
---

<p>With my AUv recording out of the way, I’ve been starting to think more seriously about <a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/registration-open-for-au-2012.html" target="_blank">my AU sessions</a>, over the last few days. The “big one” (with 100+ registered attendees and counting) is about moving code from a desktop application to the cloud, and will basically summarise the process I followed in <a href="http://through-the-interface.typepad.com/through_the_interface/2012/06/cloud-mobile-series-summary.html" target="_blank">my “cloud &amp; mobile” series of earlier in the year</a>. Which means I’ll go through the process of pulling some code out of a desktop-based application and placing it behind a web-service, before calling the service from a variety of platforms/environments (AutoCAD via .NET, iOS, Android, WinRT, Unity 3D and WebGL).</p>  <p>Pretty much all of these should be easily demoable during the session, but I was a bit concerned about the Android piece: until now I’ve only been able to execute <a href="http://through-the-interface.typepad.com/through_the_interface/2012/05/creating-a-3d-viewer-for-our-apollonian-service-using-android-part-3.html" target="_blank">the Android version of my Apollonian Viewer application</a> on my Kindle Fire device, which doesn’t have an easy way of connecting to a projector. So I set out with the intention of getting the app working on my desktop (whether inside Windows or OS X), so that I wouldn’t even have to worry about cables or connectivity issues.</p>  <p>There were two main routes open to me for this. The first (which I should probably point out <em><u>didn’t work for my particular situation</u></em>, before anyone starts trying it without reading to the end) was presented <a href="http://adndevblog.typepad.com/cloud_and_mobile/2012/06/android.html" target="_blank">by Philippe Leefsma, over on ADN’s Cloud &amp; Mobile DevBlog</a>: to install a Virtual Machine based on <a href="http://www.android-x86.org/" target="_blank">Android-x86</a>, a x86 port of the Android OS. It took my a while to track down a usable “generic” ISO image: they seem not to have posted one for the latest version, 4.0-RC2 – all the versions posted for download are targeting specific hardware configurations – so I ended up having to take a chance on an unstable nightly build posted <a href="http://mariuz.android-dev.ro" target="_blank">here</a>.</p>  <p>Following the steps Philippe suggested, I managed to get a new Android VM sitting alongside the ones I have for Windows 7 &amp; 8 on my Parallels Desktop installation on OS X:<a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3ccdf205970c-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="My Parallels Machine List" border="0" alt="My Parallels Machine List" src="/assets/image_357315.jpg" width="390" height="249" /></a></p>  <p>When launched, it started a fancy new Android session directly on my desktop:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c329f6814970b-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="A Parallels VM running Android" border="0" alt="A Parallels VM running Android" src="/assets/image_673351.jpg" width="470" height="394" /></a></p>  <p>Running netcfg inside a terminal window on the device told me its IP address, which I could then use to connect to it via <a href="http://developer.android.com/tools/help/adb.html" target="_blank">adb</a>. From there it was straightforward to debug on the device, connecting to it from my project in Eclipse. This also installed the app, so that can we can also see it in our list when not debugging:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017ee4434869970d-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Applications inside Android includes the Apollonian Viewer" border="0" alt="Applications inside Android includes the Apollonian Viewer" src="/assets/image_114514.jpg" width="470" height="394" /></a>Launching it, though, leads to a crash:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017ee443489e970d-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="And the crash" border="0" alt="And the crash" src="/assets/image_525480.jpg" width="470" height="394" /></a></p>  <p>The reason it didn’t work – and I half knew this, but wanted to go through the process of setting this up, anyway – was that OpenGL ES 2.0 is not supported by Android-x86, at least not right now.</p>  <p>Which left the second option… to get the Android emulator to run OpenGL ES 2.0. The good news is that since earlier this year <a href="http://www.learnopengles.com/android-emulator-now-supports-native-opengl-es2-0" target="_blank">this has been possible</a>, it seems. It was a bit fiddly to set up – <a href="http://www.korri.net/blog/2012/4/12-how-to-enable-gpu-acceleration-in-android-emulator.html" target="_blank">this page helped a lot</a> – but it took me some time to actually get a GPU-enabled emulator instance running OpenGL ES 2.0.</p>  <p>Here are the settings I used – I found I couldn’t set the “GPU emulation” hardware setting on an existing emulator, for some reason, but creating a new virtual device solved that:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c329f68a8970b-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="The virtual device settings" border="0" alt="The virtual device settings" src="/assets/image_900977.jpg" width="460" height="486" /></a></p>  <p>One of the major issues was that even if it’s possible to get the emulator set as GPU-enabled the emulator reports itself as not supporting OpenGL ES 2.0. So in your code you need to find a way to suppress the standard check again this property when you’re testing with an emulator.</p>  <p>Thankfully Rajawali, the 3D framework I’m using for my application, <a href="https://github.com/MasDennis/Rajawali/pull/84" target="_blank">added this capability some time ago</a>. It was a simple matter to change the application to set the protected checkOpenGLVersion boolean to false, which allowed the application to execute and me to find the remaining issues to fix (which basically comprised the fact that for performance reasons 3D primitives – such as Spheres, the only one my application creates – no longer have a default material attached, so we have to create one).</p>  <p>And so I could run the application inside an OpenGL ES 2.0-capable emulator. Yay!</p>  <p>Here’s the base environment:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017ee4434905970d-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="The emulator" border="0" alt="The emulator" src="/assets/image_222599.jpg" width="460" height="305" /></a></p>  <p>Here are the applications:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017ee443493f970d-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="The applications" border="0" alt="The applications" src="/assets/image_308961.jpg" width="460" height="305" /></a></p>  <p>And here are the launch screens for the Apollonian Viewer:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3ccdf353970c-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="Accessing the web-service" border="0" alt="Accessing the web-service" src="/assets/image_288647.jpg" width="460" height="305" /></a></p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3ccdf365970c-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="Creating the spheres" border="0" alt="Creating the spheres" src="/assets/image_934673.jpg" width="460" height="305" /></a></p>  <p>And finally we see our spheres, even if the lighting looks like it needs some adjustment:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c329f699b970b-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px auto 20px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="The viewer in action" border="0" alt="The viewer in action" src="/assets/image_244787.jpg" width="460" height="305" /></a></p>  <p>Now that I have at least the basics working, I’ll probably get back to working on the core material. At some point I may take the time to see what’s up with the lighting – perhaps my lights need adjustment or I’m using the wrong material – but for now I’m just happy to see the app working inside an emulator.</p>
