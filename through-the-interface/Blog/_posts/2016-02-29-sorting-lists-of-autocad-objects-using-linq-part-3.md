---
layout: "post"
title: "Sorting lists of AutoCAD objects using LINQ &ndash; Part 3"
date: "2016-02-29 16:00:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "LINQ"
  - "Object properties"
  - "Selection"
original_url: "https://www.keanw.com/2016/02/sorting-lists-of-autocad-objects-using-linq-part-3.html "
typepad_basename: "sorting-lists-of-autocad-objects-using-linq-part-3"
typepad_status: "Publish"
---

<p>After seeing <a href="http://through-the-interface.typepad.com/through_the_interface/2016/02/sorting-lists-of-autocad-objects-using-linq-part-1.html" target="_blank">a basic approach to sort arrays of ObjectIds using LINQ</a> – and then <a href="http://through-the-interface.typepad.com/through_the_interface/2016/02/sorting-lists-of-autocad-objects-using-linq-part-2.html" target="_blank">refactoring that to be a shared extension method to be used on arrays of ObjectIds</a> – today we’re going to see that code refactored, once again, to work with types of data other than strings (up until now we could only sort objects based on string properties such as class and layer names).</p> <p>One solid approach for creating operations that can deal with different types of object – while maintaining type safety – is to use template classes, which are known as <a href="https://msdn.microsoft.com/en-us/library/sz6zd40f.aspx" target="_blank">generic classes in C#</a>. I should probably have been calling these “generics” since the beginning of this series, but unfortunately my time with C++ has left the term “templates” somewhat ingrained. For the sake of this series of posts, please consider the terms <em>template</em> and <em>generic</em> to be interchangeable, even if it seems there are <a href="https://msdn.microsoft.com/en-us/library/c6cyy67b.aspx" target="_blank">some differences between the two language implementations</a>.</p> <p>In case you’re not already familiar with generics, you use them every time you create a generic collection – such as a List&lt;&gt; or a Dictionary&lt;&gt; – to manage objects of a particular type. In today’s code we’re going to define our own static template class with a static template method. Both class and method can be static as we don’t need to store any per-instance data with instances of our generic class.</p> <p>Which also means we don’t even need to instanciate our class: we can just refer to the type and call the static method from that.</p> <p>Here’s the updated C# code:</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.ApplicationServices;</p> <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.DatabaseServices;</p> <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.EditorInput;</p> <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p> <p style="margin: 0px"><span style="color: blue">using</span> System;</p> <p style="margin: 0px"><span style="color: blue">using</span> System.Collections.Generic;</p> <p style="margin: 0px"><span style="color: blue">using</span> System.Linq;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px"><span style="color: blue">namespace</span> ProcessObjectsInOrder</p> <p style="margin: 0px">{</p> <p style="margin: 0px">&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">Extensions</span></p> <p style="margin: 0px">&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;summary&gt;</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span><span style="color: green"> Sorts an array of ObjectIds based on a string property and order.</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;/summary&gt;</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;param name=&quot;ids&quot;&gt;</span><span style="color: green">The array of IDs to sort.</span><span style="color: gray">&lt;/param&gt;</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;param name=&quot;propertySelector&quot;&gt;</span><span style="color: green">A function selecting the string property.</span><span style="color: gray">&lt;/param&gt;</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;param name=&quot;orderSelector&quot;&gt;</span><span style="color: green">A function to specify the selection order.</span><span style="color: gray">&lt;/param&gt;</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: gray">///</span> <span style="color: gray">&lt;returns&gt;</span><span style="color: green">An ordered enumerable of key-value pairs.</span><span style="color: gray">&lt;/returns&gt;</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">KeyValuePair</span>&lt;<span style="color: #2b91af">ObjectId</span>, <span style="color: blue">string</span>&gt;&gt;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">this</span> <span style="color: #2b91af">ObjectId</span>[] ids,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">Func</span>&lt;<span style="color: blue">dynamic</span>, <span style="color: blue">string</span>&gt; propertySelector,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">Func</span>&lt;<span style="color: #2b91af">KeyValuePair</span>&lt;<span style="color: #2b91af">ObjectId</span>, <span style="color: blue">string</span>&gt;, <span style="color: blue">string</span>&gt; orderSelector</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; )</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> map = <span style="color: blue">new</span> <span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">ObjectId</span>, <span style="color: blue">string</span>&gt;();</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">dynamic</span> id <span style="color: blue">in</span> ids)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; map.Add(id, propertySelector(id));</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span> map.OrderBy(orderSelector).ToList();</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">ObjectSorter</span>&lt;T&gt;</p> <p style="margin: 0px">&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">KeyValuePair</span>&lt;<span style="color: #2b91af">ObjectId</span>, T&gt;&gt;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">ObjectId</span>[] ids,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">Func</span>&lt;<span style="color: blue">dynamic</span>, T&gt; propertySelector,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">Func</span>&lt;<span style="color: #2b91af">KeyValuePair</span>&lt;<span style="color: #2b91af">ObjectId</span>, T&gt;, T&gt; orderSelector</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; )</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> map = <span style="color: blue">new</span> <span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">ObjectId</span>, T&gt;();</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">dynamic</span> id <span style="color: blue">in</span> ids)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; map.Add(id, propertySelector(id));</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span> map.OrderBy(orderSelector).ToList();</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Commands</span></p> <p style="margin: 0px">&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBL&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByLayer()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// We&#39;ll sort them based on a string value (the layer name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> map = <span style="color: blue">new</span> <span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">ObjectId</span>, <span style="color: blue">string</span>&gt;();</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">dynamic</span> id <span style="color: blue">in</span> psr.Value.GetObjectIds())</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; map.Add(id, id.Layer);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted = map.OrderBy(kv =&gt; kv.Value);</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} on layer {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBT&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByType()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a string value (the class name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> map = <span style="color: blue">new</span> <span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">ObjectId</span>, <span style="color: blue">string</span>&gt;();</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">dynamic</span> id <span style="color: blue">in</span> psr.Value.GetObjectIds())</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; map.Add(id, id.ObjectClass.Name);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted = map.OrderBy(kv =&gt; kv.Value);</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} of type {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBL2&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByLayer2()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a string value (the layer name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted = psr.Value.GetObjectIds().Sort(id =&gt; id.Layer, kv =&gt; kv.Value);</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} on layer {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBT2&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByType2()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a string value (the class name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted =</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value.GetObjectIds().Sort(id =&gt; id.ObjectClass.Name, kv =&gt; kv.Value);</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} of type {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBL3&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByLayer3()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a string value (the layer name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted =</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">ObjectSorter</span>&lt;<span style="color: blue">string</span>&gt;.Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value.GetObjectIds(),</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id =&gt; id.Layer,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; kv =&gt; kv.Value</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} on layer {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBT3&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByType3()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a string value (the class name)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted =</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">ObjectSorter</span>&lt;<span style="color: blue">string</span>&gt;.Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value.GetObjectIds(),</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id =&gt; id.ObjectClass.Name,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; kv =&gt; kv.Value</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} of type {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBC&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByColor()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on a short value (the layer&#39;s color index)</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted =</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">ObjectSorter</span>&lt;<span style="color: blue">short</span>&gt;.Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value.GetObjectIds(),</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id =&gt; id.LayerId.Color.ColorIndex,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; kv =&gt; kv.Value</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} on layer of color {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;OBC2&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.UsePickSet)]</p> <p style="margin: 0px">&#0160;&#0160;&#0160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ObjectsByColor2()</p> <p style="margin: 0px">&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> ed = doc.Editor;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Select the objects to sort</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> psr = ed.GetSelection();</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">if</span> (psr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Sort them based on an integer value (the layer&#39;s color index)</span></p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Needs to be an integer as it&#39;s signed: we&#39;re going in reverse order</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">var</span> sorted =</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #2b91af">ObjectSorter</span>&lt;<span style="color: blue">int</span>&gt;.Sort(</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; psr.Value.GetObjectIds(),</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id =&gt; id.LayerId.Color.ColorIndex,</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; kv =&gt; -kv.Value</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: green">// Print them in order to the command-line</span></p> <p style="margin: 0px">&#0160;</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> item <span style="color: blue">in</span> sorted)</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; {</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(<span style="color: #a31515">&quot;\nObject {0} on layer of color {1}&quot;</span>, item.Key, item.Value);</p> <p style="margin: 0px">&#0160;&#0160;&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160;&#0160;&#0160; }</p> <p style="margin: 0px">&#0160; }</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&#0160;</p></div> <p>The main additions – other than new versions of the OBL and OBT commands called OBL3 and OBT3 – are a couple of commands to sort objects by their layer’s color index. The first, OBC, uses the short data type to sort the list in ascending order. The second, OBC2, uses an integer instead – as this is a signed data type – so we can use our orderSelector argument to reverse the order and list them in descending order.</p> <p>Here are the OBC and OBC2 commands in action:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201bb08c06f82970d-pi"><img alt="Sort objects by property - template class" height="479" src="/assets/image_443862.jpg" style="float: none; margin: 30px auto; display: block" title="Sort objects by property - template class" width="500" /></a></p> <p>That’s it for this short series on sorting objects using LINQ and AutoCAD’s dynamic .NET implementation. If you have suggestions on how to extend this implementation in interesting ways – or to create a separate series of posts – please do post a comment.</p>
