---
layout: "post"
title: "Printing your own money with AutoCAD"
date: "2013-04-12 08:46:07"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "DesignScript"
  - "F#"
  - "Geometry"
original_url: "https://www.keanw.com/2013/04/printing-your-own-money-with-autocad.html "
typepad_basename: "printing-your-own-money-with-autocad"
typepad_status: "Publish"
---

<p>Here’s a fun one to finish up the week. And no, it isn’t a belated April Fool’s gag. ;-) I should probably say right away that you won’t be printing money after reading this blog post, but you might know more about some of the security measures used by those who do.</p>  <p>A couple of weeks ago, I received an email from Doug Bell at <a href="http://www.papermoneyworld.net/" target="_blank">PaperMoneyWorld.net</a>:</p>  <blockquote>   <p><em>I have tried your Spiro for AutoCAD and I enjoy it very much. I would like to challenge you to another function I would like to see that is related to the spirograph. I’d like to see what is called a geometric lathe. I have seen this for a Mac but it doesn't convert to any type of AutoCAD format. </em><a href="http://ministryoftype.co.uk/words/article/guilloches" target="_blank"><em>Here is a link</em></a><em> that will give you more info on it. Thank you.</em></p> </blockquote>  <p>And with that, Doug introduced me to the fascinating world of <a href="http://en.wikipedia.org/wiki/Guilloch%C3%A9" target="_blank">guilloché</a> and <a href="http://en.wikipedia.org/wiki/Security_printing" target="_blank">its use in preventing counterfeiting</a>. (Doug’s interest was due to <a href="http://through-the-interface.typepad.com/through_the_interface/2009/11/turning-autocad-into-a-spirograph-using-f.html" target="_blank">some</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2010/03/using-a-jig-from-f-to-create-spirographs-patterns-in-autocad.html" target="_blank">posts</a> I’d written on creating Spirograph-like patterns using AutoCAD, which culminated in the <a href="http://through-the-interface.typepad.com/through_the_interface/2010/05/mays-plugin-of-the-month-spiro-for-autocad.html" target="_blank">Spiro Plugin of the Month</a> and <a href="http://apps.exchange.autodesk.com/ACD/Detail/Index?id=appstore.exchange.autodesk.com%3aSpiro%3aen" target="_blank">Autodesk Exchange app</a>.)</p>  <p>Before going further with this, I did check in with Doug to make sure I wasn’t becoming an unwitting accomplice in an illegal operation to forge banknotes. Sure enough, Doug confirmed it was related to his hobby (although in this case it seems “passion” is a better description) of collecting military money and creating currency to be used at the festivals he attends with fellow enthusiasts. Doug intends to use a plotted guilloché background to make his own currency more authentic.</p>  <p>That was good enough for me (although it meant I was doing it for fun rather than a suitcase of dodgy dollar bills ;-).</p>  <p>The good news is that the typical guilloché pattern used in security printing is indeed very close to those generated by a Spirograph, both are <a href="http://en.wikipedia.org/wiki/Hypotrochoid" target="_blank">hypotrochoids</a>. And as the basic mathematical formula – for at least one family of guilloché – was provided in <a href="http://ministryoftype.co.uk/words/article/guilloches/" target="_blank">Aegir Hallmundr’s excellent blog post</a> (which Doug had sent through in his email), it was pretty easy to modify the existing F# code to create them.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d42bb962c970c-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="Output of a geometric lathe inside AutoCAD" border="0" alt="Output of a geometric lathe inside AutoCAD" src="/assets/image_539228.jpg" width="404" height="260" /></a></p>  <p>I did make a few changes to the approach, this time around: rather than creating a jig, I opted for prompting the user via the command-line (and not even updating&#160; the defaults to reflect the previous choices). I also decided to create a Spline rather than a Polyline, as that would reduce the size (on disk) of the resulting geometry and lead to a smoother fit (as the intention is actually to plot these, after all).</p>  <p>Here’s the F# code. It’ll be straightforward to convert to C#, in case (let me know if anyone has an interest in a C# version and I’ll crank one out):</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">module</span><span style="line-height: 140%"> Guillocher.Commands</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices.Core</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// User prompting helper functions</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> getIntegerWithDefault (ed : Editor) msg min max def =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pio = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> PromptIntegerOptions(msg)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pio.LowerLimit &lt;- min</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pio.UpperLimit &lt;- max</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pio.DefaultValue &lt;- def</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pio.UseDefaultValue &lt;- </span><span style="line-height: 140%; color: blue">true</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pir = ed.GetInteger(pio)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> pir.Status = PromptStatus.OK </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Some(pir.Value)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; None</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> getDoubleWithDefault (ed : Editor) msg neg zero def =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pdo = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> PromptDoubleOptions(msg)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pdo.AllowNegative &lt;- neg</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pdo.AllowZero &lt;- zero</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pdo.DefaultValue &lt;- def</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; pdo.UseDefaultValue &lt;- </span><span style="line-height: 140%; color: blue">true</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pdr = ed.GetDouble(pdo)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> pdr.Status = PromptStatus.OK </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Some(pdr.Value)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; None</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">// Get the various values we need from the user for this command</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> getGuillocheInput ed =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> R = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\nR&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> 50.0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> R = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> r = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\nr&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> -0.2</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> r = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> p = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\np&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> 25.0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> p = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> Q = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\nQ&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> 3.0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> Q = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> m = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\nm&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> 1.0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> m = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> n = getDoubleWithDefault ed </span><span style="line-height: 140%; color: maroon">&quot;\nn&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> 6.0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> n = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> segs =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; getIntegerWithDefault</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed </span><span style="line-height: 140%; color: maroon">&quot;\nNumber of control points&quot;</span><span style="line-height: 140%"> 500 32767 3000</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> segs = None </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> ppr = ed.GetPoint(</span><span style="line-height: 140%; color: maroon">&quot;\nSelect center point&quot;</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> ppr.Status = PromptStatus.OK </span><span style="line-height: 140%; color: blue">then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Some(R, r, p, Q, m, n, segs, ppr.Value)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; None</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pointsOnGuilloche R r p Q m n segs =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; [|</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> period = Math.PI * 2.0;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">for</span><span style="line-height: 140%"> theta </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> 0.0..period/(float segs)..period </span><span style="line-height: 140%; color: blue">do</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> rr = R + r</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> rp = r + p</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> rror = rr / r</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> mth = m * theta</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> nth = n * theta</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> k = rror * mth</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> x =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; rr * Math.Cos(mth) + rp * Math.Cos(k) + Q * Math.Cos(nth)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> y =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; rr * Math.Sin(mth) - rp * Math.Sin(k) + Q * Math.Sin(nth)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">yield</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Point3d(x, y, 0.0)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; |]</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">[&lt;CommandMethod(</span><span style="line-height: 140%; color: maroon">&quot;GUILLOCHE&quot;</span><span style="line-height: 140%">)&gt;]</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> guilloche() =</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// Let's get the usual helpful AutoCAD objects</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> doc =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Application.DocumentManager.MdiActiveDocument</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> ed = doc.Editor</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> db = doc.Database</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// First we need some user input</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">match</span><span style="line-height: 140%"> getGuillocheInput ed </span><span style="line-height: 140%; color: blue">with</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; | None </span><span style="line-height: 140%; color: blue">-&gt;</span><span style="line-height: 140%"> ()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; | Some(R, r, p, Q, m, n, segs, cen) </span><span style="line-height: 140%; color: blue">-&gt;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Next we get a sampling of points along the Guilloche geometry</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> pts =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; pointsOnGuilloche</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; R.Value r.Value p.Value Q.Value m.Value n.Value segs.Value</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Use the points as control points on a spline</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> sp = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Spline(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Point3dCollection(pts), 1, 0.0)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Move the geometry to the selected point</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; sp.TransformBy(Matrix3d.Displacement(cen.GetAsVector()))</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Use a transaction to add our polyline to the model-space</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">use</span><span style="line-height: 140%"> tr = db.TransactionManager.StartTransaction()</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Get appropriately-typed BlockTableRecord</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> btr =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; tr.GetObject(db.CurrentSpaceId, OpenMode.ForWrite)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; :?&gt; BlockTableRecord</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Add our curve to the model-space</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> id = btr.AppendEntity(sp)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(sp, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Commit the transaction</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; tr.Commit()</span></p> </div>  <p>For further fun, I went ahead and created an equivalent version in DesignScript, for anyone using that (there’s <a href="http://labs.blogs.com/its_alive_in_the_lab/2013/03/updated-designscript-available-via-autodesk-labs.html" target="_blank">an updated version</a> of <a href="http://labs.autodesk.com/utilities/designscript" target="_blank">the tech preview on Labs</a>, still AutoCAD 2013-based).</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%"><font color="#0000ff">import</font>(</span><span style="line-height: 140%; color: maroon">&quot;ProtoGeometry.dll&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#0000ff">import</font>(</span><span style="line-height: 140%; color: maroon">&quot;Math.dll&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">R = <span style="color: maroon">50</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">r = <span style="color: maroon">-0.2</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">p = <span style="color: maroon">25</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">Q = <span style="color: maroon">3</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">m = <span style="color: maroon">1</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">n = <span style="color: maroon">6</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">segs = 3<span style="color: maroon">000</span>;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">theta = <span style="color: maroon">0</span>..<span style="color: maroon">360</span>..<span style="color: maroon">360</span>/segs;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#0000ff">def</font> guilloche(th)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; rr = R + r;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; rp = r + p;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; rror = rr / r;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; mth = m * th;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; nth = n * th;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; k = rror * mth;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; x = rr * Math.Cos(mth) + rp * Math.Cos(k) + Q * Math.Cos(nth);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; y = rr * Math.Sin(mth) - rp * Math.Sin(k) + Q * Math.Sin(nth);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pt = Point.ByCoordinates(x, y, <span style="color: maroon">0</span>);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> = pt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">spline = BSplineCurve.ByPoints(guilloche(theta));</span></p> </div>  <p>Here it is inside the DesignScript editor:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017eea2fd14a970d-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Guilloche created by DesignScript" border="0" alt="Guilloche created by DesignScript" src="/assets/image_174020.jpg" width="474" height="270" /></a></p>  <p>So that’s about it – in case you’re interested, here’s <a href="http://through-the-interface.typepad.com/files/Guilloche.dwg" target="_blank">the resultant DWG with this particular pattern</a> (the one created via the F# code using the default arguments).</p>
