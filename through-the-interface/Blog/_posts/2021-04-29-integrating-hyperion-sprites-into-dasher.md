---
layout: "post"
title: "Integrating Hyperion sprites into Dasher"
date: "2021-04-29 09:23:16"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "AU"
  - "Autodesk Research"
  - "IoT"
original_url: "https://www.keanw.com/2021/04/integrating-hyperion-sprites-into-dasher.html "
typepad_basename: "integrating-hyperion-sprites-into-dasher"
typepad_status: "Publish"
---

<p>As <a href="https://www.keanw.com/2021/04/my-au-2021-class-proposal-on-integrating-hyperion-with-dasher.html" target="_blank">mentioned on Monday</a>, I’ve been having lots of fun getting Hyperion to work inside Dasher, this week. All good preparation for <a href="https://www.autodesk.com/autodesk-university/conference/proposal/Dasher-and-Hyperion-using-Data-Visualization-Forge-viewer-application" target="_blank">the AU class I hope will be accepted for this year’s conference</a>.</p><p>Right now I have sprites working, which is an important first step (and doesn’t actually involve any of the more gnarly, data-related issues I expect to have when w tackle surface shading/heatmaps). In this post we’re going to step through the main steps taken to make this happen, but also to describe some of the important changes that were needed to make it all work well.</p><p>Dasher’s codebase contains primarily TypeScript, which means that it’s ideal – for API discoverability and for increased code quality – to have type definitions for any new platform capabilities. Inside Dasher we had our own set of types for both the Forge viewer and THREE.js. When I asked about the Data Visualization types, I was pointed to <a href="https://www.npmjs.com/package/@types/forge-viewer" target="_blank">this NPM package</a> which is built from <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/forge-viewer" target="_blank">this Definitely Typed repo</a>. I’d been aware of this work – and had even supported it with some code – in the past, but hadn’t quite gotten around to integrating it into Dasher. This was the push that I needed.</p><p>The types themselves were well structured and reasonably complete, but Dasher makes really heavy use of the Forge viewer and THREE.js, so there were still several gaps in the current implementation. I ended up <a href="https://github.com/KeanW/DefinitelyTyped/tree/dasher-types" target="_blank">forking the repo</a> and submitting <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/52614" target="_blank">my changes as a pull request</a>. Many thanks to Jan Liska for helping me through that process promptly. I’m looking forward to integrating the next version of the @types/forge-viewer package into Dasher!</p><p>So now we have functioning DataViz types inside Dasher, and have scratched the longstanding itch caused by having non-standard type definitions in the codebase. All goodness. Here’s the section of these DataVisualization namespace that’s relevant to the use of sprites:</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(86, 156, 214);">namespace</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">DataVisualization</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">namespace</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">Core</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(79, 193, 255);">MOUSE_CLICK</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(206, 145, 120);">'DATAVIZ_OBJECT_CLICK'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(79, 193, 255);">MOUSE_CLICK_OUT</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(206, 145, 120);">'DATAVIZ_CLICK_OUT'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(79, 193, 255);">MOUSE_HOVERING</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(206, 145, 120);">'DATAVIZ_OBJECT_HOVERING'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">enum</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">ViewableType</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(79, 193, 255);">SPRITE</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(181, 206, 168);">1</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(79, 193, 255);">GEOMETRY</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(181, 206, 168);">2</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">class</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">CustomViewable</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">constructor</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">position</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Vector3</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">style</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">ViewableStyle</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">dbId</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">number</span><span style="color: rgb(212, 212, 212);">);</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">dbId</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">number</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">position</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Vector3</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">style</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">ViewableStyle</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">class</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">SpriteViewable</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(86, 156, 214);">extends</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">CustomViewable</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">color</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">highlightedColor</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">type</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">ViewableType</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">class</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">ViewableData</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">spriteSize</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">number</span><span style="color: rgb(212, 212, 212);">;</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">constructor</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">options</span><span style="color: rgb(212, 212, 212);">?: { </span><span style="color: rgb(156, 220, 254);">atlasWidth</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">number</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">atlasHeight</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">number</span><span style="color: rgb(212, 212, 212);"> });</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">spriteAtlas</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">any</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">viewables</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">CustomViewable</span><span style="color: rgb(212, 212, 212);">[];</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(220, 220, 170);">addViewable</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">viewable</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">CustomViewable</span><span style="color: rgb(212, 212, 212);">): </span><span style="color: rgb(78, 201, 176);">void</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(220, 220, 170);">getViewableColor</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">dbId</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">highlighted</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">boolean</span><span style="color: rgb(212, 212, 212);">): </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(220, 220, 170);">getViewableUV</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">dbId</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">highlighted</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">boolean</span><span style="color: rgb(212, 212, 212);">): </span><span style="color: rgb(78, 201, 176);">object</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(220, 220, 170);">finish</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">Promise</span><span style="color: rgb(212, 212, 212);">&lt;</span><span style="color: rgb(78, 201, 176);">void</span><span style="color: rgb(212, 212, 212);">&gt;;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">class</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(78, 201, 176);">ViewableStyle</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">color</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">highlightedColor</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">highlightedUrl</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">spriteUrls</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">Set</span><span style="color: rgb(212, 212, 212);">&lt;</span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">&gt;;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">type</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">ViewableType</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">url</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">;</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">constructor</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">type</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">ViewableType</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">color</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">url</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">highlightedColor</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">THREE</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(78, 201, 176);">Color</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">highlightedUrl</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">, </span><span style="color: rgb(156, 220, 254);">animatedUrls</span><span style="color: rgb(212, 212, 212);">?: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">[]);</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">get</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">preloadedSprites</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">[];</span></div><div><br></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(220, 220, 170);">preloadSprite</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">spriteUrl</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);">): </span><span style="color: rgb(78, 201, 176);">void</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; }</span></div></div><p>Now for what was needed to integrate sprites into Dasher. <a href="https://forge.autodesk.com/en/docs/dataviz/v1/developers_guide/examples/create_sprite_style/" target="_blank">This section of the Hyperion documentation</a> was very much my friend as I worked on this, incidentally.</p><p>Inside Dasher we have a NodeManager class that can be used to display “sensor dots” or a variety of other sprites. This is part of the package that we shared with the Hyperion team when they first started building out their feature-set.</p><p>Way back when – when we first started rethinking Dasher using Forge – we used SVG elements in the DOM to represent sensors. This worked fine for a handful (or even two) of sensors, but over time it made more sense to swap this mechanism out for a stylized point cloud (which is the way Hyperion works, too). We evolved the implementation to perform hit-testing – to find out when you’re hovering over sensors – via a reference image rather than raycasting. Simon Breslav and I have both talked about this at past Autodesk Universities, in case you’re interested.</p><p>Anyway, the NodeManager has been a very helpful abstraction inside Dasher: we’ve used it to display sensors, equipment and even building occupants. Each of these had their own point cloud, but worked well together for hovering/tooltips/etc.</p><p>Hyperion currently maintains a global list of viewables, which means that the last feature that comes in and initializes their viewables wins. This is something that is likely to change, but for now it’s possible to make it work by having each NodeManager contribute viewables to a static list and pass this to Hyperion when needed. A little gymnastics were needed to make this happen, but it works well enough.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bdece9977200c-pi" target="_blank"><img width="500" height="312" title="Hyperion sprites inside Dasher" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Hyperion sprites inside Dasher" src="/assets/image_381320.jpg" border="0"></a></p><p>Here’s the rough approach needed to add sprites to your Forge application:</p><ol><li>Load the Data Visualization Extension</li><li>Create one or more ViewableStyle objects for your various icons</li><ul><li>Colour can be changed later, so you can use the same style for different colours (and probably, although this is untested by me, icons)</li></ul><li>Create a ViewableData object that will act as a collection of your viewables</li><li>Determine a globally unique (across your various viewables) dbID</li><ul><li>We use ranges for sensors, equipment and occupants as 1000-1999, 2000-2999 &amp; 3000-3999 respectively</li></ul><li>Create a SpriteViewable with the appropriate style and a unique dbId</li><ul><li>You can set the position, but this can also be a placeholder that gets set later</li></ul><li>Call ViewableData.addViewable() to add your newly created viewable to the list</li><li>Repeat steps 5 and 6 until you’ve added them all</li><li>Call ViewableData.finish() and be sure to wait for this to finish (haha) before continuing</li><li>Call addViewables() on the extension object to add your ViewableData to the scene</li><li>Optionally call showHideViewables() on the extension to globally turn off the viewable display or have them occluded by the scene geometry</li></ol><p>You can then manipulate the properties of these sprites during the functioning of your application by calling invalidateViewables() on the extension, passing in the dbIds of the sprites to change along with one or more of these properties:</p><ul><li>color</li><ul><li>We change the colour of nodes when they’re hovered over or selected</li></ul><li>position</li><ul><li>We move occupants around by changing their position</li></ul><li>scale</li><ul><li>We can turn individual sprites on or off by setting their scale to 1 or 0</li></ul><li>url</li><ul><li>We haven’t yet needed to change a sprite’s icon, but this is presumably how you’d do it</li></ul><li>highlighted</li><ul><li>We don’t use the standard highlighting in Dasher, so haven’t used this</li></ul></ul><p>We attach handlers to watch for MOUSE_HOVERING and MOUSE_CLICK events, so that we can show tooltips and plots respectively (using our standard mechanism) and also change the colour of the sprite. The default highlighting behaviour of the selection event is for it to change the scale of the sprite to be 1.5. In Dasher we want use colour rather than size to denote selection – which we do using invalidateViewables(), as described above – so we turn off the default scale behaviour by calling event.hasStopped in the callback.</p><p>Here’s an animation of the hovering, which I’m reasonably happy with.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e9a1514f200b-pi" target="_blank"><img width="500" height="312" title="Hovering" style="margin: 30px auto; float: none; display: block;" alt="Hovering" src="/assets/image_883098.jpg"></a></p><p>Bear in mind that while implementing sprites I tweaked the display to make the green and orange colours pop a little more, so this is really an apples to oranges comparison (haha) with the old design.</p><p>Of course it took some incremental steps (and even mis-steps) to get to this point, as usual. Here’s one of the more interesting ones – a bug or a feature?</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bdece9b07200c-pi" target="_blank"><img width="500" height="312" title="Tooltips, anyone" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Tooltips, anyone" src="/assets/image_175524.jpg" border="0"></a></p><p>A big test of this implementation was the classic occupancy demo we developed a few years ago with Schneider Electric to display the data captured using their (then) new sensors called MIRTIC (which presumably standards for <a href="https://cordis.europa.eu/project/id/304653" target="_blank">MIcro Retinal Thermal Infrared Camera</a>?). This is still our best test of dynamic sprites inside Dasher (aside from skeleton animation, I suppose), and the Hyperion implementation worked wonderfully (the heatmaps are still based on our existing Dasher implementation, of course):</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bdece9af4200c-pi" target="_blank"><img width="500" height="312" title="Occupancy" style="margin: 30px auto; float: none; display: block;" alt="Occupancy" src="/assets/image_275411.jpg"></a></p><p>The sharp-eyed among you will notice that occupant display is now also respecting (for better or worse) the global occlusion setting. Which is actually pretty cool.</p><p>So far I’m very happy with the progress we’ve been able to make with Hyperion. Sprites was always going to be the “low hanging fruit” of the integration project, so we’ll see how things progress as we start to focus on surface shading.</p>
