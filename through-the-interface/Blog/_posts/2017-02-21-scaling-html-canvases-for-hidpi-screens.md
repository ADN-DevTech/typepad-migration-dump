---
layout: "post"
title: "Scaling HTML canvases for HiDPI screens"
date: "2017-02-21 21:35:46"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "HTML"
  - "JavaScript"
  - "User interface"
original_url: "https://www.keanw.com/2017/02/scaling-html-canvases-for-hidpi-screens.html "
typepad_basename: "scaling-html-canvases-for-hidpi-screens"
typepad_status: "Publish"
---

<p>I’ve been mocking up some UI additions for <a href="http://dasher360.com" target="_blank">Dasher 360</a>, today. A big chunk of my time was spent working out how to make flyouts work for vertical toolbars (something I’ll address in a future post, if there’s interest), but I’ve just been fighting another problem that’s probably not really an issue for anyone using standard DPI (and non-“retina”) screens.</p> <p>I’ve been drawing text to a standard HTML canvas and it’s been <u>really</u> ugly. After some minutes of searching the web, I found out it was probably due to my MacBook Pro’s retina display. Here’s the code I integrated (from <a href="https://www.html5rocks.com/en/tutorials/canvas/hidpi/" target="_blank">this post</a>):</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: blue">public</span> rescaleCanvas(canvas: any): <span style="color: blue">void</span> {</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: green">// finally query the various pixel ratios</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> ctx = canvas.getContext(<span style="color: #a31515">'2d'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> devicePixelRatio = window.devicePixelRatio || 1;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> backingStoreRatio = ctx.webkitBackingStorePixelRatio ||</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.mozBackingStorePixelRatio ||</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.msBackingStorePixelRatio ||</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.oBackingStorePixelRatio ||</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ctx.backingStorePixelRatio || 1;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> ratio = devicePixelRatio / backingStoreRatio;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: green">// upscale the canvas if the two ratios don't match</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">if</span> (devicePixelRatio !== backingStoreRatio) {</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> oldWidth = canvas.width;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> oldHeight = canvas.height;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; canvas.width = oldWidth * ratio;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; canvas.height = oldHeight * ratio;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; canvas.style.width = oldWidth + <span style="color: #a31515">'px'</span>;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; canvas.style.height = oldHeight + <span style="color: #a31515">'px'</span>;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// now scale the context to counter</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// the fact that we've manually scaled</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// our canvas element</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; ctx.scale(ratio, ratio);</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>Integrating this into my project made a <strong><em><u>huge</u></em></strong> difference to the quality of the text being output. Here’s a GIF that shows the difference – although you may need to check the lower right corner in full-screen view to spot it.</p> <p>&nbsp;</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d262ff74970c-pi" target="_blank"><img title="HiDPI canvas text comparison" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="HiDPI canvas text comparison" src="/assets/image_546639.jpg" width="500" height="422"></a></p>
