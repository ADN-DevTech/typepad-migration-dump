---
layout: "post"
title: "Creating a motion-detecting security cam with a Raspberry Pi &ndash; Part 1"
date: "2012-08-27 12:02:57"
author: "Kean Walmsley"
categories:
  - "Raspberry Pi"
original_url: "https://www.keanw.com/2012/08/creating-a-motion-detecting-security-cam-with-a-raspberry-pi-part-1.html "
typepad_basename: "creating-a-motion-detecting-security-cam-with-a-raspberry-pi-part-1"
typepad_status: "Publish"
---

<p>As mentioned in these <a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/waiting-for-my-raspberry-pi.html" target="_blank">previous</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/a-slice-of-raspberry-pi.html" target="_blank">posts</a>, I’ve been spending some time developing a social media-enabled security cam using a Raspberry Pi and a standard webcam. The eventual idea is that the security cam will check visitors against a database of photos of a homeowners’ friends extracted from Facebook.</p>  <p>I have a lot of the needed “social” components in place – more on those in a future post – but I did just want to document some of the steps needed to create a functional security cam that simply uploads captured videos to Google Drive and sends an email with both a link to the video and an attached image frame (to make quick identification of the visitor easier, especially when reading the email on a mobile device).</p>  <p>Most of the components needed for this were in place – and have been used to good effect in several other comparable projects out there – but I thought I’d just gather some key links in one place (some of which are repeated from last time):</p>  <ul>   <li>Base OS: <a href="http://www.raspberrypi.org/downloads" target="_blank">Raspbian “wheezy”</a> </li>    <li>Motion detection: <a href="http://www.lavrsen.dk/foswiki/bin/view/Motion/WebHome" target="_blank">Motion</a> </li>    <li>Notification system: <a href="http://jeremyblythe.blogspot.co.uk/2012/06/motion-google-drive-uploader-and.html" target="_blank">Google Drive uploader/emailer</a> </li> </ul>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201761775dad4970c-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 10px 20px 10px 0px; padding-left: 0px; padding-right: 0px; display: inline; float: left; border-top: 0px; border-right: 0px; padding-top: 0px" title="Raspberry Pi + Debian = Raspbian" border="0" alt="Raspberry Pi + Debian = Raspbian" align="left" src="/assets/image_373609.jpg" width="256" height="43" /></a>Raspbian “wheezy” has a number of apparent advantages over its counterpart OS distributions – it includes support for a lot of things out-of-the-box – but also has a key disadvantage in that it doesn’t have webcam support. So I had to jump through a few hoops to get that working – no doubt more than were strictly needed, so I won’t list them here. I’m thinking of trying Arch Linux ARM next, which does come with the all-important webcam support (and while it’s apparently targeted at more advanced users, I feel like I’m gradually getting to the point where I can handle it :-).</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c317ed1d3970b-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 20px 0px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top: 0px; border-right: 0px; padding-top: 0px" title="Logitech QuickCam Communicate Deluxe" border="0" alt="Logitech QuickCam Communicate Deluxe" align="right" src="/assets/image_252637.jpg" width="179" height="179" /></a>One of the key issues I’ve been hitting is around resolution: I initially found I had to increase the Motion capture resolution to 960 x 720 for my <a href="http://www.amazon.com/Logitech-QuickCam-Communicate-Deluxe-Webcam/dp/B000RZSHQM" target="_blank">Logitech Quickcam Communicate Deluxe</a> to work properly, but then found that for the device to work reliably over a period of time (i.e. seconds), I had to reduce that down to 352 x 288 (the default resolution for the Motion sub-system). At a higher resolution the Pi just stopped working – I had to cycle the power to reboot it – which implied a pretty significant throughput issue. Even now I’m finding the webcam stops responding after a period of working – which seems to be due to another problem, possibly due to some webcams requiring a powered USB hub as they otherwise consume too much of the Pi’s own supply – but I’m trying to work through that, now. It’s possible the stability issues are more related to the use of Raspbian – I’ll hopefulyl find out more once I’ve tried Arch Linux ARM.</p>  <p>When managing Motion, I found <a href="http://chris.gg/2012/07/using-a-ps3-eyetoy-with-the-raspberry-pi" target="_blank">this post</a> to be extremely helpful in terms of setting up a script to ki<a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c317ed1da970b-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 10px 0px; padding-left: 0px; padding-right: 0px; display: inline; float: left; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Motion" border="0" alt="Motion" align="left" src="/assets/image_116287.jpg" width="132" height="53" /></a>ll it when running in daemon mode. I also found <a href="http://www.debian-administration.org/articles/347" target="_blank">this introduction</a> to be very good, too. I’ll publish my working configuration file for Motion in the next post – hopefully with step-by-step instructions on getting the whole system up and running.</p>  <p>The notification system – which takes the video created by Motion, uploads it to Google Drive and then uses Gmail to send a link to the video to the chosen recipient – was already pretty complete. The main change I wanted to make was to take the “best” frame extracted from the video (and Motion allows you to automatically save off the frame with the most changed pixels from the stream, which is a great way to do this) and attach that to the email.</p>  <p>I used the information in <a href="http://www.tutorialspoint.com/python/python_sending_email.htm" target="_blank">this page</a> to create my own remix of the Uploader.py file (again, which I’ll publish next time).</p>
