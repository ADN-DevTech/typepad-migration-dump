---
layout: "post"
title: "Smoothly transitioning between 3D AutoCAD views using .NET - Part 2"
date: "2009-03-02 11:27:25"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Graphics system"
original_url: "https://www.keanw.com/2009/03/smoothly-transitioning-between-3d-autocad-views-using-net---part-2.html "
typepad_basename: "smoothly-transitioning-between-3d-autocad-views-using-net---part-2"
typepad_status: "Publish"
---

<p><em>Thanks again to Fenton Webb for providing the code behind the first post in the series and to Jeremy Tammik for providing the suggestion of this alternative implementation.</em></p> <p>This post follows on from <a href="http://through-the-interface.typepad.com/through_the_interface/2009/02/smoothly-transitioning-between-3d-autocad-views-using-net---part-1.html">this previous post</a>, which introduced a technique to smoothly transition between 3D views in AutoCAD. It applies a more standard algorithm - known as <a href="http://en.wikipedia.org/wiki/Slerp">spherical linear interpolation</a> (or Slerp to its friends :-) - to interpolate between views, rather than interpolating individual values using Fenton&#39;s custom-built CosInterp() function. We still use CosInterp() to interpolate the width and height of the field of view, but otherwise the below code makes use of Slerp for the points and vectors it needs to adjust.</p> <p>Here&#39;s the modified C# code, which can be added to the same project as that containing the code from the previous post (to compare the execution):</p> <div style="font-size: 8pt; background: white; color: black; font-family: courier new"> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System.Threading;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System.Drawing;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsInterface;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsSystem;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Interop;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">namespace</span><span style="line-height: 140%"> ViewTransitionsSlerp</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">{</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">class</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Default constructor</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(){}</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// For constant defines below SWIso etc</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x3, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y3, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z3,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x4, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y4</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; position = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(x1, y1, z1);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; target = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(x2, y2, z2);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; upVector = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%">(x3, y3, z3);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; fieldWidth = x4;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; fieldHeight= y4;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> position, </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> target, </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> upVector,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldWidth, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldHeight</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.position = position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.target = target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.upVector = upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.fieldWidth = fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.fieldHeight = fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; };</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">class</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Commands</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> defaultView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 1930.1,1339.3,4399.3, 1930.1,1339.3,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.0,1.0,0.0, 3279.8, 1702.6</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> topView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 1778.1,1108.2,635.7, 1778.1,1108.2,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.0,1.0,0.0, 474.0, 246.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> bottomView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 1778.1,1108.2,-635.7, 1778.1,1108.2,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.0,1.0,0.0, 474.0, 246.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> leftView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; -344.1,1108.2,66.1, 0.0,1108.2,66.1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.0,0.0,1.0, 256.5, 133.2</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> rightView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 344.1,1108.2,66.1, 0.0,1108.2,66.1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.0,0.0,1.0, 256.5, 133.2</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> SWIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 265.1,-404.7,1579.0, 838.0,168.2,1006.2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 0.4,0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> SEIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 2105.6,780.7,393.7, 1532.7,1353.5,-179.2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; -0.4,0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> NEIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 1366.8,697.0,-345.2, 793.9,124.1,-918.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; -0.4,-0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> NWIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 1003.9, 1882.3, 840.2, 1576.8, 1309.5,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; 267.3, 0.4, -0.4, 0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Enacts a smooth transition from the current view to a</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// new view using spherical linear interpolation (Slerp)</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> SmoothViewToSlerp(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> nv, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> timeToTake</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> newViewMatrix = </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%">.Identity;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Manager</span><span style="line-height: 140%"> gsm =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.GraphicsManager;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get the current viewport</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> vpn =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Convert</span><span style="line-height: 140%">.ToInt32(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.GetSystemVariable(</span><span style="color: #a31515; line-height: 140%">&quot;CVPORT&quot;</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">View</span><span style="line-height: 140%"> view = gsm.GetGsView(vpn, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (view)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Set the frame rate to the standard eye FPS</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.BeginInteractivity(24);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> viewMatrix = view.ViewingMatrix;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get the current view settings</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> cv =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.Position, view.Target, view.UpVector,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.FieldWidth, view.FieldHeight</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Set up the start positions</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> intPos = cv.position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> intTgt = cv.target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> intUpVec = cv.upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> intWid = cv.fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> intHgt = cv.fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Now animate the view change between the</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// currentview and the viewToChangeTo</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">for</span><span style="line-height: 140%"> (</span><span style="color: blue; line-height: 140%">float</span><span style="line-height: 140%"> mu = 0; mu &lt;= 1; mu += 0.01F)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// First convert the positions to vectors</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// (so we can simply call the existing function)</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> startPos = cv.position - </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">.Origin,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; endPos = nv.position - </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">.Origin,</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Then get the target vectors relative</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// to the view position</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; from = cv.target - cv.position,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; to = nv.target - nv.position,</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Now Slerp the various vectors</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res1 = Slerp(startPos, endPos, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res2 = Slerp(from, to, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res3 = Slerp(cv.upVector, nv.upVector, mu);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// And then we extract the relevant information...</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get a point from the position vector</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; intPos = </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">.Origin + res1;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get the target point relative to that position</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; intTgt = intPos + res2;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// And the up-vector is easy :-)</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; intUpVec = res3;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Let&#39;s use our previous interpolate function</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// for the field width and height</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Interpolate Width</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; intWid =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; CosInterp(cv.fieldWidth, nv.fieldWidth, mu);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Interpolate Height</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; intHgt =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; CosInterp(cv.fieldHeight, nv.fieldHeight, mu);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Now set the interpolated view</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.SetView(intPos, intTgt, intUpVec, intWid, intHgt);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Update the control</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.Update();</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Decrease the sleep time, or rather increase the</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// speed of the view change as we work</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> sleepTime = timeToTake - (mu * 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Thread</span><span style="line-height: 140%">.Sleep((</span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%">)(sleepTime &gt; 50 ? 0 : sleepTime));</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.EndInteractivity();</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Finally set the new view&#0160; </span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; gsm.SetViewportFromView(vpn, view, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">, </span><span style="color: blue; line-height: 140%">false</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; System.Windows.Forms.</span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DoEvents();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> newViewMatrix;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Cosine interpolation</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> CosInterp(</span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> mu)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> mu2;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; mu2 = (1-</span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Cos(mu*</span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.PI))/2;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%">(y1*(1-mu2)+y2*mu2);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Spherical linear interpolation</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> Slerp(</span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> from, </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> to, </span><span style="color: blue; line-height: 140%">float</span><span style="line-height: 140%"> step)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (step == 0)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> from;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (from == to || step == 1)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> to;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Normalize the vectors</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> unitfrom = from.GetNormal(),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; unitto = to.GetNormal();</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Calculate the included angle</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> theta =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Acos(unitfrom.DotProduct(unitto));</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (theta == 0)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> to;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Avoid the repeated sine calculation</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> st =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Sin(theta);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Return the geometric spherical linear interpolation</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; from * (</span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Sin((1 - step) * theta) / st) +</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; to * </span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Sin(step * theta) / st;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Function to create a solid background of the same</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// colour as the background of our 2D modelspace view</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// (reduces the visual shock as the colour would</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// otherwise switch to grey and back)</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">private</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> CreateBackground()</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">const</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">string</span><span style="line-height: 140%"> bgKey = </span><span style="color: #a31515; line-height: 140%">&quot;TTIF_BG&quot;</span><span style="line-height: 140%">;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId = </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get the current viewport number</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> vpn =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Convert</span><span style="line-height: 140%">.ToInt32(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.GetSystemVariable(</span><span style="color: #a31515; line-height: 140%">&quot;CVPORT&quot;</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// No need to set the background if a corresponding</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// 3D view already exists</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">View</span><span style="line-height: 140%"> view =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.GraphicsManager.GetGsView(vpn, </span><span style="color: blue; line-height: 140%">false</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (view == </span><span style="color: blue; line-height: 140%">null</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Transaction</span><span style="line-height: 140%"> tr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.TransactionManager.StartTransaction();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (tr)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> bgId = </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get or create our background dictionary</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> bgdId =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Background</span><span style="line-height: 140%">.GetBackgroundDictionaryId(db, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">DBDictionary</span><span style="line-height: 140%"> bgd =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: #2b91af; line-height: 140%">DBDictionary</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bgdId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (bgd.Contains(bgKey))</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bgId = bgd.GetAt(bgKey);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">else</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// If our background doesn&#39;t exist...</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Get the 2D modelspace background colour</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">AcadPreferences</span><span style="line-height: 140%"> prefs =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: #2b91af; line-height: 140%">AcadPreferences</span><span style="line-height: 140%">)</span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.Preferences;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> rawCol =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%">)prefs.Display.GraphicsWinModelBackgrndColor;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Create a background with the corresponding RGB</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">SolidBackground</span><span style="line-height: 140%"> sb = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">SolidBackground</span><span style="line-height: 140%">();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; sb.Color =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> Autodesk.AutoCAD.Colors.</span><span style="color: #2b91af; line-height: 140%">EntityColor</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)(rawCol &amp; 0x000000FF),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)((rawCol &amp; 0x0000FF00) &gt;&gt; 8),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)((rawCol &amp; 0x00FF0000) &gt;&gt; 16)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Add it to the background dictionary</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bgd.UpgradeOpen();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; bgId = bgd.SetAt(bgKey, sb);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(sb, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Set the background on the active modelspace viewport</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ViewportTable</span><span style="line-height: 140%"> vt =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: #2b91af; line-height: 140%">ViewportTable</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.ViewportTableId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">foreach</span><span style="line-height: 140%"> (</span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> id </span><span style="color: blue; line-height: 140%">in</span><span style="line-height: 140%"> vt)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%"> vtr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (vtr.Name == </span><span style="color: #a31515; line-height: 140%">&quot;*Active&quot;</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtId = id;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtr.UpgradeOpen();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtr.Background = bgId;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">else</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; view.Dispose();</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> vtId;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">private</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">void</span><span style="line-height: 140%"> RemoveBackground(</span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Transaction</span><span style="line-height: 140%"> tr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.TransactionManager.StartTransaction();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (tr)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// Open up the previously-modified viewport</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%"> vtr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForWrite</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: green; line-height: 140%">// And set its previous background</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> obgId =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtr.GetPreviousBackground(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">DrawableType</span><span style="line-height: 140%">.SolidBackground</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; vtr.Background = obgId;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="color: #2b91af; line-height: 140%">CommandMethod</span><span style="line-height: 140%">(</span><span style="color: #a31515; line-height: 140%">&quot;TVS&quot;</span><span style="line-height: 140%">)]</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">void</span><span style="line-height: 140%"> TransitionViewSlerp()</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId = CreateBackground();</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(defaultView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(SWIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(topView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(SEIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(bottomView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(NEIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(leftView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(NWIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(rightView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SmoothViewToSlerp(defaultView, 10);</span></p> <p style="font-size: 8pt; margin: 0px">&#0160;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (vtId != </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; RemoveBackground(vtId);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&#0160; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">}</span></p></div> <p>What&#39;s especially notable about this implementation is actually <em>how similarly it works to the previous one</em>. Fenton came up with a pretty nice interpolation technique without knowing about Slerp which produces very similar - possibly identical, although I haven&#39;t verified them - results. Very cool.</p> <p>From my side I hadn&#39;t heard of Slerp and only had the vaguest idea of what a <a href="http://en.wikipedia.org/wiki/Quaternion">quaternion</a> was - even now I wouldn&#39;t know a quaternion if it bit me on the nose, so it&#39;s a good thing the wikipedia article contains a geometric alternative to the quaternion Slerp formula.</p> <p>So why use one technique over the other? There are a couple of possible differentiators that may make a difference to people.</p> <p>The first is the possibility - and this is not something I&#39;ve verified through performance benchmarking - that the Slerp implementation is more efficient. We need fewer calls to Slerp() than we used for CosInterp(), simply because we&#39;re interpolating multiple values at the same time. But this isn&#39;t likely to be a noticeable difference in any real-world application, so isn&#39;t something that would concern me, either way.</p> <p>The second differentiator is a potential deployment issue: <a href="http://discussion.autodesk.com/forums/thread.jspa?threadID=685493">a bug was introduced with Service Pack 1 of the .NET Framework 3.5</a> that can cause problems with vector arithmetic in AutoCAD .NET applications. <a href="http://blog.jtbworld.com/2008/08/net-framework-35-sp1-bug-and-autocad.html">Jimmy Bergmark reported on this</a>, back in August, and <a href="http://code.msdn.microsoft.com/KB957542">a hotfix was posted by Microsoft</a> in early December. I hit this issue after having installed a pre-release version of AutoCAD 2010 (which installed the .NET Framework 3.5 SP1) but I hit the problem when executing code in AutoCAD 2009. Installing the hotfix solved the problem, but in this case the more fundamental implementation not relying on Vector3d objects proved to be more reliable.</p> <p>In reality, though, avoiding vector arithmetic isn&#39;t really an option for most developers, so this is being addressed on a few fronts: <a href="http://usa.autodesk.com/adsk/servlet/ps/dl/item?siteID=123112&amp;id=11899352&amp;linkID=9240618">AutoCAD 2009 Update 2</a> apparently works around it (not sure how I missed that update, but there you go) as does AutoCAD 2010... and it also seems that any day now Microsoft will be <a href="http://www.hanselman.com/blog/UpdateOnNETFramework35SP1AndWindowsUpdate.aspx">pushing out a fixed version of the .NET Framework 3.5 SP1 in a general distribution release via Windows Update</a> (which means that any Windows user running .NET Framework 2.0 or higher will get it). So I&#39;m a little less worried about the impact of this issue than I was when I first saw it manifest itself. For ADN members who would like additional, detailed information on this issue, please visit <a href="http://adn.autodesk.com/adn/servlet/devnote?siteID=4814862&amp;id=12289272&amp;linkID=4900509">this DevNote on the ADN site</a> (login required).</p> <p>All this to say that the two versions of the code are much the same, when all is said and done. I&#39;ve provided both mainly for the purposes of intellectual curiosity and in case the techniques shown are relevant for other scenarios.</p>
