---
layout: "post"
title: "Getting the list of .NET assemblies loaded into AutoCAD from LISP"
date: "2010-02-15 06:07:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "AutoLISP / Visual LISP"
  - "Runtime"
original_url: "https://www.keanw.com/2010/02/getting-the-list-of-net-assemblies-loaded-into-autocad-from-lisp.html "
typepad_basename: "getting-the-list-of-net-assemblies-loaded-into-autocad-from-lisp"
typepad_status: "Publish"
---

<p><em>A big thank you to Jim Cameron from Dematic for providing the code for this post, and to Wayne Brill from DevTech Americas who helped him on his way via ADN support. I’ve made a few changes of my own to the code, but the concept is very much Jim’s.</em></p>  <p>Jim recently had a frustrating problem with a VLX application he wrote that depends – via (vl-arx-import) – on a .NET module. It turns out the module was not being <a href="http://through-the-interface.typepad.com/through_the_interface/2006/09/automatic_loadi.html">demand-loaded</a> properly, but this took some time to diagnose. In the past Jim used (arx) from LISP to detect the loaded ObjectARX modules, but now that he’s using .NET this is no longer possible.</p>  <p>Here’s some C# code that can be used from LISP (once it’s been NETLOADed, of course) to get a list of the .NET assemblies currently loaded into AutoCAD’s AppDomain, helping with the decision on what to go ahead and import. The returned list contains dotted pairs of the module names along with their versions, which should also be handy when troubleshooting version-related problems.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Reflection;</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System;</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> LoadedAssemblies</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">LispFunction</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;GetAssemblies&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> GetLoadedAssemblies(</span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> rb)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Get the list of loaded assemblies</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Assembly</span><span style="line-height: 140%">[] assems = </span><span style="line-height: 140%; color: #2b91af">AppDomain</span><span style="line-height: 140%">.CurrentDomain.GetAssemblies();</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// A ResultBuffer to populate and return</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> res = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// List the assemblies in the current application domain.</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">const</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> start = </span><span style="line-height: 140%; color: #a31515">&quot;Version=&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">foreach</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">Assembly</span><span style="line-height: 140%"> assem </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> assems)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We want the name and version of each assembly</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> dllname = assem.ManifestModule.Name;</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> version = assem.FullName;</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// If our assembly name includes version info...</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (version.Contains(start))</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Get the string starting with the version number</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version =</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.Substring(</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.IndexOf(start) + start.Length</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Strip off anything after (and including) the comma</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version =</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.Remove(version.IndexOf(</span><span style="line-height: 140%; color: #a31515">&#39;,&#39;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version = </span><span style="line-height: 140%; color: #a31515">&quot;&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Add a dotted pair of the name with the version</span></p>    <p style="margin: 0px; font-size: 8pt">&#0160;</p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">LispDataType</span><span style="line-height: 140%">.ListBegin));</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">LispDataType</span><span style="line-height: 140%">.Text, dllname));</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">LispDataType</span><span style="line-height: 140%">.Text, version));</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">LispDataType</span><span style="line-height: 140%">.DottedPair));</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> res;</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">}</span></p> </div>  <p>Let’s see what happens when we run this from the command-line (with the output reformatted to show the list contents better):</p>   <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">Command: <font color="#ff0000">(getassemblies)</font></span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">((&quot;mscorlib.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcdbMgd.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;msvcm90.dll&quot; . &quot;9.0.30729.4148&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Xml.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Drawing.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;PresentationFramework.dll&quot; . &quot;3.0.0.0&quot;) </span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;WindowsBase.dll&quot; . &quot;3.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;PresentationCore.dll&quot; . &quot;3.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AdWindowsInterop.dll&quot; . &quot;0.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AdWindows.dll&quot; . &quot;2.1.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;acmgd.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Configuration.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcWindows.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Core.dll&quot; . &quot;3.5.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcWindows.resources.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcCui.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AliasUnderlayRibbionUI.dll&quot; . &quot;1.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;ADNPlugin-OffsetInXref.dll&quot; . &quot;1.0.1.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;MyApplication.dll&quot; . &quot;1.0.3695.27974&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;&lt;Unknown&gt;&quot; . &quot;0.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AliasRibbonUI.dll&quot; . &quot;18.0.55.1&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;PresentationFramework.Aero.dll&quot; . &quot;3.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;ManagedMC3.dll&quot; . &quot;2.20.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Management.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcLayer.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Windows.Forms.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;AcLayer.resources.dll&quot; . &quot;18.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;System.Web.Services.dll&quot; . &quot;2.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;WindowsFormsIntegration.dll&quot; . &quot;3.0.0.0&quot;)</span></p>    <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">(&quot;&lt;Unknown&gt;&quot; . &quot;2.1.0.0&quot;))</span></p> </div>  <p>Thanks again, Jim, for this very useful little application. :-)</p>
