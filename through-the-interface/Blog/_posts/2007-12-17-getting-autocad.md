---
layout: "post"
title: "Getting AutoCAD's current directory from a .NET application"
date: "2007-12-17 14:47:10"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
original_url: "https://www.keanw.com/2007/12/getting-autocad.html "
typepad_basename: "getting-autocad"
typepad_status: "Publish"
---

<p>This question came in via a comment from Danny Polkinhorn on <a href="http://through-the-interface.typepad.com/through_the_interface/2007/12/launching-autoc.html">this post</a>:</p>  <blockquote dir="ltr">   <p><em>After AutoCAD has launched, I often have a need to determine the &quot;Start In&quot; directory specified in the shortcut (Right-click AutoCAD shortcut, Properties, Start in). Is there a way to determine what that directory is? I'm thinking I can use the path of the active drawing (either Drawing1 or the drawing they double-clicked on). Is that a fool-proof way?</em></p> </blockquote>  <p>This is an interesting topic, and raises the questions of what that the &quot;Start In&quot; setting is used for and how it can be modified.</p>  <p>The &quot;Start In&quot; property in a Windows shortcut specifies the initial &quot;current directory&quot; for a process. The concept of a <em>current</em> or <em>working</em> <em>directory</em> is common across the various Operating Systems I've worked with: processes have a current directory which is the default file-system folder used for certain operations (such as opening a drawing inside AutoCAD). It is also used by Windows when attempting <a href="http://msdn2.microsoft.com/en-us/library/ms682586.aspx">to locate DLLs to load</a>.</p>  <p>As Danny mentions, it is possible to specify the current directory for a process when it is launched: common ways are to edit the &quot;Start In&quot; property in the shortcut used to launch the application, to change the current directory (using CHDIR or CD) in a command-prompt window and launch the executable from there, or even to specify the working directory for an application to be launched from the Visual Studio debugger. And while the current directory is generally specified as the process starts, it can also change during execution.</p>  <p>AutoCAD 2008's default &quot;Start In&quot; location is &quot;C:\Program Files\Autodesk\AutoCAD 2008\UserDataCache\&quot;. Just to verify the process of querying it from an application, I copied the standard shortcut and modified the property to &quot;c:\temp&quot;:</p>  <p><a onclick="window.open(this.href, &#39;_blank&#39;, &#39;width=367,height=509,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39;); return false" href="http://through-the-interface.typepad.com/.shared/image.html?/photos/uncategorized/2007/12/17/shortcut_properties.png"><img title="Shortcut_properties" style="float: none; margin: 50px auto; display: block" border="0" alt="Shortcut_properties" src="/assets/shortcut_properties.png" width="300" height="416" /></a> </p>  <p>I know of two ways to query this property:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px">System.<span style="color: teal">Environment</span>.CurrentDirectory</p>    <p style="font-size: 8pt; margin: 0px">System.IO.<span style="color: teal">Directory</span>.GetCurrentDirectory()</p>    <p style="font-size: 8pt; margin: 0px">&#160;</p> </div>  <p>I created a simple command, CURDIR, to query this property and print the results.</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.ApplicationServices;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.DatabaseServices;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.EditorInput;</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">namespace</span> CurrentDirectory</p>    <p style="font-size: 8pt; margin: 0px">{</p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">Commands</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; [<span style="color: teal">CommandMethod</span>(<span style="color: maroon">&quot;CURDIR&quot;</span>)]</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> GetCurrentDirectory()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: teal">Document</span> doc =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: teal">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: teal">Database</span> db = doc.Database;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: teal">Editor</span> ed = doc.Editor;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;\nSystem.Environment.CurrentDirectory: &quot;</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; + System.<span style="color: teal">Environment</span>.CurrentDirectory</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; + <span style="color: maroon">&quot;\nSystem.IO.Directory.GetCurrentDirectory(): &quot;</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; + System.IO.<span style="color: teal">Directory</span>.GetCurrentDirectory()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160; }</p>    <p style="font-size: 8pt; margin: 0px">}</p>    <p style="font-size: 8pt; margin: 0px">&#160;</p> </div>  <p>This code works very well, but it may not return the results expected, depending on when the command is executed and - in particular - how the module is loaded. If we use <a href="http://through-the-interface.typepad.com/through_the_interface/2006/09/automatic_loadi.html">demand-loading to load your module</a>, it will generally returns the results we expect, assuming it runs early enough. Here's what's returned by the CURDIR command once it has demand-loaded our module in the instance of AutoCAD created by the modified shortcut:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px">Command: <span style="color: red">curdir</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">System.Environment.CurrentDirectory: C:\temp</p>    <p style="font-size: 8pt; margin: 0px">System.IO.Directory.GetCurrentDirectory(): C:\temp</p> </div>  <p>If, on the other hand, we use the NETLOAD command to load our module, we get the directory from which it was loaded:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px">Command: <span style="color: red">netload</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">Command: <span style="color: red">curdir</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">System.Environment.CurrentDirectory: C:\Program Files\Autodesk\ObjectARX </p>    <p style="font-size: 8pt; margin: 0px">2008\samples\dotNet\Prompts\bin\Debug</p>    <p style="font-size: 8pt; margin: 0px">System.IO.Directory.GetCurrentDirectory(): C:\Program Files\Autodesk\ObjectARX </p>    <p style="font-size: 8pt; margin: 0px">2008\samples\dotNet\Prompts\bin\Debug</p>    <p style="font-size: 8pt; margin: 0px">&#160;</p> </div>  <p>It took me some time to realise what was happening: it appears that the standard &quot;file navigation&quot; dialog inside AutoCAD - whether it's being used to open a drawing, load an application or perform an action on another type of file - sets the current directory to its most recent location, the first time it is run and closed. So even if you escape from the OPEN command, the location to which you had browsed before cancelling becomes the new current directory.</p>  <p>Whether this is intuitive or expected isn't really for me to say (although I can understand why people might have an opinion). The moral of the story is that you cannot reliably determine the &quot;Start In&quot; folder for AutoCAD (or any other complex application, in reality), unless you ask it very early on in its execution. Code hosted in the process can modify this setting as it feels it needs to.</p>  <p>While not 100% reliable - there are no guarantees some other code has not modified the property beforehand - your best chance at identifying the &quot;Start In&quot; location is to have an application module load on AutoCAD start-up and query it there.</p>  <p><strong><em>Update:</em></strong></p>  <p>From AutoCAD 2016 onwards thereâ€™s now a STARTINFOLDER system variable:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">Command: <font color="#ff0000">STARTINFOLDER</font></p>    <p style="margin: 0px">STARTINFOLDER = &quot;C:\Users\walmslk\Documents\&quot; (read only)</p> </div>
