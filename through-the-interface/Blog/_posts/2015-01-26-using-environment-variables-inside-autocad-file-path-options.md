---
layout: "post"
title: "Using environment variables inside AutoCAD file path options"
date: "2015-01-26 19:45:48"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "Runtime"
original_url: "https://www.keanw.com/2015/01/using-environment-variables-inside-autocad-file-path-options.html "
typepad_basename: "using-environment-variables-inside-autocad-file-path-options"
typepad_status: "Publish"
---

<p>Operating System-level environment variables are a handy way to reduce redundancy or to simplify providing support for per-user settings. (I’m sure they’re good for other things, too, but these are the ones that spring to my mind, at least. :-)</p>  <p>One thing I only discovered recently – and thanks to Tekno and Dieter for discussing this – is that you can use environment variables in a number of places in the file path settings accessed via AutoCAD’s OPTIONS command. The topic came up in the specific context of the TRUSTEDPATHS settings, but it seems to have more general support than that.</p>  <p>In this post we’re going to look at how you can test this capability, to see for ourselves how it might be used. For many of you the information in this post will be considered very basic, but it seemed worth covering, nonetheless.</p>  <p>Let’s take a module – available at <em>C:\Program Files\MyCompany\MyProduct\MyApplication.dll</em> – for which we have demand-loading entries set up in the Registry:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d0c8d27d970c-pi" target="_blank"><img title="Demand loading settings" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Demand loading settings" src="/assets/image_19935.jpg" width="474" height="247" /></a></p>  <p>This module gets loaded as AutoCAD launches, but always brings up the “secure load” dialog:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d0c8d285970c-pi" target="_blank"><img title="Secure load request" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Secure load request" src="/assets/image_609528.jpg" width="244" height="115" /></a></p>  <p>The right way to avoid this warning is to add the application’s folder – <em>C:\Program Files\MyCompany\MyProduct</em> – to the TRUSTEDPATHS system variable. We could do this explicitly, of course, but let’s see how we might also do this with an environment variable.</p>  <p>Inside a Command Prompt, we’re going to type “set myproddir=C:\Program Files\MyCompany\MyProduct”. We can then test this by echoing – or using dir to check the contents of – the directory referenced in %myproddir%.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c73f4c16970b-pi"><img title="Setting an environment variable" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="Setting an environment variable" src="/assets/image_970608.jpg" width="338" height="171" /></a></p>  <p>This will only be set for processes that are children of this command-prompt, so after this we go to the AutoCAD Program Files folder and launch <em>acad.exe</em> from there. We could, of course, set this as a system-wide setting either via the Control Panel or using setx from the command-line, but for testing purposes we’d actually like to see what happens when the variable isn’t defined.</p>  <p>Once AutoCAD has come up, we can reference the environment variable using %myproddir% in the Trusted Paths setting:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d0c8d2a0970c-pi" target="_blank"><img title="Using the environment variable inside our options" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="Using the environment variable inside our options" src="/assets/image_425602.jpg" width="360" height="291" /></a></p>  <p>If you close the OPTIONS dialog and reopen it, you’ll see the path has been resolved and displays as the actual location:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c73f4c1c970b-pi" target="_blank"><img title="Reopening the OPTIONS dialog shows the resolved value" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Reopening the OPTIONS dialog shows the resolved value" src="/assets/image_411003.jpg" width="364" height="295" /></a></p>  <p>When you relaunch AutoCAD via our Command Prompt, you should no longer see the load warning for our custom module. However, if you launch AutoCAD from the usual shortcut – without having set the variable at the system level – you’ll see %myproddir% in the list as it remains unresolved. Which means we’re storing the name of the variable – rather than the resolved value – and attempting to resolve it on launch.</p>  <p>In case you want to access this system variable from the command-line, you can do so using (getenv):</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">Command: (getenv &quot;myproddir&quot;)</p>    <p style="margin: 0px">&quot;C:\\Program Files\\MyCompany\\MyProduct&quot;</p> </div>  <p>That’s it for this basic introduction to using environment variables. I’d be curious to hear from people on how they use them in their own applications. Please post a comment, if you have scenarios you’d like to share.</p>  <p><strong><em>Update:</em></strong></p>  <p>Thanks to Glenn Ryan for mentioning the possibility to use the REG_EXPAND_SZ type to allow environment variables in Registry keys to be expanded. I tried it with the above demand-loading keys and it works perfectly (assuming you’ve used the Control Panel or setx to give the myproddir variable a broader scope):</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201bb07e37d62970d-pi" target="_blank"><img title="Modified demand-loading settings" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; border-left: 0px; display: block; padding-right: 0px" border="0" alt="Modified demand-loading settings" src="/assets/image_699141.jpg" width="474" height="306" /></a></p>  <p>This is really what you want, to be able to use the environment variable for your application’s path in multiple places whether inside or outside AutoCAD. Thanks, Glenn!</p>
