---
layout: "post"
title: "Changing the relative draw-order of AutoCAD objects based on their layer"
date: "2010-10-19 16:28:50"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Draw order"
  - "Object properties"
  - "User interface"
original_url: "https://www.keanw.com/2010/10/changing-the-relative-draw-order-of-autocad-objects-based-on-their-layer.html "
typepad_basename: "changing-the-relative-draw-order-of-autocad-objects-based-on-their-layer"
typepad_status: "Publish"
---

<p>Terry Dotson has – once again – generously offered an application to be an <a href="http://labs.autodesk.com/utilities/ADN_Plugins" target="_blank">ADN Plugin of the Month</a>. This little tool, called DrawOrderByLayer, allows you to modify the draw-order of objects in an AutoCAD drawing according to the layer they’re on. I don’t expect this to go live for another month or so (I still have plans for November’s plugin), but I did want to post it in order to give people the chance to provide feedback.</p>  <p>Here’s basically how it works…</p>  <p>You have layers containing geometry – in this case I’ve created circular solid hatches on layers named by their respective colours:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134884fdb4f970c-pi"><img style="border-bottom: 0px; border-left: 0px; margin: 20px auto; display: block; float: none; border-top: 0px; border-right: 0px" title="Hatches ready for ordering by layer" border="0" alt="Hatches ready for ordering by layer" src="/assets/image_700572.jpg" width="475" height="254" /></a> Loading the DLL and launching the DOBYLAYS command shows a simple dialog:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f52fe56e970b-pi"><img style="border-bottom: 0px; border-left: 0px; margin: 20px auto; display: block; float: none; border-top: 0px; border-right: 0px" title="Our DrawOrderByLayer dialog" border="0" alt="Our DrawOrderByLayer dialog" src="/assets/image_824190.jpg" width="446" height="315" /></a> Once you’ve ticked/checked the layers you care about and have moved them into an appropriate relative order, clicking OK selects the objects on each layer and uses the DrawOrderTable to bring them to the top. In our case we have asked for Red, Yellow, Green and Blue to be brought to the the top (Red being the topmost of them):</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f52fe59d970b-pi"><img style="border-bottom: 0px; border-left: 0px; margin: 20px auto; display: block; float: none; border-top: 0px; border-right: 0px" title="The ordered layers" border="0" alt="The ordered layers" src="/assets/image_623476.jpg" width="310" height="315" /></a> I’ve made a few cosmetic changes to Terry’s code, but it’s mostly his. There may well be further changes prior to the eventually posting – I’m wondering if it’s worth streamlining the DrawOrderTable calls, for instance – but I (and, I’m sure, Terry, also) would appreciate any feedback people would like to provide, in the meantime.</p>  <p>Here’s the main VB.NET file:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> DrawOrderByLayer.DemandLoading</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Class</span><span style="line-height: 140%"> Commands</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Implements</span><span style="line-height: 140%"> IExtensionApplication</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' AutoCAD fires the Initialize Sub when the assembly is loaded,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' so we check to see if the command is registered by looking for</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' the existance of the Registry keys.&#160; If not found, we attempt</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' to add them so the command will automatically load in future</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' sessions.&#160; This means it only needs to be NETLOADed once.</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> Initialize() </span><span style="line-height: 140%; color: blue">Implements</span><span style="line-height: 140%"> IExtensionApplication.Initialize</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; RegistryUpdate.RegisterForDemandLoading()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> Terminate() </span><span style="line-height: 140%; color: blue">Implements</span><span style="line-height: 140%"> IExtensionApplication.Terminate</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Only fires when AutoCAD is shutting down</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; &lt;CommandMethod(</span><span style="line-height: 140%; color: #a31515">&quot;ADNPLUGINS&quot;</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: #a31515">&quot;REMOVEDO&quot;</span><span style="line-height: 140%">, CommandFlags.Modal)&gt; _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Shared</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> RemoveDrawOrderByLayer()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; RegistryUpdate.UnregisterForDemandLoading()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' Establish our command name to use to start the tool.&#160; It</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' dimensions an instance of the form and displays it with</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">' AutoCAD's ShowModalDialog.&#160; Don't use Windows Form.Show!</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; &lt;CommandMethod(</span><span style="line-height: 140%; color: #a31515">&quot;ADNPLUGINS&quot;</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: #a31515">&quot;DOBYLAY&quot;</span><span style="line-height: 140%">, CommandFlags.Modal)&gt; _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Shared</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> OrderByLayer()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Using</span><span style="line-height: 140%"> dlg </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> OrderDialog()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; Application.ShowModalDialog(dlg)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Using</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Class</span></p> </div> <!--EndFragment-->  <p>Here’s the dialog implementation file:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Imports</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Class</span><span style="line-height: 140%"> OrderDialog</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">'Related System Variables</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">'&#160; DRAWORDERCTL: Controls the display order of overlapping objects.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">'&#160;&#160;&#160; Improves editing speed in large drawings</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">'&#160; SORTENTS: Controls object sorting in support of draw order for</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">'&#160;&#160;&#160; several operations.</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> MainForm_Load( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">MyBase</span><span style="line-height: 140%">.Load</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Populate layer list with layers (in order created)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> db </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Database = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; Application.DocumentManager.MdiActiveDocument.Database</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Using</span><span style="line-height: 140%"> tr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Transaction = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; db.TransactionManager.StartTransaction</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> lt </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> LayerTable = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(db.LayerTableId, OpenMode.ForRead)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> id </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> ObjectId </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> lt</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> ltr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> LayerTableRecord = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(id, OpenMode.ForRead)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> ltr.IsDependent = </span><span style="line-height: 140%; color: blue">False</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.Items.Add(ltr.Name)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; tr.Commit() </span><span style="line-height: 140%; color: green">' Cheaper to commit than abort</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Using</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> Accept_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> Accept.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> LayLst.CheckedItems.Count &gt; 0 </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Build list of layers from those checked, then reverse it</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> revLst </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> List(</span><span style="line-height: 140%; color: blue">Of</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> TxtStr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> LayLst.CheckedItems</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; revLst.Add(TxtStr)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; revLst.Reverse()</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Get modelspace objects on each layer and pass to</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' DrawOrderTable.MoveToTop()</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> doc </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Document = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Application.DocumentManager.MdiActiveDocument</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> db </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Database = doc.Database</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> ed </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Editor = doc.Editor</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Using</span><span style="line-height: 140%"> tr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Transaction = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; db.TransactionManager.StartTransaction</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> bt </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> BlockTable = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(db.BlockTableId, OpenMode.ForWrite)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> btr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> BlockTableRecord = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bt(BlockTableRecord.ModelSpace), OpenMode.ForWrite)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> dot </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> DrawOrderTable = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(btr.DrawOrderTableId, OpenMode.ForWrite)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Using</span><span style="line-height: 140%"> pm </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> ProgressMeter</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pm.Start(</span><span style="line-height: 140%; color: #a31515">&quot;Processing: &quot;</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pm.SetLimit(LayLst.CheckedItems.Count)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> lay </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> revLst</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> psr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> PromptSelectionResult</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> tvs(0) </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> TypedValue</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tvs(0) = </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> TypedValue(DxfCode.LayerName, lay)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> sf </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> SelectionFilter(tvs)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; psr = ed.SelectAll(sf)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> psr.Value </span><span style="line-height: 140%; color: blue">IsNot</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Nothing</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dot.MoveToTop( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">New</span><span style="line-height: 140%"> ObjectIdCollection(psr.Value.GetObjectIds))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pm.MeterProgress()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.Windows.Forms.Application.DoEvents()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pm.Stop()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Using</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Using</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; ed.Regen()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Me</span><span style="line-height: 140%">.Close()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> Cancel_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> Cancel.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Me</span><span style="line-height: 140%">.Close()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> LayInv_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> LayInv.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> AI </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Integer</span><span style="line-height: 140%"> = 0 </span><span style="line-height: 140%; color: blue">To</span><span style="line-height: 140%"> LayLst.Items.Count - 1</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.SetItemChecked(AI, </span><span style="line-height: 140%; color: blue">Not</span><span style="line-height: 140%"> LayLst.GetItemChecked(AI))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> LaySrt_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> LaySrt.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LayLst.Sorted = </span><span style="line-height: 140%; color: blue">True</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; LayLst.Sorted = </span><span style="line-height: 140%; color: blue">False</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> MovUpp_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> MovUpp.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> LayLst.SelectedIndex &gt; 0 </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> OldChk </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Boolean</span><span style="line-height: 140%"> = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.GetItemChecked(LayLst.SelectedIndex - 1)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.Items.Insert( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex + 1, _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.Items(LayLst.SelectedIndex - 1))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.Items.RemoveAt( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex - 1)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.SetItemChecked( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex + 1, OldChk)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> MovDnn_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> MovDnn.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> LayLst.SelectedIndex &lt; LayLst.Items.Count - 1 </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> OldChk </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Boolean</span><span style="line-height: 140%"> = _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.GetItemChecked(LayLst.SelectedIndex + 1)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.Items.Insert( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex, LayLst.Items(LayLst.SelectedIndex + 1))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.Items.RemoveAt( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex + 1)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.SetItemChecked( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; LayLst.SelectedIndex - 1, OldChk)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> SelAll_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> SelAll.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> I </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Int16 = 0 </span><span style="line-height: 140%; color: blue">To</span><span style="line-height: 140%"> LayLst.Items.Count - 1</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.SetItemChecked(I, </span><span style="line-height: 140%; color: blue">True</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">Private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> SelNon_Click( _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> sender </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.Object, </span><span style="line-height: 140%; color: blue">ByVal</span><span style="line-height: 140%"> e </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> System.EventArgs) _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Handles</span><span style="line-height: 140%"> SelNon.Click</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> I </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> Int16 = 0 </span><span style="line-height: 140%; color: blue">To</span><span style="line-height: 140%"> LayLst.Items.Count - 1</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; LayLst.SetItemChecked(I, </span><span style="line-height: 140%; color: blue">False</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Class</span></p> </div> <!--EndFragment-->  <p>And here’s <a href="http://through-the-interface.typepad.com/files/DrawOrderByLayer.zip" target="_blank">the project</a>. Thanks for providing this sample, Terry!</p>
