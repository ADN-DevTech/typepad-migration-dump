---
layout: "post"
title: "Creating demand-loading entries for .NET modules from outside of AutoCAD"
date: "2010-02-22 13:48:49"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Commands"
  - "Installation"
  - "Runtime"
original_url: "https://www.keanw.com/2010/02/creating-demand-loading-entries-for-net-modules-outside-of-autocad.html "
typepad_basename: "creating-demand-loading-entries-for-net-modules-outside-of-autocad"
typepad_status: "Publish"
---

<p>I received a really intriguing question by email from Dave Wolfe on Friday afternoon:</p>
<blockquote>
<p><em>Due to your post on the topic, I wanted to improve my installation method for .Net modules.&#0160; While examining the topic, I ran into a few concerns that shaped my development process. The game changer is that I couldn’t find a way to use reflection to check a .net module for the CommandMethodAttributes without being in an AutoCAD session.&#0160; The CommandMethodAttribute crashes on initialization outside of AutoCAD.</em></p>
</blockquote>
<p>Dave went on to describe a couple of ways he’d found to work around this problem by driving AutoCAD, but the question of whether this was possible started nagging away at me. (Thanks for the thought-provoking question, Dave! :-)</p>
<p>For those unfamiliar with the issue: <a href="http://through-the-interface.typepad.com/through_the_interface/2009/05/creating-demand-loading-entries-automatically-for-your-autocad-application-using-net.html">the previous post</a> Dave referred to shows some code which allows modules to create their appropriate <a href="http://through-the-interface.typepad.com/through_the_interface/2006/09/automatic_loadi.html">demand-loading Registry keys</a> automatically, typically when their modules get loaded for the first time. This is a technique I’ve since used widely, particularly in the <a href="http://labs.autodesk.com/utilities/ADN_plugins">Plugins of the Month</a> we’re posting to <a href="http://labs.autodesk.com/">Autodesk Labs</a>. The trick is that the code depends on the .NET assemblies being fully loaded – which means loaded into AutoCAD, as they depend on core AutoCAD assemblies. It would probably be possible to get at least part of the way there with using <a href="http://autodesk.com/realdwg">RealDWG</a> from .NET, but it did feel like there ought to be a simpler way. Back in the day (and presumably still now), it was possible to do something similar for ObjectARX modules, providing they used <a href="http://msdn.microsoft.com/en-us/library/49tet6k7(VS.100).aspx">RGS</a> files for their Registry key modifications: our AutoCAD Architecture team had developed a tool, AecReg.exe, which could load the .ARX without resolving its dependencies and manually extract and create the Registry keys defined in the module’s RGS resource.</p>
<p>The desired outcome was something similar for .NET: it would load the assembly without fully loading its dependencies and then be able to parse the metadata attached to each of the methods to identify the commands it defines and then create the corresponding Registry keys automatically. And all from a separate executable which could be called from a batch file or an installer to do this without having to fire up AutoCAD.</p>
<p>On Friday evening I did some quick research and found an interesting capability of the .NET Framework: that of <a href="http://msdn.microsoft.com/en-us/library/ms172331.aspx">loading assemblies for reflection only</a>. This looked really promising, so I ended up having to play around with this over the weekend. :-S</p>
<p>I’m pleased with the results, though. I managed to create a simple Console Application, modeled to some degree on RegAsm.exe (the .NET Framework utility application for registering .NET assemblies), which allows you to register and unregister AutoCAD .NET assemblies without any dependency on AutoCAD. I’ve named the application RegDL, for Register Demand-Loading, but the idea isn’t really to provide a definitive tool: people with an interest can use the code to create their own tailored application to be integrated into their deployment process. With suggestions on improving/extending this utility being most welcome, of course. :-)</p>
<p>The <span class="asset asset-generic at-xid-6a00d83452464869e201310f297d65970c"><a href="http://through-the-interface.typepad.com/files/regdl.zip">application’s project</a></span> contains two C# source files.</p>
<p>The first is for the command-line parsing and overall console application behaviour (I used the the default “Program.cs” file for this). I found and used an <a href="http://www.west-wind.com/Weblog/posts/9807.aspx">interesting trick</a> to stop dependent assemblies from being loaded fully rather than for reflection: during the current AppDomain’s ReflectionOnlyAssemblyResolve() event we load the specified assembly for reflection-only, effectively pre-empting a full assembly load.</p>
<p>Here’s the C# source file:</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Reflection;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.IO;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> DemandLoading;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">namespace</span><span style="line-height: 140%;"> RegDL</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">{</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Program</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> Main(</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">[] args)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We need at least one argument (the assembly name)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// or the request for help</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (args.Length &lt;= 0 ||</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; args.Length == 1 &amp;&amp;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (args[0] == </span><span style="line-height: 140%; color: #a31515;">&quot;/?&quot;</span><span style="line-height: 140%;"> || args[0].ToLower() == </span><span style="line-height: 140%; color: #a31515;">&quot;/help&quot;</span><span style="line-height: 140%;">))</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; PrintUsage();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the first argument and check the file exists</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> asmName = args[0];</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (!</span><span style="line-height: 140%; color: #2b91af;">File</span><span style="line-height: 140%;">.Exists(asmName))</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;RegDL : Unable to locate input assembly &#39;{0}&#39;.&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; asmName</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Now we get the optional flags</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> startup = </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> hklm = </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> unreg = </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> force = </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">for</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> i=1; i &lt; args.Length; i++)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> arg = args[i].ToLower();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; startup |= (arg == </span><span style="line-height: 140%; color: #a31515;">&quot;/startup&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; hklm |= (arg == </span><span style="line-height: 140%; color: #a31515;">&quot;/hklm&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; unreg |= (arg == </span><span style="line-height: 140%; color: #a31515;">&quot;/unregister&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; force |= (arg == </span><span style="line-height: 140%; color: #a31515;">&quot;/force&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// As each dependent assembly is resolved, we need to make</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// sure it is loaded via Reflection-Only, not a full Load</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">AppDomain</span><span style="line-height: 140%;">.CurrentDomain.ReflectionOnlyAssemblyResolve +=</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">delegate</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: blue;">object</span><span style="line-height: 140%;"> sender, </span><span style="line-height: 140%; color: #2b91af;">ResolveEventArgs</span><span style="line-height: 140%;"> rea)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;">.ReflectionOnlyLoad(rea.Name);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; };</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Let&#39;s load our assembly via Reflection-Only</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;"> assem =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;">.ReflectionOnlyLoadFrom(asmName);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> res = </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (unreg)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Unregister the assembly, if possible</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res = </span><span style="line-height: 140%; color: #2b91af;">RegistryUpdate</span><span style="line-height: 140%;">.UnregisterForDemandLoading(assem);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #2b91af;">Exception</span><span style="line-height: 140%;"> ex)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span><span style="line-height: 140%; color: #a31515;">&quot;Exception: {0}&quot;</span><span style="line-height: 140%;">, ex);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (res)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Removed demand-loading information for &#39;{0}&#39;.&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; asmName</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Could not remove demand-loading information for &#39;{0}&#39;.&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; asmName</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Register the assembly, if possible</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryUpdate</span><span style="line-height: 140%;">.RegisterForDemandLoading(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; assem, !hklm, startup, force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #2b91af;">Exception</span><span style="line-height: 140%;"> ex)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (ex </span><span style="line-height: 140%; color: blue;">is</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">ReflectionTypeLoadException</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Trouble loading types: do you have AcMgd.dll and &quot;</span><span style="line-height: 140%;"> +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;AcDbMgd.dll in the same folder as RegDL.exe?&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span><span style="line-height: 140%; color: #a31515;">&quot;Exception: {0}&quot;</span><span style="line-height: 140%;">, ex);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (res)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Registered assembly &#39;{0}&#39; for AutoCAD demand-loading.&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; asmName</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Could not register &#39;{0}&#39; for AutoCAD demand-loading.&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; asmName</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Print a usage message</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> PrintUsage()</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">const</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> indent = </span><span style="line-height: 140%; color: #a31515;">&quot;&#0160;&#0160;&#0160; &quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">const</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> start = </span><span style="line-height: 140%; color: #a31515;">&quot;Version=&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> version =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;">.GetExecutingAssembly().FullName;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (version.Contains(start))</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the string starting with the version number</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.Substring(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.IndexOf(start) + start.Length</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Strip off anything after (and including) the comma</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version.Remove(version.IndexOf(</span><span style="line-height: 140%; color: #a31515;">&#39;,&#39;</span><span style="line-height: 140%;">));</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; version = </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;AutoCAD .NET Assembly Demand-Loading Registration &quot;</span><span style="line-height: 140%;"> +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Utility {0}&quot;</span><span style="line-height: 140%;">, version</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Written by Kean Walmsley, Autodesk.&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;http://blogs.autodesk.com/through-the-interface&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span><span style="line-height: 140%; color: #a31515;">&quot;Syntax: RegDL AssemblyName [Options]&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span><span style="line-height: 140%; color: #a31515;">&quot;Options:&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; indent +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;/unregister&#0160; Remove demand-loading keys for this assembly&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; indent +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;/hklm&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Write keys under HKLM rather than HKCU&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; indent +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;/startup&#0160;&#0160;&#0160; Assembly to be loaded on AutoCAD startup&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; indent +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;/force&#0160;&#0160;&#0160;&#0160;&#0160; Overwrite keys, should they already exist&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Console</span><span style="line-height: 140%;">.WriteLine(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; indent +</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;/? or /help&#0160; Display this usage message&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">}</span></p>
</div>
<p>The second file is a version of the code in the previous post referred to earlier, but with a few key changes: firstly, as we’re running outside of AutoCAD we don’t have access to its types, such as CommandMethodAttribute. So we have to use a somewhat more manual approach, using CustomAttributeData.GetCustomAttributes() to get all the custom attributes, and then parse the arguments provided for any attributes of the class named CommandMethodAttribute.</p>
<p>Another key difference: as AutoCAD isn’t running, we clearly can’t query it for the Registry location under which we should install our demand-loading keys. The approach I’ve taken in this initial version is to search for the “current” AutoCAD version (which typically means the most recently executed). It’s certainly possible to extend this application to do more analysis on the versions of AutoCAD installed before either deciding which to install the application to or providing the user with the option to select one or more of those versions via some kind of dialog.</p>
<p>Here’s the second source file – I’ve personally called this one “demand-loading-external.cs” (to distinguish it from “demand-loading.cs”, the file I’ve used inside AutoCAD).</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Collections.Generic;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Reflection;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Resources;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Microsoft.Win32;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%; color: blue;">namespace</span><span style="line-height: 140%;"> DemandLoading</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">{</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">RegistryUpdate</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> RegisterForDemandLoading(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;"> assem, </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> currentUser, </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> startup, </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; )</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the assembly, its name and location</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> name = assem.GetName().Name;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> path = assem.Location;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We&#39;ll collect information on the commands</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// (we could have used a map or a more complex</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// container for the global and localized names</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// - the assumption is we will have an equal</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// number of each with possibly fewer groups)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; globCmds = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt;();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; locCmds = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt;();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; groups = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt;();</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Iterate through the modules in the assembly</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Module</span><span style="line-height: 140%;">[] mods = assem.GetModules(</span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: #2b91af;">Module</span><span style="line-height: 140%;"> mod </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> mods)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Within each module, iterate through the types</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Type</span><span style="line-height: 140%;">[] types = mod.GetTypes();</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: #2b91af;">Type</span><span style="line-height: 140%;"> type </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> types)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We may need to get a type&#39;s resources</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">ResourceManager</span><span style="line-height: 140%;"> rm =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">ResourceManager</span><span style="line-height: 140%;">(type.FullName, assem);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rm.IgnoreCase = </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get each method on a type</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">MethodInfo</span><span style="line-height: 140%;">[] meths = type.GetMethods();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: #2b91af;">MethodInfo</span><span style="line-height: 140%;"> meth </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> meths)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the method&#39;s custom attribute(s)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">IList</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: #2b91af;">CustomAttributeData</span><span style="line-height: 140%;">&gt; attbs =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">CustomAttributeData</span><span style="line-height: 140%;">.GetCustomAttributes(meth);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: #2b91af;">CustomAttributeData</span><span style="line-height: 140%;"> attb </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> attbs)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We only care about our specific attribute type</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (attb.Constructor.DeclaringType.Name ==</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;CommandMethodAttribute&quot;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Harvest the information about each command</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> grpName = </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> globName = </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> locName = </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> lid = </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Our processing will depend on the number of</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// parameters passed into the constructor</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> paramCount = attb.ConstructorArguments.Count;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (paramCount == 1 || paramCount == 2)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Constructor options here are:</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; globName (1 argument)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName (2 args)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; globName =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; attb.ConstructorArguments[0].ToString();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; locName = globName;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (paramCount &gt;= 3)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Constructor options here are:</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName, flags (3 args)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName, locNameId, flags (4 args)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName, locNameId, flags,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160;&#0160;&#0160; hlpTopic (5 args)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName, locNameId, flags,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160;&#0160;&#0160; contextMenuType (5 args)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160; grpName, globName, locNameId, flags,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">//&#0160;&#0160;&#0160; contextMenuType, hlpFile, helpTpic (7 args)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">CustomAttributeTypedArgument</span><span style="line-height: 140%;"> arg0, arg1;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; arg0 = attb.ConstructorArguments[0];</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; arg1 = attb.ConstructorArguments[1];</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// All options start with grpName, globName</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; grpName = arg0.Value </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; globName = arg1.Value </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; locName = globName;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// If we have a localized command ID,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// let&#39;s look it up in our resources</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (paramCount &gt;= 4)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the localized string ID</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; lid = attb.ConstructorArguments[2].ToString();</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Strip off the enclosing quotation marks</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (lid != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;"> &amp;&amp; lid.Length &gt; 2)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; lid = lid.Substring(1, lid.Length - 2);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Let&#39;s put a try-catch block around this</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Failure just means we use the global</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// name twice (the default)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (lid != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;"> &amp;&amp; lid != </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; locName = rm.GetString(lid);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; { }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (globName != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Add the information to our data structures</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; globCmds.Add(globName);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; locCmds.Add(locName);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (grpName != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;"> &amp;&amp; !groups.Contains(grpName))</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; groups.Add(grpName);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Let&#39;s register the application to load on AutoCAD</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// startup (2) if specified or if it contains no</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// commands. Otherwise we will have it load on</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// command invocation (12)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> flags = (!startup &amp;&amp; globCmds.Count &gt; 0 ? 12 : 2);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Now create our Registry keys</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> CreateDemandLoadingEntries(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; name, path, globCmds, locCmds, groups,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; flags, currentUser, force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> UnregisterForDemandLoading(</span><span style="line-height: 140%; color: #2b91af;">Assembly</span><span style="line-height: 140%;"> assem)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the name of the application to unregister</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> appName = assem.GetName().Name;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Unregister it for both HKCU and HKLM</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> res = RemoveDemandLoadingEntries(appName, </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; res &amp;= RemoveDemandLoadingEntries(appName, </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// If one call failed, we also fail (could change this)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> res;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Helper functions</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> CreateDemandLoadingEntries(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> appName,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> path,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; globCmds,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; locCmds,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt; groups,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> flags,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> currentUser,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; )</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> ackName = GetAutoCADKey();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> hive =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (currentUser ? </span><span style="line-height: 140%; color: #2b91af;">Registry</span><span style="line-height: 140%;">.CurrentUser : </span><span style="line-height: 140%; color: #2b91af;">Registry</span><span style="line-height: 140%;">.LocalMachine);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We may need to create the Applications key, as some AutoCAD</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// verticals do not contain it under HKCU by default</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// CreateSubKey just opens existing keys for write, anyway</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> appk =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; hive.CreateSubKey(ackName + </span><span style="line-height: 140%; color: #a31515;">&quot;\\&quot;</span><span style="line-height: 140%;"> + </span><span style="line-height: 140%; color: #a31515;">&quot;Applications&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (appk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Already registered? Just return (unless forcing)</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (!force)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">[] subKeys = appk.GetSubKeyNames();</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> subKey </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> subKeys)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (subKey.Equals(appName))</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Create the our application&#39;s root key and its values</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> rk = appk.CreateSubKey(appName);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (rk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rk.SetValue(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;DESCRIPTION&quot;</span><span style="line-height: 140%;">, appName, </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.String</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rk.SetValue(</span><span style="line-height: 140%; color: #a31515;">&quot;LOADCTRLS&quot;</span><span style="line-height: 140%;">, flags, </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.DWord);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rk.SetValue(</span><span style="line-height: 140%; color: #a31515;">&quot;LOADER&quot;</span><span style="line-height: 140%;">, path, </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.String);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rk.SetValue(</span><span style="line-height: 140%; color: #a31515;">&quot;MANAGED&quot;</span><span style="line-height: 140%;">, 1, </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.DWord);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Create a subkey if there are any commands...</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> ((globCmds.Count == locCmds.Count) &amp;&amp;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; globCmds.Count &gt; 0)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> ck = rk.CreateSubKey(</span><span style="line-height: 140%; color: #a31515;">&quot;Commands&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (ck)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">for</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> i = 0; i &lt; globCmds.Count; i++)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ck.SetValue(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; globCmds[i],</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; locCmds[i],</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.String</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// And the command groups, if there are any</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (groups.Count &gt; 0)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> gk = rk.CreateSubKey(</span><span style="line-height: 140%; color: #a31515;">&quot;Groups&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (gk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> grpName </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> groups)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; gk.SetValue(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; grpName, grpName, </span><span style="line-height: 140%; color: #2b91af;">RegistryValueKind</span><span style="line-height: 140%;">.String</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> RemoveDemandLoadingEntries(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> appName, </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> currentUser</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; )</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> ackName = GetAutoCADKey();</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Choose a Registry hive based on the function input</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> hive =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (currentUser ?</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Registry</span><span style="line-height: 140%;">.CurrentUser :</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Registry</span><span style="line-height: 140%;">.LocalMachine);</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Open the applications key</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> appk =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; hive.OpenSubKey(ackName + </span><span style="line-height: 140%; color: #a31515;">&quot;\\&quot;</span><span style="line-height: 140%;"> + </span><span style="line-height: 140%; color: #a31515;">&quot;Applications&quot;</span><span style="line-height: 140%;">, </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (appk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Delete the key with the same name as this assembly</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; appk.DeleteSubKeyTree(appName);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> GetAutoCADKey()</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Start by getting the CurrentUser location</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> hive = </span><span style="line-height: 140%; color: #2b91af;">Registry</span><span style="line-height: 140%;">.CurrentUser;</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Open the main AutoCAD key</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> ack =</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; hive.OpenSubKey(</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;Software\\Autodesk\\AutoCAD&quot;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (ack)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the current major version and its key</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> ver = ack.GetValue(</span><span style="line-height: 140%; color: #a31515;">&quot;CurVer&quot;</span><span style="line-height: 140%;">) </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (ver == </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> verk = ack.OpenSubKey(ver);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (verk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the vertical/language version and its key</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> lng = verk.GetValue(</span><span style="line-height: 140%; color: #a31515;">&quot;CurVer&quot;</span><span style="line-height: 140%;">) </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (lng == </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #a31515;">&quot;&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegistryKey</span><span style="line-height: 140%;"> lngk = verk.OpenSubKey(lng);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (lngk)</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// And finally return the path to the key,</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// without the hive prefix</span></p>
<p style="margin: 0px; font-size: 8pt;">&#0160;</p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> lngk.Name.Substring(hive.Name.Length + 1);</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">}</span></p>
</div>
<p>The application itself does not depend on AutoCAD, but it does need reflection-only level access to AcMgd.dll and AcDbMgd.dll. So you might place RegDL.exe into the AutoCAD program files folder, or you could copy the AcMgd.dll and AcDbMgd.dll reference assemblies from the ObjectARX SDK (not the full AutoCAD versions: the “liposuctioned” versions are adequate) into the executable’s folder.</p>
<p>Although <a href="http://through-the-interface.typepad.com/through_the_interface/2009/11/updated-version-of-screenshot-now-available.html">we recommend placing your .NET assemblies into AutoCAD’s program files folder</a>, the tool will work if the assemblies are located elsewhere (providing RegDL can find AcMgd.dll and AcDbMgd.dll, of course).</p>
<p>If we run the RegDL application without arguments (or with /? or /help), we see the usage instructions for the utility:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a8c291fe970b-pi"><img alt="RegDL Usage Instructions" border="0" height="248" src="/assets/image_35614.jpg" style="display: inline; margin-left: 0px; margin-right: 0px; border-width: 0px;" title="RegDL Usage Instructions" width="489" /></a></p>
<p>The usage pattern should be straightforward enough:</p>
<ul>
<li>/unregister to remove – rather than add – the demand-loading Registry keys for the assembly </li>
<li>/hklm to create the keys per machine, under HKEY_LOCAL_MACHINE (requiring appropriate permissions) </li>
<li>/startup to specify that the module should be loaded on AutoCAD startup (also the default if no commands are found in the assembly) </li>
<li>/force to overwrite any existing Registry information (this just writes over – it doesn’t remove any existing commands information, for instance, although that would be trivial to add) </li>
</ul>
<p>Now let’s use it from a batch file to register the various “Plugins of the Month” for AutoCAD.</p>
<p>Firstly, we can take a look at the relevant section of the Registry, to make sure there’s nothing there:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a8c29274970b-pi"><img alt="Before registration" border="0" height="339" src="/assets/image_568664.jpg" style="display: inline; border-width: 0px;" title="Before registration" width="489" /></a></p>
<p>We can use a batch file (e.g. “reg.bat”) to register our various plugins one after the other:</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;c:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-ClipboardManager.dll&quot; /force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;c:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-FacetCurve.dll&quot; /force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;c:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-LayerReporter.dll&quot; /force</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;c:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-OffsetInXref.dll&quot; /force /startup</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;c:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-Screenshot.dll&quot; /force</span></p>
</div>
<p>We’ve specified absolute paths, but relative paths work fine, too: the information stored in the Registry is taken from the module’s location, not from what’s passed into RegDL via the command-line. We’ve specified the /force flag, but clearly that’s optional the first time run. OffsetInXref needs to be loaded on startup, as it cannot demand-load off the OFFSET command, which is why we’ve specified that additional flag.</p>
<p>Here’s the output we see from running our batch file:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201310f2975aa970c-pi"><img alt="Results of our RegDL batch operation" border="0" height="282" src="/assets/image_62196.jpg" style="display: inline; border-width: 0px;" title="Results of our RegDL batch operation" width="489" /></a></p>
<p>And in the Registry we should now see our new keys and values:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201310f297602970c-pi"><img alt="After registration" border="0" height="339" src="/assets/image_825213.jpg" style="display: inline; border-width: 0px;" title="After registration" width="489" /></a></p>
<p>And to remove our keys, it’s a simple case of executing an equivalent set of calls with the /unregister flag:</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;C:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-ClipboardManager.dll&quot; /unregister</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;C:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-FacetCurve.dll&quot; /unregister</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;C:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-LayerReporter.dll&quot; /unregister</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;C:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-OffsetInXref.dll&quot; /unregister</span></p>
<p style="margin: 0px; font-size: 8pt;"><span style="line-height: 140%;">RegDL &quot;C:\Program Files\Autodesk\AutoCAD 2010\ADNPlugin-Screenshot.dll&quot; /unregister</span></p>
</div>
<p>I’ve used batch files for simplicity, but clearly the same approach also applies when implementing an installer (you should be able to fire off <a href="http://msdn.microsoft.com/en-us/library/aa367431(VS.85).aspx">custom actions</a> for the modules to be registered).</p>
<p>As mentioned earlier, this utility is a first step and shouldn’t be considered a definitive solution: please post a comment if you have suggestions for future directions or have enhancements you’d like to share with other readers of this blog.</p>
<p><strong><em>Update</em></strong></p>
<p>Dave just mentioned that certain AutoCAD verticals (AutoCAD Electrical) do not automatically have an “Applications” sub-key under HKCU – presumably any standard demand-loaded components are done so via HKLM. Which means it’s potentially unsafe to simply assume it’ll be there. The good news is that it’s a trivial code change: we just need to use CreateSubKey() rather than OpenSubKey(): this is safe, as CreateSubKey() doesn’t overwrite existing keys, it simply opens them as writeable, which is exactly what we want. I’ve modified the above code and updated the source project.</p>
<p>Something else has just occurred to me… I’ve realised that we don’t need to reflect on an assembly to unregister its types, as we just use its name. I could change the code to just extract the module name from the path string passed in and use that to determine what (if anything) to remove from the Registry, but I’m hesitating. Yes, the module currently needs to exist for it to be unregistered, but perhaps that’s a good thing? Comments welcome.</p>
<p>And one final point (for now, at least :-): I think I’ve tested the various CommandMethodAttribute syntax variations fairly thoroughly, but if you find RegDL doesn’t work properly for your application, please do let me know.</p>
<p><em><strong>Update 2</strong></em></p>
<p>I&#39;ve updated the source and downloadable project to fix the issue reported in <a href="http://through-the-interface.typepad.com/through_the_interface/2010/02/creating-demand-loading-entries-for-net-modules-outside-of-autocad.html?cid=6a00d83452464869e20167604e8e51970b#comment-6a00d83452464869e20167604e8e51970b">this comment</a>.</p>
