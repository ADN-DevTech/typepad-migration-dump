---
layout: "post"
title: "An updated implementation of a CAD standards plugin for AutoCAD using .NET"
date: "2014-08-12 19:20:23"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Drawing structure"
  - "Runtime"
  - "Visual Studio"
original_url: "https://www.keanw.com/2014/08/an-updated-implementation-of-a-cad-standards-plugin-for-autocad-using-net.html "
typepad_basename: "an-updated-implementation-of-a-cad-standards-plugin-for-autocad-using-net"
typepad_status: "Publish"
---

<p>Over the last few months I’ve had a number of people ask me for an update to <a href="http://through-the-interface.typepad.com/through_the_interface/2008/08/implementing-a.html" target="_blank">this 6-year old post on implementing a CAD standards plugin for AutoCAD</a> (which in turn was based on code from an older DevNote created from a much older VB6 sample).</p>  <p>Augusto Gonçalves from the ADN team very kindly made a start on this while I was out on vacation, providing a basic port that I’ve now just put a few finishing touches on. Very few changes were actually needed from the code in the original post, thankfully. Also, I did do my best to make sure the code still supports Win32 as well as x64, although admittedly I’ve only tested the code and process on 64-bit Windows. And as you need to reference a platform-specific COM component you won't (easily?) be able to build a single plugin that works on both.</p>  <p>Rather than repeating the bulk of the instructions from the previous post, here’s a Screencast in which I go through the process of building and loading the plugin (all it doesn’t show is downloading and extracting <a href="http://through-the-interface.typepad.com/files/CircleStandard2.zip" target="_blank">the plugin’s source project</a>):</p>  <br /><iframe height="294" src="https://screencast.autodesk.com/Embed/ab863d5d-e2bd-4599-84d3-1574d7a8590d" frameborder="0" width="470" webkitallowfullscreen="webkitallowfullscreen" allowfullscreen="allowfullscreen"></iframe>  <br />  <br />  <p>Here’s the updated C# code:</p>  <div style="font-family: Courier New; font-size: 8pt; color: black; background: white; line-height: 140%;"> <p style="margin: 0px;"><span style="color: green;">// </span></p> <p style="margin: 0px;"><span style="color: green;">//&nbsp; AutoCAD CAD Standards API Sample</span></p> <p style="margin: 0px;"><span style="color: green;">// </span></p> <p style="margin: 0px;"><span style="color: green;">//&nbsp; CircleStandard.cs : CAD Standards Plugin Sample for C#</span></p> <p style="margin: 0px;"><span style="color: green;">// </span></p> <p style="margin: 0px;"><span style="color: green;">// This sample adds a custom plugin to the CAD Standards</span></p> <p style="margin: 0px;"><span style="color: green;">// Drawing Checker. </span></p> <p style="margin: 0px;"><span style="color: green;">//</span></p> <p style="margin: 0px;"><span style="color: green;">// The sample plugin tests for a match between the color of a</span></p> <p style="margin: 0px;"><span style="color: green;">// circle in the current drawing, and any of the colors of</span></p> <p style="margin: 0px;"><span style="color: green;">// circles contained in the specified standards (.DWS) files.</span></p> <p style="margin: 0px;"><span style="color: green;">// All the colors of the standard circles are considered as</span></p> <p style="margin: 0px;"><span style="color: green;">// fix candidates of the circle being checked. The recommended</span></p> <p style="margin: 0px;"><span style="color: green;">// fix object will be the standard circle having the nearest</span></p> <p style="margin: 0px;"><span style="color: green;">// radius to the circle being checked.</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> AcStMgr;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> AXDBLib;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> MSXML2;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> System;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> System.Collections.Generic;</p> <p style="margin: 0px;"><span style="color: blue;">using</span> System.Runtime.InteropServices;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="color: blue;">namespace</span> CircleStandard</p> <p style="margin: 0px;">{</p> <p style="margin: 0px;">&nbsp; [<span style="color: #2b91af;">ProgId</span>(<span style="color: #a31515;">&quot;CircleStandard.CircleStandard&quot;</span>)]</p> <p style="margin: 0px;">&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">CircleStandard</span> : <span style="color: #2b91af;">IAcStPlugin2</span></p> <p style="margin: 0px;">&nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Declare variables</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">ContextList</span> m_contexts =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">new</span> <span style="color: #2b91af;">ContextList</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">AcStManager</span> m_mgr;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">CircleStandard</span> m_plugin;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">AcadDatabase</span> m_checkDb;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">AcadDatabase</span> m_dwsDb;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">AcStError</span> m_err;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">object</span> m_fixArray;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">CircleCache</span>[] m_cirCacheArray;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">int</span> m_recFixIndex;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">int</span> m_curIndex;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">int</span> m_fixCnt;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">string</span> m_propName;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Initialize</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Initializes the plugin</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Initialize(<span style="color: #2b91af;">AcStManager</span> mgr)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// This is the only member function in which</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// the interface is passed an IAcStManager interface. </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Store pointer to Manager object</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_mgr = mgr;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_plugin = <span style="color: blue;">this</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// GetObjectFilter</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Plugin populates the provided array with class names</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// of objects that it can check</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">object</span> GetObjectFilter()</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// In this case we're only interested in circles</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> <span style="color: blue;">new</span> <span style="color: blue;">string</span>[] { <span style="color: #a31515;">&quot;AcDbCircle&quot;</span> };</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// SetupForAudit</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Sets the context for a plugin to check a drawing</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> SetupForAudit(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcadDatabase</span> db,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">string</span> pathName,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">object</span> objNameArray,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">object</span> objPathArray,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">object</span> objDbArray)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// This method defines the context in which a plug-in</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// will operate, specifically the drawing to check and</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// the DWS files that should be used to check the drawing.</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Here we cache our DWS standards definitions and make</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// an initial cache of circles in the DWG to be checked.</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// NOTE: AcadDatabase objects contained in objDbArray</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// are ***not*** guaranteed to be valid after this call.</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// They should not be cached!!!</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (db != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Cache a pointer to the database</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_checkDb = db;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// pDb is the DWG to be checked</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Store list of circles in drawing in m_ObjIDArray</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_checkDb != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Cache list of all circles in the current drawing</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">foreach</span> (<span style="color: #2b91af;">AcadObject</span> obj <span style="color: blue;">in</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_mgr.get_ModelSpaceProxy(m_checkDb))</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (obj.ObjectName == <span style="color: #a31515;">&quot;AcDbCircle&quot;</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_contexts.Add(obj.ObjectID, <span style="color: blue;">true</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> dbArray = (<span style="color: blue;">object</span>[])objDbArray;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> nameArray = (<span style="color: blue;">string</span>[])objNameArray;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> pathArray = (<span style="color: blue;">string</span>[])objPathArray;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">int</span> i = 0;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Iterate over the DWSes and cache properties (color</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// and radius) of standard circles </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> iDWS = 0; iDWS &lt; dbArray.Length; iDWS++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Get the DWS database</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_dwsDb = (<span style="color: #2b91af;">AcadDatabase</span>)dbArray[iDWS];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">foreach</span> (<span style="color: #2b91af;">AcadCircle</span> stdCircle <span style="color: blue;">in</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_mgr.get_ModelSpaceProxy(m_dwsDb))</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">CircleCache</span> cirCache = <span style="color: blue;">new</span> <span style="color: #2b91af;">CircleCache</span>();</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// CircleCache is utility object for storing</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// properties</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Cache properties (color and radius) of all</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// circles in the DWS database</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache.color = stdCircle.color;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache.radius = stdCircle.Radius;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache.standardFileName = nameArray[iDWS];</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// pFix contains fix information to be passed back</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// to the manager later</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> fix = <span style="color: blue;">new</span> <span style="color: #2b91af;">AcStFix</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.Description = <span style="color: #a31515;">&quot;Color fix&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.StandardFileName =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache.standardFileName;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.FixObjectName =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;Color: &quot;</span> +</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StripAcPrefix(stdCircle.color.ToString());</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (fix.PropertyCount == 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.PropertyValuePut(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;Color&quot;</span>,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stdCircle.color</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache.pFix = fix;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Array</span>.Resize&lt;<span style="color: #2b91af;">CircleCache</span>&gt;(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> m_cirCacheArray,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i+1</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[i++] = cirCache;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// SetContext</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Sets the objects to examine when iterating over errors</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> SetContext(<span style="color: blue;">object</span> objIdArray, <span style="color: blue;">bool</span> useDb)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// If useDb is set to &quot;true&quot; (default), or if</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// objIdArray is blank, we use the database (we get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// all ids for the current drawing). Otherwise, we</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// set supplied list of objIdArrays as our list.</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_contexts.SetContext(useDb, objIdArray);</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Start</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Initializes the error iterator mechanism</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Start(<span style="color: #2b91af;">AcStError</span> err)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// If pStartError is set to an error object, we should</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// only start checking from that error, not from the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// beginning. Mostly we will just go the Next item at</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// this point...</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (err != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> badId = err.BadObjectId;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Find the index for BadObjectId in m_objIDArray</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex = 0;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex &lt; m_contexts.Count;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex++</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_contexts[m_curIndex] == badId)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex = (m_curIndex - 1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// No AcStError object was passed in. Start checking</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// from the very begining</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_curIndex = -1;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; Next();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Next</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Finds the next error in the current context</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Next()</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_err = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_contexts.Count &gt; 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Drawing contains AcDbCircle objects</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcadCircle</span> circle;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">bool</span> foundErr;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_cirCacheArray.Length &gt; 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If we've not reached end of list, we first</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// increment current list index</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_curIndex &lt; m_contexts.Count - 1)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex++;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foundErr = <span style="color: blue;">false</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">while</span> (m_curIndex &lt; m_contexts.Count)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Don't iterate beyond end of list</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Retrieve object using its ObjectId</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">try</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; circle =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span style="color: #2b91af;">AcadCircle</span>)m_checkDb.ObjectIdToObject(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_contexts[m_curIndex]</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Try to find a circle with the same color from</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// the cached standard circle (Iterate over cached</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// standards)</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">int</span> iCache = 0;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iCache &lt; m_cirCacheArray.Length;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iCache++</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (circle.color.CompareTo(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[iCache].color</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) != 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If it doesn't match, we've found a potential</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// error</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foundErr = <span style="color: blue;">true</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If it matches any one standard, then we can</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// stop checking</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foundErr = <span style="color: blue;">false</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">break</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Check for color differences</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (foundErr)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// We found an error so create a local error</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// object</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> err = <span style="color: blue;">new</span> <span style="color: #2b91af;">AcStError</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.Description = <span style="color: #a31515;">&quot;Color is non-standard&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.BadObjectId = circle.ObjectID;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.BadObjectName =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; StripAcPrefix(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; circle.color.ToString()</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.Plugin = m_plugin;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ErrorTypeName = <span style="color: #a31515;">&quot;Color &quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResFlagsNone;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (err.PropertyCount == 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.PropertyValuePut(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;Color&quot;</span>,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; circle.color</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_err = err;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foundErr = <span style="color: blue;">false</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">break</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">catch</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_curIndex = (m_curIndex + 1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Done</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns true if there are no more errors</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">bool</span> Done()</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> (m_err == <span style="color: blue;">null</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// GetError -- Returns the current error</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">AcStError</span> GetError()</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> m_err;</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// GetAllFixes</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns an array of IAcStFix objects for the given</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// error (note: The caller is responsible for releasing</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// the objects in this array)</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> GetAllFixes(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStError</span> err,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">object</span> fixArray,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">int</span> recommendedFixIndex</p> <p style="margin: 0px;">&nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (err != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> arr = <span style="color: blue;">new</span> <span style="color: #2b91af;">IAcStFix</span>[m_cirCacheArray.Length];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">ACAD_COLOR</span> vErrorVal;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; recommendedFixIndex = -1;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_fixCnt = 0;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If we have a cache of fixes, then use that</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_cirCacheArray.Length &gt; 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vErrorVal =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span style="color: #2b91af;">ACAD_COLOR</span>)err.PropertyValueGet(<span style="color: #a31515;">&quot;Color&quot;</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (vErrorVal.CompareTo(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[i].color</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) != 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If color property of fix matches error, then</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// add to list of fixes.</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arr[i] = m_cirCacheArray[i].pFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fixArray = arr;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_fixArray = fixArray;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Find the recommendedFixIndex</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// (we call this function to retrieve the index -</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// we don't need the returned fix object here)</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GetRecommendedFix(err);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recommendedFixIndex = m_recFixIndex;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Did we find a recommended fix along the way?</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (recommendedFixIndex == -1)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// No recomended fix, so set the proper flag on the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// error object</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResNoRecommendedFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// GetRecommendedFix</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Retrieves a fix object that describes the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// recommended fix</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">AcStFix</span> GetRecommendedFix(<span style="color: #2b91af;">AcStError</span> err)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> recFix = <span style="color: blue;">new</span> <span style="color: #2b91af;">AcStFix</span>();</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_cirCacheArray.Length == 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResNoRecommendedFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Get the objectId for this error</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> tmpObjID = err.BadObjectId;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Retrieve the object to fix from the DWG</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> tmpCircle =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span style="color: #2b91af;">AcadCircle</span>)m_checkDb.ObjectIdToObject(tmpObjID);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">double</span> radiusToBeChecked = tmpCircle.Radius;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">CircleCache</span> cirCache = m_cirCacheArray[0];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">double</span> diff =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Math</span>.Abs(radiusToBeChecked - cirCache.radius);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_recFixIndex = 0;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Attempt to get a fix color from the cached</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// m_CircleCacheArray</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Rule: the color of the standard circle with the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// nearest radius as the one to be fixed</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (diff &gt;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Math</span>.Abs(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; radiusToBeChecked - m_cirCacheArray[i].radius</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cirCache = m_cirCacheArray[i];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; diff =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Math</span>.Abs(radiusToBeChecked - cirCache.radius);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_recFixIndex = i;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Populate properties of the recommended fix object</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; recFix.Description = <span style="color: #a31515;">&quot;Color fix&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; recFix.StandardFileName =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[m_recFixIndex].</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; standardFileName;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; recFix.FixObjectName = <span style="color: #a31515;">&quot;Color&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (recFix.PropertyCount == 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recFix.PropertyValuePut(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;Color&quot;</span>,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[m_recFixIndex].color</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> recFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// GetPropertyDiffs</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Populates the provided arrays with the names of</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// properties that are present in the provided</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// error and fix objects (used to populate the fix</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// dialog with 'property name, current value, fix value')</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> GetPropertyDiffs(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStError</span> err,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStFix</span> fix,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">object</span> objPropNames,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">object</span> objErrorValues,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">object</span> objFixValues,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">object</span> objFixableStatuses)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (err != <span style="color: blue;">null</span>) </p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> propNames = <span style="color: blue;">new</span> <span style="color: blue;">string</span>[0];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> propName = <span style="color: #a31515;">&quot;&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> errorValues = <span style="color: blue;">new</span> <span style="color: blue;">string</span>[0];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> objErrorVal = <span style="color: blue;">new</span> <span style="color: blue;">object</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> fixValues = <span style="color: blue;">new</span> <span style="color: blue;">string</span>[0];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> objFixVal = <span style="color: blue;">new</span> <span style="color: blue;">object</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> fixableStatuses = <span style="color: blue;">new</span> <span style="color: blue;">bool</span>[0];</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Iterate error properties</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; err.PropertyCount; i++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.PropertyGetAt(i, <span style="color: blue;">ref</span> propName, <span style="color: blue;">ref</span> objErrorVal);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_propName = propName;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Retrieve corresponding Fix property value</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">try</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.PropertyValueGet(propName, <span style="color: blue;">ref</span> objFixVal);</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> errVal = (<span style="color: #2b91af;">ACAD_COLOR</span>)objErrorVal;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> fixVal = (<span style="color: #2b91af;">ACAD_COLOR</span>)objFixVal;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Fix object has the same prop, so see if they match</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (errVal.CompareTo(fixVal) != 0)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Store error and fix properties in array ready to</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// pass back to caller</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Array</span>.Resize&lt;<span style="color: blue;">string</span>&gt;(<span style="color: blue;">ref</span> propNames, i+1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; propNames[i] = propName;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Array</span>.Resize&lt;<span style="color: blue;">string</span>&gt;(<span style="color: blue;">ref</span> errorValues, i+1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errorValues[i] = StripAcPrefix(errVal.ToString());</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Array</span>.Resize&lt;<span style="color: blue;">string</span>&gt;(<span style="color: blue;">ref</span> fixValues, i+1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fixValues[i] = StripAcPrefix(fixVal.ToString());</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">Array</span>.Resize&lt;<span style="color: blue;">bool</span>&gt;(<span style="color: blue;">ref</span> fixableStatuses, i+1);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fixableStatuses[i] = <span style="color: blue;">true</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">catch</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Initialize the arrays supplied by caller</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; objPropNames = propNames;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; objErrorValues = errorValues;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; objFixValues = fixValues;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; objFixableStatuses = fixableStatuses;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_fixCnt++;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// StripAcPrefix</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Helper function to make color names prettier</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">string</span> StripAcPrefix(<span style="color: blue;">string</span> p)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (p.StartsWith(<span style="color: #a31515;">&quot;ac&quot;</span>))</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> p.Substring(2);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> p;</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// FixError</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Takes an error and a fix object and attempts</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// to fix the error</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> FixError(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStError</span> err,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStFix</span> fix,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">out</span> <span style="color: blue;">string</span> failureReason)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; failureReason = <span style="color: #a31515;">&quot;&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (err != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> badObjID = err.BadObjectId;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Retrieve object to fix from DWG</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> badObj =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span style="color: #2b91af;">AcadCircle</span>)m_checkDb.ObjectIdToObject(badObjID);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (fix == <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// If the fix object is null then attempt to get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// the recommended fix</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> tmpFix = GetRecommendedFix(err);</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (tmpFix == <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Set the error's result status to failed and</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// noRecommendedFix</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus = </p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResNoRecommendedFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix = tmpFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (fix != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Fix the bad circle</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> sFixVal = <span style="color: blue;">new</span> <span style="color: blue;">object</span>();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fix.PropertyValueGet(m_propName, <span style="color: blue;">ref</span> sFixVal);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> fixVal = (<span style="color: #2b91af;">ACAD_COLOR</span>)sFixVal;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">try</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; badObj.color = fixVal;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResFixed;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">catch</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err.ResultStatus =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcStResultStatus</span>.acStResFixFailed;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Clear</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Clears the plugin state and releases any cached</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// objects</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Clear()</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Called just before a plugin is released.</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Use this function to tidy up after yourself</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_plugin = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_curIndex = -1;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_recFixIndex = -1;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_fixCnt = 0;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_propName = <span style="color: #a31515;">&quot;&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_mgr = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_dwsDb = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_checkDb = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_err != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_err.Reset();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_err = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_cirCacheArray != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_cirCacheArray[i].pFix != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[i].pFix.Reset();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_cirCacheArray[i].pFix = <span style="color: blue;">null</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; m_contexts.Clear();</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// CheckSysvar</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Checks a system variable</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> CheckSysvar(</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">string</span> sysvarName,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">bool</span> getAllFixes,</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">ref</span> <span style="color: blue;">bool</span> passFail)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// StampDatabase</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns whether the plugin uses information</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// from the database for checking</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> StampDatabase(<span style="color: #2b91af;">AcadDatabase</span> db, <span style="color: blue;">ref</span> <span style="color: blue;">bool</span> stampIt)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// If the DWS contains circles, we stamp it by</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// returning stampIt as true, otherwise, returning</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// stampIt as false</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; stampIt = <span style="color: blue;">false</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">foreach</span> (</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">AcadObject</span> obj <span style="color: blue;">in</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_mgr.get_ModelSpaceProxy(db)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; )</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (obj.ObjectName == <span style="color: #a31515;">&quot;AcDbCircle&quot;</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stampIt = <span style="color: blue;">true</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">break</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// UpdateStatus</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Updates the result status of the provided error</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> UpdateStatus(<span style="color: #2b91af;">AcStError</span> err)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// WritePluginInfo</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Takes an AcStPluginInfoSection node and creates a</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// new AcStPluginInfo node below it (note: used by the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Batch Standards Checker to get information about the</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// plugin)</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> WritePluginInfo(<span style="color: blue;">object</span> objSectionNode)</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> section = (<span style="color: #2b91af;">IXMLDOMNode</span>)objSectionNode;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> xml =</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; section.ownerDocument.createElement(<span style="color: #a31515;">&quot;AcStPluginInfo&quot;</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">var</span> info = (<span style="color: #2b91af;">IXMLDOMElement</span>)section.appendChild(xml);</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;PluginName&quot;</span>, Name);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;Version&quot;</span>, Version);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;Description&quot;</span>, Description);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;Author&quot;</span>, Author);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;HRef&quot;</span>, HRef);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;DWSName&quot;</span>, <span style="color: #a31515;">&quot;&quot;</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; info.setAttribute(<span style="color: #a31515;">&quot;Status&quot;</span>, <span style="color: #a31515;">&quot;1&quot;</span>);</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Author</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns the name of the plugin's author</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> Author</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> <span style="color: #a31515;">&quot;Kean Walmsley, Autodesk, Inc.&quot;</span>; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Description</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns a description of what the plugin checks</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> Description</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;Checks that circles in a drawing have a color &quot;</span> +</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;that matches those of a similar radius in an &quot;</span> +</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;associated standards file.&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// HRef</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns a URL where the plugin can be obtained</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> HRef</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a31515;">&quot;http://blogs.autodesk.com/through-the-interface&quot;</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Icon</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns the HICON property Icon</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">int</span> Icon</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> 1; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Name</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns the name of the plugin</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> Name</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> <span style="color: #a31515;">&quot;Circle color checker&quot;</span>; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Version</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Returns the version of the plugin</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> Version</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> <span style="color: #a31515;">&quot;2.0&quot;</span>; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// CircleCache</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Caches &quot;standard&quot; circle properties (Color, Radius)</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// from .DWS files, as well as pointers to the circle's</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// relevant AcStFix object </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">CircleCache</span></p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">double</span> radius;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">ACAD_COLOR</span> color;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> standardFileName;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">AcStFix</span> pFix;</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// ContextList</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// Manages list of objects to check - either all in</span></p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">// database, or just those recently added or modified</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">ContextList</span></p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// List of objects to use when not in database context</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">List</span>&lt;<span style="color: blue;">long</span>&gt; m_altIdArray = <span style="color: blue;">new</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: blue;">long</span>&gt;();</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: #2b91af;">List</span>&lt;<span style="color: blue;">long</span>&gt; m_dbIdArray = <span style="color: blue;">new</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: blue;">long</span>&gt;();</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// All objects in database</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">private</span> <span style="color: blue;">bool</span> m_useDb;</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Return item from correct context list</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">long</span> <span style="color: blue;">this</span>[<span style="color: blue;">int</span> index]</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_useDb)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> m_dbIdArray[index];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> m_altIdArray[index];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Number of items in current list</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">int</span> Count</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (m_useDb)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> m_dbIdArray.Count;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span> m_altIdArray.Count;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Flag to determine from which context list to return element</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Select all database or just modified items for checking</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// (but also add any new ids to database array</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> SetContext(<span style="color: blue;">bool</span> useDb, <span style="color: blue;">object</span> objContextArray)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (!useDb &amp;&amp; objContextArray != <span style="color: blue;">null</span>)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_useDb = <span style="color: blue;">false</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">long</span>[] idArray = (<span style="color: blue;">long</span>[])objContextArray;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; idArray.Length; i++)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">long</span> val = (<span style="color: blue;">long</span>)idArray[i];</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_altIdArray.Add(val);</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Have to keep database list up to date</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_dbIdArray.Add(val);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">// Clear </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_useDb = <span style="color: blue;">true</span>;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_altIdArray.Clear();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Add(<span style="color: blue;">long</span> id, <span style="color: blue;">bool</span> useDb)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">if</span> (useDb)</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_dbIdArray.Add(id);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">else</span></p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_altIdArray.Add(id);</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: green;">// Clear both lists</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> Clear()</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_altIdArray.Clear();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; m_dbIdArray.Clear();</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">long</span> <span style="color: #2b91af;">IAcStPlugin2</span>.Icon</p> <p style="margin: 0px;">&nbsp; &nbsp; {</p> <p style="margin: 0px;">&nbsp; &nbsp; &nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> 0; }</p> <p style="margin: 0px;">&nbsp; &nbsp; }</p> <p style="margin: 0px;">&nbsp; }</p> <p style="margin: 0px;">}</p> </div>  <p>Thanks to Augusto for his help getting this ready!</p>
