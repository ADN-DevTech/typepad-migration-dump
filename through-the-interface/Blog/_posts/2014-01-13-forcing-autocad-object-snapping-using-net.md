---
layout: "post"
title: "Forcing AutoCAD object snapping using .NET"
date: "2014-01-13 12:00:08"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Geometry"
  - "Notification / Events"
  - "Personal"
  - "Runtime"
  - "User interface"
original_url: "https://www.keanw.com/2014/01/forcing-autocad-object-snapping-using-net.html "
typepad_basename: "forcing-autocad-object-snapping-using-net"
typepad_status: "Publish"
---

<p>I was up in <a href="http://en.wikipedia.org/wiki/Adelboden" target="_blank">Adelboden</a>, this weekend, for <a href="http://weltcup-adelboden.ch/en/Event/Race_2014/Race_program" target="_blank">the Men’s FIS World Cup Slalom and Giant Slalom events</a>. Yes, just watching – not participating :-) – although I did get the chance to catch a few much gentler slopes on my snowboard during the course of the weekend.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2019b04ae8c4b970d-pi" target="_blank"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top: 0px; border-right: 0px; padding-top: 0px" title="FIS World Cup in Adelboden" border="0" alt="FIS World Cup in Adelboden" src="/assets/image_368392.jpg" width="450" height="342" /></a></p>  <p>On the Saturday – during the Giant Slalom – there was a pretty amazing incident: a young Norwegian competitor, Henrik Kristofferson, <a href="https://www.youtube.com/watch?v=CsmNxLuygQE" target="_blank">very nearly hit a television worker during his first run down</a>. Thankfully no-one was hurt, and Henrik was <a href="http://olympictalk.nbcsports.com/2014/01/12/austrias-marcel-hirscher-wins-adelboden-slalom-takes-world-cup-points-lead/" target="_blank">very understanding</a> about the whole thing (he was given a restart but, given the fact he was at the end of a grueling descent when the collision so nearly happened, there was very little chance of him contending, at that point). Henrik did go on to come third in the following day’s Slalom event which is something, at least.</p>  <p>While I was on the slopes, I had the chance to think about <a href="http://through-the-interface.typepad.com/through_the_interface/2013/12/disabling-snapping-to-specific-autocad-objects-using-net-part-1.html?cid=6a00d83452464869e2019b048c282e970d#comment-6a00d83452464869e2019b048c282e970d" target="_blank">a comment submitted on Friday by Mark Douglas</a> in response to <a href="http://through-the-interface.typepad.com/through_the_interface/2013/12/disabling-snapping-to-specific-autocad-objects-using-net-part-1.html" target="_blank">this previous post</a>:</p>  <blockquote>   <p><em>Is it possible thru code like this to prevent a user from creating anything that is not inserted, drawn or connected to an osnap? I.E. A way to make sure a user is always drawing things that are connected to other objects via OSNAP? Use case is where someone is not drawing accurately this would only allow them to place items via OSNAP settings and not miss endpoints and such. (Obviously some times you have to, but it would be like training wheels for people drafting) Just a thought..</em></p> </blockquote>  <p>At first I thought this was going to be complicated to implement, but then I remembered the PointFilter mechanism. This is a bit like the very handy PointMonitor event handler but it also allows you to manipulate the “input” points that get computed inside AutoCAD and even to reject ones you don’t like. As with the PointMonitor, you also get some “history” information about the way the point was computed, which happily includes whether an object snap was used or not.</p>  <p>All in all the code ended up being very simple. Here’s some C# code implementing a command (FORSNAP) which enables a mode that forces users only to snap to objects. There’s a matching UNFORSNAP command, of course, as this is just the kind of mode that could drive people crazy if enabled and left on. (Any of you with a practical joker in your department who knows how to use Visual Studio should bear this in mind in case strange things start to happen… ;-)</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> OnlyObjectSnapping</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;FORSNAP&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> ForceObjectSnapping()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> doc = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> ed = doc.Editor;&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; ed.PointFilter += </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PointFilterEventHandler</span><span style="line-height: 140%">(OnPointFilter);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;UNFORSNAP&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> DisableForcedObjectSnapping()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> doc = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> ed = doc.Editor;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; ed.PointFilter -= </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PointFilterEventHandler</span><span style="line-height: 140%">(OnPointFilter);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> OnPointFilter(</span><span style="line-height: 140%; color: blue">object</span><span style="line-height: 140%"> sender, </span><span style="line-height: 140%; color: #2b91af">PointFilterEventArgs</span><span style="line-height: 140%"> e)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Only if a command is active</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> cmdActive =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (</span><span style="line-height: 140%; color: blue">short</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.GetSystemVariable(</span><span style="line-height: 140%; color: #a31515">&quot;CMDACTIVE&quot;</span><span style="line-height: 140%">) == 1;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (e.Context.PointComputed &amp;&amp; cmdActive)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Check whether the point has been computed via an</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// object snap</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (e.Context.History &amp; </span><span style="line-height: 140%; color: #2b91af">PointHistoryBits</span><span style="line-height: 140%">.ObjectSnapped) == 0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// If not, don't accept it</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; e.Result.Retry = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p>Tomorrow I'll be waking up at the crack of dawn to head to Tel Aviv. Hopefully I'll get the chance to report back on my visit to the Autodesk office there at some point during the coming week.</p>
