---
layout: "post"
title: "Getting the length of the pipe centrelines in an AutoCAD drawing &ndash; Part 1"
date: "2014-01-28 17:28:29"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Geometry"
  - "Graphics system"
  - "Solid modeling"
original_url: "https://www.keanw.com/2014/01/getting-the-length-of-the-pipe-centrelines-in-an-autocad-drawing-part-1.html "
typepad_basename: "getting-the-length-of-the-pipe-centrelines-in-an-autocad-drawing-part-1"
typepad_status: "Publish"
---

<p>Since publishing <a href="http://through-the-interface.typepad.com/through_the_interface/2014/01/extracting-pipe-centrelines-from-autocad-surfaces-using-net.html" target="_blank">this recent post</a> to simplify the process of generating centrelines for surfaces representing pipes – as imported from an external piping system that only generates SAT files – I’ve been thinking on and off about how best to simplify the process of measuring the lengths of these various “pipes”.</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/2014/01/extracting-pipe-centrelines-from-autocad-surfaces-using-net.html#comment-6a00d83452464869e201a3fca7fb52970b" target="_blank">Greg Robinson’s comment</a> over the weekend spurred me on even further (thanks, Greg! :-):</p>  <blockquote>   <p><em>I'm musing on how one might code up the logic of creating a single continuous 3D poly from the horrid collection of surfaces the step file (.sat) make.       <br />This is a daunting logic issue. As humans we can &quot;visually&quot; prescribe a pipe. How does one ask a machine to do it?        <br />Then after you solve the simple piping route how do you explain to the machine there are many to one relationships of pipes, like a tree? Hmmm, growing a tree..…</em></p> </blockquote>  <p>This is really an interesting point. In my mind it calls into question the common assumption that it makes sense to have the computer attempt to solve this problem on its own. Very often having the user provide some guidance – perhaps selecting the pipes in sequence for them to have their centrelines extracted and stitched, or letting the user select the centrelines to stitch and measure one-by-one – can lead to better results and still save considerable time and effort.</p>  <p>In the coming posts we’re going to attempt the following two things, in fact:</p>  <ol>   <li>Provide two simple commands: one to generate centrelines for a bunch of pipe-representing surfaces and another to count the length of a selected set of curves.</li>    <ul>     <li>The point is that one of these can be used to feed the other, with some human intervention (to only select the appropriate geometry).</li>   </ul>    <li>Provide a more complex command that asks the user to select pipes in sequence, at which point it will validate the contiguity of the sections before continuing and providing an overall length.</li> </ol>  <p>We’ll take a look at these two “tasks” in the next few posts. In the meantime, though, it’s worth re-considering the problem itself. The problem is really to count the lengths of the pipes, rather than to create a single centreline (although Greg should really step in and say if a single centreline is actually going to be needed). Looking at this problem in terms of counting the lengths of “connected” sections of pipes ends up being more straightforward and ultimately more accurate: 3D polylines don’t have arc segments, which means that any single 3D object is likely to be an approximation of the desired geometry.</p>  <p>I did look at generating a sequence of 2D Polyline objects using Entity.JoinEntities(), but creating planar entities in 3D space just proved too problematic (it’s an interesting API, though, so I’ll be sure to cover it in a post at some point).</p>  <p>It also occurred to me that having the pipes grouped in some way – for instance using a block or a group – might also be helpful: maintaining the objects in some kind of container or persistent collection would allow the operation to count their lengths to be repeated more easily (which I expect is the primary reason for generating a single centreline).</p>  <p>Should neither of the overall approaches prove to be compelling, we can certainly look at something more automated. But I definitely see headwind there: even the act of deciding whether a particular polyline should belong to a section of pipe or should be discarded as being the centreline of a cross section (the technique we implemented previously generates both, for better or worse) ends up being quite tricky. You can check to see whether it’s perpendicular to the overall pipe direction, but that could provide false positives and negatives, unless you get a more local direction. And that’s a relatively simple piece of the puzzle… which just steers me further towards asking the user, instead. :-)</p>  <p>More on this soon…</p>
