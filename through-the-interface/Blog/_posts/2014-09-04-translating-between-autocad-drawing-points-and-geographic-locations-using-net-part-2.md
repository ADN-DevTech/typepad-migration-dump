---
layout: "post"
title: "Translating between AutoCAD drawing points and geographic locations using .NET &ndash; Part 2"
date: "2014-09-04 14:49:50"
author: "Kean Walmsley"
categories:
  - "AU"
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Geo-location"
  - "Geometry"
original_url: "https://www.keanw.com/2014/09/translating-between-autocad-drawing-points-and-geographic-locations-using-net-part-2.html "
typepad_basename: "translating-between-autocad-drawing-points-and-geographic-locations-using-net-part-2"
typepad_status: "Publish"
---

<p>In <a href="http://through-the-interface.typepad.com/through_the_interface/2014/09/translating-between-autocad-drawing-points-and-geographic-locations-using-net-part-1.html" target="_blank">yesterday’s post</a> we saw a simple implementation of two commands to translate between geographical locations (latitude-longitude values) and drawing points inside AutoCAD.</p>  <p>In this post we’re extending that to access the current coordinate system, as returned by the GeoLocation object attached to the current drawing. Which in some ways should be simple, but then the CoordinateSystem property actually returns XML data, not just the simple coordinate system name you probably passed in when choosing it (see the IGR command, below, to see what I mean):</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">&lt;?</span><span style="color: #a31515">xml</span><span style="color: blue"> </span><span style="color: red">version</span><span style="color: blue">=</span>&quot;<span style="color: blue">1.0</span>&quot;<span style="color: blue"> </span><span style="color: red">encoding</span><span style="color: blue">=</span>&quot;<span style="color: blue">utf-16</span>&quot;<span style="color: blue"> </span><span style="color: red">standalone</span><span style="color: blue">=</span>&quot;<span style="color: blue">no</span>&quot;<span style="color: blue"> ?&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">Dictionary</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; </span><span style="color: red">version</span><span style="color: blue">=</span>&quot;<span style="color: blue">1.0</span>&quot;</p>    <p style="margin: 0px"><span style="color: blue">&#160; </span><span style="color: red">xmlns</span><span style="color: blue">=</span>&quot;<span style="color: blue">http://www.osgeo.org/mapguide/coordinatesystem</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">ProjectedCoordinateSystem</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">SWISS</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span>SWISS<span style="color: blue">&lt;/</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; Deprecated as duplicate of CH1903.LV03/01</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span>Bundesamt fur Landestopographie<span style="color: blue">&lt;/</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AdditionalInformation</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterItem</span><span style="color: blue"> </span><span style="color: red">type</span><span style="color: blue">=</span>&quot;<span style="color: blue">CsMap</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Key</span><span style="color: blue">&gt;</span>CSQuadrantSimplified<span style="color: blue">&lt;/</span><span style="color: #a31515">Key</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">IntegerValue</span><span style="color: blue">&gt;</span>1<span style="color: blue">&lt;/</span><span style="color: #a31515">IntegerValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterItem</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">AdditionalInformation</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">DatumId</span><span style="color: blue">&gt;</span>CH-1903<span style="color: blue">&lt;/</span><span style="color: #a31515">DatumId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Axis</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">METER</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">CoordinateSystemAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisOrder</span><span style="color: blue">&gt;</span>1<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisOrder</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisName</span><span style="color: blue">&gt;</span>Easting<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisName</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisAbbreviation</span><span style="color: blue">&gt;</span>E<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisAbbreviation</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisDirection</span><span style="color: blue">&gt;</span>east<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisDirection</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">CoordinateSystemAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">CoordinateSystemAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisOrder</span><span style="color: blue">&gt;</span>2<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisOrder</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisName</span><span style="color: blue">&gt;</span>Northing<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisName</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisAbbreviation</span><span style="color: blue">&gt;</span>N<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisAbbreviation</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">AxisDirection</span><span style="color: blue">&gt;</span>north<span style="color: blue">&lt;/</span><span style="color: #a31515">AxisDirection</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">CoordinateSystemAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Axis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Conversion</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Projection</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationMethodId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Swiss Oblique Cylindrical</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationMethodId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Longitude of false origin</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">degree</span>&quot;<span style="color: blue">&gt;</span>7.43958333333333<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Latitude of false origin</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">degree</span>&quot;<span style="color: blue">&gt;</span>46.9524055555556<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span>False easting<span style="color: blue">&lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">METER</span>&quot;<span style="color: blue">&gt;</span>600000<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span>False northing<span style="color: blue">&lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">METER</span>&quot;<span style="color: blue">&gt;</span>200000<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Projection</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Conversion</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">ProjectedCoordinateSystem</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">GeodeticDatum</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">CH-1903</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span>CH-1903<span style="color: blue">&lt;/</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; Swiss National Geodetic System Aug 1990, Switzerland (7 Param)</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span>Bundesamt fur Landestopographie<span style="color: blue">&lt;/</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">PrimeMeridianId</span><span style="color: blue">&gt;</span>Greenwich<span style="color: blue">&lt;/</span><span style="color: #a31515">PrimeMeridianId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">EllipsoidId</span><span style="color: blue">&gt;</span>BESSEL<span style="color: blue">&lt;/</span><span style="color: #a31515">EllipsoidId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">GeodeticDatum</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">Alias</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">6801</span>&quot;<span style="color: blue"> </span><span style="color: red">type</span><span style="color: blue">=</span>&quot;<span style="color: blue">Datum</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ObjectId</span><span style="color: blue">&gt;</span>CH-1903<span style="color: blue">&lt;/</span><span style="color: #a31515">ObjectId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Namespace</span><span style="color: blue">&gt;</span>EPSG Code<span style="color: blue">&lt;/</span><span style="color: #a31515">Namespace</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">Alias</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">Ellipsoid</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">BESSEL</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span>BESSEL<span style="color: blue">&lt;/</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span>Bessel, 1841<span style="color: blue">&lt;/</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; US Defense Mapping Agency, TR-8350.2-B, December 1987</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">SemiMajorAxis</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>6377397.155<span style="color: blue">&lt;/</span><span style="color: #a31515">SemiMajorAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">SecondDefiningParameter</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">SemiMinorAxis</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>6356078.963<span style="color: blue">&lt;/</span><span style="color: #a31515">SemiMinorAxis</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">SecondDefiningParameter</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">Ellipsoid</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">Alias</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">7004</span>&quot;<span style="color: blue"> </span><span style="color: red">type</span><span style="color: blue">=</span>&quot;<span style="color: blue">Ellipsoid</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ObjectId</span><span style="color: blue">&gt;</span>BESSEL<span style="color: blue">&lt;/</span><span style="color: #a31515">ObjectId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Namespace</span><span style="color: blue">&gt;</span>EPSG Code<span style="color: blue">&lt;/</span><span style="color: #a31515">Namespace</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">Alias</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;</span><span style="color: #a31515">Transformation</span><span style="color: blue"> </span><span style="color: red">id</span><span style="color: blue">=</span>&quot;<span style="color: blue">CH-1903_to_WGS84</span>&quot;<span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span>CH-1903_to_WGS84<span style="color: blue">&lt;/</span><span style="color: #a31515">Name</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; Swiss National Geodetic System Aug 1990, Switzerland (7 Param)</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">Description</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span>Bundesamt fur Landestopographie<span style="color: blue">&lt;/</span><span style="color: #a31515">Authority</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">CoordinateOperationAccuracy</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Accuracy</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>3<span style="color: blue">&lt;/</span><span style="color: #a31515">Accuracy</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">CoordinateOperationAccuracy</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">SourceDatumId</span><span style="color: blue">&gt;</span>CH-1903<span style="color: blue">&lt;/</span><span style="color: #a31515">SourceDatumId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">TargetDatumId</span><span style="color: blue">&gt;</span>WGS84<span style="color: blue">&lt;/</span><span style="color: #a31515">TargetDatumId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">IsReversible</span><span style="color: blue">&gt;</span>true<span style="color: blue">&lt;/</span><span style="color: #a31515">IsReversible</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationMethod</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationMethodId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Seven Parameter Transformation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationMethodId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; X-axis translation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>660.077<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Y-axis translation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>13.551<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Z-axis translation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">meter</span>&quot;<span style="color: blue">&gt;</span>369.344<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; X-axis rotation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">degree</span>&quot;<span style="color: blue">&gt;</span>0.00022356<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Y-axis rotation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">degree</span>&quot;<span style="color: blue">&gt;</span>0.00016047<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Z-axis rotation</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">degree</span>&quot;<span style="color: blue">&gt;</span>0.00026451<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Scale difference</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationParameterId</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">Value</span><span style="color: blue"> </span><span style="color: red">uom</span><span style="color: blue">=</span>&quot;<span style="color: blue">unity</span>&quot;<span style="color: blue">&gt;</span>5.66e-006<span style="color: blue">&lt;/</span><span style="color: #a31515">Value</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">ParameterValue</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">OperationMethod</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160; &lt;/</span><span style="color: #a31515">Transformation</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">Dictionary</span><span style="color: blue">&gt;</span></p> </div>  <p>While I’m sure this contains some great information, in our case we’re just after the name of the chosen coordinate system (i.e. “SWISS”).</p>  <p>To access this, we’ve integrated some code from <a href="http://stackoverflow.com/questions/13704752/deserialize-xml-to-object-using-dynamic" target="_blank">here</a> and <a href="http://social.msdn.microsoft.com/Forums/en-US/bed57335-827a-4731-b6da-a7636ac29f21/xdocument-remove-namespace" target="_blank">here</a>, so that we can use a dynamic object to navigate down through the XML DOM and we don’t have to worry about namespace prefixes (which would otherwise be the case with the above XML data, for instance).</p>  <p>That allows us to access the contents of the coordinate system XML much more easily. Here’s how we access the “id” attribute of the ProjectedCoordinateSystem element, for instance:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">csx.ProjectedCoordinateSystem.id;</p> </div>  <p>The same approach might be used to access whatever else you’re interested in from the XML coordinate system information, of course.</p>  <p>Here’s a Screencast of the updated commands in action:</p>  <br /><iframe height="294" src="https://screencast.autodesk.com/Embed/b57f2e0e-7654-4b58-93e1-f46ac0387601" frameborder="0" width="470" webkitallowfullscreen="webkitallowfullscreen" allowfullscreen="allowfullscreen"></iframe>  <br />  <br />  <p>Here’s the C# code that includes the XML parsing code as well as the updated LLFP and PFLL commands:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.ApplicationServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.DatabaseServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.EditorInput;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Geometry;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Microsoft.CSharp.RuntimeBinder;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Dynamic;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Linq;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Text.RegularExpressions;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Xml.Linq;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> GeoLocationAPI</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Commands</span></p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;IGR&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> InsertGeoRef()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> msId = <span style="color: #2b91af">SymbolUtilityServices</span>.GetBlockModelSpaceId(db);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (HasGeoData(db))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Report and return: could also open the object for</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// write and modify its properties, of course</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(<span style="color: #a31515">&quot;\nDrawing already has geo-location data!&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Let's create some geolocation data for this drawing,</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// using a handy method to add it to the modelspace</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// (it gets added to the extension dictionary)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> data = <span style="color: blue">new</span> <span style="color: #2b91af">GeoLocationData</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.BlockTableRecordId = msId;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.PostToDb();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We're going to define our geolocation in terms of</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// latitude/longitude using the Mercator projection</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// http://en.wikipedia.org/wiki/Mercator_projection</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.CoordinateSystem = <span style="color: #a31515">&quot;WORLD-MERCATOR&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.TypeOfCoordinates = <span style="color: #2b91af">TypeOfCoordinates</span>.CoordinateTypeGrid;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Use the lat-long for La Tene, my local &quot;beach&quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// (it's on a lake, after all :-)&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> geoPt = <span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(7.019438, 47.005247, 0);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Transform from a geographic to a modelspace point</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// and add the information to our geolocation data</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> wcsPt = data.TransformFromLonLatAlt(geoPt);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.DesignPoint = wcsPt;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; data.ReferencePoint = geoPt;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Let's launch the GEOMAP command to show our geographic</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// overlay</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.GEOMAP&quot;</span>, <span style="color: #a31515">&quot;_AERIAL&quot;</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Now we'll add a circle around our location</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// and that will provide the extents for our zoom</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tr = db.TransactionManager.StartTransaction())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ms =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(msId, <span style="color: #2b91af">OpenMode</span>.ForWrite) <span style="color: blue">as</span> <span style="color: #2b91af">BlockTableRecord</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ms != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Add a red circle of 7K units radius</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// centred on our point</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> circle = <span style="color: blue">new</span> <span style="color: #2b91af">Circle</span>(wcsPt, <span style="color: #2b91af">Vector3d</span>.ZAxis, 7000);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; circle.ColorIndex = 1;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ms.AppendEntity(circle);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(circle, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And we'll zoom to the circle's extents</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.ZOOM&quot;</span>, <span style="color: #a31515">&quot;_OBJECT&quot;</span>, <span style="color: #a31515">&quot;_L&quot;</span>, <span style="color: #a31515">&quot;&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;CGI&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> CreateGeoMapImage()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the first corner of our area to convert to a</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// GeomapImage</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ppo = <span style="color: blue">new</span> <span style="color: #2b91af">PromptPointOptions</span>(<span style="color: #a31515">&quot;\nSpecify first corner&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ppr = ed.GetPoint(ppo);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ppr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> first = ppr.Value;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And get the second point as a corner (to rubber-band</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the selection)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> pco =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">PromptCornerOptions</span>(<span style="color: #a31515">&quot;\nSpecify second corner&quot;</span>, first);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ppr = ed.GetCorner(pco);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ppr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> second = ppr.Value;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We'll use an event handler on the Database to check for</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// GeomapImage entities being added</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// (we'll use a lambda but assigned to a variable to be</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// able to remove it, afterwards)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ObjectId</span> giId = <span style="color: #2b91af">ObjectId</span>.Null;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ObjectEventHandler</span> handler =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (s, e) =&gt;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (e.DBObject <span style="color: blue">is</span> <span style="color: #2b91af">GeomapImage</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; giId = e.DBObject.ObjectId;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; };</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Simply call the GEOMAPIMAGE command with the two points</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; db.ObjectAppended += handler;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.GEOMAPIMAGE&quot;</span>, first, second);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; db.ObjectAppended -= handler;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Only continue if we've collected a valid ObjectId</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (giId == <span style="color: #2b91af">ObjectId</span>.Null)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Open the entity and change some values</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tr = doc.TransactionManager.StartTransaction())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get each object and check if it's a GeomapImage</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> gi =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(giId, <span style="color: #2b91af">OpenMode</span>.ForWrite) <span style="color: blue">as</span> <span style="color: #2b91af">GeomapImage</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (gi != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Let's adjust the brightmess/contrast/fade of the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// GeomapImage</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.Brightness = 90;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.Contrast = 40;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.Fade = 20;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And make sure it's at the right resolution and</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// shows both aerial and road information</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.Resolution = <span style="color: #2b91af">GeomapResolution</span>.Optimal;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.MapType = <span style="color: #2b91af">GeomapType</span>.Hybrid;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gi.UpdateMapImage(<span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span> (Autodesk.AutoCAD.Runtime.<span style="color: #2b91af">Exception</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nUnable to update geomap image entity.&quot;</span> +</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nPlease check your internet connectivity and call &quot;</span> +</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;GEOMAPIMAGEUPDATE.&quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;LLFP&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> LatLongFromPoint()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (!HasGeoData(db))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nCurrent drawing has no geo-location information.&quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the drawing point to be translated into a lat-lon</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ppo = <span style="color: blue">new</span> <span style="color: #2b91af">PromptPointOptions</span>(<span style="color: #a31515">&quot;\nSpecify point&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ppr = ed.GetPoint(ppo);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ppr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> dwgPt = ppr.Value;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Translate the drawing point to a lat-lon</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> res = TranslateGeoPoint(db, dwgPt, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Print any coordinate system information</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; PrintCoordinateSystem(ed, res.Item2);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And then the point itself</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> lonlat = res.Item1;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nLatitude-longitude is {0},{1}&quot;</span>, lonlat.Y, lonlat.X</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;PFLL&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> PointFromLatLong()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (!HasGeoData(db))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nCurrent drawing has no geo-location information.&quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the latitude and longitude to be translated</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// to a drawing point</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> pdo = <span style="color: blue">new</span> <span style="color: #2b91af">PromptDoubleOptions</span>(<span style="color: #a31515">&quot;\nEnter latitude&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> pdr = ed.GetDouble(pdo);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (pdr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> lat = pdr.Value;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; pdo.Message = <span style="color: #a31515">&quot;\nEnter longitude&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; pdr = ed.GetDouble(pdo);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (pdr.Status != <span style="color: #2b91af">PromptStatus</span>.OK)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> lon = pdr.Value;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> lonlat = <span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(lon, lat, 0.0);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Translate the lat-lon to a drawing point</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> res = TranslateGeoPoint(db, lonlat, <span style="color: blue">false</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Print any coordinate system information</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(res.Item2);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; PrintCoordinateSystem(ed, res.Item2);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And then the point itself</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> dwgPt = res.Item1;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\nDrawing point is {0},{1},{2}&quot;</span>, dwgPt.X, dwgPt.Y, dwgPt.Z</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">void</span> PrintCoordinateSystem(<span style="color: #2b91af">Editor</span> ed, <span style="color: blue">string</span> xml)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">dynamic</span> csx = <span style="color: #2b91af">DynamicXml</span>.Parse(xml);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> cs = csx.ProjectedCoordinateSystem.id;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(<span style="color: #a31515">&quot;\nCoordinate system: {0}&quot;</span>, cs);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span> (<span style="color: #2b91af">RuntimeBinderException</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(<span style="color: #a31515">&quot;\nNo coordinate system information.&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">Tuple</span>&lt;<span style="color: #2b91af">Point3d</span>, <span style="color: blue">string</span>&gt; TranslateGeoPoint(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Database</span> db, <span style="color: #2b91af">Point3d</span> inPt, <span style="color: blue">bool</span> fromDwg</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> tr = db.TransactionManager.StartOpenCloseTransaction()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the drawing's GeoLocation object</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> gd =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(db.GeoDataObject, <span style="color: #2b91af">OpenMode</span>.ForRead)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">as</span> <span style="color: #2b91af">GeoLocationData</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the output point...</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// dwg2lonlat if fromDwg is true,</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// lonlat2dwg otherwise</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> outPt =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (fromDwg ?</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gd.TransformToLonLatAlt(inPt) :</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; gd.TransformFromLonLatAlt(inPt)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> cs = gd.CoordinateSystem;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">Tuple</span>&lt;<span style="color: #2b91af">Point3d</span>, <span style="color: blue">string</span>&gt;(outPt, cs);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">bool</span> HasGeoData(<span style="color: #2b91af">Database</span> db)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Check whether the drawing already has geolocation data</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span> hasGeoData = <span style="color: blue">false</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> gdId = db.GeoDataObject;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; hasGeoData = <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span> { }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> hasGeoData;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// From</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// http://stackoverflow.com/questions/13704752/</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// deserialize-xml-to-object-using-dynamic</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// and</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// http://social.msdn.microsoft.com/Forums/en-US/</span></p>    <p style="margin: 0px">&#160; <span style="color: green">// bed57335-827a-4731-b6da-a7636ac29f21/xdocument-remove-namespace</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DynamicXml</span> : <span style="color: #2b91af">DynamicObject</span></p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">XElement</span> _root;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> DynamicXml(<span style="color: #2b91af">XElement</span> root)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; _root = root;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">DynamicXml</span> Parse(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> xmlString, <span style="color: blue">bool</span> stripNamespaces = <span style="color: blue">true</span></p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">XDocument</span>.Parse(xmlString);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (stripNamespaces)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; doc = StripDocumentNamespaces(doc);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">DynamicXml</span>(doc.Root);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">DynamicXml</span> Load(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> filename, <span style="color: blue">bool</span> stripNamespaces = <span style="color: blue">true</span></p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">XDocument</span>.Load(filename);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (stripNamespaces)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; doc = StripDocumentNamespaces(doc);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">DynamicXml</span>(doc.Root);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">XDocument</span> StripDocumentNamespaces(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">XDocument</span> doc</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Remove all xmlns:* instances from the passed XDocument</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">XDocument</span>.Parse(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Regex</span>.Replace(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; doc.ToString(), <span style="color: #a31515">@&quot;(xmlns:?[^=]*=[&quot;&quot;][^&quot;&quot;]*[&quot;&quot;])&quot;</span>, <span style="color: #a31515">&quot;&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RegexOptions</span>.IgnoreCase | <span style="color: #2b91af">RegexOptions</span>.Multiline</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">bool</span> TryGetMember(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">GetMemberBinder</span> binder, <span style="color: blue">out</span> <span style="color: blue">object</span> result</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; result = <span style="color: blue">null</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Do we have an attribute with this name?</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> att = _root.Attribute(binder.Name);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (att != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; result = att.Value;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Do we have a list of elements with this name?</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> nodes = _root.Elements(binder.Name);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (nodes.Count() &gt; 1)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; result = nodes.Select(n =&gt; <span style="color: blue">new</span> <span style="color: #2b91af">DynamicXml</span>(n)).ToList();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Do we have a single element with this name?</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> node = _root.Element(binder.Name);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (node != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (node.HasElements)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; result = <span style="color: blue">new</span> <span style="color: #2b91af">DynamicXml</span>(node);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; result = node.Value;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p> </div>  <p>If you’re attending <a href="http://au.autodesk.com" target="_blank">AU 2014</a> and are interested in learning more about this API. I recommend signing up for a class being delivered by my friend and colleague, Mads Paulin: <a href="https://events.au.autodesk.com/connect/sessionDetail.ww?SESSION_ID=5436" target="_blank">Building Location-Aware Applications in AutoCAD 2015</a>. Mads is the software architect on the AutoCAD team who is responsible for this feature, so it’s a great opportunity to get information straight from the source. (Unfortunately this session conflicts with a class at which I’m co-speaking, otherwise I’d be there, too.)</p>
