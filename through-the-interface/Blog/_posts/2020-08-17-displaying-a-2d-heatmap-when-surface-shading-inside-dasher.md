---
layout: "post"
title: "Displaying a 2D heatmap when surface shading inside Dasher"
date: "2020-08-17 18:53:40"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
original_url: "https://www.keanw.com/2020/08/displaying-a-2d-heatmap-when-surface-shading-inside-dasher.html "
typepad_basename: "displaying-a-2d-heatmap-when-surface-shading-inside-dasher"
typepad_status: "Publish"
---

<p>A week or two ago, I had a meeting with some colleagues to discuss future needs for <a href="http://dasher360.com" target="_blank">Project Dasher</a>. One of these requirements related to an exhibit where we’re going to want to ignore all the 3D visualization of sensor data, and focus on the 2D case (I.e. where we shade a 2D floorplan with the sensor values).</p><p>When this came up I thought to myself “oh, this could be a good driver for us implementing a 2D workflow inside Dasher”, something I’ve chewed on in the past. This time around, I started off thinking about whether to use a 2D floorplan published via Revit through Forge, but decided to use an existing mechanism where we determine an approximate floorplan based on room volumes. (Part of the reasoning was flexibility – we want to be able to uses these graphics elsewhere, perhaps without the Forge viewer – but also because we don’t necessarily want to force people to generate 2D sheets: if we can determine a rough floorplan from existing information, then there’s real value in that.)</p><p>As a basis for this, I took two existing features inside Dasher (both of which were implemented primarily by my good friend and former colleague, Simon Breslav): one was the “room reference image”, where we generate a reference image encoding the positions of rooms on a particular level:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026be4095f1f200d-pi" target="_blank"><img width="500" height="320" title="2D room reference image being 'debugged' inside Dasher" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="2D room reference image being 'debugged' inside Dasher" src="/assets/image_967230.jpg" border="0"></a></p><p>This image (or rather these images, as we have one per level) is usually just held in memory: we perform a look-up when trying to find the room containing the current 3D location, which is especially useful when navigating a model in first person mode. (We have another reference image that helps us work out whether the cursor is currently over a sensor dot, at which point we can display a tooltip.)</p><p>Needless to say – for an image that’s usually not displayed – the above screenshot has been taken while we’re displaying the room reference image for debugging purposes.</p><p>The basic approach where we input room volumes – and use these with a vertically-located orthogonal camera to generate an image – is extremely relevant to generating a 2D heatmap. The other piece of the puzzle was to be able to take the custom shader we use to generate our “surface shading” effects and use that – once again – with an orthogonal camera to create a 2D view. Luckily this “just worked” for 2D, which was a pleasant surprise, to say the least.</p><p>This feature has now been implemented in Dasher, and you can turn it on for yourself via the settings dialog:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e95d4f76200b-pi" target="_blank"><img width="500" height="312" title="Turning on 2D heatmaps" style="margin: 30px auto; float: none; display: block;" alt="Turning on 2D heatmaps" src="/assets/image_403561.jpg"></a></p><p>The size of the heatmap can be set in the project settings, for now: this isn’t ideal, so I’m exploring different ways of making this user-resizable.</p><p>The heatmap animates nicely alongside the 3D version, which is really cool. Here’s an animation of a larger version of the heatmap – this time showing CO2 values – along with the 3D view:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bde8aa003200c-pi" target="_blank"><img width="500" height="312" title="Displaying a 2D heatmap while surface shading" style="margin: 30px auto; float: none; display: block;" alt="Displaying a 2D heatmap while surface shading" src="/assets/image_702707.jpg"></a></p><p>This feature is very much experimental, in the sense it’s really about enabling a particular exhibit that will probably need a 2D view of sensor data, but I do think it’s got some real potential. In the next post (on this topic, anyway), I’ll take a look at some options for&nbsp; allowing the user to position and resize these 2D heatmaps.</p>
