---
layout: "post"
title: "Creating a 3D viewer for our Apollonian service using Android &ndash; Part 2"
date: "2012-05-02 16:24:14"
author: "Kean Walmsley"
categories:
  - "Android"
  - "Java"
  - "JSON"
  - "Mobile"
  - "REST"
  - "SaaS"
original_url: "https://www.keanw.com/2012/05/creating-a-3d-viewer-for-our-apollonian-service-using-android-part-2.html "
typepad_basename: "creating-a-3d-viewer-for-our-apollonian-service-using-android-part-2"
typepad_status: "Publish"
---

<p>In <a href="http://through-the-interface.typepad.com/through_the_interface/2012/04/creating-a-3d-viewer-for-our-apollonian-service-using-android-part-1.html" target="_blank">the last post</a>, we took a quick look at some basics around developing application for Android, while today we’re going to see the code for our Apollonian Viewer application. Or, as my 5 year-old likes to call it, the “sweetie planet” app :-).</p>
<p>Last time, I mentioned <a href="https://twitter.com/#!/masdennis" target="_blank">Dennis Ippel</a> as the author of the <a href="http://www.rozengain.com/blog/2011/08/23/announcing-rajawali-an-opengl-es-2-0-based-3d-framework-for-android" target="_blank">Rajawali</a> framework I’ve used in this app. What I didn’t mention is how helpful he has been with getting this app working: Dennis gave hints that unblocked my efforts on a number of occasions, and even implemented new capabilities in Rajawali to enable several of the features I wanted to implement. Just from that perspective, developing this app has been a really rewarding experience – many thanks, Dennis! :-)</p>
<p>Before we see the code, I have a few things to say, from the outset. As this is my first Android app, I’m almost certainly doing some things the wrong way. I know, for instance, that I should really be using XML layouts to define my UI (in much the same way as you use XAML + C# code-behind in the .NET world), but for expediency – and to reduce the number of source files for you to copy/paste into your own project to get something working – I’m generating the various UI elements programmatically.</p>
<p>I’ve also cut a few corners when exposing properties from the ApollonianRenderer class to be used in the main ApollonianActivity class – again primarily for expediency (and a touch of laziness :-).</p>
<p>So while the app works – and right now I’m happy to see it’s working really well, in my somewhat biased opinion, at least – it should be looked at as a testament for how straightforward it is for a C# developer to write his first Android app rather than an example of Java/Android best-practices. And the point of all this is to demonstrate some potential benefits of splitting your application architecture with some code residing in the cloud and some working locally.</p>
<p>And with that, on to the source code…</p>
<p>The code is split across two source files: <em>ApollonianActivity.java</em> contains the main “application” class, if you will, and <em>ApollonianRendered.java</em> contains the code defining the OpenGL/Rajawali renderer class and its supporting functions.</p>
<p>I could certainly have broken out a number of features into separate classes, but, again for expediency, I’ve attempted to minimise the structural complexity perhaps at the cost of the overall architecture. I’ll probably choose to refactor if making significant extensions to this codebase, in the future.</p>
<p>I used the <a href="http://www.java2html.de" target="_blank">Java2Html</a> Eclipse plug-in to generate the source for this blog post, having initially imposed the usual formatting style for my code (Eclipse is extremely flexible about imposing your own code formatting rules, I’ve found).</p>
<p>If you’re not especially interested in the code, please do skip past it to see screenshots and a video and to find a link to the app for those of you with Android devices.</p>
<p>Here’s the <em>ApollonianActivity.java</em> file:</p>
<div class="java"><code><span style="color: #0000c0;"><strong>package </strong></span><span style="color: #000000;">ttif.apollonian.app;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">java.util.ArrayList;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.app.AlertDialog;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.content.DialogInterface;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.graphics.Color;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.graphics.PointF;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.os.Bundle;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.util.FloatMath;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.GestureDetector;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.GestureDetector.SimpleOnGestureListener;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.Gravity;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.MotionEvent;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.View;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.ViewGroup;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.ViewGroup.LayoutParams;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.AdapterView;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.AdapterView.OnItemSelectedListener;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.ArrayAdapter;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.LinearLayout;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.ProgressBar;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.Spinner;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.widget.TextView;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.RajawaliActivity;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #0000c0;"><strong>public class </strong></span><span style="color: #000000;">ApollonianActivity</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>extends </strong></span><span style="color: #000000;">RajawaliActivity </span><span style="color: #0000c0;"><strong>implements </strong></span><span style="color: #000000;">View.OnClickListener</span> <br /><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">ApollonianRenderer mRenderer;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">TextView mLabel;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">ProgressBar mProgBarI;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">ProgressBar mProgBarD;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Spinner mSpinner;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">GestureDetector mGestureDetector;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">View.OnTouchListener mGestureListener;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">SWIPE_MIN_DISTANCE = </span><span style="color: #990000;">120</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">SWIPE_THRESHOLD_VELOCITY = </span><span style="color: #990000;">1000</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// We can be in one of these 3 states</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">NONE = </span><span style="color: #990000;">0</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">DRAG = </span><span style="color: #990000;">1</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">ZOOM = </span><span style="color: #990000;">2</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">mode = NONE;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Remember some things for zooming</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">PointF start = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">PointF</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">PointF mid = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">PointF</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">oldDist = </span><span style="color: #990000;">1f</span><span style="color: #000000;">;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle savedInstanceState</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>super</strong></span><span style="color: #000000;">.onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">restoring = savedInstanceState != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Set up our Rajawali renderer</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">ApollonianRenderer</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.setSurfaceView</span><span style="color: #000000;">(</span><span style="color: #000000;">mSurfaceView</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>super</strong></span><span style="color: #000000;">.setRenderer</span><span style="color: #000000;">(</span><span style="color: #000000;">mRenderer</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Set up the UI</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">createUI</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Add touch and gesture detection</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mGestureDetector =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">GestureDetector</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">MyGestureDetector</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mGestureListener = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">View.OnTouchListener</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">onTouch</span><span style="color: #000000;">(</span><span style="color: #000000;">View v, MotionEvent event</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Handle touch events here...</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>switch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">event.getAction</span><span style="color: #000000;">() </span><span style="color: #000000;">&amp; MotionEvent.ACTION_MASK</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #000000;">MotionEvent.ACTION_DOWN:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">start.set</span><span style="color: #000000;">(</span><span style="color: #000000;">event.getX</span><span style="color: #000000;">()</span><span style="color: #000000;">, event.getY</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mode = DRAG;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #000000;">MotionEvent.ACTION_POINTER_DOWN:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">oldDist = spacing</span><span style="color: #000000;">(</span><span style="color: #000000;">event</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">oldDist &gt; </span><span style="color: #990000;">10f</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">midPoint</span><span style="color: #000000;">(</span><span style="color: #000000;">mid, event</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mode = ZOOM;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #000000;">MotionEvent.ACTION_UP:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #000000;">MotionEvent.ACTION_POINTER_UP:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mode = NONE;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.pinchOrDragFinished</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #000000;">MotionEvent.ACTION_MOVE:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mode == DRAG</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x = event.getX</span><span style="color: #000000;">() </span><span style="color: #000000;">- start.x,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">y = event.getY</span><span style="color: #000000;">() </span><span style="color: #000000;">- start.y;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">Math.abs</span><span style="color: #000000;">(</span><span style="color: #000000;">x</span><span style="color: #000000;">) </span><span style="color: #000000;">&gt; </span><span style="color: #990000;">10f </span><span style="color: #000000;">|| Math.abs</span><span style="color: #000000;">(</span><span style="color: #000000;">y</span><span style="color: #000000;">) </span><span style="color: #000000;">&gt; </span><span style="color: #990000;">10f</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.drag</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mode == ZOOM</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">newDist = spacing</span><span style="color: #000000;">(</span><span style="color: #000000;">event</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">newDist &gt; </span><span style="color: #990000;">10f</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">scale = newDist / oldDist;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.pinch</span><span style="color: #000000;">(</span><span style="color: #000000;">scale</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Make sure we call our gesture detector, too</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">mGestureDetector.onTouchEvent</span><span style="color: #000000;">(</span><span style="color: #000000;">event</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Hook up our touch-related listeners</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSurfaceView.setOnClickListener</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSurfaceView.setOnTouchListener</span><span style="color: #000000;">(</span><span style="color: #000000;">mGestureListener</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setOnClickListener</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setOnTouchListener</span><span style="color: #000000;">(</span><span style="color: #000000;">mGestureListener</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// If we have saved state, pass it to the renderer</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">restoring</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.mBundle = savedInstanceState;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.restoreInstancedState</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">createUI</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Start with the overall vertical layout</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">LinearLayout ll = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ll.setOrientation</span><span style="color: #000000;">(</span><span style="color: #000000;">LinearLayout.VERTICAL</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ll.setGravity</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Gravity.CENTER_HORIZONTAL + Gravity.CENTER_VERTICAL</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Have an information label centered on the screen</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">TextView</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setGravity</span><span style="color: #000000;">(</span><span style="color: #000000;">Gravity.CENTER_HORIZONTAL</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setTextSize</span><span style="color: #000000;">(</span><span style="color: #990000;">40</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setPadding</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">30</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ll.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">mLabel</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// We&#39;ll have two progress bars, one is indeterminate...</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarI =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">ProgressBar</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">this, null, android.R.attr.progressBarStyleLarge</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarI.setIndeterminate</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarI.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ll.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">mProgBarI, </span><span style="color: #990000;">50</span><span style="color: #000000;">, </span><span style="color: #990000;">50</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// ... the other is determinate</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">ProgressBar</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">this, null, android.R.attr.progressBarStyleHorizontal</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setIndeterminate</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setPadding</span><span style="color: #000000;">(</span><span style="color: #990000;">50</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">50</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setProgress</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ll.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">mProgBarD</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLayout.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">ll</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// To place our spinner at the bottom right corner,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// we first add a horizontal layout</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">LinearLayout bottom = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">bottom.setOrientation</span><span style="color: #000000;">(</span><span style="color: #000000;">LinearLayout.HORIZONTAL</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">bottom.setGravity</span><span style="color: #000000;">(</span><span style="color: #000000;">Gravity.BOTTOM</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">bottom.setLayoutParams</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout.LayoutParams</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// And then a vertical one</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">LinearLayout right = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">right.setOrientation</span><span style="color: #000000;">(</span><span style="color: #000000;">LinearLayout.VERTICAL</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">right.setGravity</span><span style="color: #000000;">(</span><span style="color: #000000;">Gravity.RIGHT</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">right.setLayoutParams</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout.LayoutParams</span><span style="color: #000000;">(</span><span style="color: #000000;">LayoutParams.FILL_PARENT, </span><span style="color: #990000;">100</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">bottom.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">right</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// We create the data for our spinner</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ArrayList&lt;String&gt; spinnerArray = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">ArrayList&lt;String&gt;</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>for </strong></span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">i = </span><span style="color: #990000;">1</span><span style="color: #000000;">; i &lt; </span><span style="color: #990000;">11</span><span style="color: #000000;">; i++</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">spinnerArray.add</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">String.format</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">&quot;Level %-15s(%,d spheres)&quot;</span><span style="color: #000000;">,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Integer.toString</span><span style="color: #000000;">(</span><span style="color: #000000;">i</span><span style="color: #000000;">)</span><span style="color: #000000;">, ApollonianRenderer.mLimits</span><span style="color: #000000;">[</span><span style="color: #000000;">i</span><span style="color: #000000;">]</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// And then create the spinner itself</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Spinner</span><span style="color: #000000;">(</span><span style="color: #000000;">ApollonianActivity.</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ArrayAdapter&lt;String&gt; spinnerArrayAdapter =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">ArrayAdapter&lt;String&gt;</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">ApollonianActivity.this,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">android.R.layout.simple_dropdown_item_1line,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">spinnerArray</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// We want to set the color of our spinner&#39;s TextView</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// to something other than black</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #000000;">View getView</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">position, View convertView, ViewGroup parent</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">View v = </span><span style="color: #0000c0;"><strong>super</strong></span><span style="color: #000000;">.getView</span><span style="color: #000000;">(</span><span style="color: #000000;">position, convertView, parent</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">TextView tv = </span><span style="color: #000000;">(</span><span style="color: #000000;">TextView</span><span style="color: #000000;">)</span><span style="color: #000000;">v;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">tv.setTextColor</span><span style="color: #000000;">(</span><span style="color: #000000;">Color.WHITE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">v;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setAdapter</span><span style="color: #000000;">(</span><span style="color: #000000;">spinnerArrayAdapter</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setSelection</span><span style="color: #000000;">(</span><span style="color: #000000;">mRenderer.mLevel - </span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setLayoutParams</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearLayout.LayoutParams</span><span style="color: #000000;">(</span><span style="color: #990000;">180</span><span style="color: #000000;">, </span><span style="color: #990000;">100</span><span style="color: #000000;">, Gravity.RIGHT</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setBackgroundColor</span><span style="color: #000000;">(</span><span style="color: #000000;">Color.TRANSPARENT</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setOnItemSelectedListener</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">OnItemSelectedListener</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onItemSelected</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">AdapterView&lt;?&gt; arg0, View arg1, </span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">arg2, </span><span style="color: #c00000;"><strong>long </strong></span><span style="color: #000000;">arg3</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// When a selection happens, inform the renderer</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">arg2 != mRenderer.mLevel - </span><span style="color: #990000;">1</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.mLevel = arg2 + </span><span style="color: #990000;">1</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.startDownload</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onNothingSelected</span><span style="color: #000000;">(</span><span style="color: #000000;">AdapterView&lt;?&gt; arg0</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// If no selection happens make sure we&#39;re still</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// selecting the previous value</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">arg0.setSelection</span><span style="color: #000000;">(</span><span style="color: #000000;">mRenderer.mLevel - </span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">right.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">mSpinner</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLayout.addView</span><span style="color: #000000;">(</span><span style="color: #000000;">bottom</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// State save/restore methods</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onSaveInstanceState</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle savedInstanceState</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Save state changes to the savedInstanceState.</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.saveInstancedState</span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>super</strong></span><span style="color: #000000;">.onSaveInstanceState</span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Determine the space between the first two fingers</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">spacing</span><span style="color: #000000;">(</span><span style="color: #000000;">MotionEvent event</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">distance</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">event.getX</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">, event.getX</span><span style="color: #000000;">(</span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">event.getY</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">, event.getY</span><span style="color: #000000;">(</span><span style="color: #990000;">1</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Determine the distance between two points</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">distance</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x1, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x2, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y1, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y2</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x = x1 - x2, y = y1 - y2;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">FloatMath.sqrt</span><span style="color: #000000;">(</span><span style="color: #000000;">x * x + y * y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Calculate the mid point of the first two fingers</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">midPoint</span><span style="color: #000000;">(</span><span style="color: #000000;">PointF point, MotionEvent event</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x = event.getX</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">) </span><span style="color: #000000;">+ event.getX</span><span style="color: #000000;">(</span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y = event.getY</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">) </span><span style="color: #000000;">+ event.getY</span><span style="color: #000000;">(</span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">point.set</span><span style="color: #000000;">(</span><span style="color: #000000;">x / </span><span style="color: #990000;">2</span><span style="color: #000000;">, y / </span><span style="color: #990000;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// We need an empty onClick() for touch to work properly</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onClick</span><span style="color: #000000;">(</span><span style="color: #000000;">View unused</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Helper functions providing access to the information label</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">clearLabel</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setText</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarI.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.VISIBLE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setLabel</span><span style="color: #000000;">(</span><span style="color: #000000;">String text</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.VISIBLE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLabel.setText</span><span style="color: #000000;">(</span><span style="color: #000000;">text</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">View.GONE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Progress bar related methods</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">showProgressBar</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">determinate</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">det = determinate ? View.VISIBLE : View.GONE,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">ind = determinate ? View.GONE : View.VISIBLE;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarI.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">ind</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setVisibility</span><span style="color: #000000;">(</span><span style="color: #000000;">det</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setProgressBarLimit</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">i</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setMax</span><span style="color: #000000;">(</span><span style="color: #000000;">i</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">tickProgressBar</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.incrementProgressBy</span><span style="color: #000000;">(</span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setProgressBarPosition</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">i</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mProgBarD.setProgress</span><span style="color: #000000;">(</span><span style="color: #000000;">i</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Spinner-related methods</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setLevel</span><span style="color: #000000;">(</span><span style="color: #000000;">Integer level</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSpinner.setSelection</span><span style="color: #000000;">(</span><span style="color: #000000;">level - </span><span style="color: #990000;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Stop the activity in case we have no network connection</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">exitNoConnection</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">AlertDialog ad =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">AlertDialog.Builder</span><span style="color: #000000;">(</span><span style="color: #000000;">ApollonianActivity.</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">.create</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ad.setCancelable</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ad.setTitle</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">&quot;Unable to access the Apollonian Service.&quot;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ad.setMessage</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">&quot;Please make sure you have internet connectivity.&quot;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ad.setButton</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">&quot;Close&quot;</span><span style="color: #000000;">,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">DialogInterface.OnClickListener</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">onClick</span><span style="color: #000000;">(</span><span style="color: #000000;">DialogInterface dialog, </span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">which</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">dialog.dismiss</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">ApollonianActivity.</span><span style="color: #0000c0;"><strong>this</strong></span><span style="color: #000000;">.finish</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">ad.show</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Our gesture detector class</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>class </strong></span><span style="color: #000000;">MyGestureDetector </span><span style="color: #0000c0;"><strong>extends </strong></span><span style="color: #000000;">SimpleOnGestureListener</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">onFling</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">MotionEvent e1, MotionEvent e2,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">velocityX, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">velocityY</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>try</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x1 = e1.getX</span><span style="color: #000000;">()</span><span style="color: #000000;">, y1 = e1.getY</span><span style="color: #000000;">()</span><span style="color: #000000;">,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">x2 = e2.getX</span><span style="color: #000000;">()</span><span style="color: #000000;">, y2 = e2.getY</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">distance</span><span style="color: #000000;">(</span><span style="color: #000000;">x1, x2, y1, y2</span><span style="color: #000000;">) </span><span style="color: #000000;">&gt; SWIPE_MIN_DISTANCE &amp;&amp;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Math.abs</span><span style="color: #000000;">(</span><span style="color: #000000;">velocityX</span><span style="color: #000000;">) </span><span style="color: #000000;">+ Math.abs</span><span style="color: #000000;">(</span><span style="color: #000000;">velocityY</span><span style="color: #000000;">) </span><span style="color: #000000;">&gt;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">SWIPE_THRESHOLD_VELOCITY</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.swipe</span><span style="color: #000000;">(</span><span style="color: #000000;">x2 - x1, y1 - y2</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">Exception e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return false</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">onSingleTapConfirmed</span><span style="color: #000000;">(</span><span style="color: #000000;">MotionEvent e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.singleTap</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">onDoubleTapEvent</span><span style="color: #000000;">(</span><span style="color: #000000;">MotionEvent e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRenderer.doubleTap</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #000000;">}</span></code></div>
<p>And here’s the <em>ApollonianRenderer.java</em> file:</p>
<div class="java"><code><span style="color: #0000c0;"><strong>package </strong></span><span style="color: #000000;">ttif.apollonian.app;</span> <br /> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">java.io.BufferedReader;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">java.io.IOException;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">java.io.InputStream;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">java.io.InputStreamReader;</span> <br /> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.HttpEntity;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.HttpResponse;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.client.ClientProtocolException;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.client.HttpClient;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.client.methods.HttpGet;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.apache.http.impl.client.DefaultHttpClient;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.json.JSONArray;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.json.JSONException;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">org.json.JSONObject;</span> <br /> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.graphics.Color;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.content.Context;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.os.AsyncTask;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.os.Bundle;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.os.Handler;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.os.Message;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">android.view.animation.LinearInterpolator;</span> <br /> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.BaseObject3D;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.animation.Animation3D;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.animation.RotateAnimation3D;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.lights.DirectionalLight;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.materials.DiffuseMaterial;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.math.Matrix4;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.math.Number3D;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.math.Quaternion;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.primitives.Sphere;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.renderer.RajawaliRenderer;</span> <br /><span style="color: #0000c0;"><strong>import </strong></span><span style="color: #000000;">rajawali.util.RajLog;</span> <br /> <br /><span style="color: #0000c0;"><strong>public class </strong></span><span style="color: #000000;">ApollonianRenderer </span><span style="color: #0000c0;"><strong>extends </strong></span><span style="color: #000000;">RajawaliRenderer</span> <br /><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">BaseObject3D mRootSphere = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">DirectionalLight mLight = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Animation3D mAnim = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Context mContext;</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">baseDuration = </span><span style="color: #990000;">4000</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">minDuration = </span><span style="color: #990000;">1000</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">mAnimDuration = baseDuration;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Number3D mDirection = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">mAnimPaused = </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">mCameraDistance = -</span><span style="color: #990000;">5f</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">mRecentCameraDistance;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Quaternion mDragRotation = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">String mJsonResults;</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Colors per level</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static final </strong></span><span style="color: #c00000;"><strong>int</strong></span><span style="color: #000000;">[] </span><span style="color: #000000;">mColors =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #c00000;"><strong>int</strong></span><span style="color: #000000;">[]</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Color.TRANSPARENT, Color.RED, Color.YELLOW, Color.GREEN,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Color.CYAN, Color.BLUE, Color.MAGENTA, Color.DKGRAY,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Color.GRAY, Color.LTGRAY, Color.WHITE</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Numbers of spheres to be downloaded per level </span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public static final </strong></span><span style="color: #c00000;"><strong>int</strong></span><span style="color: #000000;">[] </span><span style="color: #000000;">mLimits =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #c00000;"><strong>int</strong></span><span style="color: #000000;">[]</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">1</span><span style="color: #000000;">, </span><span style="color: #990000;">9</span><span style="color: #000000;">, </span><span style="color: #990000;">29</span><span style="color: #000000;">, </span><span style="color: #990000;">89</span><span style="color: #000000;">, </span><span style="color: #990000;">299</span><span style="color: #000000;">, </span><span style="color: #990000;">989</span><span style="color: #000000;">, </span><span style="color: #990000;">2837</span><span style="color: #000000;">, </span><span style="color: #990000;">6635</span><span style="color: #000000;">, </span><span style="color: #990000;">12119</span><span style="color: #000000;">, </span><span style="color: #990000;">16187</span><span style="color: #000000;">, </span><span style="color: #990000;">18107</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Public bundle for restoring data</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #000000;">Bundle mBundle = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// The level we&#39;ll download and process</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">mLevel = </span><span style="color: #990000;">3</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Initialization/set-up related</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #000000;">ApollonianRenderer</span><span style="color: #000000;">(</span><span style="color: #000000;">Context context</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>super</strong></span><span style="color: #000000;">(</span><span style="color: #000000;">context</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mContext = context;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">setFrameRate</span><span style="color: #000000;">(</span><span style="color: #990000;">40</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>protected </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">initScene</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// We&#39;ll restart rendering once we&#39;ve downloaded/processed</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">stopRendering</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Set up the camera</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mCamera.setPosition</span><span style="color: #000000;">(</span><span style="color: #990000;">0f</span><span style="color: #000000;">,</span><span style="color: #990000;">0f</span><span style="color: #000000;">,</span><span style="color: #990000;">0f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">setCameraDistance</span><span style="color: #000000;">(</span><span style="color: #990000;">1f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Create the default light</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">createLight</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// If we have geometry, exit now</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mJsonResults != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">refreshGeometry</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Otherwise we download and process it</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">startDownload</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">createLight</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Add a light source</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mLight == </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLight = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">DirectionalLight</span><span style="color: #000000;">(</span><span style="color: #990000;">0.1f</span><span style="color: #000000;">, </span><span style="color: #990000;">0.2f</span><span style="color: #000000;">, -</span><span style="color: #990000;">1.0f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLight.setColor</span><span style="color: #000000;">(</span><span style="color: #990000;">1.0f</span><span style="color: #000000;">, </span><span style="color: #990000;">1.0f</span><span style="color: #000000;">, </span><span style="color: #990000;">1.0f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLight.setPosition</span><span style="color: #000000;">(</span><span style="color: #990000;">.5f</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, -</span><span style="color: #990000;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLight.setPower</span><span style="color: #000000;">(</span><span style="color: #990000;">0.5f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">storeRotation</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mDragRotation = mRootSphere.getOrientation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setCameraDistance</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">scale</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Set our camera distance</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRecentCameraDistance = mCameraDistance / scale;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mCamera.setZ</span><span style="color: #000000;">(</span><span style="color: #000000;">mRecentCameraDistance</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">cancelAnimation</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mAnim != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.cancel</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">resetAnimation</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">sameOrOpposite</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Start by canceling any existing animation</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">cancelAnimation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Get our axis of rotation, perpendicular to the swipe</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// direction</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Number3D axis = perpendicularAxis</span><span style="color: #000000;">(</span><span style="color: #000000;">-mDirection.x, mDirection.y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">axis.normalize</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Quaternion q = mRootSphere.getOrientation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Matrix4 mat = q.toRotationMatrix</span><span style="color: #000000;">()</span><span style="color: #000000;">.inverse</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">axis = mat.transform</span><span style="color: #000000;">(</span><span style="color: #000000;">axis</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">axis.normalize</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">RotateAnimation3D</span><span style="color: #000000;">(</span><span style="color: #000000;">axis, </span><span style="color: #990000;">360</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.setDuration</span><span style="color: #000000;">(</span><span style="color: #000000;">mAnimDuration</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.setTransformable3D</span><span style="color: #000000;">(</span><span style="color: #000000;">mRootSphere</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.setRepeatCount</span><span style="color: #000000;">(</span><span style="color: #000000;">Animation3D.INFINITE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.setRepeatMode</span><span style="color: #000000;">(</span><span style="color: #000000;">Animation3D.RESTART</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.setInterpolator</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">LinearInterpolator</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.start</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Touch gesture protocol</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">singleTap</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Pauses or restarts spinning</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mAnim != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mAnimPaused</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.start</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnim.cancel</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">storeRotation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimPaused = !mAnimPaused;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">doubleTap</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Cancels spinning</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">cancelAnimation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimPaused = </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimDuration = baseDuration;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">storeRotation</span><span style="color: #000000;">()</span><span style="color: #000000;">;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">drag</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Rotates a short distance</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mAnim == </span><span style="color: #0000c0;"><strong>null </strong></span><span style="color: #000000;">|| mAnimPaused</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Determine how far to rotate and in which direction</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">rotAng = magnitudeOfRotation</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y</span><span style="color: #000000;">) </span><span style="color: #000000;">* -</span><span style="color: #990000;">0.1f</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Number3D axis = perpendicularAxis</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// If our objects have an existing rotation, transform</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// the axis of rotation</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mDragRotation != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Matrix4 mat = mDragRotation.toRotationMatrix</span><span style="color: #000000;">()</span><span style="color: #000000;">.inverse</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">axis = mat.transform</span><span style="color: #000000;">(</span><span style="color: #000000;">axis</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">axis.normalize</span><span style="color: #000000;">()</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Get the new rotation as a quaternion</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Quaternion rot = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Quaternion</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">rot.fromAngleAxis</span><span style="color: #000000;">(</span><span style="color: #000000;">rotAng, axis</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Apply any existing rotation to it</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mDragRotation != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">rot.multiply</span><span style="color: #000000;">(</span><span style="color: #000000;">mDragRotation</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRootSphere.setOrientation</span><span style="color: #000000;">(</span><span style="color: #000000;">rot</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">swipe</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Spins in a particular direction</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimPaused = </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">needReset = false, sameOrOpposite = </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mAnim == </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// No existing animation</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mDirection = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, </span><span style="color: #990000;">0f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">needReset = </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Existing animation...</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">sameDirection</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, mDirection.x, mDirection.y</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">sameOrOpposite = </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// ... in the same direction as the swipe, so we</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// speed up the animation by halving the duration</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">((</span><span style="color: #000000;">mAnimDuration / </span><span style="color: #990000;">2</span><span style="color: #000000;">) </span><span style="color: #000000;">&gt;= minDuration</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimDuration /= </span><span style="color: #990000;">2</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">needReset = </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// A new direction, reset the duration</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mDirection = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, </span><span style="color: #990000;">0f</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mAnimDuration = baseDuration;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">needReset = </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">sameOrOpposite =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">sameDirection</span><span style="color: #000000;">(</span><span style="color: #000000;">-x, -y, mDirection.x, mDirection.y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">needReset</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">resetAnimation</span><span style="color: #000000;">(</span><span style="color: #000000;">sameOrOpposite</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">pinch</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">scale</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Zooms the view</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">setCameraDistance</span><span style="color: #000000;">(</span><span style="color: #000000;">scale</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">pinchOrDragFinished</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mCameraDistance = mRecentCameraDistance;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">storeRotation</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Touch-related helpers</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">sameDirection</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x1, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y1, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x2, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y2</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">Math.abs</span><span style="color: #000000;">(</span><span style="color: #000000;">Math.atan2</span><span style="color: #000000;">(</span><span style="color: #000000;">y1,x1</span><span style="color: #000000;">) </span><span style="color: #000000;">- Math.atan2</span><span style="color: #000000;">(</span><span style="color: #000000;">y2,x2</span><span style="color: #000000;">)) </span><span style="color: #000000;">&lt; </span><span style="color: #990000;">0.1</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Number3D perpendicularAxis</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Uses a fairly unsophisticated approach to generating</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// a perpendicular vector</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">y == </span><span style="color: #990000;">0</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">y, -x, </span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">-y, x, </span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">magnitudeOfRotation</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, </span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">.length</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Web-service access</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static </strong></span><span style="color: #000000;">String convertStreamToString</span><span style="color: #000000;">(</span><span style="color: #000000;">InputStream is</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">BufferedReader reader =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">BufferedReader</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">InputStreamReader</span><span style="color: #000000;">(</span><span style="color: #000000;">is</span><span style="color: #000000;">))</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">StringBuilder sb = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">StringBuilder</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">String line = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>try</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>while </strong></span><span style="color: #000000;">((</span><span style="color: #000000;">line = reader.readLine</span><span style="color: #000000;">()) </span><span style="color: #000000;">!= </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">sb.append</span><span style="color: #000000;">(</span><span style="color: #000000;">line + </span><span style="color: #990000;">&quot;\n&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">IOException e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">e.printStackTrace</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>finally</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>try</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">is.close</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">IOException e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">e.printStackTrace</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">sb.toString</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Get the spheres for a certain level from our web-service</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private static </strong></span><span style="color: #000000;">String getSpheresFromService</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">level</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>throws </strong></span><span style="color: #000000;">ClientProtocolException, IOException</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">HttpClient httpclient = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">DefaultHttpClient</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Prepare and execute the request</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">HttpGet httpget =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">HttpGet</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #990000;">&quot;http://apollonian.cloudapp.net/api/spheres/1/&quot; </span><span style="color: #000000;">+</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Integer.toString</span><span style="color: #000000;">(</span><span style="color: #000000;">level</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">HttpResponse response;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">//try</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">response = httpclient.execute</span><span style="color: #000000;">(</span><span style="color: #000000;">httpget</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">HttpEntity entity = response.getEntity</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">entity != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">InputStream instream = entity.getContent</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">String result = convertStreamToString</span><span style="color: #000000;">(</span><span style="color: #000000;">instream</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">instream.close</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return </strong></span><span style="color: #000000;">result;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Geometry creation</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">createSpheres</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">createSpheres</span><span style="color: #000000;">(</span><span style="color: #000000;">mJsonResults</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">createSpheres</span><span style="color: #000000;">(</span><span style="color: #000000;">String results</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">results == </span><span style="color: #0000c0;"><strong>null </strong></span><span style="color: #000000;">|| results == </span><span style="color: #990000;">&quot;&quot;</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return</strong></span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">setProgressLimit</span><span style="color: #000000;">(</span><span style="color: #000000;">mLimits</span><span style="color: #000000;">[</span><span style="color: #000000;">mLevel</span><span style="color: #000000;">])</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Add our primary (dummy) sphere</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">createLight</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">createSphere</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #990000;">0.01f</span><span style="color: #000000;">, </span><span style="color: #990000;">0</span><span style="color: #000000;">, </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>try</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Our JSON string should be an array of objects</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">JSONArray json = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">JSONArray</span><span style="color: #000000;">(</span><span style="color: #000000;">results</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>for </strong></span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">i = </span><span style="color: #990000;">0</span><span style="color: #000000;">; i &lt; json.length</span><span style="color: #000000;">()</span><span style="color: #000000;">; i++</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x = </span><span style="color: #990000;">0f</span><span style="color: #000000;">, y = </span><span style="color: #990000;">0f</span><span style="color: #000000;">, z = </span><span style="color: #990000;">0f</span><span style="color: #000000;">, radius = </span><span style="color: #990000;">0f</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">level = </span><span style="color: #990000;">0</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Get each object from the array</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">JSONObject obj = json.getJSONObject</span><span style="color: #000000;">(</span><span style="color: #000000;">i</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Parse the name-value pairs to get our data</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">JSONArray nameArray = obj.names</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">JSONArray valArray = obj.toJSONArray</span><span style="color: #000000;">(</span><span style="color: #000000;">nameArray</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>for </strong></span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">j = </span><span style="color: #990000;">0</span><span style="color: #000000;">; j &lt; valArray.length</span><span style="color: #000000;">()</span><span style="color: #000000;">; j++</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Cannot switch on a string, so we cascade ifs</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">String name = nameArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">.toString</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">name.startsWith</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;X&quot;</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">x = Float.valueOf</span><span style="color: #000000;">(</span><span style="color: #000000;">valArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">.toString</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">name.startsWith</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Y&quot;</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">y = Float.valueOf</span><span style="color: #000000;">(</span><span style="color: #000000;">valArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">.toString</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">name.startsWith</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Z&quot;</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">z = Float.valueOf</span><span style="color: #000000;">(</span><span style="color: #000000;">valArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">.toString</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">name.startsWith</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;R&quot;</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">radius =</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Float.valueOf</span><span style="color: #000000;">(</span><span style="color: #000000;">valArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">.toString</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">name.startsWith</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;L&quot;</span><span style="color: #000000;">))</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">level = </span><span style="color: #000000;">(</span><span style="color: #000000;">Integer</span><span style="color: #000000;">)</span><span style="color: #000000;">valArray.get</span><span style="color: #000000;">(</span><span style="color: #000000;">j</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Only display circles that are close to the outer</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #008000;">// hull (and are therefore not completely occluded)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">Number3D v = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Number3D</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, z</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">v.length</span><span style="color: #000000;">() </span><span style="color: #000000;">+ radius &gt; </span><span style="color: #990000;">0.99f</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">createSphere</span><span style="color: #000000;">(</span><span style="color: #000000;">x, y, z, radius, level, </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">tickProgress</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">JSONException e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">e.printStackTrace</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">clearSpheres</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mRootSphere != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">removeChild</span><span style="color: #000000;">(</span><span style="color: #000000;">mRootSphere</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRootSphere = </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">createSphere</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">x, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">y, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">z, </span><span style="color: #c00000;"><strong>float </strong></span><span style="color: #000000;">radius,</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">level, </span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">isRoot</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">isRoot &amp;&amp; mRootSphere != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Use a moderate tessellation of our spheres</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Sphere sphere = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Sphere</span><span style="color: #000000;">(</span><span style="color: #000000;">radius, </span><span style="color: #990000;">9</span><span style="color: #000000;">, </span><span style="color: #990000;">9</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.setX</span><span style="color: #000000;">(</span><span style="color: #000000;">x</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.setY</span><span style="color: #000000;">(</span><span style="color: #000000;">y</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.setZ</span><span style="color: #000000;">(</span><span style="color: #000000;">z</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Add our light</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.addLight</span><span style="color: #000000;">(</span><span style="color: #000000;">mLight</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Set the material and color</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.setMaterial</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">DiffuseMaterial</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.getMaterial</span><span style="color: #000000;">()</span><span style="color: #000000;">.setUseColor</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">sphere.setColor</span><span style="color: #000000;">(</span><span style="color: #000000;">level &gt; </span><span style="color: #990000;">10 </span><span style="color: #000000;">? Color.WHITE : mColors</span><span style="color: #000000;">[</span><span style="color: #000000;">level</span><span style="color: #000000;">])</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Make it our root sphere or add it as a child</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">isRoot</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRootSphere = sphere;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">addChild</span><span style="color: #000000;">(</span><span style="color: #000000;">mRootSphere</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>else if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">mRootSphere != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mRootSphere.addChild</span><span style="color: #000000;">(</span><span style="color: #000000;">sphere</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// We have some things we need to have happen on the UI thread...</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Start downloading data from our web-service</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">startDownload</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">clearSpheres</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.post</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Runnable</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">run</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">DownloadSpheresTask</span><span style="color: #000000;">()</span><span style="color: #000000;">.execute</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Clear the information label once we&#39;ve finished</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">clearProgressLabel</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">0</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Update the information label as we&#39;re downloading/processing</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">updateProgressLabel</span><span style="color: #000000;">(</span><span style="color: #000000;">String text, </span><span style="color: #c00000;"><strong>boolean </strong></span><span style="color: #000000;">determinate</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = determinate ? </span><span style="color: #990000;">1 </span><span style="color: #000000;">: </span><span style="color: #990000;">2</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.obj = text;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Control the determinate progress bar</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setProgressLimit</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">max</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">3</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.obj = max;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">tickProgress</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">4</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">resetProgress</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">5</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">setSpinnerLevel</span><span style="color: #000000;">(</span><span style="color: #c00000;"><strong>int </strong></span><span style="color: #000000;">level</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">6</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.obj = level;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">exitGracefully</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">Message msg = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Message</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">msg.arg1 = </span><span style="color: #990000;">7</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mHandler.sendMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">msg</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Here&#39;s the handler that manages the UI updates</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #000000;">Handler mHandler = </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Handler</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">handleMessage</span><span style="color: #000000;">(</span><span style="color: #000000;">Message msg</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">ApollonianActivity act = </span><span style="color: #000000;">(</span><span style="color: #000000;">ApollonianActivity</span><span style="color: #000000;">)</span><span style="color: #000000;">mContext;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>switch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">msg.arg1</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">0</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.clearLabel</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">1</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.setLabel</span><span style="color: #000000;">((</span><span style="color: #000000;">String</span><span style="color: #000000;">)</span><span style="color: #000000;">msg.obj</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.showProgressBar</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">2</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.setLabel</span><span style="color: #000000;">((</span><span style="color: #000000;">String</span><span style="color: #000000;">)</span><span style="color: #000000;">msg.obj</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.showProgressBar</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">3</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.setProgressBarLimit</span><span style="color: #000000;">((</span><span style="color: #000000;">Integer</span><span style="color: #000000;">)</span><span style="color: #000000;">msg.obj</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">4</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.tickProgressBar</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">5</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.setProgressBarPosition</span><span style="color: #000000;">(</span><span style="color: #990000;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">6</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.setLevel</span><span style="color: #000000;">((</span><span style="color: #000000;">Integer</span><span style="color: #000000;">)</span><span style="color: #000000;">msg.obj</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>case </strong></span><span style="color: #990000;">7</span><span style="color: #000000;">:</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">act.exitNoConnection</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>break</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Background task allowing us to download without</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// blocking the UI thread</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private class </strong></span><span style="color: #000000;">DownloadSpheresTask</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>extends </strong></span><span style="color: #000000;">AsyncTask&lt;Void, Void, Void&gt;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #646464;">@Override</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>protected </strong></span><span style="color: #000000;">Void doInBackground</span><span style="color: #000000;">(</span><span style="color: #000000;">Void... unused</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">updateProgressLabel</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Calling Apollonian Service...&quot;</span><span style="color: #000000;">, </span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>try</strong></span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mJsonResults = getSpheresFromService</span><span style="color: #000000;">(</span><span style="color: #000000;">mLevel</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">refreshGeometry</span><span style="color: #000000;">()</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">ClientProtocolException e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">e.printStackTrace</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>catch </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">IOException e</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">exitGracefully</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>return null</strong></span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Refresh our geometry, whether downloaded or restored</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>private </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">refreshGeometry</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">resetProgress</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">updateProgressLabel</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Creating Spheres...&quot;</span><span style="color: #000000;">, </span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #008000;">// Call on the rendering thread...</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">mSurfaceView.queueEvent</span><span style="color: #000000;">(</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>new </strong></span><span style="color: #000000;">Runnable</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">run</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">RajLog.enableDebug</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>false</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">createSpheres</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">RajLog.enableDebug</span><span style="color: #000000;">(</span><span style="color: #0000c0;"><strong>true</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">clearProgressLabel</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">startRendering</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Save our JSON data for when we restore (this happens when</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// we change tablet orientation, for instance)</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">saveInstancedState</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle savedInstanceState</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">savedInstanceState.putString</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Json&quot;</span><span style="color: #000000;">, mJsonResults</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">savedInstanceState.putInt</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Level&quot;</span><span style="color: #000000;">, mLevel</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #008000;">// Restore our state by re-processing the JSON</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">restoreInstancedState</span><span style="color: #000000;">()</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">restoreInstancedState</span><span style="color: #000000;">(</span><span style="color: #000000;">mBundle</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #0000c0;"><strong>public </strong></span><span style="color: #c00000;"><strong>void </strong></span><span style="color: #000000;">restoreInstancedState</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle savedInstanceState</span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #0000c0;"><strong>if </strong></span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState != </span><span style="color: #0000c0;"><strong>null</strong></span><span style="color: #000000;">)</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">{</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mJsonResults = savedInstanceState.getString</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Json&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">mLevel = savedInstanceState.getInt</span><span style="color: #000000;">(</span><span style="color: #990000;">&quot;Level&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160; </span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="color: #000000;">setSpinnerLevel</span><span style="color: #000000;">(</span><span style="color: #000000;">mLevel</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span> <br /><span style="color: #ffffff;">&#0160;&#0160;&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #ffffff;">&#0160; </span><span style="color: #000000;">}</span> <br /><span style="color: #000000;">}</span></code></div>
<p>Aside from these source files, there are minor changes needed to the standard project set-up: firstly, I’ve customised the default launcher icons in the appropriate resource locations. Secondly, we also need to flag our app as requiring Internet access, which can be done by adding this line to the AndroidManifest.xml file:</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">&lt;</span><span style="line-height: 140%; color: #a31515;">uses-permission</span><span style="line-height: 140%; color: blue;"> </span><span style="line-height: 140%; color: red;">android:name</span><span style="line-height: 140%; color: blue;">=</span><span style="line-height: 140%;">&quot;</span><span style="line-height: 140%; color: blue;">android.permission.INTERNET</span><span style="line-height: 140%;">&quot;</span><span style="line-height: 140%; color: blue;">/&gt;</span></p>
</div>
<p class="java">Before we see the app in action, a few words on my experience developing this app.</p>
<p class="java">One thing I found, pretty quickly, is that you need to be aware of which thread is executing which operation. My initial version of the app accessed the web-service from the UI thread, which meant the screen didn’t refresh, at all. Which was OK until I wanted to integrate a process bar, or keep the UI responsive in case the device was rotated.</p>
<p class="java">So I used an AsyncTask to move the web-service call and processing away from the main UI thread. But then the OpenGL/Rajawali geometry needed to be added on the rendering thread, which I ultimately managed to have happen via the mSurfaceView member of the Activity class. Until I found that little trick, no geometry appeared at all, which was rather frustrating.</p>
<p class="java">And all the UI updates need to be made back on the main thread, of course, so that took a little more work to make happen.</p>
<p class="java">Thankfully Eclipse makes it easy to keep track of which thread is executing as you step through code in the debugger. Now I know what to look for, I suspect it’ll be easier to develop further Android apps, in future.</p>
<p class="java">I mentioned the need to respond to a device rotation… when that happens the Activity gets closed and recreated. But before that happens, the Activity has the chance to store some state – from onSaveInstanceState() – to be retrieved in the Activity’s onCreate() call. I decided to take the simple way out, here, and store the JSON string received from the web-service, to then reparse it and create our geometry. This was certainly simple to implement, but can be a bit time-consuming. There may be a better way to store and recreate our Rajawali geometry, sphere-by-sphere, but for now I’ve kept things simple.</p>
<p class="java">Now for some screenshots of the app working on my Kindle Fire…</p>
<p class="java">Firstly, here’s the app’s icon in the “carrousel” view and in the main app list. Apparently it’s only possible to display the higher-resolution icons (512 x 512) in apps that have been installed from the Amazon Store, which is a bit annoying but understandable.</p>
<p class="java"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb068059970c-pi" target="_blank"><img alt="Our app on the Kindle carrousel" border="0" height="319" src="/assets/image_199442.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Our app on the Kindle carrousel" width="189" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb0680d0970c-pi" target="_blank"><img alt="Our apps" border="0" height="319" src="/assets/image_418020.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Our apps" width="189" /></a></p>
<p class="java">When the app is launched you get to see two progress bars in action – the first is an indeterminate one (with Kindle Fire branding being picked up automagically) for the call to the web-service (as we don’t know how long it will take) and the second is a determinate one, as we know how many spheres we will be creating for that level.</p>
<p class="java"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb06813d970c-pi" target="_blank"><img alt="First progress bar during web-service call" border="0" height="319" src="/assets/image_88888.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="First progress bar during web-service call" width="189" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201630510c59f970d-pi" target="_blank"><img alt="Second progress bar while creating spheres" border="0" height="319" src="/assets/image_55058.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Second progress bar while creating spheres" width="189" /></a></p>
<p class="java">By default the “Level 3” packing is displayed. This can be changed by touching the “Level 3” label, which brings up a list of possible levels to select from.</p>
<p class="java"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb06825f970c-pi" target="_blank"><img alt="Level 3" border="0" height="319" src="/assets/image_584119.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 3" width="189" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb06827e970c-pi" target="_blank"><img alt="Selecting a new level" border="0" height="319" src="/assets/image_710765.jpg" style="background-image: none; margin: 20px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px; border-width: 0px;" title="Selecting a new level" width="189" /></a></p>
<p class="java">Be warned: I’ve left all the various levels available from the web-service on the list. On my Kindle Fire, I can only load up to level 5 before the app dies (presumably from lack of memory). Here are the various levels on my Kindle Fire, as previewed in the last post:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eaee3bae970c-pi" target="_blank"><img alt="Level 1" border="0" height="149" src="/assets/image_180187.jpg" style="background-image: none; margin: 20px 9px 20px 3px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 1" width="89" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eaee3bc6970c-pi" target="_blank"><img alt="Level 2" border="0" height="149" src="/assets/image_28212.jpg" style="background-image: none; margin: 20px 9px 20px 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px; border-width: 0px;" title="Level 2" width="89" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2016304f89d7b970d-pi" target="_blank"><img alt="Level 3" border="0" height="149" src="/assets/image_194206.jpg" style="background-image: none; margin: 20px 9px 20px 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 3" width="89" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2016765ebded4970b-pi" target="_blank"><img alt="Level 4" border="0" height="149" src="/assets/image_775769.jpg" style="background-image: none; margin: 20px 9px 20px 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 4" width="89" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eaee3c0a970c-pi" target="_blank"><img alt="Level 5" border="0" height="149" src="/assets/image_668743.jpg" style="background-image: none; margin: 20px 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 5" width="89" /></a></p>
<p class="java">On a friend’s Galaxy Tab 10.1 (thanks, Jonathan! :-), the app gets up to level 7, but won’t go beyond. Here are some screenshots from that device, to give you a feel for some of the differences:</p>
<p class="java"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168eb0682ea970c-pi" target="_blank"><img alt="Indeterminate progress on a Galaxy Tab" border="0" height="98" src="/assets/image_556960.jpg" style="background-image: none; margin: 20px 10px 10px 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Indeterminate progress on a Galaxy Tab" width="154" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20167660422d7970b-pi" target="_blank"><img alt="Determinate progress on a Galaxy Tab" border="0" height="98" src="/assets/image_856936.jpg" style="background-image: none; margin: 20px 10px 10px 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Determinate progress on a Galaxy Tab" width="154" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201630510c6c7970d-pi" target="_blank"><img alt="Level 3 on a Galaxy Tab" border="0" height="98" src="/assets/image_290525.jpg" style="background-image: none; margin: 20px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 3 on a Galaxy Tab" width="154" /></a></p>
<p class="java"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201630510c6ea970d-pi" target="_blank"><img alt="Choosing a level on a Galaxy Tab" border="0" height="98" src="/assets/image_577465.jpg" style="background-image: none; margin: 0px 0px 20px 82px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px; border-width: 0px;" title="Choosing a level on a Galaxy Tab" width="154" /></a><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201630510c733970d-pi" target="_blank"><img alt="Level 7 on a Galaxy Tab" border="0" height="98" src="/assets/image_225167.jpg" style="background-image: none; margin: 0px 0px 20px 10px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="Level 7 on a Galaxy Tab" width="154" /></a></p>
<p class="java">Please be sure to post a comment if you manage to get beyond level 7 on your phone/tablet! :-)</p>
<p class="java">Now for a brief description of the gestures you can use with the Apollonian model:</p>
<div class="java">
<ul>
<li><strong>Drag-rotate</strong> – touching a location on the screen with your finger and then moving it gradually around, you’ll see the the model rotate along with your gesture. </li>
<li><strong>Swipe-spin</strong> – performing a swipe will cause the sphere to start spinning in the direction of the swipe. Swiping again in the same direction will cause the rate of spin to increase. </li>
<li><strong>Tap-pause/play</strong> – tapping the screen once will cause any spinning to pause. Tapping again will cause the spin to continue. </li>
<li><strong>Double tap-stop</strong> – double-tapping the screen will cancel any ongoing spin. </li>
<li><strong>Pinch-zoom</strong> – the classic pinch gesture will zoom in or out (even into to the model itself, if you want to check out its internals) . </li>
</ul>
</div>
<p>Speaking of the model’s internals… just as with <a href="http://through-the-interface.typepad.com/through_the_interface/2012/04/calling-a-web-service-from-a-unity3d-scene.html" target="_blank">the recent Unity3D implementation</a>, the above code filters out any spheres not near the outer edge of our packing. At some point there are a few settings I’d like to add, probably via the standard settings mechanism for Android apps: I’d like the option to toggle the addition of occluded spheres to the model, plus some kind of control over the smoothness of our spheres (right now I’ve hard-coded a segmentation of 9 for each of the width and height of the sphere: adjusting this would impact the polygon count and presumably the level a particular device could work with).</p>
<p>A quick word on the supporting tools I used to document the app in action…</p>
<p>The above Kindle Fire screenshots were taken with the standard <a href="http://developer.android.com/guide/developing/debugging/ddms.html" target="_blank">DDMS (Dalvik Debug Monitor Service)</a> tool that ships with the Android SDK. The Galaxy Tab has a screenshot capability integrated – something that could well be a standard Android feature, for all I know – which looked pretty handy. And apparently another tool called <a href="http://blog.ribomation.com/droid-at-screen/" target="_blank">Droid@Screen</a> can streamline this by placing a sequence of images in a particular folder, should you want to try it.</p>
<p>I found another tool called <a href="http://code.google.com/p/androidscreencast/" target="_blank">androidscreencast</a>, which allowed me to record <a href="http://through-the-interface.typepad.com/files/ApollonianViewer.m4v" target="_blank">this simple demo video</a> (at a pretty low frame-rate: all these tools use the mechanism provided by DDMS, it seems, and are therefore limited by the number of frames per second that can be transferred via the USB link). There are other tools out there that probably record at a higher frame-rate but require root access to your device, and I’ve chosen not to root my Kindle Fire, for now.</p>
<p>If you’re interested in side-loading the app to see it in action on your own Android device, <a href="http://through-the-interface.typepad.com/files/ApollonianViewer.apk" target="_blank">here’s the .apk distribution</a>. And please do let me know if you have any feedback!</p>
