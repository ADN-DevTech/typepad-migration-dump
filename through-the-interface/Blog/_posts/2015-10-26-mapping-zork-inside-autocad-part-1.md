---
layout: "post"
title: "Mapping Zork inside AutoCAD &ndash; Part 1"
date: "2015-10-26 15:30:37"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Games"
  - "Geometry"
  - "Graphics system"
  - "HTML"
  - "JavaScript"
original_url: "https://www.keanw.com/2015/10/mapping-zork-inside-autocad-part-1.html "
typepad_basename: "mapping-zork-inside-autocad-part-1"
typepad_status: "Publish"
---

<p>I mostly despise jetlag but once in a while manage to harness it for something positive. I remember some great trips to Asia, waking up at strange times to experience the dawn, walking the streets and seeing everyday life starting up around me. These days I typically find jetlag to be a bit of a curse, but this weekend I ended up using it to tackle a fun challenge: generating maps for <a href="https://en.wikipedia.org/wiki/Z-machine" target="_blank">Z-machine</a> games such as <a href="https://en.wikipedia.org/wiki/Zork" target="_blank">Zork</a> inside AutoCAD. Something I mentioned in <a href="http://through-the-interface.typepad.com/through_the_interface/2015/09/playing-zork-inside-autocad.html" target="_blank">a recent blog post</a> but was reminded of last Thursday while catching up with Christer Janson in San Rafael.</p>  <p>You can find <a href="http://kotaku.com/5843715/the-delightful-home-made-maps-of-the-zork-series/" target="_blank">a number of Zork maps online</a>. <a href="http://www.technologytell.com/gadgets/27160/a-visual-map-of-zork/" target="_blank">My favourite</a> is from the mainframe version (<a href="https://www.reddit.com/r/raldi/comments/10dtch/i_spent_my_weekend_hacking_zork/" target="_blank">by all accounts</a> it may well be the only that exists from that era):</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c7e32aca970b-pi" target="_blank"><img title="Manually mapping Zork" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 50px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Manually mapping Zork" src="/assets/image_521962.jpg" width="504" height="309" /></a></p>  <p>While I didn’t expect to recreate anything as beautiful as this, I did want to let people capture the essence of the games they play, and provide them some flexibility to control the layout of the map. My original, abortive attempts at mapping Zork automatically were based on the assumption that Zork’s map was perfectly recto-linear (which it absolutely isn’t).</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d16cf7be970c-pi" target="_blank"><img title="Zork maps aren&#39;t gridlike" style="float: none; margin: 50px auto; display: block" alt="Zork maps aren&#39;t gridlike" src="/assets/image_895398.jpg" width="506" height="517" /></a></p>  <p>I’d already decided I needed to use a graph – rather than a grid – to map Zork, but had stalled when I realised I didn’t have a way to identify locations uniquely: many have the same names and some also get described differently if you’ve been there before. When I chatted this over with Christer – who had spent many years playing and mapping Zork, as a teenager – he suggested hacking the Z-Machine VM to expose a unique identifier (which certainly exists in the file format) for the current location. This proved to be straightforward to do and worked a treat, but meant I also then had to tackle the bigger problem of getting the rest of it to work. Thanks, Christer! ;-)</p>  <p>I knew I wanted to use a JavaScript library for the graph management. I’d thought <a href="http://marvl.infotech.monash.edu/webcola/" target="_blank">Cola.js</a> might be a candidate but ended up settling on <a href="http://js.cytoscape.org" target="_blank">Cytoscape.js:</a> Cola.js is just one higher-level layout library that works with Cytoscape.js. We’ll see whether it makes sense to use Cola, too, or something else.</p>  <p>It ended up being straightforward to integrate Cytoscape into AutoCAD: I chose to use a palette, rather than a document window, as this sets us up nicely for bringing the geometry across into AutoCAD (something we’ll see in another post).</p>  <p>Here’s the palette in action – expanded to the extent of the video recording so it’s nicely visible. Right now it’s launched using a separate command – ZMAP – but could also be launched by the ZORK command directly.</p>  <p align="center"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d16cf7d5970c-pi" target="_blank"><img title="Mapping Zork using AutoCAD" style="margin: 50px 0px; display: inline" alt="Mapping Zork using AutoCAD" src="/assets/image_398133.jpg" width="507" height="516" /></a></p>  <p>The graph is mostly laid out relative to the points of the compass, but you can position nodes manually as you go. When you come to a location that already exists in the graph, its node will get highlighted and subsequent new nodes will be positioned relative to that.</p>  <p>Here’s a static image of a more extensive graph I mapped over an additional minute or so:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d16cf7ed970c-pi" target="_blank"><img title="Zork map" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 50px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Zork map" src="/assets/image_947051.jpg" width="504" height="295" /></a></p>  <p>The code is basically ready to share but I’m going to finish up the “Export to AutoCAD” capability before I post it here. It’s unlikely I’ll go the extra step to make the code create associative geometry, but it will certainly show you how it’s possible to bring a snapshot of data across from a graph layout system such Cytoscape into an AutoCAD drawing. Which will be interesting for people wanting to implement this kind of workflow (beyond this somewhat narrow – albeit super-fun – scenario :-).</p>
