---
layout: "post"
title: "Implementing contracts in the AutoCAD MRU browser using WinRT"
date: "2012-03-28 18:04:05"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "WinRT"
original_url: "https://www.keanw.com/2012/03/implementing-contracts-in-the-autocad-mru-browser-using-winrt.html "
typepad_basename: "implementing-contracts-in-the-autocad-mru-browser-using-winrt"
typepad_status: "Publish"
---

<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20168e9582e5f970c-pi" target="_blank"><img style="background-image: none; border-right-width: 0px; margin: 0px 0px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Charmed, I&#39;m sure" border="0" alt="Charmed, I&#39;m sure" align="right" src="/assets/image_908894.jpg" width="40" height="244" /></a>As part of my quest to understand WinRT more completely, I had a few goals for the MetroCAD application we saw in <a href="http://through-the-interface.typepad.com/through_the_interface/2012/03/a-simple-mru-browser-for-autocad-data-using-winrt.html" target="_blank">this previous post</a>. Firstly, I wanted to add some <a href="http://msdn.microsoft.com/en-us/library/windows/apps/hh464906" target="_blank">contract</a> support to the application, allowing it to participate in operations that Windows 8 has standardised across Metro-style applications. The main contracts I wanted to support were for search, sharing and settings. Secondly, I wanted to be able to launch AutoCAD – or another DWG editor – from within our Metro-style application.</p>  <p>The three contracts I wanted to support are all accessible via the “Charms” menu in Windows 8: if you place the mouse cursor at the bottom right of the screen – or swipe left with your finger from the right-hand side of a touch-sensitive screen, although I have trouble getting this to work – then your Charms should appear (see the image to the right).</p>  <p>What’s really nice about contracts is how well the application integrates into the Metro interface: settings are all found in one place, our app – along with many others – participates in unified search, and sharing – sending a link to a drawing by email, for instance – becomes really easy for the user.</p>  <p>Check out this video of the app’s new capabilities in action, before we look at some of the implementation details (albeit without diving into code):</p>  <p><object data="http://through-the-interface.typepad.com/presentations/jingswfplayer.swf" height="292" id="scPlayer" type="application/x-shockwave-flash" width="470"> <param name="data" value="http://through-the-interface.typepad.com/presentations/jingswfplayer.swf" /> <param name="quality" value="high" /> <param name="bgcolor" value="#FFFFFF" /> <param name="flashVars" value="thumb=http://through-the-interface.typepad.com/presentations/FirstFrame-2.jpg&amp;containerwidth=1277&amp;containerheight=794&amp;content=http://through-the-interface.typepad.com/presentations/MetroCAD-2.swf&amp;blurover=false" /> <param name="allowFullScreen" value="true" /> <param name="scale" value="showall" /> <param name="allowScriptAccess" value="always" /> <param name="base" value="http://through-the-interface.typepad.com/presentations/" /> <param name="src" value="http://through-the-interface.typepad.com/presentations/jingswfplayer.swf" /> </object></p>  <p><strong>Search</strong></p>  <p>Adding support for search inside the MetroCAD app was pretty straightforward: when the App is launched (i.e. from our OnLaunched() event handler), we register for the QuerySubmitted event for the current view’s “search pane”. In our handler for this event, we navigate to the search results, which we generate as a new “group”. If you’re interested in the code, look at the implementation of OnQuerySubmitted() and where it calls into.</p>  <p><strong>Sharing</strong></p>  <p>Just as we hooked into the search pane, we need to add an event handler to the current view’s “data transfer manager” to implement sharing. We handle the DataRequested event – for the ItemDetailPage, as we want to enable sharing for individual items only – which populates properties of the requested data with information from the selected item. Check our the OnDataRequested() event handler for the details.</p>  <p><strong>Settings</strong></p>  <p>Once again, to implement settings we get the “settings pane” for the current view and attach a handler to the CommandsRequested event. From here we add some “commands” to set various settings – in our case some simple buttons to toggle sorting between “by day” and “by name”. These modify the ApplicationData.Current.RoamingSettings for our application, which – under the hood – is really cool: these settings are automagically synced via the cloud (assuming you’ve logged in using your Windows Live account, it’ll happen via that) and propagate across your various devices.</p>  <p><strong>Launching AutoCAD</strong></p>  <p>I had thought this would be much harder than it was (and in some ways it would be, if we wanted to launch a specific version of AutoCAD, for instance): while WinRT prevents Metro-style application from launching arbitrary “desktop” applications, it does let Metro-style applications open a file with one of its registered handlers. So as long as AutoCAD is installed on the system – and is therefore registered to work with DWG files – then we can request that a DWG file be opened, and AutoCAD will be one of the options presented to the user.</p>  <p>Well, it’s almost that easy. As the WinRT sandbox limits apps from accessing arbitrary files on the local system, we do have to register MetroCAD as being interested in reading DWG files in our application’s manifest, and we then have to limit loading files from “known locations” such as the “My Documents” folder. For the sake of this demo app, I just copied the various files into the local “My Documents” folder, so the app could find them there. For details on this, check the OnDoubleTapped() event handler, which shows how to use GetFileAsync() and then Launcher.LaunchFileAsync().</p>  <p>And before I forget, <a href="http://through-the-interface.typepad.com/files/MetroCAD-2.zip" target="_blank">here’s the updated source project</a>.</p>
