---
layout: "post"
title: "Adding a context menu command to objects in the Forge Viewer"
date: "2016-08-09 12:00:33"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "HoloLens"
  - "JavaScript"
  - "PaaS"
  - "User interface"
original_url: "https://www.keanw.com/2016/08/adding-a-context-menu-command-to-objects-in-the-forge-viewer.html "
typepad_basename: "adding-a-context-menu-command-to-objects-in-the-forge-viewer"
typepad_status: "Publish"
---

<p>I’ve been spending quite a bit of time working on our “Dasher 360” prototype, recently. Which is, of course, based on the Forge Viewer.</p> <p>A simple – but handy – feature I added today is to add a context menu item to be displayed when objects are selected – and right-clicked – inside the Viewer. In my case I wanted to prototype a possible workflow for a “Send to HoloLens” capability: the feature itself isn’t ready (that’s what you might call an extreme understatement), but I thought I’d add the menu item in preparation for something being implemented.</p> <p>Here’s a simple extension written in TypeScript that shows how you can add a context menu using the registerContextMenuCallback() method. The same approach will work just as well in JavaScript, of course.</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: green">/// &lt;reference path='../../../../../typings/lmv-client/lmv-client.d.ts' /&gt;</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: blue">export</span> <span style="color: blue">default</span> <span style="color: blue">class</span> ContextMenuExtension <span style="color: blue">extends</span> Autodesk.Viewing.Extension {</p> <p style="margin: 0px">&nbsp; <span style="color: blue">constructor</span>(viewer: Autodesk.Viewing.Private.GuiViewer3D, options: <span style="color: blue">any</span>) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">super</span>(viewer, options);</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; load(): <span style="color: blue">boolean</span> {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; console.log(<span style="color: #a31515">'ContextMenuExtension loaded'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> self = <span style="color: blue">this</span>;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.viewer.registerContextMenuCallback(</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515">'Autodesk.Dasher.ContextMenuExtension'</span>,</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">function</span> (menu, status) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (status.hasSelected) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; menu.push({</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: <span style="color: #a31515">'Send to HoloLens'</span>,</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target: <span style="color: blue">function</span> () {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> messageSpecs = {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515">'msgTitleKey'</span>: <span style="color: #a31515">'Sent to HoloLens'</span>,</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515">'messageKey'</span>: <span style="color: #a31515">'Sent to HoloLens'</span>,</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515">'messageDefaultValue'</span>: <span style="color: #a31515">'This object has been sent to HoloLens for viewing.'</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Autodesk.Viewing.Private.HudMessage.displayMessage(</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.viewer.container, messageSpecs</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setTimeout(</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">function</span>() {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Autodesk.Viewing.Private.HudMessage.dismiss();</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, 10000</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; );</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; unload(): <span style="color: blue">boolean</span> {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; console.log(<span style="color: #a31515">'ContextMenuExtension unloaded'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.viewer.unregisterContextMenuCallback(<span style="color: #a31515">'Autodesk.Dasher.ContextMenuExtension'</span>);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>Here’s the context menu in action. Although it doesn’t actually send anything anywhere – let alone to HoloLens – just yet.</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d20ec0ed970c-pi"><img title="Context menu in Dasher 360" style="float: none; margin: 30px auto; display: block" alt="Context menu in Dasher 360" src="/assets/image_557715.jpg" width="500" height="413"></a></p>
