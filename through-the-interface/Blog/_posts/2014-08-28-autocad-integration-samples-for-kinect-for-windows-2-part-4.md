---
layout: "post"
title: "AutoCAD integration samples for Kinect for Windows 2 &ndash;Part 4"
date: "2014-08-28 17:43:18"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Kinect"
  - "Point clouds"
  - "Reality capture"
original_url: "https://www.keanw.com/2014/08/autocad-integration-samples-for-kinect-for-windows-2-part-4.html "
typepad_basename: "autocad-integration-samples-for-kinect-for-windows-2-part-4"
typepad_status: "Publish"
---

<p>After <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/autocad-integration-samples-for-kinect-for-windows-2-part-1.html" target="_blank">introducing the series</a>, <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/autocad-integration-samples-for-kinect-for-windows-2-part-2.html" target="_blank">taking a look at some basic samples</a> and then <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/autocad-integration-samples-for-kinect-for-windows-2-part-3.html" target="_blank">looking at importing Kinect’s high-definition face tracking data into AutoCAD</a>, it’s time for (in my opinion) the most interesting piece of functionality provided on the Kinect SDK, <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/kinect-fusion-for-kinect-for-windows-2.html" target="_blank">Kinect Fusion</a>.</p>  <p>Kinect Fusion is a straightforward way to capture 3D volumes – allowing you to move the Kinect sensor around to capture objects from different angles – and the <strong>KINFUS </strong>command in <a href="http://through-the-interface.typepad.com/files/KinectSamples-v2.0.zip" target="_blank">these integration samples</a> let’s you bring the captured data into AutoCAD. Which basically turns Kinect into a low-cost – and reasonably effective – 3D scanner for AutoCAD.</p>  <p>The KINFUS command (I’ve now done away with having a monochrome KINFUS command and a colour KINFUSCOL command… KINFUS now just creates captures with colour) hosts the Kinect Fusion runtime component and provides visual feedback on the volume as you map it, finally giving you options for bringing the data into your active drawing. Much as <a href="http://through-the-interface.typepad.com/through_the_interface/2013/03/kinect-fusion-inside-autocad.html" target="_blank">I’ve</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/10/kinect-fusion-updated-to-include-colour.html" target="_blank">talked</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/10/kinect-fusion-approaches-for-point-cloud-generation-inside-autocad.html" target="_blank">about</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/11/leap-motion-kinect-fusion-sensortag.html" target="_blank">in</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/11/au-online-live-session-on-kinect-fusion-and-autocad.html" target="_blank">the</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2014/01/au-2013-classes-available-on-demand.html" target="_blank">past</a> for KfW v1, although this version has a few differences.</p>  <p>Firstly, <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/kinect-fusion-for-kinect-for-windows-2.html" target="_blank">as mentioned recently</a>, the KfW v2 implementation of Kinect Fusion is much more stable: while with v1 it was not really viable to effectively run Kinect Fusion within a 3D design app – the processing lag when marshaling 3D data made it close to unusable, at least in my experience – with v2 things are much better. It’s quite possible that much of this improvement stems from the use of a “camera pose” database, which makes tracking between frames much more reliable.</p>  <p>Using Kinect Fusion for “reality capture” is still some way off being a completely polished experience, but for someone with appropriate expectations – and who’s prepared to put up with a certain amount of frustration – it can be worthwhile.</p>  <p>Here’s a snapshot of a capture of a car we saw in a previous post:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a73e0ab605970d-pi" target="_blank"><img title="Kinect Fusion on a car" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Kinect Fusion on a car" src="/assets/image_788964.jpg" width="454" height="361" /></a></p>  <p>With previous incarnations of this integration, the main way to bring the captured data into AutoCAD has been as a point cloud, mainly as we’re dealing with large volumes of data (captures of 2-3 million points are common, for instance). For fun, though – and because the point cloud import story isn’t as good with AutoCAD 2015, as you now have to index .XYZ files in ReCap Studio before attaching the .RCP inside AutoCAD – I went ahead and implemented mesh import, too.</p>  <p>So the KINFUS command now gives you the option to bring in a mesh rather than a point cloud, once you’ve finished capturing the volume and have selected the voxel step (which allows you to reduce the size of the data you bring in).</p>  <p>A quick word of caution, though. Point clouds – even if they’re written to a text file for indexing – can basically be as big as you want, AutoCAD will manage to bring them in without any problem. Meshes, on the other hand, are a different matter. If you don’t care about colour, you can create a SubDMesh object that has up to about 2 million vertices (at least that’s what I’ve found). Beyond that and the mesh creation will almost certainly fail.</p>  <p>And if you want to capture a coloured mesh – which I have to admit is pretty awesome, see below for an example – you shouldn’t expect to go beyond 300K vertices: the creation of the SubDMesh should work fine, but AutoCAD will take forever to apply the per-vertex colours on the mesh (if it even manages to do so).</p>  <p>A little narcissism comes with the territory when you’re a blogger, so I chose myself as the subject of my initial Kinect Fusion mesh import into AutoCAD. Well, that and the Kinect was pointing at me and I didn’t bother pointing it elsewhere.</p>  <p>As you can imagine, I was pretty excited when I first managed to get colours imported. Here’s a little tale of how things looked…</p>  <p>The mesh was first displayed in AutoCAD with the “conceptual” visual style, but it was too edgy:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c6d4d530970b-pi" target="_blank"><img title="Conceptual selfie" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Conceptual selfie" src="/assets/image_453053.jpg" width="304" height="296" /></a></p>  <p>I switched the visual style to “realistic”, but it was too shiny:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a73e0ab61f970d-pi" target="_blank"><img title="Realistic selfie" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Realistic selfie" src="/assets/image_464002.jpg" width="304" height="297" /></a></p>  <p>And finally I created my own visual style which was “just right”:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d05eb64e970c-pi" target="_blank"><img title="Better selfie" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Better selfie" src="/assets/image_464362.jpg" width="304" height="297" /></a></p>  <p>Just to prove it is indeed, 3D, here’s a quick GIF (although reduced to 256 colours, of course);</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d05eb781970c-pi"><img title="3D selfie" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="3D selfie" src="/assets/image_218852.jpg" width="240" height="240" /></a></p>  <p>Again, this mesh has 286K vertices, so it’s fairly small by Kinect Fusion’s standards: I chose a 1m<sup>3</sup> capture volume with a voxel density of 256 per metre and then didn’t even move the camera before completing the capture. In case you want to check it out, <a href="http://through-the-interface.typepad.com/files/KinectFusionSelfie.dwg" target="_blank">here’s the 10 MB drawing file</a>.</p>  <p>I do believe it’s possible to use Kinect Fusion to capture complete objects – if enough care is taken not to move the sensor too quickly, and you’re sensible about not trying to capture too much at once. Once tracking fails, I often find the results to become a little unpredictable: you might find you have multiple ground planes at different angles, for instance. It’s natural to want to capture as much as possible in one go, but I’ve found that performing multiple captures that you later aggregate ends up being more efficient. Yes, this is much easier with point clouds that with meshes, of course.</p>  <p>I should mention that the system I’m using is a few years old and a “mobile workstation” (i.e. a high-powered notebook) rather than a full desktop. Here are the results from the Kinect v2 Configuration Verifier:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c6d4db8a970b-pi" target="_blank"><img title="Stuggling to maintain framerate" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; border-left: 0px; display: block; padding-right: 0px" border="0" alt="Stuggling to maintain framerate" src="/assets/image_540462.jpg" width="304" height="381" /></a></p>  <p>I would hope that using a full desktop – or a newer/beefier notebook – would improve tracking and therefore the quality of the results you can generate using Kinect Fusion with AutoCAD. It’s nonetheless interesting to see how well things are moving ahead, though, and this is only with a preview release of the Kinect SDK.</p>
