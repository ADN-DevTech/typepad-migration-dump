---
layout: "post"
title: "Using the HIG to implement a light mode in a Forge application"
date: "2020-03-12 17:06:04"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
original_url: "https://www.keanw.com/2020/03/using-the-hig-to-implement-a-light-mode-in-a-forge-application.html "
typepad_basename: "using-the-hig-to-implement-a-light-mode-in-a-forge-application"
typepad_status: "Publish"
---

<p><a href="https://www.keanw.com/2020/03/supporting-multiple-visual-themes-in-a-forge-application-using-the-autodesk-human-interface-guidelines.html" target="_blank">Last time</a> we saw how it’s possible to use <a href="https://github.com/Autodesk/hig" target="_blank">Autodesk’s HIG</a> to add different visual themes to a Forge viewer application. When I first started down this path, I thought I’d probably just stop at implementing another dark theme inside <a href="http://dasher360.com" target="_blank">Dasher</a>: I suspected it would be a lot of work to implement a light theme.</p><p>It turns out I was wrong: towards the end of last year I’d spent a few days rationalising our use of styles inside Dasher, by eradicating every use of “hardcoded” colours inside CSS styles and have them stored in SCSS variables. It felt like a good thing to do, at the time, and it turned out to be invaluable when it came to implementing a light mode: most of the common colours that were used by Dasher were defined in a single place inside SCSS, and could then be switched to refer to theme-based variables coming from the HIG’s own SCSS files.</p><p>Before we get into the specifics of what it took to implement this, here are a few images of the light mode inside Dasher:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a515e6fc200b-pi" target="_blank"><img width="500" height="312" title="NEST light gray empty" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="NEST light gray empty" src="/assets/image_514117.jpg" border="0"></a></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4f14215200d-pi" target="_blank"><img width="500" height="312" title="NEST light gray full" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="NEST light gray full" src="/assets/image_529919.jpg" border="0"></a></p><p>Here are the animations we saw in the last post, this time showing three themes instead of two:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4f1421d200d-pi" target="_blank"><img width="500" height="312" title="NEST empty with light" style="margin: 30px auto; float: none; display: block;" alt="NEST empty with light" src="/assets/image_179533.jpg"></a></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a515e708200b-pi" target="_blank"><img width="500" height="312" title="NEST full with light" style="margin: 30px auto; float: none; display: block;" alt="NEST full with light" src="/assets/image_964384.jpg"></a></p><p>For the dark themes, I found we ended up using the “surface level” settings, such as:</p><ul><li>$colorScheme-surfaceLevel200Color</li><li>$colorScheme-surfaceLevel250Color</li><li>$colorScheme-surfaceLevel300Color</li><li>$colorScheme-surfaceLevel350Color</li></ul><p>These get mapped according to the HIG themes, and will also be mapped appropriately for light themes (whether the “light gray” theme or the soon-to-be-deprecated “web light” theme). The additional work to support light themes revolved around the need to support a different text (or foreground) colour. Thankfully it was super-simple to have anything in the foreground refer to this HIG variable:<ul><li>$colorScheme-textColor</li></ul><p>Easy!</p><p>It’s interesting to note that the Forge viewer has support for its own light mode: there’s some very helpful information on how to enable this <a href="https://forge.autodesk.com/blog/dark-light-mode-viewer" target="_blank">over on the Forge blog</a>. I found that the foreground colours it uses are different from those in the HIG – it uses pure white for buttons etc. rather than a light gray – so I ended up overriding the Forge viewer’s theme to use the appropriate “surface level” variables coming from the HIG. It was still useful to set light mode in the Forge viewer, despite overriding these settings, as it allows us to use straight CSS to deal with dark vs. light decisions in that we can have rules that work for .adsk-viewing-viewer.dark-theme and others that work for .adsk-viewing-viewer.light-theme.</p><p>Some things can’t be handled by CSS styling within the viewer, however. I ended up finding I needed to set an SCSS variable that indicated the mode. I then used this to set a CSS variable at the root of the DOM that could be accessed from JavaScript (in our case we build this from TypeScript) to make other runtime decisions based on the theme that has been set.</p><p>Here’s where we define this inside SCSS:</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(106, 153, 85);">// Themes are currently lightGray, darkGray and darkBlue</span></div><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'../../../node_modules/@hig/theme-data/build/scss/variables/_lightGrayHighDensityTheme.scss'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(106, 153, 85);">// @import '../../../node_modules/@hig/theme-data/build/scss/variables/_darkGrayHighDensityTheme.scss';</span></div><div><span style="color: rgb(106, 153, 85);">// @import '../../../node_modules/@hig/theme-data/build/scss/variables/_darkBlueHighDensityTheme.scss';</span></div><div><span style="color: rgb(106, 153, 85);">// Variable is 0, 1 and 2 for lightGray, darkGray and darkBlue, respectively</span></div><div><span style="color: rgb(156, 220, 254);">$dark</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(181, 206, 168);">0</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(215, 186, 125);">:root</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">@if</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">$dark</span><span style="color: rgb(212, 212, 212);"> &gt; </span><span style="color: rgb(181, 206, 168);">1</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">--theme</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(206, 145, 120);">darkBlue</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; } </span><span style="color: rgb(197, 134, 192);">@else if</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">$dark</span><span style="color: rgb(212, 212, 212);"> &gt; </span><span style="color: rgb(181, 206, 168);">0</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">--theme</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(206, 145, 120);">darkGray</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; } </span><span style="color: rgb(197, 134, 192);">@else </span><span style="color: rgb(212, 212, 212);">{</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">--theme</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(206, 145, 120);">lightGray</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">}</span></div><div><span style="color: rgb(215, 186, 125);">.dasher_icon</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">@if</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">$dark</span><span style="color: rgb(212, 212, 212);"> &gt; </span><span style="color: rgb(181, 206, 168);">0</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">background-image</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(220, 220, 170);">url</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'/img/DasherIcon.png'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; } </span><span style="color: rgb(197, 134, 192);">@else </span><span style="color: rgb(212, 212, 212);">{</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">background-image</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(220, 220, 170);">url</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'/img/DasherIconGray.png'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">}</span></div><div><br></div></div><p>When I change the theme at build-time, all I need to do is uncomment the theme I want to use – one of three – and then set its index in the $dark variable.</p><p>I’ve implemented a couple of simple utility functions that can be used to get the theme string and determine whether the theme is dark or not:</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(197, 134, 192);">export</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(86, 156, 214);">function</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(220, 220, 170);">getTheme</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">string</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">return</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(220, 220, 170);">getComputedStyle</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">document</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(156, 220, 254);">documentElement</span><span style="color: rgb(212, 212, 212);">).</span><span style="color: rgb(220, 220, 170);">getPropertyValue</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'--theme'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">}</span></div><div><br></div><div><span style="color: rgb(197, 134, 192);">export</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(86, 156, 214);">function</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(220, 220, 170);">isDarkTheme</span><span style="color: rgb(212, 212, 212);">(): </span><span style="color: rgb(78, 201, 176);">boolean</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">themeString</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(220, 220, 170);">getTheme</span><span style="color: rgb(212, 212, 212);">();</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(86, 156, 214);">let</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(86, 156, 214);">true</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">switch</span><span style="color: rgb(212, 212, 212);"> (</span><span style="color: rgb(156, 220, 254);">themeString</span><span style="color: rgb(212, 212, 212);">) {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">case</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'darkGray'</span><span style="color: rgb(212, 212, 212);">):</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(86, 156, 214);">true</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">break</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">case</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'darkBlue'</span><span style="color: rgb(212, 212, 212);">):</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(86, 156, 214);">true</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">break</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">case</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'lightGray'</span><span style="color: rgb(212, 212, 212);">):</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(86, 156, 214);">false</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">break</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">case</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'webLight'</span><span style="color: rgb(212, 212, 212);">):</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(86, 156, 214);">false</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">break</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">default</span><span style="color: rgb(212, 212, 212);">:</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">break</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">return</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">darkTheme</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">}</span></div><div><br></div></div><p>When we create the viewer instance in our code, we can now check the theme set in SCSS and set the mode appropriately inside the viewer, as well as making any dynamic changes to the page’s styling (in this case we add the navbar-inverse class to our Bootstrap navigation bar to make sure it picks up the appropriate dark theme styling):</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">dark</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(220, 220, 170);">isDarkTheme</span><span style="color: rgb(212, 212, 212);">();</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">this</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(156, 220, 254);">_viewer</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(220, 220, 170);">setTheme</span><span style="color: rgb(212, 212, 212);">((</span><span style="color: rgb(156, 220, 254);">dark</span><span style="color: rgb(212, 212, 212);"> ? </span><span style="color: rgb(206, 145, 120);">'dark'</span><span style="color: rgb(212, 212, 212);"> : </span><span style="color: rgb(206, 145, 120);">'light'</span><span style="color: rgb(212, 212, 212);">) + </span><span style="color: rgb(206, 145, 120);">'-theme'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(197, 134, 192);">if</span><span style="color: rgb(212, 212, 212);"> (</span><span style="color: rgb(156, 220, 254);">dark</span><span style="color: rgb(212, 212, 212);">) {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(86, 156, 214);">const</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(156, 220, 254);">nav</span><span style="color: rgb(212, 212, 212);"> = </span><span style="color: rgb(156, 220, 254);">document</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(220, 220, 170);">getElementById</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'main-nav'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">nav</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(156, 220, 254);">classList</span><span style="color: rgb(212, 212, 212);">.</span><span style="color: rgb(220, 220, 170);">add</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'navbar-inverse'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);"></span></div></div><p>Overall this all works well, despite the frustration of having to choose the theme at build-time rather&nbsp; than allowing the user to choose it at run-time (or have it decided based on the OS setting, such as was shown over on the Forge blog). This is definitely something I want to work out how to do, especially now that we have a decent light mode working.</p><p>And speaking of the light mode working, here’s an animation of some data being shown in Dasher with the light mode enabled. Being a coder at heart, I’m overall a big fan of dark mode apps, but I have to admit that Dasher looks sexy even in light mode!</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a515e70c200b-pi" target="_blank"><img width="500" height="312" title="Light mode Dasher" style="margin: 30px auto; float: none; display: block;" alt="Light mode Dasher" src="/assets/image_611382.jpg"></a></p>
