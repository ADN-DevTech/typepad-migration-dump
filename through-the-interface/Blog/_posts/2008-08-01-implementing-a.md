---
layout: "post"
title: "Implementing a CAD Standards plugin for AutoCAD using .NET"
date: "2008-08-01 07:04:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
original_url: "https://www.keanw.com/2008/08/implementing-a.html "
typepad_basename: "implementing-a"
typepad_status: "Publish"
---

<p>This question came in recently from a developer:</p>  <blockquote>   <p><em>I've noticed a lot of talk about cad standards in my circles - any chance of a post on creating a CAD Standards plugin for use in the AutoCAD CAD Standards checker that companies could take and run with to produce their custom checks? For example, is the titleblock to company standard and inserted in the right space, are the xrefs inserted at 0,0 etc.</em></p> </blockquote>  <p>I thought this was an interesting one to handle: back when I was based in San Rafael I (along with members of my team) worked closely with the CAD Standards feature team (during the AutoCAD 2004 timeframe, if memory serves me correctly), to develop custom plugin samples showing how to use the CAD Standards API from C++ and Visual Basic. The core requirement was to develop plugins that checked actual geometry in the drawing - something the standard plugins did not, as they focused on symbol table records such as layers and linetypes. The concept we came up with, at the time, was contrived but fun: to compare circles inside a drawing with those stored in the associated CAD Standards template (.DWS) file, and suggest changing the colours of the &quot;incorrect&quot; circles to those of the most similar size in the DWS file.</p>  <p>While this concept is, of course, something that no-one in their right mind would ever want to implement in a real software package, the principles shown are generic enough in nature and (in my opinion, at least) quite relevant to anyone wanting to check geometry using a CAD Standards plugin - something in which the developer asking the above question is clearly interested.</p>  <p>The CAD Standards API is a COM API, so while we implemented the original plugin sample in C++, the main objective at the time was to create a sample in VB6. This meant some changes were needed to the original API implementation, as although it was a COM API, the original API specification relied on datatypes that were not usable from VB6 clients (there was at least one pure COM interface in the API set, and not Automation-compatible, if I recall correctly). That's also why the COM interface we need to implement for a CAD Standards plugin is IAcStPlugin2 rather than IAcStPlugin.</p>  <p>The original VB6 sample, along with an early port to VB.NET (in this case VB7, the first .NET implementation of Visual Basic) are available as part of <a href="http://adn.autodesk.com/adn/servlet/devnote?siteID=4814862&amp;id=5411684&amp;linkID=4900509">this DevNote</a> (accessible to ADN members). The DevNote is, admittedly, out-of-date... we're in the process of during a mass refresh of KB content on the ADN site, so this was a very timely request (and allows me to contribute in some way to the content migration effort :-). There's quite a lot to this sample, so here is <a href="http://through-the-interface.typepad.com/through_the_interface/files/CircleStandard.zip">the source along with the supporting files I created when writing this post</a>.</p>  <p>Here's the C# code:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: green">// </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">//&#160; AutoCAD CAD Standards API Sample</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">//&#160; CircleStandard.cs : CAD Standards Plugin Sample for C#</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// This sample adds a custom plugin to the CAD Standards</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// Drawing Checker. </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">//</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// The sample plugin tests for a match between the color of a</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// circle in the current drawing, and any of the colors of</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// circles contained in the specified standards (.DWS) files.</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// All the colors of the standard circles are considered as</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// fix candidates of the circle being checked. The recommended</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// fix object will be the standard circle having the nearest</span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// radius to the circle being checked.</span></p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> AcStMgr;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Interop.Common;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> MSXML2;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> System.Collections.Generic;</p>    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">using</span> System.Runtime.InteropServices;</p>    <br />    <p style="font-size: 8pt; margin: 0px"><span style="color: blue">namespace</span> CircleStandard</p>    <p style="font-size: 8pt; margin: 0px">{</p>    <p style="font-size: 8pt; margin: 0px">&#160; [<span style="color: #2b91af">ProgId</span>(<span style="color: #a31515">&quot;CircleStandard.CircleStandard&quot;</span>)]</p>    <p style="font-size: 8pt; margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">CircleStandard</span> : <span style="color: #2b91af">IAcStPlugin2</span></p>    <p style="font-size: 8pt; margin: 0px">&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Declare variables</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">ContextList</span> m_contexts =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">ContextList</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">AcStManager</span> m_mgr;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">CircleStandard</span> m_plugin;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">AcadDatabase</span> m_checkDb;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">AcadDatabase</span> m_dwsDb;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">AcStError</span> m_err;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">object</span> m_fixArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">CircleCache</span>[] m_cirCacheArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">int</span> m_recFixIndex;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">int</span> m_curIndex;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">int</span> m_fixCnt;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">string</span> m_propName;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Initialize</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Initializes the plugin</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Initialize(<span style="color: #2b91af">AcStManager</span> mgr)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// This is the only member function in which</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the interface is passed an IAcStManager interface. </span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Store pointer to Manager object</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_mgr = mgr;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_plugin = <span style="color: blue">this</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// GetObjectFilter</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Plugin populates the provided array with class names</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// of objects that it can check</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">object</span> GetObjectFilter()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// In this case we're only interested in circles</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] filtArray = <span style="color: blue">new</span> <span style="color: blue">string</span>[1];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; filtArray[0] = <span style="color: #a31515">&quot;AcDbCircle&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> filtArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// SetupForAudit</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Sets the context for a plugin to check a drawing</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> SetupForAudit(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadDatabase</span> db,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> pathName,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> objNameArray,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> objPathArray,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> objDbArray)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// This method defines the context in which a plug-in</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// will operate, specifically the drawing to check and</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the DWS files that should be used to check the drawing.</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Here we cache our DWS standards definitions and make</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// an initial cache of circles in the DWG to be checked.</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// NOTE: AcadDatabase objects contained in objDbArray</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// are ***not*** guaranteed to be valid after this call.</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// They should not be cached!!!</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (db != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Cache a pointer to the database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_checkDb = db;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// pDb is the DWG to be checked</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Store list of circles in drawing in m_ObjIDArray</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_checkDb != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Cache list of all circles in the current drawing</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: #2b91af">AcadObject</span> obj <span style="color: blue">in</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_mgr.get_ModelSpaceProxy(m_checkDb))</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (obj.ObjectName == <span style="color: #a31515">&quot;AcDbCircle&quot;</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_contexts.Add(obj.ObjectID, <span style="color: blue">true</span>);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span>[] dbArray = (<span style="color: blue">object</span>[])objDbArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] nameArray = (<span style="color: blue">string</span>[])objNameArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] pathArray = (<span style="color: blue">string</span>[])objPathArray;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> i = 0;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Iterate over the DWSes and cache properties (color</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// and radius) of standard circles </span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> iDWS = 0; iDWS &lt; dbArray.Length; iDWS++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the DWS database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_dwsDb = (<span style="color: #2b91af">AcadDatabase</span>)dbArray[iDWS];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: #2b91af">AcadCircle</span> stdCircle <span style="color: blue">in</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_mgr.get_ModelSpaceProxy(m_dwsDb))</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">CircleCache</span> cirCache = <span style="color: blue">new</span> <span style="color: #2b91af">CircleCache</span>();</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// CircleCache is utility object for storing</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// properties</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Cache properties (color and radius) of all</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// circles in the DWS database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache.color = stdCircle.color;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache.radius = stdCircle.Radius;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache.standardFileName = nameArray[iDWS];</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// pFix contains fix information to be passed back</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// to the manager later</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStFix</span> fix = <span style="color: blue">new</span> <span style="color: #2b91af">AcStFix</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.Description = <span style="color: #a31515">&quot;Color fix&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.StandardFileName =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache.standardFileName;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.FixObjectName =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Color: &quot;</span> +</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; StripAcPrefix(stdCircle.color.ToString());</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (fix.PropertyCount == 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.PropertyValuePut(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Color&quot;</span>,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; stdCircle.color</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache.pFix = fix;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Array</span>.Resize&lt;<span style="color: #2b91af">CircleCache</span>&gt;(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> m_cirCacheArray,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; i+1</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[i++] = cirCache;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// SetContext</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Sets the objects to examine when iterating over errors</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> SetContext(<span style="color: blue">object</span> objIdArray, <span style="color: blue">bool</span> useDb)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If useDb is set to &quot;true&quot; (default), or if</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// objIdArray is blank, we use the database (we get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// all ids for the current drawing). Otherwise, we</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// set supplied list of objIdArrays as our list.</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_contexts.SetContext(useDb, objIdArray);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Start</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Initializes the error iterator mechanism</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Start(<span style="color: #2b91af">AcStError</span> err)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If pStartError is set to an error object, we should</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// only start checking from that error, not from the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// beginning. Mostly we will just go the Next item at</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// this point...</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (err != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">long</span> badId;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; badId = err.BadObjectId;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Find the index for BadObjectId in m_objIDArray</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex = 0;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex &lt; m_contexts.Count;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex++</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_contexts[m_curIndex] == badId)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex = (m_curIndex - 1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// No AcStError object was passed in. Start checking</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// from the very begining</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex = -1;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Next();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Next</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Finds the next error in the current context</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Next()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_err = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_contexts.Count &gt; 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Drawing contains AcDbCircle objects</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadCircle</span> circle;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span> foundErr;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_cirCacheArray.Length &gt; 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If we've not reached end of list, we first</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// increment current list index</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_curIndex &lt; m_contexts.Count - 1)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex++;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; foundErr = <span style="color: blue">false</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">while</span> (m_curIndex &lt; m_contexts.Count)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Don't iterate beyond end of list</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Retrieve object using its ObjectId</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; circle =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">AcadCircle</span>)m_checkDb.ObjectIdToObject(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">int</span>)m_contexts[m_curIndex]</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Try to find a circle with the same color from</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the cached standard circle (Iterate over cached</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// standards)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> iCache = 0;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; iCache &lt; m_cirCacheArray.Length;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; iCache++</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (circle.color.CompareTo(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[iCache].color</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ) != 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If it doesn't match, we've found a potential</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// error</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; foundErr = <span style="color: blue">true</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If it matches any one standard, then we can</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// stop checking</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; foundErr = <span style="color: blue">false</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">break</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Check for color differences</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (foundErr)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We found an error so create a local error</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// object</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStError</span> err = <span style="color: blue">new</span> <span style="color: #2b91af">AcStError</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.Description = <span style="color: #a31515">&quot;Color is non-standard&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.BadObjectId = circle.ObjectID;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.BadObjectName =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; StripAcPrefix(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; circle.color.ToString()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.Plugin = m_plugin;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ErrorTypeName = <span style="color: #a31515">&quot;Color &quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResFlagsNone;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (err.PropertyCount == 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.PropertyValuePut(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Color&quot;</span>,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; circle.color</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_err = err;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; foundErr = <span style="color: blue">false</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">break</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_curIndex = (m_curIndex + 1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Done</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns true if there are no more errors</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">bool</span> Done()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> (m_err == <span style="color: blue">null</span>);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// GetError -- Returns the current error</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">AcStError</span> GetError()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> m_err;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// GetAllFixes</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns an array of IAcStFix objects for the given</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// error (note: The caller is responsible for releasing</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// the objects in this array)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> GetAllFixes(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStError</span> err,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">object</span> fixArray,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">int</span> recommendedFixIndex</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (err != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">IAcStFix</span>[] arr =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">IAcStFix</span>[m_cirCacheArray.Length];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ACAD_COLOR</span> vErrorVal;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; recommendedFixIndex = -1;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_fixCnt = 0;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If we have a cache of fixes, then use that</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_cirCacheArray.Length &gt; 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vErrorVal =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">ACAD_COLOR</span>)err.PropertyValueGet(<span style="color: #a31515">&quot;Color&quot;</span>);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (vErrorVal.CompareTo(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[i].color</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ) != 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If color property of fix matches error, then</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// add to list of fixes.</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; arr[i] = m_cirCacheArray[i].pFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fixArray = arr;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_fixArray = fixArray;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Find the recommendedFixIndex</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// (we call this function to retrieve the index -</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// we don't need the returned fix object here)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GetRecommendedFix(err);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; recommendedFixIndex = m_recFixIndex;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Did we find a recommended fix along the way?</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (recommendedFixIndex == -1)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// No recomended fix, so set the proper flag on the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// error object</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResNoRecommendedFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// GetRecommendedFix</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Retrieves a fix object that describes the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// recommended fix</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">AcStFix</span> GetRecommendedFix(<span style="color: #2b91af">AcStError</span> err)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStFix</span> recFix = <span style="color: blue">new</span> <span style="color: #2b91af">AcStFix</span>();</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_cirCacheArray.Length == 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResNoRecommendedFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the objectId for this error</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">long</span> tmpObjID = err.BadObjectId;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Retrieve the object to fix from the DWG</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadCircle</span> tmpCircle =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">AcadCircle</span>)m_checkDb.ObjectIdToObject(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">int</span>)tmpObjID</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> radiusToBeChecked = tmpCircle.Radius;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">CircleCache</span> cirCache = m_cirCacheArray[0];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> diff =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Math</span>.Abs(radiusToBeChecked - cirCache.radius);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_recFixIndex = 0;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Attempt to get a fix color from the cached</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// m_CircleCacheArray</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Rule: the color of the standard circle with the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// nearest radius as the one to be fixed</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (diff &gt;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Math</span>.Abs(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; radiusToBeChecked - m_cirCacheArray[i].radius</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cirCache = m_cirCacheArray[i];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; diff =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Math</span>.Abs(radiusToBeChecked - cirCache.radius);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_recFixIndex = i;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Populate properties of the recommended fix object</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; recFix.Description = <span style="color: #a31515">&quot;Color fix&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; recFix.StandardFileName =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[m_recFixIndex].</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; standardFileName;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; recFix.FixObjectName = <span style="color: #a31515">&quot;Color&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (recFix.PropertyCount == 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; recFix.PropertyValuePut(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Color&quot;</span>,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[m_recFixIndex].color</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> recFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// GetPropertyDiffs</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Populates the provided arrays with the names of</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// properties that are present in the provided</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// error and fix objects (used to populate the fix</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// dialog with 'property name, current value, fix value')</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> GetPropertyDiffs(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStError</span> err,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStFix</span> fix,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">object</span> objPropNames,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">object</span> objErrorValues,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">object</span> objFixValues,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">object</span> objFixableStatuses)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (err != <span style="color: blue">null</span>) </p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] propNames = <span style="color: blue">new</span> <span style="color: blue">string</span>[0];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> propName = <span style="color: #a31515">&quot;&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] errorValues = <span style="color: blue">new</span> <span style="color: blue">string</span>[0];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> objErrorVal = <span style="color: blue">new</span> <span style="color: blue">object</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span>[] fixValues = <span style="color: blue">new</span> <span style="color: blue">string</span>[0];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> objFixVal = <span style="color: blue">new</span> <span style="color: blue">object</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span>[] fixableStatuses = <span style="color: blue">new</span> <span style="color: blue">bool</span>[0];</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Iterate error properties</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; err.PropertyCount; i++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.PropertyGetAt(i, <span style="color: blue">ref</span> propName, <span style="color: blue">ref</span> objErrorVal);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_propName = propName;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Retrieve corresponding Fix property value</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.PropertyValueGet(propName, <span style="color: blue">ref</span> objFixVal);</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ACAD_COLOR</span> errVal = (<span style="color: #2b91af">ACAD_COLOR</span>)objErrorVal;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ACAD_COLOR</span> fixVal = (<span style="color: #2b91af">ACAD_COLOR</span>)objFixVal;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Fix object has the same prop, so see if they match</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (errVal.CompareTo(fixVal) != 0)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Store error and fix properties in array ready to</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// pass back to caller</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Array</span>.Resize&lt;<span style="color: blue">string</span>&gt;(<span style="color: blue">ref</span> propNames, i+1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; propNames[i] = propName;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Array</span>.Resize&lt;<span style="color: blue">string</span>&gt;(<span style="color: blue">ref</span> errorValues, i+1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; errorValues[i] = StripAcPrefix(errVal.ToString());</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Array</span>.Resize&lt;<span style="color: blue">string</span>&gt;(<span style="color: blue">ref</span> fixValues, i+1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fixValues[i] = StripAcPrefix(fixVal.ToString());</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Array</span>.Resize&lt;<span style="color: blue">bool</span>&gt;(<span style="color: blue">ref</span> fixableStatuses, i+1);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fixableStatuses[i] = <span style="color: blue">true</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Initialize the arrays supplied by caller</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; objPropNames = propNames;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; objErrorValues = errorValues;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; objFixValues = fixValues;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; objFixableStatuses = fixableStatuses;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_fixCnt++;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// StripAcPrefix</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Helper function to make color names prettier</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">string</span> StripAcPrefix(<span style="color: blue">string</span> p)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (p.StartsWith(<span style="color: #a31515">&quot;ac&quot;</span>))</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> p.Substring(2);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> p;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// FixError</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Takes an error and a fix object and attempts</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// to fix the error</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> FixError(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStError</span> err,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStFix</span> fix,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">out</span> <span style="color: blue">string</span> failureReason)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; failureReason = <span style="color: #a31515">&quot;&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (err != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">long</span> badObjID = err.BadObjectId;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Retrieve object to fix from DWG</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadCircle</span> badObj =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">AcadCircle</span>)m_checkDb.ObjectIdToObject(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">int</span>)badObjID</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (fix == <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If the fix object is null then attempt to get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the recommended fix</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStFix</span> tmpFix = </p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GetRecommendedFix(err);</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (tmpFix == <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Set the error's result status to failed and</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// noRecommendedFix</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus = </p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResNoRecommendedFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix = tmpFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (fix != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Fix the bad circle</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">object</span> sFixVal = <span style="color: blue">new</span> <span style="color: blue">object</span>();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fix.PropertyValueGet(m_propName, <span style="color: blue">ref</span> sFixVal);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ACAD_COLOR</span> fixVal = (<span style="color: #2b91af">ACAD_COLOR</span>)sFixVal;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; badObj.color = fixVal;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResFixed;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; err.ResultStatus =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcStResultStatus</span>.acStResFixFailed;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Clear</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Clears the plugin state and releases any cached</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// objects</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Clear()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Called just before a plugin is released.</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Use this function to tidy up after yourself</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_plugin = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_curIndex = -1;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_recFixIndex = -1;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_fixCnt = 0;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_propName = <span style="color: #a31515">&quot;&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_mgr = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_dwsDb = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_checkDb = <span style="color: blue">null</span>;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_err != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_err.Reset();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_err = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_cirCacheArray != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; m_cirCacheArray.Length; i++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_cirCacheArray[i].pFix != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[i].pFix.Reset();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_cirCacheArray[i].pFix = <span style="color: blue">null</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; m_contexts.Clear();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// CheckSysvar</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Checks a system variable</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> CheckSysvar(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> sysvarName,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span> getAllFixes,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">bool</span> passFail)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// StampDatabase</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns whether the plugin uses information</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// from the database for checking</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> StampDatabase(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadDatabase</span> db,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">ref</span> <span style="color: blue">bool</span> stampIt</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If the DWS contains circles, we stamp it by</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// returning stampIt as true, otherwise, returning</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// stampIt as false</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; stampIt = <span style="color: blue">false</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">AcadObject</span> obj <span style="color: blue">in</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_mgr.get_ModelSpaceProxy(db)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; )</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (obj.ObjectName == <span style="color: #a31515">&quot;AcDbCircle&quot;</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; stampIt = <span style="color: blue">true</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">break</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// UpdateStatus</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Updates the result status of the provided error</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> UpdateStatus(<span style="color: #2b91af">AcStError</span> err)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// WritePluginInfo</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Takes an AcStPluginInfoSection node and creates a</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// new AcStPluginInfo node below it (note: used by the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Batch Standards Checker to get information about the</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// plugin)</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> WritePluginInfo(<span style="color: blue">object</span> objSectionNode)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">IXMLDOMNode</span> section =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">IXMLDOMNode</span>)objSectionNode;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">IXMLDOMElement</span> xml =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; section.ownerDocument.createElement(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;AcStPluginInfo&quot;</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">IXMLDOMElement</span> info =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #2b91af">IXMLDOMElement</span>)section.appendChild(xml);</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;PluginName&quot;</span>, Name);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;Version&quot;</span>, Version);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Description&quot;</span>,</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Description</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;Author&quot;</span>, Author);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;HRef&quot;</span>, HRef);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;DWSName&quot;</span>, <span style="color: #a31515">&quot;&quot;</span>);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; info.setAttribute(<span style="color: #a31515">&quot;Status&quot;</span>, <span style="color: #a31515">&quot;1&quot;</span>);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Author</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns the name of the plugin's author</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> Author</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: #a31515">&quot;Kean Walmsley, Autodesk, Inc.&quot;</span>; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Description</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns a description of what the plugin checks</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> Description</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Checks that circles in a drawing have a color &quot;</span> +</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;that matches those of a similar radius in an &quot;</span> +</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;associated standards file.&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// HRef</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns a URL where the plugin can be obtained</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> HRef</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;http://blogs.autodesk.com/through-the-interface&quot;</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Icon</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns the HICON property Icon</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">int</span> Icon</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> 1; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Name</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns the name of the plugin</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> Name</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: #a31515">&quot;Circle color checker&quot;</span>; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Version</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Returns the version of the plugin</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> Version</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: #a31515">&quot;2.0&quot;</span>; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// CircleCache</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Caches &quot;standard&quot; circle properties (Color, Radius)</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// from .DWS files, as well as pointers to the circle's</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// relevant AcStFix object </span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">class</span> <span style="color: #2b91af">CircleCache</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">double</span> radius;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">ACAD_COLOR</span> color;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">string</span> standardFileName;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">AcStFix</span> pFix;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// ContextList</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// Manages list of objects to check - either all in</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: green">// database, or just those recently added or modified</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">class</span> <span style="color: #2b91af">ContextList</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// List of objects to use when not in database context</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: blue">long</span>&gt; m_altIdArray =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">List</span>&lt;<span style="color: blue">long</span>&gt;();</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: blue">long</span>&gt; m_dbIdArray =</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">List</span>&lt;<span style="color: blue">long</span>&gt;();</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// All objects in database</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">bool</span> m_useDb;</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Return item from correct context list</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">long</span> <span style="color: blue">this</span>[<span style="color: blue">int</span> index]</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_useDb)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> m_dbIdArray[index];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> m_altIdArray[index];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Number of items in current list</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">int</span> Count</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">get</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (m_useDb)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> m_dbIdArray.Count;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> m_altIdArray.Count;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Flag to determine which conext list to return element</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// from</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Select all database or just modified items for checking</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// (but also add any new ids to database array</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> SetContext(<span style="color: blue">bool</span> useDb, <span style="color: blue">object</span> objContextArray)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (!useDb &amp;&amp; objContextArray != <span style="color: blue">null</span>)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_useDb = <span style="color: blue">false</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span>[] idArray = (<span style="color: blue">int</span>[])objContextArray;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> i = 0; i &lt; idArray.Length; i++)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">long</span> val = (<span style="color: blue">long</span>)idArray[i];</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_altIdArray.Add(val);</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Have to keep database list up to date</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_dbIdArray.Add(val);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Clear </span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_useDb = <span style="color: blue">true</span>;</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_altIdArray.Clear();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Add(<span style="color: blue">long</span> id, <span style="color: blue">bool</span> useDb)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (useDb)</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_dbIdArray.Add(id);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_altIdArray.Add(id);</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Clear both lists</span></p>    <br />    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> Clear()</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_altIdArray.Clear();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_dbIdArray.Clear();</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160;&#160;&#160; }</p>    <p style="font-size: 8pt; margin: 0px">&#160; }</p>    <p style="font-size: 8pt; margin: 0px">}</p> </div>  <p>Here are some additional steps to turn the above code into a buildable project and then into a working plugin:</p>  <ol>   <li>Create a Windows Class Library project (in this case for C#) </li>    <li>Copy and paste the code into a .cs file in the project (whether the default Class1.cs file or a new one) </li>    <li>Add a project reference to the appropriate ObjectDBX Type Library (in this case &quot;AutoCAD/ObjectDBX Common 17.0 Type Library&quot;) </li>    <li>Add a project reference to the Microsoft XML Type Library (in my case I used &quot;Microsoft XML, v6.0&quot;) </li>    <li>Add a project reference to AcStMgr.dll. This is actually harder than just adding the reference via the IDE by browsing to the Type Library on the ObjectARX SDK. The IDE shows this error:</li> </ol>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Type%20library%20import%20error.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Type library import error" src="/assets/Type%20library%20import%20error_thumb.png" width="293" height="104" /></a> </p>  <p>To get around this, we need to use the TLBIMP tool. Launch a &quot;Visual Studio Command Prompt&quot; (in my case by using Start -&gt; All Programs -&gt; Microsoft Visual Studio 2005 -&gt; Visual Studio Tools -&gt; Visual Studio 2005 Command Prompt), from which you should browse to the appropriate ObjectARX SDK include folder (in my case &quot;c:\Program Files\Autodesk\ObjectARX 2009\inc-win32&quot;), and enter &quot;tlbimp acstmgr.tlb&quot; into the command window:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Manual%20type%20library%20import.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Manual type library import" src="/assets/Manual%20type%20library%20import_thumb.png" width="394" height="201" /></a> </p>  <p>This creates an interop library (AcStMgr.dll) that can be added as a project reference instead of the original Type Library. When you add it, keep &quot;CopyLocal = True&quot;, which will allow the later assembly registration step to work properly. The other assembly references can safely be changed to &quot;CopyLocal = False&quot;, if you wish.</p>  <p>At this point the project should now build. Yay! :-)</p>  <p>For the plugin to be loadable inside AutoCAD, a few more steps are needed, however.</p>  <ol start="start">   <li>Open the project's AssemblyInfo.cs file (under Properties in the project browser window), and set the ComVisible assembly attribute to true:</li> </ol>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px"><span style="color: green">// Setting ComVisible to false makes the types in this assembly not visible </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// to COM components.&#160; If you need to access a type in this assembly from </span></p>    <p style="font-size: 8pt; margin: 0px"><span style="color: green">// COM, set the ComVisible attribute to true on that type.</span></p>    <p style="font-size: 8pt; margin: 0px">[assembly: <span style="color: #2b91af">ComVisible</span>(<span style="color: blue">true</span>)]</p> </div>  <ol start="start">   <li>From our command prompt, navigate to the location of the built assembly, and run &quot;regasm /codebase CircleStandard.dll&quot; (where CircleStandard.dll is the name of the assembly, whatever you've chosen to call it). Remember to use the /codebase flag - without this the COM information stored in the Registry will not include a reference to our assembly (only to the .NET Framework DLL that takes loads/hosts .NET assemblies that are also COM servers).</li> </ol>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Register%20assembly%20for%20COM.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Register assembly for COM" src="/assets/Register%20assembly%20for%20COM_thumb.png" width="396" height="202" /></a> </p>  <ol start="start">   <li>Create a .reg file with the following contents, and merge it into the Registry:</li> </ol>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black">   <p style="font-size: 8pt; margin: 0px">Windows Registry Editor Version 5.00</p>    <br />    <p style="font-size: 8pt; margin: 0px">[HKEY_LOCAL_MACHINE\SOFTWARE\Autodesk\Drawing Check\Plugins2\CircleStandard.CircleStandard]</p>    <p style="font-size: 8pt; margin: 0px">@=&quot;CircleStandard&quot;</p> </div>  <p>Once you've done that, you should now be able to launch AutoCAD and run the STANDARDS command, and check that our plugin exists:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Configure%20Standards%20dialog.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Configure Standards dialog" src="/assets/Configure%20Standards%20dialog_thumb.png" width="415" height="233" /></a> </p>  <p>By the way - all the above steps are needed (at least as far as I'm aware) for the plugin to show up in the list. If you happen to see the &quot;Error obtaining plugin description&quot; message on the command-prompt, the chances are you've missed a step. In these cases I use a SysInternals (now Microsoft) tool called <a href="http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx">Process Monitor</a> to diagnose the problem. This tool is the combines RegMon and FileMon - two fantastic tools I used to use very regularly, back in the day. It will help you determine whether AutoCAD is failing to find the information it needs from the Registry or from the file system.</p>  <p>Now let's see how we can use this sample.</p>  <p>Let's start by setting up a DWS file...</p>  <p>Inside a blank drawing, create a number of circles, each of different radii and colours. I simply used the colour index corresponding to the radius, but you can use whatever you like:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Creating%20our%20standards%20file.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Creating our standards file" src="/assets/Creating%20our%20standards%20file_thumb.png" width="472" height="474" /></a> </p>  <p>Save this as a DWS file (I called mine CircleColors.dws), which you can then add to a DWG containing circles you've created:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Adding%20the%20standards%20file.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Adding the standards file" src="/assets/Adding%20the%20standards%20file_thumb.png" width="394" height="222" /></a> </p>  <p>Then via the STANDARDS or CHECKSTANDARDS command you can start checking - and fixing - your circles' colours:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Checking%20our%20circle%20colors.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Checking our circle colors" src="/assets/Checking%20our%20circle%20colors_thumb.png" width="465" height="256" /></a> </p>  <p>Ending up with a nice set of colourful circles:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Check%20complete.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Check complete" src="/assets/Check%20complete_thumb.png" width="464" height="259" /></a> </p>  <p>You can also change the standards settings to display violation alerts and to automatically fix issues:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Standards%20settings%20dialog.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Standards settings dialog" src="/assets/Standards%20settings%20dialog_thumb.png" width="244" height="244" /></a> </p>  <p>You should now see the alert message when new circles are created that don't have the correct colour:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/WindowsLiveWriter/Automatic%20standards%20checking.png"><img style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-top-width: 0px" border="0" alt="Automatic standards checking" src="/assets/Automatic%20standards%20checking_thumb.png" width="464" height="254" /></a> </p>  <p>Automatic fixing certainly streamlines the fixing of standards violations - changing the colour to the one recommended by the plugin - but it won't stop the user from having to click through a couple of dialogs.</p>  <p>Well, that's it for today... hopefully you will find this sample a useful basis for implementing more specific requirements for geometry-oriented standards-checking.</p>  <p><strong><em>Update:</em></strong></p>  <p>See <a href="http://through-the-interface.typepad.com/through_the_interface/2014/08/an-updated-implementation-of-a-cad-standards-plugin-for-autocad-using-net.html" target="_blank">this more recent blog post</a> for an updated project and set of instructions for AutoCAD 2015.</p>
