---
layout: "post"
title: "AU 2012 Handout: Moving code to the cloud &ndash; it&rsquo;s easier than you think &ndash; Part 1"
date: "2012-11-20 08:53:12"
author: "Kean Walmsley"
categories:
  - "AU"
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Azure"
  - "F#"
  - "REST"
  - "SaaS"
original_url: "https://www.keanw.com/2012/11/au-2012-handout-moving-code-to-the-cloud-its-easier-than-you-think-part-1.html "
typepad_basename: "au-2012-handout-moving-code-to-the-cloud-its-easier-than-you-think-part-1"
typepad_status: "Publish"
---

<p><em>After posting </em><a href="http://through-the-interface.typepad.com/through_the_interface/2012/11/au-2012-handout-developing-a-simple-metro-style-application-for-windows-8-part-1.html" target="_blank"><em>the</em></a><em> </em><a href="http://through-the-interface.typepad.com/through_the_interface/2012/11/au-2012-handout-developing-a-simple-metro-style-application-for-windows-8-part-2.html" target="_blank"><em>handout</em></a><em> for </em><a href="https://www.autodeskuniversity2012.com/connect/sessionDetail.ww?SESSION_ID=1921" target="_blank"><em>my Wednesday class</em></a><em>, now it’s time to start the one for Tuesday&#39;s - </em><a href="https://www.autodeskuniversity2012.com/connect/sessionDetail.ww?SESSION_ID=1914" target="_blank"><em>CP1914 - Moving Code to the Cloud: It&#39;s Easier Than You Think</em></a><em> (I have a lot else </em><a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/registration-open-for-au-2012.html" target="_blank"><em>going on on Tuesday</em></a><em>, but this is the only class on that day for which I needed to prepare material). Attendance for both classes is looking fairly good: there are currently 138 attendees registered for the Cloud session and 62 registered for the one on WinRT. </em></p>  <h3>Why all this talk of the cloud?</h3>  <p>The software industry is steadily adopting a model commonly referred to as “cloud computing”. For many software developers, this will not appear to be anything very new: many have worked with centralized computing resources in the past – in the mainframe era – but that’s not to say that this shift isn’t valid.</p>  <p>So let’s step back and look briefly at how the industry has evolved over recent decades. The mainframe era gave way to personal computing: Autodesk was one of many software companies that identified this trend and rode the wave to become a successfully business. The initial releases of AutoCAD were far from being really useable, in many ways, but it was clear that Moore’s Law – which indicated that the number of transistors on chips would double every 18-24 months – would hold long enough for the various pieces of the puzzle to provide the necessary performance from a personal computer before very long.</p>  <p>Nothing lasts forever, especially if it’s an exponential law. Moore’s Law as we know it has hit a bit of a barrier in recent years: we’re no longer seeing CPU clock speed doubling, for instance, as we’re hitting certain physical laws that prevent this from happening. <a href="http://www.gotw.ca/publications/concurrency-ddj.htm" target="_blank">This article from Herb Sutter</a> does a great job of explaining this in detail.</p>  <p>That said, technology continues to evolve: rather than chips doubling in speed, we’re seeing the number of cores doubling, and the overall computing power that’s available to us via the cloud continuing to grow, too. For more information on this shift, see <a href="http://herbsutter.com/welcome-to-the-jungle" target="_blank">Herb’s sequel to the above article</a>.</p>  <p>Ultimately, for software developers to continue to see performance gains (and cost efficiencies) software is having to be architected to work in a more distributed manner, with much of its processing performed on the cloud. This work distribution is being made possible via improvements in infrastructure – it’s very common for people to have redundant methods of accessing the Internet, for instance, whether wired or wirelessly – and the cost of centralized resources are continuing to drop as performance between major hosting providers turns computing resources into a commodity (and some would say <a href="http://www.amazon.com/The-Big-Switch-Rewiring-Edison/dp/0393333949" target="_blank">utility</a>).</p>  <p>At the same time as we’re seeing some kind of plateauing in performance of local, <em>sequential</em> software execution (although note the emphasis on sequential: parallelizing code can still bring performance gains from multi-core systems), we’re seeing a rise in the availability of lower-powered, mobile devices. As we enter the post-PC era, it’s increasingly the desire to be able to access centralized computing resources from devices that are little more than “dumb” terminals (although the modern smartphone contains more computing power than existed on the planet on the day many of their users was born).</p>  <p>And the world is becoming truly heterogeneous in terms of computing devices: over time software developers will decreasingly target specific operating systems, having core algorithms executing centrally. There may still be some amount of native code targeting various supported devices, but even that is likely to reduced as true cross-platform execution improves (whether via toolkits or HTML5).</p>  <h3>Moving code to the cloud can make sense</h3>  <p><em>[You may want to skip this section if you remember reading <a href="http://through-the-interface.typepad.com/through_the_interface/2012/03/moving-to-the-cloud.html" target="_blank">this post</a>.]</em></p>  <p>So why would you move product functionality to the cloud? Here are some reasons:</p>  <ul>   <li>Performance      <ul>       <li>If you have a problem you can easily chunk up and parallelize – rendering is a great example of this, as we’ve seen with Project Neon(which it seems is now known as Autodesk 360 Rendering) – then the cloud can provide significant value. Renting 1 CPU for 10,000 seconds is (more or less) the same cost as buying 10,000 CPUs for 1 second. </li>     </ul>   </li>    <li>Scalability      <ul>       <li>With cloud services you pay for what you use, which should scale linearly with your company’s income (or benefits) from hosting functionality in that way. Dynamic provisioning allows companies to spin up servers to manage usage spikes, too, which allows infrastructure to be made available “just in time” rather than “just in case”. </li>     </ul>   </li>    <li>Reliability      <ul>       <li>You often hear about measurements such as “five nines” uptime, which means 99.999% availability (or about 5 minutes of downtime per year). Some providers are no doubt proving better than others at meeting their availability SLAs, but the fact remains: having a local system or server die generally creates more significant downtime than those suffered by the outages suffered by cloud providers. And that should only get better, over time. </li>     </ul>   </li>    <li>Low cost      <ul>       <li>As cloud services get increasingly commoditized – and Microsoft, Google and Amazon are competing fiercely in the cloud space, driving costs down further – using the cloud is becoming increasingly cost-effective. </li>     </ul>   </li> </ul>  <p>That’s a bit about the “why”, here’s the “when”…</p>  <ul>   <li>Computation intensive      <ul>       <li>If you have serious number crunching going on locally in your desktop apps – which either ties up resources that could be used differently or stops your apps running on lower-spec hardware – then the cloud is likely to look attractive. I mentioned we use make the cloud available for rendering, but we’re doing the same with simulation and analysis, too. </li>     </ul>   </li>    <li>Collaboration      <ul>       <li>Imagine implementing the collaboration features of AutoCAD WS without the cloud… </li>     </ul>   </li>    <li>Frequent change      <ul>       <li>If you have applications that go through rapid release cycles, then update deployment/patching is likely to be a challenge for you. Hosting capabilities on the cloud – appropriately versioned when you make breaking interface changes, of course – can certainly help address this. </li>     </ul>   </li>    <li>Large data sets      <ul>       <li>The ideal scenario is clearly that data is co-located with the processing capability that needs to access it. Much of this data is currently stored on local systems – which makes harnessing the cloud a challenge – but as data shifts to be hosted there (for lots of very good reasons), this starts to become more compelling. </li>        <li>Another example: let’s say you have an application that relies on a local database of pricing information. Making sure this database is up-to-date can be a royal pain: it’s little surprise, then, that a number of the early adopters of cloud technology in the design space relate to pricing applications. </li>     </ul>   </li> </ul>  <p>These were the main benefits that have been presented to ADN members during DevDays. There are few additional benefits that I’d like to add…</p>  <ul>   <li>Customer intimacy      <ul>       <li>Delivering software as a service can increase the intimacy you have with customers – and with partners, if you’re providing a platform. You have very good knowledge of how your technology is being used – and this has a “Big Brother” flip-side that people often struggle with, as you clearly have to trust your technology provider – which can allow you to provide better service and even anticipate customer needs. </li>     </ul>   </li>    <li>Technology abstraction      <ul>       <li>You may have some atypical code that you’d like the user to not have to worry about: let’s say you have some legacy product functionality implemented using <a href="http://en.wikipedia.org/wiki/Fortran" target="_blank">Fortran</a> or <a href="http://en.wikipedia.org/wiki/COBOL" target="_blank">COBOL</a> that you’d rather not have to provide a local runtime to support. Hiding it behind a web service reduces the complexity in deploying the application and can provide a much cleaner installation/deployment/usage capability. </li>     </ul>   </li>    <li>Device support      <ul>       <li>This is probably obvious (as many of the preceding points will have been to some of you, I expect), but web services are accessible from all modern programming languages on any internet-enabled device. Web services are a great way to more quickly support a variety of usages of your application’s capabilities on a variety of devices. </li>     </ul>   </li> </ul>  <h3>Today’s Example</h3>  <p>We’re going to take an example that hits on a few of these topics: we have a core algorithm – implemented in F#, which some might questionably classify as arcane ;-) – that we want to move behind a cloud-hosted web-service and use from a number of different devices.</p>  <p>The algorithm generates Apollonian Gaskets – a 2D fractal, which places as many circles as it can within the “whitespace” inside a circle – and Apollonian Packings – the 3D equivalent which obvious deals with spheres.</p>  <p>We’re going to have fun using this service to generate some interesting 3D visualizations on a variety of platforms.</p>  <h3>Choosing a cloud hosting provider</h3>  <p>Autodesk is a very heavy user of Amazon Web Services, which might indicate it would be a good, long-term choice for users and developers to adopt (as co-location with data is of benefit, as we’ve seen).</p>  <p>That said, there are lots of factors that contribute to this kind of decision.</p>  <p>The early popularity of AWS was due in large part to its focus on providing Infrastructure-as-a-Service (IaaS): they made it really easy for companies with their own servers to move them across to be hosted centrally. Many companies shifted from on-premise servers (or perhaps their own data-centers) to centrally hosted and managed servers.</p>  <p>Microsoft’s approach has been to deliver highly integrated Platform-as-a-Service (PaaS) offerings: they abstract away the physical machine, focusing on the “roles” that you deploy to the cloud. Microsoft is now starting to deliver via an IaaS model, just as Amazon is providing more by way of PaaS from their side.</p>  <p>In our particular example, we’re going to make use of Windows Azure. That’s not to say it’s better for everyone – it’s just what I’ve chosen to use for this project as the integration with Visual Studio is first-class and I have free hosting provided via my MSDN subscription.</p>  <p>If you’re interested in AWS, I recommend looking at some of the guides on <a href="http://adndevblog.typepad.com/cloud_and_mobile" target="_blank">ADN’s Cloud &amp; Mobile DevBlog</a>.</p>  <p>Another option is Google App Engine, which provides an even higher level of abstraction that Azure. It seems to be an excellent system for highly granular, scalable tasks (without even having the underlying concept of physical machines in the picture). If interested in learning more about Google App Engine, I recommend attending tomorrow’s 8am class by my colleague (and manager), Ravi Krishnaswamy:</p>  <p><a href="https://www.autodeskuniversity2012.com/connect/sessionDetail.ww?SESSION_ID=2568" target="_blank">CP2568 – PaaSt the Desktop: Implementing Cloud-Based Productivity Solutions with the AutoCAD® ObjectARX® API</a></p>  <h3>Architecting for the cloud</h3>  <p>There are lots of decisions to be made when considering moving application functionality to the cloud.</p>  <p>Not least of which is “what is your core business logic?” meaning the algorithms that are application- and device-independent. The algorithms that moving away from your core implementation increases your flexibility and platform independence.</p>  <p>You also need to consider the data that needs to be transferred between the client and the cloud: both in terms of the arguments that need to be sent to your cloud-based “function” and the results that need to be brought back down to earth afterwards. Ideally you’d be working with data that’s already hosted in the cloud – and this is likely to happen more and more, over time – but that’s not necessarily where we are today.</p>  <p>You should also think about whether there are optimizations to be made around repeated data: should you be making use of cloud-hosted database storage (which is very cheap when compared with compute resources) or some kind of caching service? In our case we’re going to re-calculate the data, each time, but we could very easily implement a cache of the “unit” results and then multiply those for specifically requested radii.</p>  <p>Another important question is whether offline working needs to be supported: does a local version of the algorithm – or a cache of local data – need to be maintained in order to enable this?</p>  <p>An increasingly easy decision, amongst others that are quite tricky, is how to expose your web-services. These days the commonly accepted approach is to expose <a href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank">RESTful services</a>, which means the transport protocol for data is standard HTTP and (most commonly) any results will be encoded in JSON – <a href="http://en.wikipedia.org/wiki/JSON" target="_blank">JavaScript Object Notation</a>. JSON isn’t actually a required part of REST – it’s also possible for RESTful services to return XML, for instance – but it has become the de-facto approach that is most favored by API consumers.</p>  <p>The previous “standard” was SOAP – <a href="http://en.wikipedia.org/wiki/SOAP" target="_blank">Simple Object Access Protocol</a>. SOAP has gradually ceded ground to REST, as it required more effort to create XML envelopes containing the data to transmit to the web-service, and is generally more verbose and requires more bandwidth.</p>  <p>A common requirement is around authentication: you probably want to be able to monitor and control access to your web-services. This is not going to be covered in this class, but you may want to look at OAuth-compatible toolkits such as <a href="http://www.dotnetopenauth.net" target="_blank">DotNetOpenAuth</a>, which comes pre-integrated with AS.NET 4.5.</p>  <p>How you end up exposing your RESTful web-services will depend on your choice of technology stack (although these days it should be simple to do so from which choice you make). The Microsoft stack – which would often involve ASP.NET at some level, irrespective of whether you host on AWS or Azure – certainly abstracts away a lot of the messiness with exposing web-services, but comes with a certain execution overhead. If you really want to get “close to the metal” then you might also want to consider a Linux environment: not only do you end up with lower execution overhead but the cost associated with Linux instances can be very interesting. And as we know, the actual implementation of the web-service should be largely irrelevant to the consumer.</p>  <p>For today’s example we’re going to go with Microsoft and choose its ASP.NET MVC 4 Web API. This is a great way to expose web-sites with associated web-services, and seems to be the product of choice for people using the Microsoft stack to expose web-services, these days. WCF, the Windows Communication Framework, provides some very interesting capabilities – especially when needing to marshal more complex data-types to and from web-services – but our requirement is relatively simple and the Web API seems the best fit. The ADN DevBlog mentioned earlier provides some good information on using WCF.</p>  <h3>Considering cloud costs</h3>  <p>One of the key benefits of the cloud is its ability to scale as you provision more resources to deliver your web-services. The counterpoint is that if you over-estimate the resources required to do this, your costs will be proportionally higher than they need to be.</p>  <p>Companies making heavy use of the cloud tend to invest in tools they can use to scale up and down automatically based on usage. This is not a topic that we’ll cover today, but it’s worth pointing out that getting this right is important for any significant cloud-based deployment.</p>  <p>There are some general things you can do to keep costs in check: consider looking for ways to reduce your instance sizes – dropping from a small to an extra-small instance size can bring significant costs benefits (adding some caching or online database storage might be a way to enable this, helping reduce the processing load).</p>  <p>Online calculators are available to help you determine up-front costs associated with provisioning resources, here are the calculators for <a href="http://www.windowsazure.com/pricing" target="_blank">Azure</a> and <a href="http://aws.amazon.com/calculator" target="_blank">AWS</a>. Be sure to monitor actual costs (and optimize provisioning based on real usage, ideally), to make sure they are in line with projections.</p>  <h4>The Problem</h4>  <p>Now let’s go back to today’s “problem”. We want to move our business logic – the core F# algorithm used to generate 2D and 3D Apollonian fractals – behind a cloud-based web-service. The original implementation for the 3D packing algorithm was provided in C++ by a Professor of Mathematics at the prestigious ETH in Zurich, but I chosen to migrate the code to F# to see how it looked (and having the code in a language that isn’t necessarily easy to get working on OS X, iOS and Android demonstrates the “technology abstraction” point from an earlier slide nicely.</p>  <p>As mentioned earlier, we’re not going to worry about authenticating users of our web-service: it’s a topic that would probably deserve a class of its own. We’re going to expose a simple, unsecured web-service (at least in terms of the need for authentication to make use of it).</p>  <p>Once it’s up, you’ll be able to query the geometry defining 2D Apollonian Gaskets using the “circles” API:</p>  <ul>   <li><a href="http://apollonian.cloudapp.net/api/circles/2/2" target="_blank">http://apollonian.cloudapp.net/api/circles/2/2</a> (returns circle definitions via JSON) </li> </ul>  <p>And 3D Apollonian Packings using the “spheres” API:</p>  <ul>   <li><a href="http://apollonian.cloudapp.net/api/spheres/2/2" target="_blank">http://apollonian.cloudapp.net/api/spheres/2/2</a> (returns sphere definitions via JSON) </li> </ul>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3dee6ec0970c-pi" target="_blank"><img alt="2D Apollonian Gasket and 3D Apollonian Packing" border="0" height="233" src="/assets/image_201935.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="2D Apollonian Gasket and 3D Apollonian Packing" width="450" /></a></p>  <h3>Building a simple web-service</h3>  <p>We’re going to use the ASP.NET MVC 4 Web API to expose our web-service. MVC – standing for the common “Model View Controller” architectural pattern, which is used to separate model data from UI and interactions – is Microsoft’s technology of choice for defining and hosting web-sites and -services on top of ASP.NET.</p>  <p>We don’t care a great deal about the web-site – we’re much more interested in the web-services – but we’ll go ahead and create one, anyway.</p>  <p>While Windows Azure apparently now supports .NET 4.5, we’re going to stick with .NET 4.0 (at the time of writing this new capability had only just been announced). We’re going to install an F#-aware project template into VS2012 and make use of that to create our Web API project.</p>  <p>Once published to Azure, the code will be hosted and executed on Windows Server 2008 (although this is really a detail – this is not something we should have to worry about at all).</p>  <p>We’ll start by getting our project template installed. We can select it via the “Extensions and Updates” manager on the VS 2012 Tools menu, searching for “F# C# MVC 4”.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017ee56386cc970d-pi" target="_blank"><img alt="Using the F# C# MVC 4 Web API project template" border="0" height="342" src="/assets/image_20649.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Using the F# C# MVC 4 Web API project template" width="454" /></a>     <br />Once installed, we can launch a project of this type and select “WebApi Project”:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017c33bfe2f7970b-pi" target="_blank"><img alt="The template in action" border="0" height="342" src="/assets/image_767622.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="The template in action" width="454" /></a></p>  <p>Visual Studio will go ahead and create our basic project from the template. We can launch the default web-site via the debugger:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3dee7004970c-pi" target="_blank"><img alt="Our default web-site" border="0" height="403" src="/assets/image_85895.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Our default web-site" width="454" /></a>To test the default implementation of the web-service, try appending the following suffix to the URL:</p>  <p>/api/values</p>  <p>At this point the browser will ask us whether we want to save or open the results from the web-service. Opening the results in Notepad should show them to be [&quot;value1&quot;,&quot;value2&quot;].</p>  <p>There are a few changes we’ll make to the project to get it working as we want it.    <br />Firstly, we should change the .NET Framework target to 4.0 from 4.5 for both the contained projects.</p>  <p>Then some changes to the web-site project (ApollonianPackingWebApi).</p>  <ul>   <li>We want to copy across some files from the “ToCopy” folder:      <br /><em>Site.css</em> into the Content folder </li>    <li>Three images into the Images folder (two of which need adding to the project) </li>    <li><em>Index.cshtml</em> into the Views -&gt; Home folder </li>    <li><em>crossdomain.xml</em> into the root folder </li> </ul>  <p>Now running the project should look very different (although the .CSS change doesn’t always get picked up if running locally – the background of the “Welcome” area should be orange, but often looks blue before it makes it up to Azure).</p>  <p>There are still some changes needed to allow our service to support “cross domain scripting” (which for us primarily means being callable from client-side HTML5/JavaScript code). The first step was to add the <em>crossdomain.xml</em> file but we also need to open <em>Web.config</em> and add these elements:</p>  <p>Inside &lt;configuration&gt;&lt;system.web&gt;:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">customErrors</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">mode</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Off</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p> </div>  <p>Inside &lt;configuration&gt;&lt;system.webServer&gt;:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">httpProtocol</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">customHeaders</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">add</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">name</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Access-Control-Allow-Origin</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">value</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">*</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">customHeaders</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">httpProtocol</span><span style="line-height: 140%; color: blue">&gt;</span></p> </div>  <p>And then we should expand the serialization limit beyond the default to make sure it’s large enough for our largest JSON string:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">system.web.extensions</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">scripting</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">webServices</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="line-height: 140%; color: #a31515">jsonSerialization</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">maxJsonLength</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">500000</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">jsonSerialization</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">webServices</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160;&#0160;&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">scripting</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#0160; &lt;/</span><span style="line-height: 140%; color: #a31515">system.web.extensions</span><span style="line-height: 140%; color: blue">&gt;</span></p> </div>  <p>We can then update the web-services project (ApollonianPackingWebAppApi).</p>  <p>Copy across the various files into the root project folder:</p>  <p><em>Global.fs</em> will update the existing file. Here are its contents:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> FsWeb</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Mvc</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Routing</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Http</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Data.Entity</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Optimization</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Linq</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Collections.Generic</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Newtonsoft.Json</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> Newtonsoft.Json.Serialization</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> OrderedContractResolver() =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">inherit</span><span style="line-height: 140%"> DefaultContractResolver()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> x.CreateProperties(tp, ms) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.CreateProperties(tp, ms).OrderBy</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">fun</span><span style="line-height: 140%">(p) </span><span style="line-height: 140%; color: blue">-&gt;</span><span style="line-height: 140%"> p.PropertyName)).ToList() :&gt; IList&lt;JsonProperty&gt;</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> BundleConfig() =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> RegisterBundles (bundles:BundleCollection) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (ScriptBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/bundles/jquery&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Scripts/jquery-1.*&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (ScriptBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/bundles/jqueryui&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Scripts/jquery-ui*&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add(ScriptBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/bundles/jqueryval&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Scripts/jquery.unobtrusive*&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Scripts/jquery.validate*&quot;</span><span style="line-height: 140%">))&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add(ScriptBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/bundles/modernizr&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Scripts/modernizr-*&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add(StyleBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/Content/css&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Content/*.css&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; bundles.Add</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; (StyleBundle(</span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/css&quot;</span><span style="line-height: 140%">).Include</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.core.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.resizable.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.selectable.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.accordion.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.autocomplete.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.button.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.dialog.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.slider.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.tabs.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.datepicker.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.progressbar.css&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;~/Content/themes/base/jquery.ui.theme.css&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> Route =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; { controller : string</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; action : string</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; rad : UrlParameter</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; steps : UrlParameter }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> ApiRoute =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; { rad : obj</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; steps : obj }</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> Global() =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">inherit</span><span style="line-height: 140%"> System.Web.HttpApplication() </span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> RegisterGlobalFilters</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; (filters:GlobalFilterCollection) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; filters.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> HandleErrorAttribute())</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> RegisterRoutes(routes:RouteCollection) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; routes.IgnoreRoute(</span><span style="line-height: 140%; color: maroon">&quot;{resource}.axd/{*pathInfo}&quot;</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; routes.MapHttpRoute(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;DefaultApi&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;api/{controller}/{rad}/{steps}&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; { rad = RouteParameter.Optional</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; steps = RouteParameter.Optional }) |&gt; ignore</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; routes.MapRoute(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;Default&quot;</span><span style="line-height: 140%">, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: maroon">&quot;{controller}/{action}/{rad}/{steps}&quot;</span><span style="line-height: 140%">, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; { controller = </span><span style="line-height: 140%; color: maroon">&quot;Home&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; action = </span><span style="line-height: 140%; color: maroon">&quot;Index&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rad = UrlParameter.Optional</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; steps = UrlParameter.Optional } )</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.Start() =</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Only support JSON, not XML</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> cfg = GlobalConfiguration.Configuration</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; cfg.Formatters.Remove(cfg.Formatters.XmlFormatter) |&gt; ignore</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Order the JSON fields alphabetically</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">let</span><span style="line-height: 140%"> stg = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> JsonSerializerSettings()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; stg.ContractResolver &lt;-</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> OrderedContractResolver() :&gt; IContractResolver</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; cfg.Formatters.JsonFormatter.SerializerSettings &lt;- stg</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; AreaRegistration.RegisterAllAreas()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; Global.RegisterRoutes RouteTable.Routes |&gt; ignore</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; Global.RegisterGlobalFilters GlobalFilters.Filters</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; BundleConfig.RegisterBundles BundleTable.Bundles</span></p> </div>  <p>The other four files need to be added to the project. Two of them, <em>CirclePackingFull.fs</em> and <em>SpherePackingInversion.fs</em>, are copied directly from the previous AutoCAD-hosted version of the application. The other two, <em>CirclesController.fs</em> and <em>SpheresController.fs</em>, implement the logic to pass the API requests through to our core algorithm implementations.</p>  <p>Here’s <em>CirclesController.cs</em>:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> FsWeb.Controllers</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Http</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> Circle (X, Y, C, L) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.X = X</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.Y = Y</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.C = C</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.L = L</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> CirclesController() =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">inherit</span><span style="line-height: 140%"> ApiController()&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: green">// GET /api/values/rad/steps</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> x.Get(rad:double, steps:int) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; CirclePackingFullFs.Packer.ApollonianGasket rad steps |&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; List.map</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">fun</span><span style="line-height: 140%"> ((a,b,c),d) </span><span style="line-height: 140%; color: blue">-&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Circle</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (Math.Round(a, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Math.Round(b, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Math.Round(c, 4), d)) |&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; List.toSeq</span></p> </div>  <p>And here’s <em>SpheresController.cs</em>:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> FsWeb.Controllers</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">open</span><span style="line-height: 140%"> System.Web.Http</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> Sphere (X, Y, Z, R, L) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.X = X</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.Y = Y</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.Z = Z</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.R = R</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> this.L = L</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">type</span><span style="line-height: 140%"> SpheresController() =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">inherit</span><span style="line-height: 140%"> ApiController()&#0160;&#0160;&#0160; </span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: green">// GET /api/values/rad/steps</span></p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">member</span><span style="line-height: 140%"> x.Get(rad:double, steps:int) =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160; SpherePackingInversionFs.Packer.ApollonianGasket</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; steps 0.01 </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> |&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; List.map</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">fun</span><span style="line-height: 140%"> ((a,b,c,d),e) </span><span style="line-height: 140%; color: blue">-&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> Sphere</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (Math.Round(a * rad, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Math.Round(b * rad, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Math.Round(c * rad, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Math.Round(d * rad, 4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; e))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; |&gt; List.toSeq</span></p> </div>  <p>You can safely remove ValuesController.fs from the project (deleting it from disk, should you so wish).</p>  <p>To test our web-site and -service, we first want to launch it in a browser (most easily via the debugger):<a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2017d3dee70a0970c-pi" target="_blank"><img alt="Our modified web-site" border="0" height="403" src="/assets/image_957758.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Our modified web-site" width="454" /></a></p>  <p>With the web-site loaded, we can then add these URL suffices into the browser to test the two APIs:</p>  <ul>   <li>/api/circles/2/2 </li>    <li>/api/spheres/2/2 </li> </ul>  <p>The first number in each of these URLs specifies the desired radius of the outer circle/sphere to be packed while the second tells the recursion level: how “deep” the fractal should go.</p>  <p>Here are the results of the first of these calls. It should be easy enough to see how the JSON file contains a list of circle definitions, each with X, Y, Curvature and Level values:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">[{&quot;C&quot;:1.0774,&quot;L&quot;:2,&quot;X&quot;:2,&quot;Y&quot;:3.0718},{&quot;C&quot;:1.0774,&quot;L&quot;:2,&quot;X&quot;:2.9282,&quot;Y&quot;:1.4641},{&quot;C&quot;:1.0774,&quot;L&quot;:2,&quot;X&quot;:1.0718,&quot;Y&quot;:1.4641},{&quot;C&quot;:6.9641,&quot;L&quot;:1,&quot;X&quot;:2,&quot;Y&quot;:2},{&quot;C&quot;:17.1603,&quot;L&quot;:0,&quot;X&quot;:2.1748,&quot;Y&quot;:2.1009},{&quot;C&quot;:17.1603,&quot;L&quot;:0,&quot;X&quot;:2,&quot;Y&quot;:1.7981},{&quot;C&quot;:17.1603,&quot;L&quot;:0,&quot;X&quot;:1.8252,&quot;Y&quot;:2.1009},{&quot;C&quot;:2.2321,&quot;L&quot;:0,&quot;X&quot;:3.3441,&quot;Y&quot;:2.776},{&quot;C&quot;:2.2321,&quot;L&quot;:0,&quot;X&quot;:2,&quot;Y&quot;:0.448},{&quot;C&quot;:2.2321,&quot;L&quot;:0,&quot;X&quot;:0.6559,&quot;Y&quot;:2.776}]</span></p> </div>  <p>Assuming both web-service calls return valid JSON files, we are now ready to publish to Azure.</p>  <p><em>Which we will look at in the next post. :-)</em></p>
