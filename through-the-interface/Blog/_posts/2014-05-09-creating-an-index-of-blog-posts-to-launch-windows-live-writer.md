---
layout: "post"
title: "Creating an index of blog posts to launch Windows Live Writer"
date: "2014-05-09 16:43:28"
author: "Kean Walmsley"
categories:
  - "REST"
  - "Weblogs"
original_url: "https://www.keanw.com/2014/05/creating-an-index-of-blog-posts-to-launch-windows-live-writer.html "
typepad_basename: "creating-an-index-of-blog-posts-to-launch-windows-live-writer"
typepad_status: "Publish"
---

<p>This one’s mainly for my fellow bloggers – especially those using the Typepad blogging platform – to help address a problem related to editing old blog posts using Windows Live Writer, a tool I can honestly say I can no longer blog without. Incidentally I’m now <a href="http://www.hanselman.com/blog/DownloadWindowsLiveWriter2012.aspx" target="_blank">working with Live Writer 2012</a>.</p>  <p>With that said, it may also be of interest for people who want to programmatically query their favourite blogs and create offline indices into their posts. Maybe. :-)</p>  <p>I use Live Writer primarily to author blog posts – which it allows me to do offline, something I find incredibly valuable – but I also use it to edit older posts, whether to add an update or to change its assigned categories. It’s easy to access recent posts – they’re accessible directly within the product – but from time to time I need to modify a post that was written before I’d adopted Live Writer for writing my blog (or one that for some reason doesn’t show up in my “recent posts”).</p>  <p>Typepad does provide a web-based post editor but this very often messes up the formatting of code that I’ve posted, which I find extremely frustrating. I therefore avoid it at all costs – I want to do as much as possible in Live Writer.</p>  <p>Live Writer does a reasonable job of pulling down posts from your preferred blogging service, but – at least with Typepad, and admittedly <a href="http://everything.typepad.com/blog/2014/04/downtime_ddos_attacks_future_protection.html" target="_blank">they’ve been having problems of late</a> – it’s very hard to load posts beyond the last 100 or so. If I try to go back to the last 500 or more I get a timeout error:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a3fd04f72a970b-pi" target="_blank"><img title="WLW timeout" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="WLW timeout" src="/assets/image_454419.jpg" width="404" height="261" /></a></p>  <p>And now that I have around more than 1100 posts I find myself regularly having to go back and make edits to posts that are not in the last 100.</p>  <p>I did a bit of research and came across <a href="http://codeclimber.net.nz/archive/2010/07/10/How-to-edit-very-old-posts-with-Windows-Live-Writer.aspx" target="_blank">this post</a> that referred to <a href="http://aovestdipaperino.com/pages/wlw-post-download-plugin-instructions.aspx" target="_blank">this helpful Windows Live Writer plugin</a>. The application installs a custom URI handler using the “wlw” prefix that can (for instance) be launched via the “Run” command or the address bar in Windows/Internet Explorer:</p>  <p>wlw://[yourblogdomain]/?postid=[postid] </p>  <p>As an example, here’s a link that opens the first ever post made to this blog:</p>  <p><a title="wlw://through-the-interface.typepad.com/?postid=6a00d83452464869e200d8352e3b2b53ef" href="wlw://through-the-interface.typepad.com/?postid=6a00d83452464869e200d8352e3b2b53ef">wlw://through-the-interface.typepad.com/?postid=6a00d83452464869e200d8352e3b2b53ef</a></p>  <p>So far so good. The tricky bit is to work out the IDs of the individual posts. The good news is that Typepad provides a RESTful API to get at this information (more work will be needed to support blogs hosted by other providers).</p>  <p>I threw together a simple C#/WinForms app that queries the specified blog and populates a grid for copying/pasting into Excel. I decided to fill this grid with the number and title of the post, as well as links to the published post and to load the editable post into Live Writer. So it may be of some use to avid readers as well as my fellow bloggers. We’ll see.</p>  <p>One thing the Typepad API calls need, in particular, is the blog’s ID. I found this for my blog by loading the web-based Typepad dashboard and extracting it from the URL:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a511b4a221970c-pi" target="_blank"><img title="Typepad&#39;s blog dashboard" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Typepad&#39;s blog dashboard" src="/assets/image_767382.jpg" width="450" height="311" /></a></p>  <p>The code is fairly straightforward: it downloads batches of posts (you can specify the number of posts per batch, as well as configuring which one to start from). Typepad posts are retrieved in reverse chronological order via the API, it seems, so the code assigns a number from the total number of posts down to 1 (the first ever post).</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a3fd04f748970b-pi" target="_blank"><img title="Post list from Through the Interface" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Post list from Through the Interface" src="/assets/image_299586.jpg" width="424" height="210" /></a></p>  <p>The intention is that you’ll copy the contents of the list of posts – and there’s a button to simplify that part of things – and paste it into Excel (and presumably save it as an spreadsheet file of some sort). When you paste the contents in (as plain text – the formatting is ugly), you’ll find the links in column D and F are indeed links (to the published post and to load Live Writer, respectively), even if they aren’t blue and underlined.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a3fd04f751970b-pi" target="_blank"><img title="Our post list in Excel" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Our post list in Excel" src="/assets/image_695080.jpg" width="424" height="318" /></a></p>  <p>You can use this spreadsheet to find your preferred post and then either load the published post via the link in the D column or into Live Writer (assuming you have authoring permission on my blog, of course ;-). I’ve hidden columns C and E, by the way, as these are the “plain text” versions of columns D and F.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a3fd04f75c970b-pi" target="_blank"><img title="Yes, those are actually links" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Yes, those are actually links" src="/assets/image_890470.jpg" width="424" height="318" /></a></p>  <p>The links for Live Writer do indeed launch the product…</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a73dbfcad9970d-pi" target="_blank"><img title="Which will load the post into Windows Live Writer" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Which will load the post into Windows Live Writer" src="/assets/image_833332.jpg" width="424" height="318" /></a></p>  <p>… which pulls down the post’s contents and loads them into the editor:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201a3fd04f776970b-pi" target="_blank"><img title="And here&#39;s WLW with our chosen post" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 20px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="And here&#39;s WLW with our chosen post" src="/assets/image_425904.jpg" width="424" height="422" /></a></p>  <p><a href="http://through-the-interface.typepad.com/files/PostRetriever.zip" target="_blank">Here’s the project</a> along with the C# code that does most of the heavy lifting:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">using</span> System;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.IO;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Linq;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Net;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Threading.Tasks;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Web;</p>    <p style="margin: 0px"><span style="color: blue">using</span> System.Windows.Forms;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Newtonsoft.Json.Linq;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> PostRetriever</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> <span style="color: #2b91af">PostRetrievalForm</span> : <span style="color: #2b91af">Form</span></p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> PostRetrievalForm()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; InitializeComponent();</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">void</span> EnableControls(<span style="color: blue">bool</span> enabled)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; getButton.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; idLabel.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; blogIdBox.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; domainLabel.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; domainBox.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; startLabel.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; startBox.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; incLabel.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; incBox.Enabled = enabled;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; copyButton.Enabled = enabled ? postGrid.RowCount &gt; 0 : <span style="color: blue">false</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">async</span> <span style="color: blue">void</span> getButton_Click(<span style="color: blue">object</span> sender, <span style="color: #2b91af">EventArgs</span> e)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (postGrid.RowCount &gt; 0)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> res = <span style="color: #2b91af">MessageBox</span>.Show(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Control</span>.FromHandle(<span style="color: blue">this</span>.Handle),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;This will clear the existing post list.&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;Post List Not Empty&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">MessageBoxButtons</span>.OKCancel</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (res == <span style="color: #2b91af">DialogResult</span>.Cancel)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Rows.Clear();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// If the grid is empty let's assume we have to</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// add the columns that are needed for our data</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> col1 = postGrid.Columns.Add(<span style="color: #a31515">&quot;Number&quot;</span>, <span style="color: #a31515">&quot;Number&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns.Add(<span style="color: #a31515">&quot;Title&quot;</span>, <span style="color: #a31515">&quot;Title&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> col3 =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns.Add(<span style="color: #a31515">&quot;BlogLinkText&quot;</span>, <span style="color: #a31515">&quot;Blog Link Text&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> col4 = postGrid.Columns.Add(<span style="color: #a31515">&quot;BlogLink&quot;</span>, <span style="color: #a31515">&quot;Blog Link&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> col5 =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns.Add(<span style="color: #a31515">&quot;WLWLinkText&quot;</span>, <span style="color: #a31515">&quot;WLW Link Text&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> col6 =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns.Add(<span style="color: #a31515">&quot;LiveWriterLink&quot;</span>, <span style="color: #a31515">&quot;Live Writer Link&quot;</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// The first column is numeric</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col1].DefaultCellStyle.Alignment =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewContentAlignment</span>.MiddleRight;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col1].ValueType = <span style="color: blue">typeof</span>(<span style="color: blue">int</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We'll set the link columns to be the size of the header</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// rather than the content</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col3].AutoSizeMode =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewAutoSizeColumnMode</span>.ColumnHeader;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col4].AutoSizeMode =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewAutoSizeColumnMode</span>.ColumnHeader;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col5].AutoSizeMode =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewAutoSizeColumnMode</span>.ColumnHeader;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; postGrid.Columns[col6].AutoSizeMode =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewAutoSizeColumnMode</span>.ColumnHeader;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Let's disable the UI controls while we query our posts</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; EnableControls(<span style="color: blue">false</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// And enable the grid control</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; postGrid.Enabled = <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Extract some info from the UI that willl be passed to</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// our main function</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> blogId = blogIdBox.Text;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> domain = domainBox.Text;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> start = <span style="color: #2b91af">Int32</span>.Parse(startBox.Text);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> inc = <span style="color: #2b91af">Int32</span>.Parse(incBox.Text);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">await</span> PopulatePostInfo(domain, blogId, start, inc, postGrid);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; EnableControls(<span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">async</span> <span style="color: #2b91af">Task</span> PopulatePostInfo(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> domain, <span style="color: blue">string</span> blogId, <span style="color: blue">int</span> start, <span style="color: blue">int</span> inc,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridView</span> grid</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// String to ask Excel to turn the current cell into a</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// link to the cell to the left</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">const</span> <span style="color: blue">string</span> toLink = <span style="color: #a31515">&quot;=HYPERLINK(INDIRECT(\&quot;RC[-1]\&quot;,0))&quot;</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> i = start;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> client = <span style="color: blue">new</span> <span style="color: #2b91af">WebClient</span>())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// First let's just find out how many posts there are</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// on this blog</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> initRes = <span style="color: blue">await</span> GetPosts(client, blogId, 0, 1);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: #2b91af">String</span>.IsNullOrEmpty(initRes))</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">MessageBox</span>.Show(<span style="color: #a31515">&quot;Unable to access blog from provided ID&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> jo = <span style="color: #2b91af">JObject</span>.Parse(initRes);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> total = (<span style="color: blue">int</span>)jo[<span style="color: #a31515">&quot;totalResults&quot;</span>];</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// While we haven't gotten to the end of our blogs or</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// hit an error, keep going</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">while</span> (i &lt; total)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Get the next batch of posts</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> results = <span style="color: blue">await</span> GetPosts(client, blogId, inc, i);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (<span style="color: #2b91af">String</span>.IsNullOrEmpty(results)) <span style="color: blue">break</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Parse the returned JSON, using LINQ to extract</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// an IEnumerable of tuples of the title string</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// and the post ID</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> o = <span style="color: #2b91af">JObject</span>.Parse(results);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> posts =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">from</span> p <span style="color: blue">in</span> o[<span style="color: #a31515">&quot;entries&quot;</span>]</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">select</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">new</span> <span style="color: #2b91af">Tuple</span>&lt;<span style="color: blue">string</span>, <span style="color: blue">string</span>, <span style="color: blue">string</span>&gt;(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">string</span>)p[<span style="color: #a31515">&quot;title&quot;</span>],</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">string</span>)p[<span style="color: #a31515">&quot;urlId&quot;</span>],</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">string</span>)p[<span style="color: #a31515">&quot;permalinkUrl&quot;</span>]</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> j = 0; <span style="color: green">// An index into this batch</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> post <span style="color: blue">in</span> posts)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Add our new record to the gridview</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> row = grid.Rows.Add();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">int</span> idx = 0;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Set the post count (counting down to 1)</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// in the first column</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx++].Value =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (total + 1 - (i + j)).ToString();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Let's go an extra step and decode any HTML</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// characters (e.g. &amp;quot; and &amp;dash) found</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// in the post title before setting that in</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// the second column</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> sw = <span style="color: blue">new</span> <span style="color: #2b91af">StringWriter</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">HttpUtility</span>.HtmlDecode(post.Item1, sw);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> title = sw.ToString();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx++].Value = title;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Insert the blog link next</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx++].Value = post.Item3;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Hardcode a standard value in the next column:</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// this will create a link in Excel based on the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// value in the previous column</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx++].Value = toLink;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Generate the text for the link based on the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// domain and the post ID and place it in the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// next column</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> link =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">String</span>.Format(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;wlw://{0}/?postid={1}&quot;</span>, domain, post.Item2</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx++].Value = link;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Hardcode a standard value in the next column:</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// this will create a link in Excel based on the</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// value in the previous column</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.Rows[row].Cells[idx].Value = toLink;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; j++;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We didn't get any posts in this batch, so let's</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// break out of the while loop</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (j == 0) <span style="color: blue">break</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Scroll the grid view down so the bottom of it</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// is visible</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; grid.FirstDisplayedScrollingRowIndex = grid.RowCount - 1; </p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Increment the counter ready for the next batch</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; i += inc;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Helper function to get a batch of posts from the blog</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">async</span> <span style="color: #2b91af">Task</span>&lt;<span style="color: blue">string</span>&gt; GetPosts(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">WebClient</span> client, <span style="color: blue">string</span> blogId, <span style="color: blue">int</span> inc, <span style="color: blue">int</span> i</p>    <p style="margin: 0px">&#160;&#160;&#160; )</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Generate the URL for the query</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> url = <span style="color: blue">string</span>.Format(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;http://api.typepad.com/blogs/{0}/&quot;</span> +</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;post-assets.json?start-index={1}&amp;max-results={2}&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; blogId, i, inc</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; );</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Try to execute it asynchronously via the WebClient</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// passed in (if it fails we'll just return an empty</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// string)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: blue">await</span> client.DownloadStringTaskAsync(url);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #a31515">&quot;&quot;</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">void</span> copyButton_Click(<span style="color: blue">object</span> sender, <span style="color: #2b91af">EventArgs</span> e)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Copy the contents of the gridview to the clipboard</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; postGrid.ClipboardCopyMode =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">DataGridViewClipboardCopyMode</span>.EnableWithoutHeaderText;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; postGrid.SelectAll();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> obj = postGrid.GetClipboardContent();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; postGrid.ClearSelection();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Clipboard</span>.SetDataObject(obj, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p> </div>  <p>Hopefully this tool will be of some use to people who want <a href="http://through-the-interface.typepad.com/files/TTIF%20posts.xlsx" target="_blank">an offline set of links into this blog</a> or for my fellow bloggers who want to use it to create a set of Live Writer links to their own posts.</p>  <p>The tool could clearly be enhanced to perform an incremental download &amp; update, but as bloggers can always access recent posts from within Live Writer they shouldn’t need to run it very often once they have a populated Excel spreadsheet. And the code is provided for people to extend as they wish. :-)</p>
