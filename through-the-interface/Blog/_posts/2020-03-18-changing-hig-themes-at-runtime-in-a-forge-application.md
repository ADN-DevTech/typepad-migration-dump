---
layout: "post"
title: "Changing HIG themes at runtime in a Forge application"
date: "2020-03-18 09:57:26"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
original_url: "https://www.keanw.com/2020/03/changing-hig-themes-at-runtime-in-a-forge-application.html "
typepad_basename: "changing-hig-themes-at-runtime-in-a-forge-application"
typepad_status: "Publish"
---

<p>Despite the unfolding horror of the situation with Covid-19 – and stuff is really starting to hit the fan, here in Switzerland, with schools and non-essential commerces being closed and rumours of an enforced sequestration being considered – I’m at least getting some quality time to work on <a href="http://dasher360.com" target="_blank">Dasher</a>.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a517cb1a200b-pi" target="_blank"><img width="500" height="311" title="Theme setting UI inside Dasher" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Theme setting UI inside Dasher" src="/assets/image_738614.jpg" border="0"></a></p><p>Last week we saw how it was possible to support both <a href="https://www.keanw.com/2020/03/supporting-multiple-visual-themes-in-a-forge-application-using-the-autodesk-human-interface-guidelines.html" target="_blank">dark</a> and <a href="https://www.keanw.com/2020/03/using-the-hig-to-implement-a-light-mode-in-a-forge-application.html" target="_blank">light</a> themes from the <a href="https://github.com/Autodesk/hig" target="_blank">Autodesk HIG</a> in a Forge viewer application. I mentioned both times my desire to allow Dasher’s theme to be selected by the user at runtime. After searching fruitlessly on the internet for some time, I ended up asking an internal Slack channel focused on HIG-related development. Within a day Yong Wu from the Revit team came back with some code they had created to get this working on their side.</p><p>Yong and team had basically used the approach shown in <a href="https://medium.com/@dmitriy.borodiy/easy-color-theming-with-scss-bc38fd5734d1" target="_blank">this excellent article</a>. Sass is a pre-processor for CSS – it’s a build-time component, so isn’t available at runtime – which means that you need to find a way to pre-bake the styles of your various themes in a way that can be leveraged at runtime. The article shows how to structure your SCSS files (which are compiled by Sass) in an elegant way, using mixins to access the variables you need.</p><p>For Dasher, I chose to include three of the HIG themes. (I won’t show the “themify” mixin used by the below code – that you can get from the Medium article.)</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'./themes/darkBlueHighDensityTheme'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'./themes/darkGrayHighDensityTheme'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'./themes/lightGrayHighDensityTheme'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'./utilities/themify'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><br></div><div><span style="color: rgb(156, 220, 254);">$themes</span><span style="color: rgb(212, 212, 212);">: (</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">hig-dark-blue-high-density</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$hig-dark-blue-high-density</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">hig-dark-gray-high-density</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$hig-dark-gray-high-density</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">hig-light-gray-high-density</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$hig-light-gray-high-density</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">) </span><span style="color: rgb(86, 156, 214);">!default</span><span style="color: rgb(212, 212, 212);">;</span></div></div><p>The theme files all look very similar: they import the underlying HIG theme from the node_modules folder (for some reason I seem to have to use relative paths on my system, rather than referencing the @hig folder directly) and then define the same set of variables relative to the HIG variables.</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(197, 134, 192);">@import</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(206, 145, 120);">'../../../../node_modules/@hig/theme-data/build/scss/variables/_darkGrayHighDensityTheme.scss'</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(156, 220, 254);">$hig-dark-gray-high-density</span><span style="color: rgb(212, 212, 212);">: (</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">body-gray</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$colorScheme-surfaceLevel200Color</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">search-box</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$colorScheme-surfaceLevel250Color</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">spinner</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$colorScheme-surfaceLevel200Color</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(78, 201, 176);">foreground</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(156, 220, 254);">$colorScheme-textColor</span><span style="color: rgb(212, 212, 212);">,</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; …</span></div><div><span style="color: rgb(212, 212, 212);">);</span></div></div><p>There’s probably a way to make the variable definition piece common across the three theme files, but it’s really a detail: keeping the list consistent across the three isn’t a huge effort.</p><p>Using the style from the main SCSS stylesheet is fairly simple – you just need to include the themify mixin and then use the themed macro to access the appropriate variable. It took some time to work through the Dasher styles, but hey.</p><p><div class="vscode" style="white-space: pre;"><div><span style="color: rgb(215, 186, 125);">body</span><span style="color: rgb(212, 212, 212);"> {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(156, 220, 254);">overflow</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(206, 145, 120);">hidden</span><span style="color: rgb(212, 212, 212);">;</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; </span><span style="color: rgb(197, 134, 192);">@include</span><span style="color: rgb(212, 212, 212);">&nbsp;</span><span style="color: rgb(220, 220, 170);">themify</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(156, 220, 254);">$themes</span><span style="color: rgb(212, 212, 212);">) {</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(156, 220, 254);">background-color</span><span style="color: rgb(212, 212, 212);">: </span><span style="color: rgb(220, 220, 170);">themed</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">'body-gray'</span><span style="color: rgb(212, 212, 212);">);</span></div><div><span style="color: rgb(212, 212, 212);">&nbsp; }</span></div><div><span style="color: rgb(212, 212, 212);">}</span></div></div><p>The integration into the Dasher application itself was reasonably smooth: I modified the settings dialog to add a dropdown on the Appearance tab. Changing the dropdown’s selection then sets the theme, which – among other things – adds a class (whether ‘hig-dark-gray-high-density’, ‘hig-dark-blue-high-density’ or ‘hig-light-gray-high-density’) to the main page’s body element. The relevant theming is then picked up automagically. The timeline theming took a little more work, but I’m pleased with the results: you can even change the theme while significant operations are in progress.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a517cb47200b-pi" target="_blank"><img width="500" height="312" title="Changing themes while surface shading" style="margin: 30px auto; float: none; display: block;" alt="Changing themes while surface shading" src="/assets/image_986747.jpg"></a></p><p>This will soon be available to try on Dasher360.com: we’ll be pushing it live once the new timeline has been fully tested.</p><p>Many thanks to Yong Wu for his guidance on getting this working!</p>
