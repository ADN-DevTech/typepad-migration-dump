---
layout: "post"
title: "AutoCAD I/O v2"
date: "2015-10-16 13:14:52"
author: "Kean Walmsley"
categories:
  - "AU"
  - "AutoCAD .NET"
  - "AutoCAD I/O"
  - "Commands"
  - "Core Console"
  - "PaaS"
  - "SaaS"
original_url: "https://www.keanw.com/2015/10/autocad-io-v2.html "
typepad_basename: "autocad-io-v2"
typepad_status: "Publish"
---

<p>&#160;</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c7deb2d0970b-pi" target="_blank"><img title="AutoCAD IO diagram" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 30px auto 50px; border-left: 0px; display: block; padding-right: 0px" border="0" alt="AutoCAD IO diagram" src="/assets/image_986091.jpg" width="500" height="223" /></a>The AutoCAD I/O team has deployed version 2 of their API. For specific information on what’s new, <a href="https://developer.autodesk.com/api/autocadio/v2/" target="_blank">check this page</a>. As <a href="https://events.au.autodesk.com/connect/sessionDetail.ww?SESSION_ID=9945" target="_blank">I’ll be talking about AutoCAD I/O</a> at <a href="http://au.autodesk.com/las-vegas/overview" target="_blank">AU 2015</a>, I thought it important to get to grips with the new version and understand how it differs from v1.</p>  <p>I went ahead and updated <a href="http://jigsawify.com" target="_blank">Jigsawify.com</a> to make use of the new API, so I’ll add my own commentary below on the changes that have been introduced. As a reminder, <a href="https://github.com/KeanW/jigsawify" target="_blank">the full source code for Jigsawify.com is available on GitHub</a>.</p>  <p>To check out the specific migration changes, see <a href="https://github.com/KeanW/jigsawify/compare/AutoCAD-IO-v1...AutoCAD-IO-v2" target="_blank">this comparison of the two branches</a>. Bear in mind that the v2 branch now also contains the “management” app that allows you to create, delete and update a custom AppPackage and its corresponding Activity (it was originally based on <a href="https://github.com/Developer-Autodesk/workflow-custom-activity-with-apppackage-autocad.io" target="_blank">this sample</a> but I upgraded it for the v2 API). So in the diff you’ll see lots of additional files that don’t have an equivalent in the v1 branch.</p>  <p>(To create my v2 management app I followed <a href="https://developer.autodesk.com/api/autocadio/v2/#creating-custom-apppackage-c" target="_blank">this tutorial</a> and copied/migrated code from the original sample.)</p>  <p>Anyway, onto the changes themselves… I’ll start with the ones I encountered in my migration, and then comment on others I find significant.</p>  <p>&#160;</p>  <p><strong>The service end-point has changed</strong></p>  <p>From:</p>  <p><a href="https://developer.api.autodesk.com/autocad.io/v1/">https://developer.api.autodesk.com/autocad.io/v1/</a></p>  <p>to:</p>  <p><a href="https://developer.api.autodesk.com/autocad.io/us-east/v2/">https://developer.api.autodesk.com/autocad.io/us-east/v2/</a></p>  <p>I like that the location has become explicit, which raises the possibility of eventually being able to choose a data centre in Europe (should it make sense).</p>  <p>&#160;</p>  <p><strong>OData 4.0</strong></p>  <p>I had to make a few changes to the data being passed using OData. Most of these are abstracted away in the management app code – as we’re using an OData Client to do lots of the low-level stuff – but in the Node.js code on the server it’s a little more obvious. You’ll see the specifics in the delta for the “<em>api.js</em>” file in the comparison linked to previously.</p>  <p>&#160;</p>  <p><strong></strong></p>  <p><strong>Removed EntityId</strong></p>  <p>There is no longer a UserId associated with AppPackages, Activities and WorkItems.</p>  <p>This is a welcome change: in my code I’d previously had to filter on the UserId of WorkItems, etc., which didn’t feel right (the code ended up included a user-specific ID, making it much less portable).</p>  <p>Something related to this change: because there’s now more risk of Activity names clashing, we do recommend prefixing them with a Registered Developer Symbol (RDS). Although as <a href="http://autodesk.com/symbolreg" target="_blank">this facility</a> seems now to have been retired, so I’m not sure how you’re meant to proceed if you don’t have one. I’d certainly recommend using something suitably obscure for the name. Oh, and you can’t use a full stop/period as a delimiter – I found you have to use a hyphen (-) or an underscore (_) to avoid an exception.</p>  <p>&#160;</p>  <p><b></b></p>  <p><b>Use Http Get for AppPackage's Upload URL</b></p>  <p>You’d previously have to use code (in this case it’s in C#) such as this to determine the URL where you can upload your AppPackage:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">&#160; <span style="color: #2b91af">UriBuilder</span> builder = <span style="color: blue">new</span> <span style="color: #2b91af">UriBuilder</span>(container.BaseUri);</p>    <p style="margin: 0px">&#160; builder.Path += <span style="color: #a31515">&quot;AppPackages/GenerateUploadUrl&quot;</span>;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> url = container.Execute&lt;<span style="color: blue">string</span>&gt;(builder.Uri, <span style="color: #a31515">&quot;POST&quot;</span>, <span style="color: blue">true</span>, <span style="color: blue">null</span>).First();</p>    <p style="margin: 0px">&#160;</p> </div>  <p>Now life is much simpler: you can use a GET request instead, e.g.:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">&#160; <span style="color: blue">var</span> url = container.AppPackages.GetUploadUrl().GetValue();</p>    <p style="margin: 0px">&#160;</p> </div>  <p>Of course there’s some abstraction happening behind the above code – they are being mapped to lower level HTTP calls – but you get the idea.</p>  <p>&#160;</p>  <p><b>No AddLink/DeleteLink Call Anymore</b></p>  <p>This simplifies your code slightly. Where previously I used this:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">&#160; container.AddToActivities(activity);</p>    <p style="margin: 0px">&#160; container.SaveChanges(</p>    <p style="margin: 0px">&#160;&#160;&#160; System.Data.Services.Client.<span style="color: #2b91af">SaveChangesOptions</span>.PatchOnUpdate</p>    <p style="margin: 0px">&#160; );</p>    <p style="margin: 0px">&#160; container.AddLink(activity, <span style="color: #a31515">&quot;AppPackages&quot;</span>, package);</p>    <p style="margin: 0px">&#160; container.SaveChanges();</p>    <p style="margin: 0px">&#160;</p> </div>  <p>I now just do this:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px">&#160; activity.AppPackages.Add(PackageName);<span style="color: green">&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px">&#160; container.AddToActivities(activity);</p>    <p style="margin: 0px">&#160; container.SaveChanges();</p>    <p style="margin: 0px">&#160;</p> </div>  <p>I assume this simplification comes from no longer having “complex” EntityIds for AppPackages and Activities.</p>  <p>&#160;</p>  <p>Now for the updates that didn’t impact me directly…</p>  <p>&#160;</p>  <p><b>Added Engines EntitySet</b></p>  <p>This seems like it could be useful, especially when working with different “AutoCAD” versions. (I used quotes because we’re talking about Core Engine versions, although these will tend to correspond closely with full AutoCAD versions.)</p>  <p>&#160;</p>  <p><b>Versioning Support</b></p>  <p>Again, seems useful: I often have to roll-back to prior versions, so this will be helpful.</p>  <p>&#160;</p>  <p><b>New Description property on Activity/AppPackage/Engine</b></p>  <p>This will be useful when I start sharing Activities with others.</p>  <p><strong></strong></p>  <p><b>New Headers property on Argument</b></p>  <p>I don’t currently use my own cloud storage mechanism for the site, but I can see how this would become useful if I did.</p>  <p>&#160;</p>  <p><b>New &quot;IsPublic&quot; property on Activity/AppPackage/Engine</b></p>  <p>Yes, at some point I’ll end up publishing Activities to others… is there anyone else out there wanting to use AutoCAD I/O to create jigsaw puzzles? :-)</p>  <p>&#160;</p>  <p><b>New “HostApplication” property on Activity</b></p>  <p>Interestingly, the infrastructure has now been generalised to the point you can specify an alternative executable to AcCoreConsole.exe – you can choose to use a custom host application. It’ll still be beholden to the same sandboxing as we use for the core engine, of course, but this is potentially really interesting, especially if you know that a RealDWG app can meet your needs (as it’ll have even lower execution overhead).</p>  <p>&#160;</p>  <p><b>New “IsObjectEnabler” property on AppPackage</b></p>  <p>Allows you to tag AppPackages as Object Enablers and have them load on startup. Interesting if you’re implementing them.</p>  <p>&#160;</p>  <p><b>Added Optional property on Parameter in Activity</b></p>  <p>While I haven’t yet used this, I have wanted it in the past… I would probably have made slightly different architectural decisions had the option been there. Something I’ll use in the future, for sure.</p>  <p>&#160;</p>  <p>That’s it for this quick run-through on the migration work I personally found needed with the new AutoCAD I/O v2 API. Overall the changes make sense – it’s certainly allowed me to clean up quite a bit of my code. If you’re using v1 of the API, I recommend taking the time to migrate to v2. It’s not a very big deal, and will certainly bring longer-term benefits.</p>  <p>I’m jumping on a plane bound for San Francisco, tomorrow, to present at <a href="https://autodeskxsummit2015.sched.org" target="_blank">next week’s Autodesk X-Summit</a>. I’ll also be spending a few days in the San Francisco and San Rafael offices, after that. I’ll certainly be reporting what I can via this blog, as usual.</p>
