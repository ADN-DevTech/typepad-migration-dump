---
layout: "post"
title: "Smoothly transitioning between 3D AutoCAD views using .NET - Part 1"
date: "2009-02-25 12:30:14"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Graphics system"
original_url: "https://www.keanw.com/2009/02/smoothly-transitioning-between-3d-autocad-views-using-net---part-1.html "
typepad_basename: "smoothly-transitioning-between-3d-autocad-views-using-net---part-1"
typepad_status: "Publish"
---

<p><em>This inspiration for this post came during the research for </em><a href="http://through-the-interface.typepad.com/through_the_interface/2009/01/implementing-a-lookat-command-for-autocad-using-net.html"><em>this previous post</em></a><em>, where we looked at implementing LookAt inside AutoCAD. It also has roots in the need to perform </em><a href="http://through-the-interface.typepad.com/through_the_interface/2008/09/no-muttering-at.html"><em>smooth transitions when zooming</em></a><em> inside AutoCAD, which the ZOOM command manages for transitions between 2D views. Fenton Webb, from our DevTech Americas team, kindly volunteered to put together an ObjectARX sample that formed the basis for the code in this post. A huge thanks to Fents for his hard work on this!</em></p> <p>This code presents a technique that allows smooth transitioning between 3D views in AutoCAD: you set up the parameters of the view to which you wish to change, and the function takes care of the heavy lifting. The technique follows more-or-less the same approach than that used to implement the ViewCube's smooth view transitions. It creates a GraphicsSystem.View object and manipulates it to transition smoothly to the new view.</p> <p>Here's the C# code:</p> <div style="font-size: 8pt; background: white; color: black; font-family: courier new"> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System.Threading;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> System.Drawing;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsInterface;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsSystem;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Interop;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="color: blue; line-height: 140%">namespace</span><span style="line-height: 140%"> ViewTransitions</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">{</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">class</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Default constructor</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(){}</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// For constant defines below SWIso etc</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x3, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y3, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> z3,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> x4, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y4</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; position = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(x1, y1, z1);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(x2, y2, z2);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; upVector = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%">(x3, y3, z3);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldWidth = x4;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fieldHeight= y4;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> MyView(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> position, </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> target, </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> upVector,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldWidth, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> fieldHeight</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.position = position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.target = target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.upVector = upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.fieldWidth = fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">this</span><span style="line-height: 140%">.fieldHeight = fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; };</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">class</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Commands</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> defaultView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1930.1,1339.3,4399.3, 1930.1,1339.3,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0,1.0,0.0, 3279.8, 1702.6</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> topView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1778.1,1108.2,635.7, 1778.1,1108.2,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0,1.0,0.0, 474.0, 246.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> bottomView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1778.1,1108.2,-635.7, 1778.1,1108.2,0.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0,1.0,0.0, 474.0, 246.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> leftView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -344.1,1108.2,66.1, 0.0,1108.2,66.1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0,0.0,1.0, 256.5, 133.2</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> rightView =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 344.1,1108.2,66.1, 0.0,1108.2,66.1,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0,0.0,1.0, 256.5, 133.2</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> SWIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 265.1,-404.7,1579.0, 838.0,168.2,1006.2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.4,0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> SEIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2105.6,780.7,393.7, 1532.7,1353.5,-179.2,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.4,0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> NEIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1366.8,697.0,-345.2, 793.9,124.1,-918.0,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.4,-0.4,0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> NWIso =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1003.9, 1882.3, 840.2, 1576.8, 1309.5,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 267.3, 0.4, -0.4, 0.8, 739.7, 384.0</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Enacts a smooth transition from the current view</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// to a new view</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> SmoothViewTo(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> nv, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> timeToTake</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; )</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> newViewMatrix = </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%">.Identity;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Manager</span><span style="line-height: 140%"> gsm =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.GraphicsManager;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Get the current viewport</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> vpn =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Convert</span><span style="line-height: 140%">.ToInt32(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.GetSystemVariable(</span><span style="color: #a31515; line-height: 140%">"CVPORT"</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">View</span><span style="line-height: 140%"> view = gsm.GetGsView(vpn, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (view)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Set the frame rate to the standard eye FPS</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.BeginInteractivity(24);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Matrix3d</span><span style="line-height: 140%"> viewMatrix = view.ViewingMatrix;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Get the current view settings</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%"> cv =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">MyView</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.Position, view.Target, view.UpVector,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.FieldWidth, view.FieldHeight</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Set up the start positions</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> intPos = cv.position;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%"> intTgt = cv.target;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%"> intUpVec = cv.upVector;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> intWid = cv.fieldWidth;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> intHgt = cv.fieldHeight;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Now animate the view change between the</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// currentview and the viewToChangeTo</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">for</span><span style="line-height: 140%"> (</span><span style="color: blue; line-height: 140%">float</span><span style="line-height: 140%"> mu = 0; mu &lt;= 1; mu += 0.01F)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Interpolate position</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intPos =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.position.X, nv.position.X, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.position.Y, nv.position.Y, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.position.Z, nv.position.Z, mu)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Interpolate target</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intTgt =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Point3d</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.target.X, nv.target.X, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.target.Y, nv.target.Y, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.target.Z, nv.target.Z, mu)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Interpolate upVector</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intUpVec =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">Vector3d</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.upVector.X, nv.upVector.X, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.upVector.Y, nv.upVector.Y, mu),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.upVector.Z, nv.upVector.Z, mu)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Interpolate Width</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intWid =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.fieldWidth, nv.fieldWidth, mu);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Interpolate Height</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; intHgt =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CosInterp(cv.fieldHeight, nv.fieldHeight, mu);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Now set the interpolated view</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.SetView(intPos, intTgt, intUpVec, intWid, intHgt);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Update the control</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.Update();</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Decrease the sleep time, or rather increase the</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// speed of the view change as we work</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> sleepTime = timeToTake - (mu * 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Thread</span><span style="line-height: 140%">.Sleep((</span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%">)(sleepTime &gt; 50 ? 0 : sleepTime));</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.EndInteractivity();</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Finally set the new view&nbsp; </span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gsm.SetViewportFromView(vpn, view, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">, </span><span style="color: blue; line-height: 140%">false</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Windows.Forms.</span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DoEvents();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> newViewMatrix;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Cosine interpolation</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> CosInterp(</span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y1, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> y2, </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> mu)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">double</span><span style="line-height: 140%"> mu2;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mu2 = (1-</span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.Cos(mu*</span><span style="color: #2b91af; line-height: 140%">Math</span><span style="line-height: 140%">.PI))/2;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%">(y1*(1-mu2)+y2*mu2);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Function to create a solid background of the same</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// colour as the background of our 2D modelspace view</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// (reduces the visual shock as the colour would</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// otherwise switch to grey and back)</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">private</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> CreateBackground()</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">const</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">string</span><span style="line-height: 140%"> bgKey = </span><span style="color: #a31515; line-height: 140%">"TTIF_BG"</span><span style="line-height: 140%">;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId = </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Get the current viewport number</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> vpn =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Convert</span><span style="line-height: 140%">.ToInt32(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.GetSystemVariable(</span><span style="color: #a31515; line-height: 140%">"CVPORT"</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// No need to set the background if a corresponding</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// 3D view already exists</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">View</span><span style="line-height: 140%"> view =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.GraphicsManager.GetGsView(vpn, </span><span style="color: blue; line-height: 140%">false</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (view == </span><span style="color: blue; line-height: 140%">null</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Transaction</span><span style="line-height: 140%"> tr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.TransactionManager.StartTransaction();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (tr)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> bgId = </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Get or create our background dictionary</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> bgdId =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Background</span><span style="line-height: 140%">.GetBackgroundDictionaryId(db, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">DBDictionary</span><span style="line-height: 140%"> bgd =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: #2b91af; line-height: 140%">DBDictionary</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bgdId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (bgd.Contains(bgKey))</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bgId = bgd.GetAt(bgKey);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">else</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// If our background doesn't exist...</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Get the 2D modelspace background colour</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">AcadPreferences</span><span style="line-height: 140%"> prefs =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: #2b91af; line-height: 140%">AcadPreferences</span><span style="line-height: 140%">)</span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.Preferences;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%"> rawCol =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: blue; line-height: 140%">int</span><span style="line-height: 140%">)prefs.Display.GraphicsWinModelBackgrndColor;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Create a background with the corresponding RGB</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">SolidBackground</span><span style="line-height: 140%"> sb = </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #2b91af; line-height: 140%">SolidBackground</span><span style="line-height: 140%">();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.Color =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">new</span><span style="line-height: 140%"> Autodesk.AutoCAD.Colors.</span><span style="color: #2b91af; line-height: 140%">EntityColor</span><span style="line-height: 140%">(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)(rawCol &amp; 0x000000FF),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)((rawCol &amp; 0x0000FF00) &gt;&gt; 8),</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: blue; line-height: 140%">byte</span><span style="line-height: 140%">)((rawCol &amp; 0x00FF0000) &gt;&gt; 16)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Add it to the background dictionary</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bgd.UpgradeOpen();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bgId = bgd.SetAt(bgKey, sb);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tr.AddNewlyCreatedDBObject(sb, </span><span style="color: blue; line-height: 140%">true</span><span style="line-height: 140%">);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Set the background on the active modelspace viewport</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ViewportTable</span><span style="line-height: 140%"> vt =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: #2b91af; line-height: 140%">ViewportTable</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.ViewportTableId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">foreach</span><span style="line-height: 140%"> (</span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> id </span><span style="color: blue; line-height: 140%">in</span><span style="line-height: 140%"> vt)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%"> vtr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForRead</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (vtr.Name == </span><span style="color: #a31515; line-height: 140%">"*Active"</span><span style="line-height: 140%">)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtId = id;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtr.UpgradeOpen();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtr.Background = bgId;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tr.Commit();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">else</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; view.Dispose();</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">return</span><span style="line-height: 140%"> vtId;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">private</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">void</span><span style="line-height: 140%"> RemoveBackground(</span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Transaction</span><span style="line-height: 140%"> tr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.TransactionManager.StartTransaction();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">using</span><span style="line-height: 140%"> (tr)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// Open up the previously-modified viewport</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%"> vtr =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="color: #2b91af; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtId,</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">OpenMode</span><span style="line-height: 140%">.ForWrite</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green; line-height: 140%">// And set its previous background</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> obgId =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtr.GetPreviousBackground(</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">DrawableType</span><span style="line-height: 140%">.SolidBackground</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vtr.Background = obgId;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tr.Commit();</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; [</span><span style="color: #2b91af; line-height: 140%">CommandMethod</span><span style="line-height: 140%">(</span><span style="color: #a31515; line-height: 140%">"TV"</span><span style="line-height: 140%">)]</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">static</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: blue; line-height: 140%">void</span><span style="line-height: 140%"> TransitionView()</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; {</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Document</span><span style="line-height: 140%"> doc =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">Database</span><span style="line-height: 140%"> db =</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doc.Database;</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%"> vtId = CreateBackground();</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(defaultView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(SWIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(topView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(SEIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(bottomView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(NEIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(leftView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(NWIso, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(rightView, 10);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmoothViewTo(defaultView, 10);</span></p> <p style="font-size: 8pt; margin: 0px">&nbsp;</p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; line-height: 140%">if</span><span style="line-height: 140%"> (vtId != </span><span style="color: #2b91af; line-height: 140%">ObjectId</span><span style="line-height: 140%">.Null)</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RemoveBackground(vtId);</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">&nbsp; }</span></p> <p style="font-size: 8pt; margin: 0px"><span style="line-height: 140%">}</span></p></div><!--EndFragment--> <p>A few comments on the code...</p> <p>Fenton interpolates between views using his own "secret sauce", the CosInterp() function. This does some clever stuff to interpolate between the values provided. It's used to interpolate between the beginning and end states of the individual members of the co-ordinates of the various points and vectors - and the field width and height - that define a view.</p> <p>I added some functionality to create a temporary background image attached to the active ViewportTableRecord with the same colour as the drawing canvas background (if in a standard 2D view). This allows the 3D view that gets created to have the same background colour, avoiding the shock of it flashing to grey and back. I admit that this code (in CreateBackground() and RemoveBackground()) doesn't feel especially elegant - I tried various different approaches such as modifying the view and the device attached to the view, but none of them worked in the way I wanted. So this is what I ended up with. I'd be very happy to hear from people who have found a better way to address this issue...</p> <p>To see how the function works, draw some 3D geometry, load the application and run the TV command.</p> <p>Here's a sample view prior to running the command:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201116897034e970c-pi"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="258" alt="2D view before transitions" src="/assets/image_884256.jpg" width="344" border="0"></a> </p> <p>And here's a snapshot I managed to take during the command, as the view was transitioning:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2011168970356970c-pi"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="288" alt="3D view in mid transition" src="/assets/image_173920.jpg" width="266" border="0"></a> </p> <p>It's hard to do it justice with a static image, so the best is to give it a try.</p> <p>I can see a few changes that people might want to make to the code:</p> <ul> <li>the view definitions (to change their parameters or even to generate them dynamically).</li> <li>the formula in the CosInterp() function.</li> <li>the code towards the end of the SmoothViewTo() which pauses for a variable amount of time, depending on how close the view is from being transitioned.</li></ul> <p>When Fenton shared his original code within the DevTech team, <a href="http://blogs.autodesk.com/thebuildingcoder">Jeremy Tammik</a> mentioned another interpolation algorithm based on <a href="http://en.wikipedia.org/wiki/Quaternion">quaternion</a> mathematics, <a href="http://en.wikipedia.org/wiki/Slerp">spherical linear interpolation (Slerp)</a>. In the next post in this series we'll take a look at a version implementing Slerp to do something very similar to the code in this post.</p>
