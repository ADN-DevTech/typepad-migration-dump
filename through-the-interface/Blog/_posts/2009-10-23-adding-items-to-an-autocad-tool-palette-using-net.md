---
layout: "post"
title: "Adding items to an AutoCAD tool palette using .NET"
date: "2009-10-23 06:39:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Commands"
original_url: "https://www.keanw.com/2009/10/adding-items-to-an-autocad-tool-palette-using-net.html "
typepad_basename: "adding-items-to-an-autocad-tool-palette-using-net"
typepad_status: "Publish"
---

<p>This post carries directly on from <a href="http://through-the-interface.typepad.com/through_the_interface/2009/10/implementing-a-quick-saveas-command-in-autocad-using-net.html">the last one</a>, which implemented a rudimentary “Quick SaveAs” capability in AutoCAD. Much of the explanation behind the design of today’s code is there, so please do read it first (if you haven’t already).</p>
<p>Today we’re taking the code further by automatically creating an item on a tool palette with the thumbnail of the recently-saved drawing which, when used, will run a script created when we saved the drawing.</p>
<p>Here’s the updated code with the new or modified lines in red. You can download <span class="asset asset-generic at-xid-6a00d83452464869e20120a6137a43970b"><a href="http://through-the-interface.typepad.com/files/qsaveas-toolpalette.cs">the C# source file from here</a></span>.</p>
<div style="FONT-FAMILY: Courier New; BACKGROUND: white; COLOR: black; FONT-SIZE: 8pt">
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 1</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 2</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 3</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> Autodesk.AutoCAD.EditorInput;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 4</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> Autodesk.AutoCAD.Runtime;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160; &#0160; 5</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> Autodesk.AutoCAD.Windows.ToolPalette;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160; &#0160; 6</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> System.Runtime.InteropServices;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 7</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> System.IO;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160; &#0160; 8</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">using</span><span style="LINE-HEIGHT: 140%"> System;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160; &#0160; 9</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;10</span>&#0160;<span style="LINE-HEIGHT: 140%; COLOR: blue">namespace</span><span style="LINE-HEIGHT: 140%"> QuickSaveAs</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;11</span>&#0160;<span style="LINE-HEIGHT: 140%">{</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;12</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">public</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">class</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Commands</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;13</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;14</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Set up static variable for the path to our folder</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;15</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// of drawings, as well as the base filename and a</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;16</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// counter to make the unique filename</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;17</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;18</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">static</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> _path = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;19</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; _base = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;20</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">static</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">int</span><span style="LINE-HEIGHT: 140%"> _count = 0;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;21</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;22</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Various filename and path-related constants</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;23</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;24</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">const</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> sfxSep = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot; &quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;25</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; extSep = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;.&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;26</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; pthSep = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\\&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;27</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; lspSep = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;/&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;28</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; dwgExt = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;.dwg&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;29</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; scrExt = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;.txt&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;30</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; bmpExt = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;.bmp&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;31</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; bmpLoc = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;Images&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;32</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; scrLoc = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;Scripts&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;33</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;34</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Our QuickSaveAs command</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;35</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;36</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; [CommandMethod(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;QSAVEAS&quot;</span><span style="LINE-HEIGHT: 140%">)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;37</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">public</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">void</span><span style="LINE-HEIGHT: 140%"> QuickSaveAs()</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;38</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;39</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Document doc =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;40</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; Application.DocumentManager.MdiActiveDocument;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;41</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Editor ed = doc.Editor;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;42</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Database db = doc.Database;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;43</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;44</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// If this is the first time run...</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;45</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;46</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (_path == </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> || _base == </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;47</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;48</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Ask the user for a base file location</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;49</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;50</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; PromptSaveFileOptions opts =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;51</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> PromptSaveFileOptions(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;52</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;Select location to save first drawing file&quot;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;53</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;54</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; opts.Filter = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;Drawing (*.dwg)|*.dwg&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;55</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; PromptFileNameResult pr =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;56</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; ed.GetFileNameForSave(opts);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;57</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;58</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Delete the file, if it exists</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;59</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// (may be a problem if the file is in use)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;60</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;61</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">File</span><span style="LINE-HEIGHT: 140%">.Exists(pr.StringResult))</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;62</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;63</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">try</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;64</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;65</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">File</span><span style="LINE-HEIGHT: 140%">.Delete(pr.StringResult);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;66</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;67</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">catch</span><span style="LINE-HEIGHT: 140%"> { }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;68</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;69</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;70</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (pr.Status == PromptStatus.OK)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;71</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;72</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// If a file was selected, and it contains a path...</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;73</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;74</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (pr.StringResult.Contains(pthSep))</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;75</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;76</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Separate the path from the file name</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;77</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;78</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">int</span><span style="LINE-HEIGHT: 140%"> idx = pr.StringResult.LastIndexOf(pthSep);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;79</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; _path =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;80</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; pr.StringResult.Substring(0, idx);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;81</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> fullname =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;82</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; pr.StringResult.Substring(idx+1);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;83</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;84</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// If the path has an extension (this should always</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;85</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// be the case), extract the base file name</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;86</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;87</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (fullname.Contains(extSep))</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;88</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;89</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; _base =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;90</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; fullname.Substring(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;91</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; 0,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;92</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; fullname.LastIndexOf(extSep)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;93</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;&#0160;94</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;95</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Create folders for our icons and our scripts</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;96</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;97</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Directory</span><span style="LINE-HEIGHT: 140%">.CreateDirectory(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;98</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; _path + pthSep + bmpLoc</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;&#0160;99</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;100</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Directory</span><span style="LINE-HEIGHT: 140%">.CreateDirectory(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;101</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; _path + pthSep + scrLoc</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;102</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;103</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;104</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;105</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;106</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;107</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;108</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Assuming the path and name were set appropriately...</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;109</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;110</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (_path != </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> &amp;&amp; _base != </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;&quot;</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;111</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;112</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> name = _base;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;113</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;114</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Add our suffix if not the first time run</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;115</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;116</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (_count &gt; 0)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;117</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; name += sfxSep + _count.ToString();</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;118</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;119</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Our drawing is located in the base path</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;120</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;121</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> dwgPath = _path + pthSep + name + dwgExt;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;122</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;123</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// While our script is in a sub-folder</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;124</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;125</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> scrPath =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;126</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; _path + pthSep + scrLoc + pthSep + name + scrExt;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;127</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;128</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Create a dummy script, so we can make sure we pick</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;129</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// up the contents in our dummy execute command</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;130</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;131</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">File</span><span style="LINE-HEIGHT: 140%">.WriteAllText(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;132</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; scrPath,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;133</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;This is a dummy script for &quot;</span><span style="LINE-HEIGHT: 140%"> + name + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;.&quot;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;134</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;135</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;136</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Now we want to save our drawing and use the image</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;137</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// for our tool icon</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;138</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;139</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Using either COM or .NET doesn&#39;t generate a</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;140</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// thumbnail in the resultant file (or its Database)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;141</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;142</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// .NET:</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;143</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// db.SaveAs(dwgPath, false, DwgVersion.Current, null);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;144</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;145</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// COM:</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;146</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// AcadDocument adoc = (AcadDocument)doc.AcadDocument;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;147</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// adoc.SaveAs(dwgPath, AcSaveAsType.acNative, null);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;148</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;149</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// So we&#39;ll send commands to the command-line</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;150</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// We&#39;ll use LISP, to avoid having to set FILEDIA to 0</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;151</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;152</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">object</span><span style="LINE-HEIGHT: 140%"> ocmd = Application.GetSystemVariable(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;CMDECHO&quot;</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;153</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> dwgPath2 = dwgPath.Replace(pthSep, lspSep);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;154</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> scrPath2 = scrPath.Replace(pthSep, lspSep);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;155</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;156</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> c1 =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;157</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;(setvar \&quot;CMDECHO\&quot; 0)&quot;</span><span style="LINE-HEIGHT: 140%"> +</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;158</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;(command \&quot;_.SAVEAS\&quot; \&quot;\&quot; \&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> + dwgPath2 + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\&quot;)&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;159</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> c2 =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;160</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;(setvar \&quot;CMDECHO\&quot; &quot;</span><span style="LINE-HEIGHT: 140%"> + ocmd.ToString() + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;)&quot;</span><span style="LINE-HEIGHT: 140%"> +</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;161</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;(tp-create \&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> + name + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\&quot; \&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> + scrPath2 + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\&quot;)&quot;</span><span style="LINE-HEIGHT: 140%"> +</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;162</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;(princ) &quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;163</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> cmd = c1 + c2;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;164</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;165</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (cmd.Length &lt;= 255)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;166</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;167</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; doc.SendStringToExecute(cmd, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;168</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;169</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">else</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;170</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;171</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; doc.SendStringToExecute(c1+</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot; &quot;</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;172</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; doc.SendStringToExecute(c2, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;173</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;174</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;175</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Print a confirmation message for the DWG save</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;176</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// (which actually gets displayed before the queued</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;177</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// string gets executed, but anyway)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;178</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;179</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; ed.WriteMessage(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\nSaved to: \&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> + dwgPath + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\&quot;&quot;</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;180</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;181</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; _count++;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;182</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;183</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;184</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;185</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Our LISP-registered continuation function to create a</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;186</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// command tool on our tool palette</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;187</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;188</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; [LispFunction(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;TP-CREATE&quot;</span><span style="LINE-HEIGHT: 140%">)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;189</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">public</span><span style="LINE-HEIGHT: 140%"> ResultBuffer CreateToolPaletteCommand(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;190</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; ResultBuffer rb</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;191</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; )</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;192</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;193</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">const</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">int</span><span style="LINE-HEIGHT: 140%"> RTSTR = 5005;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;194</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;195</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Document doc =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;196</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; Application.DocumentManager.MdiActiveDocument;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;197</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Editor ed = doc.Editor;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;198</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;199</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (rb == </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;200</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;201</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; ed.WriteMessage(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\nError: too few arguments.&quot;</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;202</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;203</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">else</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;204</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;205</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// We&#39;re only interested in the first two arguments</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;206</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;207</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Array</span><span style="LINE-HEIGHT: 140%"> args = rb.AsArray();</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;208</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (args.Length != 2)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;209</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;210</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; ed.WriteMessage(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;211</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\nError: wrong number of arguments.&quot;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;212</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;213</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;214</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">else</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;215</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;216</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// First argument is the name, second is the path</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;217</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// to the script</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;218</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;219</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; TypedValue tv1 = (TypedValue)args.GetValue(0);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;220</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; TypedValue tv2 = (TypedValue)args.GetValue(1);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;221</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;222</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (tv1 != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%"> &amp;&amp; tv1.TypeCode == RTSTR &amp;&amp;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;223</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; tv2 != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%"> &amp;&amp; tv2.TypeCode == RTSTR)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;224</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;225</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> name = </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Convert</span><span style="LINE-HEIGHT: 140%">.ToString(tv1.Value);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;226</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> lspScrPath = </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Convert</span><span style="LINE-HEIGHT: 140%">.ToString(tv2.Value);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;227</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> scrPath =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;228</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; lspScrPath.Replace(lspSep, pthSep);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;229</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">bool</span><span style="LINE-HEIGHT: 140%"> success =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;230</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; CreateCommand(doc.Database, name, scrPath);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;231</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">return</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;232</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; (success ?</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;233</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> ResultBuffer(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;234</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> TypedValue(RTSTR, tv1.Value)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;235</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; )</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;236</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; : </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;237</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;238</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;239</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;240</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">return</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;241</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;242</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;243</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Function to add a command tool to our tool palette to</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;244</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// execute the script</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;245</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;246</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">private</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">bool</span><span style="LINE-HEIGHT: 140%"> CreateCommand(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;247</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Database db,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;248</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> name,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;249</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> scrPath</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;250</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; )</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;251</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;252</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">const</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> catName = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;ScriptCatalog&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;253</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">const</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> palName = </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;Scripts&quot;</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;254</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;255</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; ToolPaletteManager tpm = ToolPaletteManager.Manager;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;256</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;257</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Get the GUID of our dummy custom tool</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;258</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;259</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Type</span><span style="LINE-HEIGHT: 140%"> t = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">typeof</span><span style="LINE-HEIGHT: 140%">(DummyTool);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;260</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">GuidAttribute</span><span style="LINE-HEIGHT: 140%"> ga =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;261</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; (</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">GuidAttribute</span><span style="LINE-HEIGHT: 140%">)t.GetCustomAttributes(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;262</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">typeof</span><span style="LINE-HEIGHT: 140%">(</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">GuidAttribute</span><span style="LINE-HEIGHT: 140%">), </span><span style="LINE-HEIGHT: 140%; COLOR: blue">false</span><span style="LINE-HEIGHT: 140%">)[0];</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;263</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Guid</span><span style="LINE-HEIGHT: 140%"> g = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">Guid</span><span style="LINE-HEIGHT: 140%">(ga.Value);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;264</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;265</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Instanciate our dummy tool - this will allow us to use</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;266</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// its helper functions</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;267</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;268</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; DummyTool tool = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> DummyTool();</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;269</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Catalog cat;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;270</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Palette pal = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;271</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;272</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// First we check whether our GUID is in a catalog</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;273</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;274</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; CatalogItem ci = tpm.StockToolCatalogs.Find(g);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;275</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (ci != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;276</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;277</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// If it is, search each catalog for our palette</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;278</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;279</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">foreach</span><span style="LINE-HEIGHT: 140%">(CatalogItem ci2 </span><span style="LINE-HEIGHT: 140%; COLOR: blue">in</span><span style="LINE-HEIGHT: 140%"> tpm.Catalogs)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;280</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;281</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">for</span><span style="LINE-HEIGHT: 140%"> (</span><span style="LINE-HEIGHT: 140%; COLOR: blue">int</span><span style="LINE-HEIGHT: 140%"> i = 0; i &lt; ci2.ChildCount; i++)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;282</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;283</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; CatalogItem ci3 = ci2.GetChild(i);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;284</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (ci3 != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%"> &amp;&amp; ci3.Name == palName)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;285</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;286</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; pal = ci3 </span><span style="LINE-HEIGHT: 140%; COLOR: blue">as</span><span style="LINE-HEIGHT: 140%"> Palette;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;287</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">break</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;288</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;289</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;290</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (pal != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;291</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">break</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;292</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;293</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;294</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;295</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// If we didn&#39;t find our palette, create it</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;296</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;297</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (pal == </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;298</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;299</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; cat = tool.CreateStockTool(catName);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;300</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; pal = tool.CreatePalette(cat, palName);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;301</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;302</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;303</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// To add our command tool instance we need an icon</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;304</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;305</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; ImageInfo ii = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> ImageInfo();</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;306</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (db.ThumbnailBitmap != </span><span style="LINE-HEIGHT: 140%; COLOR: blue">null</span><span style="LINE-HEIGHT: 140%">)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;307</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;308</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Which we create from the Database&#39;s thumbnail</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;309</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;310</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> bmpPath =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;311</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; _path + pthSep + bmpLoc + pthSep + name + bmpExt;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;312</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; db.ThumbnailBitmap.Save(bmpPath);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;313</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; ii.ResourceFile = bmpPath;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;314</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;315</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; ii.Size = </span><span style="LINE-HEIGHT: 140%; COLOR: blue">new</span><span style="LINE-HEIGHT: 140%"> System.Drawing.Size(65, 65);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;316</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;317</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// And then we use our dummy tool to create the</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;318</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// command tool</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;319</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;320</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; tool.CreateCommandTool(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;321</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; pal,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;322</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; name,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;323</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; ii,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;324</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;_EXECSCR \&quot;&quot;</span><span style="LINE-HEIGHT: 140%"> + scrPath.Replace(pthSep, lspSep) + </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\&quot;&quot;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;325</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;326</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;327</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Finally we reload the catalogs to display the change</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;328</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;329</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; tpm.LoadCatalogs();</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;330</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;331</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">return</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">true</span><span style="LINE-HEIGHT: 140%">;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;332</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;333</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;334</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// A dummy command to simulate the execution of our script</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;335</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// (which simply reads the contents and displays them on</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;336</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// the command-line)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;337</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;338</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; [CommandMethod(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;EXECSCR&quot;</span><span style="LINE-HEIGHT: 140%">)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;339</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">public</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">void</span><span style="LINE-HEIGHT: 140%"> ExecuteScript()</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;340</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;341</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Document doc =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;342</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; Application.DocumentManager.MdiActiveDocument;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;343</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; Editor ed = doc.Editor;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;344</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;345</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; PromptResult pr =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;346</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; ed.GetString(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;347</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\nEnter location of script to execute: &quot;</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;348</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;349</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (pr.Status == PromptStatus.OK)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;350</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;351</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> path =</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;352</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; pr.StringResult.Replace(lspSep, pthSep);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;353</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">if</span><span style="LINE-HEIGHT: 140%"> (</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">File</span><span style="LINE-HEIGHT: 140%">.Exists(path))</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;354</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;355</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">string</span><span style="LINE-HEIGHT: 140%"> contents = </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">File</span><span style="LINE-HEIGHT: 140%">.ReadAllText(path);</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;356</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; ed.WriteMessage(</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;357</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;\nDummy script contained: \&quot;{0}\&quot;&quot;</span><span style="LINE-HEIGHT: 140%">,</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;358</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; &#0160; contents</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;359</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; &#0160; );</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;360</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;361</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;362</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; &#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;363</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;364</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;365</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// Our dummy tool which simply derives from CustomToolBase</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;366</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// (there may be a more straightforward way to get access</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;367</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: green">// to the helpers in CustomToolBase, but anyway)</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;368</span>&#0160;</p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;369</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; [Guid(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;3B725500-0451-4081-A1BB-B37CE6A65767&quot;</span><span style="LINE-HEIGHT: 140%">)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;370</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; [Tool(</span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;MyDummyTool&quot;</span><span style="LINE-HEIGHT: 140%">, </span><span style="LINE-HEIGHT: 140%; COLOR: #a31515">&quot;IDB_TOOL&quot;</span><span style="LINE-HEIGHT: 140%">)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;371</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; [</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">ClassInterface</span><span style="LINE-HEIGHT: 140%">(</span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">ClassInterfaceType</span><span style="LINE-HEIGHT: 140%">.AutoDual)]</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;372</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; </span><span style="LINE-HEIGHT: 140%; COLOR: blue">public</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: blue">class</span><span style="LINE-HEIGHT: 140%"> </span><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">DummyTool</span><span style="LINE-HEIGHT: 140%"> : CustomToolBase</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;373</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; {</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: red">&#0160;&#0160;374</span>&#0160;<span style="LINE-HEIGHT: 140%">&#0160; }</span></p>
<p style="MARGIN: 0px"><span style="LINE-HEIGHT: 140%; COLOR: #2b91af">&#0160;&#0160;375</span>&#0160;<span style="LINE-HEIGHT: 140%">}</span></p></div>
<p>Some notes on the changes:</p>
<ul>
<li>Lines 5, 6 and 8 add some additional namespaces. 
<ul>
<li>It&#39;s worth noting that you&#39;ll need to add an assembly reference to AcTcMgd (depending on the version of AutoCAD you&#39;re using), for the updated code to build. </li>
</ul>
<li>Lines 28-32 add some additional constants related to scripts and icon images. 
<li>Lines 95-102 create additional directories for our scripts and images. 
<li>Lines 123-134 create a dummy script when we save a drawing. 
<li>Lines 154-173 deal with a limitation we have with sending strings to the command-line: 
<ul>
<li>AutoCAD’s command-line input buffer is only 255 characters in size, so if our string is longer (because of a deep file path), we send it in two pieces, terminating the first with a space character. It’s still possible that really deep paths could cause a problem with this code, but splitting the string further is left as an exercise for the reader. :-) 
<li>The string also calls a new continuation function (registered via LISP, see below) to create an item on our tool palette. </li>
</li></ul>
<li>Lines 185-241 register a continuation function via LISP, so we can get control back in our code once the SAVEAS command has completed. 
<li>Lines 243-332 define a function to create an item on our tool palette. This function is called from the above LISP function. 
<li>Lines 334-363 simulate the execution of a script, so that when our tool palette is used, something happens. 
<ul>
<li>The command simply reads in the contents of the &quot;script&quot; file and prints the contents to the command-line. </li>
</ul>
<li>Lines 365-374 define a dummy custom tool, which we use as a shortcut for certain tool palette-related operations. </li>
</li></li></li></li></li></li></li></li></ul>
<p>Now let’s take a look at the results of running this. In the last post we saw an example where a number of drawings get created in a particular folder. If we perform the same operations with this code, the same things happen (no need to show the drawings or the command-line output, they should be the same), but in addition we see a tool palette populated with images of our model at various stages:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a66a975e970c-pi"><img alt="Our QSaveAs-populated tool palette" border="0" height="257" src="/assets/image_455124.jpg" style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: block; FLOAT: none; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; MARGIN-LEFT: auto; BORDER-LEFT-WIDTH: 0px; MARGIN-RIGHT: auto" title="Our QSaveAs-populated tool palette" width="333" /></a></p>
<p>You may have to right-click the stacked tool palette tabs to locate the “Scripts” tool palette (I haven’t found a way of doing this automatically, as it wasn’t really essential for my particular application).</p>
<p>When we select the items on the tool palette in sequence, we see our EXECSCR command is called with the location of the script created for each DWG file, which then gets read and printed to the command-line:</p>
<div style="FONT-FAMILY: courier new; BACKGROUND: white; COLOR: black; FONT-SIZE: 8pt">
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model.&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model 1.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model 1.&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model 2.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model 2.&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model 3.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model 3.&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model 4.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model 4.&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Command: _EXECSCR</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Enter location of script to execute: </span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">&quot;C:/QSaveAs Test/Scripts/Solid model 5.txt&quot;</span></p>
<p style="MARGIN: 0px; FONT-SIZE: 8pt"><span style="LINE-HEIGHT: 140%">Dummy script contained: &quot;This is a dummy script for Solid model 5.&quot;</span></p></div>
<p>While clearly not actually doing anything useful, the script file that we’ve created (and I don’t mean script in the AutoCAD sense of the term – I’m using it in a more generic sense) could actually be regenerating the drawing contents (for instance). With a little more work. :-)</p>
<p><strong><em>Update:</em></strong></p>
<p><a href="http://through-the-interface.typepad.com/through_the_interface/2009/10/streamlined-quicksaveas-command-for-autocad-2010.html">This post</a> shows a streamlined approach for this application for AutoCAD 2010 and above.</p>
