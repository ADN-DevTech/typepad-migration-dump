---
layout: "post"
title: "Counting the RegAppIds for a specific AutoCAD drawing and its external references using .NET"
date: "2011-01-26 05:49:00"
author: "Kean Walmsley"
categories: []
original_url: "https://www.keanw.com/2011/01/counting-the-regappids-for-a-specific-autocad-drawing-and-its-external-references-using-net.html "
typepad_basename: "counting-the-regappids-for-a-specific-autocad-drawing-and-its-external-references-using-net"
typepad_status: "Publish"
---

<p>This post extends the code shown in <a href="http://through-the-interface.typepad.com/through_the_interface/2011/01/counting-the-regappids-for-the-active-autocad-drawing-and-its-external-references-using-net.html" target="_blank">the last – very similarly named – post</a>, to work on a specified drawing, that – very importantly – does <strong>not </strong>get loaded into the AutoCAD editor. Step 2 in the list for this series:</p>
<ol>
<li>Implement a command to collect RegAppId information for the active document </li>
<li>Extend this command to work on a drawing not loaded in the editor </li>
<li>Save our RegAppId information to some persistent location (XML) </li>
<li>Create a modified version of ScriptPro 2.0 (one of our <a href="http://labs.autodesk.com/utilities/ADN_plugins" target="_blank">Plugins of the Month</a>) to call our command without opening the drawing </li>
</ol>
<p>The code starts by prompting the user for the path to the main drawing to load (which will eventually be provided by the modified ScriptPro 2.0 application, so no need to use a dialog), before attempting to load the file into a side database and resolve any xrefs it contains. The main loop is as before with a new catch statement taking care of any exceptions thrown during drawing load.</p>
<p>Here’s the updated C# code, with modified lines in <span style="color: #ff0000;">red</span> (and here’s <a href="http://through-the-interface.typepad.com/files/recurse-xrefs-external.cs" target="_blank">the updated source file</a>):</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 1</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.ApplicationServices;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 2</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.DatabaseServices;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 3</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.EditorInput;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 4</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.Runtime;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 5</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Collections.Generic;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 6</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.IO;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 7</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 8</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 9</span>&#0160;<span style="line-height: 140%; color: blue;">namespace</span><span style="line-height: 140%;"> XrefRegApps</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 10</span>&#0160;<span style="line-height: 140%;">{</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 11</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Commands</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 12</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 13</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af;">CommandMethod</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;XRA&quot;</span><span style="line-height: 140%;">)]</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 14</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> ExternalReferenceRegisteredApps()</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 15</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 16</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Document</span><span style="line-height: 140%;"> doc =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 17</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Application</span><span style="line-height: 140%;">.DocumentManager.MdiActiveDocument;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 18</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Database</span><span style="line-height: 140%;"> db = doc.Database;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 19</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Editor</span><span style="line-height: 140%;"> ed = doc.Editor;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 20</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 21</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Prompt the user for the path to a DWG to test</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 22</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 23</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptStringOptions</span><span style="line-height: 140%;"> pso =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 24</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PromptStringOptions</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 25</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nEnter path to root drawing file: &quot;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 26</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 27</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; pso.AllowSpaces = </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 28</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptResult</span><span style="line-height: 140%;"> pr = ed.GetString(pso);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 29</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (pr.Status != </span><span style="line-height: 140%; color: #2b91af;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 30</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 31</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 32</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (!</span><span style="line-height: 140%; color: #2b91af;">File</span><span style="line-height: 140%;">.Exists(pr.StringResult))</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 33</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 34</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span><span style="line-height: 140%; color: #a31515;">&quot;\nFile does not exist.&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 35</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 36</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 37</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 38</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 39</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 40</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Load the DWG into a side database</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 41</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 42</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Database</span><span style="line-height: 140%;"> mainDb = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Database</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">, </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 43</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (mainDb)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 44</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 45</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mainDb.ReadDwgFile(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 46</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pr.StringResult,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 47</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">FileOpenMode</span><span style="line-height: 140%;">.OpenForReadAndAllShare,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 48</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 49</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">null</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 50</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 51</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 52</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We need an additional step to resolve Xrefs</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 53</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 54</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mainDb.ResolveXrefs(</span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">, </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 55</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 56</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the XrefGraph for the specified database</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 57</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160;&#0160; 58</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">XrefGraph</span><span style="line-height: 140%;"> xg = mainDb.GetHostDwgXrefGraph(</span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 59</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 60</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Loop through the nodes in the graph</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 61</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 62</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">for</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> i = 0; i &lt; xg.NumNodes; i++)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 63</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 64</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get each node and check its status</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 65</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 66</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">XrefGraphNode</span><span style="line-height: 140%;"> xgn = xg.GetXrefNode(i);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 67</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 68</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">switch</span><span style="line-height: 140%;"> (xgn.XrefStatus)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 69</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 70</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// If Un*, print a message</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 71</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 72</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">XrefStatus</span><span style="line-height: 140%;">.Unresolved:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 73</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 74</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nUnresolved xref \&quot;{0}\&quot;&quot;</span><span style="line-height: 140%;">, xgn.Name</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 75</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 76</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 77</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">XrefStatus</span><span style="line-height: 140%;">.Unloaded:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 78</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 79</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nUnloaded xref \&quot;{0}\&quot;&quot;</span><span style="line-height: 140%;">, xgn.Name</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 80</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 81</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 82</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">XrefStatus</span><span style="line-height: 140%;">.Unreferenced:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 83</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 84</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nUnreferenced xref \&quot;{0}\&quot;&quot;</span><span style="line-height: 140%;">, xgn.Name</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 85</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 86</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 87</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">XrefStatus</span><span style="line-height: 140%;">.Resolved:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 88</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 89</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// If Resolved, get the RegAppTable</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 90</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 91</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Database</span><span style="line-height: 140%;"> xdb = xgn.Database;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 92</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (xdb != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 93</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 94</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Transaction</span><span style="line-height: 140%;"> tr =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 95</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; xdb.TransactionManager.StartTransaction();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 96</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (tr)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 97</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 98</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegAppTable</span><span style="line-height: 140%;"> rat =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 99</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">RegAppTable</span><span style="line-height: 140%;">)tr.GetObject(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 100</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; xdb.RegAppTableId,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 101</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">OpenMode</span><span style="line-height: 140%;">.ForRead</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 102</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 103</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 104</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Collect the contained RegAppTableRecord</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 105</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// names (i.e. the RegAppIds) in a list</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 106</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 107</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: #2b91af;">String</span><span style="line-height: 140%;">&gt; ratIds = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">List</span><span style="line-height: 140%;">&lt;</span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;">&gt;();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 108</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">foreach</span><span style="line-height: 140%;"> (</span><span style="line-height: 140%; color: #2b91af;">ObjectId</span><span style="line-height: 140%;"> id </span><span style="line-height: 140%; color: blue;">in</span><span style="line-height: 140%;"> rat)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 109</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 110</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RegAppTableRecord</span><span style="line-height: 140%;"> ratr =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 111</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">RegAppTableRecord</span><span style="line-height: 140%;">)tr.GetObject(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 112</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; id,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 113</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">OpenMode</span><span style="line-height: 140%;">.ForRead</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 114</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 115</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ratIds.Add(ratr.Name);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 116</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 117</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 118</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Print the drawing information</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 119</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// and the RegAppId count</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 120</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 121</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 122</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nDrawing \&quot;{0}\&quot; (\&quot;{1}\&quot;) with {2}&quot;</span><span style="line-height: 140%;"> +</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 123</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot; RegAppIds&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 124</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; xgn.Name,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 125</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; xdb.Filename,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 126</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ratIds.Count</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 127</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 128</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 129</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Even if only reading, commit the</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 130</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// transaction (it&#39;s cheaper than aborting)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 131</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 132</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 133</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 134</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 135</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 136</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 137</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 138</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 139</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 140</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 141</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span><span style="line-height: 140%;"> (System.</span><span style="line-height: 140%; color: #2b91af;">Exception</span><span style="line-height: 140%;"> ex)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 142</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 143</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 144</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nProblem reading/processing \&quot;{0}\&quot;: {1}&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 145</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pr.StringResult, ex.Message</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 146</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 147</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 148</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 149</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 150</span>&#0160;<span style="line-height: 140%;">}</span></p>
</div>
<p>Here’s what happens when we run our updated command, selecting the same DWG as in the previous post (without the need to load it):</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px;"><span style="line-height: 140%;">Command: <span style="color: #ff0000;">XRA</span></span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">Enter path to root drawing file: <span style="color: #ff0000;">C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\Master Site Plan.dwg</span></span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">Drawing &quot;C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\Master Site Plan.dwg&quot; (&quot;C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\Master Site Plan.dwg&quot;) with 18 RegAppIds</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">Drawing &quot;PB-BASE&quot; (&quot;C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\PB-BASE.dwg&quot;) with 7 RegAppIds</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">Drawing &quot;PB-EX41&quot; (&quot;C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\PB-EX41.dwg&quot;) with 6 RegAppIds</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">Drawing &quot;PB-EX61&quot; (&quot;C:\Program Files\Autodesk\AutoCAD 2011\Sample\Sheet Sets\Civil\PB-EX61.dwg&quot;) with 5 RegAppIds</span></p>
</div>
<p>You’ll notice the “name” of the primary drawing is its full path: when we store this data in XML, we’ll go through the additional step of extracting the filename (System.IO.Path.GetFileNameWithoutExtension() makes this easy).</p>
