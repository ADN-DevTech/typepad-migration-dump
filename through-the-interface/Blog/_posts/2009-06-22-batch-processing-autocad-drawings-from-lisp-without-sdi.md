---
layout: "post"
title: "Batch-processing AutoCAD drawings from LISP without SDI"
date: "2009-06-22 09:06:50"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoLISP / Visual LISP"
  - "Batch processing"
original_url: "https://www.keanw.com/2009/06/batch-processing-autocad-drawings-from-lisp-without-sdi.html "
typepad_basename: "batch-processing-autocad-drawings-from-lisp-without-sdi"
typepad_status: "Publish"
---

<p>As mentioned in <a href="http://through-the-interface.typepad.com/through_the_interface/2009/04/sdi-the-end-is-nigh.html">this previous post</a>, there has been some discussion internally around the future of SDI. Given the change this will bring to applications, SDI is going to be around until we next deliberately choose to break binary application compatibility (something we just did with AutoCAD 2010 and <em>typically</em> try to do only <a href="http://through-the-interface.typepad.com/through_the_interface/2006/06/compatibility_o.html">every three releases</a>).</p>  <p>That said, SDI is very likely to go away at some point, so it does seem worth drilling further into the reasons for using it and trying to determine an appropriate way to remove current dependencies on it.</p>  <p>Thanks to all of you who responded to my previous post and provided input on your use of SDI. The most common theme was around the use of SDI <a href="http://blog.jtbworld.com/2009/04/end-of-sdi.html">to batch-process sets of drawings</a>: opening each one, performing an operation and (optionally) saving before opening the next.</p>  <p>My understanding is that SDI makes life easier, in this situation, because the closing of one drawing is taken care of automatically when opening the next and so LISP applications can operate more easily across multiple drawings.</p>  <p>I did some tests, to see how it helps, but the LISP part of my brain has unfortunately atrophied, over the years: I wasn’t able to get a simple SDI-only, batch processing application to work, as it always stopped once a new drawing was open. It may be that some use of script files is needed – and this certainly can make life easier, as we’ll see below – but it would be good if someone could help me out by posting a comment or dropping me <a href="mailto:kean.walmsley@autodesk.com">an email</a>. I’m sure I’m missing something very simple.</p>  <p>Anyway, irrespective of whether I was able to use SDI successfully, or not, I <em>was</em> able to get something working from an MDI environment that I hope to be equivalent, functionality-wise.</p>  <p>Thanks to guidance from Wayne Brill, a member of DevTech Americas, I was able to put together some LISP code that makes use of a temporary script file to handle the opening, processing, (saving) and closing of drawings.</p>  <p>Here’s the LISP application:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">(</font><font color="#0000ff">defun</font> C:BATCH<font color="#ff0000">(</font><font color="#0000ff">/</font> dwgs scr-name lsp-name<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">setq</font> dwgs '<font color="#ff0000">(</font><font color="#ff00ff">&quot;C:/A.DWG&quot; &quot;C:/B.DWG&quot; &quot;C:/C.DWG&quot; &quot;C:/D.DWG&quot;</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; scr-name <font color="#ff00ff">&quot;c:/tmp.scr&quot;</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; lsp-name <font color="#ff00ff">&quot;c:/batch.lsp&quot;</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; (create-script scr-name dwgs lsp-name <font color="#ff00ff">&quot;(CreateCircle)&quot;</font> <font color="#0000ff">T</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">command</font> <font color="#ff00ff">&quot;_.SCRIPT&quot;</font> scr-name<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">vl-file-delete</font> scr-name<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">princ</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">)</font></span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">(</font><font color="#0000ff">defun</font> CreateCircle<font color="#ff0000">(</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">command</font> <font color="#ff00ff">&quot;_.CIRCLE&quot; &quot;0,0,0&quot; &quot;30&quot;</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">)</font></span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">(</font><font color="#0000ff">defun</font> create-script<font color="#ff0000">(</font>scr dwgs lsp cmd save <font color="#0000ff">/</font> f dwg<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">setq</font> f <font color="#ff0000">(</font><font color="#0000ff">open</font> scr <font color="#ff00ff">&quot;w&quot;</font><font color="#ff0000">)</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">foreach</font> dwg dwgs</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">progn</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">write-line</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">strcat</font> <font color="#ff00ff">&quot;_.OPEN \&quot;&quot;</font> dwg <font color="#ff00ff">&quot;\&quot;&quot;</font><font color="#ff0000">)</font> f</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">write-line</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">strcat</font> <font color="#ff00ff">&quot;(load \&quot;&quot;</font> lsp <font color="#ff00ff">&quot;\&quot;)&quot;</font><font color="#ff0000">)</font> f</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">write-line</font> cmd f<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">if</font> save</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">write-line</font> <font color="#ff00ff">&quot;_.QSAVE&quot;</font> f<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; <font color="#ff0000">(</font><font color="#0000ff">write-line</font> <font color="#ff00ff">&quot;_.CLOSE&quot;</font> f<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">close</font> f<font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; <font color="#ff0000">(</font><font color="#0000ff">princ</font><font color="#ff0000">)</font></span></p>    <p style="margin: 0px"><span style="line-height: 140%"><font color="#ff0000">)</font></span></p> </div> <!--EndFragment-->  <p>The script handles the opening of each drawing, reloading the LISP file (which I have saved in c:/tmp.lsp – this file is pointed at by the lsp-name variable in the C:BATCH function) inside each one and running the specified command/function before saving &amp; closing. In this case we’re running a simple function that uses a command to create a circle – if we were doing something that didn’t require the drawing to be saved (if we were just querying data, for instance) we could pass nil instead of T into the (create-script) function.</p>  <p>To take a look at the script being used behind the scenes, you can simply comment out the call to (vl-file-delete) and open up the contents in your favourite text editor:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">_.OPEN &quot;C:/A.DWG&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(load &quot;c:/tmp.lsp&quot;)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(CreateCircle)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.QSAVE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.CLOSE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.OPEN &quot;C:/B.DWG&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(load &quot;c:/tmp.lsp&quot;)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(CreateCircle)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.QSAVE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.CLOSE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.OPEN &quot;C:/C.DWG&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(load &quot;c:/tmp.lsp&quot;)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(CreateCircle)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.QSAVE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.CLOSE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.OPEN &quot;C:/D.DWG&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(load &quot;c:/tmp.lsp&quot;)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">(CreateCircle)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.QSAVE</span></p>    <p style="margin: 0px"><span style="line-height: 140%">_.CLOSE</span></p> </div> <!--EndFragment-->  <p>I hope this approach goes some way towards helping people batch-process drawings from LISP without having to move to a different language. I’d really appreciate your feedback on this subject, as it would be good to get a more definitive approach nailed down before this change (eventually) becomes a requirement.</p>
