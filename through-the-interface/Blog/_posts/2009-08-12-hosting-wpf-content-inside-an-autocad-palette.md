---
layout: "post"
title: "Hosting WPF content inside an AutoCAD palette"
date: "2009-08-12 18:50:59"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "User interface"
  - "WPF"
original_url: "https://www.keanw.com/2009/08/hosting-wpf-content-inside-an-autocad-palette.html "
typepad_basename: "hosting-wpf-content-inside-an-autocad-palette"
typepad_status: "Publish"
---

<p>OK, OK: I know <a href="http://through-the-interface.typepad.com/through_the_interface/2009/08/knowing-when-an-autocad-object-is-grip-edited-using-overrules-in-net.html">I said I’d talk more about overrules</a>, last week, but – as is often the way, I’m afraid to say – I got distracted. The good news, though, is that I got distracted by something genuinely interesting, and well worth sharing.</p>  <p>I’ve been working on upgrading the WinForms user interface of an existing .NET application to use WPF, the Windows Presentation Foundation. For those wanting a thorough grounding in WPF, I recommend watching Fenton Webb’s highly-rated webcast series on WPF, just one of the interesting webcasts that can be downloaded and viewed from our <a href="http://www.adskconsulting.com/adn/cs/api_course_sched.php">API training schedule</a>:</p>  <p><a href="http://download.autodesk.com/media/adn/ACAD_Using_WPF_in_your_applications_02June2009.zip">AutoCAD: Using WPF in your Applications - Part 1</a> (28.9 Mb)</p>  <p><a href="http://download.autodesk.com/media/adn/ACAD_Using_WPF_in_your_applications_14July2009.zip">AutoCAD: Using WPF in your Applications - Part 2</a> (16.3 Mb)</p>  <p>In this post I’m going to walk through creating a simple WPF User Control which we can then host inside an AutoCAD PaletteSet.</p>  <p>Firstly we need to add a WPF User Control to our Visual Studio 2008 (or higher) project:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a4eab75b970b-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Adding a WPF User Control to our project" border="0" alt="Adding a WPF User Control to our project" src="/assets/image_1861.jpg" width="473" height="286" /></a> </p>  <p>We’ll accept the default name for the purposes of this project.</p>  <p>Now we should see our blank user-control hosted in both a designer window and a XAML editing pane:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a4eab76c970b-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Our empty WPF User Control" border="0" alt="Our empty WPF User Control" src="/assets/image_438622.jpg" width="467" height="417" /></a> </p>  <p>For the content of our user-control, I decided to take a static 2D image and apply some effects to it, inspired by <a href="http://www.codeflakes.net/blog/post/How-to-create-great-image-effects-with-WPFXAML.aspx">this page</a>, which also has a thorough explanation of the various effects applied (which saves me from doing the same :-).</p>  <p>You can copy &amp; paste this XAML into the editing pane:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;</span><span style="line-height: 140%; color: #a31515">UserControl</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">x:Class</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">WPF_Palette.UserControl1</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">xmlns</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">xmlns:x</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">Height</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">380</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Width</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">300</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;</span><span style="line-height: 140%; color: #a31515">StackPanel</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Background</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Gray</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">BorderBrush</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">OldLace</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">BorderThickness</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">10</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CornerRadius</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">10</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">HorizontalAlignment</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Center</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">VerticalAlignment</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Center</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Image</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Source</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">TTIF.png</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Width</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">200</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Height</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">200</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">Stretch</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Fill</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">x:Name</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">blogImage</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border.RenderTransform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">SkewTransform</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CenterX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">250</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CenterY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">AngleX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">AngleY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">350</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border.RenderTransform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Width</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">220</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Height</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">300</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">BorderThickness</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">10</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">CornerRadius</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">10</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">BorderBrush</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">OldLace</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border.Background</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">VisualBrush</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Visual</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">{Binding ElementName=blogImage}</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">VisualBrush.Transform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">ScaleTransform</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">ScaleX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">1</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">ScaleY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">-1</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">CenterX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">200</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CenterY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">150</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">VisualBrush.Transform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">VisualBrush</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border.Background</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border.OpacityMask</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">LinearGradientBrush</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">StartPoint</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0,0</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">EndPoint</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0,1</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">GradientStop</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Offset</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Color</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Black</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">GradientStop</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Offset</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0.3</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">Color</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">Transparent</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">LinearGradientBrush</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border.OpacityMask</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">Border.RenderTransform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">SkewTransform</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CenterX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">260</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">CenterY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">0</span><span style="line-height: 140%">&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">AngleX</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">40</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">AngleY</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">350</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border.RenderTransform</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">Border</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">StackPanel</span><span style="line-height: 140%; color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;/</span><span style="line-height: 140%; color: #a31515">UserControl</span><span style="line-height: 140%; color: blue">&gt;</span></p> </div> <!--EndFragment-->  <p>For this to work, I added a simple screenshot of this blog as an item in the project, calling it “TTIF.png”. I simply added it to the project via the Solution Explorer, using Add –&gt; Existing Item… no need to create a resource.</p>  <p>Now we should see our User Control has taken shape:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a541cd9b970c-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Our edited WPF User Control" border="0" alt="Our edited WPF User Control" src="/assets/image_634276.jpg" width="484" height="349" /></a> </p>  <p>Now it’s simply a matter of defining a command to create a PaletteSet to host our WPF content:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Windows;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Drawing;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Windows.Forms;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System.Windows.Forms.Integration;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> WPF_Palette</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PaletteSet</span><span style="line-height: 140%"> _ps = </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;WPFP&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> ShowWPFPalette()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (_ps == </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Create the palette set</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; _ps = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PaletteSet</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;WPF Palette&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; _ps.Size = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Size</span><span style="line-height: 140%">(400, 600);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; _ps.DockEnabled =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (</span><span style="line-height: 140%; color: #2b91af">DockSides</span><span style="line-height: 140%">)((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DockSides</span><span style="line-height: 140%">.Left + (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DockSides</span><span style="line-height: 140%">.Right);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Create our first user control instance and</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// host it on a palette using AddVisual()</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">UserControl1</span><span style="line-height: 140%"> uc = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">UserControl1</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; _ps.AddVisual(</span><span style="line-height: 140%; color: #a31515">&quot;AddVisual&quot;</span><span style="line-height: 140%">, uc);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Create our second user control instance and</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// host it in an ElementHost, which allows</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// interop between WinForms and WPF</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">UserControl1</span><span style="line-height: 140%"> uc2 = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">UserControl1</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">ElementHost</span><span style="line-height: 140%"> host = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ElementHost</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; host.AutoSize = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; host.Dock = </span><span style="line-height: 140%; color: #2b91af">DockStyle</span><span style="line-height: 140%">.Fill;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; host.Child = uc2;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; _ps.Add(</span><span style="line-height: 140%; color: #a31515">&quot;Add ElementHost&quot;</span><span style="line-height: 140%">, host);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// Display our palette set</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; _ps.KeepFocus = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; _ps.Visible = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div> <!--EndFragment-->  <p>For the application to build you’ll need to add project references to the .NET assemblies System.Drawing and WindowsFormsIntegration (in addition to the usual AcMgd.dll and AcDbMgd.dll, of course).</p>  <p>The above code deliberately adds two instances of our control into the PaletteSet, to show the different techniques for doing so:</p>  <ol>   <li>The first uses the new (to AutoCAD 2010) AddVisual() method to add in our WPF User Control into a Palette      <ul>       <li>This works, but doesn’t dock the control inside the palette (something I hope to see addressed in the future – as it stands this isn’t particularly useful) </li>     </ul>   </li>    <li>The second uses an <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.integration.elementhost.aspx">ElementHost</a> to host our WPF User Control – essentially hosting our WPF control in one that works with a WinForms UI. We then use the standard Add() method to add it, as <a href="http://through-the-interface.typepad.com/through_the_interface/2007/07/using-a-palette.html">we have done in the past</a> </li> </ol>  <p>Now the application should build. When we NETLOAD it into AutoCAD and run the WPFP command, we should see our docked palette set with the first tab visible:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a4eab78b970b-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Our first WPF Palette inside AutoCAD" border="0" alt="Our first WPF Palette inside AutoCAD" src="/assets/image_164210.jpg" width="469" height="398" /></a> </p>  <p>We can see that this tab hosts our control, but it doesn’t fill the palette.</p>  <p>If we select the second tab, we see things are better, there:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20120a541cdca970c-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Our second WPF Palette inside AutoCAD" border="0" alt="Our second WPF Palette inside AutoCAD" src="/assets/image_439408.jpg" width="466" height="395" /></a> </p>  <p>If you undock the palette set you can see more easily the way the control is hosted by each palette.</p>  <p>I’m still on the steep part of the learning curve with respect to WPF (and expect I’ll be there for some time), but so far I’m really impressed with its capabilities, especially around binding a user-interface’s properties to the data it hosts. I’ll be sharing more of my findings related to WPF in due course.</p>
