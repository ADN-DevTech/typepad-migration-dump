---
layout: "post"
title: "A new release of Refinery with tighter Revit integration and output constraints"
date: "2019-09-10 11:26:27"
author: "Kean Walmsley"
categories:
  - "Autodesk Research"
  - "Dynamo"
  - "Generative design"
original_url: "https://www.keanw.com/2019/09/a-new-release-of-refinery-with-tighter-revit-integration-and-output-constraints.html "
typepad_basename: "a-new-release-of-refinery-with-tighter-revit-integration-and-output-constraints"
typepad_status: "Publish"
---

<p>A big – and welcome – update has just been dropped by the Refinery team. I’ve been waiting for this one, in particular, as I expected it to work better with <a href="http://autode.sk/mars-graph" target="_blank">the MaRS graph</a>. (I’m happy to say that it does – more on this later.)</p><p>The big ticket item in the v0.35.0 (still Beta) release is an integration with Revit that doesn’t require users to open Dynamo. It’s at this point that you can probably hear a collective “say what?!?” from existing Refinery users (such as myself, I might add): until now you’ve been very exposed to Dynamo when using Refinery. You will clearly still need to use Dynamo to create the graph to be used for Refinery studies: the good news is that people using Refinery to run studies won’t necessarily be exposed to the graph’s complexity.</p><p>A number of changes have been needed to support this workflow, of course: firstly, Revit needs to be able to load and run a Dynamo graph, making sure all its dependencies are loaded. Secondly, Revit needs to be able to have Refinery present the user with a UI that’s independent from Dynamo.</p><p>Using a Dynamo graph in Refinery now requires that it be published on that system using the Refinery menu’s “Export for Refinery…” command.</p><p>If you haven’t performed this step, when you launch a New Study from inside Refinery, you’re going to only see some standard graphs in your list.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a481c809200c-pi" target="_blank"><img width="500" height="422" title="Creating a new study in Refinery" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Creating a new study in Refinery" src="/assets/image_20307.jpg" border="0"></a></p><p>In order to use “Export for Refinery…”, you need to have run your graph inside Dynamo.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a481c80d200c-pi" target="_blank"><img width="500" height="321" title="First you need to run the graph" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="First you need to run the graph" src="/assets/image_545974.jpg" border="0"></a></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4cfa8a8200b-pi" target="_blank"><img width="500" height="323" title="Export for Refinery" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Export for Refinery" src="/assets/image_460375.jpg" border="0"></a></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4ab0f12200d-pi" target="_blank"><img width="500" height="323" title="Export complete" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Export complete" src="/assets/image_84156.jpg" border="0"></a></p><p>Once exported, the graph will now be available on your system.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4ab0f16200d-pi" target="_blank"><img width="500" height="454" title="We have our graph in the list" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="We have our graph in the list" src="/assets/image_459745.jpg" border="0"></a></p><p>To understand what has happened during the export process, you can open up <em>“%userprofile%\Documents\Refinery</em>” and see that it contains a copy of your exported graph, plus <em>.Dependencies</em> and <em>.RefineryResults</em> folders.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a481c812200c-pi" target="_blank"><img width="229" height="211" title="The Refinery folder under a user's documents" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The Refinery folder under a user's documents" src="/assets/image_751707.jpg" border="0"></a></p><p>This means that the graphs, their dependencies and results are all now stored in a central location for that user. Hence the need for me to <a href="https://www.keanw.com/2019/09/ramping-up-for-autodesk-university-2019.html" target="_blank">update Capturefinery</a> to also check this location when compiling a list of studies that it can capture graphics for.</p><p>Revit users can now launch Refinery directly from the product, via the Add-ins tab:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4ab25df200d-pi"><img width="500" height="132" title="Refinery from Revit" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Refinery from Revit" src="/assets/image_615389.jpg" border="0"></a></p><p>When creating a new Refinery study – whether from Dynamo Sandbox or directly from Revit – you will see the enhanced create study UI.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4cfa8b0200b-pi" target="_blank"><img width="500" height="434" title="New study UI" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="New study UI" src="/assets/image_989026.jpg" border="0"></a></p><p>The main change – other than the streamlining, plus the ability to drive the UI without Dynamo around – is that you can now constrain outputs, should you so choose. This is particularly beneficial if you already know you want to focus on a known subset of the solution space.</p><p>Another side-effect of having the graphs and their results centralised, is that you can see them all – or filter on specific models – inside Refinery’s Studies list. Which is much easier than digging around in specific models. One downside of this change is presumably related to accessing previous studies: I don’t believe the new version displays runs created with older versions. I could be wrong, though: maybe it’s possible to manually migrate studies across into the central location? I’ll try to get clarification from the Refinery team on this.</p><p>Beyond that this release is much more stable when performing larger runs; it’s more tolerant of complex, resource-consuming (and potentially problematic or invalid) graphs. For instance, until now it’s been hard for me to run large studies of <a href="https://www.keanw.com/2019/06/project-rediscover-is-now-available-for-download.html" target="_blank">the MaRS graph</a> inside Refinery, but this release fixes that.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a481ddba200c-pi"><img width="550" height="344" title="Refining MaRS" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Refining MaRS" src="/assets/image_823880.jpg" border="0"></a></p><p>I had a system crash during this largeish study – I’ve been having some serious instability with my Windows 10 system that I’ve spent too much time over the last week trying to fix – but when the system rebooted Refinery was able to continue and complete the study (woohoo!).</p><p>I’m now ready to create some even bigger studies with some alternative daylighting options – something I’ll blog about soon.</p>
