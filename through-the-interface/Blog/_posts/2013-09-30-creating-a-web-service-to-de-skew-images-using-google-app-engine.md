---
layout: "post"
title: "Creating a web-service to de-skew images using Google App Engine"
date: "2013-09-30 19:23:37"
author: "Kean Walmsley"
categories:
  - "Concurrent programming"
  - "HTML"
  - "PaaS"
  - "SaaS"
original_url: "https://www.keanw.com/2013/09/creating-a-web-service-to-de-skew-images-using-google-app-engine.html "
typepad_basename: "creating-a-web-service-to-de-skew-images-using-google-app-engine"
typepad_status: "Publish"
---

<p>As promised, I’m going to spend some time this week looking at options for moving the Python code we’ve <a href="http://through-the-interface.typepad.com/through_the_interface/2013/08/applications-for-linear-algebra-straightening-out-perspective.html" target="_blank">seen</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/08/update-on-the-project-to-de-skew-images-inside-autocad.html" target="_blank">in</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/08/generating-png-files-for-de-skewed-portions-of-perspective-images.html" target="_blank">this</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/09/moving-pure-python-code-into-ironpython.html" target="_blank">series</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/09/executing-python-code-to-de-skew-images-inside-autocad-using-ironpython.html" target="_blank">of</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/09/selecting-an-area-of-a-perspective-image-to-de-skew-inside-autocad-using-html5-and-javascript.html" target="_blank">posts</a> – that de-skews perspective images using CPython or IronPython code running on your desktop – to “the cloud”. Which in this case I’m taking to mean Google App Engine (GAE), as it has native Python support and I hadn’t done anything with it, before. :-)</p>
<p>As a first step – and I should probably say “at first glance” – it’s really quite easy to take some existing Python code and host it behind a web-service in GAE. Here’s some code that does just this for the Python core we’ve been working with:</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> os</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> urllib</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> webapp2</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> cgi</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">from</span><span style="line-height: 140%;"> deskew </span><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> *</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">from</span><span style="line-height: 140%;"> image </span><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> image2writer</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">from</span><span style="line-height: 140%;"> google</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">appengine</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">ext </span><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> blobstore</span></p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">from</span><span style="line-height: 140%;"> google</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">appengine</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">ext</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">webapp </span><span style="line-height: 140%; color: blue;">import</span><span style="line-height: 140%;"> blobstore_handlers</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> MainHandler(webapp2</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">RequestHandler):</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">def</span><span style="line-height: 140%;"> get(self):</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; upload_url = blobstore</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">create_upload_url(</span><span style="line-height: 140%; color: #a31515;">&#39;/upload&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro = self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">response</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">out</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;html&gt;&lt;body&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&#39;&lt;form action=&quot;%s&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;&#39;</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160; % upload_url)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Upload File:&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Top left: &#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;xtl&quot; value=&quot;82&quot;&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;ytl&quot; value=&quot;73&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Bottom left: &#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;xbl&quot; value=&quot;81&quot;&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;ybl&quot; value=&quot;103&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Top right: &#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;xtr&quot; value=&quot;105&quot;&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;ytr&quot; value=&quot;69&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Bottom right: &#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;xbr&quot; value=&quot;105&quot;&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;ybr&quot; value=&quot;102&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;Width over height: &#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;number&quot; name=&quot;fac&quot; step=&quot;0.1&quot; value=&quot;1.0&quot;&gt;&lt;br/&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot;&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; sro</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">write(</span><span style="line-height: 140%; color: #a31515;">&#39;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> UploadHandler(blobstore_handlers</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">BlobstoreUploadHandler):</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">def</span><span style="line-height: 140%;"> post(self):</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;"># Get the posted PNG file in the variable img1</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; upload_files = self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get_uploads(</span><span style="line-height: 140%; color: #a31515;">&#39;file&#39;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; blob_info = upload_files[0]</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; blob_reader = blobstore</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">BlobReader(blob_info)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; img1 = blob_reader</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">read()</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; blob_reader</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">close()</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;"># Get the various coordinate inputs and the width factor</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; xtl = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;xtl&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; ytl = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;ytl&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; xbl = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;xbl&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; ybl = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;ybl&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; xtr = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;xtr&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; ytr = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;ytr&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; xbr = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;xbr&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; ybr = int(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;ybr&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; fac = float(cgi</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">escape(self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">request</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">get(</span><span style="line-height: 140%; color: #a31515;">&#39;fac&#39;</span><span style="line-height: 140%;">)))</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;"># Run the in-memory deskew code on our image</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; img2 = deskew_image(img1, (xtl,ytl), (xbl,ybl),</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (xtr,ytr), (xbr,ybr), fac)</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;"># Write back out the resulting image</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">response</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">headers[</span><span style="line-height: 140%; color: #a31515;">&#39;Content-Type&#39;</span><span style="line-height: 140%;">] = </span><span style="line-height: 140%; color: #a31515;">&quot;image/png&quot;</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; image</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">image2writer(img2, self</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">response</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">out)</span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;"><span style="line-height: 140%;">app = webapp2</span><span style="line-height: 140%; color: blue;">.</span><span style="line-height: 140%;">WSGIApplication(</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #a31515;">&#39;/&#39;</span><span style="line-height: 140%;">, MainHandler),</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #a31515;">&#39;/upload&#39;</span><span style="line-height: 140%;">, UploadHandler)</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; ],</span></p>
<p style="margin: 0px;"><span style="line-height: 140%;">&#0160;&#0160;&#0160; debug=True)</span></p>
</div>
<p>Too easy! A little bit of code that presents a simple UI to the user (that I’ve lazily pre-populated with values that work for a particular test image) and then takes the provided data and uses it to call into our Python core.</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2019affb1b58f970b-pi" target="_blank"><img alt="Our basic HTML upload UI" border="0" height="309" src="/assets/image_228294.jpg" style="background-image: none; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; padding-top: 0px; border: 0px;" title="Our basic HTML upload UI" width="340" /></a>It works well enough on your local system: you click upload and eventually the de-skewed portion of your image gets served up in your browser. On your local system this works well for small and – to some degree – larger images, too, although when I say “larger” I’m still talking about nothing larger than 1K pixels on a side.</p>
<p>But when you deploy this to the cloud – using the Google App Launcher that comes with <a href="https://developers.google.com/appengine/downloads" target="_blank">the Google App Engine SDK</a> – then it really only works with smaller (and I mean tiny) images. Beyond that you quickly get an error reported in the browser:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2019affb257b0970d-pi" target="_blank"><img alt="Oh dear" border="0" height="140" src="/assets/image_771149.jpg" style="background-image: none; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; padding-top: 0px; border: 0px;" title="Oh dear" width="390" /></a></p>
<p>Looking into the log behind the web-site (we can’t really call it a web-service until we put some appropriate endpoints in place), we can quickly see where the issue lies:</p>
<blockquote>
<p><em>Exceeded soft private memory limit with 155.402 MB after servicing 2 requests total</em></p>
<p><em>While handling this request, the process that handled this request was found to be using too much memory and was terminated. This is likely to cause a new process to be used for the next request to your application. If you see this message frequently, you may have a memory leak in your application.</em></p>
<p>&#0160;</p>
<p>&#0160;</p>
</blockquote>
<p>The soft private memory limit on in GAE is pretty low for frontend instances – these are really intended to service web requests and aren’t meant to do any heavy lifting – so one option is to go down the path of employing <a href="https://developers.google.com/appengine/docs/python/backends" target="_blank">backend instances</a> that have more memory and horsepower. As part of GAE’s free daily quota you get 9 hours of backend instance uptime, which is presumably adequate for a small site. But backend instances don’t scale automatically, which seems to me one of the important features of GAE (from the admittedly small amount of time I’ve spent looking at it).</p>
<p>Which is one of the reasons that I’ve decided to spend some time reworking the implementation to work with Google’s famous (and apparently patented) <a href="http://en.wikipedia.org/wiki/MapReduce" target="_blank">MapReduce</a> algorithm. We’ll go into this in more depth in the next post, but in a nutshell MapReduce is about mapping lots of little processing cores to work on small parts of a problem in parallel, with the results getting shuffled and sorted and then reduced into the results you’re looking for.</p>
<p>In our case we’ll probably plug together a couple of MapReduce pipelines: one to take the initial image data and transform it to the desired coordinate system, and one to generate the output image. But that’s for the next post in this series…</p>
