---
layout: "post"
title: "Passing AutoCAD objects to commands called via .NET"
date: "2015-08-05 18:03:17"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Commands"
  - "Runtime"
  - "Selection"
original_url: "https://www.keanw.com/2015/08/passing-autocad-objects-to-commands-called-via-net.html "
typepad_basename: "passing-autocad-objects-to-commands-called-via-net"
typepad_status: "Publish"
---

<p>This question came in as <a href="http://through-the-interface.typepad.com/through_the_interface/2014/03/autocad-2015-calling-commands.html#comment-2173357861" target="_blank">a blog comment</a> on <a href="http://through-the-interface.typepad.com/through_the_interface/2014/03/autocad-2015-calling-commands.html" target="_blank">this previous post</a>:</p>  <blockquote>   <p>Is possible to use Revision Cloud in this situation? Example: Creating a polyline/circle/ellipse then make it a revision cloud.</p> </blockquote>  <p>It seemed to make sense to broaden the topic for the purposes of this blog post: how to pass an entity or entities to an AutoCAD command called via Editor.Command() or CommandAsync().</p>  <p>Since <a href="http://through-the-interface.typepad.com/through_the_interface/2014/03/autocad-2015-calling-commands.html" target="_blank">Editor.Command() was implemented in AutoCAD 2015</a>, I’ve been a fan of the calling commands in AutoCAD application code. But I haven’t actually covered the approach needed to send object information to commands via this function. Yes, you can always use the “_LAST” keyword during entity selection, but how else can it be done?</p>  <p>Here’s some C# code that shows how to use the SelectionSet object to send one or more entities to a command:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.ApplicationServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.DatabaseServices;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.EditorInput;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Geometry;</p>    <p style="margin: 0px"><span style="color: blue">using</span> Autodesk.AutoCAD.Runtime;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">namespace</span> CallingCommands</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Commands</span></p>    <p style="margin: 0px">&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;CB&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> CreateBlock()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ids = <span style="color: blue">new</span> <span style="color: #2b91af">ObjectIdCollection</span>();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create the geometry for our block using the AutoCAD .NET API</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tr = db.TransactionManager.StartTransaction())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ms =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">SymbolUtilityServices</span>.GetBlockModelSpaceId(db),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForWrite</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ) <span style="color: blue">as</span> <span style="color: #2b91af">BlockTableRecord</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ms != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// We'll have two diagonal lines with a circle</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ln1 = <span style="color: blue">new</span> <span style="color: #2b91af">Line</span>(<span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(0, 0, 0), <span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(10, 10, 0));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ln2 = <span style="color: blue">new</span> <span style="color: #2b91af">Line</span>(<span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(0, 10, 0), <span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(10, 0, 0));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> c = <span style="color: blue">new</span> <span style="color: #2b91af">Circle</span>(<span style="color: blue">new</span> <span style="color: #2b91af">Point3d</span>(5, 5, 0), <span style="color: #2b91af">Vector3d</span>.ZAxis, 5);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ids.Add(ms.AppendEntity(ln1));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ids.Add(ms.AppendEntity(ln2));</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ids.Add(ms.AppendEntity(c));</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(ln1, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(ln2, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(c, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Add the ObjectIds of our geometry to a SelectionSet</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ida = <span style="color: blue">new</span> <span style="color: #2b91af">ObjectId</span>[ids.Count];</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ids.CopyTo(ida, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ss = <span style="color: #2b91af">SelectionSet</span>.FromObjectIds(ida);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create the block and insert it using standard commands</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.-BLOCK&quot;</span>, <span style="color: #a31515">&quot;TEST&quot;</span>, <span style="color: #a31515">&quot;0,0&quot;</span>, ss, <span style="color: #a31515">&quot;&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.-INSERT&quot;</span>, <span style="color: #a31515">&quot;TEST&quot;</span>, <span style="color: #a31515">&quot;0,0&quot;</span>, 1, 1, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; [<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;RC&quot;</span>)]</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> RevCloud()</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> doc = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (doc == <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> db = doc.Database;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ed = doc.Editor;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: blue">using</span> (<span style="color: blue">var</span> tr = db.TransactionManager.StartTransaction())</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ms =</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.GetObject(</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">SymbolUtilityServices</span>.GetBlockModelSpaceId(db),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForWrite</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ) <span style="color: blue">as</span> <span style="color: #2b91af">BlockTableRecord</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (ms != <span style="color: blue">null</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create our polyline boundary</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> pl = <span style="color: blue">new</span> <span style="color: #2b91af">Polyline</span>();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pl.AddVertexAt(0, <span style="color: blue">new</span> <span style="color: #2b91af">Point2d</span>(0, 0), 0, 0, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pl.AddVertexAt(1, <span style="color: blue">new</span> <span style="color: #2b91af">Point2d</span>(10, 0), 0, 0, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pl.AddVertexAt(2, <span style="color: blue">new</span> <span style="color: #2b91af">Point2d</span>(10, 10), 0, 0, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pl.AddVertexAt(3, <span style="color: blue">new</span> <span style="color: #2b91af">Point2d</span>(0, 10), 0, 0, 0);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pl.Closed = <span style="color: blue">true</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Add it to the drawing</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> id = ms.AppendEntity(pl);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.AddNewlyCreatedDBObject(pl, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Create a SelectionSet and use it to call the REVCLOUD command</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> ss = <span style="color: #2b91af">SelectionSet</span>.FromObjectIds(<span style="color: blue">new</span> <span style="color: #2b91af">ObjectId</span>[] { id });</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.Command(<span style="color: #a31515">&quot;_.REVCLOUD&quot;</span>, <span style="color: #a31515">&quot;&quot;</span>, ss, <span style="color: #a31515">&quot;&quot;</span>);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p> </div>  <p>The first command, CB, creates a block of three pieces of geometry and then inserts it in the drawing. The geometry is created using .NET and the block is created and inserted using the BLOCK and INSERT commands. We could, of course, use the .NET API to define and insert the block, too: the point is that you can use a SelectionSet object to pass sets of objects – irrespective of how they have been created – to standard commands, as needed.</p>  <p>The second command, RC, creates a revision cloud from a polyline. This shows using a SelectionSet of a single object to respond to an Editor.GetEntity() or (entsel) prompt (i.e. one that asks for one entity rather than a set of multiple entities). In this case we’re calling the REVCLOUD command right there inside the transaction, basically to show that it doesn’t really matter where we call the command as long as the passed entities are already database-resident. Which they must be to have an ObjectId, of course.</p>  <p>Here are the two commands in action:</p>  <p align="center"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201bb085e8017970d-pi" target="_blank"><img title="Calling commands" style="margin: 50px 0px; display: inline" alt="Calling commands" src="/assets/image_346209.jpg" width="380" height="380" /></a></p>  <p>Finally, here’s a quick shout out to one of our <a href="http://www.autodesk.com/expert-elite/about" target="_blank">Expert Elites</a>, <a href="http://forums.autodesk.com/t5/user/viewprofilepage/user-id/109424" target="_blank">Gilles Chanteau</a>, for all his help on both the Autodesk forums and The Swamp. I’m always very impressed by the quality of answers Gilles provides to people, and posts such as <a href="http://forums.autodesk.com/t5/net/how-to-pass-objectidcollection-into-built-in-rotate-command/td-p/5428701" target="_blank">this one</a> will no doubt have been a great help to people already searching for this information. Keep it up, Gilles!</p>
