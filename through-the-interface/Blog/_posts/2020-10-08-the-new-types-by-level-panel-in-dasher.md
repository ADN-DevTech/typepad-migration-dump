---
layout: "post"
title: "The new Types By Level panel in Project Dasher"
date: "2020-10-08 11:42:11"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
  - "MX3D"
original_url: "https://www.keanw.com/2020/10/the-new-types-by-level-panel-in-dasher.html "
typepad_basename: "the-new-types-by-level-panel-in-dasher"
typepad_status: "Publish"
---

<p>Over the last month or so we’ve been focused on the benefits brought to <a href="https://dasher360.com" target="_blank">Project Dasher</a> by combining 2D heatmaps with our traditionally 3D view of the world.</p><p>We started by <a href="https://www.keanw.com/2020/08/displaying-a-2d-heatmap-when-surface-shading-inside-dasher.html" target="_blank">creating 2D heatmaps</a>, <a href="https://www.keanw.com/2020/08/creating-a-resizable-square-panel-inside-the-forge-viewer.html" target="_blank">making them resizable</a>, <a href="https://www.keanw.com/2020/09/viewing-multiple-heatmaps-inside-project-dasher.html" target="_blank">adding lots of them</a> inside Dasher, and then <a href="https://www.keanw.com/2020/09/pinning-2d-heatmaps-per-level-in-project-dasher.html" target="_blank">making them pinnable per-level</a>, before introducing the idea of <a href="https://www.keanw.com/2020/09/adding-building-systems-to-dashers-2d-heatmaps.html" target="_blank">overlaying building systems information</a>, too. Most recently we took <a href="https://www.keanw.com/2020/10/a-sneak-peek-at-dashers-new-types-by-level-ui.html" target="_blank">a sneak peek at the topic of today’s post</a>, a new UI that simplifies access to these 2D (and 3D) heatmaps.</p><p>The idea came up during a team meeting: as we realised we had this combinatorial explosion between levels of a building and the sensor types available for surface shading – and that it was cumbersome to find the combination you wanted via multiple dropdowns – the suggestion was made to visualise these combinations graphically via some kind of stacked card UI. My friend and colleague Mike Lee had done some prototyping for a different project that used THREE.js to display a series of images as stacked cards: he kindly shared his code with me, which certainly made building out this UI much simpler.</p><p>Here’s a screenshot of Mike’s prototype:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026be4188890200d-pi" target="_blank"><img width="500" height="290" title="Stacked heatmaps in THREE.js" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Stacked heatmaps in THREE.js" src="/assets/image_281555.jpg" border="0"></a></p><p>I had to find a way to render heatmaps for each sensor type/level combination to an image that could then be navigated through as a stack. A few things are worth mentioning about this implementation:</p><ul><li>For navigating the stack I had to find and integrate the appropriate version of the OrbitControls component for THREE.js r71.</li><li>I wanted to have the textures display building information, too.</li><ul><li>Two sets of textures might therefore be needed (if the user setting to display these layers gets toggled on).</li></ul><li>When I started this journey I was creating WebGLRenderer objects for each panel.</li><ul><li>Chrome only has 16 WebGL context’s available, so it’s really easy to hit this limit.</li><li>I ended up refactoring Dasher to share a single WebGLRenderer for all our off-screen rendering.</li></ul><li>To support double-click (to open a heatmap) as well as to integrate tooltips, quite a lot of work was needed.</li><ul><li>The biggest challenge I hit related to transparent sections of the textures (or which we have quite a lot).</li><ul><li>Clicking on a transparent area inevitably brought up the wrong heatmap from a user’s perspective.</li></ul><li>I started down the path of raycasting into the scene.</li><ul><li>Once you get the intersection point of an individual texture, you should be able to look up into the source image.</li><li>The intersection code in r71 doesn’t provide the UV of an intersection with a texture!</li><ul><li>I ported a more recent version of the code into Dasher, which was quite a lot of work.</li><li>Everything was working properly, but I then decided to drop this approach…</li></ul></ul><li>Next I implemented a reference image for the Types By Level panel.</li><ul><li>This is the approach we use for sensor dot hovering.</li><li>We render a data texture with the level and type information for each pixel.</li><li>Rather than raycasting on each mouse movement, we can do a simple X-Y pixel lookup.</li><li>We just need to render the texture on zoom, orbit or resize of the panel.</li></ul></ul></ul><p>I’m very happy with how the feature has turned out, but it certainly wasn’t an easy one to implement.</p><p>Here’s how the overall navigation – which includes zoom and pan, as well as on-hover tooltips – works.</p><p><br></p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bde99add8200c-pi" target="_blank"><img width="264" height="500" title="Types by Level demo" style="margin: 30px auto; float: none; display: block;" alt="Types by Level demo" src="/assets/image_242169.jpg"></a></p><p>This panel appears (assuming it’s enabled in the user settings), when you launch the Surface Shading feature.</p><p>When you double-click the sensor type/level combination that interests you, the level will be navigated to in the 3D view, and the 2D heatmap for that combination will be displayed/pinned.</p><p>You can double-click a number of different options – to display them at the same time – and then select the final 3D heatmap to display by double-clicking the 2D heatmap that’s of interest. So this creates a simple (and hopefully compelling) way to choose between the various options available.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026be4188a0c200d-pi" target="_blank"><img width="500" height="312" title="Types By Level in NEST" style="margin: 30px auto; float: none; display: block;" alt="Types By Level in NEST" src="/assets/image_19082.jpg"></a></p><p>It also works for “level-less” models, although it’s at this point only really compelling if you have a certain number of sensor types available for surface shading:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e96c55b7200b-pi" target="_blank"><img width="500" height="312" title="Types By Level in MX3D" style="margin: 30px auto; float: none; display: block;" alt="Types By Level in MX3D" src="/assets/image_587837.jpg"></a></p><p>I think this UI has a lot of potential for simplifying navigation and simultaneous display of various heatmaps, which is of great interest when correlating multiple data streams.</p><p>I’ll be talking about this more during my upcoming AU 2020 class (entitled “<em>Lessons from Project Dasher: Building a Digital Twin Using Forge</em>”), in case you’re interested in learning more about it.</p>
