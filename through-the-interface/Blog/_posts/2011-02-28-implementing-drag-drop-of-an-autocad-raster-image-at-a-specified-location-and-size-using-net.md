---
layout: "post"
title: "Implementing drag &amp; drop of an AutoCAD raster image at a specified location and size using .NET"
date: "2011-02-28 09:05:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "User interface"
original_url: "https://www.keanw.com/2011/02/implementing-drag-drop-of-an-autocad-raster-image-at-a-specified-location-and-size-using-net.html "
typepad_basename: "implementing-drag-drop-of-an-autocad-raster-image-at-a-specified-location-and-size-using-net"
typepad_status: "Publish"
---

<p>I’m in Las Vegas, running between meetings, presentations and performance reviews, so just a quick post, today (it’s just before midnight here, but already Monday morning in Europe).</p>
<p>I promised in <a href="http://through-the-interface.typepad.com/through_the_interface/2011/02/implementing-drag-drop-at-a-specific-location-in-autocad-using-net.html" target="_blank">the last post</a> and <a href="http://through-the-interface.typepad.com/through_the_interface/2011/02/managing-drag-drop-from-a-palette-into-autocad-using-net.html" target="_blank">the one before</a> that I’d extend the code we’ve been looking at to enable drag &amp; drop of raster images into AutoCAD with resizing of the dropped image via a jig, using the code in <a href="http://through-the-interface.typepad.com/through_the_interface/2010/08/jigging-an-upright-square-autocad-raster-image-using-net.html" target="_blank">this previous post</a> as a foundation.</p>
<p>The below C# code does just that, with the new/modified lines in <span style="color: #ff0000;">red</span> (and <a href="http://through-the-interface.typepad.com/files/drag-drop-at-location-with-resize.cs" target="_blank">the complete, unnumbered source file here</a>):</p>
<div style="font-family: courier new; background: white; color: black; font-size: 8pt;">
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 1</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.ApplicationServices;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 2</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.DatabaseServices;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 3</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.EditorInput;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 4</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.Geometry;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 5</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.Runtime;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 6</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.Windows;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 7</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Runtime.InteropServices;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 8</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Windows.Forms;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160;&#0160; 9</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.Drawing;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 10</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System.IO;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 11</span>&#0160;<span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> System;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 12</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 13</span>&#0160;<span style="line-height: 140%; color: blue;">namespace</span><span style="line-height: 140%;"> DragAndDrop</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 14</span>&#0160;<span style="line-height: 140%;">{</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 15</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">enum</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Msgs</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 16</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 17</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; WM_DRAWCLIPBOARD = 0x0308,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 18</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; WM_CHANGECBCHAIN = 0x030D</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 19</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 20</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 21</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">ClipboardView</span><span style="line-height: 140%;"> : </span><span style="line-height: 140%; color: #2b91af;">UserControl</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 22</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 23</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af;">DllImport</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;user32.dll&quot;</span><span style="line-height: 140%;">)]</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 24</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">extern</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> SetClipboardViewer(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 25</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> hWndNewViewer</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 26</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 27</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 28</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af;">DllImport</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;user32.dll&quot;</span><span style="line-height: 140%;">, CharSet = </span><span style="line-height: 140%; color: #2b91af;">CharSet</span><span style="line-height: 140%;">.Auto)]</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 29</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">extern</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> SendMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 30</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> hWnd, </span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;"> Msg, </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> wParam, </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> lParam</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 31</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 32</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 33</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">IntPtr</span><span style="line-height: 140%;"> _nxtVwr;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 34</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PictureBox</span><span style="line-height: 140%;"> _img;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 35</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PaletteSet</span><span style="line-height: 140%;"> _ps;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 36</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 37</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> System.Drawing.</span><span style="line-height: 140%; color: #2b91af;">Image</span><span style="line-height: 140%;"> Contents</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 38</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 39</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">get</span><span style="line-height: 140%;"> { </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> _img.Image; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 40</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 41</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 42</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> ClipboardView(</span><span style="line-height: 140%; color: #2b91af;">PaletteSet</span><span style="line-height: 140%;"> ps)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 43</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 44</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PictureBox</span><span style="line-height: 140%;">();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 45</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img.Anchor =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 46</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">AnchorStyles</span><span style="line-height: 140%;">)(</span><span style="line-height: 140%; color: #2b91af;">AnchorStyles</span><span style="line-height: 140%;">.Top |</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 47</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">AnchorStyles</span><span style="line-height: 140%;">.Bottom |</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 48</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">AnchorStyles</span><span style="line-height: 140%;">.Left |</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 49</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">AnchorStyles</span><span style="line-height: 140%;">.Right);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 50</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img.Location = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Point</span><span style="line-height: 140%;">(0, 0);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 51</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img.Size = </span><span style="line-height: 140%; color: blue;">this</span><span style="line-height: 140%;">.Size;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 52</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img.SizeMode = </span><span style="line-height: 140%; color: #2b91af;">PictureBoxSizeMode</span><span style="line-height: 140%;">.StretchImage;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 53</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; Controls.Add(_img);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 54</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 55</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Add our event handler to launch a new drag event</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 56</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// when someone clicks on the control</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 57</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 58</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _img.MouseDown +=</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 59</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">delegate</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: blue;">object</span><span style="line-height: 140%;"> sender, </span><span style="line-height: 140%; color: #2b91af;">MouseEventArgs</span><span style="line-height: 140%;"> e)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 60</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 61</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Simply initiate the drag &amp; drop in AutoCAD,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 62</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// specifying an instance of our custom &quot;drop</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 63</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// target&quot; class</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 64</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 65</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Autodesk.AutoCAD.ApplicationServices.</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 66</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Application</span><span style="line-height: 140%;">.DoDragDrop(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 67</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _img, </span><span style="line-height: 140%; color: blue;">this</span><span style="line-height: 140%;">.Contents, </span><span style="line-height: 140%; color: #2b91af;">DragDropEffects</span><span style="line-height: 140%;">.Copy,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 68</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">MyDropTarget</span><span style="line-height: 140%;">()</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 69</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 70</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; };</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 71</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 72</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _nxtVwr = SetClipboardViewer(</span><span style="line-height: 140%; color: blue;">this</span><span style="line-height: 140%;">.Handle);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 73</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _ps = ps;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 74</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 75</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 76</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> ExtractImage()</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 77</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 78</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">IDataObject</span><span style="line-height: 140%;"> iData;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 79</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">try</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 80</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 81</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; iData = </span><span style="line-height: 140%; color: #2b91af;">Clipboard</span><span style="line-height: 140%;">.GetDataObject();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 82</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 83</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">catch</span><span style="line-height: 140%;"> (System.</span><span style="line-height: 140%; color: #2b91af;">Exception</span><span style="line-height: 140%;"> ex)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 84</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 85</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">MessageBox</span><span style="line-height: 140%;">.Show(ex.ToString());</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 86</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 87</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 88</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 89</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (iData.GetDataPresent(</span><span style="line-height: 140%; color: #a31515;">&quot;Bitmap&quot;</span><span style="line-height: 140%;">))</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 90</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 91</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">object</span><span style="line-height: 140%;"> o = iData.GetData(</span><span style="line-height: 140%; color: #a31515;">&quot;Bitmap&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 92</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Bitmap</span><span style="line-height: 140%;"> b = o </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Bitmap</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 93</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (b != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 94</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 95</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _img.Image = b;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 96</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (_ps != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 97</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 98</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps.Size =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160;&#0160; 99</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Size</span><span style="line-height: 140%;">(b.Size.Width / 3, b.Size.Height / 3);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 100</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 101</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 102</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 103</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 104</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 105</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">protected</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">override</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> WndProc(</span><span style="line-height: 140%; color: blue;">ref</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Message</span><span style="line-height: 140%;"> m)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 106</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 107</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">switch</span><span style="line-height: 140%;"> ((</span><span style="line-height: 140%; color: #2b91af;">Msgs</span><span style="line-height: 140%;">)m.Msg)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 108</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 109</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Msgs</span><span style="line-height: 140%;">.WM_DRAWCLIPBOARD:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 110</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ExtractImage();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 111</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; SendMessage(_nxtVwr, m.Msg, m.WParam, m.LParam);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 112</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 113</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">case</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Msgs</span><span style="line-height: 140%;">.WM_CHANGECBCHAIN:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 114</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (m.WParam == _nxtVwr)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 115</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _nxtVwr = m.LParam;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 116</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 117</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; SendMessage(_nxtVwr, m.Msg, m.WParam, m.LParam);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 118</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 119</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">default</span><span style="line-height: 140%;">:</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 120</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">base</span><span style="line-height: 140%;">.WndProc(</span><span style="line-height: 140%; color: blue;">ref</span><span style="line-height: 140%;"> m);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 121</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">break</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 122</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 123</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 124</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 125</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 126</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: green;">// Our custom drop target class</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 127</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 128</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">MyDropTarget</span><span style="line-height: 140%;"> : </span><span style="line-height: 140%; color: #2b91af;">DropTarget</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 129</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 130</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">override</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> OnDrop(</span><span style="line-height: 140%; color: #2b91af;">DragEventArgs</span><span style="line-height: 140%;"> e)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 131</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 132</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Document</span><span style="line-height: 140%;"> doc =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 133</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Autodesk.AutoCAD.ApplicationServices.</span><span style="line-height: 140%; color: #2b91af;">Application</span><span style="line-height: 140%;">.</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 134</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; DocumentManager.MdiActiveDocument;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 135</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 136</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// If we have a valid bitmap, save it and send</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 137</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// our custom command (RINS)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 138</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 139</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (e.Data.GetDataPresent(</span><span style="line-height: 140%; color: #a31515;">&quot;Bitmap&quot;</span><span style="line-height: 140%;">))</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 140</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 141</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">object</span><span style="line-height: 140%;"> o = e.Data.GetData(</span><span style="line-height: 140%; color: #a31515;">&quot;Bitmap&quot;</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 142</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Bitmap</span><span style="line-height: 140%;"> b = o </span><span style="line-height: 140%; color: blue;">as</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Bitmap</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 143</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (b != </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 144</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 145</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// We&#39;ll save the bitmap as a &quot;temp&quot; file</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 146</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// (as its unique - a better approach</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 147</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// would probably to create a unique file</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 148</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// in the same folder as the drawing, but</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 149</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// that&#39;s left to the reader)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 150</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 151</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> path = </span><span style="line-height: 140%; color: #2b91af;">Path</span><span style="line-height: 140%;">.GetTempFileName();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 152</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; b.Save(path);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 153</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 154</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Call our command</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 155</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 156</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> cmd =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 157</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">String</span><span style="line-height: 140%;">.Format(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 158</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;_RINS {0}\n{1},{2},0\n&quot;</span><span style="line-height: 140%;">, path, e.X, e.Y</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 159</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 160</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.SendStringToExecute(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 161</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; cmd, </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">, </span><span style="line-height: 140%; color: blue;">false</span><span style="line-height: 140%;">, </span><span style="line-height: 140%; color: blue;">false</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 162</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 163</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 164</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 165</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 166</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 167</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 168</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Commands</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 169</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 170</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PaletteSet</span><span style="line-height: 140%;"> _ps = </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 171</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">ClipboardView</span><span style="line-height: 140%;"> _cv = </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 172</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">static</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">private</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> _pt = </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;">.Origin;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 173</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 174</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af;">CommandMethod</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;DRAGDROP&quot;</span><span style="line-height: 140%;">)]</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 175</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> DragAndDropClipboardRaster()</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 176</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 177</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (_ps == </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 178</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 179</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PaletteSet</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 180</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;DRAGDROP&quot;</span><span style="line-height: 140%;">,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 181</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Guid</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;5C8FC28C-45ED-4796-BD40-28D235B6D7DA&quot;</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 182</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 183</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 184</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (_cv == </span><span style="line-height: 140%; color: blue;">null</span><span style="line-height: 140%;">)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 185</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 186</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _cv = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">ClipboardView</span><span style="line-height: 140%;">(_ps);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 187</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 188</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 189</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps.Text = </span><span style="line-height: 140%; color: #a31515;">&quot;Clipboard&quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 190</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps.DockEnabled =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 191</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">DockSides</span><span style="line-height: 140%;">.Left | </span><span style="line-height: 140%; color: #2b91af;">DockSides</span><span style="line-height: 140%;">.Right | </span><span style="line-height: 140%; color: #2b91af;">DockSides</span><span style="line-height: 140%;">.None;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 192</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps.Size = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> System.Drawing.</span><span style="line-height: 140%; color: #2b91af;">Size</span><span style="line-height: 140%;">(300, 500);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 193</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _ps.Add(</span><span style="line-height: 140%; color: #a31515;">&quot;ClipboardView&quot;</span><span style="line-height: 140%;">, _cv);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 194</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 195</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _ps.Visible = </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 196</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 197</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 198</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 199</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Our custom command to insert a raster image</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 200</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 201</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af;">CommandMethod</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: #a31515;">&quot;RINS&quot;</span><span style="line-height: 140%;">)]</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 202</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">void</span><span style="line-height: 140%;"> RasterInsert()</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 203</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 204</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Document</span><span style="line-height: 140%;"> doc =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 205</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; Autodesk.AutoCAD.ApplicationServices.</span><span style="line-height: 140%; color: #2b91af;">Application</span><span style="line-height: 140%;">.</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 206</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; DocumentManager.MdiActiveDocument;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 207</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Database</span><span style="line-height: 140%;"> db = doc.Database;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 208</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Editor</span><span style="line-height: 140%;"> ed = doc.Editor;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 209</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 210</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Pick up the location of the bitmap image</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 211</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 212</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptStringOptions</span><span style="line-height: 140%;"> pso =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 213</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PromptStringOptions</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 214</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nPath of raster image: &quot;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 215</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 216</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; pso.AllowSpaces = </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 217</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptResult</span><span style="line-height: 140%;"> pr = ed.GetString(pso);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 218</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (pr.Status != </span><span style="line-height: 140%; color: #2b91af;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 219</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 220</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 221</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (!</span><span style="line-height: 140%; color: #2b91af;">File</span><span style="line-height: 140%;">.Exists(pr.StringResult))</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 222</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 223</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 224</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nFile does not exist.&quot;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 225</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 226</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 227</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 228</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 229</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> path = pr.StringResult;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 230</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 231</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Pick up the position of the drop in screen coords</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 232</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 233</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptPointOptions</span><span style="line-height: 140%;"> ppo =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 234</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">PromptPointOptions</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 235</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515;">&quot;\nPosition of raster image: &quot;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 236</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 237</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptPointResult</span><span style="line-height: 140%;"> ppr = ed.GetPoint(ppo);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 238</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (ppr.Status != </span><span style="line-height: 140%; color: #2b91af;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 239</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 240</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 241</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> pos = ppr.Value;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 242</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 243</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Calculate the displacement vector</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 244</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 245</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> pt =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 246</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.PointToWorld(</span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Point</span><span style="line-height: 140%;">((</span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;">)pos.X, (</span><span style="line-height: 140%; color: blue;">int</span><span style="line-height: 140%;">)pos.Y));</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 247</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Matrix3d</span><span style="line-height: 140%;"> disp =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 248</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Matrix3d</span><span style="line-height: 140%;">.Displacement(pt - </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;">.Origin);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 249</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 250</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Transaction</span><span style="line-height: 140%;"> tr =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 251</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.TransactionManager.StartTransaction();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 252</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">using</span><span style="line-height: 140%;"> (tr)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 253</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 254</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get or create our raster image dictionary</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 255</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 256</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">ObjectId</span><span style="line-height: 140%;"> dictId =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 257</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImageDef</span><span style="line-height: 140%;">.GetImageDictionary(db);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 258</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (dictId == </span><span style="line-height: 140%; color: #2b91af;">ObjectId</span><span style="line-height: 140%;">.Null)</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 259</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; dictId = </span><span style="line-height: 140%; color: #2b91af;">RasterImageDef</span><span style="line-height: 140%;">.CreateImageDictionary(db);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 260</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 261</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// And open it for write</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 262</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 263</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">DBDictionary</span><span style="line-height: 140%;"> dict =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 264</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">DBDictionary</span><span style="line-height: 140%;">)tr.GetObject(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 265</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; dictId, </span><span style="line-height: 140%; color: #2b91af;">OpenMode</span><span style="line-height: 140%;">.ForWrite</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 266</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 267</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 268</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get a unique name for our definition object</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 269</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 270</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">string</span><span style="line-height: 140%;"> name = </span><span style="line-height: 140%; color: #2b91af;">RasterImageDef</span><span style="line-height: 140%;">.SuggestName(dict, path);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 271</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 272</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Create the definition and add it to the dictionary</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 273</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 274</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImageDef</span><span style="line-height: 140%;"> rid = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">RasterImageDef</span><span style="line-height: 140%;">();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 275</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rid.SourceFileName = path;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 276</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rid.Load();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 277</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">ObjectId</span><span style="line-height: 140%;"> ridId = dict.SetAt(name, rid);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 278</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(rid, </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 279</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 280</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Now we&#39;ll add our raster image reference</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 281</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// to the current space</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 282</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 283</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">BlockTableRecord</span><span style="line-height: 140%;"> btr =</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 284</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">BlockTableRecord</span><span style="line-height: 140%;">)tr.GetObject(</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 285</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.CurrentSpaceId,</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 286</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">OpenMode</span><span style="line-height: 140%;">.ForWrite</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 287</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 288</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 289</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Call our jig to define the raster</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 290</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 291</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterJig</span><span style="line-height: 140%;"> jig =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 292</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">RasterJig</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 293</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ridId,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 294</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rid.Size,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 295</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.CurrentUserCoordinateSystem,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 296</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pt</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 297</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 298</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptResult</span><span style="line-height: 140%;"> prj = ed.Drag(jig);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 299</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 300</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (prj.Status != </span><span style="line-height: 140%; color: #2b91af;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 301</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 302</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rid.Erase();</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 303</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 304</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 305</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 306</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get our entity and add it to the modelspace</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 307</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 308</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;"> ri = (</span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;">)jig.GetEntity();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 309</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ri.ImageDefId = ridId;</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 310</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ri.SetClipBoundaryToWholeImage();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 311</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; btr.AppendEntity(ri);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 312</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(ri, </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 313</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 314</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Create a reactor between the RasterImage and the</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 315</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// RasterImageDef to avoid the &quot;unreferenced&quot; </span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 316</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// warning in the XRef palette</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 317</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 318</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;">.EnableReactors(</span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 319</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ri.AssociateRasterDef(rid);</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 320</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 321</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Of course we commit</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 322</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 323</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 324</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 325</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 326</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 327</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 328</span>&#0160;<span style="line-height: 140%;">&#0160; </span><span style="line-height: 140%; color: blue;">class</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">RasterJig</span><span style="line-height: 140%;"> : </span><span style="line-height: 140%; color: #2b91af;">EntityJig</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 329</span>&#0160;<span style="line-height: 140%;">&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 330</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Matrix3d</span><span style="line-height: 140%;"> _ucs;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 331</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Vector2d</span><span style="line-height: 140%;"> _sz;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 332</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> _start = </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;">.Origin;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 333</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> _end = </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;">.Origin;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 334</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 335</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> RasterJig(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 336</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">ObjectId</span><span style="line-height: 140%;"> defId,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 337</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Vector2d</span><span style="line-height: 140%;"> sz,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 338</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Matrix3d</span><span style="line-height: 140%;"> ucs,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 339</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> start</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 340</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; )</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 341</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; : </span><span style="line-height: 140%; color: blue;">base</span><span style="line-height: 140%;">(</span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;">())</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 342</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 343</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _sz = sz;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 344</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _start = start;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 345</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; _ucs = ucs;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 346</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 347</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;"> ri = (</span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;">)Entity;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 348</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; ri.ImageDefId = defId;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 349</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 350</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Create a near zero size default image,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 351</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// to avoid the boundary flicker</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 352</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 353</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">double</span><span style="line-height: 140%;"> size = </span><span style="line-height: 140%; color: #2b91af;">Tolerance</span><span style="line-height: 140%;">.Global.EqualPoint;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 354</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; ri.Orientation =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 355</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">CoordinateSystem3d</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 356</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _start,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 357</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(size, 0, 0),</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 358</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(0, size, 0)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 359</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 360</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; ri.ShowImage = </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 361</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 362</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 363</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">protected</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">override</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">SamplerStatus</span><span style="line-height: 140%;"> Sampler(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 364</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">JigPrompts</span><span style="line-height: 140%;"> prompts</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 365</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; )</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 366</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 367</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">JigPromptPointOptions</span><span style="line-height: 140%;"> opts =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 368</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">JigPromptPointOptions</span><span style="line-height: 140%;">();</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 369</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; opts.UserInputControls =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 370</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af;">UserInputControls</span><span style="line-height: 140%;">.Accept3dCoordinates |</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 371</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">UserInputControls</span><span style="line-height: 140%;">.NoNegativeResponseAccepted);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 372</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; opts.Message = </span><span style="line-height: 140%; color: #a31515;">&quot;\nSecond corner of raster image: &quot;</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 373</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 374</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the point itself</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 375</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 376</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">PromptPointResult</span><span style="line-height: 140%;"> res = prompts.AcquirePoint(opts);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 377</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 378</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (res.Status == </span><span style="line-height: 140%; color: #2b91af;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 379</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 380</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Convert the supplied point into UCS</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 381</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 382</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> tmp =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 383</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res.Value.TransformBy(_ucs.Inverse());</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 384</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 385</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Check if changed (reduces flicker)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 386</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 387</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (_end == tmp)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 388</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 389</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">SamplerStatus</span><span style="line-height: 140%;">.NoChange;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 390</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 391</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 392</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 393</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _end = tmp;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 394</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">SamplerStatus</span><span style="line-height: 140%;">.OK;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 395</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 396</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 397</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">SamplerStatus</span><span style="line-height: 140%;">.Cancel;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 398</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 399</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 400</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">protected</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">override</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> Update()</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 401</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 402</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;"> ri = (</span><span style="line-height: 140%; color: #2b91af;">RasterImage</span><span style="line-height: 140%;">)Entity;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 403</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 404</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get offset between the two corners</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 405</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 406</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;"> diff = _end - _start;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 407</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 408</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Get the ratios of the dimensions of the dragged</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 409</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// image with the source</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 410</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 411</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">double</span><span style="line-height: 140%;"> sizeX = </span><span style="line-height: 140%; color: #2b91af;">Math</span><span style="line-height: 140%;">.Abs(diff.X),</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 412</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; sizeY = </span><span style="line-height: 140%; color: #2b91af;">Math</span><span style="line-height: 140%;">.Abs(diff.Y),</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 413</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ratX = sizeX / _sz.X,</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 414</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ratY = sizeY / _sz.Y;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 415</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 416</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Find out which is bigger and use that to decide</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 417</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// which size should change to keep the proportion</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 418</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 419</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">bool</span><span style="line-height: 140%;"> biggerX = (ratX &gt; ratY);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 420</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 421</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (biggerX)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 422</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; sizeY = ratX * _sz.Y;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 423</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 424</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; sizeX = ratY * _sz.X;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 425</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 426</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Determine the image&#39;s orientation...</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 427</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 428</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// The original will depend on the order of the corners</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 429</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// It will be offset to the left and/or down depending</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 430</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// on the values of the vector between the two points</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 431</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 432</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Point3d</span><span style="line-height: 140%;"> orig;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 433</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 434</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// The axes stay the same, as we will always keep the</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 435</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// image oriented the same way relative to the UCS</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 436</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 437</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;"> xAxis = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(sizeX, 0, 0);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 438</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;"> yAxis = </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(0, sizeY, 0);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 439</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 440</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (diff.X &gt; 0 &amp;&amp; diff.Y &gt; 0) </span><span style="line-height: 140%; color: green;">// Dragging top-right</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 441</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; orig = _start;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 442</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (diff.X &lt; 0 &amp;&amp; diff.Y &gt; 0) </span><span style="line-height: 140%; color: green;">// Top-left</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 443</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; orig = _start + </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(-sizeX, 0, 0);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 444</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">if</span><span style="line-height: 140%;"> (diff.X &gt; 0 &amp;&amp; diff.Y &lt; 0) </span><span style="line-height: 140%; color: green;">// Bottom-right</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 445</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; orig = _start + </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(0, -sizeY, 0);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 446</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">else</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: green;">// if (diff.X &lt; 0 &amp;&amp; diff.Y &lt; 0) // Bottom-left</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 447</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; orig = _start - </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Vector3d</span><span style="line-height: 140%;">(sizeX, sizeY, 0);</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 448</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 449</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green;">// Set the image&#39;s orientation in WCS</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 450</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 451</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; ri.Orientation =</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 452</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">new</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">CoordinateSystem3d</span><span style="line-height: 140%;">(</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 453</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; orig.TransformBy(_ucs),</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 454</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; xAxis.TransformBy(_ucs),</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 455</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; yAxis.TransformBy(_ucs)</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 456</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 457</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 458</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: blue;">true</span><span style="line-height: 140%;">;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 459</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 460</span>&#0160;</p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 461</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">public</span><span style="line-height: 140%;"> </span><span style="line-height: 140%; color: #2b91af;">Entity</span><span style="line-height: 140%;"> GetEntity()</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 462</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; {</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 463</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue;">return</span><span style="line-height: 140%;"> Entity;</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 464</span>&#0160;<span style="line-height: 140%;">&#0160;&#0160;&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: red;">&#0160; 465</span>&#0160;<span style="line-height: 140%;">&#0160; }</span></p>
<p style="margin: 0px;"><span style="color: #2b91af;">&#0160; 466</span>&#0160;<span style="line-height: 140%;">}</span></p>
</div>

<p>When we run the new DRAGDROP command and drag &amp; drop from our palette onto the drawing, we see the raster images are now inserted and sized by the jig proportionally to the original image’s size:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2014e866250d1970d-pi"><img alt="Dragging and dropping rasters at specified positions and sizes" border="0" height="281" src="/assets/image_2203.jpg" style="background-image: none; margin: 0px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; padding-top: 0px; border: 0px;" title="Dragging and dropping rasters at specified positions and sizes" width="475" /></a></p>
