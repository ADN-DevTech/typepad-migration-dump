---
layout: "post"
title: "Building an Installer &ndash; Part 1"
date: "2010-09-13 18:21:06"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Installation"
  - "Plugin of the Month"
  - "Runtime"
  - "Visual Studio"
original_url: "https://www.keanw.com/2010/09/building-an-installer-part-1.html "
typepad_basename: "building-an-installer-part-1"
typepad_status: "Publish"
---

<p>It’s been a long time since I’ve dabbled with software deployment technology, which is absolutely fine by me (in my experience installation issues are some of the gnarliest to deal with, so – presumably like the majority of developers, with apologies to Install specialists – I prefer not having to care about them, myself). But last week I had to put together a few installers - as an internal test - for some of our <a href="http://labs.autodesk.com/utilities/adn_plugins" target="_blank">Plugins of the Month</a>, and ended up deciding the process was worth documenting, especially where it relates to <a href="http://through-the-interface.typepad.com/through_the_interface/2010/02/creating-demand-loading-entries-for-net-modules-outside-of-autocad.html" target="_blank">the RegDL component</a> I created and published earlier in the year.</p>  <p>Over the course of the next few posts, I’m going to step through the process I used to create a (relatively) simple installer for the upcoming “BrowsePhotosynth for AutoCAD” Plugin of the Month, which will be based on the code developed in the series culminating in <a href="http://through-the-interface.typepad.com/through_the_interface/2010/04/importing-photosynth-point-clouds-into-autocad-2011-part-4.html" target="_blank">this post</a>. (The code has been polished a fair bit since then, by the way, but you’ll see all that soon enough. :-)</p>  <p>This project is quite interesting as it demonstrates a number of requirements:</p>  <ul>   <li>[Part 1 – Basic file installation]      <ul>       <li>We have standard AutoCAD dependencies we want to exclude from the installer </li>        <li>We want to publish the source for the plugin along with the binaries </li>        <li>We have a number of 3rd party components to install </li>     </ul>   </li>    <li>[Part 2 – Registry stuff]      <ul>       <li>We want to use the RegDL tool to simplify installation          <ul>           <li>i.e. no manual Registry editing to enable demand-loading </li>         </ul>       </li>        <li>We have a COM DLL that also requires registration </li>     </ul>   </li>    <li>[Part 3 – User interface tweaks]      <ul>       <li>We’d like to customise the UI for the installer          <ul>           <li>To add a custom banner </li>            <li>To remove the “install for everyone” option </li>         </ul>       </li>     </ul>   </li> </ul>  <p>Which hopefully means that while we’re looking at a specific sample application to deploy, it is interesting enough to be relevant to anyone choosing a similar approach to creating an installer.</p>  <p>Without further ado, let’s start with our basic Visual Studio (in my case 2008) solution, and add in a custom Installer project:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba010970b-pi"><img title="Add a new project to the solution" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Add a new project to the solution" src="/assets/image_748606.jpg" width="319" height="259" /></a></p>  <p>We might add a simple Setup project, but the Setup Wizard will simplify a few steps for us:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba083970b-pi"><img title="Select a new Setup Wizard project" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Select a new Setup Wizard project" src="/assets/image_180646.jpg" width="407" height="260" /></a></p>  <p>We start by being welcomed to the Setup Project Wizard…</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba0ea970b-pi"><img title="Wizard Welcome" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Wizard Welcome" src="/assets/image_159480.jpg" width="338" height="261" /></a></p>  <p>Next we select our project type – a standard Windows application deployment:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba179970b-pi"><img title="Project type selection" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Project type selection" src="/assets/image_771278.jpg" width="338" height="261" /></a> </p>  <p>Next we select our project inputs. There are a number of inputs in the solution we want to select:</p>  <ul>   <li>Browser project      <ul>       <li>Primary output from Browser </li>        <li>Source files from Browser </li>     </ul>   </li>    <li>Importer project      <ul>       <li>Primary output from Importer </li>        <li>Source files from Importer </li>        <li>Content files from Importer </li>     </ul>   </li>    <li>Processor project      <ul>       <li>Primary output from Processor </li>        <li>Source files from Processor </li>     </ul>   </li> </ul>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba1ec970b-pi"><img title="Project outputs to include" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Project outputs to include" src="/assets/image_605345.jpg" width="338" height="261" /></a> </p>  <p>We can also enter some additional files here, but it’s pretty easy to add them later, too:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba24b970b-pi"><img title="Additonal files to include" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Additonal files to include" src="/assets/image_89917.jpg" width="338" height="261" /></a></p>  <p>Then we get a summary of our setup project choices:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba2bd970b-pi"><img title="Summary" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Summary" src="/assets/image_346296.jpg" width="338" height="261" /></a></p>  <p>When we select “Finish”, we get warned that not all project dependencies could be parsed, which is a quirk of one of the 3rd party component modules we’re using and safe to ignore:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b85e3970c-pi"><img title="Cannot get references for ComUtilities-dll" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Cannot get references for ComUtilities-dll" src="/assets/image_639645.jpg" width="251" height="117" /></a></p>  <p>We can see in the Solution Explorer that a good deal of the heavy lifting has already been taken care of:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b862d970c-pi"><img title="Our newly created Installer project" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Our newly created Installer project" src="/assets/image_78216.jpg" width="219" height="377" /></a> </p>  <p>Which leaves us to head on into the detail, where the devil is no doubt lurking… :-)</p>  <p>We certainly want some of the standard dependencies to be excluded, to stop them from being installed:</p>  <ul>   <li><em>AcCui.dll</em> </li>    <li><em>AcTcMgd.dll</em> </li>    <li><em>AcWindows.dll</em> </li>    <li><em>AdWindows.dll</em>       <ul>       <li>All core AutoCAD modules that the project uses </li>     </ul>   </li>    <li><em>ADNPlugin-PhotosynthProcessor.dll</em>       <ul>       <li>This is also a project output </li>     </ul>   </li>    <li><em>Interop.ComUtilitiesLib.dll</em>       <ul>       <li>We have this twice in the list and only need it installed once </li>     </ul>   </li> </ul>  <p>You’ll notice I’ve excluded neither <em>AcMgd.dll</em> nor <em>AcDbMgd.dll</em>: these two are going to be installed, but only for the RegDL tool to be able to load in the custom .NET types that our managed assembly uses (so we can generate demand-loading keys for it).</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b865c970c-pi"><img title="Excluding a few core files" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Excluding a few core files" src="/assets/image_997904.jpg" width="227" height="317" /></a>We’ll put these two DLLs in a custom location beneath the main application folder (which we’ll call “Install”), so they don’t cause a conflict with the standard AutoCAD DLLs, in case we get installed there. To create a new install location, we need to hop on across to the File System view:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba4b0970b-pi"><img title="Let&#39;s go add a new file location" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Let&#39;s go add a new file location" src="/assets/image_769612.jpg" width="319" height="324" /></a> </p>  <p>Here’s where we can add custom install locations for our application files and source:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b86be970c-pi"><img title="Add a new folder for Install files" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Add a new folder for Install files" src="/assets/image_120399.jpg" width="432" height="283" /></a></p>  <p>We can also create a hierarchy of folders, where our various files will end up being installed:<a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b86e8970c-pi"><img title="Our new install locations" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Our new install locations" src="/assets/image_928133.jpg" width="452" height="262" /></a>Individual files can be told to be installed into these various locations via their properties window:</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20133f42ba615970b-pi"><img title="Change AcDbMgd-dll to install to our sub-folder" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Change AcDbMgd-dll to install to our sub-folder" src="/assets/image_256154.jpg" width="272" height="208" /></a> We can also add new files into the installation set directly from this view (by right-clicking in the File System tree and selecting Add, then browsing to the file to be added):</p>  <p><img title="Add our RegDL executable to the Install folder" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Add our RegDL executable to the Install folder" src="/assets/image_444028.jpg" width="372" height="177" />In case you’re interested in testing it, the installer can already be built and used: you should see a set of files and folders created in the selected location, although no Registry entries are – as yet – being created.</p>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20134874b871a970c-pi"><img title="Our installed application files and source" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin: 20px auto; display: block; border-top-width: 0px" border="0" alt="Our installed application files and source" src="/assets/image_703412.jpg" width="456" height="258" /></a></p>  <p>I’ve taken the liberty of omitting a few steps in the above process, where I added a few files “manually”: I wanted to include the overall solution file in the root “Source” folder, as well as the .vdproj file in an “Installer” folder beneath it, but those are changes that are quite specific to my needs and will, in any case, be obvious from the project I provide at the end of the series.</p>  <p>In the next post we’ll focus on all things Registry-related – making appropriate loading settings for AutoCAD demand-loading and for COM.</p>
