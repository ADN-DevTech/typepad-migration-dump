---
layout: "post"
title: "Ray-tracing Apollonian packings"
date: "2013-11-11 10:00:16"
author: "Kean Walmsley"
categories:
  - "AU"
  - "Fractals"
  - "Geometry"
  - "Graphics system"
  - "JSON"
  - "Python"
  - "REST"
  - "Training"
original_url: "https://www.keanw.com/2013/11/ray-tracing-apollonian-packings.html "
typepad_basename: "ray-tracing-apollonian-packings"
typepad_status: "Publish"
---

<p>Over the weekend I managed to complete the <a href="https://www.edx.org/school/uc%20berkeleyx/allcourses" target="_blank">BerkeleyX</a> <a href="https://courses.edx.org/courses/BerkeleyX/CS-184.1x/2013_October/info" target="_blank">Foundations of Computer Graphics</a> class. This was really an excellent class, both in terms of the structure of the lectures and the homework assignments, which actually scaled in a non-linear way (the last assignment took as much time to complete as the previous three combined). But you were eased into it and didn’t strictly need to do the last piece of homework (which was to <a href="http://through-the-interface.typepad.com/through_the_interface/2013/11/writing-a-ray-tracer.html" target="_blank">write a ray-tracer</a> <a href="http://through-the-interface.typepad.com/through_the_interface/2013/11/using-autocad-to-debug-external-ray-tracing-routines.html" target="_blank">from scratch</a>) to get a “pass” on the course.</p>  <p>What’s nice about these <a href="http://en.wikipedia.org/wiki/Massive_open_online_course" target="_blank">MOOCs</a> is that – in order to scale, putting the M in MOOC – they mostly have either peer review or – and this was true of the two classes I’ve taken so far on <a href="https://www.coursera.org" target="_blank">Coursera</a> and <a href="https://www.edx.org" target="_blank">edX</a> – use an automatic grader that gives you instant feedback on whether you’ve passed a particular test or homework assignment or not. And as there’s usually no limit to the number of times you can submit and check your answers, there’s really no reason not to get 100% (other than running out of either time or motivation).</p>  <p>If you’re interested in seeing more of the “bloopers” I showed in <a href="http://through-the-interface.typepad.com/through_the_interface/2013/11/writing-a-ray-tracer.html" target="_blank">this previous post</a>, <a href="http://through-the-interface.typepad.com/files/Raytracer%20bloopers%202.gif" target="_blank">here’s the final version</a> (which doesn’t include any of the images that ended up passing the grader).</p>  <p>The ray-tracer itself was specified to work with just a couple of geometric primitives: triangles and spheres. Given the fact it already works with spheres, yesterday I decided to try it out with <a href="http://apollonian.cloudapp.net" target="_blank">the web-service</a> I created to generate <a href="http://en.wikipedia.org/wiki/Apollonian_gasket" target="_blank">Apollonian gaskets</a> and <a href="http://en.wikipedia.org/wiki/Apollonian_sphere_packing" target="_blank">packings</a> (which served as the core for <a href="http://through-the-interface.typepad.com/through_the_interface/2012/06/cloud-mobile-series-summary.html" target="_blank">this mammoth series of posts from last year</a>).</p>  <p>Here’s an animated GIF of the various levels and the way they came out:</p>  <br />&#160;<a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2019b00fe2813970b-pi"><img style="display: inline" title="Apollonian ray-tracing" alt="Apollonian ray-tracing" src="/assets/image_908287.jpg" width="470" height="352" /></a>  <br />  <br />  <p>Bear in mind that GIFs only have 256 colours, so these shots do include a few visual peculiarities due to that.</p>  <p>The ray-tracing application takes a scene file – which is simply a text file that contains information such as the positions of the camera and lights and the various properties of the geometry you want to show. I threw together a simple Python script that accesses the web-service for a certain recursion level and looks through the returned objects, generating a scene file that can drive the ray-tracer.</p>  <p>Each scene file the code creates contains a bunch of boilerplate data – aside from the camera and lights there are flat surfaces below and behind the spheres, to make it more visually interesting – before the definitions of the spheres themselves. I haven’t filtered the spheres to remove the ones not near the outside (as I did with visualizations of this data on other platforms), so the scenes are heavier than they need to be. But they all rendered in an acceptable amount of time, so I didn’t worry about that.</p>  <p>Here’s the Python code that I used to generate the scenes driving the ray-tracer, which – to be more visually interesting – borrows some material definitions from <a href="http://devernay.free.fr/cours/opengl/materials.html" target="_blank">this page</a>.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">import</span><span style="line-height: 140%"> urllib</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">import</span><span style="line-height: 140%"> json</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">laycols = {0 : </span><span style="line-height: 140%; color: #a31515">&quot;obsidian&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1 : </span><span style="line-height: 140%; color: #a31515">&quot;ruby&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2 : </span><span style="line-height: 140%; color: #a31515">&quot;gold&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3 : </span><span style="line-height: 140%; color: #a31515">&quot;emerald&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4 : </span><span style="line-height: 140%; color: #a31515">&quot;turquoise&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5 : </span><span style="line-height: 140%; color: #a31515">&quot;chrome&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 6 : </span><span style="line-height: 140%; color: #a31515">&quot;obsidian&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 7 : </span><span style="line-height: 140%; color: #a31515">&quot;jade&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8 : </span><span style="line-height: 140%; color: #a31515">&quot;pearl&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 9 : </span><span style="line-height: 140%; color: #a31515">&quot;silver&quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 10 : </span><span style="line-height: 140%; color: #a31515">&quot;copper&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">matdefs = {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green"># name : (ambient,diffuse,specular,shininess)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;emerald&quot;</span><span style="line-height: 140%">&#160; :&#160;&#160; ((0.0215,0.1745,0.0215),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.07568,0.61424,0.07568),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.633,0.727811,0.633),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.6),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;jade&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160;&#160;&#160; ((0.135,0.2225,0.1575),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.54,0.89,0.63),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.316228,0.316228,0.316228),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.1),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;obsidian&quot;</span><span style="line-height: 140%"> :&#160; ((0.05375,0.05,0.06625),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.18275,0.17,0.22525),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.332741,0.328634,0.346435),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.3),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;pearl&quot;</span><span style="line-height: 140%">&#160; :&#160;&#160;&#160;&#160; ((0.25,0.20725,0.20725),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (1,0.829,0.829),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.296648,0.296648,0.296648),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.088),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;ruby&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160;&#160;&#160; ((0.1745,0.01175,0.01175),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.61424,0.04136,0.04136),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.727811,0.626959,0.626959),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.6),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;turquoise&quot;</span><span style="line-height: 140%">&#160; : ((0.1,0.18725,0.1745),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.396,0.74151,0.69102),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.297254,0.30829,0.306678),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.1),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;brass&quot;</span><span style="line-height: 140%">&#160; :&#160;&#160;&#160;&#160; ((0.329412,0.223529,0.027451),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.780392,0.568627,0.113725),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.992157,0.941176,0.807843),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.21794872),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;bronze&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160; ((0.2125,0.1275,0.054),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.714,0.4284,0.18144),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.393548,0.271906,0.166721),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.2),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;chrome&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160; ((0.25,0.25,0.25),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.4,0.4,0.4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.774597,0.774597,0.774597),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.6),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;copper&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160; ((0.19125,0.0735,0.0225),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.7038,0.27048,0.0828),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.256777,0.137622,0.086014),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.1),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;gold&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160;&#160;&#160; ((0.24725,0.1995,0.0745),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.75164,0.60648,0.22648),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.628281,0.555802,0.366065),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.4),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #a31515">&quot;silver&quot;</span><span style="line-height: 140%"> :&#160;&#160;&#160; ((0.19225,0.19225,0.19225),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.50754,0.50754,0.50754),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (0.508273,0.508273,0.508273),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.4)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">recurse = 1 </span><span style="line-height: 140%; color: green"># recursion depth: how many levels to create</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;size 640 480\noutput apollonian%d.png&quot;</span><span style="line-height: 140%"> % recurse</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;camera 0 -3 2.1 0 -1 1 0 1 1 45&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;point 1 1 3 0.5 0.5 0.5\npoint -1 -1 5 0.5 0.5 0.5&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;ambient 0 0 0\nshininess 10\nspecular 0 0 0&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;emission .1 .1 .1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;maxverts 8&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;vertex -1 -1 -1\nvertex +1 -1 -1\nvertex +1 +1 -1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;vertex -1 +1 -1\nvertex -1 -1 +1\nvertex +1 -1 +1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;vertex +1 +1 +1\nvertex -1 +1 +1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;pushTransform\nscale 2 2 .1\ntranslate 0 -0.5 -4.3&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;diffuse .3 0 0&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 0 1 5\ntri 0 5 4\ntri 3 7 6\ntri 3 6 2\ntri 1 2 6&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 1 6 5\ntri 0 7 3\ntri 0 4 7\ntri 0 3 2\ntri 0 2 1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 4 5 6\ntri 4 6 7&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;popTransform\npushTransform&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;translate -10 10 -10\nscale 30 .1 20\ndiffuse .3 .3 .3&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 0 1 5\ntri 0 5 4\ntri 3 7 6\ntri 3 6 2\ntri 1 2 6&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 1 6 5\ntri 0 7 3\ntri 0 4 7\ntri 0 3 2\ntri 0 2 1&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;tri 4 5 6\ntri 4 6 7&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;popTransform\npushTransform\ntranslate 0 0 0.6&quot;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">url = </span><span style="line-height: 140%; color: #a31515">&quot;http://apollonian.cloudapp.net/api/spheres/1/%d&quot;</span><span style="line-height: 140%"> % recurse</span></p>    <p style="margin: 0px"><span style="line-height: 140%">u = urllib</span><span style="line-height: 140%; color: blue">.</span><span style="line-height: 140%">urlopen(url)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">jdata = json</span><span style="line-height: 140%; color: blue">.</span><span style="line-height: 140%">loads(u</span><span style="line-height: 140%; color: blue">.</span><span style="line-height: 140%">read())</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">for</span><span style="line-height: 140%"> jd </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> jdata:</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; amb,dif,spec,shin = matdefs[laycols[jd[</span><span style="line-height: 140%; color: #a31515">'L'</span><span style="line-height: 140%">]]]</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;ambient %f %f %f&quot;</span><span style="line-height: 140%"> % (amb[0],amb[1],amb[2])</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;diffuse %f %f %f&quot;</span><span style="line-height: 140%"> % (dif[0],dif[1],dif[2])</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;specular %f %f %f&quot;</span><span style="line-height: 140%"> % (spec[0], spec[1], spec[2])</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;shininess %f&quot;</span><span style="line-height: 140%"> % (shin * 128)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;sphere %f %f %f %f&quot;</span><span style="line-height: 140%"> % (jd[</span><span style="line-height: 140%; color: #a31515">'X'</span><span style="line-height: 140%">],jd[</span><span style="line-height: 140%; color: #a31515">'Y'</span><span style="line-height: 140%">],jd[</span><span style="line-height: 140%; color: #a31515">'Z'</span><span style="line-height: 140%">],jd[</span><span style="line-height: 140%; color: #a31515">'R'</span><span style="line-height: 140%">])</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">print</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;popTransform&quot;</span></p> </div>  <p>The scene file gets printed to the standard output, so I simply used “python apollonian-scene.py &gt; test.scene” to pipe the results into a file and then ran “raytrace test.scene” to generate the PNG image specified by the output command in the scene file (if I’d implemented the ray-tracer differently I’d have been able to pipe the scene in via the standard input, but hey).</p>  <p>Once this year’s <a href="http://au.autodesk.com" target="_blank">AU</a> is out of the way I’m going to have to find another class to sign up for. I’m definitely turning into a MOOC addict. :-)</p>  <p><strong><em>Update:</em></strong></p>  <p>There was a saturation glitch in the first images I generated (the areas with the highest reflections were going being 1.0 in either R, G or B leading to colours being a bit off). I’ve fixed the animation and reposted it.</p>
