---
layout: "post"
title: "Overlaying a logo on the Forge viewer"
date: "2017-02-17 16:47:17"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk"
  - "Autodesk Research"
  - "HTML"
  - "IoT"
  - "JavaScript"
  - "User interface"
original_url: "https://www.keanw.com/2017/02/overlaying-a-logo-on-the-forge-viewer.html "
typepad_basename: "overlaying-a-logo-on-the-forge-viewer"
typepad_status: "Publish"
---

<p>Today I was asked to add the ability to place a custom logo onto an instance of the Forge viewer (in my case for <a href="http://dasher360.com" target="_blank">Dasher 360</a>, of course). It seemed like an interesting one to share, as I’m sure others have the same requirement.</p> <p>There are probably lots of ways to solve this – for instance by adding the image with its own camera as an overlay inside the Forge viewer’s 3D scene – but I decided to stick to something simple and have the browser overlay the image.</p> <p>There are a few changes needed for this to work. Firstly to the HTML page hosting the viewer. Here’s the div structure I used, based on <a href="http://media.tojicode.com/webgl-samples/hud-test.html" target="_blank">this example</a>.</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: maroon">div</span> <span style="color: red">id</span><span style="color: blue">="canvas-align"&gt;</span></p> <p style="margin: 0px">&nbsp; <span style="color: blue">&lt;</span><span style="color: maroon">div</span> <span style="color: red">id</span><span style="color: blue">="viewer3d"&gt;&lt;/</span><span style="color: maroon">div</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px">&nbsp; <span style="color: blue">&lt;</span><span style="color: maroon">div</span> <span style="color: red">id</span><span style="color: blue">="logo-overlay"&gt;</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">&lt;</span><span style="color: maroon">div</span> <span style="color: red">id</span><span style="color: blue">="logo"&gt;&lt;/</span><span style="color: maroon">div</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px">&nbsp; <span style="color: blue">&lt;/</span><span style="color: maroon">div</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: maroon">div</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px">&nbsp;</p></div> <p>Then some CSS additions:</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: maroon">#canvas-align</span> {</p> <p style="margin: 0px">&nbsp; <span style="color: red">position</span>: <span style="color: blue">relative</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">width</span>: <span style="color: blue">100%</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">height</span>: <span style="color: blue">calc(100vh</span> <span style="color: blue">-</span> <span style="color: blue">50px)</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">margin</span>: <span style="color: blue">auto</span>;</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: maroon">#logo-overlay</span> {</p> <p style="margin: 0px">&nbsp; <span style="color: red">position</span>: <span style="color: blue">absolute</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">top</span>: <span style="color: blue">0</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">width</span>: <span style="color: blue">100%</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">height</span>: <span style="color: blue">calc(100vh</span> <span style="color: blue">-</span> <span style="color: blue">50px)</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">margin</span>: <span style="color: blue">auto</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">z-index</span>: <font color="#0000ff">1</font>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">pointer-events</span>: <span style="color: blue">none</span>;</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: maroon">#logo</span> {</p> <p style="margin: 0px">&nbsp; <span style="color: red">position</span>: <span style="color: blue">absolute</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">bottom</span>: <span style="color: blue">20px</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: red">right</span>: <span style="color: blue">20px</span>;</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>In the above implementation we assume a header that’s 50 pixels high, hence the height adjustment. And we’re placing the logo 20 pixels up and in from the bottom right-hand corner of the viewer. Another important thing to note is that we need to flag our overlay layer as not accepting pointer events. Otherwise you wouldn’t be able to use the viewer, as it would swallow all the mouse or touch input.</p> <p>Lastly there’s the JavaScript – or in our case TypeScript – that makes it all work. The below code won’t copy &amp; paste directly – there’s a Logger class that I haven’t provided, for instance – but it should help you implement this approach in your own projects. I’ve implemented this in an extension – to make it easier to make it loadable/unloadable, should you choose to – but you could bypass that mechanism completely if you wanted to.</p> <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%"> <p style="margin: 0px"><span style="color: green">/// &lt;reference path='../../../../../typings/lmv-client/lmv-client.d.ts' /&gt;</span></p> <p style="margin: 0px"><span style="color: blue">import</span> Logger from <span style="color: #a31515">'../../core/logger'</span>;</p> <p style="margin: 0px"><span style="color: blue">let</span> logger = Logger.getInstance();</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: green">// Returns a function, that, as long as it continues to be invoked, will not</span></p> <p style="margin: 0px"><span style="color: green">// be triggered. The function will be called after it stops being called for</span></p> <p style="margin: 0px"><span style="color: green">// N milliseconds. If `immediate` is passed, trigger the function on the</span></p> <p style="margin: 0px"><span style="color: green">// leading edge, instead of the trailing.</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: blue">function</span> debounce(func: any, wait: any, immediate?: any): any {</p> <p style="margin: 0px">&nbsp; <span style="color: blue">let</span> timeout: any;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">return</span> <span style="color: blue">function</span>(): any {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> context = <span style="color: blue">this</span>;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> args = arguments;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> later = <span style="color: blue">function</span>(): any {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeout = <span style="color: blue">null</span>;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!immediate) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; func.apply(context, args);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; };</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> callNow = immediate &amp;&amp; !timeout;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; clearTimeout(timeout);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; timeout = setTimeout(later, wait);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (callNow) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; func.apply(context, args);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp; };</p> <p style="margin: 0px">};</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="color: blue">export</span> <span style="color: blue">default</span> <span style="color: blue">class</span> LogoExtension <span style="color: blue">extends</span> Autodesk.Viewing.Extension {</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">private</span> _overlayName = <span style="color: #a31515">'Logo'</span>;</p> <p style="margin: 0px">&nbsp; <span style="color: blue">private</span> _logo: THREE.Mesh;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; constructor(viewer: Autodesk.Viewing.Private.GuiViewer3D, options: any) {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">super</span>(viewer, options);</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; adjustLogo(): <span style="color: blue">void</span> {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> vdiv = $(<span style="color: #a31515">'.adsk-viewing-viewer'</span>)[0];</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; $(<span style="color: #a31515">'#canvas-align'</span>).width(vdiv.clientWidth).height(vdiv.clientHeight);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; $(<span style="color: #a31515">'#logo-overlay'</span>).width(vdiv.clientWidth).height(vdiv.clientHeight);</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; load(): boolean {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; logger.log(<span style="color: #a31515">'LogoExtension loaded'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> onresize = debounce(() =&gt; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.adjustLogo();</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }, 100);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; window.addEventListener(<span style="color: #a31515">'resize'</span>, onresize);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> logo = $(<span style="color: #a31515">'#logo'</span>);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> width = 80;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">let</span> height = 80;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; logo.html(<span style="color: #a31515">'&lt;img width=\''</span> + width + <span style="color: #a31515">'px\' height=\''</span> + height + <span style="color: #a31515">'px\' src=\'/img/DasherIcon.png\'&gt;'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>.adjustLogo();</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; $(<span style="color: #a31515">'#logo-overlay'</span>).attr(<span style="color: #a31515">'display'</span>, <span style="color: #a31515">'block'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; unload(): boolean {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; logger.log(<span style="color: #a31515">'LogoExtension unloaded'</span>);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; $(<span style="color: #a31515">'#logo-overlay'</span>).attr(<span style="color: #a31515">'display'</span>, <span style="color: #a31515">'none'</span>);</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">true</span>;</p> <p style="margin: 0px">&nbsp; }</p> <p style="margin: 0px">}</p> <p style="margin: 0px">&nbsp;</p></div> <p>It’s important to note that in the above code we’re adjusting the logo to the viewer’s size, rather than to the size of the window. That’s because we sometimes add our timeline to the bottom of the screen, and we don’t want the logo overlaying that. And we do this from <a href="https://davidwalsh.name/javascript-debounce-function" target="_blank">a “debounced” function</a>, to stop it from being called repeatedly during resize, adversely impacting performance.</p> <p>Here’s how Dasher 360 looks with an overlaid logo in the bottom-right corner. This is just a placeholder logo – it’ll be something that gets customized per installation, in due course – but I’m pretty happy with how it looks and behaves.</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201bb097a5092970d-pi" target="_blank"><img title="Dasher 360 with an overlaid logo" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin: 30px auto; display: block; padding-right: 0px; border-top-width: 0px" border="0" alt="Dasher 360 with an overlaid logo" src="/assets/image_917881.jpg" width="500" height="335"></a></p>
