---
layout: "post"
title: "Creating krpano scenes from A360 stereo panorama renderings &ndash; Part 3"
date: "2016-03-18 10:15:10"
author: "Kean Walmsley"
categories:
  - "Virtual Reality"
  - "XML"
original_url: "https://www.keanw.com/2016/03/creating-krpano-scenes-from-a360-stereo-panorama-renderings-part-3.html "
typepad_basename: "creating-krpano-scenes-from-a360-stereo-panorama-renderings-part-3"
typepad_status: "Publish"
---

<p>So far we’ve <a href="http://through-the-interface.typepad.com/through_the_interface/2016/03/creating-krpano-scenes-from-a360-stereo-panorama-renderings-part-1.html" target="_blank">introduced this series</a> and <a href="http://through-the-interface.typepad.com/through_the_interface/2016/03/creating-krpano-scenes-from-a360-stereo-panorama-renderings-part-2.html" target="_blank">taken a look at the format of panoramic images both in A360 cloud rendering and in krpano</a>. The next step – before publishing the code, which I’ll do at the beginning of next week – is to take a look at the XML format needed by the krpano viewer.</p>
<p>For simplicity, we’re going to have a single, top-level krpano scene that links to scenes created for the various stereo panos that we’ve downloaded and processed from A360 cloud rendering. This top-level scene is copied from a sample scene provided by krpano, but we’re going to customize its thumbnails and links to point to our newly created sub-scenes.</p>
<p>To get an idea of the scene format at its simplest, here’s a sample XML file that the tool has generated for the “Meeting room” scene:</p>
<div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%;">
<p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">krpano</span><span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; &lt;</span><span style="color: #a31515;">scene</span> <span style="color: red;">name</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">Meeting room</span>&#39;<span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160;&#0160;&#0160; &lt;</span><span style="color: #a31515;">preview</span> <span style="color: red;">url</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">Meeting room-L.tiles/preview.jpg</span>&#39;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160;&#0160;&#0160; &lt;</span><span style="color: #a31515;">image</span> <span style="color: red;">stereo</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">true</span>&#39; <span style="color: red;">stereolabels</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">L|R</span>&#39;<span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="color: #a31515;">cube</span> <span style="color: red;">url</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">Meeting room-%t.tiles/pano_%s.jpg</span>&#39;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160;&#0160;&#0160;&#0160;&#0160; &lt;</span><span style="color: #a31515;">cube</span> <span style="color: red;">url</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">Meeting room-%t.tiles/mobile_%s.jpg</span>&#39; <span style="color: red;">devices</span><span style="color: blue;">=</span>&#39;<span style="color: blue;">iOS</span>&#39;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160;&#0160;&#0160; &lt;/</span><span style="color: #a31515;">image</span><span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; &lt;/</span><span style="color: #a31515;">scene</span><span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&lt;/</span><span style="color: #a31515;">krpano</span><span style="color: blue;">&gt;</span></p>
<p style="margin: 0px;">&#0160;</p>
</div>
<p>The understand what this means, let’s take a look at the files created by the tool.</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d1b070ef970c-pi"><img alt="Output tree for krpano" border="0" height="181" src="/assets/image_716465.jpg" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 30px auto; display: block; padding-right: 0px; border-width: 0px;" title="Output tree for krpano" width="504" /></a></p>
<p>You can see we have a number of JPG images for our standard and mobile panoramas. The above XML file sits in the folder above the one in which these images are found.</p>
<p>So that’s the way we’re creating sub-scenes, which are pretty simple. The top-level scene is a bit (but not much) more complicated.</p>
<p>The scene itself is going to be copied from a template folder – which will include the various .js modules for the krpano viewer as well as the JPGs for this outer panorama – and we’re going to replace some placeholders in the XML file with custom chunks of code to do what we want.</p>
<p>We’re going to add two chunks of code: the first is really boilerplate – some JavaScript to animate the thumbnails when the gaze cursor hovers over them – while the second is where our custom “hotspots” are defined. Here’s an example definition for our meeting room hotspot:</p>
<div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%;">
<p style="margin: 0px;"><span style="color: blue;">&lt;!--</span><span style="color: green;"> Panel 7 </span><span style="color: blue;">--&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">hotspot</span> <span style="color: red;">name</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">p7</span>&quot; <span style="color: red;">style</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">panel</span>&quot; <span style="color: red;">ath</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">110</span>&quot; <span style="color: red;">atv</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0</span>&quot;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">hotspot</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; </span><span style="color: red;">name</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">p7_thumb</span>&quot; <span style="color: red;">style</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">thumb</span>&quot; <span style="color: red;">zorder</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">3</span>&quot; <span style="color: red;">ath</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">110</span>&quot;</p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; </span><span style="color: red;">atv</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0</span>&quot; <span style="color: red;">url</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">panos/Meeting room/thumb.png</span>&quot; <span style="color: red;">scale</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0.3</span>&quot; <span style="color: red;">ox</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0</span>&quot; <span style="color: red;">oy</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">-10</span>&quot;</p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; </span><span style="color: red;">onclick</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">changepano( loadpanoscene(&#39;%CURRENTXML%/panos/Meeting room/tour.xml&#39;,</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; 0, null, MERGE|KEEPVIEW|KEEPMOVING, BLEND(1));&#0160; set(webvr.worldscale,0.5); );</span>&quot;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">hotspot</span></p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; </span><span style="color: red;">name</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">p7_txt</span>&quot;<span style="color: blue;">&#0160;&#0160; </span><span style="color: red;">style</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">thumb</span>&quot; <span style="color: red;">zorder</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">2</span>&quot; <span style="color: red;">ath</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">110</span>&quot; <span style="color: red;">atv</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0</span>&quot;</p>
<p style="margin: 0px;"><span style="color: blue;">&#0160; </span><span style="color: red;">url</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">panos/Meeting room/text.png</span>&quot; <span style="color: red;">scale</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">0.3</span>&quot; <span style="color: red;">oy</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">+82</span>&quot; <span style="color: red;">enabled</span><span style="color: blue;">=</span>&quot;<span style="color: blue;">false</span>&quot;<span style="color: blue;"> /&gt;</span></p>
<p style="margin: 0px;">&#0160;</p>
</div>
<p>This hotspot is basically a panel that includes a circular thumbnail image (which we mentioned, last time) and a custom image with some text containing the name of our panorama. We’re creating this image using code (which, yes, we’ll see next time :-).</p>
<p>Apart from the custom image and the link to the sub-scene we have a custom “ath” attribute value. This is going to define where it appears horizontally in space. In our form I’ve now added a corresponding “angle for thumbnails” item, which will define the overall angle in the scene (from 360 degrees) that will be occupied by our thumbnails. Here’s the updated dialog design:</p>
<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b7c8261737970b-pi"><img alt="Updated dialog" border="0" height="416" src="/assets/image_404569.jpg" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 30px auto; display: block; padding-right: 0px; border-width: 0px;" title="Updated dialog" width="504" /></a></p>
<p>I’ve set this as 220, so the thumbnails will be spread from -110 to 110 degrees. As this is the last of our 7 thumbnails, it has a value of 110 for each hotspot’s ath attributes.</p>
<p>That was just a quick look at some basic elements of the XML format used by the krpano viewer. In the next post we’ll see the source code for the finished application and talk about directions for future enhancements.</p>
