---
layout: "post"
title: "Displaying streamlines in the Forge viewer"
date: "2018-09-11 14:43:22"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk Research"
  - "IoT"
  - "MX3D"
original_url: "https://www.keanw.com/2018/09/displaying-streamlines-in-the-forge-viewer.html "
typepad_basename: "displaying-streamlines-in-the-forge-viewer"
typepad_status: "Publish"
---

<p>The integration of the MeshLine library into the Forge viewer – which we’re using for the display of skeleton data, as we saw <a href="http://keanw.com/2018/09/displaying-skeletons-in-the-forge-viewer-part-3.html" target="_blank">last time</a> – has opened the door to displaying all kinds of other cool stuff.</p><p>Back in 2014 colleagues in <a href="http://autodeskresearch.com" target="_blank">Autodesk Research</a> published a <a href="http://www.keanw.com/2018/06/simaud-2018.html" target="_blank">SimAUD</a> paper entitled “<a href="https://autodeskresearch.com/publications/multitimescales" target="_blank">Towards Visualization of Simulated Occupants and their Interactions with Buildings at Multiple Time Scales</a>”. It explored the use of various visualization techniques to display how a building’s simulated occupants interact with it. One of these techniques was called Speedlines (we also use the term Streamline):</p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2022ad3b030d1200b-pi" target="_blank"><img width="495" height="375" title="Speedlines" style="margin: 30px auto; border-image: none; float: none; display: block; background-image: none;" alt="Speedlines" src="/assets/image_314762.jpg" border="0"></a></p><p>The original visualizations were created using a custom Maya plugin. Here’s a video that was published as part of the research, to give a better sense of what it was about:</p><p><br></p><p align="center"><iframe width="500" height="281" src="https://www.youtube-nocookie.com/embed/vu_KSyeUMEY?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen="" allow="autoplay; encrypted-media"></iframe></p><p><br></p><p>Anyway, once we’d worked out how to use MeshLines inside the Forge viewer, it became clear the mechanism might be used to display Streamlines/Speedlines, too. It wasn’t totally straighforward, though: I went down various rabbitholes before settling on the current implementation. Here are the big ones:</p><ul><li>Creating multiple MeshLines – one for each state change of the Streamline – as I didn’t find a way to modify the width or thickness dynamically.</li><li>Creating a MeshLine with lots of dummy vertices, so that we could have it grow through the length of the Streamline and disappear at the other end.</li></ul><p>Both of these worked, in their own way, but neither were ideal (both in terms of performance and resource usage). All of these efforts related to the need to grow the Streamline from the beginning to the end, and then have it fade along the same path… both of which convey movement in a certain direction.</p><p>Eventually I realised I could use the visibility setting of the MeshLine’s material to let the Streamline grow along its length. The only problem was the visibility was always relative to the MeshLine’s direction.</p><p>In the end I was able to modify the MeshLine’s shader to enable to the use of negative visibility values: the negative ones meant that visibility should be calculated in the reverse direction: from the end of the line back to its beginning. This is a change to the library that I’ll submit back to the original GitHub repo as a Pull Request, in case it’s of value. (Hopefully it will either be accepted or the author will point me at a better way to achieve the same thing.)</p><p>Here’s how the Streamlines look in the Forge viewer. The good news is that we can also tweak the frequency to display Speedlines, if needed.</p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2022ad36a4f61200c-pi" target="_blank"><img width="500" height="326" title="Streaming" style="margin: 30px auto; float: none; display: block;" alt="Streaming" src="/assets/image_874566.jpg"></a></p><p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e2022ad3b030dc200b-pi" target="_blank"><img width="500" height="359" title="Speedlines from the side" style="margin: 30px auto; float: none; display: block;" alt="Speedlines from the side" src="/assets/image_612903.jpg"></a></p><p>Here’s the <a href="https://raw.githubusercontent.com/KeanW/THREE.MeshLine/345df62ebf2a9b3675037989e3ae4dfa771ab4ec/src/THREE.MeshLine.js" target="_blank">modified MeshLine library</a> and the TypeScript implementation of a Streamline class that uses it:</p><p><script src="https://gist.github.com/KeanW/1e001e51a4c7207c7f42fa4862905b7b.js"></script></p><p>The class can fit the provided points along a THREE.SplineCurve3 or just create an angular streamline with linear segments.</p><p>Here’s a StreamlineExtension – that admittedly has a few internal dependencies on Dasher 360 components – that created the above animation by generating a series of Streamlines within the current model’s bounding box.</p><p><script src="https://gist.github.com/KeanW/11020753c084c55cb0e6e0d6a2b5538c.js"></script></p><p>I know we’re going to find some really interesting uses for this mechanism, whether to display simulation results across multiple timescales, the movement of people across a bridge or the toolpath of an industrial robot. All of which are planned for <a href="http://dasher360.com" target="_blank">Dasher 360</a>, at some point. But it’s also going to be useful to display the results of other kinds of simulation and analyses, too: CFD seems like an obvious one, right off the bat.</p><p>My next post will probably relate to <a href="http://www.robarch2018.org/" target="_blank">Rob|Arch 2018</a>, which I’ll be attending for the rest of this week.</p>
