---
layout: "post"
title: "A handy jig for creating AutoCAD text using .NET &ndash; Part 3"
date: "2012-08-15 06:39:00"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Drawing structure"
  - "Jigs"
original_url: "https://www.keanw.com/2012/08/a-handy-jig-for-creating-autocad-text-using-net-part-3.html "
typepad_basename: "a-handy-jig-for-creating-autocad-text-using-net-part-3"
typepad_status: "Publish"
---

<p>Earlier in this series, we implemented <a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/a-handy-jig-for-creating-autocad-text-using-net-part-1.html" target="_blank">a jig to rotate, size and place text more easily in an AutoCAD drawing</a>, which we then <a href="http://through-the-interface.typepad.com/through_the_interface/2012/08/a-handy-jig-for-creating-autocad-text-using-net-part-2.html" target="_blank">extended to allow adjustment of font-level properties</a>. In this post, we’re going to add some additional functionality to allow the text to be justified differently around the cursor location.</p>  <p>It has to be said that the code introduced in this post isn’t very extensive, but nonetheless tricky to get right (and therefore deserving of its own post). It’s also worth noting that the changes would be much more complicated if we hadn’t designed the code to add the text to the database prior to passing it to the jig: that’s a pre-requisite for the code in this post to work properly.</p>  <p>The primary property we want to modify is DBText.HorizontalMode. We will set this to the following items in the TextHorizontalMode enumeration, depending on the keyword chosen: TextLeft, TextMid and TextRight. That’s the easy bit: the tricky part is that we also need to change the AlignmentPoint property, in the case where the HorizontalMode is <span style="text-decoration: underline">other than TextLeft</span>, and then call AdjustAlignment().</p>  <p>Here’s the updated C# code, with new lines marked in <span style="color: #ff0000">red</span> (and <a href="http://through-the-interface.typepad.com/files/quick-text.cs" target="_blank">here’s the source file</a> for you to download):</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 1</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 2</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 3</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 4</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 5</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsInterface;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 6</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 7</span>&#0160;<span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 8</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160;&#0160; 9</span>&#0160;<span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 10</span>&#0160;<span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 11</span>&#0160;<span style="line-height: 140%">&#0160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;QT&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 12</span>&#0160;<span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> QuickText()</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 13</span>&#0160;<span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 14</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 15</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 16</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db = doc.Database;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 17</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Editor</span><span style="line-height: 140%"> ed = doc.Editor;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 18</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 19</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptStringOptions</span><span style="line-height: 140%"> pso =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 20</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PromptStringOptions</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;\nEnter text string&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 21</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; pso.AllowSpaces = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 22</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptResult</span><span style="line-height: 140%"> pr = ed.GetString(pso);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 23</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 24</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (pr.Status != </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 25</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 26</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 27</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> tr =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 28</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; doc.TransactionManager.StartTransaction();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 29</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> (tr)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 30</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 31</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">BlockTableRecord</span><span style="line-height: 140%"> btr =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 32</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">BlockTableRecord</span><span style="line-height: 140%">)tr.GetObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 33</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.CurrentSpaceId, </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForWrite</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 34</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 35</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 36</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Create the text object, set its normal and contents</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 37</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 38</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">DBText</span><span style="line-height: 140%"> txt = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">DBText</span><span style="line-height: 140%">();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 39</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.Normal =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 40</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.CurrentUserCoordinateSystem.</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 41</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; CoordinateSystem3d.Zaxis;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 42</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.TextString = pr.StringResult;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 43</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 44</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We&#39;ll add the text to the database before jigging</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 45</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// it - this allows alignment adjustments to be</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 46</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// reflected</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 47</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 48</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; btr.AppendEntity(txt);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 49</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(txt, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 50</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 51</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Create our jig</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 52</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 53</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">TextPlacementJig</span><span style="line-height: 140%"> pj = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TextPlacementJig</span><span style="line-height: 140%">(tr, db, txt);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 54</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 55</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Loop as we run our jig, as we may have keywords</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 56</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 57</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%"> stat = </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.Keyword;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 58</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">while</span><span style="line-height: 140%"> (stat == </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.Keyword)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 59</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 60</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptResult</span><span style="line-height: 140%"> res = ed.Drag(pj);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 61</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; stat = res.Status;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 62</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 63</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; stat != </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK &amp;&amp;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 64</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; stat != </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.Keyword</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 65</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 66</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 67</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 68</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 69</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 70</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 71</span>&#0160;<span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 72</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 73</span>&#0160;<span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TextPlacementJig</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">EntityJig</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 74</span>&#0160;<span style="line-height: 140%">&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 75</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Declare some internal state</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 76</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 77</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> _db;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 78</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> _tr;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 79</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Point3d</span><span style="line-height: 140%"> _position;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 80</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> _angle, _txtSize;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 81</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> _toggleBold, _toggleItalic;</span></p>    <p style="margin: 0px"><span style="color: red">&#0160;&#0160; 82</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">TextHorizontalMode</span><span style="line-height: 140%"> _align;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 83</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 84</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Constructor</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 85</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 86</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> TextPlacementJig(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 87</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> tr, </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db, </span><span style="line-height: 140%; color: #2b91af">Entity</span><span style="line-height: 140%"> ent</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 88</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; ) : </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">(ent)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 89</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 90</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; _db = db;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 91</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; _tr = tr;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 92</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; _angle = 0;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 93</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; _txtSize = 1;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 94</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 95</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 96</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">protected</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%"> Sampler(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 97</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">JigPrompts</span><span style="line-height: 140%"> jp</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 98</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160;&#0160; 99</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 100</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We acquire a point but with keywords</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 101</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 102</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">JigPromptPointOptions</span><span style="line-height: 140%"> po =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 103</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">JigPromptPointOptions</span><span style="line-height: 140%">(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 104</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nPosition of text&quot;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 105</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 106</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 107</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; po.UserInputControls =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 108</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">UserInputControls</span><span style="line-height: 140%">.Accept3dCoordinates |</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 109</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">UserInputControls</span><span style="line-height: 140%">.NullResponseAccepted |</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 110</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">UserInputControls</span><span style="line-height: 140%">.NoNegativeResponseAccepted |</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 111</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">UserInputControls</span><span style="line-height: 140%">.GovernedByOrthoMode);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 112</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 113</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; po.SetMessageAndKeywords(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 114</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nSpecify position of text or &quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 115</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;[Bold/Italic/LArger/Smaller/&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 116</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;ROtate90/LEft/Middle/RIght]: &quot;</span><span style="line-height: 140%">,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 117</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;Bold Italic LArger Smaller &quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 118</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;ROtate90 LEft Middle RIght&quot;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 119</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 120</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 121</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptPointResult</span><span style="line-height: 140%"> ppr = jp.AcquirePoint(po);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 122</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 123</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (ppr.Status == </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.Keyword)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 124</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 125</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">switch</span><span style="line-height: 140%"> (ppr.StringResult)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 126</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 127</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;Bold&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 128</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 129</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _toggleBold = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 130</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 131</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 132</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;Italic&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 133</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 134</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _toggleItalic = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 135</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 136</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 137</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;LArger&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 138</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 139</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Multiple the text size by two</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 140</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 141</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _txtSize *= 2;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 142</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 143</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 144</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;Smaller&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 145</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 146</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Divide the text size by two</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 147</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 148</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _txtSize /= 2;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 149</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 150</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 151</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;ROtate90&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 152</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 153</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// To rotate clockwise we subtract 90 degrees and</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 154</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// then normalise the angle between 0 and 360</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 155</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 156</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _angle -= </span><span style="line-height: 140%; color: #2b91af">Math</span><span style="line-height: 140%">.PI / 2;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 157</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">while</span><span style="line-height: 140%"> (_angle &lt; </span><span style="line-height: 140%; color: #2b91af">Math</span><span style="line-height: 140%">.PI * 2)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 158</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 159</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _angle += </span><span style="line-height: 140%; color: #2b91af">Math</span><span style="line-height: 140%">.PI * 2;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 160</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 161</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 162</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 163</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;LEft&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 164</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 165</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _align = </span><span style="line-height: 140%; color: #2b91af">TextHorizontalMode</span><span style="line-height: 140%">.TextLeft;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 166</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 167</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 168</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;RIght&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 169</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 170</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _align = </span><span style="line-height: 140%; color: #2b91af">TextHorizontalMode</span><span style="line-height: 140%">.TextRight;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 171</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 172</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 173</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #a31515">&quot;Middle&quot;</span><span style="line-height: 140%">:</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 174</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 175</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _align = </span><span style="line-height: 140%; color: #2b91af">TextHorizontalMode</span><span style="line-height: 140%">.TextMid;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 176</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 177</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 178</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 179</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 180</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.OK;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 181</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 182</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (ppr.Status == </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 183</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 184</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Check if it has changed or not (reduces flicker)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 185</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 186</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 187</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _position.DistanceTo(ppr.Value) &lt;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 188</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Tolerance</span><span style="line-height: 140%">.Global.EqualPoint</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 189</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; )</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 190</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.NoChange;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 191</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 192</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _position = ppr.Value;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 193</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.OK;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 194</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 195</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 196</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SamplerStatus</span><span style="line-height: 140%">.Cancel;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 197</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 198</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 199</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">protected</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> Update()</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 200</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 201</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set properties on our text object</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 202</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 203</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">DBText</span><span style="line-height: 140%"> txt = (</span><span style="line-height: 140%; color: #2b91af">DBText</span><span style="line-height: 140%">)Entity;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 204</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 205</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.Position = _position;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 206</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.Height = _txtSize;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 207</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.Rotation = _angle;</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 208</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; txt.HorizontalMode = _align;</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 209</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (_align != </span><span style="line-height: 140%; color: #2b91af">TextHorizontalMode</span><span style="line-height: 140%">.TextLeft)</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 210</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 211</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; txt.AlignmentPoint = _position;</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 212</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; txt.AdjustAlignment(_db);</span></p>    <p style="margin: 0px"><span style="color: red">&#0160; 213</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 214</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 215</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set the bold and/or italic properties on the style</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 216</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 217</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (_toggleBold || _toggleItalic)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 218</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 219</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">TextStyleTable</span><span style="line-height: 140%"> tab =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 220</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">TextStyleTable</span><span style="line-height: 140%">)_tr.GetObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 221</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _db.TextStyleTableId, </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForRead</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 222</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 223</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 224</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">TextStyleTableRecord</span><span style="line-height: 140%"> style =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 225</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">TextStyleTableRecord</span><span style="line-height: 140%">)_tr.GetObject(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 226</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; txt.TextStyleId, </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForRead</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 227</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 228</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 229</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// A bit convoluted, but this check will tell us</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 230</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// whether the new style is bold/italic</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 231</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 232</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> bold = !(style.Font.Bold == _toggleBold);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 233</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> italic = !(style.Font.Italic == _toggleItalic);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 234</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _toggleBold = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 235</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _toggleItalic = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 236</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 237</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Get the new style name based on the old name and</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 238</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// a suffix (&quot;_BOLD&quot;, &quot;_ITALIC&quot; or &quot;_BOLDITALIC&quot;)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 239</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 240</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">var</span><span style="line-height: 140%"> oldName = style.Name.Split(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%">[] { </span><span style="line-height: 140%; color: #a31515">&#39;_&#39;</span><span style="line-height: 140%"> });</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 241</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> newName =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 242</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oldName[0] +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 243</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (bold || italic ? </span><span style="line-height: 140%; color: #a31515">&quot;_&quot;</span><span style="line-height: 140%"> +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 244</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (bold ? </span><span style="line-height: 140%; color: #a31515">&quot;BOLD&quot;</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #a31515">&quot;&quot;</span><span style="line-height: 140%">) +</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 245</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (italic ? </span><span style="line-height: 140%; color: #a31515">&quot;ITALIC&quot;</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #a31515">&quot;&quot;</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 246</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; : </span><span style="line-height: 140%; color: #a31515">&quot;&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 247</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 248</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We only create a duplicate style if one doesn&#39;t</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 249</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// already exist</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 250</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 251</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (tab.Has(newName))</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 252</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 253</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; txt.TextStyleId = tab[newName];</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 254</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 255</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 256</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 257</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We have to create a new style - clone the old one</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 258</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 259</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">TextStyleTableRecord</span><span style="line-height: 140%"> newStyle =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 260</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">TextStyleTableRecord</span><span style="line-height: 140%">)style.Clone();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 261</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 262</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set a new name to avoid duplicate keys</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 263</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 264</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; newStyle.Name = newName;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 265</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 266</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Create a new font based on the old one, but with</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 267</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// our values for bold &amp; italic</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 268</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 269</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">FontDescriptor</span><span style="line-height: 140%"> oldFont = style.Font;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 270</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">FontDescriptor</span><span style="line-height: 140%"> newFont =</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 271</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">FontDescriptor</span><span style="line-height: 140%">(</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 272</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oldFont.TypeFace, bold, italic,</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 273</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; oldFont.CharacterSet, oldFont.PitchAndFamily</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 274</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 275</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 276</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set it on the style</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 277</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 278</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; newStyle.Font = newFont;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 279</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 280</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Add the new style to the text style table and</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 281</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// the transaction</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 282</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 283</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tab.UpgradeOpen();</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 284</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectId</span><span style="line-height: 140%"> styleId = tab.Add(newStyle);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 285</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; _tr.AddNewlyCreatedDBObject(newStyle, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 286</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 287</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// And finally set the new style on our text object</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 288</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 289</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; txt.TextStyleId = styleId;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 290</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 291</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 292</span>&#0160;</p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 293</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 294</span>&#0160;<span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 295</span>&#0160;<span style="line-height: 140%">&#0160; }</span></p>    <p style="margin: 0px"><span style="color: #2b91af">&#0160; 296</span>&#0160;<span style="line-height: 140%">}</span></p> </div>  <p>When we run the updated QT command…</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">Command: <span style="color: #ff0000">QT</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Enter text string: <span style="color: #ff0000">Yet more text</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20177440aba0c970d-pi" target="_blank"><img alt="Left justified to start" border="0" height="199" src="/assets/image_527921.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Left justified to start" width="324" /></a></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">M</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20177440aba17970d-pi" target="_blank"><img alt="Then switch to middle" border="0" height="177" src="/assets/image_731135.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Then switch to middle" width="265" /></a></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">RI</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201761724aac8970c-pi" target="_blank"><img alt="Finish up with right" border="0" height="200" src="/assets/image_942121.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Finish up with right" width="327" /></a></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">I</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">RO</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">RO</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">RO</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]: <span style="color: #ff0000">S</span></span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#0160;</span></p>    <p style="margin: 0px"><span style="line-height: 140%"><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201761724aadc970c-pi" target="_blank"><img alt="Apply some other options" border="0" height="200" src="/assets/image_922114.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Apply some other options" width="141" /></a></span></p>    <p style="margin: 0px"><span style="line-height: 140%">Specify position of text or</span></p>    <p style="margin: 0px"><span style="line-height: 140%">[Bold/Italic/LArger/Smaller/ROtate90/LEft/Middle/RIght]:</span></p>    <p style="margin: 0px">&#0160;</p> </div>  <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e20167692fa84b970b-pi" target="_blank"><img alt="And then place it" border="0" height="202" src="/assets/image_516277.jpg" style="background-image: none; border-right-width: 0px; margin: 20px auto; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="And then place it" width="140" /></a></p>  <p>The overall functionality seems very useful (thanks for the suggestion, Thomas! :-) and certainly streamlines the creation of simple text inside a drawing.</p>  <p>That’s all I currently have planned for this series of posts, but be sure to let me know if there’s functionality you would like to see added (something related to Annotation Scaling, perhaps?).</p>
