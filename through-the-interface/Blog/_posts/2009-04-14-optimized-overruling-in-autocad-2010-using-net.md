---
layout: "post"
title: "Optimized overruling in AutoCAD 2010 using .NET"
date: "2009-04-14 11:05:44"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "AutoCAD .NET"
  - "Custom objects"
  - "Graphics system"
  - "Notification / Events"
  - "Overrules"
  - "Solid modeling"
original_url: "https://www.keanw.com/2009/04/optimized-overruling-in-autocad-2010-using-net.html "
typepad_basename: "optimized-overruling-in-autocad-2010-using-net"
typepad_status: "Publish"
---

<p>In <a href="http://through-the-interface.typepad.com/through_the_interface/2009/04/lets-get-specific-customizing-the-display-of-individual-autocad-objects-using-net.html">the last post</a> we looked at some code that attaches additional data to individual entities, allowing them to be drawn independently with different visual properties via the new Overrule API in AutoCAD 2010.</p> <p>A couple of comments – one from Qun, who provided <a href="http://through-the-interface.typepad.com/through_the_interface/2009/03/customizing-the-display-of-standard-autocad-objects-using-f.html">the original F#</a> sample, and one from Tony Tanzillo – have prompted me to optimize the code somewhat. Tony pointed out, very validly, that as the previous code registers its overrule against Drawable objects it will get called for every entity (and various objects besides) which could clearly impact performance. Qun pointed me to some interesting framework capabilities that allow you to let AutoCAD decide whether to call your overrule based on the existence of certain XData or some other criterion (such as the existence of a particular entry in the object’s extension dictionary).</p> <p>So here’s what I’ve done…</p> <p>I decided to define separate overrule classes for each object type we want to handle and have these classes derive from a common abstract base class. This allows us to encapsulate all the common XData-related stuff inside the base class, and leave the child classes to worry about the type-specific display. We will then register our overrules for the specific classes they care about, which will lead them to only being called for objects of those types.</p> <p>A nice feature is the ability to let AutoCAD filter on the existence of specific XData prior to invoking our overrule: check out the constructor of the PipeOverrule class – it calls SetXDataFilter() on the base DrawableOverrule class, telling AutoCAD the registered application name for which to look. An interesting test: draw some lines and/or circles, and use the MP command in the below sample to attach radii to some of them. If you set a breakpoint in your WorldDraw() functions and run the code as it stands, you’ll see that they only get called for the circles/lines that have been modified by the MP command. If you comment that one line, you should see WorldDraw() being called for all circles and lines, irrespective of whether they’ve been given a radius or not.</p> <p>Before we get into the code, here’s the protocol for the DrawableOverrule class, as provided by Visual Studio:</p> <div style="font-family: courier new; background: white; color: black; font-size: 8pt">  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsInterface</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">{</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; [Wrapper(</span><span style="line-height: 140%; color: #a31515">&quot;AcGiDrawableOverrule&quot;</span><span style="line-height: 140%">)]</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> DrawableOverrule : Overrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">protected</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">internal</span><span style="line-height: 140%"> DrawableOverrule();</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">virtual</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> SetAttributes(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Drawable drawable, DrawableTraits traits);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">sealed</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetCustomFilter();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">sealed</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetExtensionDictionaryEntryFilter(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> entryName);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">sealed</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetIdFilter(ObjectId[] ids);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">sealed</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetNoFilter();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">sealed</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetXDataFilter(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> registeredApplicationName);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">virtual</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> ViewportDraw(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Drawable drawable, ViewportDraw vd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">virtual</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> ViewportDrawLogicalFlags(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Drawable drawable, ViewportDraw vd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">virtual</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> WorldDraw(Drawable drawable, WorldDraw wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">}</span></p> </div>  <p>Aside from filtering on XData, we can see that we can also filter on specific ObjectIds (good for overruling objects very specifically), extension dictionary entries (good if you’re working with lots of data per object and XData is no longer viable) or something more custom.</p> <p>Here’s the protocol for the Overrule class, the base class for DrawableOverrule:</p> <div style="font-family: courier new; background: white; color: black; font-size: 8pt">  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">{</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; [Wrapper(</span><span style="line-height: 140%; color: #a31515">&quot;AcRxOverrule&quot;</span><span style="line-height: 140%">)]</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> Overrule : RXObject</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> Overruling { </span><span style="line-height: 140%; color: blue">get</span><span style="line-height: 140%">; </span><span style="line-height: 140%; color: blue">set</span><span style="line-height: 140%">; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> AddOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; RXClass targetClass, Overrule overrule, </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> bAtLast);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> HasOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; RXObject overruledSubject, RXClass targetClass);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">virtual</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> IsApplicable(RXObject overruledSubject);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> RemoveOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; RXClass targetClass, Overrule overrule);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetCustomFilter();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetExtensionDictionaryEntryFilter(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> entryName);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetIdFilter(ObjectId[] ids);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetNoFilter();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetXDataFilter(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> registeredApplicationName);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">}</span></p> </div>  <p>The protocol in which we’re interested has been declared as abstract (== pure virtual) at this level, so we need to use DrawableOverrule as a base class unless we want to implement the protocol ourselves. One additional function to be overridden at this level is IsApplicable(), which is the fundamental way the overrule tells AutoCAD whether it can work with a specific object, or not. This is the function we would override to implement a custom filter, and is the only part of the filter protocol available from ObjectARX: more work has been done on the .NET side of things, which thankfully makes our lives much simpler. :-)</p> <p>One open question in my mind: while asking AutoCAD to filter on XData is simpler and means our code is called less often, it does mean that both AutoCAD and our code will be checking for XData (when we retrieve the radius information). Presumably AutoCAD is going to check very efficiently, which means the code should be quicker in the cases where we have lots of objects that are not overruled, but in the cases where we are overruling a lot of objects there does appear to be some potential for this making the application run marginally slower. Ultimately – as mentioned earlier - there’s just a single line of code to comment out if you want to see the difference (and presumably profile the performance in some way). Just something to watch for, in case – I doubt this is something that’s going to have a significant – or even measurable – performance impact, but anyway.</p> <p>Here’s the modified C# code:</p> <div style="font-family: courier new; background: white; color: black; font-size: 8pt">  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.EditorInput;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Geometry;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.GraphicsInterface;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Colors;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> DrawOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">{</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">abstract</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PipeOverrule</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">DrawableOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">const</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%"> regAppName = </span><span style="line-height: 140%; color: #a31515">&quot;TTIF_PIPE&quot;</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> PipeOverrule()</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Tell AutoCAD to filter on our application name</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// (this means our overrule will only be called</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// on objects possessing XData with this name)</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; SetXDataFilter(regAppName);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Get the XData for a particular object</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// and return the &quot;pipe radius&quot; if it exists</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> PipeRadiusForObject(</span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%"> obj)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> res = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> rb = obj.XData;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (rb != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> foundStart = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">foreach</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%"> tv </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> rb)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (tv.TypeCode == (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DxfCode</span><span style="line-height: 140%">.ExtendedDataRegAppName &amp;&amp;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tv.Value.ToString() == regAppName)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; foundStart = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (foundStart == </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (tv.TypeCode == (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DxfCode</span><span style="line-height: 140%">.ExtendedDataReal)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; res = (</span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%">)tv.Value;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rb.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> res;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set the &quot;pipe radius&quot; in the XData of a particular object</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> SetPipeRadiusOnObject(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> tr, </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%"> obj, </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> radius</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; )</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db = obj.Database;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Make sure the application is registered</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// (we could separate this out to be called</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// only once for a set of operations)</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RegAppTable</span><span style="line-height: 140%"> rat =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: #2b91af">RegAppTable</span><span style="line-height: 140%">)tr.GetObject(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.RegAppTableId,</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForRead</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (!rat.Has(regAppName))</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rat.UpgradeOpen();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RegAppTableRecord</span><span style="line-height: 140%"> ratr = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">RegAppTableRecord</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ratr.Name = regAppName;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; rat.Add(ratr);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.AddNewlyCreatedDBObject(ratr, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Create the XData and set it on the object</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> rb =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DxfCode</span><span style="line-height: 140%">.ExtendedDataRegAppName, regAppName</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ),</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DxfCode</span><span style="line-height: 140%">.ExtendedDataReal, radius</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; )</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; obj.XData = rb;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; rb.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: green">// An overrule to make a pipe out of line</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">LinePipeOverrule</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">PipeOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">LinePipeOverrule</span><span style="line-height: 140%"> theOverrule =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">LinePipeOverrule</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SweepOptions</span><span style="line-height: 140%"> sweepOpts = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SweepOptions</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> WorldDraw(</span><span style="line-height: 140%; color: #2b91af">Drawable</span><span style="line-height: 140%"> d, </span><span style="line-height: 140%; color: #2b91af">WorldDraw</span><span style="line-height: 140%"> wd)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> radius = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (d </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius = PipeRadiusForObject((</span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)d);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (radius &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Line</span><span style="line-height: 140%"> line = d </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Line</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (line != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Draw the line as is, with overruled attributes</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.WorldDraw(line, wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (!line.Id.IsNull &amp;&amp; line.Length &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Draw a pipe around the line</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">EntityColor</span><span style="line-height: 140%"> c =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.TrueColor;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.TrueColor =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">EntityColor</span><span style="line-height: 140%">(0x00AfAfff);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.LineWeight =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">LineWeight</span><span style="line-height: 140%">.LineWeight000;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%"> clr =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; line.StartPoint,</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; line.EndPoint - line.StartPoint,</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ExtrudedSurface</span><span style="line-height: 140%"> pipe = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ExtrudedSurface</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">try</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.CreateExtrudedSurface(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; clr, line.EndPoint - line.StartPoint, sweepOpts</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">catch</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Editor.WriteMessage(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nFailed with CreateExtrudedSurface.&quot;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; clr.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.WorldDraw(wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.TrueColor = c;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.WorldDraw(d, wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> SetAttributes(</span><span style="line-height: 140%; color: #2b91af">Drawable</span><span style="line-height: 140%"> d, </span><span style="line-height: 140%; color: #2b91af">DrawableTraits</span><span style="line-height: 140%"> t)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> b = </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.SetAttributes(d, t);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> radius = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (d </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius = PipeRadiusForObject((</span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)d);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (radius &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set color to index 6</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; t.Color = 6;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// and lineweight to .40 mm</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; t.LineWeight = </span><span style="line-height: 140%; color: #2b91af">LineWeight</span><span style="line-height: 140%">.LineWeight040;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> b;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: green">// An overrule to make a pipe out of circle</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">CirclePipeOverrule</span><span style="line-height: 140%"> : </span><span style="line-height: 140%; color: #2b91af">PipeOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">CirclePipeOverrule</span><span style="line-height: 140%"> theOverrule =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">CirclePipeOverrule</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SweepOptions</span><span style="line-height: 140%"> sweepOpts = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SweepOptions</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> WorldDraw(</span><span style="line-height: 140%; color: #2b91af">Drawable</span><span style="line-height: 140%"> d, </span><span style="line-height: 140%; color: #2b91af">WorldDraw</span><span style="line-height: 140%"> wd)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> radius = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (d </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius = PipeRadiusForObject((</span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)d);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (radius &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%"> circle = d </span><span style="line-height: 140%; color: blue">as</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (circle != </span><span style="line-height: 140%; color: blue">null</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Draw the circle as is, with overruled attributes</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.WorldDraw(circle, wd);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Needed to avoid ill-formed swept surface</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (circle.Radius &gt; radius)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Draw a pipe around the cirle</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">EntityColor</span><span style="line-height: 140%"> c = wd.SubEntityTraits.TrueColor;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.TrueColor =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">EntityColor</span><span style="line-height: 140%">(0x3fffe0e0);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.LineWeight =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">LineWeight</span><span style="line-height: 140%">.LineWeight000;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Vector3d</span><span style="line-height: 140%"> normal =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; (circle.Center - circle.StartPoint).</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; CrossProduct(circle.Normal);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%"> clr =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; circle.StartPoint, normal, radius</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">SweptSurface</span><span style="line-height: 140%"> pipe = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">SweptSurface</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.CreateSweptSurface(clr, circle, sweepOpts);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; clr.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.WorldDraw(wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pipe.Dispose();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; wd.SubEntityTraits.TrueColor = c;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.WorldDraw(d, wd);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">override</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> SetAttributes(</span><span style="line-height: 140%; color: #2b91af">Drawable</span><span style="line-height: 140%"> d, </span><span style="line-height: 140%; color: #2b91af">DrawableTraits</span><span style="line-height: 140%"> t)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> b = </span><span style="line-height: 140%; color: blue">base</span><span style="line-height: 140%">.SetAttributes(d, t);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> radius = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (d </span><span style="line-height: 140%; color: blue">is</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; radius = PipeRadiusForObject((</span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%">)d);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (radius &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set color to index 2</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; t.Color = 2;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// and lineweight to .60 mm</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; t.LineWeight = </span><span style="line-height: 140%; color: #2b91af">LineWeight</span><span style="line-height: 140%">.LineWeight060;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> b;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Commands</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">private</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">double</span><span style="line-height: 140%"> _radius = 0.0;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> Overrule(</span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> enable)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Regen to see the effect</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// (turn on/off Overruling and LWDISPLAY)</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">DrawableOverrule</span><span style="line-height: 140%">.Overruling = enable;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (enable)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.SetSystemVariable(</span><span style="line-height: 140%; color: #a31515">&quot;LWDISPLAY&quot;</span><span style="line-height: 140%">, 1);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">else</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.SetSystemVariable(</span><span style="line-height: 140%; color: #a31515">&quot;LWDISPLAY&quot;</span><span style="line-height: 140%">, 0);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; doc.SendStringToExecute(</span><span style="line-height: 140%; color: #a31515">&quot;REGEN3\n&quot;</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; doc.Editor.Regen();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;OVERRULE1&quot;</span><span style="line-height: 140%">)]</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> OverruleStart()</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectOverrule</span><span style="line-height: 140%">.AddOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RXClass</span><span style="line-height: 140%">.GetClass(</span><span style="line-height: 140%; color: blue">typeof</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">Line</span><span style="line-height: 140%">)),</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">LinePipeOverrule</span><span style="line-height: 140%">.theOverrule,</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">true</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectOverrule</span><span style="line-height: 140%">.AddOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RXClass</span><span style="line-height: 140%">.GetClass(</span><span style="line-height: 140%; color: blue">typeof</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%">)),</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">CirclePipeOverrule</span><span style="line-height: 140%">.theOverrule,</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">true</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Overrule(</span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;OVERRULE0&quot;</span><span style="line-height: 140%">)]</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> OverruleEnd()</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectOverrule</span><span style="line-height: 140%">.RemoveOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RXClass</span><span style="line-height: 140%">.GetClass(</span><span style="line-height: 140%; color: blue">typeof</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">Line</span><span style="line-height: 140%">)),</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">LinePipeOverrule</span><span style="line-height: 140%">.theOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">ObjectOverrule</span><span style="line-height: 140%">.RemoveOverrule(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">RXClass</span><span style="line-height: 140%">.GetClass(</span><span style="line-height: 140%; color: blue">typeof</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #2b91af">Circle</span><span style="line-height: 140%">)),</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">CirclePipeOverrule</span><span style="line-height: 140%">.theOverrule</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; Overrule(</span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;MP&quot;</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: #2b91af">CommandFlags</span><span style="line-height: 140%">.UsePickSet)]</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> MakePipe()</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db = doc.Database;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Editor</span><span style="line-height: 140%"> ed = doc.Editor;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Ask the user to select the entities to make into pipes</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptSelectionOptions</span><span style="line-height: 140%"> pso =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PromptSelectionOptions</span><span style="line-height: 140%">();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; pso.AllowDuplicates = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; pso.MessageForAdding =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nSelect objects to turn into pipes: &quot;</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptSelectionResult</span><span style="line-height: 140%"> selRes =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.Editor.GetSelection(pso);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// If the user didn&#39;t make valid selection, we return</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (selRes.Status != </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">SelectionSet</span><span style="line-height: 140%"> ss = selRes.Value;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Ask the user for the pipe radius to set</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptDoubleOptions</span><span style="line-height: 140%"> pdo =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">PromptDoubleOptions</span><span style="line-height: 140%">(</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #a31515">&quot;\nSpecify pipe radius:&quot;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; );</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Use the previous value, if if already called</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (_radius &gt; 0.0)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pdo.DefaultValue = _radius;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pdo.UseDefaultValue = </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; pdo.AllowNegative = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; pdo.AllowZero = </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PromptDoubleResult</span><span style="line-height: 140%"> pdr =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ed.GetDouble(pdo);</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Return if something went wrong</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (pdr.Status != </span><span style="line-height: 140%; color: #2b91af">PromptStatus</span><span style="line-height: 140%">.OK)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%">;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Set the &quot;last radius&quot; value for when</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// the command is called next</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; _radius = pdr.Value;</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Use a transaction to edit our various objects</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> tr =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; db.TransactionManager.StartTransaction();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> (tr)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// Lop through the selected objects</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: blue">foreach</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">SelectedObject</span><span style="line-height: 140%"> o </span><span style="line-height: 140%; color: blue">in</span><span style="line-height: 140%"> ss)</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// We could choose only to add XData to the objects</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: green">// we know will use it (Lines and Circles, for now)</span></p>  <p style="margin: 0px; font-size: 8pt">&#0160;</p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">DBObject</span><span style="line-height: 140%"> obj =</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.GetObject(o.ObjectId, </span><span style="line-height: 140%; color: #2b91af">OpenMode</span><span style="line-height: 140%">.ForWrite);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span><span style="line-height: 140%; color: #2b91af">PipeOverrule</span><span style="line-height: 140%">.SetPipeRadiusOnObject(tr, obj, _radius);</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; tr.Commit();</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160;&#0160;&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">&#0160; }</span></p>  <p style="margin: 0px; font-size: 8pt"><span style="line-height: 140%">}</span></p> </div>  <p>In terms of what happens when we run the code, here are the results from the previous post (as it should function identically).</p> <p>First some simple geometry for which we’re going to overrule the display:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201157010503f970b-pi"><img alt="2D wireframe display of individual lines and circles" border="0" height="260" src="/assets/image_471515.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="2D wireframe display of individual lines and circles" width="481" /></a> </p> <p>And here’s some geometry for which we’ve attached radii using the MP command, once we’ve turned our overrules on via the OVERRULE1 command:</p> <p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201156f195be7970c-pi"><img alt="3D conceptual display of overruled individual lines and circles" border="0" height="260" src="/assets/image_112773.jpg" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="3D conceptual display of overruled individual lines and circles" width="480" /></a></p>
