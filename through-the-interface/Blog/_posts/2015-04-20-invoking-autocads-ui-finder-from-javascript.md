---
layout: "post"
title: "Invoking AutoCAD&rsquo;s UI Finder from JavaScript"
date: "2015-04-20 16:25:44"
author: "Kean Walmsley"
categories:
  - "AutoCAD"
  - "Commands"
  - "HTML"
  - "JavaScript"
  - "User interface"
original_url: "https://www.keanw.com/2015/04/invoking-autocads-ui-finder-from-javascript.html "
typepad_basename: "invoking-autocads-ui-finder-from-javascript"
typepad_status: "Publish"
---

<p>On my flight back from Singapore I started thinking about how an app might help people discover what’s new in the AutoCAD UI from release to release. This might also work for custom functionality, but that’s not (currently) my main concern. I was thinking of displaying some kind of palette that cycles through the new commands and features in a release, highlighting the associated ribbon buttons, etc., using the AutoCAD help system’s excellent UI Finder capability.</p>  <p>Over the weekend I started looking at how it might work – whether it was possible to call the UI Finder from an app (not just the web-based help, itself). Here’s what I found out: given the right “help IDs”, we can launch the HelpFindUI() method (which we call using exec() from JavaScript) and have it highlight the UI capability we’re interested in.</p>  <p>Here’s a quick demo to illustrate. At this stage it’s just looping through a fixed set of commands – and with no UI to explain what’s happening – but it should clarify the intention, at least.</p>  <br /><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201bb08205ef4970d-pi" target="_blank"><img title="UI Finder automation" style="float: none; margin-left: auto; display: block; margin-right: auto" alt="UI Finder automation" src="/assets/image_152233.jpg" width="400" height="150" /></a>  <br />  <br />  <p>There are a couple of points to note: the name of the function we need to call has a new prefix in AutoCAD 2016, so we have to code around that. I also found that we need to launch HELP for the HelpFindUI() method to be available: presumably a module gets loaded or something else gets initialized when this happens. I looked into what, specifically, but ended up deciding to launch HELP when our JavaScript gets loaded… we can tweak that, later on, but it does the trick, for now.</p>  <p>Here’s the JavaScript code to make this happen:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: green">// A few command IDs to loop through</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">var</span> dispCmds =</p>    <p style="margin: 0px">&#160; [<span style="color: #a31515">&quot;ID_Box&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_Scale&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_Extrude&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_Cone&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_3dalign&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_CONV2SOLID&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_Import&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;ID_Offset&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160; <span style="color: #a31515">&quot;&quot;</span></p>    <p style="margin: 0px">&#160; ];</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// A few topic IDs to loop through</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">var</span> dispTops =</p>    <p style="margin: 0px">&#160; [</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #a31515">&quot;3DDWF&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #a31515">&quot;3DPRINT&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #a31515">&quot;VIEWPLOTDETAILS&quot;</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #a31515">&quot;&quot;</span></p>    <p style="margin: 0px">&#160; ];</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> findBox() {</p>    <p style="margin: 0px">&#160; locateCommand(dispCmds[0], <span style="color: blue">false</span>); <span style="color: green">// 1st item in the array</span></p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> findCmds() {</p>    <p style="margin: 0px">&#160; locateCommands(dispCmds.slice(0), <span style="color: blue">false</span>); <span style="color: green">// Copies the array</span></p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> findTops() {</p>    <p style="margin: 0px">&#160; locateCommands(dispTops.slice(0), <span style="color: blue">true</span>); <span style="color: green">// Copies the array</span></p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> locateCommands(cmds, topic) {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Pop the first item off the array</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> cmd = cmds.shift();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">if</span> (cmd != <span style="color: blue">null</span>) {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Find a single command/UI element</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; locateCommand(cmd, topic);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">// Find the rest, after a 2 second delay</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; setTimeout(<span style="color: blue">function</span> () { locateCommands(cmds); }, 2000);</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">function</span> locateCommand(id, topic) {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> fn = <span style="color: #a31515">&quot;HelpFindUI&quot;</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// In 2016 onwards we need the help_Api prefix</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">if</span> (<span style="color: blue">typeof</span> (apiVersion) == <span style="color: #a31515">'function'</span> &amp;&amp; apiVersion() &gt; 2)</p>    <p style="margin: 0px">&#160;&#160;&#160; fn = <span style="color: #a31515">&quot;help_Api.&quot;</span> + fn;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Package up the JSON required to call our function</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> json = {</p>    <p style="margin: 0px">&#160;&#160;&#160; functionName: fn,</p>    <p style="margin: 0px">&#160;&#160;&#160; invokeAsCommand: <span style="color: blue">false</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160; functionParams: { ID: id, IsTopic: topic }</p>    <p style="margin: 0px">&#160; };</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green">// Call it (ignore the return value, unless debugging)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">var</span> ret = exec(JSON.stringify(json));</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">Acad.Editor.addCommand(</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;HELP_CMDS&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FC&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FC&quot;</span>,</p>    <p style="margin: 0px">&#160; Acad.CommandFlag.MODAL,</p>    <p style="margin: 0px">&#160; findBox</p>    <p style="margin: 0px">);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">Acad.Editor.addCommand(</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;HELP_CMDS&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FCS&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FCS&quot;</span>,</p>    <p style="margin: 0px">&#160; Acad.CommandFlag.MODAL,</p>    <p style="margin: 0px">&#160; findCmds</p>    <p style="margin: 0px">);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">Acad.Editor.addCommand(</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;HELP_CMDS&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FTS&quot;</span>,</p>    <p style="margin: 0px">&#160; <span style="color: #a31515">&quot;FTS&quot;</span>,</p>    <p style="margin: 0px">&#160; Acad.CommandFlag.MODAL,</p>    <p style="margin: 0px">&#160; findTops</p>    <p style="margin: 0px">);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// Launch HELP at the end of the command... this allows the</span></p>    <p style="margin: 0px"><span style="color: green">// UI finder to work properly</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">Acad.Editor.executeCommand(<span style="color: #a31515">&quot;_.HELP&quot;</span>);</p> </div>  <p>If you save this to a .js file, you can then WEBLOAD it into AutoCAD 2015 or 2016 and give it a try.</p>  <p>The code implements a few commands: FC highlights a single command button (the one for BOX), while FCS loops through a sequence of such commands with a 2 second delay between each. FTS does the same but for help topics rather than individual commands, although it doesn’t seem to work as consistently as the command-locating version, for now.</p>  <p>To take this further, I’m going to look at locating the various help IDs from the documentation. I may even end up hitting the command-line for an old school <a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?grep" target="_blank">grep</a> &amp; <a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?sed" target="_blank">sed</a> session, which might be fun. At some point I’ll also look at implementing some kind of web-based UI to drive this… probably cycling through a list of commands in a palette while highlighting the associated UI elements.</p>
