---
layout: "post"
title: "Realtime collaboration inside the Forge viewer: a hackathon project"
date: "2021-01-14 11:02:59"
author: "Kean Walmsley"
categories:
  - "APS (Forge)"
  - "Autodesk"
original_url: "https://www.keanw.com/2021/01/realtime-collaboration-inside-the-forge-viewer-a-hackathon-project.html "
typepad_basename: "realtime-collaboration-inside-the-forge-viewer-a-hackathon-project"
typepad_status: "Publish"
---

<p>Just before the holiday break I had an interesting chat with Elias Cohenca (someone I’ve <a href="https://www.keanw.com/2019/05/meet-my-mentees.html">mentored on and off over the last few years</a>). He was about to participate in his 6th annual hackathon in the Tel Aviv office, and wanted to bounce a few ideas off me regarding technologies.</p><p>Our Tel Aviv office has held these hackathons – named Bazinga, after Sheldon Cooper’s catchphrase in the Big Bang Theory – since 2015. Elias has used the hackathon to try out some really interesting concepts, over the years, from adding BIM 360 issues into a mixed-reality environment using HoloLens to <a href="https://www.keanw.com/2020/01/additively-manufacturing-music-using-the-printesizer.html">building synthesizers using the noises made by 3D printers and stepper motors</a>. Last year Elias collaborated on Amit Diamant’s great geometry loader implementation that has since found its way into the Forge viewer.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20278800d6aec200d-pi" target="_blank"><img width="500" height="314" title="Bazinga" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Bazinga" src="/assets/image_12308.jpg" border="0"></a></p><p>The themes for Bazinga 2020 – which was the first “Home Edition”, given the current pandemic – related to improving our products, contributing to the Tel Aviv site and facilitating remote working/collaboration. Elias teamed up with Doreen Dvoretz and Amit Diamant to focus on two of these themes, to create a remote collaboration capability integrated directly into the Forge viewer.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bdeb5983c200c-pi" target="_blank"><img width="500" height="165" title="Doreen, Elias and Amit" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Doreen, Elias and Amit" src="/assets/image_681277.jpg" border="0"></a></p><p>Their concept was called Big Room, which would allow people to visualize construction projects before they’re built. It would enable collaboration between members of the design team and other stakeholders (clients, construction workers, etc.) in the context of a virtual model. </p><p>Elias was curious about what I’d done in this space, so I pointed him at <a href="http://vrok.it">Vrok-It</a>, which <a href="http://github.com/KeanW/Vrok-It">uses socket.io to communicate between a presenter and session participants</a>. I also mentioned the possibility of using Microsoft’s <a href="https://fluidframework.com/">Fluid Framework</a>, an emerging technology which might also provide some interesting capabilities.</p><p>Anyway, fast-forward to this week, when I had the chance to take a look at what the Big Room team had achieved. It turns out that they had managed to meet all of their MVP goals:</p><blockquote><ul><li>Enable participants to easily join a shared virtual space within a 3D model.
<li>Allow different users to see each other as avatars.
</li><ul><li>Get their name automatically from their login.</li></ul><li>Allow participants to point at objects with a laser beam.
</li><li>Create a type of shared-screen experience, where all participants can follow one of the avatars in a guided tour.
<li>Enable hiding / isolating objects as participants navigate the 3D space.
<li>Take measurements of objects and share with other participants.</li></ul></blockquote><p>They had even managed to achieve their stretch goal of grabbing the user’s face via their webcam and mapping it onto their avatar.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e2026bdeb59842200c-pi" target="_blank"><img width="500" height="270" title="Amit and Doreen" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Amit and Doreen" src="/assets/image_919092.jpg" border="0"></a></p><p>Elias joined me for a remote collaboration session and it was super-cool. I really liked the laser pointer that not only allows you to highlight items visually in the model but also to select them.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e988475e200b-pi" target="_blank"><img width="500" height="319" title="Lasers" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Lasers" src="/assets/image_919202.jpg" border="0"></a></p><p>It was great to be able to get a virtual tour: one the avatars can share their viewpoint as they move around the model.</p><p>A shared view of measurements proved to be very useful, too.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e9884768200b-pi" target="_blank"><img width="500" height="321" title="Taking measurements" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Taking measurements" src="/assets/image_928014.jpg" border="0"></a></p><p>While it was only ever intended as a “nice to have”, the mapping of faces onto avatars was strangely compelling. Here’s an animation that gives a sense of how it worked:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20263e98847b3200b-pi" target="_blank"><img width="500" height="312" title="Chatting away" style="margin: 30px auto; float: none; display: block;" alt="Chatting away" src="/assets/image_810284.jpg"></a></p><p>You may notice that my face is animated at a lower framerate than Elias’s: this is actually an artefact of me watching the discussion from a second tab (I’m logged in twice, and the main participant is the one watching – as it’s the tab that has focus in the browser – rather than the one I’m watching). The face of the watcher animated at the same rate as Elias’s, apparently.</p><p>Elias mentioned the team had gone with <a href="http://socket.io">socket.io</a> for the communication, as we had with Vrok-It, and that they’d opted to capture low-res face bitmaps using <a href="https://github.com/justadudewhohacks/face-api.js/">face-api.js</a>. This is a browser-based computer vision library that uses machine learning (via <a href="https://github.com/tensorflow/tfjs">tensorflow.js</a>) to extract faces from images. They had considered going with <a href="https://webrtc.org/">WebRTC</a>, but really wanted to do frame-by-frame face extraction to be able to map it onto the avatar more realistically. (Hans Kellner showed me a really cool demo he put together back in 2015 that maps WebRTC video onto the side of an avatar cube in the Forge viewer, so this is definitely an alternative the team is interested in exploring.) As face-api.js provides facial keypoints, it would be cool to use these to do a better mapping of faces onto the avatar, or even to consider a lower-bandwidth approach that animates a static face image via keypoints, much as <a href="https://developer.nvidia.com/MAXINE">NVIDIA has done with the Maxine SDK</a>. One suggestion I made was to use the emotion information provided by face-api.js to change the colour of the avatar’s head based on what they appear to be feeling, but this could well prove to be annoying. It needs testing. :-)</p><p>Some work is still needed on performance and scalability, whether WebRTC is adopted or not: right now the frame-rate is limited – to maintain performance – to around 10 fps, for instance, and it does get choppy when there are lots of concurrent participants. That said, there are also a number of mitigation tactics that would be interesting to explore: at the moment the client ignores messages from participants not in their field of view (and beyond a certain distance), but the messaging overhead still impacts performance. Moving this to be performed server-side would stop the messages from even being sent, but would need much more state to be managed on the server. Socket.io does have the concept of rooms – right now the team uses one big room (haha) for all participants – and so mapping virtual rooms to physical ones might also help.</p><p>All-in-all this is a really fun project which actually has some real potential. The Big Room team won second prize (the first-placed project must have been incredible!), so congratulations to Doreen, Elias and Amit!</p><p>While they’re all now back at their day jobs, they’d love to hear from people who would be interested in seeing this developed further. If you’d like to talk more about this, please do get in touch – I’ll pass your feedback on to Doreen, Elias and Amit.</p>
