---
layout: "post"
title: "Displaying metrics for the MaRS graph inside Dynamo and Refinery"
date: "2019-04-26 16:59:46"
author: "Kean Walmsley"
categories:
  - "Autodesk Research"
  - "Dynamo"
  - "Generative design"
original_url: "https://www.keanw.com/2019/04/displaying-metrics-for-the-mars-graph-inside-dynamo-and-refinery.html "
typepad_basename: "displaying-metrics-for-the-mars-graph-inside-dynamo-and-refinery"
typepad_status: "Publish"
---

<p>The last few days have been a lot of fun, as some of you will have noticed on my <a href="https://twitter.com/keanw" target="_blank">Twitter</a> or <a href="https://www.linkedin.com/in/keanw/" target="_blank">LinkedIn</a> feeds.</p><p>Since <a href="https://www.keanw.com/2019/04/revisiting-mars-for-au-london-2019.html" target="_blank">the last post</a>, where I announced the fact we’ve been working on Project Rediscover, I’ve spent quite a bit of time reworking the graph to have more reusable chunks. Here’s a recent snapshot of the graph:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4a562b0200b-pi" target="_blank"><img width="500" height="312" title="A version of the MaRS graph in Dynamo" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="A version of the MaRS graph in Dynamo" src="/assets/image_108239.jpg" border="0"></a></p><p>In the last post, the subgraph that generates text for the metrics and the radar chart as geometry – both to the right of the image – was hardcoded to the exact metrics we were dealing with. To make it easier to add new metrics – as well as to be used with different metrics in another graph – I refactored that section of the graph to be more flexible and accept a list of metrics along with information on whether they’re to be minimised or maximised by <a href="https://www.autodesk.com/solutions/refinery-beta" target="_blank">Refinery</a>.</p><p>Here are the sections that display the text for the metrics as well as the radar graph:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a48195e1200d-pi" target="_blank"><img width="500" height="124" title="The subset of the graph for metrics display" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The subset of the graph for metrics display" src="/assets/image_411735.jpg" border="0"></a></p><p>I did my best to make the resultant graph customizable, such as with the number of bands to display. By default it displays 4 bands (representing 25% each). While making this configurable, I hit a really peculiar issue with DesignScript that I had to work around. We basically want to create a series of concentric circles (which we’ll use to create polygons): to do this we’ll use a range expression with a particular increment.</p><p>Ideally this should be <font face="Courier New">0..size..size/bands,</font> where <font face="Courier New">size</font> is the radius of the outermost circle (and its circumscribed polygon) and <font face="Courier New">bands</font> is the number of bands you want. Basically the resulting list should be starting with 0 and ending with 4.7, with <font face="Courier New">bands–2</font> entries in between.</p><p>I hit an interesting case where this failed, though. Let’s take the example of <font face="Courier New">size</font> being 4.7 and <font face="Courier New">bands</font> being 3. This expands out to 0..4.7..1.566666666666667. As the recurring 6 in the decimal rounds up, the range expression never actually reaches 4.7.</p><p>Here’s what I mean:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a48195cb200d-pi" target="_blank"><img width="400" height="299" title="Our rounding problem" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="Our rounding problem" src="/assets/image_105648.jpg" border="0"></a></p><p>To “fix” this – at least in terms of getting a final value that approximates the final target value of 4.7 – I added some code that removes the rounding. I couldn’t find an easy approach to truncate the decimal, so I converted it to a string, removed the last digit, and converted it back to a number. Ugh.</p><p>Anyway, it works:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a45863e1200c-pi" target="_blank"><img width="400" height="309" title="An acceptable alternative" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="An acceptable alternative" src="/assets/image_893800.jpg" border="0"></a></p><p>So now we’ll get the right number of bands, even when rounding errors might otherwise have stopped the range expressions from giving us what we wanted.</p><p>[<strong><em>Update</em></strong>: Jacob Small pointed out I can use a # within the DesignScript range to specify the number of bands, rather than the increment. This is much cleaner: 0..4.7..#4.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a4a78128200b-pi" target="_blank"><img width="280" height="276" title="A proper approach to fixing this" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="A proper approach to fixing this" src="/assets/image_471079.jpg" border="0"></a></p><p>I’m embarassed I missed this, but there you go. Thanks, Jacob!]</p><p>In order to prepare the metrics to be displayed in the radar graph, we have to do a little work to normalise them between 0 and 1 (or between 1 and 0 if the metric is supposed to be minimised, as we want to invert the display of minimised metrics in the graph).</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a45863fe200c-pi" target="_blank"><img width="500" height="315" title="The subgraph that prepares the metrics" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The subgraph that prepares the metrics" src="/assets/image_487284.jpg" border="0"></a></p><p>It’s nice to have the metric definition piece kept separate in a single place. The various metrics are calculated elsewhere, of course.</p><p>With that done, I decided to spend some time testing the graph with Refinery. Here’s a view of an optimisation run with the scatterplot displayed:</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a45790a1200c-pi" target="_blank"><img width="500" height="312" title="The MaRS graph with scatterplot displayed" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The MaRS graph with scatterplot displayed" src="/assets/image_320695.jpg" border="0"></a></p><p>And here it is with the parallel coordinates view… as you can see, it’s quite crowded given the number of input parameters.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a480bf4e200d-pi" target="_blank"><img width="500" height="312" title="The MaRS graph in parallel coordinates view" style="margin: 30px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" alt="The MaRS graph in parallel coordinates view" src="/assets/image_783100.jpg" border="0"></a></p><p>With Refinery generating options, I went and combined a few screengrabs into an animation.</p><p><a href="https://through-the-interface.typepad.com/.a/6a00d83452464869e20240a480bed3200d-pi" target="_blank"><img width="500" height="312" title="The few different solutions combined in an animation" style="margin: 30px auto; float: none; display: block;" alt="The few different solutions combined in an animation" src="/assets/image_276490.jpg"></a></p><p>That’s where I’ve left it, for now. We still have some work to do to finish the up the graph to be shared between now and AU London, particularly with respect to the daylight analysis… I’ll do what I can to share bits and pieces between now and June, where it makes sense.</p><p>The next topic I’m likely to cover relates to the use of Parallel.For[Each] in Python to get some performance gains, and whether that really makes sense in the context of Refinery, in particular.</p>
