---
layout: "post"
title: "Correcting creation and last modified folder attributes using PowerShell"
date: "2015-11-23 15:43:28"
author: "Kean Walmsley"
categories:
  - "PowerShell"
original_url: "https://www.keanw.com/2015/11/correcting-creation-and-last-modified-folder-attributes-using-powershell.html "
typepad_basename: "correcting-creation-and-last-modified-folder-attributes-using-powershell"
typepad_status: "Publish"
---

<p><a href="http://through-the-interface.typepad.com/.a/6a00d83452464869e201b8d17a04a7970c-pi" target="_blank"><img title="PowerShell logo" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: left; padding-top: 0px; padding-left: 0px; margin: 20px 20px 20px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="PowerShell logo" src="/assets/image_171398.jpg" width="187" align="left" height="127" /></a>The first snow of the season came, over the weekend, so it seemed a good time to write a post that was a little off-piste. :-)</p>  <p>It’s a topic that I don’t recall ever having broached: using PowerShell to mess with files and folders on your hard drive or a network server. This is my first serious use of PowerShell, so please use the code in this post with caution: I really can’t promise it won’t do bad things to your system.</p>  <p>A bit of background: a quick way to copy files around on Windows systems is using Explorer. This is nice and easy, but when it copies folders the new folders have their creation date/time set based on when they were created (i.e. copied). If you’re copying data that has been around for any serious amount of time, this probably isn’t what you want.</p>  <p>One solution is to use a better copying tool which maintains the folder attributes, of course (Robocopy being one solid alternative). But what about all those folders that were already copied and you no longer have the access to the originals?</p>  <p>Here’s what I wanted to do: loop through the folders in question, and set the creation date/time of each one to be the creation date/time of the oldest contained item, and the “last modified” date/time as the last modified date/time of the most recent. This won’t be the attribute vales you had before – those are gone, at this stage – but they’ll be a lot ore reflective of the folder’s contents and sorting and searching the contents much easier.</p>  <p>I’d think this would be a common enough requirement… I looked around for a tool that does it, but couldn’t find one. Time to write my own!</p>  <p>I did a couple of iterations on this… here’s the first I put together, which uses the standard -Recurse flag to handle nested folder structures:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: #bd63c5">$dir</span> = <span style="color: #a31515">&quot;c:\temp&quot;</span> <span style="color: green"># Starting folder</span></p>    <p style="margin: 0px"><span style="color: #ff8c00">Get-ChildItem</span> <span style="color: teal">-Path</span> <span style="color: #bd63c5">$dir</span> <span style="color: teal">-Recurse</span> | <span style="color: green"># Call recursively&#160;&#160;&#160;&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="color: #ff8c00">where</span> {<span style="color: #bd63c5">$_</span>.PSIsContainer} | <span style="color: green"># Only folders</span></p>    <p style="margin: 0px"><span style="color: blue">foreach</span> {</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$item</span> = <span style="color: #bd63c5">$_</span>.FullName <span style="color: green"># Get the full name of the item</span></p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$kids</span> = <span style="color: #ff8c00">Get-ChildItem</span> <span style="color: teal">-Path</span> <span style="color: #bd63c5">$item</span> <span style="color: green"># Get its children and the oldest/latest</span></p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$oldest</span> = <span style="color: #bd63c5">$kids</span> | <span style="color: #ff8c00">Sort-Object</span> CreationTime | <span style="color: #ff8c00">Select-Object</span> <span style="color: teal">-First</span> 1</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$latest</span> = <span style="color: #bd63c5">$kids</span> | <span style="color: #ff8c00">Sort-Object</span> LastWriteTime <span style="color: teal">-Descending</span> | <span style="color: #ff8c00">Select-Object</span> <span style="color: teal">-First</span> 1</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green"># Try to set the creation and last modified times</span></p>    <p style="margin: 0px">&#160; <span style="color: green"># (these may throw exceptions if in use by another process, e.g. Explorer)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">try</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> ((<span style="color: #bd63c5">$oldest</span> -ne <span style="color: #bd63c5">$null</span>) -and (<span style="color: #bd63c5">$oldest</span>.CreationTime -ne <span style="color: #bd63c5">$null</span>)){</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #bd63c5">$_</span>.CreationTime = <span style="color: #bd63c5">$oldest</span>.CreationTime</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> ((<span style="color: #bd63c5">$latest</span> -ne <span style="color: #bd63c5">$null</span>) -and (<span style="color: #bd63c5">$latest</span>.LastWriteTime -ne <span style="color: #bd63c5">$null</span>)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #bd63c5">$_</span>.LastWriteTime = <span style="color: #bd63c5">$latest</span>.LastWriteTime</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: teal">-NoNewline</span> <span style="color: #a31515">&quot;Processed &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: #bd63c5">$item</span></p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160; <span style="color: blue">catch</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: teal">-NoNewline</span> <span style="color: #a31515">&quot;Item not accessible: &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: #bd63c5">$item</span></p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p> </div>  <p>The problem with this first version is that it runs breadth-first, and you therefore might need to run it multiple times for the right date/time values to bubble their way up to the surface of your file system. So I went back to the drawing board and came up with a recursive, depth-first implementation. This should only need one pass to work properly, all being well:</p>  <div style="font-size: 8pt; font-family: courier new; background: white; color: black; line-height: 140%">   <p style="margin: 0px"><span style="color: blue">function</span> RecursiveUpdateAttributes(<span style="color: #bd63c5">$root</span>) {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green"># Get the full name of the item</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$item</span> = <span style="color: #bd63c5">$root</span>.FullName</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green"># Get its top-level children</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$kids</span> = <span style="color: #ff8c00">Get-ChildItem</span> <span style="color: teal">-Path</span> <span style="color: #bd63c5">$item</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green"># Recursively process the child folders</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">foreach</span>(<span style="color: #bd63c5">$kid</span> <span style="color: blue">in</span> <span style="color: #bd63c5">$kids</span>) {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> ((<span style="color: #bd63c5">$kid</span> -ne <span style="color: #bd63c5">$null</span>) -and (<span style="color: #bd63c5">$kid</span>.PSIsContainer)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #ff8c00">RecursiveUpdateAttributes</span> <span style="color: #bd63c5">$kid</span></p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: green"># Determine the oldest and youngest children</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$oldest</span> = <span style="color: #bd63c5">$kids</span> | <span style="color: #ff8c00">Sort-Object</span> CreationTime | <span style="color: #ff8c00">Select-Object</span> <span style="color: teal">-First</span> 1</p>    <p style="margin: 0px">&#160; <span style="color: #bd63c5">$latest</span> = <span style="color: #bd63c5">$kids</span> | <span style="color: #ff8c00">Sort-Object</span> LastWriteTime <span style="color: teal">-Descending</span> | <span style="color: #ff8c00">Select-Object</span> <span style="color: teal">-First</span> 1</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">try</span> {</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green"># Set the attributes</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> ((<span style="color: #bd63c5">$oldest</span> -ne <span style="color: #bd63c5">$null</span>) -and</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #bd63c5">$oldest</span>.CreationTime -ne <span style="color: #bd63c5">$null</span>) -and</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #bd63c5">$root</span>.CreationTime -ne <span style="color: #bd63c5">$null</span>)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #bd63c5">$root</span>.CreationTime = <span style="color: #bd63c5">$oldest</span>.CreationTime</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> ((<span style="color: #bd63c5">$latest</span> -ne <span style="color: #bd63c5">$null</span>) -and</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #bd63c5">$latest</span>.LastWriteTime -ne <span style="color: #bd63c5">$null</span>) -and</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: #bd63c5">$root</span>.LastWriteTime -ne <span style="color: #bd63c5">$null</span>)) {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; <span style="color: #bd63c5">$root</span>.LastWriteTime = <span style="color: #bd63c5">$latest</span>.LastWriteTime</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: teal">-NoNewline</span> <span style="color: #a31515">&quot;Processed &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: #bd63c5">$item</span></p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">&#160; <span style="color: blue">catch</span> {</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: teal">-NoNewline</span> <span style="color: #a31515">&quot;Item not accessible: &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #ff8c00">Write-Host</span> <span style="color: #bd63c5">$item</span></p>    <p style="margin: 0px">&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: #bd63c5">$dir</span> = <span style="color: #a31515">&quot;c:\temp&quot;</span> <span style="color: green"># Starting folder</span></p>    <p style="margin: 0px"><span style="color: #ff8c00">RecursiveUpdateAttributes</span>(<span style="color: #ff8c00">Get-Item</span> <span style="color: teal">-Path</span> <span style="color: #bd63c5">$dir</span>);</p>    <p style="margin: 0px">&#160;</p> </div>  <p>If you have an error suggesting scripts can’t be run on your system, you might try launching “PowerShell.exe -ExecutionPolicy Bypass” and calling the script from there.</p>  <p>If you’re familiar with the PowerShell environment and have suggestions on how to improve the script, please post a comment!</p>
