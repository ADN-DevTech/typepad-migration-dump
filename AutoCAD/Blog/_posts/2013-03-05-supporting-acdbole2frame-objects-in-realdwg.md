---
layout: "post"
title: "Supporting AcDbOle2Frame objects in RealDWG"
date: "2013-03-05 16:47:08"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "Fenton Webb"
  - "ObjectARX"
  - "RealDWG"
original_url: "https://adndevblog.typepad.com/autocad/2013/03/supporting-acdbole2frame-objects-in-realdwg.html "
typepad_basename: "supporting-acdbole2frame-objects-in-realdwg"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Supporting AcDbOle2Frame objects inside of RealDWG unfortunately requires some extra work to make happen, I’ve pasted some sample code below which shows how to implement the code into your RealDWG C++ application. </p>  <p>The bad news is that if you are a .NET user of RealDWG then you will need to touch into unmanaged C++ via a Mixed Mode Dll in order to add support for your Ole2Frame class. That’s because, at the time of writing, the .NET version of the HostApplicationServices class does not export the functions you need. </p>  <p>Here’s how to <a href="http://adndevblog.typepad.com/autocad/2013/03/creating-a-mixed-mode-realdwg-application.html">create a Mixed Mode RealDWG app</a>. </p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">////////////////////////////////////////////</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// RealDwg_App1Dlg.cpp : implementation file</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;stdafx.h&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;RealDwg_App1.h&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;RealDwg_App1Dlg.h&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;AcIOxClientItemMgr.h&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#ifdef</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">_DEBUG</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#define</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">DEBUG_NEW</font></span></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// CAboutDlg dialog used for App About</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">class</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000"> : </font><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">CDialog</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Dialog Data</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">enum</font></span><font color="#000000"> { </font><span style="color: "><font color="#010001">IDD</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">IDD_ABOUTBOX</font></span><font color="#000000"> };</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">protected</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">virtual</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">DoDataExchange</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CDataExchange</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">);&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// DDX/DDV support</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Implementation</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">protected</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DECLARE_MESSAGE_MAP</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">};</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">CAboutDlg</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000">() : </font><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">IDD</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoDataExchange</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CDataExchange</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoDataExchange</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">BEGIN_MESSAGE_MAP</font></font></span><font style="font-size: 8pt"><font color="#000000">(</font><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">END_MESSAGE_MAP</font></font></span><font style="font-size: 8pt" color="#000000">()</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">class</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000"> : </font><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">AcDbHostApplicationServices</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">findFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pcFullPathOut</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBufferLength</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pcFilename</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbHostApplicationServices</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FindFileHint</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">kDefault</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// These two functions return the full path to the root folder where roamable/local </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// customizable files were installed. Note that the user may have reconfigured </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// the location of some the customizable files using the Options Dialog </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// therefore these functions should not be used to locate customizable files. </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// To locate customizable files either use the findFile function or the </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// appropriate system variable for the given file type. </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">getRoamableRootFolder</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">folder</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">getLocalRootFolder</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">folder</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">getNewOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">serializeOleItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">CArchive</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Support redo</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">virtual</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000">&#160; </font><span style="color: "><font color="#010001">supportsMultiRedo</font></span><font color="#000000">() </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> { </font><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">; }</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// make sure you implement getAlternateFontName. In case your findFile implementation</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// fails to find a font you should return a font name here that is guaranteed to exist.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">virtual</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">getAlternateFontName</font></span><font color="#000000">() </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">const</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;txt.shx&quot;</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//findFile will be called again with this name</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">};</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Return the Install directory for customizable files</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Acad</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">getRoamableRootFolder</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">folder</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ret</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">] = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\0&quot;</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//MDI SAFE</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">[0]==0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">GetModuleFileName</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">) != 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ret</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eRegistryAccessError</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">folder</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ret</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Return the Install directory for customizable files</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Acad</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">getLocalRootFolder</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">folder</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ret</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">] = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\0&quot;</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//MDI SAFE</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">[0]==0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">GetModuleFileName</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">) != 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ret</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eRegistryAccessError</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">folder</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">buf</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ret</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Acad</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">findFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pcFullPathOut</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBufferLength</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pcFilename</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbHostApplicationServices</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FindFileHint</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">hint</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">[5];</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">switch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">hint</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kCompiledShapeFile</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.shx&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kTrueTypeFontFile</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.ttf&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kPatternFile</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.pat&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kARXApplication</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.dbx&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kFontMapFile</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.fmp&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kXRefDrawing</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;.dwg&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kFontFile</font></span><font color="#000000">:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Fall through.&#160; These could have</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">kEmbeddedImageFile</font></span><font color="#000000">:&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// various extensions</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">default</font></span><font color="#000000">:</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">[0] = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">'\0'</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">filePart</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DWORD</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">result</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">result</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">SearchPath</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pcFilename</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pExtension</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBufferLength</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pcFullPathOut</font></span><font color="#000000">, &amp;</font><span style="color: "><font color="#010001">filePart</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">result</font></span><font color="#000000"> &amp;&amp; </font><span style="color: "><font color="#010001">result</font></span><font color="#000000"> &lt; (</font><span style="color: "><font color="#010001">DWORD</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">nBufferLength</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eFileNotFound</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Acad</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">ErrorStatus</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">getNewOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000">*&amp; </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acdbHostApplicationServices</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">workingDatabase</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">) {</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pItem</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">GetNewOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000"> != 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Acad</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">ErrorStatus</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreatentHostApp</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">serializeOleItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">CArchive</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TRY</font></span><font color="#000000">{</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((*</font><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">).</font><span style="color: "><font color="#010001">IsStoring</font></span><font color="#000000">()){</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">m_lpObject</font></span><font color="#000000"> != 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">Serialize</font></span><font color="#000000">(*</font><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((*</font><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">).</font><span style="color: "><font color="#010001">IsStoring</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; (*</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pArchive</font></span><font color="#000000">) &lt;&lt; 0L &lt;&lt; 0L &lt;&lt; 0L &lt;&lt; 0L &lt;&lt; 0L &lt;&lt; 0L;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CATCH_ALL</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">e</font></span><font color="#000000">){</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//This may be an acceptable situation with some corrupt data sets. A warning</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//assert is good enough.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(!</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Failed to serialize a COleClientItem object!&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eNotImplemented</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">END_CATCH_ALL</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">CreatentHostApp</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">gCreatentHostApp</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// CRealDwg_App1Dlg dialog</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">CRealDwg_App1Dlg</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CWnd</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pParent</font></span><font color="#000000"> </font><span style="color: "><font color="#008000">/*=NULL*/</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; : </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">IDD</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pParent</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">m_hIcon</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">AfxGetApp</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">LoadIcon</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">IDR_MAINFRAME</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoDataExchange</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">CDataExchange</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoDataExchange</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DDX_Control</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pDX</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">IDC_OUTPUT_LIST</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">m_outputList</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">INT_PTR</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoModal</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbSetHostApplicationServices</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#010001">gCreatentHostApp</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lcid</font></span><font color="#000000"> = 0x00000409; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// English</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbValidateSetup</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lcid</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">INT_PTR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">int_ptr</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DoModal</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbCleanUp</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">int_ptr</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">BEGIN_MESSAGE_MAP</font></font></span><font style="font-size: 8pt"><font color="#000000">(</font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ON_WM_SYSCOMMAND</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ON_WM_PAINT</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ON_WM_QUERYDRAGICON</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ON_BN_CLICKED</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">IDC_SELECT_BTN</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">OnSelectFile</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//}}AFX_MSG_MAP</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">END_MESSAGE_MAP</font></font></span><font style="font-size: 8pt" color="#000000">()</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// CRealDwg_App1Dlg message handlers</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">BOOL</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnInitDialog</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnInitDialog</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Add &quot;About...&quot; menu item to system menu.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// IDM_ABOUTBOX must be in the system command range.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">((</font><span style="color: "><font color="#010001">IDM_ABOUTBOX</font></span><font color="#000000"> &amp; 0xFFF0) == </font><span style="color: "><font color="#010001">IDM_ABOUTBOX</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">IDM_ABOUTBOX</font></span><font color="#000000"> &lt; 0xF000);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CMenu</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pSysMenu</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">GetSystemMenu</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pSysMenu</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">BOOL</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bNameValid</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CString</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">strAboutMenu</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">bNameValid</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">strAboutMenu</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">LoadString</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">IDS_ABOUTBOX</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">bNameValid</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">strAboutMenu</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">IsEmpty</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pSysMenu</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">AppendMenu</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MF_SEPARATOR</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pSysMenu</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">AppendMenu</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MF_STRING</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">IDM_ABOUTBOX</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">strAboutMenu</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Set the icon for this dialog.&#160; The framework does this automatically</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//&#160; when the application's main window is not a dialog</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">SetIcon</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">m_hIcon</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">);&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Set big icon</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">SetIcon</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">m_hIcon</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">);&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Set small icon</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// TODO: Add extra initialization here</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CRect</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">m_outputList</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetWindowRect</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nScrollWidth</font></span><font color="#000000"> = ::</font><span style="color: "><font color="#010001">GetSystemMetrics</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">SM_CXVSCROLL</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nColumnWidth</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Width</font></span><font color="#000000">() - 2 * </font><span style="color: "><font color="#010001">nScrollWidth</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">m_outputList</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">InsertColumn</font></span><font color="#000000">(0, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Dimension Type&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">LVCFMT_LEFT</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nColumnWidth</font></span><font color="#000000">*2/5, 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">m_outputList</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">InsertColumn</font></span><font color="#000000">(1, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Dimension Text Point&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">LVCFMT_LEFT</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nColumnWidth</font></span><font color="#000000">*3/5, 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// return TRUE&#160; unless you set the focus to a control</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnSysCommand</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">UINT</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nID</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">LPARAM</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lParam</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((</font><span style="color: "><font color="#010001">nID</font></span><font color="#000000"> &amp; 0xFFF0) == </font><span style="color: "><font color="#010001">IDM_ABOUTBOX</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CAboutDlg</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dlgAbout</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">dlgAbout</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DoModal</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnSysCommand</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">nID</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">lParam</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// If you add a minimize button to your dialog, you will need the code below</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//&#160; to draw the icon.&#160; For MFC applications using the document/view model,</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//&#160; this is automatically done for you by the framework.</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnPaint</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">IsIconic</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CPaintDC</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dc</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">this</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// device context for painting</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">SendMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">WM_ICONERASEBKGND</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">reinterpret_cast</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">WPARAM</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#010001">dc</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetSafeHdc</font></span><font color="#000000">()), 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Center icon in client rectangle</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">cxIcon</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">GetSystemMetrics</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">SM_CXICON</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">cyIcon</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">GetSystemMetrics</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">SM_CYICON</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CRect</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">GetClientRect</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">x</font></span><font color="#000000"> = (</font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Width</font></span><font color="#000000">() - </font><span style="color: "><font color="#010001">cxIcon</font></span><font color="#000000"> + 1) / 2;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">y</font></span><font color="#000000"> = (</font><span style="color: "><font color="#010001">rect</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Height</font></span><font color="#000000">() - </font><span style="color: "><font color="#010001">cyIcon</font></span><font color="#000000"> + 1) / 2;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Draw the icon</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">dc</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DrawIcon</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">x</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">y</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">m_hIcon</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CDialog</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnPaint</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// The system calls this function to obtain the cursor to display while the user drags</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//&#160; the minimized window.</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">HCURSOR</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnQueryDragIcon</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">static_cast</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">HCURSOR</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#010001">m_hIcon</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">CRealDwg_App1Dlg</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">OnSelectFile</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#if</font></font></span><font style="font-size: 8pt" color="#000000"> 0</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CFileDialog</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">selectDwgDlg</font></span><font color="#000000">(</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;DXF Files (*dxf)&quot;</font></span><font color="#000000">), </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">OFN_HIDEREADONLY</font></span><font color="#000000"> | </font><span style="color: "><font color="#010001">OFN_OVERWRITEPROMPT</font></span><font color="#000000"> |</font><span style="color: "><font color="#010001">OFN_ENABLESIZING</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;DXF File (*.dxf)|*.dxf;)||&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; );</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#if</font></font></span><font style="font-size: 8pt" color="#000000"> 1</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CFileDialog</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">selectDwgDlg</font></span><font color="#000000">(</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;DWG Files (*dwg)&quot;</font></span><font color="#000000">), </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">OFN_HIDEREADONLY</font></span><font color="#000000"> | </font><span style="color: "><font color="#010001">OFN_OVERWRITEPROMPT</font></span><font color="#000000"> |</font><span style="color: "><font color="#010001">OFN_ENABLESIZING</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;DWG File (*.dwg)|*.dwg;)||&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; );</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">selectDwgDlg</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DoModal</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">IDOK</font></span><font color="#000000">) {</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CString</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dwgPathName</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">selectDwgDlg</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetPathName</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Create an AcDbDatabase and initialize its tables.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">readDwgFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">dwgPathName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_SH_DENYWR</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">) {</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbHostApplicationServices</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">setWorkingDatabase</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">saveAs</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;c:\\test.dwg&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">////////////////////////////////////////////</font></font></span></p>    <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;StdAfx.h&quot;</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;AcIOxClientItemMgr.h&quot;</font></span></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;map&gt;</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;set&gt;</font></span></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;dbmain.h&gt;</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//AcIOxOleClientItem implementation</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">/////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//AcIOxOleClientItem</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">class</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000"> : </font><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000"> {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DECLARE_DYNAMIC</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">&amp;);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">&amp; </font><span style="color: "><font color="#0000ff">operator</font></span><font color="#000000">=(</font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">&amp;);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleDocument</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bMakeTransient</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">virtual</font></span><font color="#000000"> ~</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">IsTransient</font></span><font color="#000000">() </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> {</font><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">m_bTransient</font></span><font color="#000000">;}</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">private</font></font></span><font style="font-size: 8pt" color="#000000">:</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">m_bTransient</font></span><font color="#000000">; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Flag to indicate whether the object is marked as transient or not</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//A transient AcIOxOleClientItem object is deleted after the owning</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//AcDbDatabase is saved</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">};</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">IMPLEMENT_DYNAMIC</font></font></span><font style="font-size: 8pt"><font color="#000000">(</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">COleClientItem</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">COleDocument</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000">,</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">,</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bMakeTransient</font></span><font color="#000000"> </font><span style="color: "><font color="#008000">/* = false */</font></span><font color="#000000">):</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">COleClientItem</font></font></span><font style="font-size: 8pt"><font color="#000000">(</font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000">),</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">m_bTransient</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">bMakeTransient</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//COleDocument's ctor allows a null container, which isn't supported</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//when instatiating this class</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000"> != 0);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Register the client item with the owner</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000"> != 0);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RegisterClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">this</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">); </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">AcIOxOleClientItem</font></font></span><font style="font-size: 8pt"><font color="#000000">::~</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">()</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">namespace</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">typedef</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">set</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000"> *&gt; </font><span style="color: "><font color="#010001">SetClientItems_t</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">typedef</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">map</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000"> *, </font><span style="color: "><font color="#010001">SetClientItems_t</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">MapOwnerToClientItems_t</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">MapOwnerToClientItems_t</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">COleDocument</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_RegisterClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">].</font><span style="color: "><font color="#010001">insert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_UnregisterClientItems</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">MapOwnerToClientItems_t</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">const_iterator</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">iter</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">find</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">iter</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">end</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">SetClientItems_t</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">items</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">iter</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">second</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">SetClientItems_t</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">iterator</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">it</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">items</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">begin</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">while</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">it</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">items</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">end</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000"> = (*</font><span style="color: "><font color="#010001">it</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Null entry!</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">it</font></span><font color="#000000">++;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">continue</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000"> &amp;&amp; !</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">IsTransient</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">it</font></span><font color="#000000">++;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">continue</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">it</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">items</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">erase</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">it</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">COleDocument</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">GetDocument</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000"> != 0);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Release the item</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">Release</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Remove the item from the container</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pContainerDoc</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">RemoveItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Internal release the item</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ULONG</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ulRef</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">InternalRelease</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Delete the item</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">ulRef</font></span><font color="#000000"> &gt; 0){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pItem</font></span><font color="#000000"> = 0;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Erase the owner entry from the map, if there are no more registered items</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//associated to this owner</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">items</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">empty</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">erase</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; }</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000">{</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">] = </font><span style="color: "><font color="#010001">items</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//The hosting COleDocument needs to be deleted when</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//no longer in use. This object holds onto a lock count</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//on the Afx module state, and failure to delete this</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//can prevent the host process from going away at the</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//time of shut down</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> &amp;&amp; </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">empty</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> = 0;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_UnregisterClientItemOwner</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">MapOwnerToClientItems_t</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">const_iterator</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">iter</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">find</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">iter</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">end</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Unregister all client item objects registered for this owner</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_UnregisterClientItems</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//Erase the owner entry from the map</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">erase</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//The hosting COleDocument needs to be deleted when</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//no longer in use. This object holds onto a lock count</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//on the Afx module state, and failure to delete this</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//can prevent the host process from going away at the</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//time of shut down</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> &amp;&amp; </font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">empty</font></span><font color="#000000">()){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> = 0;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_HasRegisteredItems</font></span><font color="#000000">()</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">g_OwnerToClientItemsMap</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">() &gt; 0);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//////////////////////////////////////////////////////////////////////////</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">COleDocument</font></font></span><font style="font-size: 8pt" color="#000000">*</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">GetHostingDocument</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bCreateIfNotInitialized</font></span><font color="#000000"> </font><span style="color: "><font color="#008000">/* = true */</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">bCreateIfNotInitialized</font></span><font color="#000000">){</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">COleDocument</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">g_OleDocument</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">COleClientItem</font></font></span><font style="font-size: 8pt" color="#000000">*</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">GetNewOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bMakeTransient</font></span><font color="#000000"> </font><span style="color: "><font color="#008000">/* = false */</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">GetHostingDocument</font></span><font color="#000000">(), </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">bMakeTransient</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt" color="#000000"> </font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RegisterClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcIOxOleClientItem</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_RegisterClientItem</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pItem</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt" color="#000000"> </font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">UnregisterClientItems</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000"> </font><span style="color: "><font color="#008000">/* = false */</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_UnregisterClientItems</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">bTransientItemsOnly</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt" color="#000000"> </font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">UnregisterClientItemOwner</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_UnregisterClientItemOwner</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pClientItemOwner</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">bool</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcIOxClientItemMgr</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">HasRegisteredItems</font></span><font color="#000000">()</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">_HasRegisteredItems</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>   </div> </div>
