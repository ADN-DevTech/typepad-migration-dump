---
layout: "post"
title: "Synchronously Send (and wait for) commands in AutoCAD using C# .NET"
date: "2012-04-09 14:03:44"
author: "Fenton Webb"
categories:
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/04/synchronously-send-and-wait-for-commands-in-autocad-using-c-net.html "
typepad_basename: "synchronously-send-and-wait-for-commands-in-autocad-using-c-net"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html" target="_self">Fenton Webb</a></p>
<p>I’m really sorry to say, but anyone who tells me that acedCommand() and acedCmd() are not good C++ functions for driving AutoCAD, are crazy! These functions have existed since the original R11 ADS development system in C and have always been used to synchronously send commands to the AutoCAD Command line. This means you can drive AutoCAD from your program code and expect things to be finished and done by the time the function returns.</p>
<p>These functions can literally save hours of work – instead of programmatically creating your own INSERT routine, just send the command and let AutoCAD do it – problem is, sometimes, you need to wait for the user to before carrying on, for example waiting for the user to place the block or enter the scales etc.</p>
<p>The code below shows how to PInvoke acedCmd() from .NET, and it shows the secret behind programmatically waiting for the user to finish the command using acedCmd(). Be warned though, we are changing/have changed the way these functions work, partly due to the AutoCAD for Mac port and now on Windows the Fiber removal project. Instead, you’ll need to use the acedCmdS() and acedCmdC() versions. Here’s some <a href="http://wikihelp.autodesk.com/AutoCAD_for_Mac/enu/2013/Help/Developer_Documentation/Porting_Windows_Applications/Fiberless_Application_Requirements/Migrating_Your_Applications/ObjectARX/acedCommand()_Migration">documentation on the subject</a></p>
<p>In the meantime, here’s the code showing how to call INSERT using acedCmd() synchronously</p>
<div style="background: white;">
<p style="margin: 0px;"><span><span style="font-family: Consolas;"><span style="color: #008000;">// call the insert command and wait until the user has finished, by Fenton Webb, DevTech</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">DllImport</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">"acad.exe"</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">CharSet</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CharSet</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Ansi</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">CallingConvention</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CallingConvention</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Cdecl</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">EntryPoint</span></span><span style="color: #000000;"> = </span><span><span style="color: #a31515;">"acedCmd"</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>private</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">static</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">extern</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">acedCmd</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">System</span></span><span style="color: #000000;">.</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vlist</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">CommandMethod</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">"Test7"</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>public</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">Test7</span></span><span style="color: #000000;">()</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span style="color: #008000;">// RTSTR = 5005</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">TypedValue</span></span><span style="color: #000000;">(5005, </span><span><span style="color: #a31515;">"_.INSERT"</span></span><span style="color: #000000;">));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span style="color: #008000;">// start the insert command</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span><span style="color: #010001;">acedCmd</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">UnmanagedObject</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span><span style="color: #0000ff;">bool</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">quit</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">false</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span style="color: #008000;">// loop round while the insert command is active</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp; </span></span><span><span><span style="color: #0000ff;">while</span></span><span style="color: #000000;"> (!</span><span><span style="color: #010001;">quit</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">// see what commands are active</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">cmdNames</span></span><span style="color: #000000;"> = (</span><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;">)</span><span><span style="color: #010001;">Autodesk</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AutoCAD</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ApplicationServices</span></span><span style="color: #000000;">.</span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">GetSystemVariable</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">"CMDNAMES"</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">// if the INSERT command is active</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (</span><span><span style="color: #010001;">cmdNames</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ToUpper</span></span><span style="color: #000000;">().</span><span><span style="color: #010001;">IndexOf</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">"INSERT"</span></span><span style="color: #000000;">) &gt;= 0)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp;&nbsp;&nbsp; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">// then send a PAUSE to the command line</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">// RTSTR = 5005 - send a user pause to the command line</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">TypedValue</span></span><span style="color: #000000;">(5005, </span><span><span style="color: #a31515;">"\\"</span></span><span style="color: #000000;">));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #010001;">acedCmd</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">rb</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">UnmanagedObject</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp;&nbsp;&nbsp; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #0000ff;">else</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">// otherwise quit</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span><span style="color: #010001;">quit</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">}</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">&nbsp;</span></span></p>
</div>
