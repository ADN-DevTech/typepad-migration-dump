---
layout: "post"
title: "Plot To Window Extents Using VBA"
date: "2016-05-04 23:55:00"
author: "Madhukar Moogala"
categories:
  - "2016"
  - "Madhukar Moogala"
original_url: "https://adndevblog.typepad.com/autocad/2016/05/plot-to-window-extents-using-vba.html "
typepad_basename: "plot-to-window-extents-using-vba"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/Madhukar-Moogala.html" target="_self">Madhukar Moogala</a></p> <p>I have received&nbsp; a query from an ADN partner&nbsp; that customer code to plot to window doesn’t plot and gives an empty print on certain drawings and same code works well for rest of drawings.</p> <p>The root cause of such weird behaviour is that the code doesn’t handle transformation of extent points from WCS to DCS, i.e. When user picks coordinate points from Editor as Window extents, these needs to transformed to DCS coordinate system for correct preview and plot of Drawings.</p> <p><strong>Important</strong>: Always make sure extents points needs to Transformed from WCS to DCS, this true for C++ &amp; .NET API too.</p> <p>&nbsp;</p> <p>VBA code:</p> <div style="font-size: 10pt; font-family: consolas; background: #1e1e1e; color: #dcdcdc"> <p style="margin: 0px"><span style="color: #569cd6; line-height: 140%">Public</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Sub</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">Example_SetWindowToPlot</span><span style="line-height: 140%">()</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' This example allows the user to define an area in the current layout</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' and displays a plot preview of the defined area.</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">AppActivate</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Application</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Caption</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">Dim</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">point1</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">As</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Object</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">point2</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">As</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Object</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Get first point in window</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">point1</span><span style="line-height: 140%"> = </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Utility</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">GetPoint</span><span style="line-height: 140%">(, </span><span style="color: #d69d85; line-height: 140%">"Click the lower-left of the window to plot."</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Get second point in window</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">point2</span><span style="line-height: 140%"> = </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Utility</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">GetPoint</span><span style="line-height: 140%">(, </span><span style="color: #d69d85; line-height: 140%">"Click the upper-right of the window to plot."</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">Dim</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">point1DCS</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">As</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Object</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">point2DCS</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">As</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Object</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">'Translate coordinates from WCS to DCS</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">point1DCS</span><span style="line-height: 140%"> = </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Utility</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">TranslateCoordinates</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">point1</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">acWorld</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">acDisplayDCS</span><span style="line-height: 140%">, </span><span style="color: #569cd6; line-height: 140%">False</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">point2DCS</span><span style="line-height: 140%"> = </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Utility</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">TranslateCoordinates</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">point2</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">acWorld</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">acDisplayDCS</span><span style="line-height: 140%">, </span><span style="color: #569cd6; line-height: 140%">False</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">ReDim</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Preserve</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">point1DCS</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">0</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">To</span><span style="line-height: 140%"> </span><span style="color: #b5cea8; line-height: 140%">1</span><span style="line-height: 140%">)&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Change this to a 2D array by removing the Z position</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">ReDim</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Preserve</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">point2DCS</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">0</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">To</span><span style="line-height: 140%"> </span><span style="color: #b5cea8; line-height: 140%">1</span><span style="line-height: 140%">)&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Change this to a 2D array by removing the Z position</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Send information about window to current layout</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">ActiveLayout</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">SetWindowToPlot</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">point1DCS</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">point2DCS</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Read back window information</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">ActiveLayout</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">GetWindowToPlot</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">point1DCS</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">point2DCS</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">MsgBox</span><span style="line-height: 140%"> </span><span style="color: #d69d85; line-height: 140%">"Press any key to plot the following window:"</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">vbCrLf</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">vbCrLf</span><span style="line-height: 140%"> &amp; _</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #d69d85; line-height: 140%">"Lower Left: "</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">point1</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">0</span><span style="line-height: 140%">) &amp; </span><span style="color: #d69d85; line-height: 140%">", "</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">point1</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">1</span><span style="line-height: 140%">) &amp; </span><span style="color: white; line-height: 140%">vbCrLf</span><span style="line-height: 140%"> &amp; _</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #d69d85; line-height: 140%">"Upper Right: "</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">point2</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">0</span><span style="line-height: 140%">) &amp; </span><span style="color: #d69d85; line-height: 140%">", "</span><span style="line-height: 140%"> &amp; </span><span style="color: white; line-height: 140%">point2</span><span style="line-height: 140%">(</span><span style="color: #b5cea8; line-height: 140%">1</span><span style="line-height: 140%">)</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Be sure to plot a view, not some other plot style</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">ActiveLayout</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">PlotType</span><span style="line-height: 140%"> = </span><span style="color: white; line-height: 140%">acWindow</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">' Send Plot To Window</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">ActiveLayout</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">ConfigName</span><span style="line-height: 140%"> = </span><span style="color: #d69d85; line-height: 140%">"DWG to PDF.pc3"</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ThisDrawing</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">Plot</span><span style="line-height: 140%">.</span><span style="color: white; line-height: 140%">DisplayPlotPreview</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acFullPreview</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">End</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">Sub</span></p></div>
