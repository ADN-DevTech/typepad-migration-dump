---
layout: "post"
title: "Adding your own Per-User Customizable Files to an AutoCAD OEM Installation"
date: "2013-02-01 11:15:30"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD OEM"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2013/02/adding-your-own-per-user-customizable-files-to-an-autocad-oem-installation.html "
typepad_basename: "adding-your-own-per-user-customizable-files-to-an-autocad-oem-installation"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>In my OEM Installation, I want to be able to add files to the user customizable folders on a per-user basis.&#160; I've used the Wizard to add files there, but they don't get copied when I switch users.&#160; How can I add files to the OEM installer that will be present for every user that runs my product?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>There are three separate mechanisms used by the AutoCAD/OEM installer to place files, depending on when and where the files are ultimately placed (it is assumed the reader has some experience working with MSI).</p>  <p>During 'primary' installation (first normal installation, run as an administrator) the user customizable files are copied to the ‘UserDataCache’ folder under the target install directory, as normal.&#160; Since the user files must also be placed in the roamable per-user folders, the DuplicateFile table is then used to copy these files during a separate action during the primary install.</p>  <p>During ‘secondary install’ (spawned the first time the OEM product is run as a different user), it is assumed the current user has changed, and the user files must be copied to the new user's per-user data folder again.&#160; The installer uses entries found in the ‘MoveFiles’ table to copy them over.</p>  <p>So, for an OEM installer, we can add a couple things to our MSI to make this work.&#160; For the example where we add a file (test.bmp) to the ‘&lt;roamable per-user profile&gt;Support\ToolPalette\Images’ folder, we can use these steps:</p>  <p>1)&#160; Add the image file to the ‘Per-User Support’ target in the OEMMakeWizard.&#160; While this doesn’t get this file exactly where we want it to be, it does get us closer by adding the file to the File table in MSI (after we run the OEMInstallerWizard).</p>  <p>2) Build the project with the OEM MakeWizard and build the MSI with the OEMInstallerWizard.</p>  <p>3) In the CD image for the install create a folder named 'Images'. If you used the suggested naming convention suggested in the help file for the Installer Wizard the path to add the Images folder would be similar to this:</p>  <p>..\TargetMaster\Program Files\&lt;nameOfApp&gt;\UserDataCache\ToolPalette\</p>  <p>4) Manually move the image file from:</p>  <p>..\TargetMaster\Program Files\UserDataCache\Support</p>  <p>To the new Images directory added in step three.&#160; </p>  <p>5)&#160; Edit the MSI for your install with a utility such as Orca. (Available free as the ‘Database Tool’ in the Installer SDK from MSDN)&#160; Add ‘UserToolPaletteImagesFolder’ to the Directory Table, with a parent of ‘UserToolPaletteFolder’ and a DefaultDir of ‘Images’.&#160; Similarly, add ‘RoamingUserToolPaletteImagesFolder’ with a parent of ‘RoamingUserToolPaletteFolder’ and a DefaultDir of ‘Images’.&#160; We must do this since we’re adding directories to both the UserDataCache and the user support folders.</p>  <p>UserToolPaletteImagesFolder UserToolPaletteFolder&#160;&#160; Images</p>  <p>RoamingUserToolPaletteImagesFolder&#160; RoamingUserToolPaletteFolder&#160;&#160; Images</p>  <p>6) Change the Directory entry for the component in the Component table which represents your file to the ‘UserToolPaletteImagesFolder’.&#160; You can find this component by using ‘Find’ (Ctrl+F), searching for your filename from the top of the Component table.</p>  <p>COMP_test.bmp &lt;UUID for test.bmp&gt; UserToolPaletteImagesFolder&#160;&#160; 0 </p>  <p>7)&#160; Find the entry in the DuplicateFile table that represents your file. The information for these fields should be obtained from the fields for this file in the File table.&#160; The ‘FileKey’ and ‘File’ fields can be the set to the contents of the ‘File’ field in the File table. The Component is set similarly.&#160; The DestName can be equivalent to ‘FileName’, and the DestFolder should be the target for the file in the roaming folders, in this example ‘RoamingUserToolPaletteImagesFolder’.</p>  <p>FILE_test.bmp&#160; COMP_test.bmp FILE_test.bmp&#160;&#160; test.bmp&#160; RoamingUserToolPaletteImagesFolder</p>  <p>Note: You can copy and paste the entries from the File Table. However ensure that no trailing spaces are added. Also if an error occurs when trying to modify this row, add a new row and use the information from the existing row. (Then delete the original row).</p>  <p>8) Add an entry in the ‘MoveFile’ table to represent your file. The FileKey and Source folder can be the same, set to the source of the move/copy operation.&#160; In this example ‘UserToolPaletteImagesFolder’ for the directory we created in the UserDataCache.&#160; The ‘DestFolder’ is the destination of the move, ‘RoamingUserToolPaletteImagesFolder’.&#160; The ‘Component’ entry&#160; should be ‘Comp_duplicate_roamable_file’ and ‘SourceName’ should be ‘*.*’.</p>  <p>UserToolPaletteImagesFolder Comp_duplicate_roamable_file&#160;&#160; *.*&#160;&#160; UserToolPaletteImagesFolder&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; RoamingUserToolPaletteImagesFolder&#160;&#160; 0</p>  <p>9) After making these changes to the MSI, the image file will be available in the user's profile directory. (..ToolPalette\Images). When the&#160; OEM product is run and shut down, it will create a couple of new directories for the Palettes and Images. (..\ToolPalette\Palettes\Images). The image files will be created in the new Images directory.</p>  <p>That should do it.&#160; Your file should be included in each user's per-user data! </p>
