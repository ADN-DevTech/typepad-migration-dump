---
layout: "post"
title: "Access P3dLineGroup of a Plant 3D Pipe"
date: "2014-10-30 11:36:44"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "Plant3D"
original_url: "https://adndevblog.typepad.com/autocad/2014/10/access-p3dlinegroup-of-a-plant-3d-pipe.html "
typepad_basename: "access-p3dlinegroup-of-a-plant-3d-pipe"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>This question came from <strong><a href="http://www.contelos.de/">Jens Dorstewitz</a></strong>: how access the P3dLineGroup of a given Plant 3D pipe? To clarify, below is the project properties with the table weâ€™re looking for.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c6fd66d7970b-pi"><img title="Plant 3D project setup dialog" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Plant 3D project setup dialog" src="/assets/image_892338.jpg" width="466" height="310" /></a> </p>  <p>To answer we have a problem: this information is not part of the properties of the pipe, but in fact stored somewhere else. So we need to understand the relationships of Plant 3D database.</p>  <p>There are a few steps: (1) from a Pipe ObjectId, use the Data Links Manager to get the RowId and (2) using the Plant 3D database, open and search at the P3dLineGroupPartRelationship table for a row where Part equals this RowId. With this row, (3) get the LineGroup column that will be the RowId of the line group we need. Finally (4) open the P3dLineGroup table and get the row we need. This row can be edited.</p>  <p>Actually <strong>Jens Dorstewitz</strong> (thanks again) wrote a sample based on this idea, below is an simplified version of it. Enjoy. </p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;changeLineGroupData&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">void</span> CmdChangeP3dLineGroupData()<br />{<br />&#160; <span style="color: green">// First, select a Plant 3D pipe</span><br />&#160; <span style="color: #2b91af">Editor</span> ed = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Editor;<br />&#160; <span style="color: #2b91af">PromptEntityOptions</span> peo = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">PromptEntityOptions</span>(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;Select pipe to obtain properties : &quot;</span>);<br />&#160; peo.SetRejectMessage(<span style="color: #a31515">&quot;Only Plant 3D Pipes&quot;</span>);<br />&#160; peo.AddAllowedClass(<span style="color: blue">typeof</span>(<span style="color: #2b91af">Pipe</span>), <span style="color: blue">true</span>);<br />&#160; <span style="color: #2b91af">PromptEntityResult</span> per = ed.GetEntity(peo);<br />&#160; <span style="color: blue">if</span> (per.Status != <span style="color: #2b91af">PromptStatus</span>.OK) <span style="color: blue">return</span>;<br /> <br />&#160; ObjectId pipeId = per.ObjectId;<br /> <br />&#160; <span style="color: green">// Get plant 3D project part</span><br />&#160; <span style="color: #2b91af">PlantProject</span> currentProj = <span style="color: #2b91af">PlantApplication</span>.CurrentProject;<br />&#160; <span style="color: #2b91af">PipingProject</span> pipeProj = (<span style="color: #2b91af">PipingProject</span>)currentProj.ProjectParts[<span style="color: #a31515">&quot;Piping&quot;</span>];<br />&#160; <span style="color: #2b91af">DataLinksManager</span> dlm = pipeProj.DataLinksManager;<br /> <br />&#160; <span style="color: green">// Convert the pipe ObjectId to RowId (used on P3D database</span><br />&#160; <span style="color: blue">int</span> rowId = dlm.FindAcPpRowId(pipeId);<br /> <br />&#160; <span style="color: green">// Get the P3dLineGroup table of the database</span><br />&#160; <span style="color: #2b91af">PnPDatabase</span> db = dlm.GetPnPDatabase();<br />&#160; <span style="color: #2b91af">PnPTable</span> tbl = db.Tables[<span style="color: #a31515">&quot;P3dLineGroup&quot;</span>];<br /> <br />&#160; <span style="color: green">// Find the relaship between the pipe RowId</span><br />&#160; <span style="color: green">// This row registry contains the P3dLineGroup</span><br />&#160; <span style="color: #2b91af">PnPRowIdArray</span> lineGroupId = dlm.GetRelatedRowIds(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;P3dLineGroupPartRelationship&quot;</span>, <span style="color: #a31515">&quot;Part&quot;</span>, rowId, <span style="color: #a31515">&quot;LineGroup&quot;</span>);<br />&#160; <span style="color: blue">if</span> (lineGroupId == <span style="color: blue">null</span> || lineGroupId.Count == 0) <span style="color: blue">return</span>;<br />&#160; <span style="color: blue">int</span> lineGroupRowId = lineGroupId.First.Value;<br /> <br />&#160; <span style="color: green">// Now select using this lineGroupRowId</span><br />&#160; <span style="color: blue">string</span> sStatement = <span style="color: #a31515">&quot;PnPID=&quot;</span> + lineGroupRowId;<br />&#160; <span style="color: #2b91af">PnPRow</span>[] rows = tbl.Select(sStatement);<br />&#160; <span style="color: blue">if</span> (rows.Length &gt; 0) <span style="color: green">// should be just 1</span><br />&#160; {<br />&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: #2b91af">PnPRow</span> Row <span style="color: blue">in</span> rows)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// now do something here...</span><br />&#160;&#160;&#160; }<br />&#160; }<br />}</pre>
