---
layout: "post"
title: "Plotting Layouts using the ActiveX Plot Object in ObjectARX"
date: "2012-12-19 18:10:58"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "ActiveX"
  - "AutoCAD"
  - "Gopinath Taget"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/plotting-layouts-using-the-activex-plot-object-in-objectarx.html "
typepad_basename: "plotting-layouts-using-the-activex-plot-object-in-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p>The sample code below, (function in the attached project) shows how plot all the layouts in batch mode using the ActiveX API in C++. </p>  <p>The key points to batch plot layouts are:</p>  <p>1) Set the number of layouts be plotted using the method StartBatchMode() of the IAcadPlot object.</p>  <p>2) Preparing a variant array of BSTRs having the names of the layouts to be plotted and then pass it as argument to SetLayoutsToPlot() method.</p>  <p>3) Finally to plot, use PlotToDevice() method.</p>  <div style="font-family: ; background: white">   <div style="font-family: ; background: white">     <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">//use MFC to test this code</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">#import</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;acax19enu.tlb&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> raw_interfaces_only no_namespace</font></span></font></p>      <p style="margin: 0px"><font color="#000000" face="Consolas"><span style="line-height: 11pt"></span></font></p>   </div>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> fBatchPlotLayouts()</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">try</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//get the AutoCAD application</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; IAcadApplicationPtr pApp = NULL;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pApp = acedGetAcadWinApp()-&gt;GetIDispatch(TRUE);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//get the Active Document</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; IAcadDocumentPtr pDoc = NULL;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pApp-&gt;get_ActiveDocument(&amp;pDoc);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; IAcadLayoutsPtr pLayOuts;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; IAcadLayoutPtr pLayOut;</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">long</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> mNumberOflayouts;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//get the layouts collection and the number of layouts</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pDoc-&gt;get_Layouts(&amp;pLayOuts);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pLayOuts-&gt;get_Count(&amp;mNumberOflayouts);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//create the variant array that will hold the layout names</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; VARIANT mLayArr;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; SAFEARRAYBOUND mSAB;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; mSAB.lLbound = 0;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; mSAB.cElements = mNumberOflayouts;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; VariantInit(&amp;mLayArr);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; mLayArr.vt = VT_ARRAY | VT_BSTR;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; mLayArr.parray = SafeArrayCreate(VT_BSTR,1,&amp;mSAB);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//populate the variant array</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">long</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> mCtr;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//note that array here has zero based index</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">for</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(mCtr = 0; mCtr &lt; mNumberOflayouts; mCtr ++)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; pLayOuts-&gt;Item(_variant_t(mCtr), &amp;pLayOut);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; BSTR strName;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; pLayOut-&gt;get_Name(&amp;strName);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; SafeArrayPutElement(mLayArr.parray, &amp;mCtr, strName); </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//print the layout names that are being plotted</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; BSTR bstrName;</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\nLayouts to be plotted:&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">));</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">for</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(mCtr = 0; mCtr &lt; mNumberOflayouts;mCtr ++)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; SafeArrayGetElement(mLayArr.parray,&amp;mCtr,&amp;bstrName); </font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; acutPrintf(_T(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\n%s&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">),(TCHAR*)(_bstr_t)bstrName);</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\nPlotting started...\n&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">));</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//plot the layouts</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; IAcadPlotPtr pPlot;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pDoc-&gt;get_Plot(&amp;pPlot);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//set the number of plots and error mode to quiet</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pPlot-&gt;put_NumberOfCopies(1);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pPlot-&gt;put_QuietErrorMode(VARIANT_TRUE);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//number of layouts to be plotted</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pPlot-&gt;StartBatchMode(mNumberOflayouts);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//set the layouts to plot</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pPlot-&gt;SetLayoutsToPlot(mLayArr);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; VARIANT_BOOL returnBool;</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pPlot-&gt;PlotToDevice(_variant_t(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;DWF6 ePlot.pc3&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">), &amp;returnBool);</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">//clean up</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; VariantClear(&amp;mLayArr);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">catch</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> (_com_error &amp;e)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; acutPrintf(</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; _T(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;\nError while batch plotting. %s&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">),e.ErrorMessage());</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p> </div>
