---
layout: "post"
title: "Using AutoLISP to read an access database via ADO"
date: "2013-04-02 03:30:00"
author: "Xiaodong Liang"
categories:
  - "AutoCAD"
  - "LISP"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2013/04/using-autolisp-to-read-an-access-database-via-ado.html "
typepad_basename: "using-autolisp-to-read-an-access-database-via-ado"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p><strong>Issue      <br /></strong>How can you access the data in a database rows using Visual LISP functions ?</p>
<p><a name="section2"></a></p>
<p><strong>Solution      <br /></strong>Although there are no direct Visual LISP functions to read databases, you can use Microsoft&#39;s ActiveX ADO technology from AutoLISP to do this.</p>
<p>The following code illustrates how to read the Customer table from the NorthWind sample database in the Office products using either the Microsoft Access drivers or ODBC.</p>
<p>&#0160;</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c3673a658970b-pi"><img alt="image" border="0" height="176" src="/assets/image_334869.jpg" style="display: inline; border: 0px;" title="image" width="478" /></a> </p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> ADOreadNorWndDB <span style="color: #ff0000;">(</span>&#0160;<span style="color: #0000ff;">/</span> MDB_File SQLStatement ADO_DLLPath ConnectionObject      <br />aCommandObject supp rsState      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; recno RecordSetObject aBOF aEOF fieldsObj reccnt afield i      <br />fvalue coState<span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; You&#39;ll Need To Change the Path to the Northwind.mdb file         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;&#0160; L:\Program Files\Microsoft Office\Office\Samples&#0160; <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Set MDB_File to a locatable Access Database file -&gt;         <br /></span></span>&#0160; <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> MDB_File <span style="color: #ff0000;">(</span>findfile <span style="color: #ff00ff;">&quot;c:\\Northwind.mdb&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> MDB_File <span style="color: #ff00ff;">&quot;c:\\Northwind&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nNorthWind Database was not found, Exiting.&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Setup a SQL statement -&gt;         <br /></span></span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> SQLStatement <span style="color: #ff00ff;">&quot;SELECT * FROM CUSTOMERS&quot;</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Normal path to the ADO DLL, change as needed:         <br /></span></span><span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> ADO_DLLPath <span style="color: #ff00ff;">&quot;c:\\program files\\common files\\system\\ado\\&quot;</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>null adom-Append<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>findfile <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> ADO_DLLPath <span style="color: #ff00ff;">&quot;msado15.dll&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-import-type-library</span>      <br />&#0160;&#0160;&#0160;&#0160; :tlb-filename      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> ADO_DLLPath <span style="color: #ff00ff;">&quot;msado15.dll&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; :methods-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;adom-&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160; :properties-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;adop-&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160; :constants-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;adok-&quot;</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;Exiting - Can&#39;t find \&quot;</span>&quot; ADO_DLLPath <span style="color: #ff00ff;">&quot;msado15.dll\&quot;</span>&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Proceed if Type Library has been loaded.         <br /></span></span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> adom-Append      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Create A Connection Object         <br /></span></span>&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> ConnectionObject <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-create-object</span>&#0160;<span style="color: #ff00ff;">&quot;ADODB.Connection&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Check the mode of the Connection Object         <br /></span></span>&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> coMode <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> ConnectionObject &#39;Mode<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">; = 0       <br /></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Valid Mode values are:         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeUnknown = 0         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeRead = 1         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeWrite = 2         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeReadWrite = 3         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeShareDenyRead = 4         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeShareDenyWrite = 8         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeShareExclusive = 12         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adModeShareDenyNone = 16         <br /></span></span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> coState <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> ConnectionObject &#39;State<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>= coState adok-adStateClosed<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> ConnectionObject &#39;Mode adok-adModeReadWrite<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160; <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Use the direct Microsoft Access Drivers Creates a LDB Locking file here after this executes         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160;&#0160; ConnectionObject         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;Open&quot;</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;Driver={Microsoft Access Driver <span style="color: #ff0000;">(</span>*.mdb<span style="color: #ff0000;">)</span>};DBQ=&quot;</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; MDB_File         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;admin&quot;</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;&quot;</span>          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; adok-adConnectUnspecified         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>          <br /></span></span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Or Use a ODBC Connection, but set it up first -&gt;         <br /></span></span>&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span> ConnectionObject      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;Open&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;DSN=myMDB<span style="background-color: #e6e6e6; color: #800080;">;&quot;</span>        <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;admin&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; adok-adConnectUnspecified      <br />&#0160; <span style="color: #ff0000;">)</span>      <br />      <br />&#0160; <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Create the RecordSet Object         <br /></span></span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> RecordSetObject <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-create-object</span>&#0160;<span style="color: #ff00ff;">&quot;ADODB.RecordSet&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Set the CursorType, and Locking Type         <br /></span></span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> RecordSetObject &#39;CursorType adok-adOpenDynamic<span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Where the property values are:         <br /></span></span>&#0160;&#0160;&#0160;&#0160;&#0160; <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; adok-adOpenForwardOnly = 0         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; adok-adOpenKeyset = 1         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; adok-adOpenDynamic = 2         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160;&#0160; adok-adOpenStatic = 3         <br /></span></span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> RecordSetObject &#39;LockType&#0160;&#0160; adok-adLockOptimistic<span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Where the property values are:         <br /></span></span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adLockReadOnly = 1         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adLockPessimistic = 2         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adLockOptimistic = 3         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160; adok-adLockBatchOptimistic = 4         <br /></span></span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; The following code will not work, do not use it.         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> RecordSetObject        <br /></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; The following fails with a <span style="color: #ff00ff;">&quot;Type mismatch&quot;</span> error          <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span>        <br /></span><span style="background-color: #e6e6e6; color: #800080;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ConnectionObject <span style="color: #ff00ff;">&quot;Execute&quot;</span> SQLStatement &#39;RecordsAffected        <br /></span><span style="background-color: #e6e6e6; color: #800080;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; adok-adCmdText       <br /></span><span style="background-color: #e6e6e6; color: #800080;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>        <br /></span><span style="background-color: #e6e6e6; color: #800080;">;&#0160; <span style="color: #ff0000;">)</span>        <br /></span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Create a Command Object and Connect it to the Connection Object         <br /></span></span>&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> aCommandObject <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-create-object</span>&#0160;<span style="color: #ff00ff;">&quot;ADODB.Command&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> aCommandObject &#39;ActiveConnection ConnectionObject<span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Setup the Command Object, and Execute the SQL query         <br /></span></span>&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> aCommandObject &#39;CommandText SQLStatement<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-put-property</span> aCommandObject &#39;CommandType adok-adCmdText<span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCmdText = 1         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCmdTable = 2         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCmdTableDirect = 512         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCmdStoredProc = 4         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCmdUnknown = 8         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adCommandFile = nil         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; adok-adExecuteNoRecords = 182         <br /></span></span>&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> RecordSetObject <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span> aCommandObject <span style="color: #ff00ff;">&quot;Execute&quot;</span> nil nil      <br />nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> supp <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span> RecordSetObject &#39;Supports adok-adAddNew<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Check to see that the RecordSet is available here -&gt;         <br /></span></span>&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> rsState <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> RecordSetObject &#39;State<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160; adok-adStateClosed = 0         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160; adok-adStateOpen = 1         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160; adok-adStateConnecting = 2         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160; adok-adStateExecuting = 4         <br /></span></span><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;&#0160; adok-adStateFetching = 8         <br /></span></span>&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>= rsState adok-adStateOpen<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> recno <span style="color: #008000;">0</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">while</span>&#0160;<span style="color: #ff0000;">(</span>and      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>=      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> aBOF <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> RecordSetObject &#39;BOF<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; :vlax-false      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>=      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> aEOF <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> RecordSetObject &#39;EOF<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; :vlax-false      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> fieldsObj <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> RecordSetObject &#39;Fields<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> reccnt <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> fieldsObj &#39;Count<span style="color: #ff0000;">)</span> i <span style="color: #008000;">0</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nRecord &quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">itoa</span> recno<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff00ff;">&quot;:\n&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">while</span>&#0160;<span style="color: #ff0000;">(</span>&lt; i reccnt<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> afield <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> fieldsObj &#39;Item i<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> fvalue <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-variant-value</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span>      <br />afield &#39;Value<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\t&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> i <span style="color: #ff0000;">(</span><span style="color: #0000ff;">1+</span> i<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\n&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> recno <span style="color: #ff0000;">(</span><span style="color: #0000ff;">1+</span> recno<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span> RecordSetObject &#39;MoveNext<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nRecord Set NOT Available, Record Set State = &quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">itoa</span>      <br />rsState<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Close only works if it&#39;s Opened !, this can usually be tested by checking if         <br /></span></span>a LDB file exists.      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Check to see that the Connection Object is open here -&gt;         <br /></span></span>&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> coState <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-property</span> ConnectionObject &#39;State<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and <span style="color: #ff0000;">(</span>findfile <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> MDB_File <span style="color: #ff00ff;">&quot;.ldb&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span>= coState adok-adStateOpen<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-invoke-method</span> ConnectionObject <span style="color: #ff00ff;">&quot;Close&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nConnection Object is not Open, please delete the LDB file if       <br />needed.&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>Clean_Up<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Exit if Type Library has NOT been loaded.         <br /></span></span>&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;Exiting - Type Library was Not Loaded: \&quot;</span>&quot; ADO_DLLPath      <br /><span style="color: #ff00ff;">&quot;msado15.dll\&quot;</span>&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> Clean_Up <span style="color: #ff0000;">(</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and aField <span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-object-released-p</span> aField<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-release-object</span> aField<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and fieldsObj <span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-object-released-p</span> fieldsObj<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-release-object</span> fieldsObj<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and aCommandObject <span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-object-released-p</span> aCommandObject<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-release-object</span> aCommandObject<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and RecordSetObject <span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-object-released-p</span> RecordSetObject<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-release-object</span> RecordSetObject<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and ConnectionObject <span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-object-released-p</span> ConnectionObject<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-release-object</span> ConnectionObject<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> ConnectionObject nil RecordSetObject nil aCommandObject nil fieldsObj      <br />nil aField nil<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\n\nRemoving and Releasing Connection Objects.&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nADOreadNorWndDB loaded, type <span style="color: #ff0000;">(</span>ADOreadNorWndDB<span style="color: #ff0000;">)</span> to run.&quot;</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span></span></p>
