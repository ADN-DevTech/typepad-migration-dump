---
layout: "post"
title: "Get the geometry from a dimension entity"
date: "2013-01-17 09:50:01"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/get-the-geometry-from-a-dimension-entity.html "
typepad_basename: "get-the-geometry-from-a-dimension-entity"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>How find information about the three AcDbLine Objects used in a AcDbDimension Object? Itâ€™s known that the 'subentities' of the dimension is stored in a block definition (AcDbBlockTableRecord), and that I have to get this block definition. After getting the block definition, if we try use the function getStartPoint and getEndPoint of the AcDbLine class, but the z component of the returned coordinates is always '0'. Is it possible to get the 'real' coordinates of the dimension lines?</p>  <p>It is normal that getStartPoint() and endStartPoint() returns a Z-value of 0.0 in this case because this is how dimension entities work. The graphics of a dimension is stored in a block table record as an anonymous block. In this block definition there is no z-value used because the entities stored in the block definition are relative to the 'insertion point' of the dimension entity. As a result, every line stored in this block definition returns 0.0 for the z component of the start/endpoints. When AutoCAD has to draw a dimension, it gets the insertion point (location) of the dimension object. Then it takes the block definition and transforms it to the dimension location.</p>  <p>When you need to get the 'real' coordinate of the lines from the dimension block definition, you have to do this transformation manually. The following code shows how to get the transformation matrix. The code iterates all entities stored in the block definition. If the entity iterated to is a line, it transforms to coordinates to the 'real' coordinates and places a new line entity at the same position in the model space.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Iterate every entity stored in the </font></font></span></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// block definition of the dimension.</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">for</font></font></span><font style="font-size: 8pt" color="#000000"> (; !pIter-&gt;done(); pIter-&gt;step()) </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; AcDbEntity *pEnt;&#160;&#160; pIter-&gt;getEntity(pEnt, AcDb::kForRead);&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (pEnt-&gt;isKindOf(AcDbLine::desc()))&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcDbLine *pLine = (AcDbLine*) pEnt;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Get the start and end point.&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGePoint3d ptStart,&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; ptEnd;&#160;&#160;&#160;&#160; pLine-&gt;getStartPoint(ptStart); </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pLine-&gt;getEndPoint(ptEnd);&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">//&#160;&#160;&#160;&#160; // Transform the start and end point.&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">//&#160;&#160;&#160;&#160; // Get the transformation matrix.&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGeMatrix3d mat;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Get the axis of the dimension entity. </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGeVector3d zAxis(pDim-&gt;normal());&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGeVector3d xAxis(zAxis.perpVector());&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGeVector3d yAxis(zAxis.crossProduct(xAxis));</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Build the transformation matrix.&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; mat.setToAlignCoordSys(AcGePoint3d::kOrigin,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; AcGeVector3d(1.0, 0.0, 0.0), </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; AcGeVector3d(0.0, 1.0, 0.0),</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; AcGeVector3d(0.0, 0.0, 1.0),</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; AcGePoint3d::kOrigin,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; xAxis, yAxis, zAxis);&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// z axis&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// To test this matrix create a new line&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// using the start and endpoint of the line </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// from the block definition, and transform&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// the line using the calculated transformation matrix.&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; AcDbLine *pNewLine = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">new</font></span><font color="#000000"> AcDbLine(ptStart, ptEnd);&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pNewLine-&gt;transformBy(mat);&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AcGePoint3d nptStart, nptEnd;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pNewLine-&gt;getStartPoint(nptStart);&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pNewLine-&gt;getEndPoint(nptEnd);&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pNewLine-&gt;setColorIndex(4);&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Append the new line to the model space and close it.&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// The new line should be at the location&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// of the dimension entity.&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; AppendToModelSpaceAndClose(pNewLine);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; }&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pEnt-&gt;close(); </font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>
