---
layout: "post"
title: "Image command from visual LISP?"
date: "2013-01-18 10:12:42"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/image-command-from-visual-lisp.html "
typepad_basename: "image-command-from-visual-lisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>To use the RELOAD, UNLOAD and DETACH options of the IMAGE command, it is not possible to use the AutoCAD ActiveX interface. Instead, you have to 'rebuild' these options using AutoLISP and Visual LISP functions.</p>  <p>-IMAGE RELOAD:   <br />This command options works on the raster image definition object that is stored in the dictionary &quot;ACAD_IMAGE_DICT&quot;. This object uses the DXFgroup code 280 as a 'loaded' flag. If the value of group code 280 is 1, the image file is currently loaded; if the value is 0, the image file is unloaded.</p>  <p>In order to get the correct entry in the image dictionary (to get the right image definition object) and set this flag to 1, use the IMAGERELOAD function (see below).</p>  <p>-IMAGE UNLOAD:   <br />This command options uses the flag previously mentioned. Set the value of group code 280 to 0 to unload the image file. The function IMGUNLOAD does this.</p>  <p>-IMAGE DETACH:   <br />This command options removes the specified image definition object and removes every raster image entity from the current drawing that uses the (deleted) image definition object. The IMGDETACH function does this.</p>  <p>You can use the following functions. They 'rebuild' the functionality of the IMAGE command options.&#160; The functions (imgreload), (imgunload) and (imgdetach) need the image name as a parameter. For the image name, use the AutoCAD wildcard mechanism.</p>  <p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt"><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Use the function 'imgunload' instead of         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; calling the command         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; -IMAGE _Unload         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;;         <br /></span></span><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> imgunload <span style="color: #ff0000">(</span>imgname<span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span>imgloadstat <span style="color: #ff0000">(</span>strcase imgname<span style="color: #ff0000">)</span>&#160;<span style="color: #008000">0</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Use the function 'imgreload' instead of         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; calling the command         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; -IMAGE _Reload         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;;         <br /></span></span><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> imgreload <span style="color: #ff0000">(</span>imgname<span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span>imgloadstat <span style="color: #ff0000">(</span>strcase imgname<span style="color: #ff0000">)</span>&#160;<span style="color: #008000">1</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Use the function 'imgdetach' instead of         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; calling the command         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; -IMAGE _Detach         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;;         <br /></span></span><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> imgdetach <span style="color: #ff0000">(</span>imgname <span style="color: #0000ff">/</span> imgDict imgDictId dictLength counter      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; dictName imgDefIds selSet imgDefId<span style="color: #ff0000">)</span>      <br />      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Iterate all dictionary entries and remove       <br /></span>&#160; <span style="background-color: #e6e6e6; color: #800080">;; the entries which matches 'imgname'.       <br /></span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgname <span style="color: #ff0000">(</span>strcase imgname<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; imgDict <span style="color: #ff0000">(</span>dictsearch <span style="color: #ff0000">(</span>namedobjdict<span style="color: #ff0000">)</span>&#160;<span style="color: #ff00ff">&quot;ACAD_IMAGE_DICT&quot;</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">equal</span> imgDict nil<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span>&#160;<span style="color: #ff00ff">&quot;\nNo images loaded.&quot;</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Image dictionary is available.       <br /></span>&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDictId&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">car</span> imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; dictLength <span style="color: #ff0000">(</span>length imgdict<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; counter&#160; 0      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">while</span>&#160;<span style="color: #ff0000">(</span>&lt; counter dictLength<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">equal</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">car</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span> counter imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>&#160;<span style="color: #008000">3</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Entry name found. Get it.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> dictName <span style="color: #ff0000">(</span>strcase <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span> counter imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Compare the entry name.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>wcmatch dictName imgname<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Remove the dictionary entry...       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>dictremove imgDictId dictName<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; ...and store the entity name of       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; the raster image definition object.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDefIds      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>append imgDefIds      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">1+</span> counter<span style="color: #ff0000">)</span> imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> counter <span style="color: #ff0000">(</span><span style="color: #0000ff">1+</span> counter<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Finished iterating the dictionary.       <br /></span>&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Do we have to remove some raster image entities?       <br /></span>&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= <span style="color: #ff0000">(</span>length imgDefIds<span style="color: #ff0000">)</span>&#160;<span style="color: #008000">0</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Yes, we have to remove some raster image entities       <br /></span>&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; <span style="color: #ff0000">(</span>because the related image definition objects        <br /></span>&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; have been removed<span style="color: #ff0000">)</span>.        <br /></span>&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Select all image entities.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> selSet&#160; <span style="color: #ff0000">(</span>ssget <span style="color: #ff00ff">&quot;X&quot;</span> '<span style="color: #ff0000">(</span><span style="color: #ff0000">(</span><span style="color: #008000">0</span> . <span style="color: #ff00ff">&quot;IMAGE&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; counter 0      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= selSet nil<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Iterate all image entities       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">while</span>&#160;<span style="color: #ff0000">(</span>&lt; counter <span style="color: #ff0000">(</span>sslength selSet<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Get the entity name of the referenced       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; image definition object.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDefId      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">340</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">entget</span>&#160;<span style="color: #ff0000">(</span>ssname selSet counter<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Is the referenced definition object gone?       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>member imgDefId imgDefIds<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; The definition for this image entity       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; have been removed, so let us remove       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; the image entity, as well.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>entdel <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">car</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">entget</span>&#160;<span style="color: #ff0000">(</span>ssname selSet counter<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> counter <span style="color: #ff0000">(</span><span style="color: #0000ff">1+</span> counter<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Empty the selection set       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> selSet nil<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Internal function.         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; This function is called by 'imgunload'         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; and 'imgreload'.         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;;         <br /></span></span><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> imgloadstat <span style="color: #ff0000">(</span>imgname status <span style="color: #0000ff">/</span> imgDict imgDictId      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dictLength counter dictName dictEntry next<span style="color: #ff0000">)</span>      <br />      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Get the image dictionary       <br /></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDict <span style="color: #ff0000">(</span>dictsearch <span style="color: #ff0000">(</span>namedobjdict<span style="color: #ff0000">)</span>&#160;<span style="color: #ff00ff">&quot;ACAD_IMAGE_DICT&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">equal</span> imgDict nil<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span>&#160;<span style="color: #ff00ff">&quot;\nNo images loaded.&quot;</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Image dictionary is available.       <br /></span>&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDictId&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">car</span> imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; dictLength <span style="color: #ff0000">(</span>length imgdict<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; counter&#160; 0      <br />&#160;&#160;&#160;&#160;&#160;&#160; next&#160; T      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">while</span>&#160;<span style="color: #ff0000">(</span>&lt; counter dictLength<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">equal</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">car</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span> counter imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>&#160;<span style="color: #008000">3</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Entry name found. Get it.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Get dictionary entry name       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; and the dictionary entry       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> dictName <span style="color: #ff0000">(</span>strcase <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span> counter imgDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dictEntry <span style="color: #ff0000">(</span>dictnext imgDictId next<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; next&#160; nil      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Compare the entry name with the given name.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>wcmatch dictName imgname<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Entry found. Set the 'loaded' flag       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> dictEntry <span style="color: #ff0000">(</span>subst <span style="color: #ff0000">(</span>cons <span style="color: #008000">280</span> status<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">280</span> dictEntry<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dictEntry      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; There is a problem in AutoCAD       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; which is fixed by 'fixlist'.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Some entities <span style="color: #0000ff">/</span> objects should        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; return on 'entget' 2D points,       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; but VisualLisp gets 3D points.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; The <span style="color: #ff0000">(</span>wrong<span style="color: #ff0000">)</span> z value of thereturned        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; point contains a random value       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; which can break 'entmod'.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; In case of an image definition       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; object we have to remove the       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; z value of group code <span style="color: #008000">10</span> and        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; <span style="color: #008000">11</span> before we can use 'entmod'.        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>entmod <span style="color: #ff0000">(</span>fixlist dictEntry<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> counter <span style="color: #ff0000">(</span><span style="color: #0000ff">1+</span> counter<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Internal function.         <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; This function avoids the problem with 2D <span style="color: #0000ff">/</span> 3D points.          <br /></span></span><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;;         <br /></span></span><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> fixlist <span style="color: #ff0000">(</span>imgDef <span style="color: #0000ff">/</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Get the group code <span style="color: #008000">10</span> and <span style="color: #008000">11</span> list        <br /></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> pt1 <span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">10</span> imgDef<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; pt2 <span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">11</span> imgDef<span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Remove the z value of group code 10...       <br /></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDef <span style="color: #ff0000">(</span>subst <span style="color: #ff0000">(</span>list <span style="color: #008000">10</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span>&#160;<span style="color: #008000">1</span> pt1<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span>&#160;<span style="color: #008000">2</span> pt1<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">10</span> imgDef<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; imgDef      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; ...and the z value of group code 11.       <br /></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> imgDef <span style="color: #ff0000">(</span>subst <span style="color: #ff0000">(</span>list <span style="color: #008000">11</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span>&#160;<span style="color: #008000">1</span> pt2<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">nth</span>&#160;<span style="color: #008000">2</span> pt2<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">11</span> imgDef<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; imgDef      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Return the fixed list       <br /></span>&#160; imgDef      <br /><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span>&#160;<span style="color: #ff00ff">&quot;\nNew lisp functions:&quot;</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span> &quot;\n<span style="color: #ff0000">(</span>imgunload <imgname><span style="color: #ff0000">)</span>, <span style="color: #ff0000">(</span>imgreload <imgname><span style="color: #ff0000">)</span>, <span style="color: #ff0000">(</span>imgdetach<imgname><span style="color: #ff0000">)</span>\n&quot;<span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span></span></p>
