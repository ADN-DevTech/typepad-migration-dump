---
layout: "post"
title: "Displaying a DCL dialog at the last location"
date: "2012-09-21 02:20:00"
author: "Xiaodong Liang"
categories:
  - "AutoCAD"
  - "LISP"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2012/09/displaying-a-dcl-dialog-at-the-last-location.html "
typepad_basename: "displaying-a-dcl-dialog-at-the-last-location"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p><strong>Issue      <br /></strong>Is it possible to display a DCL dialog at the last location it was closed at, rather than having it always open in the center of the screen ?</p>
<p><a name="section2"></a></p>
<p><strong>Solution      <br /></strong>Yes, just feed the value of the last coordinate location of the dialog which is returned via done_dialog, to the new_dialog call. Here&#39;s some lisp code that demonstrates this, please ensure that the DCL file is on the AutoCAD search path.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;">     <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> C:Move_the_DCL <span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span> dcl_id notenum1<span style="color: #ff0000;">)</span>       <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #008000;">1</span><span style="color: #ff0000;">)</span> loadup the Move_DCL.DCl file Dialogue Box, if it&#39;s on the path           <br /></span></span>&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> DCLFileName <span style="color: #ff00ff;">&quot;Move_DCL.dcl&quot;</span><span style="color: #ff0000;">)</span>       <br />&#0160; <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> DCLfile <span style="color: #ff0000;">(</span>findfile DCLFileName<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>null DCLfile<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nDCL file:&#0160;&#0160;&#0160; &quot;</span>&#0160; DCLFileName <span style="color: #ff00ff;">&quot; was Not Found !        <br />Exiting.&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160; <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> dcl_id <span style="color: #ff0000;">(</span>load_dialog DCLfile<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; check to see if it&#39;s loaded, and display at last box location, if available          <br /></span></span>      <br />      <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> lastpt       <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>not <span style="color: #ff0000;">(</span>new_dialog <span style="color: #ff00ff;">&quot;note&quot;</span> dcl_id <span style="color: #ff00ff;">&quot;3&quot;</span> lastpt<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>       <br /><span style="color: #ff00ff;">&quot;\nDCL file:&#0160; &quot;</span>&#0160; DCLFileName <span style="color: #ff00ff;">&quot; was Not Found ! Exiting.&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>not <span style="color: #ff0000;">(</span>new_dialog <span style="color: #ff00ff;">&quot;note&quot;</span> dcl_id <span style="color: #ff00ff;">&quot;3&quot;</span> &#39;<span style="color: #ff0000;">(</span>-1 -1<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">)</span>       <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #008000;">2</span><span style="color: #ff0000;">)</span> setup for return values<span style="color: #0000ff;">/</span>keys from DCL           <br /></span></span>      <br />      <br /><span style="color: #ff0000;">(</span>action_tile <span style="color: #ff00ff;">&quot;cancel&quot;</span>&#0160;<span style="color: #ff00ff;">&quot;<span style="color: #ff0000;">(</span>done_dialog<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> gperr \&quot;</span>\<span style="color: #ff00ff;">&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>&quot;</span><span style="color: #ff0000;">)</span>       <br />      <br />      <br /><span style="color: #ff0000;">(</span>action_tile <span style="color: #ff00ff;">&quot;accept&quot;</span>       <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> ChkBoxReturnValue <span style="color: #ff0000;">(</span>atoi <span style="color: #ff0000;">(</span>get_tile \&quot;</span>note1\<span style="color: #ff00ff;">&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&quot;</span>&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> lastpt <span style="color: #ff0000;">(</span>done_dialog<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&quot;</span>&#0160; <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>&#0160; <br /><span style="color: #ff0000;">)</span>&#0160;&#0160;&#0160;&#0160; <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #008000;">3</span><span style="color: #ff0000;">)</span> now start the dialogue box           <br /></span></span>      <br />      <br />&#0160; <span style="color: #ff0000;">(</span>start_dialog<span style="color: #ff0000;">)</span>       <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #008000;">4</span><span style="color: #ff0000;">)</span> unload the box           <br /></span></span>      <br />      <br />&#0160; <span style="color: #ff0000;">(</span>unload_dialog dcl_id<span style="color: #ff0000;">)</span>       <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">; print out the value returned          <br /></span></span>      <br />      <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> ChkReturnValue       <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nThe ChkBoxReturnValue is: &quot;</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span> ChkBoxReturnValue<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> lastpt       <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nDialogue Box Location: &quot;</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span> lastpt<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;,        <br />&quot;</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span>cadr lastpt<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nLoaded Move_DCL.lsp, type Move_the_DCL to run.&quot;</span><span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span></span></p>
Here&#39;s the DCL Dialog the lisp file uses:
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;">note : dialog {     <br />&#0160; label = <span style="color: #ff00ff;">&quot;Simple Dialog Example&quot;</span>;      <br />&#0160; : boxed_column {      <br />&#0160;&#0160;&#0160;&#0160; alignment =&#0160; centered<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160; children_alignment =&#0160; centered<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160; :text {      <br />&#0160;&#0160;&#0160;&#0160; alignment =&#0160; centered<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160; is_bold = true<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160; key = <span style="color: #ff00ff;">&quot;label1&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160; label = <span style="color: #ff00ff;">&quot;This is a Centered Label&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160; width = 8;      <br />&#0160;&#0160;&#0160;&#0160; }      <br />&#0160;&#0160;&#0160; : spacer { width = 1; }      <br />&#0160; : row {      <br />&#0160;&#0160;&#0160; : spacer { width = 1; }      <br />&#0160;&#0160;&#0160; :toggle {      <br />&#0160;&#0160;&#0160;&#0160; label = <span style="color: #ff00ff;">&quot;Note Number 1&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160; key = <span style="color: #ff00ff;">&quot;note1&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160; mnemonic = <span style="color: #ff00ff;">&quot;C&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160; alignment = right<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160; }&#0160;&#0160;&#0160; <br />&#0160;&#0160;&#0160; }      <br />&#0160;&#0160;&#0160; : spacer { width = 1; }      <br />&#0160;&#0160;&#0160; }      <br />&#0160; : row {&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #0000ff;">/</span><span style="color: #0000ff;">/</span> defines the OK<span style="color: #0000ff;">/</span>Cancel button row      <br />&#0160;&#0160;&#0160; : spacer { width = 1; }      <br />&#0160;&#0160;&#0160; : button {&#0160;&#0160;&#0160; <span style="color: #0000ff;">/</span><span style="color: #0000ff;">/</span> defines the OK button      <br />      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; label = <span style="color: #ff00ff;">&quot;OK&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; key = <span style="color: #ff00ff;">&quot;accept&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; width = 8;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; fixed_width = true<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }      <br />&#0160;&#0160;&#0160; : button {&#0160;&#0160;&#0160; <span style="color: #0000ff;">/</span><span style="color: #0000ff;">/</span> defines the Cancel button      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; label = <span style="color: #ff00ff;">&quot;Cancel&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; is_cancel = true<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; key = <span style="color: #ff00ff;">&quot;cancel&quot;</span>;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; width = 8;      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; fixed_width = true<span style="background-color: #e6e6e6; color: #800080;">;       <br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }      <br />}</span></p>
