---
layout: "post"
title: "Mimic Line Number &gt; New feature on Plant 3D"
date: "2015-04-30 12:25:58"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "Plant3D"
original_url: "https://adndevblog.typepad.com/autocad/2015/04/mimic-line-number-new-feature-on-plant-3d.html "
typepad_basename: "mimic-line-number-new-feature-on-plant-3d"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>This post is actually inspired on <a href="http://adndevblog.typepad.com/autocad/2013/07/create-a-new-linegroup-in-plant3d.html">create a new line group</a> previous post, but with some changes. This will actually mimic the Line Number &gt;&gt; New &gt;&gt; Assign Tag feature on Plant 3D. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7829aa9970b-pi"><img title="Assign Tag" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Assign Tag" src="/assets/image_529375.jpg" width="495" height="211" /></a> </p>  <p>First, remove previous group related to the pipe, in order to avoid belong to more than one line group, which can be a modeling error. Second, just make the code simpler to include on your code. Note this will run for individual pipe making each pipe into a different line group (therefore different ISO production from each of them), you may adjust to a group of pipes.</p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black"><span style="color: blue">private</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CreateNewTag(<span style="color: #2b91af">ObjectId</span> partId, <span style="color: blue">string</span> newTagValue)<br />{<br />&#160; <span style="color: #2b91af">PlantProject</span> currentProj = <span style="color: #2b91af">PlantApplication</span>.CurrentProject;<br />&#160; <span style="color: #2b91af">PipingProject</span> pipeProj = (<span style="color: #2b91af">PipingProject</span>)currentProj.ProjectParts[<span style="color: #a31515">&quot;Piping&quot;</span>];<br />&#160; <span style="color: #2b91af">DataLinksManager</span> dlm = pipeProj.DataLinksManager;<br />&#160; <span style="color: #2b91af">PnPDatabase</span> db = dlm.GetPnPDatabase();<br /> <br />&#160; <span style="color: #2b91af">PnPTable</span> p3dLineGroupTable = db.Tables[<span style="color: #a31515">&quot;P3dLineGroup&quot;</span>];<br />&#160; <span style="color: #2b91af">PnPRow</span> lgRow = p3dLineGroupTable.NewRow();<br />&#160; lgRow[<span style="color: #a31515">&quot;Tag&quot;</span>] = newTagValue;<br />&#160; p3dLineGroupTable.Rows.Add(lgRow);<br /> <br />&#160; <span style="color: blue">int</span> prRowId = dlm.FindAcPpRowId(partId);<br />&#160; <span style="color: #2b91af">PnPRow</span> prRow = db.GetRow(prRowId); <span style="color: green">// not used yet</span><br /> <br />&#160; <span style="color: green">// remove all line groups already related </span><br />&#160; <span style="color: green">// to this pipe, if any, to avoid this pipe</span><br />&#160; <span style="color: green">// belong to multiple line groups</span><br />&#160; <span style="color: #2b91af">PnPRowIdArray</span> priorGroupIds = dlm.GetRelatedRowIds(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;P3dLineGroupPartRelationship&quot;</span>, <span style="color: #a31515">&quot;Part&quot;</span>,<br />&#160;&#160;&#160; prRowId, <span style="color: #a31515">&quot;LineGroup&quot;</span>);<br />&#160; <span style="color: blue">if</span> (priorGroupIds.Count != 1)<br />&#160; {<br />&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">int</span> id <span style="color: blue">in</span> priorGroupIds)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; dlm.Unrelate(<span style="color: #a31515">&quot;P3dLineGroupPartRelationship&quot;</span>,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;LineGroup&quot;</span>, id, <span style="color: #a31515">&quot;Part&quot;</span>, prRowId);<br />&#160;&#160;&#160; }<br />&#160; }<br /> <br />&#160; <span style="color: green">// make the relation</span><br />&#160; <span style="color: blue">if</span> (lgRow.RowId != -1 &amp;&amp; prRowId != -1)<br />&#160; {<br />&#160;&#160;&#160; dlm.Relate(<span style="color: #a31515">&quot;P3dLineGroupPartRelationship&quot;</span>,<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;LineGroup&quot;</span>, lgRow.RowId, <span style="color: #a31515">&quot;Part&quot;</span>, prRowId);<br />&#160; }<br /><br />}</pre>

<p>And here is a simple command to invoke this routine</p>

<pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;customNewTag&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CmdCustomNewTag()<br />{<br />&#160; <span style="color: #2b91af">Editor</span> ed = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Editor;<br /> <br />&#160; <span style="color: #2b91af">PromptEntityOptions</span> peo = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">PromptEntityOptions</span>(<span style="color: #a31515">&quot;\nSelect pipe: &quot;</span>);<br />&#160; peo.SetRejectMessage(<span style="color: #a31515">&quot;\nOnly pipes&quot;</span>);<br />&#160; peo.AddAllowedClass(<span style="color: blue">typeof</span>(<span style="color: #2b91af">Pipe</span>), <span style="color: blue">true</span>);<br />&#160; <span style="color: #2b91af">PromptEntityResult</span> per = ed.GetEntity(peo);<br />&#160; <span style="color: blue">if</span> (per.Status != <span style="color: #2b91af">PromptStatus</span>.OK) <span style="color: blue">return</span>;<br /> <br />&#160; <span style="color: #2b91af">PromptResult</span> pr = ed.GetString(<span style="color: #a31515">&quot;\nEnter new tag: &quot;</span>);<br />&#160; <span style="color: blue">if</span> (pr.Status != <span style="color: #2b91af">PromptStatus</span>.OK) <span style="color: blue">return</span>;<br /> <br />&#160; CreateNewTag(per.ObjectId, pr.StringResult);<br />}</pre>
