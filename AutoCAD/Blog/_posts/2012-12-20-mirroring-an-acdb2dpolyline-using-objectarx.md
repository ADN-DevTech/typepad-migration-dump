---
layout: "post"
title: "Mirroring an AcDb2dpolyline using ObjectARX"
date: "2012-12-20 16:18:50"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/mirroring-an-acdb2dpolyline-using-objectarx.html "
typepad_basename: "mirroring-an-acdb2dpolyline-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html"><font color="#0066cc">Fenton Webb</font></a></p>  <p><b>Issue</b></p>  <p>When I apply a transformation to an AcDb2dPolyline that has a mirror component, the arcs of the reflected polyline go the wrong way. How can I avoid this?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>If the transformation has a reflection or mirror component, the bulges need to be negated. This is done when the object is invoked with the mirror command, but not when calling the ARX function. The following sample does this.</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">utilsmirror</font></span><font color="#000000">() </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// select the 2d polyline</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_name</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ads_entsel</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nPlease pick a polyline&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// convert the ename to an ObjectARX objectid</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbGetObjectId</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000"> );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now open the polyline2d for write</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDb2dPolyline</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pPoly</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForWrite</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pPoly</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGeMatrix3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">mat</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// setup a mirroring transform matrix</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">mat</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">setToMirroring</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">AcGePlane</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kOrigin</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kXAxis</font></span><font color="#000000"> ));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now mirror the polyline</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pPoly</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">transformBy</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">mat</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// finally, iterate the vertexes and invert the bulges</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectIterator</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pIter</font></span><font color="#000000"> =&#160; </font><span style="color: "><font color="#010001">pPoly</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">vertexIterator</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">(; !</font><span style="color: "><font color="#010001">pIter</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">done</font></span><font color="#000000">(); </font><span style="color: "><font color="#010001">pIter</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">step</font></span><font color="#000000">() ) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pIter</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">objectId</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDb2dVertex</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pVertex</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForWrite</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pVertex</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pVertex</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setBulge</font></span><font color="#000000">( -</font><span style="color: "><font color="#010001">pVertex</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">bulge</font></span><font color="#000000">() );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pIter</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>   <font face="Consolas"><font color="#000000"><font style="font-size: 8pt">         <pre style="font-size: 13px; font-family: consolas; background: white; color: black">&#160; <span style="color: blue">else</span>&#160;&#160;&#160;&#160; <span style="color: #010001">acutPrintf</span>(<span style="color: #010001">_T</span>(<span style="color: #a31515">&quot;\nNot an AcDb2dPolyline...&quot;</span>));</pre>

        <pre style="font-size: 13px; font-family: consolas; background: white; color: black">}</pre>
      </font></font></font>

  <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>
</div>
