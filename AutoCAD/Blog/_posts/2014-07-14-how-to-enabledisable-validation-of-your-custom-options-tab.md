---
layout: "post"
title: "How to enable/disable validation of your custom Options Tab?"
date: "2014-07-14 07:08:11"
author: "Philippe Leefsma"
categories:
  - ".NET"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2014/07/how-to-enabledisable-validation-of-your-custom-options-tab.html "
typepad_basename: "how-to-enabledisable-validation-of-your-custom-options-tab"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>In those following posts Kean is showing how to add your own custom tab to the AutoCAD Options dialog:</p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/2008/11/adding-a-custom.html">Adding a custom tab to AutoCAD's options dialog using .NET - Part 1</a></p>  <p><a href="http://through-the-interface.typepad.com/through_the_interface/2008/11/adding-a-cust-1.html">Adding a custom tab to AutoCAD's options dialog using .NET - Part 2</a></p>  <p>What those samples arenâ€™t showing, is how you can enable/disable the OK button, so the user will only be able to validate the dialog if his choices are matching your logic.</p>  <p>In order to achieve such a feature, a little hack relying on a couple of Win32 P/Invoked APIs is likely to be needed:</p>  <p>In the sample below, I am using FindWindowEx and EnableWindow to control the OK button, depending on the value provided in a textbox.</p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff">public</font></span><span style="font-family: "><font color="#000000"> </font><span style="color: "><font color="#0000ff">partial</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">class</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">OptionsTabControl</font></span><font color="#000000"> : </font><span style="color: "><font color="#2b91af">UserControl</font></span></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">private</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> _hWndOkBtn;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>[</font><span style="color: "><font color="#2b91af">DllImport</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;user32.dll&quot;</font></span><font color="#000000">, SetLastError = </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">)]</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">private</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">extern</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> FindWindowEx(</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> parentHandle,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> childAfter,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> className,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> windowTitle);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>[</font><span style="color: "><font color="#2b91af">DllImport</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;user32.dll&quot;</font></span><font color="#000000">)]</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>[</font><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">: </font><span style="color: "><font color="#2b91af">MarshalAs</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">UnmanagedType</font></span><font color="#000000">.Bool)]</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">extern</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> EnableWindow(</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> hWnd, </font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> bEnable);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> OptionsTabControl()</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>InitializeComponent();</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Finds Options dialog</font></span></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> hWnd = FindWindowEx(</font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000">.Zero,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000">.Zero,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#a31515">&quot;#32770&quot;</font></span><font color="#000000">,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#a31515">&quot;Options&quot;</font></span><font color="#000000">);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#008000">// Finds Ok button</font></span></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>_hWndOkBtn = FindWindowEx(hWnd,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000">.Zero,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#a31515">&quot;Button&quot;</font></span><font color="#000000">,</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#a31515">&quot;Ok&quot;</font></span><font color="#000000">);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>EnableWindow(_hWndOkBtn, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>tbValidation.Text = </font><span style="color: "><font color="#a31515">&quot;Validate me ...&quot;</font></span><font color="#000000">;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>}</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">private</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> tbValidation_TextChanged(</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">object</font></span><font color="#000000"> sender, </font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">EventArgs</font></span><font color="#000000"> e)</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (tbValidation.Text.Length == 0)</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>EnableWindow(_hWndOkBtn, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">else</font></span></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font color="#0000ff">bool</font></span><font color="#000000"> enabled = </font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (tbValidation.Text == </font><span style="color: "><font color="#a31515">&quot;ADN rules!&quot;</font></span><font color="#000000">);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>EnableWindow(_hWndOkBtn, enabled);</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>}</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes">&#160;&#160;&#160; </span>}</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: "><font face="Consolas"><font color="#000000">}</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none">&#160;</p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none">Complete sample also attached.</p>  <div id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:a9a70a68-1e03-470f-9e03-ee150e822f3d" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><p> <a href="http://adndevblog.typepad.com/acadoptionsdlg-4.zip" target="_blank">AcadOptionsDlg.zip</a></p></div>
