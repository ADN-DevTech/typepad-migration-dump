---
layout: "post"
title: "Create a MPolygon in AutoCAD using .NET"
date: "2012-08-27 13:20:40"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/create-a-mpolygon-in-autocad-using-net.html "
typepad_basename: "create-a-mpolygon-in-autocad-using-net"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>MPolygon is a custom object created for AutoCAD Map 3D, but is also available in vanilla AutoCAD from ObjectARX. To use it from .NET, then the project need to reference the <strong>AcMPolygonMGD.dll</strong> and it is required to load the object enabler <strong>AcMPolygonObj19.dbx</strong> into AutoCAD prior to using MPolygon functions. Both files can be found in AutoCAD's install folder.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.Runtime</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.DatabaseServices</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.ApplicationServices</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.Geometry</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Class</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">MPolygonCommandClass</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' to make sure the required DBX is loaded</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' let's implement the extension application</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' and load it on Initilize</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Implements</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">IExtensionApplication</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Public</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> Initialize() _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Implements</font></span><font color="#000000"> </font><span><font color="#2b91af">IExtensionApplication</font></span><font color="#000000">.Initialize</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' Make sure that AcMPolygonObj19.dbx is loaded for MPolygon</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' the 19 version number is valid for AutoCAD 2013</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; Autodesk.AutoCAD.Runtime. _</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">SystemObjects</font></span><font color="#000000">.DynamicLinker.LoadModule( _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;AcMPolygonObj19.dbx&quot;</font></span><font color="#000000">, </font><span><font color="#0000ff">False</font></span><font color="#000000">, </font><span><font color="#0000ff">False</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Public</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> Terminate() _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Implements</font></span><font color="#000000"> </font><span><font color="#2b91af">IExtensionApplication</font></span><font color="#000000">.Terminate</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' nothing is required for this sample</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; &lt;</font></font><font style="font-size: 8pt"><span><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span><font color="#a31515">&quot;CreateMPolygon&quot;</font></span><font color="#000000">)&gt; _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Public</font></span><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> CreateMPolygon()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> db </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">Database</font></span><font color="#000000"> = </font><span><font color="#2b91af">Application</font></span><font color="#000000">. _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; DocumentManager.MdiActiveDocument.Database</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Using</font></span><font color="#000000"> transaction </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">Transaction</font></span><font color="#000000"> = _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; db.TransactionManager.StartTransaction()</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' open the block tabela and the model space</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> bt </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">BlockTable</font></span><font color="#000000"> = transaction.GetObject( _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; db.BlockTableId, </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForRead)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> btr </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> = transaction.GetObject( _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bt(</font></font><font style="font-size: 8pt"><span><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">.ModelSpace), _</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForWrite)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' start creating the MPolygon</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' by its loop</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> mPolygonLoop </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">MPolygonLoop</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">MPolygonLoop</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop.Add(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BulgeVertex</font></span><font color="#000000">(</font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">Point2d</font></span><font color="#000000">(2, 2), 0))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop.Add(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BulgeVertex</font></span><font color="#000000">(</font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">Point2d</font></span><font color="#000000">(2, 1), 0))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop.Add(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BulgeVertex</font></span><font color="#000000">(</font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">Point2d</font></span><font color="#000000">(1, 1), 0))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop.Add(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BulgeVertex</font></span><font color="#000000">(</font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">Point2d</font></span><font color="#000000">(1, 2), 0))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygonLoop.Add(</font></font><font style="font-size: 8pt"><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">BulgeVertex</font></span><font color="#000000">(</font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">Point2d</font></span><font color="#000000">(2, 2), 0))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' finally create the entity and append</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' the the model space </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Dim</font></span><font color="#000000"> mPolygon </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font><span><font color="#2b91af">MPolygon</font></span><font color="#000000"> = </font><span><font color="#0000ff">New</font></span><font color="#000000"> </font><span><font color="#2b91af">MPolygon</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; mPolygon.AppendMPolygonLoop(mPolygonLoop, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">False</font></span><font color="#000000">, 0)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; btr.AppendEntity(mPolygon)</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; transaction.AddNewlyCreatedDBObject(mPolygon, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">True</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; transaction.Commit()</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">Catch</font></span><font color="#000000"> ex </font><span><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Exception</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Debug</font></span><font color="#000000">.WriteLine(ex.ErrorStatus)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Debug</font></span><font color="#000000">.WriteLine(ex.Message)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Using</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Class</font></span></font></p> </div>
