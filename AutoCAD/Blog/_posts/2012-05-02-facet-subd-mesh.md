---
layout: "post"
title: "Facet SubD Mesh"
date: "2012-05-02 03:26:46"
author: "Adam Nagy"
categories:
  - "Adam Nagy"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/facet-subd-mesh.html "
typepad_basename: "facet-subd-mesh"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p> <p>If you want to get back the facet geometry of an AcDbSubDMesh entity (simply called “Mesh” in the Properties palette), then you can use either getFaceArray (Returns Level 0 (base) mesh face list array) or getSubDividedFaceArray (Returns smoothed mesh face list array).</p> <p>The below sample code uses the latter.</p>  <div style="font-family: Courier New; font-size: 8pt; color: black; background: white;"> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">void</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">drawSubDMeshFacets()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">{</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; ads_name name;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcGePoint3d pt;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> ret = acedEntSel(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; _T(</span><span style="color: #a31515; line-height: 140%;">&quot;\nSelect a SubD Mesh: &quot;</span><span style="line-height: 140%;">), name, asDblArray(pt));</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (ret != RTNORM)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; acutPrintf(_T(</span><span style="color: #a31515; line-height: 140%;">&quot;\nNothing selected&quot;</span><span style="line-height: 140%;">));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcDbObjectId id;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; acdbGetObjectId(id, name);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (id.objectClass() != AcDbSubDMesh::desc())</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; acutPrintf(_T(</span><span style="color: #a31515; line-height: 140%;">&quot;\nSelected entity is not a SubD Mesh&quot;</span><span style="line-height: 140%;">));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcDbObjectPointer&lt;AcDbSubDMesh&gt; mesh(id, AcDb::kForRead); </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcGePoint3dArray vertices;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; mesh-&gt;getSubDividedVertices(vertices);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcArray&lt;Adesk::Int32&gt; faces;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; mesh-&gt;getSubDividedFaceArray(faces);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// The content of the faces list is like so:</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// [number of vertices of next face], </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// &lt;vertexIndex1, vertexIndex2, etc&gt;, </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// e.g. [4], &lt;1, 2, 3, 4&gt;, [3], &lt;1, 2, 3&gt;, etc</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcDbDatabase * pDb = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; acdbHostApplicationServices()-&gt;workingDatabase();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; AcDbBlockTableRecordPointer </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; ms(ACDB_MODEL_SPACE, pDb, AcDb::kForWrite);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">for</span><span style="line-height: 140%;"> (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> numVertices = 0, i = 0; </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; i &lt; faces.length(); i += numVertices + 1)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; numVertices = faces.at(i);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Let's draw the edges of the face</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">for</span><span style="line-height: 140%;"> (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> j = 0; j &lt; numVertices; j++)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; AcGePoint3d pt1 = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; vertices.at(faces.at(i + j + 1));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; AcGePoint3d pt2 = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; vertices.at(faces.at(i + ((j + 1) % numVertices) + 1));</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; AcDbObjectPointer&lt;AcDbLine&gt; line;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; line.create();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; line-&gt;setStartPoint(pt1);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; line-&gt;setEndPoint(pt2);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; ms-&gt;appendAcDbEntity(line); </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">}</span></p> </div>
