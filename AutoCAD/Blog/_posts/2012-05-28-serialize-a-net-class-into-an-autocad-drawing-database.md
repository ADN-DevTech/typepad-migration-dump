---
layout: "post"
title: "Serialize a .NET class into an AutoCAD drawing database"
date: "2012-05-28 09:56:01"
author: "Adam Nagy"
categories:
  - ".NET"
  - "Adam Nagy"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/serialize-a-net-class-into-an-autocad-drawing-database.html "
typepad_basename: "serialize-a-net-class-into-an-autocad-drawing-database"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>I would like to serialize my .NET class into an AutoCAD drawing database, so it is saved into the drawing, and I can recreate my class again (deserialize it), when the drawing is reopened. How could I do it?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>You could use the .NET serialization technique to serialize your class into a binary stream and then you can save it in the drawing as a bunch of binary chunks. You could save the ResultBuffer to an object's XData or into an Xrecord.Data of an entity or an item in the Named Objects Dictionary (NOD). DevNote TS2563 tells you what the difference is between using XData and Xrecord. If you are saving it into an XData, then the ResultBuffer needs to start with a registered application name. Here is a sample which shows this:</p>  <div style="font-family: Courier New; font-size: 8pt; color: black; background: white;"> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> System;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> System.Runtime.Serialization;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> System.Runtime.Serialization.Formatters.Binary;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> System.IO;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> System.Security.Permissions;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.Runtime;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">acApp</span><span style="line-height: 140%;"> = Autodesk.AutoCAD.ApplicationServices.</span><span style="color: #2b91af; line-height: 140%;">Application</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.DatabaseServices;</span></p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> Autodesk.AutoCAD.EditorInput;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">[</span><span style="color: blue; line-height: 140%;">assembly</span><span style="line-height: 140%;">: </span><span style="color: #2b91af; line-height: 140%;">CommandClass</span><span style="line-height: 140%;">(</span><span style="color: blue; line-height: 140%;">typeof</span><span style="line-height: 140%;">(MyClassSerializer.</span><span style="color: #2b91af; line-height: 140%;">Commands</span><span style="line-height: 140%;">))]</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="color: blue; line-height: 140%;">namespace</span><span style="line-height: 140%;"> MyClassSerializer</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">{</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// We need it to help with deserialization</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">sealed</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">class</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyBinder</span><span style="line-height: 140%;"> : </span><span style="color: #2b91af; line-height: 140%;">SerializationBinder</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">override</span><span style="line-height: 140%;"> System.</span><span style="color: #2b91af; line-height: 140%;">Type</span><span style="line-height: 140%;"> BindToType(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> assemblyName,</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> typeName)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">Type</span><span style="line-height: 140%;">.GetType(</span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;">.Format(</span><span style="color: #a31515; line-height: 140%;">&quot;{0}, {1}&quot;</span><span style="line-height: 140%;">,</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; typeName, assemblyName));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: green; line-height: 140%;">// Helper class to write to and from ResultBuffer</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">class</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyUtil</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">const</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> kMaxChunkSize = 127;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> StreamToResBuf(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;"> ms, </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> appName)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;">(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">TypedValue</span><span style="line-height: 140%;">(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;">)</span><span style="color: #2b91af; line-height: 140%;">DxfCode</span><span style="line-height: 140%;">.ExtendedDataRegAppName, appName));</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">for</span><span style="line-height: 140%;"> (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> i = 0; i &lt; ms.Length; i += kMaxChunkSize)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> length = (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;">)</span><span style="color: #2b91af; line-height: 140%;">Math</span><span style="line-height: 140%;">.Min(ms.Length - i, kMaxChunkSize);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">byte</span><span style="line-height: 140%;">[] datachunk = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">byte</span><span style="line-height: 140%;">[length];</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ms.Read(datachunk, 0, length);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; resBuf.Add(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">TypedValue</span><span style="line-height: 140%;">(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;">)</span><span style="color: #2b91af; line-height: 140%;">DxfCode</span><span style="line-height: 140%;">.ExtendedDataBinaryChunk, datachunk));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> resBuf;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;"> ResBufToStream(</span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;"> ms = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">TypedValue</span><span style="line-height: 140%;">[] values = resBuf.AsArray();</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Start from 1 to skip application name</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">for</span><span style="line-height: 140%;"> (</span><span style="color: blue; line-height: 140%;">int</span><span style="line-height: 140%;"> i = 1; i &lt; values.Length; i++)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">byte</span><span style="line-height: 140%;">[] datachunk = (</span><span style="color: blue; line-height: 140%;">byte</span><span style="line-height: 140%;">[])values[i].Value;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ms.Write(datachunk, 0, datachunk.Length);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; ms.Position = 0;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> ms;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; [</span><span style="color: #2b91af; line-height: 140%;">Serializable</span><span style="line-height: 140%;">]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">abstract</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">class</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyBaseClass</span><span style="line-height: 140%;"> : </span><span style="color: #2b91af; line-height: 140%;">ISerializable</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">const</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> appName = </span><span style="color: #a31515; line-height: 140%;">&quot;MyApp&quot;</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> MyBaseClass()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">object</span><span style="line-height: 140%;"> NewFromResBuf(</span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">BinaryFormatter</span><span style="line-height: 140%;"> bf = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">BinaryFormatter</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; bf.Binder = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyBinder</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;"> ms = </span><span style="color: #2b91af; line-height: 140%;">MyUtil</span><span style="line-height: 140%;">.ResBufToStream(resBuf);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MyBaseClass</span><span style="line-height: 140%;"> mbc = (</span><span style="color: #2b91af; line-height: 140%;">MyBaseClass</span><span style="line-height: 140%;">)bf.Deserialize(ms);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> mbc;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">object</span><span style="line-height: 140%;"> NewFromEntity(</span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;"> ent)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> (</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf = ent.GetXDataForApplication(appName))</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> NewFromResBuf(resBuf);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> SaveToResBuf()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">BinaryFormatter</span><span style="line-height: 140%;"> bf = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">BinaryFormatter</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;"> ms = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MemoryStream</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; bf.Serialize(ms, </span><span style="color: blue; line-height: 140%;">this</span><span style="line-height: 140%;">);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; ms.Position = 0;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf = </span><span style="color: #2b91af; line-height: 140%;">MyUtil</span><span style="line-height: 140%;">.StreamToResBuf(ms, appName);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> resBuf;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">void</span><span style="line-height: 140%;"> SaveToEntity(</span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;"> ent)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Make sure application name is registered</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// If we were to save the ResultBuffer to an Xrecord.Data,</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// then we would not need to have a registered application name</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Transaction</span><span style="line-height: 140%;"> tr = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ent.Database.TransactionManager.TopTransaction;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">RegAppTable</span><span style="line-height: 140%;"> regTable =</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; (</span><span style="color: #2b91af; line-height: 140%;">RegAppTable</span><span style="line-height: 140%;">)tr.GetObject(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ent.Database.RegAppTableId, </span><span style="color: #2b91af; line-height: 140%;">OpenMode</span><span style="line-height: 140%;">.ForWrite);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (!regTable.Has(</span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;">.appName))</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">RegAppTableRecord</span><span style="line-height: 140%;"> app = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">RegAppTableRecord</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; app.Name = </span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;">.appName;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; regTable.Add(app);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; tr.AddNewlyCreatedDBObject(app, </span><span style="color: blue; line-height: 140%;">true</span><span style="line-height: 140%;">);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> (</span><span style="color: #2b91af; line-height: 140%;">ResultBuffer</span><span style="line-height: 140%;"> resBuf = SaveToResBuf())</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ent.XData = resBuf;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; [</span><span style="color: #2b91af; line-height: 140%;">SecurityPermission</span><span style="line-height: 140%;">(</span><span style="color: #2b91af; line-height: 140%;">SecurityAction</span><span style="line-height: 140%;">.LinkDemand,</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp;&nbsp; Flags = </span><span style="color: #2b91af; line-height: 140%;">SecurityPermissionFlag</span><span style="line-height: 140%;">.SerializationFormatter)]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">abstract</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">void</span><span style="line-height: 140%;"> GetObjectData(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">SerializationInfo</span><span style="line-height: 140%;"> info, </span><span style="color: #2b91af; line-height: 140%;">StreamingContext</span><span style="line-height: 140%;"> context);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; [</span><span style="color: #2b91af; line-height: 140%;">Serializable</span><span style="line-height: 140%;">]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">class</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;"> : </span><span style="color: #2b91af; line-height: 140%;">MyBaseClass</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> myString;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">double</span><span style="line-height: 140%;"> myDouble;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> MyClass()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">protected</span><span style="line-height: 140%;"> MyClass(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">SerializationInfo</span><span style="line-height: 140%;"> info, </span><span style="color: #2b91af; line-height: 140%;">StreamingContext</span><span style="line-height: 140%;"> context)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (info == </span><span style="color: blue; line-height: 140%;">null</span><span style="line-height: 140%;">)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">throw</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> System.</span><span style="color: #2b91af; line-height: 140%;">ArgumentNullException</span><span style="line-height: 140%;">(</span><span style="color: #a31515; line-height: 140%;">&quot;info&quot;</span><span style="line-height: 140%;">);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; myString = (</span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;">)info.GetValue(</span><span style="color: #a31515; line-height: 140%;">&quot;MyString&quot;</span><span style="line-height: 140%;">, </span><span style="color: blue; line-height: 140%;">typeof</span><span style="line-height: 140%;">(</span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;">));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; myDouble = (</span><span style="color: blue; line-height: 140%;">double</span><span style="line-height: 140%;">)info.GetValue(</span><span style="color: #a31515; line-height: 140%;">&quot;MyDouble&quot;</span><span style="line-height: 140%;">, </span><span style="color: blue; line-height: 140%;">typeof</span><span style="line-height: 140%;">(</span><span style="color: blue; line-height: 140%;">double</span><span style="line-height: 140%;">));</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; [</span><span style="color: #2b91af; line-height: 140%;">SecurityPermission</span><span style="line-height: 140%;">(</span><span style="color: #2b91af; line-height: 140%;">SecurityAction</span><span style="line-height: 140%;">.LinkDemand,</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp;&nbsp; Flags = </span><span style="color: #2b91af; line-height: 140%;">SecurityPermissionFlag</span><span style="line-height: 140%;">.SerializationFormatter)]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">override</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">void</span><span style="line-height: 140%;"> GetObjectData(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">SerializationInfo</span><span style="line-height: 140%;"> info, </span><span style="color: #2b91af; line-height: 140%;">StreamingContext</span><span style="line-height: 140%;"> context)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; info.AddValue(</span><span style="color: #a31515; line-height: 140%;">&quot;MyString&quot;</span><span style="line-height: 140%;">, myString);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; info.AddValue(</span><span style="color: #a31515; line-height: 140%;">&quot;MyDouble&quot;</span><span style="line-height: 140%;">, myDouble);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Just for testing purposes</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">override</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">string</span><span style="line-height: 140%;"> ToString()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">base</span><span style="line-height: 140%;">.ToString() + </span><span style="color: #a31515; line-height: 140%;">&quot;,&quot;</span><span style="line-height: 140%;"> + </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; myString + </span><span style="color: #a31515; line-height: 140%;">&quot;,&quot;</span><span style="line-height: 140%;"> + myDouble.ToString();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">class</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">Commands</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; [</span><span style="color: #2b91af; line-height: 140%;">CommandMethod</span><span style="line-height: 140%;">(</span><span style="color: #a31515; line-height: 140%;">&quot;SaveClassToEntityXData&quot;</span><span style="line-height: 140%;">)]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">void</span><span style="line-height: 140%;"> SaveClassToEntityXData()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Database</span><span style="line-height: 140%;"> db = </span><span style="color: #2b91af; line-height: 140%;">acApp</span><span style="line-height: 140%;">.DocumentManager.MdiActiveDocument.Database;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Editor</span><span style="line-height: 140%;"> ed = </span><span style="color: #2b91af; line-height: 140%;">acApp</span><span style="line-height: 140%;">.DocumentManager.MdiActiveDocument.Editor;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">PromptEntityResult</span><span style="line-height: 140%;"> per = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ed.GetEntity(</span><span style="color: #a31515; line-height: 140%;">&quot;Select entity to save class to:\n&quot;</span><span style="line-height: 140%;">);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (per.Status != </span><span style="color: #2b91af; line-height: 140%;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Create an object</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;"> mc = </span><span style="color: blue; line-height: 140%;">new</span><span style="line-height: 140%;"> </span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;">();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; mc.myDouble = 1.2345;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; mc.myString = </span><span style="color: #a31515; line-height: 140%;">&quot;Some text&quot;</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Save it to the document</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> (</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Transaction</span><span style="line-height: 140%;"> tr = db.TransactionManager.StartTransaction())</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;"> ent = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;">)tr.GetObject(per.ObjectId, </span><span style="color: #2b91af; line-height: 140%;">OpenMode</span><span style="line-height: 140%;">.ForWrite);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; mc.SaveToEntity(ent);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; tr.Commit();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Write some info about the results</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; ed.WriteMessage(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #a31515; line-height: 140%;">&quot;Content of MyClass we serialized:\n {0} \n&quot;</span><span style="line-height: 140%;">, mc.ToString());</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; [</span><span style="color: #2b91af; line-height: 140%;">CommandMethod</span><span style="line-height: 140%;">(</span><span style="color: #a31515; line-height: 140%;">&quot;GetClassFromEntityXData&quot;</span><span style="line-height: 140%;">)]</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">static</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">public</span><span style="line-height: 140%;"> </span><span style="color: blue; line-height: 140%;">void</span><span style="line-height: 140%;"> GetClassFromEntityXData()</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Database</span><span style="line-height: 140%;"> db = </span><span style="color: #2b91af; line-height: 140%;">acApp</span><span style="line-height: 140%;">.DocumentManager.MdiActiveDocument.Database;</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Editor</span><span style="line-height: 140%;"> ed = </span><span style="color: #2b91af; line-height: 140%;">acApp</span><span style="line-height: 140%;">.DocumentManager.MdiActiveDocument.Editor;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">PromptEntityResult</span><span style="line-height: 140%;"> per = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ed.GetEntity(</span><span style="color: #a31515; line-height: 140%;">&quot;Select entity to get class from:\n&quot;</span><span style="line-height: 140%;">);</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">if</span><span style="line-height: 140%;"> (per.Status != </span><span style="color: #2b91af; line-height: 140%;">PromptStatus</span><span style="line-height: 140%;">.OK)</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">return</span><span style="line-height: 140%;">;</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Get back the class </span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; </span><span style="color: blue; line-height: 140%;">using</span><span style="line-height: 140%;"> (</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Transaction</span><span style="line-height: 140%;"> tr = db.TransactionManager.StartTransaction())</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; {</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;"> ent = </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span style="color: #2b91af; line-height: 140%;">Entity</span><span style="line-height: 140%;">)tr.GetObject(per.ObjectId, </span><span style="color: #2b91af; line-height: 140%;">OpenMode</span><span style="line-height: 140%;">.ForRead);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;"> mc = (</span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;">)</span><span style="color: #2b91af; line-height: 140%;">MyClass</span><span style="line-height: 140%;">.NewFromEntity(ent);</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: green; line-height: 140%;">// Write some info about the results</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; ed.WriteMessage(</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #a31515; line-height: 140%;">&quot;Content of MyClass we deserialized:\n {0} \n&quot;</span><span style="line-height: 140%;">, </span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mc.ToString());</span></p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; &nbsp; tr.Commit();</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; &nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">&nbsp; }</span></p> <p style="margin: 0px;"><span style="line-height: 140%;">}</span></p> </div>
