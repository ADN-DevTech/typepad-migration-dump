---
layout: "post"
title: "AutoCAD Lisp: Why does (rtos 8.6375 2 3) return 8.637 instead of 8.638 as expected?"
date: "2012-08-22 02:30:13"
author: "Philippe Leefsma"
categories:
  - "AutoCAD"
  - "LISP"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/autocad-lisp-why-does-rtos-86375-2-3-return-8637-instead-of-8638-as-expected.html "
typepad_basename: "autocad-lisp-why-does-rtos-86375-2-3-return-8637-instead-of-8638-as-expected"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p><b>Q:</b></p>  <p>Why does (rtos 8.6375 2 3) return 8.637 instead of 8.638 as expected? How can I correct it?</p>  <p><a name="section2"></a></p>  <p><b>A:</b></p>  <p>This is a known issue in AutoCAD and AutoLISP. However, it is more of a precision issue of computers than a bug of AutoCAD.</p>  <p>There is always a certain degree of inaccuracy when calculating values. This is the case in other programming languages as well. To demonstrate this, we will compare the numbers 8.6375 and 7.6375. Observe the following output in the AutoCAD command window:</p>  <p><em>Command: (rtos 7.6375 2 3)     <br />&quot;7.638&quot;      <br />Command: (rtos 7.6375 2 16)      <br />&quot;7.6375&quot;      <br />Command: (rtos 8.6375 2 3)      <br />&quot;8.637&quot;      <br />Command: (rtos 8.6375 2 16)      <br />&quot;8.637499999999999&quot;</em></p>  <p>It may be surprising that the number 8.6375 is represented as 8.637499999999999 above.&#160; The computer represents this value as a binary number (a series of 0s and 1s).&#160; It must perform transformations or calculations for all other numbers (especially for decimals), thus causing the precision issue.</p>  <p>This is taken into account by the workaround below, which substitutes (bzh_rtos ) for the original (rtos ) function.&#160; The comments help to explain the process:</p>  <br />  <div style="line-height: 16px; widows: 2; text-transform: none; text-indent: 0px; letter-spacing: normal; font-family: ; white-space: normal; orphans: 2; color: ; clear: both; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="clear">   <p style="line-height: 16px; margin: 0px 0px 15px"><font style="font-size: 9pt" color="#000000"></font></p> </div>  <pre style="line-height: normal; widows: 2; text-transform: none; background-color: rgb(221,221,221); text-indent: 0px; letter-spacing: normal; font-family: ; orphans: 2; color: ; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px"><font style="font-size: 8pt" color="#000000">(defun Bzh_rtos<br />&#160;&#160; (num mod pre / A B len dec1 dec2 dec22 small_value real_num)<br />&#160;&#160; (setq A (rtos num mod pre))&#160; ;A contains the value (rtos) returns<br />&#160;&#160; (setq B (rtos num mod (+ 1 pre))) <br />&#160;&#160; (setq real_num num)</font><p style="line-height: 16px; margin: 0px 0px 15px"></p><font style="font-size: 8pt">
</font><p style="line-height: 16px; margin: 0px 0px 15px"><font style="font-size: 9pt" color="#000000">&#160;&#160; (setq len&#160;&#160; (strlen A)&#160; ;Length of A string<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dec1&#160; (substr A len 1);The last decimal of A<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dec2&#160; (substr B len 1);The next to the last decimal of B<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dec22 (substr B (+ len 1) 1);The last decimal of B<br />&#160;&#160; )</font></p><font style="font-size: 8pt">
</font><p style="line-height: 16px; margin: 0px 0px 15px"><font style="font-size: 9pt" color="#000000">&#160;&#160; ;;Set a fuzz factor. We can change it to other value as we like.<br />&#160;&#160; (setq small_value (expt 0.1 (+ 1 14)))<br />&#160;&#160; ;;Check if dec1 equals to dec2<br />&#160;&#160; (if (= dec1 dec2)<br />&#160;&#160;&#160;&#160;&#160; (if (= dec22 &quot;5&quot;)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (setq real_num (+ real_num small_value))<br />&#160;&#160;&#160;&#160;&#160; )<br />&#160;&#160; )</font></p><font style="font-size: 8pt">
</font><p style="line-height: 16px; margin: 0px 0px 15px"><font style="font-size: 9pt" color="#000000">&#160;&#160; ;;Recaculate the adjusted number and return<br />&#160;&#160; (rtos real_num mod pre)<br />)</font></p></pre>
