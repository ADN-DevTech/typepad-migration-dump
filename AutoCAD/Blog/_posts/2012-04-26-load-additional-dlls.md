---
layout: "post"
title: "Load additional dll&rsquo;s"
date: "2012-04-26 10:24:52"
author: "Adam Nagy"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "Adam Nagy"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/04/load-additional-dlls.html "
typepad_basename: "load-additional-dlls"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>If you have a main .NET dll that is loaded into AutoCAD and it needs to access functionality from another dll, then here are a couple of ways you can try to load the extra dll.</p>  <ol>   <li>Make the extra dll strongly named and modify acad.exe.config:      <br />Note: a dll that is referencing AutoCAD .NET assemblies cannot be made strongly named since those assemblies are not strongly named either       <div style="font-family: courier new; background: white; color: black; font-size: 8pt">       <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;</span><span style="line-height: 140%; color: #a31515">assemblyBinding</span><span style="line-height: 140%; color: blue"> </span><span style="line-height: 140%; color: red">xmlns</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">urn:schemas-microsoft-com:asm.v1</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">&gt;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;</span><span style="line-height: 140%; color: #a31515">dependentAssembly</span><span style="line-height: 140%; color: blue">&gt;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">assemblyIdentity</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">name</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">DllToLoad</span><span style="line-height: 140%">&quot;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">publicKeyToken</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">cace528f15d690ab</span><span style="line-height: 140%">&quot;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">culture</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">neutral</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue"> /&gt;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160; &lt;</span><span style="line-height: 140%; color: #a31515">codeBase</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">version</span><span style="line-height: 140%; color: blue">=</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">1.0.0.0</span><span style="line-height: 140%">&quot;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: red">href</span><span style="line-height: 140%; color: blue">= </span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">file://C:\Documents and Settings\Administrator\My Documents\Visual Studio 2010\Projects\TestDllLoad\DllToLoad\bin\Debug\DllToLoad.dll</span><span style="line-height: 140%">&quot;</span><span style="line-height: 140%; color: blue">/&gt;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&#160; &lt;/</span><span style="line-height: 140%; color: #a31515">dependentAssembly</span><span style="line-height: 140%; color: blue">&gt;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">&lt;/</span><span style="line-height: 140%; color: #a31515">assemblyBinding</span><span style="line-height: 140%; color: blue">&gt;</span></p>        <p style="margin: 0px">&#160;</p>     </div>   </li>    <li>Register the extra dll for autoload on startup:      <ol type="a">       <li>either by creating an entry in the registry â€“ look at &lt;objectarx sdk&gt;\docs\arxdoc.chm &gt;&gt; <b>Demand Loading on AutoCAD Startup</b> </li>        <li>or using the <a href="http://through-the-interface.typepad.com/through_the_interface/2011/05/adn-devcast-episode-6-autoloader.html" target="_self">AutoLoader</a> mechanism that is available since AutoCAD 2012. Here you can also set dependency between the dll's to make sure that the extra dll is loaded before the main dll </li>     </ol>   </li>    <li>     <p>Load the extra dll before actually needing it:        <br />Since .NET does delay loading by default, i.e. it only tries to load extra resources when actually needed, you could place the call to the extra dll into a separate function and call LoadFrom before that. .NET will only try to resolve the function of the external dll when it enters that extra function (CallDllFunction in this case)</p>      <div style="font-family: courier new; background: white; color: black; font-size: 8pt">       <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System;</span></p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Runtime; </span></p>        <p style="margin: 0px">&#160;</p>        <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> DllCaller</span></p>        <p style="margin: 0px"><span style="line-height: 140%">{</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Functions</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;CallDllFunctionWithPreload&quot;</span><span style="line-height: 140%">)]</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> CallDllFunctionWithPreload()</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; System.Reflection.</span><span style="line-height: 140%; color: #2b91af">Assembly</span><span style="line-height: 140%">.LoadFrom(</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #a31515">@&quot;C:\Documents and Settings\Administrator\&quot;</span><span style="line-height: 140%"> +</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #a31515">@&quot;My Documents\Visual Studio 2010\Projects\&quot;</span><span style="line-height: 140%"> +</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #a31515">@&quot;TestDllLoad\DllToLoad\bin\Debug\DllToLoad.dll&quot;</span><span style="line-height: 140%">); </span></p>        <p style="margin: 0px">&#160;</p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; CallDllFunction();</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>        <p style="margin: 0px">&#160;</p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; [</span><span style="line-height: 140%; color: #2b91af">CommandMethod</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: #a31515">&quot;CallDllFunction&quot;</span><span style="line-height: 140%">)] </span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> CallDllFunction()</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// If the user calls this command, then it will fail,</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// but if he calls CallDllFunctionWithPreload command</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// then this will succeed</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; DllToLoad.</span><span style="line-height: 140%; color: #2b91af">Functions</span><span style="line-height: 140%">.MyShowMessage(); </span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>        <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>        <p style="margin: 0px"><span style="line-height: 140%">}</span></p>        <p style="margin: 0px">&#160;</p>     </div>   </li>    <li>     <p>Handle AppDomain.AssemblyResolve event and load the assembly there</p>   </li>    <li>     <p>Place the extra dll in a subfolder of the AutoCAD install folder and modify &lt;probing privatepath=&quot;&quot;&gt; accordingly in acad.exe.config</p>   </li>    <li>     <p>Place the dll's of your addin into the AutoCAD install folder. This is the official suggestion, by the way, but it may not always be viable</p>   </li> </ol>
