---
layout: "post"
title: "Getting visual style properties used by the viewport"
date: "2012-05-28 04:12:50"
author: "Adam Nagy"
categories:
  - "Adam Nagy"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/getting-visual-style-properties-used-by-the-viewport.html "
typepad_basename: "getting-visual-style-properties-used-by-the-viewport"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>I have a custom entity which implements subViewportDraw() and depending on the visual style, e.g. if it's using materials, my entity would draw itself different. How could I get the visual style properties inside subViewportDraw()?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>Using AcGiViewportDraw::viewportObjectId() you can get to the viewport/viewport record where your entity is drawing itself. And from there you can find out the visual style being used. Once you got the visual style you can reach all the properties you are interested in.</p>  <p>In the following sample my entity (AEN1MyEntity) is derived from AcDbEntity and in its subViewportDraw() it simply draws a text with some information about the visual style being used.</p>  <p>Note that kDrawableRegenDraw is returned in subSetAttributes(), so that our subViewportDraw() is called whenever there is some change in the viewport, inc. Visual Style change. Without this, if you changed between 3D visual styles, then subViewportDraw() would not be called and so the cached version of your entity would be used.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> AEN1MyEntity::subViewportDraw (AcGiViewportDraw *mode) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcString text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;default&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">switch</span><span style="line-height: 140%"> (mode-&gt;regenType())</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> eAcGiRegenTypeInvalid:</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;eAcGiRegenTypeInvalid&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> kAcGiForExplode: </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;kAcGiForExplode&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> kAcGiHideOrShadeCommand: </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;kAcGiHideOrShadeCommand&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> kAcGiRenderCommand: </span><span style="line-height: 140%; color: green">/* = kAcGiShadedDisplay */</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;kAcGiRenderCommand&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> kAcGiSaveWorldDrawForProxy: </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;kAcGiSaveWorldDrawForProxy&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">case</span><span style="line-height: 140%"> kAcGiStandardDisplay: </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text = _T(</span><span style="line-height: 140%; color: #a31515">&quot;kAcGiStandardDisplay&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">break</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcDbObjectId idVp = mode-&gt;viewportObjectId();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// If it's null then it must be a 2d view</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (idVp.isNull())</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text.append(_T(</span><span style="line-height: 140%; color: #a31515">&quot;, 2D&quot;</span><span style="line-height: 140%">)); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text.append(_T(</span><span style="line-height: 140%; color: #a31515">&quot;, &quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcDbObjectPointer ptrObj(idVp, AcDb::kForRead);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcDbObjectId id;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (ptrObj-&gt;isA() == AcDbViewport::desc())</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; AcDbViewport* pVp = AcDbViewport::cast(ptrObj);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; id = pVp-&gt;visualStyle(); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (ptrObj-&gt;isA() == AcDbViewportTableRecord::desc())</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; AcDbViewportTableRecord* pVp = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; AcDbViewportTableRecord::cast(ptrObj);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; id = pVp-&gt;visualStyle(); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcDbObjectPointer ptrVS(id, AcDb::kForRead);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; text.append(ptrVS-&gt;description());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcGeVector3d vecUp;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; mode-&gt;viewport().getCameraUpVector(vecUp);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcGeVector3d vecFlow = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vecUp.crossProduct(mode-&gt;viewport().viewDir());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcGiTextStyle style;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; Acad::ErrorStatus err = fromAcDbTextStyle(style, _T(</span><span style="line-height: 140%; color: #a31515">&quot;STANDARD&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; Adesk::Boolean ret = mode-&gt;geometry().text(AcGePoint3d(0, 0, 0), </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; mode-&gt;viewport().viewDir(), vecFlow, text, -1, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Adesk::kTrue, style);&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">Adesk::UInt32 AEN1MyEntity::subSetAttributes (</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcGiDrawableTraits *traits) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; assertReadEnabled () ;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// kDrawableViewIndependentViewportDraw - get the </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// correct mode-&gt;regenType()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// kDrawableRegenDraw - call our viewport in case of any change </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// - even if a property of the current visual style changed</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> (AcDbEntity::subSetAttributes (traits) | </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; kDrawableViewIndependentViewportDraw | kDrawableRegenDraw);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px"></p> </div>
