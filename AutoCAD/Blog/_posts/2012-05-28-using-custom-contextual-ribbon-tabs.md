---
layout: "post"
title: "Using custom contextual ribbon tabs"
date: "2012-05-28 03:10:59"
author: "Adam Nagy"
categories:
  - ".NET"
  - "Adam Nagy"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/using-custom-contextual-ribbon-tabs.html "
typepad_basename: "using-custom-contextual-ribbon-tabs"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>In AutoCAD when you start editing an MTEXT, then a <b>Text Editor</b> contextual tab appears in the Ribbon. How could I do something similar myself? E.g. when the user selects my custom entity then my own contextual tab would appear.</p>  <p><strong>Solution</strong></p>  <p>If you already have a contextual tab and you want to hook it up, so that it is shown under certain conditions then this is what you have to do.</p>  <p>1) You have to create a contextual selection rule xaml file.    <br />You need to name it in a way that it ends with <b>ContextualTabSelectorRules.xaml</b> and starts with something that makes it unique. The best thing is to use your Registered Developer Symbol for that purpose     <br />[RDS - Registered Developer Symbol: visit <a href="http://www.autodesk.com/developer">http://www.autodesk.com/developer</a> and select <b>Symbol Registration</b>]     <br />So mine would be <b>AEN1ContextualTabSelectorRules.xaml</b></p>  <p>You can have a look at the <b>[AutoCAD install folder]\AcContextualTabSelectorRules.xaml</b> file for ideas on what our xaml needs to contain.</p>  <p>On Vista and Windows 7 be careful if you copy and edit the <b>AcContextualTabSelectorRules.xaml</b> file. In that case take care about disabling the UAC when editing the copied file: with UAC enabled the copy operation works (requests administrator rights) but the editing writes transparently into the VirtualStore (because of limited rights), i.e. the original file is still just the copy and the subsequent changes are in a different place and only visible to the editor.</p>  <p>2) In the rule you create you can either use already available functions like <b>Selection.ContainsOnly(&quot;Arc&quot;)</b> or create your own assembly with some utility functions and use them from the selector rules file. That's what we'll do in this sample.     <br />As you can see we will create an assembly called <b>Aen1Helper</b> with a <b>Functions</b> class that has a static function called <b>ShowMyTab</b> and then we can use it in the <b>Aen1ContextualTabSelectorRules.xaml</b> file the following way:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">&lt;?xml version=</span><span style="line-height: 140%; color: #a31515">&quot;1.0&quot;</span><span style="line-height: 140%"> encoding=</span><span style="line-height: 140%; color: #a31515">&quot;utf-8&quot;</span><span style="line-height: 140%">?&gt;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&lt;TabSelectorRules&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; xmlns=</span><span style="line-height: 140%; color: #a31515">&quot;clr-namespace:Autodesk.AutoCAD.Ribbon;assembly=AcWindows&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Ordering=</span><span style="line-height: 140%; color: #a31515">&quot;0&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &lt;TabSelectorRules.References&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;AssemblyReference Namespace=</span><span style="line-height: 140%; color: #a31515">&quot;Aen1Helper&quot;</span><span style="line-height: 140%"> Assembly=</span><span style="line-height: 140%; color: #a31515">&quot;Aen1Helper&quot;</span><span style="line-height: 140%">/&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &lt;/TabSelectorRules.References&gt;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &lt;Rule Uid=</span><span style="line-height: 140%; color: #a31515">&quot;Aen1SelctionRule&quot;</span><span style="line-height: 140%"> DisplayName=</span><span style="line-height: 140%; color: #a31515">&quot;Aen1 Selecion Rule&quot;</span><span style="line-height: 140%"> </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Theme=</span><span style="line-height: 140%; color: #a31515">&quot;Green&quot;</span><span style="line-height: 140%"> Trigger=</span><span style="line-height: 140%; color: #a31515">&quot;Selection&quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;![CDATA[</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Aen1Helper.Functions.ShowMyTab(Selection)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; ]]&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &lt;/Rule&gt;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&lt;/TabSelectorRules&gt;</span></p> </div>  <p>3) Then create a simple <b>Class Library</b> in Visual Studio which references <b>acmgd.dll</b>, <b>acdbmgd.dll</b> and <b>WindowsBase</b> assemblies [make sure that <b>Copy Local</b> is set to false for all of them]. You could implement any logic for controlling the appearance of your tab, but we'll do something simple. Our rule will be based on the type of entity being selected and the name of the current document.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> System;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.Windows.Data;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.DatabaseServices;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">using</span><span style="line-height: 140%"> Autodesk.AutoCAD.ApplicationServices;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">namespace</span><span style="line-height: 140%"> Aen1Helper</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">class</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Functions</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> ShowMyTab(</span><span style="line-height: 140%; color: blue">object</span><span style="line-height: 140%"> selObj)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #2b91af">Selection</span><span style="line-height: 140%"> sel = (</span><span style="line-height: 140%; color: #2b91af">Selection</span><span style="line-height: 140%">)selObj;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (sel.Count &lt; 1 || !sel.ContainsOnly(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">string</span><span style="line-height: 140%">[] {</span><span style="line-height: 140%; color: #a31515">&quot;Line&quot;</span><span style="line-height: 140%">}))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (</span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument.</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Name.EndsWith(</span><span style="line-height: 140%; color: #a31515">&quot;Drawing1.dwg&quot;</span><span style="line-height: 140%">))</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p>4) Once both <b>AEN1ContextualTabSelectorRules.xaml</b> and <b>Aen1Helper.dll</b> have been placed in the AutoCAD install folder you can start AutoCAD and go into the CUI dialog to associate your rule with your contextual tab. Mine is called <b>Aen1Tab</b>.    <br />Just drag <b>Ribbon &gt; Tabs &gt; Aen1Tab</b> onto <b>Ribbon &gt; Contextual Tab States &gt; Aen1 Selection Rule</b> and click <b>OK     <br /></b>Now when you select a line in a document whose name ends with <b>Drawing1.dwg</b> then <b>Aen1 Tab</b> will appear</p>


<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0168ebdeaa0b970c-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b0168ebdeaa0b970c image-full" alt="Contextualtab" title="Contextualtab" src="/assets/image_942842.jpg" border="0" /></a><br />
