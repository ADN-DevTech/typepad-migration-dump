---
layout: "post"
title: "How to pass COM optional parameter in C#"
date: "2012-05-28 07:21:30"
author: "Philippe Leefsma"
categories:
  - ".NET"
  - "AutoCAD"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/how-to-pass-com-optional-parameter-in-c.html "
typepad_basename: "how-to-pass-com-optional-parameter-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>Here is a problem you may encounter when invoking the AutoCAD ActiveX API from C#:</p>  <p><em>I'm trying to use AcadSelectionSet.SelectOnScreen in C# with similar approaches I've been using in VB. But I can't omit the optional parameters in C# which I can in VB.      <br />I tried to create some empty arrays and pass them to SelectOnScreen but I get invalid argument errors.       <br />Could you offer a solution?</em></p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p><em>Note: this workaround only applies to .Net 3.5 and prior versions of the framework, as C# 4.0 provides missing parameters functionality.</em>&#160;</p>  <p>In VB, you can ignore the optional parameters when you call AcadSelectionSet.SelectOnScreen but you can't do that in C#. This is because C# doesn't support optional parameters. Also, if you really want to pass NULL values as an indication that you don't want any values in the object array (no variant in C#), you can't create arrays with values, the zeros will be trades as values in the DXF code not 'nothing'. That's where the problem is.</p>  <p>Fortunately, there is a solution in .NET which is using object reflection to specific a missing value that is NULL.    <br />&#160;&#160; object o = System.Reflection.Missing.Value;</p>  <p>This will be the equivalent of NULL values passed into VB functions call. The following code snippet demonstrates how it works.</p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><font face="Consolas"><font style="font-size: 9.5pt" color="#008000">//</font></font></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><font face="Consolas"><font style="font-size: 9.5pt" color="#008000">// error checking code omitted for code brevity</font></font></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><font face="Consolas"><font style="font-size: 9.5pt" color="#008000">//</font></font></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff"><font style="font-size: 9.5pt">private</font></font></span><span style="font-family: "><font style="font-size: 9.5pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> TestMissing(</font><span style="color: "><font color="#2b91af">AcadApplication</font></span><font color="#000000"> oAcad)</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">{</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 9.5pt"><span style="color: "><font color="#2b91af">AcadDocument</font></span><font color="#000000"> oDoc = oAcad.ActiveDocument;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 9.5pt"><span style="color: "><font color="#2b91af">AcadSelectionSet</font></span><font color="#000000"> ss = oDoc.SelectionSets.Add(</font><span style="color: "><font color="#a31515">&quot;ss01&quot;</font></span><font color="#000000">);</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 9.5pt"><span style="color: "><font color="#0000ff">object</font></span><font color="#000000"> oMissing01 = System.Reflection.</font><span style="color: "><font color="#2b91af">Missing</font></span><font color="#000000">.Value;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 9.5pt"><span style="color: "><font color="#0000ff">object</font></span><font color="#000000"> oMissing02 = System.Reflection.</font><span style="color: "><font color="#2b91af">Missing</font></span><font color="#000000">.Value;</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></span><font style="font-size: 9.5pt">ss.SelectOnScreen(oMissing01, oMissing02);</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></span><font style="font-size: 9.5pt">System.Windows.Forms.</font></font><font style="font-size: 9.5pt"><span style="color: "><font color="#2b91af">MessageBox</font></span><font color="#000000">.Show(</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 9.5pt"><span style="color: "><font color="#a31515">&quot;Number of objects in the selection: &quot;</font></span><font color="#000000"> + ss.Count + </font><span style="color: "><font color="#a31515">&quot;.&quot;</font></span><font color="#000000">);</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></span><font style="font-size: 9.5pt">ss.Delete();</font></font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: "><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">}</font></font></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt" class="MsoNormal"><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>
