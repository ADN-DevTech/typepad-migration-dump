---
layout: "post"
title: "Copying (DeepCloning) from one Drawing to another using .NET"
date: "2012-09-14 11:12:31"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/09/copying-deepcloning-from-one-drawing-to-another-using-net.html "
typepad_basename: "copying-deepcloning-from-one-drawing-to-another-using-net"
typepad_status: "Publish"
---

<div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font color="#000000">by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html"><font color="#0066cc">Fenton Webb</font></a></font></p>    <p style="margin: 0px"><font color="#000000"></font></p>    <p style="margin: 0px"><font color="#000000">Hereâ€™s how to copy entities from the Model Space of a DWG file hosted inside of AutoCAD to an external DWG file. </font></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">// copy Model Space to external DWG </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">// by Fenton Webb, DevTech 14/9/2012</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;CopySpaceToExtDWG&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">CopySpaceToExtDWG</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the working database (in AutoCAD)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">sourceDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Database</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">try</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// create a new destination database</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">destDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">&#160;&#160; // get the model space object ids for both dbs</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">&#160;&#160; ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">sourceMsId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sourceDb</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">&#160;&#160; ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">destDbMsId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">destDb</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">&#160;&#160; // now create an array of object ids to hold the source objects to copy</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">&#160;&#160; ObjectIdCollection</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">sourceIds</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">ObjectIdCollection</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">&#160;&#160; // open the sourceDb ModelSpace (current autocad dwg)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">&#160;&#160; using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ms</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">sourceMsId</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160; as</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000">&#160;&#160;&#160; // loop all the entities and record their ids</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">&#160;&#160;&#160; foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ms</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160;&#160; sourceIds</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Add</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// next prepare to deepclone the recorded ids to the destdb</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">IdMapping</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">mapping</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">IdMapping</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now clone the objects into the destdb</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sourceDb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WblockCloneObjects</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sourceIds</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">destDbMsId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">mapping</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">DuplicateRecordCloning</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Replace</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">destDb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">SaveAs</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;c:\\temp\\dwgs\\CopyTest.dwg&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">DwgVersion</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Current</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">System</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">Exception</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">eXP</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">System</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Windows</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Forms</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">MessageBox</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Show</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">eXP</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">());</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"></p> </div>
