---
layout: "post"
title: "Create Paper Space Viewports"
date: "2012-08-28 13:19:57"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/create-paper-space-viewports.html "
typepad_basename: "create-paper-space-viewports"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>To create a new viewport in paper space, like MVIEW command, perform the following steps:</p>  <p>1. Create a new object of type AcDbViewport.   <br />2. Set the view coordinates (with setWidth(), setHeight() and setCenterPoint()).    <br />3. Append the new viewport to the paper space.    <br />4. Get the view the user specified (AcDbViewTableRecord).    <br />5. Set this view on the new viewport with acdbSetCurrentView().    <br />6. Activate the viewport with AcDbViewport::setOn().</p>  <p>NOTE: The AcDbViewport::setOn() function only works if your command has been registered without the ACRX_CMD_TRANSPARENT flag. If this flag is set,   <br />AcDbViewport::setOn() returns with eCommandWasInProgress and you cannot activate the viewport until you set tilemode to 1 and back to 0.</p>  <p>The following code demonstrates how to do this:</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Only works in paperspace</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbObjectId mCurViewportId = acedGetCurViewportObjectId();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (mCurViewportId == AcDbObjectId::kNull)</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCommand only works in paperspace.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbViewport *pCurViewport;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != acdbOpenObject(pCurViewport,mCurViewportId,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; AcDb::kForRead))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot get active viewport.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (pCurViewport-&gt;number() != 1)</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCommand only works in paperspace.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pCurViewport-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pCurViewport-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Ask for the position</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">ads_point pt1,pt2;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (RTNORM != acedGetPoint(NULL,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; _T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nSelect first corner: &quot;</font></span><font color="#000000">), pt1))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (RTNORM != acedGetCorner(pt1,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; _T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nSelect second corner: &quot;</font></span><font color="#000000">), pt2))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Ask for the view to use</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">ACHAR mViewName[133];</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (RTNORM != acedGetString(0,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; _T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nEnter name of view to use: &quot;</font></span><font color="#000000">), mViewName))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000"></font></font></span></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Create new viewport</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">AcDbViewport *pViewport = </font></font><font style="font-size: 8pt"><span><font color="#0000ff">new</font></span><font color="#000000"> AcDbViewport;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewport-&gt;setWidth(fabs(pt2[X] - pt1[X]));</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewport-&gt;setHeight(fabs(pt2[Y] - pt1[Y]));</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewport-&gt;setCenterPoint(AcGePoint3d(</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pt1[X] + (pt2[X] - pt1[X]) / 2,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pt1[Y] + (pt2[Y] - pt1[Y]) / 2,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pt1[Z]));</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Append new viewport to paper space</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbBlockTable *pTable;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbBlockTableRecord *pPsBTR;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != acdbHostApplicationServices()-&gt;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; workingDatabase()-&gt;getBlockTable(pTable, AcDb::kForRead))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot get block table.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">delete</font></span><font color="#000000"> pViewport;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != pTable-&gt;getAt(ACDB_PAPER_SPACE, pPsBTR,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; AcDb::kForWrite))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot access paper space.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pTable-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">delete</font></span><font color="#000000"> pViewport;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pTable-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbObjectId mViewPortId;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != pPsBTR-&gt;appendAcDbEntity(mViewPortId, pViewport))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot append viewport to paper space.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pPsBTR-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">delete</font></span><font color="#000000"> pViewport;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pPsBTR-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewport-&gt;setOn();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Set the view</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbViewTable *pViewTable;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">AcDbViewTableRecord *pViewTR;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != acdbHostApplicationServices()-&gt;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; workingDatabase()-&gt;getViewTable(pViewTable, AcDb::kForRead))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot get view table.&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pViewport-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (Acad::eOk != pViewTable-&gt;getAt(mViewName,</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pViewTR, AcDb::kForRead))</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nCannot access view '%s'.&quot;</font></span><font color="#000000">), mViewName);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pViewport-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; pViewTable-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewTable-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt" color="#000000"> (acedSetCurrentView(pViewTR, pViewport)!=Acad::eOk)</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; acutPrintf(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nFailed to set view&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Close the objects</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewTR-&gt;close();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">pViewport-&gt;close();</font></font></p> </div>
