---
layout: "post"
title: "Creating new Layout based on another Layout using ObjectARX"
date: "2013-01-30 15:17:05"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/creating-new-layout-based-on-another-layout-using-objectarx.html "
typepad_basename: "creating-new-layout-based-on-another-layout-using-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>In AutoCAD, I need to create a layout with all plot settings based on a   <br />pre-existing layout in the drawing. Also, how would one create a copy of a    <br />layout in its entirety?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>Applying the plot settings of a layout is accomplished by first creating a new   <br />layout. Then, the method AcDbPlotSettings::copyFrom() is called through the new    <br />layout object (see createLyt() below). CloneLayout() is used to copy a layout's    <br />properties and entities (see createClone() below). Both clone and create layout    <br />functions take care of appending the new layout to the ACAD_LAYOUT dictionary    <br />and establishing the layout's connections to its paperspace block table record. </p>  <p>It is not advisable to change the name of the layout's associated BTR (block   <br />table record). The name is automatically assigned to be &quot;*PAPERSPACE&quot;    <br />concatenated with the number N-1, where N is the number of layouts already    <br />available. When you activate a certain layout, a swap of BTR names takes place    <br />- the BTR associated with the layout assumes the name &quot;*PAPERSPACE&quot; and the BTR of the formerly active layout assumes the name of the newly active BTR. Should    <br />you alter the name of the layout's BTR, AutoCAD will crash soon after you    <br />attempt to activate the layout's tab. </p>  <p>If it is simply the plot settings you wish to transplant to a new layout…   <br />    <br /><font size="1" face="Consolas">void createLyt()     <br />{      <br />&#160;&#160;&#160; Acad::ErrorStatus es;&#160;&#160;&#160; <br />&#160; AcDbObjectId LObjId, BTRId;&#160;&#160;&#160; <br />&#160; AcDbDatabase *curDocDB =acdbHostApplicationServices()-&gt;workingDatabase();&#160;&#160;&#160; <br />&#160; AcApLayoutManager *layoutMngr =      <br />(AcApLayoutManager*)(acdbHostApplicationServices()-&gt;layoutManager());&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; curDocDB-&gt;setTilemode(Adesk::kFalse);&#160;&#160;&#160; <br />&#160; const ACHAR *actLayoutName = layoutMngr-&gt;findActiveTab();&#160;&#160;&#160; <br />&#160; AcDbLayout* pSrc = layoutMngr-&gt;findLayoutNamed(actLayoutName, TRUE);&#160;&#160;&#160; <br />&#160; if (pSrc == NULL)&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; return;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; //pSrc must be demoted to kForRead&#160;&#160;&#160;&#160; <br />&#160; pSrc-&gt;downgradeOpen();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; //create new layout with next available name&#160;&#160;&#160; <br />&#160; ACHAR *newLName = layoutMngr-&gt;getNextNewLayoutName();&#160;&#160; <br />&#160; if (Acad::eOk != layoutMngr-&gt;createLayout(newLName, LObjId, BTRId))       <br />&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160; acutDelString(newLName);&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; return;       <br />&#160; //failure&#160;&#160;&#160; <br />&#160; }&#160;&#160;&#160; <br />&#160; AcDbLayout* pTarget = layoutMngr-&gt;findLayoutNamed(newLName, TRUE);&#160;&#160;&#160; <br />&#160; acutDelString(newLName);&#160;&#160;&#160; <br />&#160; if (pTarget != NULL)       <br />&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; es = pTarget-&gt;copyFrom(pSrc);&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; pSrc-&gt;close();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; if (es != Acad::eOk)       <br />&#160;&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; //unsuccessful property copy - erase new layout&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; pTarget-&gt;erase();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; pTarget-&gt;close();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; } </font></p>  <p><font size="1" face="Consolas">&#160;&#160; else      <br />&#160;&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; pTarget-&gt;close();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; layoutMngr-&gt;updateLayoutTabs();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; }&#160;&#160;&#160; <br />&#160; }      <br />}</font>    <br /></p>  <p>To clone a complete layout with properties and entities…</p>  <p><font size="1" face="Consolas">void createClone()     <br />{&#160; <br />&#160; Acad::ErrorStatus es;&#160;&#160;&#160; <br />&#160; AcDbDatabase *curDocDB =acdbHostApplicationServices()-&gt;workingDatabase();&#160;&#160;&#160; <br />&#160; AcApLayoutManager *layoutMngr =      <br />(AcApLayoutManager*)(acdbHostApplicationServices()-&gt;layoutManager());&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; curDocDB-&gt;setTilemode(Adesk::kFalse);&#160;&#160;&#160; <br />&#160; const ACHAR *actLayoutName = layoutMngr-&gt;findActiveTab();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160; //no layout objects may be open kForWrite during getNextNewLayoutName()&#160;&#160;&#160; <br />&#160; ACHAR *cloneName = layoutMngr-&gt;getNextNewLayoutName();&#160;&#160;&#160; <br />&#160; AcDbLayout *pSrc = layoutMngr-&gt;findLayoutNamed(actLayoutName, TRUE);&#160;&#160;&#160; <br />&#160; if (pSrc == NULL)       <br />&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; acutDelString(cloneName);&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; return;&#160;&#160;&#160; <br />&#160; }&#160;&#160;&#160; <br />&#160; es = layoutMngr-&gt;cloneLayout(pSrc, cloneName);&#160;&#160;&#160; <br />&#160; acutDelString(cloneName);&#160;&#160;&#160; <br />&#160; pSrc-&gt;close();&#160;&#160;&#160; <br />&#160; if (es == Acad::eOk)&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160; layoutMngr-&gt;updateLayoutTabs();      <br />}</font></p>
