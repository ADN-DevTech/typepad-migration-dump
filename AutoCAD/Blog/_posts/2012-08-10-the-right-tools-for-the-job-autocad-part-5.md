---
layout: "post"
title: "The Right Tools for the Job &ndash; AutoCAD Part 5"
date: "2012-08-10 17:39:42"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/the-right-tools-for-the-job-autocad-part-5.html "
typepad_basename: "the-right-tools-for-the-job-autocad-part-5"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Leading on from <a href="http://adndevblog.typepad.com/autocad/2012/07/the-right-tools-for-the-job-autocad-part-4.html">Part 4</a>, and staying with ‘Performance’ I wanted to take a look at some .NET code and show you how to access the DWG database in the fastest way.</p>  <p>Over the years, I’m sure some of you have noticed how I like to write my DWG Database .NET in a very similar way to any code I write in ObjectARX, I try to only use Open/Close() unless I absolutely need to use Transactions.</p>  <p>The reason for this comes from my own personal experience and preferences:</p>  <ol>   <li>Open/Close is faster than Transaction/StartTransaction</li>    <li>Open/Close can be more easily used in Event/Reactor callbacks, Transaction/StartTransaction can, but you need to really think about what you are doing</li>    <li>Open/Close is neater to write, in my opinion</li> </ol>  <p>That said, other members in my team, including the original author of our AutoCAD .NET API, prefer to use the Transaction model because it’s more Object Oriented. </p>  <p>Here’s some code which shows the differences between using Transaction/StartTransaction and Open/Close… </p>  <p>First the Transaction version, which I personally don’t normally like writing… <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="/assets/image_770960.jpg" /></p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">StartTransaction</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">TransactionManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">TransactionManager</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Transaction</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">trx</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StartTransaction</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// do something</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Commit</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p>Now my preferred way, Open/Close – see how much nicer it is? <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="/assets/image_770960.jpg" /></p> </div>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">OpenClose</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// do something</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>  <p>Now I have shown the differences between the two styles, I should explain that there is actually two more additional styles of coding DWG database handling inside of AutoCAD.NET; that is Transaction.StartOpenCloseTransaction() and ObjectId.GetObject(). </p>  <p>The Transaction.StartOpenCloseTransaction() style is exactly the same as the normal Transaction.StartTransaction(), except that it wraps the Open/Close mechanism in a Transaction object. When I show the performance differences further down, you will understand the reasons to use it, but in the meantime, here’s a quick look at the code – the only difference between the ‘StartTransaction’ function above and this one is the call to StartOpenCloseTransaction() instead of StartTransaction()…</p>  <p style="margin: 0px">   <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;StartOpenCloseTransaction&quot;</font></span><font color="#000000">)]</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">StartOpenCloseTransaction</font></span><font color="#000000">()</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">TransactionManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">TransactionManager</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><strong><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Transaction</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">trx</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StartOpenCloseTransaction</font></span><font color="#000000">())</font></strong></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// do something</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Commit</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></p>   </div> </p>  <p>The ObjectId.GetObject() style utilizes the normal Transaction object mechanism, but this way gives you a slightly difference access point. </p>  <p>Why would you use ObjectId.GetObject() instead of Transaction.GetObject() I hear some of you ask – basically, the ObjectId.GetObject() obtains the top most transaction in the transaction stack, so it can save time when coding (no need to pass the transaction around) – that said it can cost a few extra CPU cycles to use which you can see affecting the results below.</p>  <p>I have to confess that the sample code above was obtained from an original version that “Jeff H” of TheSwamp.org created as part of his own performance testing that he posted. I really liked what he did (and others that read the same post can relate to it also) so I thought I’d use it here for my own benchmarking – Thanks Jeff H!</p>  <p>His original code had some little bugs in it which he actually pointed out himself; his code opened some objects for read and then those same objects, in different test functions, for write which probably made each test function slightly unfair to the other. I corrected those issues, and removed the extra “false, false” parameters from the Open() and GetObject() see the bottom for the code… </p>  <blockquote>   <p>I recommend that you only ever open for write when you absolutely need too, otherwise you may be costing yourself valuable CPU cycles.</p> </blockquote>  <p>Now here are the test results – AutoCAD 2013, 55,000 entities in Model Space, each command run 5 times to average out any of my computer’s normal running tasks interference…</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016769322952970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_602274.jpg" width="497" height="296" /></a></p>  <p><span style="color: "><font color="#2b91af"><font style="font-size: 8pt"><font color="#232323" size="2" face="Arial">So it seems that StartOpenCloseTransaction(), in this test, even beats Open/Close on performance. It also seems that both of the normal ‘Transaction’ models StartTransaction() and ObjectID.GetObject() are significantly slower, but not much real difference between the two (0.3 of a second).</font></font></font></span></p>  <p>About The Transaction object in AutoCAD... The Transaction model (StartTransaction()) was invented way back when for a specific reason - transacting multiple writes on the same objects(s) and allowing layered rollbacks of these multi-write transactions. </p>  <blockquote>   <p>Here’s what I recommend<span style="color: ">: If you guys are using StartTransaction(), and you don’t need the multiple write feature I just mentioned in the above paragraph, simply change your StartTransaction() to StartOpenCloseTransaction()…</span></p> </blockquote>  <p>Here are the actual results from the Command line.</p>  <p><strong>“StartTransaction”</strong></p>  <p>Command: STARTTRANSACTION   <br />StartTransaction    <br />1286338    <br />Command:    <br />STARTTRANSACTION    <br />StartTransaction    <br />1301005    <br />Command:    <br />STARTTRANSACTION    <br />StartTransaction    <br />1206838    <br />Command:    <br />STARTTRANSACTION    <br />StartTransaction    <br />1243078    <br />Command:    <br />STARTTRANSACTION    <br />StartTransaction    <br />1231894</p>  <p><strong>“OpenCloseTransaction”</strong></p>  <p>Command: OPENCLOSETRANSACTION   <br />OpenCloseTransaction    <br />511723    <br />Command:    <br />OPENCLOSETRANSACTION    <br />OpenCloseTransaction    <br />494753    <br />Command:    <br />OPENCLOSETRANSACTION    <br />OpenCloseTransaction    <br />495462    <br />Command:    <br />OPENCLOSETRANSACTION    <br />OpenCloseTransaction    <br />509738    <br />Command:    <br />OPENCLOSETRANSACTION    <br />OpenCloseTransaction    <br />491686</p>  <p><strong>“OpenClose”</strong></p>  <p>Command: OPENCLOSE   <br />OpenClose    <br />568263    <br />Command:    <br />OPENCLOSE    <br />OpenClose    <br />558977    <br />Command:    <br />OPENCLOSE    <br />OpenClose    <br />562863    <br />Command:    <br />OPENCLOSE    <br />OpenClose    <br />570294    <br />Command:    <br />OPENCLOSE    <br />OpenClose    <br />549607    <br /></p>  <p><strong>“IDGetObject”</strong></p>  <p>Command: IDGETOBJECT   <br />IdGetObject    <br />1606375    <br />Command:    <br />IDGETOBJECT    <br />IdGetObject    <br />1562226    <br />Command:    <br />IDGETOBJECT    <br />IdGetObject    <br />1571498    <br />Command:    <br />IDGETOBJECT    <br />IdGetObject    <br />1562189    <br />Command:    <br />IDGETOBJECT    <br />IdGetObject    <br />1527295</p>  <div style="font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#2b91af"><font style="font-size: 8pt"><font color="#232323" size="2" face="Arial">Here’s the code I used, I hope I didn’t introduce any bugs of my own – my eyes started to glaze over!! Thanks one more time Jeff H! <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="/assets/image_770960.jpg" /></font>            <br /></font></font></span></font></div>  <p style="margin: 0px; font-family: ; background: white"><font color="#2b91af" face="Consolas"><span style="color: "></span></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#2b91af"><font style="font-size: 8pt">Random</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">ran</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Random</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#2b91af"><font style="font-size: 8pt">Stopwatch</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">sw</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Stopwatch</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// code taken from original version written by &quot;Jeff H&quot;</font></font></span></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;StartTransaction&quot;</font></span><font color="#000000">)]</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">StartTransaction</font></span><font color="#000000">()</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ran</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Next</font></span><font color="#000000">(1, 256);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Autodesk</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">AutoCAD</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DatabaseServices</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">TransactionManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">TransactionManager</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Reset</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Start</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Transaction</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">trx</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StartTransaction</font></span><font color="#000000">())</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ent</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ColorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Commit</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Stop</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nStartTransaction\n&quot;</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ElapsedTicks</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">());</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;OpenClosetransaction&quot;</font></span><font color="#000000">)]</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">OpenClosetransaction</font></span><font color="#000000">()</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ran</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Next</font></span><font color="#000000">(1, 256);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Autodesk</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">AutoCAD</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DatabaseServices</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">TransactionManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">TransactionManager</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Reset</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Start</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Transaction</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">trx</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StartOpenCloseTransaction</font></span><font color="#000000">())</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ent</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ColorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Commit</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Stop</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nOpenCloseTransaction\n&quot;</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ElapsedTicks</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">());</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;OpenClose&quot;</font></span><font color="#000000">)]</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">OpenClose</font></span><font color="#000000">()</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ran</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Next</font></span><font color="#000000">(1, 256);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Reset</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Start</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ent</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ColorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ent</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Close</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">btr</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Close</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Stop</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nOpenClose\n&quot;</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ElapsedTicks</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">());</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;IdGetObject&quot;</font></span><font color="#000000">)]</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">IdGetObject</font></span><font color="#000000">()</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ran</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Next</font></span><font color="#000000">(1, 256);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">msId</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">SymbolUtilityServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetBlockModelSpaceId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">db</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Autodesk</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">AutoCAD</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DatabaseServices</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">TransactionManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">TransactionManager</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Reset</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Start</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Transaction</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">trx</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">tm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StartTransaction</font></span><font color="#000000">())</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">msId</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForRead</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">btr</font></span><font color="#000000">)</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ent</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">Entity</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetObject</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ent</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ColorIndex</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">colorIndex</font></span><font color="#000000">;</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">trx</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Commit</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Stop</font></span><font color="#000000">();</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nIdGetObject\n&quot;</font></span><font color="#000000">);</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">sw</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ElapsedTicks</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">());</font></font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>  <p style="margin: 0px; font-family: ; background: white"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>   <!--EndFragment-->
