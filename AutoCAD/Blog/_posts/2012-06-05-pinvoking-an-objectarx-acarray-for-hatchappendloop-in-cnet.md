---
layout: "post"
title: "PInvoking an ObjectARX AcArray for Hatch.AppendLoop in C#.NET"
date: "2012-06-05 15:00:52"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/pinvoking-an-objectarx-acarray-for-hatchappendloop-in-cnet.html "
typepad_basename: "pinvoking-an-objectarx-acarray-for-hatchappendloop-in-cnet"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>
<p>it’s funny how some things turn out <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="/assets/image_108666.jpg" style="border-style: none;" /> Just recently, I had a developer telling me about some Mixed Mode DLL issues he was having; he needed his Mixed Mode DLL to run a specific version of the .NET framework. Apparently, that was because without that specific version of the runtime, other parts of his program simply wouldn’t work.</p>
<p>I like to steer away from Mixed Mode DLLs because they are a real pain moving forward, so my immediate question was, “Why do you need a Mixed Mode DLL anyway?”…</p>
<p>After a long chat, it turns out that the only real reason he needed it was to be able to call a specific version of the ObjectARX AcDbHatch::appendLoop() function, which is not exposed in .NET for some reason – here’s the function definition in ObjectARX…</p>
<div style="background: white;">
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #010001;"><span>Acad</span></span></span><span><span style="color: #000000;">::</span><span><span style="color: #010001;">ErrorStatus</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop</span></span><span style="color: #000000;">( </span><span><span style="color: #010001;">Adesk</span></span><span style="color: #000000;">::</span><span><span style="color: #010001;">Int32</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">const</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">AcGePoint2dArray</span></span><span style="color: #000000;">&amp; </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">const</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">AcGeDoubleArray</span></span><span style="color: #000000;">&amp; </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;"> );</span></span></span></p>
<p style="margin: 0px;">&#0160;</p>
<p style="margin: 0px;">The main problem with PInvoking this particular function is that we don’t expose an equivalent AcGeDoubleArray in our .NET API (I suspect that perhaps for this reason, this function was never exposed). Anyway, we (DevTech) declared a while back that this function was not supported to PInvoke, which is why this developer insisted that he needed the Mixed Mode DLL, but of course this stance doesn’t help with this particular Mixed Mode DLL problem so I decided to solve it.</p>
</div>
<p>Everything is PInvoke’able, it just depends on how much work you think it’s worth to put in to achieve it. I figured that the possible workarounds to this problem were to either</p>
<ol>
<li>PInvoke</li>
<li>Work out the Bulge geometry using AcGeCurves and Edge types</li>
</ol>
<p>to me, PInvoke’ing was much less work (and of course much more fun! <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="/assets/image_108666.jpg" style="border-style: none;" />)</p>
<p>So, to PInvoke this particular appendLoop() function would take some careful thought because specifying an array of doubles via .NET and then passing that array to Unmanaged code is laced with danger. The reason is mainly down to the <a href="http://msdn.microsoft.com/en-us/library/ms973837.aspx">.NET GC</a> – anything allocated by the GC could potentially be moved around, and that will simply crash any unmanaged code that uses it. What was needed was to simply pin the GC allocated memory so that the GC knew not to mess with it. Pinning memory in C#.NET is done using the <a href="http://msdn.microsoft.com/en-us/library/f58wzh21.aspx">fixed</a> keyword.</p>
<p>The other thing to consider is the actual class definition, the data members you define .NET side must be the same size and in the same order as the corresponding unmanaged version; for this you can use the StructLayout attribute,</p>
<p>e.g.</p>
<p><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">StructLayout</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">LayoutKind</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Auto</span></span><span style="color: #000000;">)]</span></span></span></p>
<p>So just before you take a look at the code, I wanted to welcome all to memory pointers and addresses in .NET!! All of which requires the <a href="http://msdn.microsoft.com/en-us/library/chfa2zb8(v=vs.71).aspx">unsafe</a> keyword to mark that part of the code as being dangerous to <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms717795(v=vs.85).aspx">buffer overruns</a>, etc, so that the .NET runtime can somehow protect itself from hackers <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="/assets/image_108666.jpg" style="border-style: none;" /></p>
<p><span><span style="font-family: Consolas;"><span style="color: #008000;">// PInvoking appendLoop() using &quot;fixed&quot; memory in an &quot;unsafe&quot; .NET context</span></span></span></p>
<div style="background: white;">
<p style="margin: 0px;"><span><span style="font-family: Consolas;"><span style="color: #008000;">// by Fenton Webb, DevTech, Autodesk, 05/06/2012</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">CommandMethod</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;HatchLoop&quot;</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>static</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">HatchLoop</span></span><span style="color: #000000;">()</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Document</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">doc</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">DocumentManager</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">MdiActiveDocument</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Database</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">db</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">doc</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Database</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Editor</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">doc</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Editor</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">using</span></span><span style="color: #000000;"> (</span><span><span style="color: #2b91af;">Transaction</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">Tx</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">db</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">TransactionManager</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">StartTransaction</span></span><span style="color: #000000;">())</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Hatch</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Hatch</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SetDatabaseDefaults</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Elevation</span></span><span style="color: #000000;"> = 0.0;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Normal</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">Vector3d</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ZAxis</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SetHatchPattern</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">HatchPatternType</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">PreDefined</span></span><span style="color: #000000;">, </span><span><span style="color: #a31515;">&quot;AR-B816&quot;</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Point2dCollection</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2dCollection</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">(0, 0));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">(100, 0));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">(100, 50));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">(0, 50));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">(0, 0));</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">DoubleCollection</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">DoubleCollection</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(0.0);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(0.0);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(0.0);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(0.0);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(0.0);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #0000ff;">unsafe</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// create the AcGePoint2dArray marshaler class</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">AcArray</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">verticesAcArray</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">AcArray</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// grab the double array</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">[] </span><span><span style="color: #010001;">verticesArray</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ToArray</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// get a pointer and pin it so the GC won&#39;t move it</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">fixed</span></span><span style="color: #000000;"> (</span><span><span style="color: #2b91af;">Point2d</span></span><span style="color: #000000;">* </span><span><span style="color: #010001;">verticesPtr</span></span><span style="color: #000000;"> = &amp;</span><span><span style="color: #010001;">verticesArray</span></span><span style="color: #000000;">[0])</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// record the acarray properties</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">verticesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">array</span></span><span style="color: #000000;"> = (</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;">)</span><span><span style="color: #010001;">verticesPtr</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">verticesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">mPhysicalLen</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">verticesArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Length</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">verticesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">mLogicalLen</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">verticesArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Length</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// create the AcGeDoubleArray marshaler class</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">AcArray</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulgesAcArray</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">AcArray</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;">[] </span><span><span style="color: #010001;">bulgesArray</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ToArray</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// get a pointer and pin it so the GC won&#39;t move it</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">fixed</span></span><span style="color: #000000;"> (</span><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;">* </span><span><span style="color: #010001;">bulgesPtr</span></span><span style="color: #000000;"> = &amp;</span><span><span style="color: #010001;">bulgesArray</span></span><span style="color: #000000;">[0])</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span style="color: #008000;">// record the acarray properties</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulgesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">array</span></span><span style="color: #000000;"> = (</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;">)</span><span><span style="color: #010001;">bulgesPtr</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulgesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">mPhysicalLen</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">bulgesArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Length</span></span><span style="color: #000000;">; </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">bulgesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">mLogicalLen</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">bulgesArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Length</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">appendLoop</span></span><span style="color: #000000;">(</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">UnmanagedObject</span></span><span style="color: #000000;">,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">HatchLoopType</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">kDefault</span></span><span style="color: #000000;">,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> <span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">verticesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">array,</span></span></span></span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> <span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulgesAcArray</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">array</span></span></span></span><span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">EvaluateHatch</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">false</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">BlockTableRecord</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">btr</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">Tx</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">GetObject</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">db</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">CurrentSpaceId</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">OpenMode</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ForWrite</span></span><span style="color: #000000;">) </span><span><span style="color: #0000ff;">as</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">BlockTableRecord</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">btr</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AppendEntity</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">Tx</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AddNewlyCreatedDBObject</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">hatch</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">Tx</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Commit</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">}</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>enum</span></span></span><span><span style="color: #000000;"> </span></span><span><span style="color: #2b91af;">HatchLoopType</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kDefault</span></span><span style="color: #000000;"> = 0,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kExternal</span></span><span style="color: #000000;"> = 1,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kPolyline</span></span><span style="color: #000000;"> = 2,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kDerived</span></span><span style="color: #000000;"> = 4,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kTextbox</span></span><span style="color: #000000;"> = 8,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kOutermost</span></span><span style="color: #000000;"> = 0x10,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kNotClosed</span></span><span style="color: #000000;"> = 0x20,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kSelfIntersecting</span></span><span style="color: #000000;"> = 0x40,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kTextIsland</span></span><span style="color: #000000;"> = 0x80,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kDuplicate</span></span><span style="color: #000000;"> = 0x100,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kIsAnnotative</span></span><span style="color: #000000;"> = 0x200,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kDoesNotSupportScale</span></span><span style="color: #000000;"> = 0x400,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kForceAnnoAllVisible</span></span><span style="color: #000000;"> = 0x800,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kOrientToPaper</span></span><span style="color: #000000;"> = 0x1000,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">kIsAnnotativeBlock</span></span><span style="color: #000000;"> = 0x2000</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">};</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">StructLayout</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">LayoutKind</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Auto</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>struct</span></span></span><span><span style="color: #000000;"> </span></span><span><span style="color: #2b91af;">AcArray</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">array</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">mPhysicalLen</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">mLogicalLen</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">mGrowLen</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">};</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">DllImport</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;acdb18.dll&quot;</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">CallingConvention</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CallingConvention</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ThisCall</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">CharSet</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CharSet</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Unicode</span></span><span style="color: #000000;">,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">EntryPoint</span></span><span style="color: #000000;"> = </span><span><span style="color: #a31515;">&quot;?appendLoop@AcDbHatch@@QAE?AW4ErrorStatus@Acad&quot;</span></span><span style="color: #000000;">+</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #a31515;">&quot;@@JABV?$AcArray@VAcGePoint2d@@V?$AcArrayMemCopyReallocator@&quot;</span></span><span style="color: #000000;">+</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #a31515;">&quot;VAcGePoint2d@@@@@@ABV?$AcArray@NV?$AcArrayMemCopyReallocator@N@@@@@Z&quot;</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>private</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">static</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">extern</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop32</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">ths</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">HatchLoopType</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">DllImport</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;acdb18.dll&quot;</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">CallingConvention</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CallingConvention</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ThisCall</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">CharSet</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">CharSet</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Unicode</span></span><span style="color: #000000;">,</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #010001;">EntryPoint</span></span><span style="color: #000000;"> = </span><span><span style="color: #a31515;">&quot;?appendLoop@AcDbHatch@@QEAA?AW4ErrorStatus@Acad&quot;</span></span><span style="color: #000000;">+</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #a31515;">&quot;@@JAEBV?$AcArray@VAcGePoint2d@@V?$AcArrayMemCopyReallocator@&quot;</span></span><span style="color: #000000;">+</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #a31515;">&quot;VAcGePoint2d@@@@@@AEBV?$AcArray@NV?$AcArrayMemCopyReallocator@N@@@@@Z&quot;</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>private</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">static</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">extern</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop64</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">ths</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">HatchLoopType</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #0000ff;"><span>private</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">static</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">ths</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #2b91af;">HatchLoopType</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (</span><span><span style="color: #2b91af;">Marshal</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SizeOf</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">IntPtr</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Zero</span></span><span style="color: #000000;">) &gt; 4)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop64</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">ths</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"><span> </span></span><span><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">appendLoop32</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">ths</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">loopType</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vertices</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">ref</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">bulges</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;">}</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span style="color: #000000;"> </span></span></p>
</div>
