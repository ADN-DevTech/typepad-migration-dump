---
layout: "post"
title: "Returning nested list from .NET to LISP"
date: "2012-05-28 05:25:18"
author: "Adam Nagy"
categories:
  - ".NET"
  - "Adam Nagy"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/returning-nested-list-from-net-to-lisp.html "
typepad_basename: "returning-nested-list-from-net-to-lisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>I tried to create a nested list with the following code but it returned eInvalidResBuf. What's wrong with it?</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">[LispFunction(</span><span style="line-height: 140%; color: #a31515">&quot;GetNestedList&quot;</span><span style="line-height: 140%">)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> GetNestedList(ResultBuffer resBufIn)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// main result buffer</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ResultBuffer resBufOut = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> ResultBuffer();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// 5005 = RTSTR</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue(5005, </span><span style="line-height: 140%; color: #a31515">&quot;Main List Item 1&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// nested result buffer</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ResultBuffer resBufNested = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> ResultBuffer();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufNested.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue(5005, </span><span style="line-height: 140%; color: #a31515">&quot;Nested List Item 1&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufNested.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue(5005, </span><span style="line-height: 140%; color: #a31515">&quot;Nested List Item 2&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">// 5023 = RTRESBUF</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue(5023, resBufNested));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue(5005, </span><span style="line-height: 140%; color: #a31515">&quot;Main List Item 2&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> resBufOut;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p><b>Solution</b></p>  <p>You can find the ResultBuffer TypedValue related codes in the LispDataType enum. As you can see RTRESBUF/5023 is not in the list. You could place the nested part in a LispDataType.ListBegin/LispDataType.ListEnd section instead:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">[LispFunction(</span><span style="line-height: 140%; color: #a31515">&quot;GetNestedList&quot;</span><span style="line-height: 140%">)] </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> GetNestedList(ResultBuffer resBufIn)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ResultBuffer resBufOut = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> ResultBuffer();</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.Text, </span><span style="line-height: 140%; color: #a31515">&quot;Main List Item 1&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.ListBegin));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; resBufOut.Add(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.Text, </span><span style="line-height: 140%; color: #a31515">&quot;Nested List Item 1&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; resBufOut.Add(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.Text, </span><span style="line-height: 140%; color: #a31515">&quot;Nested List Item 2&quot;</span><span style="line-height: 140%">));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.ListEnd));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; resBufOut.Add(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> TypedValue((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)LispDataType.Text, </span><span style="line-height: 140%; color: #a31515">&quot;Main List Item 2&quot;</span><span style="line-height: 140%">));&#160;&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> resBufOut; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
