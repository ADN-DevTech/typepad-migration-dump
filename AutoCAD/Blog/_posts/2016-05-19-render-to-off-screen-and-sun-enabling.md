---
layout: "post"
title: "Render To Off-screen and SUN Enabling"
date: "2016-05-19 21:38:00"
author: "Madhukar Moogala"
categories:
  - ".NET"
  - "2016"
  - "Madhukar Moogala"
original_url: "https://adndevblog.typepad.com/autocad/2016/05/render-to-off-screen-and-sun-enabling.html "
typepad_basename: "render-to-off-screen-and-sun-enabling"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/Madhukar-Moogala.html" target="_self">Madhukar Moogala</a></p> <p>We will discuss few workarounds to tackle the problem with the creation of an off-screen View in .NET,</p> <p>For C++ interested user, following comprehensive sample should <a href="http://adndevblog.typepad.com/autocad/2015/09/rendering-using-rendertoimage-api-.html">help</a>.</p> <p><strong>Problem 1</strong>:</p> <p>The problem is that the off-screen view that I have to create looks as a "mirror" or "upside down" of the initial view that i want to render.</p> <p><em>Workaround</em>: Currently .NET API gives in-correct results, to work around the behaviour, use</p> <div style="font-size: 10pt; font-family: consolas; background: #1e1e1e; color: #dcdcdc"> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;</span><span style="color: #569cd6; line-height: 140%">using</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">Bitmap</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">bitmap</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">offscreenView</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">RenderToImage</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">mySettings</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">myRectangle</span><span style="line-height: 140%">))</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">if</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">File</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Exists</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RenderTestImage.Jpg"</span><span style="line-height: 140%">))</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">File</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Delete</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RenderTestImage.Jpg"</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">bitmap</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">RotateFlip</span><span style="line-height: 140%">(</span><span style="color: #b8d7a3; line-height: 140%">RotateFlipType</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Rotate180FlipX</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">bitmap</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Save</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RenderTestImage.Jpg"</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">System</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Drawing</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Imaging</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: #4ec9b0; line-height: 140%">ImageFormat</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Jpeg</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p></div> <p>&nbsp;</p> <p><strong>Problem 2</strong>:</p> <p>How to enable the SUN for my off-screen view.</p> <div style="font-size: 10pt; font-family: consolas; background: #1e1e1e; color: #dcdcdc"> <p style="margin: 0px"><span style="color: #569cd6; line-height: 140%">public</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">void</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">RND</span><span style="line-height: 140%">()</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">Document</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acDoc</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: #4ec9b0; line-height: 140%">Application</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">DocumentManager</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">MdiActiveDocument</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">Database</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acDb</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acDoc</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Database</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">Editor</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">ed</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acDoc</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Editor</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">/*Turn on SUN*/</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #608b4e; line-height: 140%">//&nbsp;&nbsp; Application.SetSystemVariable("SUNSTATUS", 1);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">vport</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">null</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">Sun</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">sun</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">new</span><span style="line-height: 140%"> </span><span style="color: #4ec9b0; line-height: 140%">Sun</span><span style="line-height: 140%">();</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">sun</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">IsOn</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: #569cd6; line-height: 140%">true</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">using</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">Transaction</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acTrans</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">acDb</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">TransactionManager</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">StartTransaction</span><span style="line-height: 140%">())</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">vport</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">ViewportTableRecord</span><span style="line-height: 140%">)</span><span style="color: white; line-height: 140%">acTrans</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">GetObject</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">acDoc</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Editor</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">ActiveViewportId</span><span style="line-height: 140%">, </span><span style="color: #b8d7a3; line-height: 140%">OpenMode</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">ForWrite</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">vport</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">SetSun</span><span style="line-height: 140%">(</span><span style="color: white; line-height: 140%">sun</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">acTrans</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Commit</span><span style="line-height: 140%">();</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">Autodesk</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">AutoCAD</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Geometry</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: #4ec9b0; line-height: 140%">Point2d</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">myScreenSize</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">Point2d</span><span style="line-height: 140%">)</span><span style="color: #4ec9b0; line-height: 140%">Application</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">GetSystemVariable</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"screensize"</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">double</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">myWidth</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">myScreenSize</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">X</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">double</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">myHeight</span><span style="line-height: 140%"> </span><span style="color: #b4b4b4; line-height: 140%">=</span><span style="line-height: 140%"> </span><span style="color: white; line-height: 140%">myScreenSize</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Y</span><span style="line-height: 140%">;</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #569cd6; line-height: 140%">if</span><span style="line-height: 140%"> (</span><span style="color: #4ec9b0; line-height: 140%">File</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Exists</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RndImage.bmp"</span><span style="line-height: 140%">))</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #4ec9b0; line-height: 140%">File</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Delete</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RndImage.bmp"</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ed</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Command</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"_render"</span><span style="line-height: 140%">, </span><span style="color: #d69d85; line-height: 140%">""</span><span style="line-height: 140%">, </span><span style="color: #d69d85; line-height: 140%">"render"</span><span style="line-height: 140%">, </span><span style="color: white; line-height: 140%">myWidth</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">ToString</span><span style="line-height: 140%">(), </span><span style="color: white; line-height: 140%">myHeight</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">ToString</span><span style="line-height: 140%">(), </span><span style="color: #d69d85; line-height: 140%">"yes"</span><span style="line-height: 140%">, </span><span style="color: #d69d85; line-height: 140%">"D:\\Temp\\RndImage.bmp"</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: white; line-height: 140%">ed</span><span style="color: #b4b4b4; line-height: 140%">.</span><span style="color: white; line-height: 140%">Command</span><span style="line-height: 140%">(</span><span style="color: #d69d85; line-height: 140%">"RENDERWINDOWCLOSE"</span><span style="line-height: 140%">);</span></p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px"><span style="line-height: 140%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p></div> <p>&nbsp;</p> <p>I have not used renderToImage API, as of now, when SUN is enabled, rendering on off-screen does not display the effects of Sun, hence above workaround is proposed now.</p>
