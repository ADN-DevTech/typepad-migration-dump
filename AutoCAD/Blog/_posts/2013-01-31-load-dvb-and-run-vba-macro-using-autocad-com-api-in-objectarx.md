---
layout: "post"
title: "Load DVB and run VBA macro using AutoCAD COM API in ObjectARX"
date: "2013-01-31 16:19:17"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "ActiveX"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/load-dvb-and-run-vba-macro-using-autocad-com-api-in-objectarx.html "
typepad_basename: "load-dvb-and-run-vba-macro-using-autocad-com-api-in-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>How can I load a .dvb and run the macro using AutoCAD COM interface?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#import</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#a31515">&quot;acax19ENU.tlb&quot;</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">no_implementation</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">raw_interfaces_only</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;comdef.h&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;atlbase.h&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;acadi_i.c&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">namespace</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AutoCAD</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">LoadVBARunMacro</font></font></span><font style="font-size: 8pt" color="#000000">() </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{ </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// setup the VBA macro DVB details</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CComBSTR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bsrtVBAName</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;d:\\temp\\Project.dvb&quot;</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// setup the macro name :pass your macro name here </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CComBSTR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bstrMacro</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;test&quot;</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get acad's iDispatch</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">IAcadApplicationPtr</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pAcad</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acedGetIDispatch</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now load the DVB</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">HRESULT</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAcad</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">LoadDVB</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">bsrtVBAName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">m_str</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">SUCCEEDED</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">hr</font></span><font color="#000000">)) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; { </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// run the macro</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAcad</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">RunMacro</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">bstrMacro</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">m_str</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// unload the DVB if you want</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAcad</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">UnloadDVB</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">bsrtVBAName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">m_str</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; } </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
