---
layout: "post"
title: "Selecting Model Space entities from Paper Space using AutoCAD Selection Sets in C#"
date: "2012-04-04 10:52:33"
author: "Fenton Webb"
categories:
  - ".NET"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/04/selecting-model-space-entities-from-paper-space-using-autocad-selection-sets-in-c.html "
typepad_basename: "selecting-model-space-entities-from-paper-space-using-autocad-selection-sets-in-c"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html" target="_self">Fenton Webb</a></p>
<p>I recently posted a blog on <a href="http://adndevblog.typepad.com/autocad/2012/03/converting-paper-space-point-to-model-space-using-autocadnet.html"><span style="color: #0066cc;">Converting Paper Space point to Model Space using AutoCAD.NET</span></a> and I thought I’d extend that same blog to include using a Paper Space Vport geometry to select all of the Model Space objects that it displays…</p>
<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016303af0554970d-pi"><img alt="image" border="0" height="358" src="/assets/image_121620.jpg" style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" width="479" /></a></p>
<p>So here goes :</p>
<div style="background: white;">
<pre style="margin: 0px;"><span><span style="color: #008000;">// select all entities in Model Space using Paper Space viewport</span></span></pre>
<pre style="margin: 0px;"><span><span style="color: #008000;">// by Fenton Webb, DevTech, Autodesk, 02/Apr/2012</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>[</span></span><span><span><span style="color: #2b91af;">CommandMethod</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;selectMsFromPs&quot;</span></span><span style="color: #000000;">, </span><span><span style="color: #2b91af;">CommandFlags</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">NoTileMode</span></span><span style="color: #000000;">)]</span></span></pre>
<pre style="margin: 0px;"><span><span style="color: #0000ff;"><span>static</span></span></span><span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">selectMsFromPs</span></span><span style="color: #000000;">()</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">{</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #2b91af;">Editor</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;"> = </span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">DocumentManager</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">MdiActiveDocument</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Editor</span></span><span style="color: #000000;">;</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span style="color: #008000;">// pick a PS Viewport</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #2b91af;">PromptEntityOptions</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">opts</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">PromptEntityOptions</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;Pick PS Viewport&quot;</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #010001;">opts</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SetRejectMessage</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;Must select PS Viewport objects only&quot;</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #010001;">opts</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AddAllowedClass</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">typeof</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">Autodesk</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AutoCAD</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">DatabaseServices</span></span><span style="color: #000000;">.</span><span><span style="color: #2b91af;">Viewport</span></span><span style="color: #000000;">), </span><span><span style="color: #0000ff;">false</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #2b91af;">PromptEntityResult</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">res</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">GetEntity</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">opts</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160; </span></span><span><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> (</span><span><span style="color: #010001;">res</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Status</span></span><span style="color: #000000;"> == </span><span><span style="color: #2b91af;">PromptStatus</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">OK</span></span><span style="color: #000000;">)</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160; {</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #0000ff;">int</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">vpNumber</span></span><span style="color: #000000;"> = 0;</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// extract the viewport points</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">Point3dCollection</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point3dCollection</span></span><span style="color: #000000;">();</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #0000ff;">using</span></span><span style="color: #000000;"> (</span><span><span style="color: #010001;">Autodesk</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AutoCAD</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">DatabaseServices</span></span><span style="color: #000000;">.</span><span><span style="color: #2b91af;">Viewport</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">psVp</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">res</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ObjectId</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Open</span></span><span style="color: #000000;">(</span><span><span style="color: #2b91af;">OpenMode</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ForRead</span></span><span style="color: #000000;">) </span></span></pre>
<pre style="margin: 0px;"><span><span><span style="color: #0000ff;">as</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">Autodesk</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">AutoCAD</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">DatabaseServices</span></span><span style="color: #000000;">.</span><span><span style="color: #2b91af;">Viewport</span></span><span style="color: #000000;">)</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;&#0160;&#0160; {</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// get the vp number</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">vpNumber</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">psVp</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Number</span></span><span style="color: #000000;">;</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// now extract the viewport geometry</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">psVp</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">GetGripPoints</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntegerCollection</span></span><span style="color: #000000;">(), </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">IntegerCollection</span></span><span style="color: #000000;">()); </span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;&#0160;&#0160; }</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// let&#39;s assume a rectangular vport for now, make the cross-direction grips square</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">Point3d</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">tmp</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">[2];</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">[2] = </span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">[1];</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">[1] = </span><span><span style="color: #010001;">tmp</span></span><span style="color: #000000;">;</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// Transform the PS points to MS points</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">rbFrom</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">TypedValue</span></span><span style="color: #000000;">(5003, 3));</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">rbTo</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">ResultBuffer</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">TypedValue</span></span><span style="color: #000000;">(5003, 2));</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;">[] </span><span><span style="color: #010001;">retPoint</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">double</span></span><span style="color: #000000;">[] { 0, 0, 0 };</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// loop the ps points </span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">Point3dCollection</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">msVpPnts</span></span><span style="color: #000000;"> = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point3dCollection</span></span><span style="color: #000000;">();</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #0000ff;">foreach</span></span><span style="color: #000000;"> (</span><span><span style="color: #2b91af;">Point3d</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">pnt</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">in</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">psVpPnts</span></span><span style="color: #000000;">)</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;&#0160;&#0160; {</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// translate from from the DCS of Paper Space (PSDCS) RTSHORT=3 and </span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// the DCS of the current model space viewport RTSHORT=2</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">acedTrans</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">pnt</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">ToArray</span></span><span style="color: #000000;">(), </span><span><span style="color: #010001;">rbFrom</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">UnmanagedObject</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">rbTo</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">UnmanagedObject</span></span><span style="color: #000000;">, 0, </span><span><span style="color: #010001;">retPoint</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// add the resulting point to the ms pnt array</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">msVpPnts</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">Add</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point3d</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">retPoint</span></span><span style="color: #000000;">));</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">WriteMessage</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;\n&quot;</span></span><span style="color: #000000;"> + </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Point3d</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">retPoint</span></span><span style="color: #000000;">).</span><span><span style="color: #010001;">ToString</span></span><span style="color: #000000;">());</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;&#0160;&#0160; }</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// now switch to MS</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SwitchToModelSpace</span></span><span style="color: #000000;">();</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// set the CVPort</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SetSystemVariable</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;CVPORT&quot;</span></span><span style="color: #000000;">, </span><span><span style="color: #010001;">vpNumber</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// once switched, we can use the normal selection mode to select</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #2b91af;">PromptSelectionResult</span></span><span style="color: #000000;"> </span><span><span style="color: #010001;">selectionresult</span></span><span style="color: #000000;"> = </span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SelectCrossingPolygon</span></span><span style="color: #000000;">(</span><span><span style="color: #010001;">msVpPnts</span></span><span style="color: #000000;">);</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span style="color: #008000;">// now switch back to PS</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;"><span>&#0160;&#0160;&#0160; </span></span><span><span><span style="color: #010001;">ed</span></span><span style="color: #000000;">.</span><span><span style="color: #010001;">SwitchToPaperSpace</span></span><span style="color: #000000;">();</span></span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160; }</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">}</span></pre>
<pre style="margin: 0px;"><span style="color: #000000;">&#0160;</span></pre>
</div>
