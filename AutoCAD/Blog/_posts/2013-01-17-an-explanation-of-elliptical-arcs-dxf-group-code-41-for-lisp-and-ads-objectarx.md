---
layout: "post"
title: "An Explanation of Elliptical Arcs DXF Group Code 41 for LISP and ADS ObjectARX"
date: "2013-01-17 14:52:22"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "LISP"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/an-explanation-of-elliptical-arcs-dxf-group-code-41-for-lisp-and-ads-objectarx.html "
typepad_basename: "an-explanation-of-elliptical-arcs-dxf-group-code-41-for-lisp-and-ads-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>In elliptical arcs, group code 41 is described as the start parameter. However,   <br />it doesn't seem to be associated with any of the known values for the arc. How    <br />is this value derived?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>An elliptical arc is a special version of an arc that follows the eccentricity   <br />of the ellipse. One way to generate this type of arc is to find the parametric    <br />normal of the starting point. To do so, you must specify a start angle that is    <br />different from the actual start angle of the drawn arc. Group code 41 contains    <br />this parametric angle expressed in radians.</p>  <p><strong>WHAT IS THE PARAMETRIC ANGLE?</strong></p>  <p>The parametric angle is generated from two concentric circles whose center is   <br />the center of the ellipse and whose radii are the major and minor axes,    <br />respectively. Every point of the ellipse lies either between or on these two    <br />circles, and each elliptical point can be defined by a unique relation to them.    <br />To discover this relationship, draw a line perpendicular to the major axis from    <br />a point on the ellipse to the closest intersection with the circle described by    <br />the major axis. Then do the same with the minor axis, starting from the    <br />elliptical point and drawing perpendicular to the minor axis until the line    <br />intersects the circle described by the minor axis. The two points of    <br />intersection with the circles are colinear with the center of the ellipse. The    <br />angle between the line containing these three points and the major axis is the    <br />parametric angle specified by group code 41.</p>  <p><strong>HOW DO I CALCULATE IT FROM THE TRUE START ANGLE?</strong></p>  <p>To calculate the parametric angle from the true start angle, you must first find   <br />the start point on the ellipse. This requires a simultaneous solution to the    <br />equations for the line and the ellipse. In this example we assume that the major    <br />axis of the ellipse lies on the x-axis with the origin at the center of the    <br />ellipse. When this point is found, you can use its y-value and the minor axis to    <br />solve the equation for the circle whose radius is the minor axis value and whose    <br />center is the center of the ellipse. This will provide the x,y point on the    <br />circle that dictates the parametric angle from the center of the ellipse.</p>  <p>The following is an AutoLisp example that demonstrates how to use trigonometric   <br />functions to determine the parametric angle:</p>  <pre><pre><br />(defun c:e_arc( / a b slope ang q1 q2 q3 q4 qmode x y a2)<br />;assuming 0,0 is at the center of the ellipse, major axis in x direction<br />    (setq ang (getangle '(0.0 0.0) &quot;Choose start angle: &quot;))<br />    (setq a 1 <br />        b 0.5 <br />        slope (/ (sin ang) (cos ang))<br />        q1 (/ pi 2.0)<br />        q2 pi<br />        q3 (/ (* 3 pi) 2.0)<br />        q4 (* 2.0 pi)<br />        qmode 'q1<br />    );setq<br />    (entmake (setq ent '((0 . &quot;ELLIPSE&quot;) <br />            (100 . &quot;AcDbEntity&quot;) <br />            (100 . &quot;AcDbEllipse&quot;) <br />            (10 0.0 0.0 0.0) <br />            (11 1.0 0.0 0.0)<br />            (40 . 0.5) <br />            (62 . 1))<br />        );setq<br />    );entmake<br /><br />;line equation is y = mx + 0, where m is the slope and 0 is the y-intercept<br />;ellipse equation is x^2/a^2 + y^2/b^2 = 1<br />;solve line and ellipse equations simultaneously to find x and y values<br /><br />    (setq y (/ (* a b slope) (sqrt (+ (* (* slope slope) (* a a)) (* b b))))<br />    );setq<br /><br />;minor axis circle equation is x^2 + y^2 = b^2<br />;solve circle equation where y = value calculated above<br />    (setq x (sqrt (- (* b b) (* y y))))<br /><br />;calculate start angle trigonometrically<br />    (setq cos_a2 (/ x b)<br />          sin_a2 (/ y b)<br />    );setq<br />    (if (/= cos_a2 0)<br />        (setq a2 (atan (/ sin_a2 cos_a2)))<br />        (setq a2 q1 qmode 'q1)             <br />    );if<br /><br /><br />;make a2 insensitive to quadrant<br />    (cond ((and (&gt; ang q1) (&lt; ang q2))<br />                (setq a2 (- pi (abs a2)) qmode 'q2<br />                );setq<br />            );statement 1<br />            ((and (&gt; ang q2) (&lt; ang q3))<br />                (setq a2 (+ (abs a2) pi) qmode 'q3<br />                );setq<br />            );statement 2<br />            ((and (&gt; ang q3) (&lt; ang q4))<br />                (setq a2 (abs (- (* 2 pi) (abs a2))) qmode 'q4<br />                );setq<br />            );statement 3<br /><br />    ;special cases: angle = 0, 90, 180, 270 or 360 deg<br />            ((or (= ang 0) (= ang q1))<br />                (setq qmode 'q1)<br />            );statement 4<br />            ((= ang q2) <br />                (setq a2 pi qmode 'q1)<br />            );statement 5<br />            ((= ang q3)<br />                (setq a2 (- (/ pi 2.0) pi) qmode 'q1)<br />            );statement 6<br />            (t nil);default statement<br />    );cond<br /><br />    (command &quot;zoom&quot; &quot;c&quot; &quot;0,0&quot; 3)        <br />    (setq ent (append  ent (list (cons 41 a2) (cons 42 (+ a2 (/ pi 2.0))))))<br />    (setq ent (subst '(62 . 5) (assoc 62 ent) ent))<br />    (entmake ent)<br />    <br />    (setq a2 <br />        (cond ((= qmode 'q1) a2)<br />            ((= qmode 'q2) a2)<br />            ((= qmode 'q3) (- a2 q4))<br />            ((= qmode 'q4) (- a2 q4))<br />            (t nil)<br />        );cond<br />    );setq<br />    <br />    (princ &quot;\nParametric angle in radians: &quot;)<br />    (princ a2)<br />    (princ &quot;\nParametric angle in degrees: &quot;)<br />    (princ (/ (* 180 a2) pi))<br />    (princ)<br />    <br />);e_arc</pre></pre>
