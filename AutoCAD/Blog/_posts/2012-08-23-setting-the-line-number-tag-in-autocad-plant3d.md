---
layout: "post"
title: "Setting the Line Number Tag in AutoCAD Plant3d"
date: "2012-08-23 11:40:57"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/setting-the-line-number-tag-in-autocad-plant3d.html "
typepad_basename: "setting-the-line-number-tag-in-autocad-plant3d"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Leading on from this <a href="http://adndevblog.typepad.com/autocad/2012/08/datalinksmanager3dgetlinegroupinfo-fails-in-autocad-plant3d-20122013.html">post</a> I had a question on how to use that same code to set the Line Number Tag; I have to admit, for a newbie, it’s not that obvious... </p>  <p>Selecting the PPG-PIPING-01.dwg from the Plant3d 2012 “Sample Project” project, and then viewing the Properties of the first Pipe I see, I get this view in Plant…</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0177444d0448970d-pi"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/assets/image_856656.jpg" width="481" height="396" /></a></p>  <p>So how to set the Line Number Tag?</p>  <p>Using the code from the previous post I mentioned above, you would think this code would work, but it doesn’t…</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">[</font><font style="font-size: 8pt"><span style="color: ">CommandMethod</span>(<span style="color: ">&quot;GetLineGroupInfo&quot;</span>)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><span style="color: "><font style="font-size: 8pt">public</font></span><font style="font-size: 8pt"> <span style="color: ">void</span> <span style="color: ">GetLineGroupInfo</span>()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;</font><span style="color: "><font style="font-size: 8pt">// get the AutoCAD Editor object so we can print to the command line</font></span></font></font></p>    <p style="margin: 0px"><font color="#a5a5a5"><font face="Consolas"><font style="font-size: 8pt">&#160;</font><font style="font-size: 8pt"><span style="color: ">Editor</span> <span style="color: ">ed</span> = <span style="color: ">AcadApp</span>.<span style="color: ">DocumentManager</span>.<span style="color: ">MdiActiveDocument</span>.<span style="color: ">Editor</span>;</font></font><font face="Consolas"><font style="font-size: 8pt">&#160;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;</font><span style="color: "><font style="font-size: 8pt">// select the object </font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;</font><font style="font-size: 8pt"><span style="color: ">PromptEntityResult</span> <span style="color: ">res</span> = <span style="color: ">ed</span>.<span style="color: ">GetEntity</span>(<span style="color: ">&quot;Pick Object obtain properties : &quot;</span>);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;</font><span style="color: "><font style="font-size: 8pt">// if something selected</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;</font><font style="font-size: 8pt"><span style="color: ">if</span> (<span style="color: ">res</span>.<span style="color: ">Status</span> == <span style="color: ">PromptStatus</span>.<span style="color: ">OK</span>)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5"> {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// get the current project object</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">PlantProject</span> <span style="color: ">currentProj</span> = <span style="color: ">PlantApplication</span>.<span style="color: ">CurrentProject</span>;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// get the Piping project part</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">PipingProject</span> <span style="color: ">pipeProj</span> = (<span style="color: ">PipingProject</span>)<span style="color: ">currentProj</span>.<span style="color: ">ProjectParts</span>[<span style="color: ">&quot;Piping&quot;</span>];</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// get the data links manager</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">DataLinksManager</span> <span style="color: ">dlm</span> = <span style="color: ">pipeProj</span>.<span style="color: ">DataLinksManager</span>;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// get the 3d data links manager</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">DataLinksManager3d</span> <span style="color: ">dlm3d</span> = <span style="color: ">pipeProj</span>.<span style="color: ">DataLinksManager3d</span>;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// and then get the row id for the selected object</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">int</span> <span style="color: ">rowId</span> = <span style="color: ">dlm</span>.<span style="color: ">FindAcPpRowId</span>(<span style="color: ">res</span>.<span style="color: ">ObjectId</span>);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// Parts are related to pipe line group via P3dLineGroupPartRelationship. </font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#a5a5a5">&#160; // So we need to traverse this relationship to get line group row id</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">PnPRowIdArray</span> <span style="color: ">lgid</span> = <span style="color: ">dlm</span>.<span style="color: ">GetRelatedRowIds</span>(<span style="color: ">&quot;P3dLineGroupPartRelationship&quot;</span>, <span style="color: ">&quot;Part&quot;</span>, <span style="color: ">rowId</span>, <span style="color: ">&quot;LineGroup&quot;</span>);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">if</span> (<span style="color: ">lgid</span> == <span style="color: ">null</span> || <span style="color: ">lgid</span>.<span style="color: ">Count</span> == 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;&#160; </font><span style="color: "><font style="font-size: 8pt">// line group was not found. May happen, for example, if Equipment is picked.</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160;&#160; </font><font style="font-size: 8pt"><span style="color: ">return</span>;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// this is line group row in the data. (PnPRowIdArray is in fact list</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">int</span> <span style="color: ">lgRowId</span> = <span style="color: ">lgid</span>.<span style="color: ">First</span>.<span style="color: ">Value</span>;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// using lgRowId you may get all line group properties using the following code </font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><span style="color: "><font style="font-size: 8pt">// last parameter doesn't matter</font></span></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#a5a5a5"><font style="font-size: 8pt">&#160; </font><font style="font-size: 8pt"><span style="color: ">List</span>&lt;<span style="color: ">KeyValuePair</span>&lt;<span style="color: ">string</span>, <span style="color: ">string</span>&gt;&gt; <span style="color: ">vals</span> = <span style="color: ">dlm</span>.<span style="color: ">GetAllProperties</span>(<span style="color: ">lgRowId</span>, <span style="color: ">false</span>);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#a5a5a5">&#160; try</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#a5a5a5">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font style="font-size: 8pt" color="#008000"><font color="#a5a5a5">&#160;</font>&#160;&#160; // or get the same thing from PnPDatabase via row</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">&#160;&#160;&#160; PnPRow</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetPnPDatabase</font></span><font color="#000000">().</font><span style="color: "><font color="#010001">GetRow</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lgRowId</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">&#160;&#160;&#160; String</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Tag</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Tag&quot;</font></span><font color="#000000">].</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160; lgRow</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">BeginEdit</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160; lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Tag&quot;</font></span><font color="#000000">] = </font><span style="color: "><font color="#a31515">&quot;98765&quot;</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160; lgRow</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">EndEdit</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160; Tag</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Tag&quot;</font></span><font color="#000000">].</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">&#160; catch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">System</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">Exception</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ex</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>      <p>The reason that it doesn’t is because the Tag value is actually defined via the Project Manager-&gt;Project Settings to be set via the P3d Line Group ‘Number’ property…</p>  <p>First let’s see how I found worked out that it was using the P3d Line Group…</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0177444d044d970d-pi"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/assets/image_691338.jpg" width="515" height="362" /></a></p>  <p>&#160;</p>  <p>Now let’s see how I worked out that the ‘Number’ property is the one we need…</p>  <p>&#160;</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0177444d0455970d-pi"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/assets/image_773979.jpg" width="516" height="437" /></a></p>  <p>So, finally, to change the Tag, the code should look something like this…</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;GetLineGroupInfo&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">GetLineGroupInfo</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the AutoCAD Editor object so we can print to the command line</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Editor</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ed</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">AcadApp</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// select the object </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PromptEntityResult</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetEntity</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Pick Object obtain properties : &quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if something selected</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">res</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Status</font></span><font color="#000000"> == </font><span style="color: "><font color="#2b91af">PromptStatus</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">OK</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the current project object</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PlantProject</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">currentProj</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">PlantApplication</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">CurrentProject</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the Piping project part</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PipingProject</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pipeProj</font></span><font color="#000000"> = (</font><span style="color: "><font color="#2b91af">PipingProject</font></span><font color="#000000">)</font><span style="color: "><font color="#010001">currentProj</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ProjectParts</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Piping&quot;</font></span><font color="#000000">];</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the data links manager</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">DataLinksManager</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pipeProj</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DataLinksManager</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the 3d data links manager</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">DataLinksManager3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dlm3d</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pipeProj</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DataLinksManager3d</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// and then get the row id for the selected object</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rowId</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">FindAcPpRowId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">res</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ObjectId</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">try</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PipeLineGroupData</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lginfo</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm3d</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetLineGroupInfo</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">rowId</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">catch</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// there is bug in the Plant that prevents getting lginfo by part rowid. Sorry.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// but we may achieve the same thing using the following workaround</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Parts are related to pipe line group via P3dLineGroupPartRelationship. </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// So we need to traverse this </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// relationship to get line group row id</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PnPRowIdArray</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lgid</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetRelatedRowIds</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;P3dLineGroupPartRelationship&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#a31515">&quot;Part&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">rowId</font></span><font color="#000000">, </font><span style="color: "><font color="#a31515">&quot;LineGroup&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">lgid</font></span><font color="#000000"> == </font><span style="color: "><font color="#0000ff">null</font></span><font color="#000000"> || </font><span style="color: "><font color="#010001">lgid</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Count</font></span><font color="#000000"> == 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// line group was not found. May happen, for example, if Equipment is picked.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// this is line group row in the data. (PnPRowIdArray is in fact list</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lgRowId</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">lgid</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">First</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Value</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// using lgRowId you may get all line group properties using the following code </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// last parameter doesn't matter</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">List</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#2b91af">KeyValuePair</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000">&gt;&gt; </font><span style="color: "><font color="#010001">vals</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetAllProperties</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lgRowId</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">try</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the pnp row</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PnPRow</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetPnPDatabase</font></span><font color="#000000">().</font><span style="color: "><font color="#010001">GetRow</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lgRowId</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// find out what the original tag was set to</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">String</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Tag</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Tag&quot;</font></span><font color="#000000">].</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// start an edit transaction</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">BeginEdit</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// set the P3d Line Group 'Number'</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Number&quot;</font></span><font color="#000000">] = </font><span style="color: "><font color="#a31515">&quot;98765&quot;</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// finish the edit transaction</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">EndEdit</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// see if it worked</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Tag</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">lgRow</font></span><font color="#000000">[</font><span style="color: "><font color="#a31515">&quot;Tag&quot;</font></span><font color="#000000">].</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// yes it did!</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// all done</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">System</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">Exception</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ex</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// the following code will only work if linegroup has a valid (not empty) tag. So you may expect </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// exception here if LineGroup is not assigned a tag (not sure why it is done this way)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">try</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PipeLineGroupData</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lginfoAtLast</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">dlm3d</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetLineGroupInfo</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lgRowId</font></span><font color="#000000">);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">catch</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get here if line group doesn't have assigned tag</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
