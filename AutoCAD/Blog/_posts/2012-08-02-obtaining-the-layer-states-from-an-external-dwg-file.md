---
layout: "post"
title: "Obtaining the Layer States from an External DWG file"
date: "2012-08-02 15:51:08"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/obtaining-the-layer-states-from-an-external-dwg-file.html "
typepad_basename: "obtaining-the-layer-states-from-an-external-dwg-file"
typepad_status: "Publish"
---

<div style="font-family: ; background: white; color: ">   <p style="margin: 0px">by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt"></font></font></font></p>    <p style="margin: 0px"><font color="#000000" face="Consolas">Hereâ€™s some code which shows how to obtain the LayerStates from an external DWG file using VB.NET</font></p>    <p style="margin: 0px"><font color="#000000" face="Consolas"></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&lt;</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;GetLayerStates&quot;</font></span><font color="#000000">)&gt; _</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">Sub</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">GetLayerStates</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">doc</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Document</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">MdiActiveDocument</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ed</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Editor</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">doc</font></span><font color="#000000">.</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">Editor</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' select a dwg file</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">openFileDlg</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#2b91af">OpenFileDialog</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">openFileDlg</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">New</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">OpenFileDialog</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Select DWG File&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#a31515">&quot;fenton.dwg&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#a31515">&quot;dwg&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#a31515">&quot;Select DWG file&quot;</font></span><font color="#000000">, 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' if something was selected</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">If</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">openFileDlg</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ShowModal</font></span><font color="#000000">() = </font><span style="color: "><font color="#0000ff">True</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' extract the file path</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dwgPath</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">String</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">openFileDlg</font></span><font color="#000000">.</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">Filename</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' now get the layer state name</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lsName</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#2b91af">PromptResult</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">lsName</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetString</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Enter Layer State name&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' if ok</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">If</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">lsName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Status</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">PromptStatus</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">OK</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' now open the dwg in a side database</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Using</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">sideDb</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">New</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">False</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">True</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' read the dwg file</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">sideDb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ReadDwgFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">dwgPath</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">IO</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">FileShare</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Read</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">False</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">Nothing</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' close the file and make sure we have read everything in</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">sideDb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">CloseInput</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">True</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' get the layer state manager</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lsManager</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">LayerStateManager</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">sideDb</font></span><font color="#000000">.</font></font><span style="color: "><font style="font-size: 8pt" color="#010001">LayerStateManager</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">vbNewLine</font></span><font color="#000000"> + </font><span style="color: "><font color="#a31515">&quot;Data for Later State &quot;</font></span><font color="#000000"> _</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><font color="#000000">+ </font><span style="color: "><font color="#2b91af">lsName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StringResult</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">vbNewLine</font></span><font color="#000000"> + </font><span style="color: "><font color="#a31515">&quot;Mask = &quot;</font></span><font color="#000000"> _</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><font color="#000000">+ </font><span style="color: "><font color="#2b91af">lsManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetLayerStateMask</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">lsName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StringResult</font></span><font color="#000000">).</font><span style="color: "><font color="#010001">ToString</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">' obtain all of the layers for a particular layerstate</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">lsLayers</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">ArrayList</font></span><font color="#000000"> = _</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">lsManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetLayerStateLayers</font></span><font color="#000000">(</font><span style="color: "><font color="#2b91af">lsName</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">StringResult</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">False</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">For</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Each</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">layer</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">String</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">In</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">lsLayers</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WriteMessage</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">vbNewLine</font></span><font color="#000000"> + </font><span style="color: "><font color="#a31515">&quot;Layer = &quot;</font></span><font color="#000000"> + </font><span style="color: "><font color="#010001">layer</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Next</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Using</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
