---
layout: "post"
title: "Running AutoCAD VBA from C# .NET"
date: "2012-08-06 16:17:25"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/running-autocad-vba-from-c-net.html "
typepad_basename: "running-autocad-vba-from-c-net"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Here’s how to invoke a function Public Sub Test() declared in VBA from .NET; use acedCmd() and run <strong>–vbarun</strong></p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// how to call VBA from .NET</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#if</font></font></span><font style="font-size: 8pt" color="#000000"> AC2013</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">DllImport</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;accore.dll&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">CallingConvention</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">CallingConvention</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Cdecl</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">EntryPoint</font></span><font color="#000000"> = </font><span style="color: "><font color="#a31515">&quot;acedCmd&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#else</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#808080">&#160;&#160;&#160; [DllImport(&quot;acad.exe&quot;, CallingConvention = CallingConvention.Cdecl, EntryPoint = &quot;acedCmd&quot;)]</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">private</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">extern</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">acedCmd</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">System</font></span><font color="#000000">.</font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">vlist</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;callVBA&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">callVBA</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">ResultBuffer</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rb</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">ResultBuffer</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// RTSTR = 5005</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">rb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Add</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">TypedValue</font></span><font color="#000000">(5005, </font><span style="color: "><font color="#a31515">&quot;_.-vbarun&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">rb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Add</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">TypedValue</font></span><font color="#000000">(5005, </font><span style="color: "><font color="#a31515">&quot;test&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// start vbarun running 'ThisDrawing.Test()</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acedCmd</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">rb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">UnmanagedObject</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
