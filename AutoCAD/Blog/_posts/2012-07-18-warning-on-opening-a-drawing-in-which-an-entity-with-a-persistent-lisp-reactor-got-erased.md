---
layout: "post"
title: "Warning on opening a drawing in which an entity with a persistent LISP reactor got erased"
date: "2012-07-18 07:03:00"
author: "Adam Nagy"
categories:
  - "Adam Nagy"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2012/07/warning-on-opening-a-drawing-in-which-an-entity-with-a-persistent-lisp-reactor-got-erased.html "
typepad_basename: "warning-on-opening-a-drawing-in-which-an-entity-with-a-persistent-lisp-reactor-got-erased"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>
<p>I&#39;m adding a persistent reactor to an entity using LISP, but the problem is that if the entity with the reactor attached gets deleted, then on reopening the drawing I get this warning:</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"> <span style="background-color: #e6e6e6; color: #800080;">;&#0160;warning:erased&#0160;VLA-object&#0160;restored&#0160;to&#0160;NIL</span></span></p>
<p>Here is the code I&#39;m testing with:</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;pers-modified&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object&#0160;parameter-list<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">cond</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-read-enabled-p</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-property-available-p</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;notifier-object<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff00ff;">&quot;Radius&quot;</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;The&#0160;radius&#0160;is&#0160;&quot;</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-get-radius</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;cond<br /></span> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;c:startReactor&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span>&#0160;circle&#0160;reactor<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">entsel</span>&#0160;<br /><span style="color: #ff00ff;">&#0160; &#0160; &quot;\nSelect&#0160;a&#0160;circle&#0160;to&#0160;add&#0160;persistent&#0160;reactor&#0160;to:&#0160;&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">))</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-ename-</span>&gt;vla-object&#0160;circle<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> g-object-reactor<br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-object-reactor</span><br />&#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;circle<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;&#0160;list&#0160;of&#0160;objects<br /></span>&#0160; &#0160; &#0160; <span style="color: #0000ff;">nil</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;&#0160;reactor&#0160;data<br /></span>&#0160; &#0160; &#0160; &#39;<span style="color: #ff0000;">(</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-modified</span>&#0160;.&#0160;pers-modified<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;<span style="color: #ff0000;">)</span><br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers</span>&#0160;g-object-reactor<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> </span></p>
<p>I also tried removing the reactor from the entity when it gets deleted, but then in case of UNDO the reactor does not get reattached and I do not get notified when the entity gets unerased. Not sure what to try next.</p>
<p><strong>Solution</strong></p>
<p><strong>1. If the same reactor is watching multipe entities</strong></p>
<p>You could create another non-persistent/transient object reactor that could keep track of the erased or unappended objects and then add them back to the persistent reactor.</p>
<p>This way when the drawing gets saved the erased objects only have a transient reactor which does not get saved in the drawing.</p>
<p>Unfortunately, it seems you cannot modify the reactor owners list from object erased, unerased, reappended and unappended. So you need to create a list that stores the objects that need to be moved from one reactor to the other and do the actual modification inside e.g. the documentLockModeWillChange event.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;PERSISTENT&#0160;REACTOR&#0160;PART&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;the&#0160;objectModified&#0160;handler&#0160;prints&#0160;some&#0160;info&#0160;about&#0160;the&#0160;circle<br /></span></span> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;pers-modified&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object&#0160;parameter-list<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">cond</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-read-enabled-p</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-property-available-p</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;notifier-object<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff00ff;">&quot;Radius&quot;</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;The&#0160;radius&#0160;is&#0160;&quot;</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-get-radius</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;cond<br /></span> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;handles&#0160;UnAppended&#0160;and&#0160;Erased&#0160;events<br /></span></span> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;pers-objectRemoved&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object<br /> &#0160;&#0160;&#0160;parameter-list&#0160;<span style="color: #0000ff;">/</span><br /> &#0160;&#0160;&#0160;owners index<br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;we&#0160;cannot&#0160;modify&#0160;the&#0160;owners&#0160;of&#0160;a&#0160;reactor&#0160;from&#0160;here<br /></span> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;so&#0160;we&#0160;just&#0160;create&#0160;a&#0160;list&#0160;and&#0160;postpone&#0160;the&#0160;modification<br /></span> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;till&#0160;docmanager-document-lock-mode-will-change<br /></span> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span>=&#0160;g-erased-objects&#0160;nil<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-erased-objects<br />&#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">append</span>&#0160;g-erased-objects&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-erased-objects&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span><br /> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;DUSTBIN&#0160;REACTOR&#0160;PART&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;handles&#0160;ReAppended&#0160;and&#0160;UnErased&#0160;events<br /></span></span> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;dustbin-objectAdded&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object<br /> &#0160;&#0160;&#0160;&#0160;parameter-list&#0160;<span style="color: #0000ff;">/</span><br /> &#0160;&#0160;&#0160;&#0160;owners index<br /> &#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;we&#0160;cannot&#0160;modify&#0160;the&#0160;owners&#0160;of&#0160;a&#0160;reactor&#0160;from&#0160;here<br /></span> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;so&#0160;we&#0160;just&#0160;create&#0160;a&#0160;list&#0160;and&#0160;postpone&#0160;the&#0160;modification<br /></span> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;till&#0160;docmanager-document-lock-mode-will-change<br /></span> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/=</span>&#0160;g-unerased-objects&#0160;nil<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-unerased-objects<br />&#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">append</span>&#0160;g-unerased-objects&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-unerased-objects&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span><br /> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;docmanager-document-lock-mode-will-change<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span>reactor-object&#0160;parameter-list&#0160;<span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;command-name&#0160;<span style="color: #ff0000;">(</span>cadr&#0160;<span style="color: #ff0000;">(</span>cdddr&#0160;parameter-list<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;we&#0160;only&#0160;check&#0160;in&#0160;case&#0160;of&#0160;command-ended&#0160;event<br /></span> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;i.e.&#0160;command&#0160;name&#0160;starts&#0160;with&#0160;#<br /></span> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">and</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">=</span>&#0160;<span style="color: #ff0000;">(</span>substr&#0160;command-name&#0160;<span style="color: #008000;">1</span>&#0160;<span style="color: #008000;">1</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff00ff;">&quot;#&quot;</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">&gt;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strlen</span>&#0160;command-name<span style="color: #ff0000;">)</span>&#0160;<span style="color: #008000;">1</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">foreach</span>&#0160;erased-object&#0160;g-erased-objects<br /> <span style="color: #ff0000;">&#0160; &#0160; &#0160; &#0160; (</span><span style="color: #0000ff;">progn</span><br />&#0160; &#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owner-remove</span>&#0160;g-pers-reactor&#0160;erased-object<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owner-add</span>&#0160;g-dustbin-reactor&#0160;erased-object<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">&#0160; &#0160; &#0160; &#0160; )</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;progn<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;foreach<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-erased-objects&#0160;nil<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">foreach</span>&#0160;unerased-object&#0160;g-unerased-objects<br /> <span style="color: #ff0000;">&#0160; &#0160; &#0160; &#0160; (</span><span style="color: #0000ff;">progn</span><br />&#0160; &#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owner-remove</span>&#0160;g-dustbin-reactor&#0160;unerased-object<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owner-add</span>&#0160;g-pers-reactor&#0160;unerased-object<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">&#0160; &#0160; &#0160; &#0160; )</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;progn<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;foreach&#0160;<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;g-unerased-objects&#0160;nil<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;progn<br /></span> &#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;if&#0160;<br /></span> <span style="color: #ff0000;">)</span><br /> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;MAIN&#0160;FUNCTION&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;c:startReactor&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span>&#0160;circle&#0160;reactor<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span>&#0160;<br /><span style="color: #ff0000;">&#0160; &#0160; (</span><span style="color: #0000ff;">entsel</span>&#0160;<span style="color: #ff00ff;">&quot;\nSelect&#0160;a&#0160;circle&#0160;to&#0160;add&#0160;persistent&#0160;reactor&#0160;to:&#0160;&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-ename-</span>&gt;vla-object&#0160;circle<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> g-pers-reactor<br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-object-reactor</span><br />&#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;circle<span style="color: #ff0000;">)</span> <span style="background-color: #e6e6e6; color: #800080;">;&#0160;objects<br /></span>&#0160; &#0160; &#0160;&#0160;<span style="color: #0000ff;">nil</span> <span style="background-color: #e6e6e6; color: #800080;">;&#0160;reactor&#0160;data<br /></span>&#0160; &#0160; &#0160; &#39;<span style="color: #ff0000;">(</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-modified</span>&#0160;.&#0160;pers-modified<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-erased</span>&#0160;.&#0160;pers-objectRemoved<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-unappended</span>&#0160;.&#0160;pers-objectRemoved<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;<span style="color: #ff0000;">)</span><br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers</span>&#0160;g-pers-reactor<span style="color: #ff0000;">)</span><br /> <br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> g-dustbin-reactor<br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-object-reactor</span><br />&#0160; &#0160; &#0160; <span style="color: #0000ff;">nil</span><br />&#0160; &#0160; &#0160; <span style="color: #0000ff;">nil</span><br />&#0160; &#0160; &#0160; &#39;<span style="color: #ff0000;">(</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-unerased</span>&#0160;.&#0160;dustbin-objectAdded<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-reappended</span>&#0160;.&#0160;dustbin-objectAdded<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;<span style="color: #ff0000;">)</span><br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> <br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> reactor<br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-docmanager-reactor</span><br />&#0160; &#0160; &#0160; <span style="color: #0000ff;">nil</span><br />&#0160; &#0160; &#0160; &#39;<span style="color: #ff0000;">(</span><br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-documentLockModeWillChange</span><br />&#0160; &#0160; &#0160; &#0160; &#0160;.<br />&#0160; &#0160; &#0160; &#0160; &#0160;docmanager-document-lock-mode-will-change<br />&#0160; &#0160; &#0160; &#0160;&#0160;<span style="color: #ff0000;">)</span><br />&#0160; &#0160; &#0160; &#0160;<span style="color: #ff0000;">)</span><br />&#0160; &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;JUST&#0160;FOR&#0160;TESTING&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;c:get-pers-owners&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owners</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers-list</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span></span></p>
<p><strong>2. If there is a separate reactor for each entity</strong></p>
<p>In this case things are easier, because you can just use (vlr-pers-release) on the reactor that is associated with the given entity when it gets erased or unappended, hereby making the reactor transient. If a reactor is transient it is not saved in the drawing. Unlike the act of modifying the list of objects associated with a given reactor, this operation is logged in the undo buffer, so if the user clicks UNDO after erasing the entity, then the (vlr-pers-release) operation will be undone as well.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;PERSISTENT&#0160;REACTOR&#0160;PART&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;the&#0160;objectModified&#0160;handler&#0160;prints&#0160;some&#0160;info&#0160;about&#0160;the&#0160;circle<br /></span></span> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;pers-modified&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object&#0160;parameter-list<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">cond</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-read-enabled-p</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-property-available-p</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;notifier-object<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff00ff;">&quot;Radius&quot;</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;The&#0160;radius&#0160;is&#0160;&quot;</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-get-radius</span>&#0160;notifier-object<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;cond<br /></span> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;handles&#0160;objectUnAppended&#0160;and&#0160;objectErased<br /></span></span> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;pers-objectRemoved&#0160;<span style="color: #ff0000;">(</span>notifier-object&#0160;reactor-object<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;parameter-list<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers-release</span>&#0160;reactor-object<span style="color: #ff0000;">)</span> &#0160;&#0160;<br /> <span style="color: #ff0000;">)</span><br /> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;MAIN&#0160;FUNCTION&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;c:startReactor&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span>&#0160;pers-reactor&#0160;circle<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span>&#0160;<br /><span style="color: #ff0000;">&#0160; &#0160; (</span><span style="color: #0000ff;">entsel</span>&#0160;<span style="color: #ff00ff;">&quot;\nSelect&#0160;a&#0160;circle&#0160;to&#0160;add&#0160;persistent&#0160;reactor&#0160;to:&#0160;&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;circle&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-ename-</span>&gt;vla-object&#0160;circle<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;pers-reactor<br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-object-reactor</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">list</span>&#0160;circle<span style="color: #ff0000;">)</span> <span style="background-color: #e6e6e6; color: #800080;">;&#0160;objects<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #0000ff;">nil</span> <span style="background-color: #e6e6e6; color: #800080;">;&#0160;reactor&#0160;data<br /></span> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#39;<span style="color: #ff0000;">(</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-modified</span>&#0160;.&#0160;pers-modified<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-erased</span>&#0160;.&#0160;pers-objectRemoved<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-unappended</span>&#0160;.&#0160;pers-objectRemoved<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers</span>&#0160;pers-reactor<span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;_&#0160;defun<br /></span> <br /> <span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;;&#0160;JUST&#0160;FOR&#0160;TESTING&#0160;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br /></span></span> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;c:get-pers-owners&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-owners</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-pers-list</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span><br /> <span style="color: #ff0000;">)</span></span></p>
