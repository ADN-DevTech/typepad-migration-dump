---
layout: "post"
title: "How to programmatically mimic the vpoint command?"
date: "2012-08-28 03:29:41"
author: "Xiaodong Liang"
categories:
  - "AutoCAD"
  - "ObjectARX"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/how-to-programmatically-mimic-the-vpoint-command.html "
typepad_basename: "how-to-programmatically-mimic-the-vpoint-command"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p><b>Issue</b></p>  <p>I use the following code to change the view:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">&#160; ads_point pt = {1,1,1};</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; acedCommand(RTSTR, </span><span style="line-height: 140%; color: #a31515">&quot;vpoint&quot;</span><span style="line-height: 140%">, RTSTR, </span><span style="line-height: 140%; color: #a31515">&quot;non&quot;</span><span style="line-height: 140%">, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; RT3DPOINT, pt, RTNONE);</span></p>    <p style="margin: 0px"><span style="line-height: 140%"></span></p> </div>  <br />Why doesn't the following ARX code change the view?  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">AcDbViewportTable *pTable;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">acdbHostApplicationServices()-&gt;workingDatabase()-&gt;getViewportTable(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; pTable,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; AcDb::kForRead));&#160;&#160;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">AcDbViewportTableRecord *pRecord;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">pTable-&gt;getAt(</span><span style="line-height: 140%; color: #a31515">&quot;*ACTIVE&quot;</span><span style="line-height: 140%">, pRecord, AcDb::kForWrite);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">AcGeVector3d direction(1, 1, 1);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">pRecord-&gt;setViewDirection(direction);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">pRecord-&gt;close();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">pTable-&gt;close();</span></p> </div>  <p></p> <strong>Solution</strong>  <br />  <p>When using ARXDBG to check the result of your code, the viewdir is changed for the active viewport table record. Note that viewdir system variable is not changed and the actual view does not change, either.</p>  <p>What you can do is to set up a AcDbViewTableRecord object, then use acedSetCurrentView() to set the current view according to the object's settings.</p>  <p>The following code mimics what the VPOINT command does:</p>  <p>&#160;</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> simulateVpointCmd()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcDbViewportTableRecordPointer pRecord(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; acedActiveViewportId(),AcDb::kForWrite );</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; Acad::ErrorStatus es = pRecord.openStatus();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; assert(es == Acad::eOk);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; pRecord-&gt;setViewDirection(AcGeVector3d(1,1,1));</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcDbViewTableRecord vtr;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setBackClipDistance(pRecord-&gt;backClipDistance());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setBackClipEnabled(pRecord-&gt;backClipEnabled());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setElevation(pRecord-&gt;elevation());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setFrontClipAtEye(pRecord-&gt;frontClipAtEye());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setFrontClipDistance(pRecord-&gt;frontClipDistance());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setLensLength(pRecord-&gt;lensLength());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setPerspectiveEnabled(pRecord-&gt;perspectiveEnabled());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setRenderMode(pRecord-&gt;renderMode());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setTarget(pRecord-&gt;target());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setUcs(pRecord-&gt;ucsName());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setViewDirection(pRecord-&gt;viewDirection());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// viewtwist in vpoint is always 0</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// if you set it correctly, you can't get a result</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// that is similar to vpoint's</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setViewTwist(pRecord-&gt;viewTwist());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setCenterPoint(pRecord-&gt;centerPoint());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setHeight(pRecord-&gt;height());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; vtr.setWidth(pRecord-&gt;width());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; acedSetCurrentView(&amp;vtr, NULL); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// this is tweaking it to make it look like the result of vpoint cmd</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; acedCommand(RTSTR, L</span><span style="line-height: 140%; color: #a31515">&quot;zoom&quot;</span><span style="line-height: 140%">, RTSTR, L</span><span style="line-height: 140%; color: #a31515">&quot;extents&quot;</span><span style="line-height: 140%">, RTNONE);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
