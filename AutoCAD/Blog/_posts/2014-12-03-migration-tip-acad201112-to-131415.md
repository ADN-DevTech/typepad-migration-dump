---
layout: "post"
title: "Migration Tip : ACAD2011\\12 to 13\\14\\15"
date: "2014-12-03 03:52:28"
author: "Madhukar Moogala"
categories: []
original_url: "https://adndevblog.typepad.com/autocad/2014/12/migration-tip-acad201112-to-131415.html "
typepad_basename: "migration-tip-acad201112-to-131415"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/Madhukar-Moogala.html" target="_self">Madhukar Moogala</a></p>  <p>This tip is not purely on ACAD per se ,but from Visual Studio perspective and will be helpful for guys who are using VS template CMap where on its key is AcDbHandle&amp;</p>  <p>CMap&lt;AcDbHandle, AcDbHandle&amp;, CString, CString&gt; handleMap; </p>  <p>I recently received a case query where customer is getting this compilation error <strong>C2440: &#39;type cast&#39; : cannot convert from &#39;AcDbHandle&#39; to &#39;long&#39; ,</strong>which is working fine VS 90.0 compiler but failing in VS 100.0\110.0 , after investigating it is found that the&#0160; default implementation of </p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">template</span>&lt;<span style="color: blue">class</span> ARG_KEY&gt;</p>    <p style="margin: 0px">AFX_INLINE UINT AFXAPI HashKey(ARG_KEY key)</p>    <p style="margin: 0px"></p> </div>  <p>is changed in one of the atlmfc includes Afxtempl.h, the new definition is not allowing the type conversion, so we have two options either to understand new definition&#0160; <img alt="Disappointed smile" class="wlEmoticon wlEmoticon-disappointedsmile" src="/assets/image_10291.jpg" style="border-top-style: none; border-left-style: none; border-bottom-style: none; border-right-style: none" /> ,which I didn’t get completely so expecting some expert opinion or to override HashKey template to suit to our need. </p>  <p>Here I’m going with the second option ,to override HashKey template.</p>  <p>You can incorporate the following definition in your DLLMain file to avoid type conversion error.</p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">template</span>&lt;&gt;</p>    <p style="margin: 0px"><span style="color: #6f008a">AFX_INLINE</span> <span style="color: #2b91af">UINT</span> <span style="color: #6f008a">AFXAPI</span> HashKey&lt;<span style="color: #2b91af">AcDbHandle</span>&amp;&gt;(<span style="color: #2b91af">AcDbHandle</span>&amp; <span style="color: gray">key</span>)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px"><span style="color: green">// default identity hash - works for most primitive values</span></p>    <p style="margin: 0px"><span style="color: blue">return</span> (<span style="color: #2b91af">DWORD</span>)(((<span style="color: #2b91af">DWORD_PTR</span>)<span style="color: gray">key</span>)&gt;&gt;4);</p>    <p style="margin: 0px">&#0160;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px"></p>    <p style="margin: 0px"></p> </div>  <p>You are welcome for comments and insights , I’m no expert on this ,I’m learning with you <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="/assets/image_383248.jpg" style="border-top-style: none; border-left-style: none; border-bottom-style: none; border-right-style: none" /></p>
