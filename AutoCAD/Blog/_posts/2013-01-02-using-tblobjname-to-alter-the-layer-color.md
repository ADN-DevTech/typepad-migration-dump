---
layout: "post"
title: "Using tblobjname to alter the layer color"
date: "2013-01-02 03:45:00"
author: "Xiaodong Liang"
categories:
  - "AutoCAD"
  - "LISP"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/using-tblobjname-to-alter-the-layer-color.html "
typepad_basename: "using-tblobjname-to-alter-the-layer-color"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p><strong>Issue      <br /></strong>I&#39;m trying to use entmod to update the color of a layer, but I cannot get this code to work:</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> WrongChgLyrClr <span style="color: #ff0000;">(</span>laynme layclr <span style="color: #0000ff;">/</span> tb3 tb4<span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>tblsearch <span style="color: #ff00ff;">&quot;LAYER&quot;</span> laynme<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> tb3 <span style="color: #ff0000;">(</span>tblsearch <span style="color: #ff00ff;">&quot;LAYER&quot;</span> laynme<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> tb4 <span style="color: #ff0000;">(</span>subst <span style="color: #ff0000;">(</span>cons <span style="color: #008000;">62</span> layclr<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">assoc</span> &#39;62 tb3<span style="color: #ff0000;">)</span> tb3<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>entmod tb4<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer Color Updated to: &quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">itoa</span> layclr<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer Color Was NOT Updated.&quot;</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer: &quot;</span>&#0160;<span style="color: #ff00ff;">&quot; was NOT found !&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160; <span style="color: #ff0000;">)</span>       <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">)</span>       <br /><span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #ff0000;">(</span>WrongChgLyrClr <span style="color: #ff00ff;">&quot;CIRCLES&quot;</span>&#0160;<span style="color: #008000;">4</span><span style="color: #ff0000;">)</span></span></span></p>
<p>What am I doing wrong ?</p>
<p><strong>Solution      <br /></strong>In order to update the color assigned to a layer you&#39;ll need to use the entity list obtained from the entity name returned by the (tblobjname) function, and not the list returned by the tblsearch or tblnext functions. The entmod function will only update the layer with the entity list obtained via the tblobjname entity.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> ChgLyrClr <span style="color: #ff0000;">(</span>laynme layclr <span style="color: #0000ff;">/</span> tb3 tb4<span style="color: #ff0000;">)</span>      <br />&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>tblsearch <span style="color: #ff00ff;">&quot;LAYER&quot;</span> laynme<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> tb3 <span style="color: #ff0000;">(</span><span style="color: #0000ff;">entget</span>&#0160;<span style="color: #ff0000;">(</span>tblobjname <span style="color: #ff00ff;">&quot;LAYER&quot;</span> laynme<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> tb4 <span style="color: #ff0000;">(</span>subst <span style="color: #ff0000;">(</span>cons <span style="color: #008000;">62</span> layclr<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">assoc</span> &#39;62 tb3<span style="color: #ff0000;">)</span> tb3<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>entmod tb4<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer Color Updated to: &quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">itoa</span> layclr<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer Color Was NOT Updated.&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;\nLayer: &quot;</span>&#0160;<span style="color: #ff00ff;">&quot; was NOT found !&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br /><span style="background-color: #e6e6e6; color: #800080;">; <span style="color: #ff0000;">(</span>ChgLyrClr <span style="color: #ff00ff;">&quot;CIRCLES&quot;</span>&#0160;<span style="color: #008000;">7</span><span style="color: #ff0000;">)</span>        <br /></span><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nChgLyrClr loaded, type <span style="color: #ff0000;">(</span>ChgLyrClr \&quot;</span>ALayerName\<span style="color: #ff00ff;">&quot; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> aLayerColor <span style="color: #008000;">7</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>        <br />to run.&quot;</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span></span></p>
