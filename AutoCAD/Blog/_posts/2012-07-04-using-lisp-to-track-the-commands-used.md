---
layout: "post"
title: "Using LISP to track the commands used"
date: "2012-07-04 12:25:00"
author: "Adam Nagy"
categories:
  - "Adam Nagy"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2012/07/using-lisp-to-track-the-commands-used.html "
typepad_basename: "using-lisp-to-track-the-commands-used"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>
<p>I&#39;m programming in LISP and now would like to track how many commands are being used within an AutoCAD session. How could I do it?</p>
<p><strong>Solution</strong></p>
<p>You can find samples about reactors in the LISP Help file, but here is the exact code you would need.</p>
<p>In this case we&#39;ll only track commands that actually ended, not including commands that got started and then cancelled - i.e. editor reactorâ€™s commandEnded</p>
<p>When the document is closed we pop up a dialog showing how many commands were used in it since it got opened.</p>
<p>You would need to set up acaddoc.lsp so that it runs the following code for each opened document:</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;editor-beginClose&#0160;<span style="color: #ff0000;">(</span>reactor-object&#0160;parameter-list&#0160;<span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;instead&#0160;of&#0160;an&#0160;alert&#0160;box&#0160;write&#0160;the&#0160;data&#0160;somewhere</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;Command&#0160;count&#0160;is&#0160;&quot;</span>&#0160;<span style="color: #ff0000;">(</span>itoa&#0160;*command-count*<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<br /> <span style="color: #ff0000;">)</span>&#0160;<br /> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;editor-commandEnded&#0160;<span style="color: #ff0000;">(</span>reactor-object&#0160;parameter-list&#0160;<span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;*command-count*&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">1+</span>&#0160;*command-count*<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<br /> <span style="color: #ff0000;">)</span>&#0160;<br /> <br /> <span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span>&#0160;StartWatching&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;we&#0160;need&#0160;the&#0160;ActiveX&#0160;system&#0160;for&#0160;this</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;set&#0160;the&#0160;counter</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span>&#0160;*command-count*&#0160;<span style="color: #008000;">0</span><span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;start&#0160;the&#0160;event&#0160;watcher</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlr-editor-reactor&#0160;nil</span>&#0160;&#39;<span style="color: #ff0000;">(</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-beginClose</span>&#0160;.&#0160;editor-beginClose<span style="color: #ff0000;">)</span><br /> &#0160;&#0160;&#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">:vlr-commandEnded</span>&#0160;.&#0160;editor-commandEnded<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><br /> &#0160;&#0160;<span style="color: #ff0000;">)</span>&#0160;<br /> &#0160;&#0160;<span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;don&#39;t&#0160;print&#0160;anything&#0160;to&#0160;the&#0160;screen</span>&#0160;<br /> &#0160;&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>&#0160;<br /> <span style="color: #ff0000;">)</span>&#0160;<br /> <br /> <span style="background-color: #e6e6e6; color: #7f007f;">;&#0160;this&#0160;should&#0160;be&#0160;started&#0160;for&#0160;each&#0160;opened&#0160;drawing</span>&#0160;<br /> <span style="color: #ff0000;">(</span>StartWatching<span style="color: #ff0000;">)</span></span></p>
