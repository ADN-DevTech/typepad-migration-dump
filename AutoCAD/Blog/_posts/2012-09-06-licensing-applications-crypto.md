---
layout: "post"
title: "Licensing applications: Crypto"
date: "2012-09-06 17:38:09"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/09/licensing-applications-crypto.html "
typepad_basename: "licensing-applications-crypto"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>This series of articles will show how to use tools available on the market to control licensing of plug-ins for Autodesk products. This is important to most commercial developers and if you are developing for the <a href="http://apps.exchange.autodesk.com/">Autodesk Exchange Store</a>, you noticed that no license system is provided, only a payment method. We’re not testing, validating or certifying the protection system and how hard it’s to (or not to) break it. </p>  <p>For this demonstration, we’ll use a .NET plug-in developed for AutoCAD, but the same idea can be applied to other .NET based APIs, like Revit and Inventor. Most of the code came from the samples available with the tool.</p>  <p>Here will be shown the <a href="http://www.ssware.com/cryptolicensing/cryptolicensing_net.htm" target="_blank">Crypto Licensing for .NET</a>, winning of the <a href="http://www.codeproject.com/PressReleases/5777/CODEPROJECT-ANNOUNCES-FOURTH-ANNUAL-MEMBERS-CHOICE.aspx" target="_blank">2012</a> Members Choice of the <a href="http://www.codeproject.com" target="_blank">Code Project</a> development resource site. This tool is available for trial during 30 days and the prices start at $149 US dollars.</p>  <p>Between benefits:</p>  <ul>   <li>just a few lines of code added to any command on the plug-in, as will be shown on the sample; </li>    <li>single .NET reference required that will enable all license features; </li>    <li>supports obfuscation, although this feature is not included, but they offer a tool called <a href="http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm" target="_blank">Crypto Obsfucator for .NET</a> starting at $149. </li>    <li>support trial, mandatory feature for <a href="http://usa.autodesk.com/adsk/servlet/item?siteID=123112&amp;id=17183450">Autodesk Exchange Store</a>, where every plug-in must immediately work after downloaded; </li>    <li>serial or license code feature; </li>    <li>authentication can be done online; </li> </ul>  <p>Of course, for AutoCAD environment, some cons: </p>  <ul>   <li>the solution is .NET based and therefore will only work for Windows platform; </li>    <li>requires reference to Windows Form, which can affect AutoCAD console; </li> </ul>  <p>To test the Crypto solution, download it from <a href="http://www.ssware.com/cryptolicensing/cryptolicensing_net.htm">here</a>. After install it, launch it, the default new project will have the option to create a new validation key, like described on the image below.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3be04b94970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="validation_key" border="0" alt="validation_key" src="/assets/image_784682.jpg" width="486" height="369" /></a></p>  <p>The validation key will be used on the code below, which was based on the sample available at the <em><u>C:\Program Files (x86)\LogicNP Software\CryptoLicensing For .Net 2012\Samples\C#\AppLicensing</u></em> folder. On the code, the <strong>CryptoLicense</strong> object have a <strong>ValidationKey</strong> property that will receive the value obtained above.</p>  <p>The next step is to create a <strong>LicenseCode</strong> that will go embed on the code. On this case, let’s set it to run up to 5 days after first run. To create this code, select the number of days, as described on 1 at the image below. Then click on <em>Generate</em>, as shown on 2 and then finally get the code on 3.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c31b1b47b970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="license_code" border="0" alt="license_code" src="/assets/image_298014.jpg" width="485" height="459" /></a></p>  <p>Finally place the validation key and license code at the code, like shown at the sample code below. Compile and NETLOAD on AutoCAD.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> System;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> System.Collections.Generic;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> System.Linq;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> System.Text;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// Crypto licensing namespace</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> LogicNP.CryptoLicensing;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">// AutoCAD namespaces</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.Runtime;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.ApplicationServices;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.EditorInput;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">namespace</font></font></span><font style="font-size: 8pt" color="#000000"> AutoCAD_Crypto</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">public</font></span><font color="#000000"> </font><span><font color="#0000ff">class</font></span><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#2b91af">Commands</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">public</font></span><font color="#000000"> </font><span><font color="#0000ff">static</font></span><font color="#000000"> </font><span><font color="#0000ff">bool</font></span><font color="#000000"> Licensed</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#0000ff">get</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Create the object to check the license</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">CryptoLicense</font></span><font color="#000000"> license = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">CryptoLicense</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Get the validation key using Ctrl+K in the Generator UI.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; license.ValidationKey = </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;&quot;</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// The license will be loaded from/saved to the registry</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; license.StorageMode = </font></font><font style="font-size: 8pt"><span><font color="#2b91af">LicenseStorageMode</font></span><font color="#000000">.ToRegistry;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Load the license from the registry </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (!license.Load())</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// When app runs for first time, the load will</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// fail, so specify an evaluation code....</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// This license code was generated from the Generator</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// UI with a &quot;Limit Usage Days To&quot; setting to some days.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; license.LicenseCode = </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;&quot;</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Save it so that it will get loaded</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// the next time app runs</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; license.Save();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// ShowEvaluationInfoDialog shows the dialog only </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// if the license specifies evaluation limits </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">bool</font></span><font color="#000000"> licensed = license.ShowEvaluationInfoDialog(</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;AutoCAD_Crypto&quot;</font></span><font color="#000000">,</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;http://www.companyname.com/buy&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// it is possible check if the application</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// still in evaluation mode using the following code</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (license.IsEvaluationLicense())</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// Be sure to call Dispose when done </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// using the CryptoLicense object.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// The 'using' keywork is not a option</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// as this object do not implement IDisposable</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; license.Dispose();</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000"> licensed;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font><font style="font-size: 8pt"><span><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span><font color="#a31515">&quot;licensedTestPlugin&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">public</font></span><font color="#000000"> </font><span><font color="#0000ff">static</font></span><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> CmdMyTestCommand()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (!Licensed) </font><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// If is licensed, show a message</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Editor</font></span><font color="#000000"> ed = </font><span><font color="#2b91af">Application</font></span><font color="#000000">.DocumentManager.</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; MdiActiveDocument.Editor;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;\nI'm working now&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>  <p>Once we NETLOD and run the command, will show a warning like below. Notice that it still showing ‘30 days of trial’, but this is because I’m using the trial version of Crypton solution.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017d3be04bf0970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="evaluation_info_dialog" border="0" alt="evaluation_info_dialog" src="/assets/image_830434.jpg" width="478" height="344" /></a></p>  <p>As the trial version do not allow generate other types of code, I will stop here, but if the user clicks on ‘Enter License’ button, it’ll prompt for another license key that can be generated like the before, but specifying another usage restriction.</p>  <p>The ‘Purchase’ button will open the URL specified on the code, which is the website where the user can buy the application.</p>  <p>Have used this solution before? Have used any other solution? Please share your experience, we can create an article on it. </p>  <p>Next article will discuss the IntelliProtector, as suggested on <a href="http://adndevblog.typepad.com/autocad/2012/08/licensing-applications-infralution.html#comment-6a0167607c2431970b0176173738a6970c">this comment</a>.</p>
