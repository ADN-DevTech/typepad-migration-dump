---
layout: "post"
title: "Setting the command flags of my .NET application's commands dynamically"
date: "2012-05-28 11:07:18"
author: "Adam Nagy"
categories:
  - ".NET"
  - "Adam Nagy"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/setting-the-command-flags-of-my-net-applications-commands-dynamically.html "
typepad_basename: "setting-the-command-flags-of-my-net-applications-commands-dynamically"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/adam-nagy.html" target="_self">Adam Nagy</a></p>  <p>I have a .NET application for AutoCAD and I would like to set the command flags in it dynamically. Is this possible?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>You need to get the command stack and call its functions in order to change the command flags of registered commands.</p>  <p>This only seems possible using ObjectARX.    <br />You could also create a COM server ARX AddIn or a managed wrapper for this functionality that could be called to do the command stack modifications.</p>  <p>In .NET I have this command - as you can see <b>CommandFlags.UsePickSet</b> is not added to the <b>CommandMethod</b> attribute:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">[CommandMethod(</span><span style="line-height: 140%; color: #a31515">&quot;TestGroup&quot;</span><span style="line-height: 140%">, </span><span style="line-height: 140%; color: #a31515">&quot;TestCommand&quot;</span><span style="line-height: 140%">, CommandFlags.Modal)]</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> test()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; Document doc = Application.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; Editor ed = doc.Editor;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">try</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; PromptSelectionResult psr = ed.SelectImplied();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; ed.WriteMessage(</span><span style="line-height: 140%; color: #a31515">&quot;No. of selected objects = &quot;</span><span style="line-height: 140%"> + </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; psr.Value.Count.ToString());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">catch</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; ed.WriteMessage(</span><span style="line-height: 140%; color: #a31515">&quot;Error in TestCommand&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>  <p>I select a couple of entities on the screen and then call <b>TestCommand</b>, but it returns an error message for the pickfirst set is not available for it.</p>  <p>Then I run the command defined in my ARX module to change the command flags:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">static</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%"> ArxDynamicCommandFlag_SetCommandFlags(</span><span style="line-height: 140%; color: blue">void</span><span style="line-height: 140%">)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcEdCommandStack* pCmdStack = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; AcEdCommandStack::cast(acrxSysRegistry()-&gt;at(ACRX_COMMAND_DOCK)); </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcEdCommand *pCmd = pCmdStack-&gt;lookupGlobalCmd(L</span><span style="line-height: 140%; color: #a31515">&quot;TestCommand&quot;</span><span style="line-height: 140%">);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; AcRxFunctionPtr pFunc = pCmd-&gt;functionAddr();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ACHAR localName[31], globalName[31], groupName[31] = L</span><span style="line-height: 140%; color: #a31515">&quot;TestGroup&quot;</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; _tcscpy(localName, pCmd-&gt;localName());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; _tcscpy(globalName, pCmd-&gt;globalName());</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; Acad::ErrorStatus errCode;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; errCode = pCmdStack-&gt;removeCmd(groupName, globalName);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; errCode = pCmdStack-&gt;addCommand(groupName, globalName, localName, </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; ACRX_CMD_USEPICKSET, pFunc);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">}</span></p>    <p style="margin: 0px"></p> </div>  <p>Now, when I select a couple of entities and run <b>TestCommand</b> again, then it prints out the number of selected entities alright.</p>
