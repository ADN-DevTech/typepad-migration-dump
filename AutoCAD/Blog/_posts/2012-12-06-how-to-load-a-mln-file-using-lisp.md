---
layout: "post"
title: "How to load a .MLN file using LISP"
date: "2012-12-06 11:30:51"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/how-to-load-a-mln-file-using-lisp.html "
typepad_basename: "how-to-load-a-mln-file-using-lisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>There isn't a ready-to-use API function that loads a .MLN file in Lisp, VBA and ARX. Normally you can do this only by using the MLSTYLE dialog.</p>  <p>Of course, it's possible to create the dictionary entry of a multiline style definition programmatically with either API. The following code shows how to read the .MLN file in Lisp and how to create the MLINESTYLE objects defined in it.</p>  <p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt"><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> c:LoadMlStyles <span style="color: #ff0000">(</span><span style="color: #0000ff">/</span> mlFileName<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> mlFileName <span style="color: #ff0000">(</span><span style="color: #0000ff">getstring</span>&#160;<span style="color: #ff00ff">&quot;\nEnter MLN file name: &quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= nil mlFileName<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>LoadMln mlFileName<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br />      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> LoadMln <span style="color: #ff0000">(</span>mlnFile <span style="color: #0000ff">/</span> f mlineDict same newStyle xName<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> mlnFile <span style="color: #ff0000">(</span>findfile mlnFile<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> f <span style="color: #ff0000">(</span>open mlnFile <span style="color: #ff00ff">&quot;r&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> f <span style="color: #ff0000">(</span>open mlnFile <span style="color: #ff00ff">&quot;r&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>        <br /></span>&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>= NIL f<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span>&#160;<span style="color: #ff00ff">&quot;\nInvalid MLN file.\n&quot;</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Get the MLINESTLYE dictionary.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> mlineDict <span style="color: #ff0000">(</span>dictsearch      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>namedobjdict<span style="color: #ff0000">)</span>&#160;<span style="color: #ff00ff">&quot;ACAD_MLINESTYLE&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Create the beginning of an MLINESTYLE object.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> same <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span>cons <span style="color: #008000">0</span>&#160;<span style="color: #ff00ff">&quot;MLINESTYLE&quot;</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;<span style="color: #ff0000">(</span>cons <span style="color: #008000">102</span>&#160;<span style="color: #ff00ff">&quot;{ACAD_REACTORS&quot;</span><span style="color: #ff0000">)</span>        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;<span style="color: #ff0000">(</span>cons <span style="color: #008000">330</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span> -1 mlineDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;<span style="color: #ff0000">(</span>cons <span style="color: #008000">102</span>&#160;<span style="color: #ff00ff">&quot;}&quot;</span><span style="color: #ff0000">)</span>        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;<span style="color: #ff0000">(</span>cons <span style="color: #008000">330</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span> -1 mlineDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>cons <span style="color: #008000">100</span>&#160;<span style="color: #ff00ff">&quot;AcDbMlineStyle&quot;</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Read the data of the MLINESTYLE       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;;       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">while</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= nil <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> mlStyle <span style="color: #ff0000">(</span>ReadObject f<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Create the complete MLINESTYLE object.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> newStyle <span style="color: #ff0000">(</span>append same mlStyle<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; xName&#160;&#160;&#160; <span style="color: #ff0000">(</span>entmakex newStyle<span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Append it to the MLINESTYLE dictionary.       <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>dictadd <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span> -1 mlineDict<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">cdr</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">assoc</span>&#160;<span style="color: #008000">2</span> newStyle<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; xName      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span>close f<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br />      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> ReadObject <span style="color: #ff0000">(</span>f <span style="color: #0000ff">/</span> ObjectList firstLine code value<span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> ObjectList nil<span style="color: #ff0000">)</span>      <br />&#160; <span style="background-color: #e6e6e6; color: #800080">;; Skip the 'MLSTYLE'.       <br /></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> firstLine <span style="color: #ff0000">(</span><span style="color: #0000ff">read</span>-line f<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= nil firstLine<span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>      <br />&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">while</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">/</span>= <span style="color: #008000">0</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> code <span style="color: #ff0000">(</span>atoi <span style="color: #ff0000">(</span><span style="color: #0000ff">read</span>-line f<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> value <span style="color: #ff0000">(</span><span style="color: #0000ff">vl-string-trim</span>&#160;<span style="color: #ff00ff">&quot; &quot;</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">read</span>-line f<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>or <span style="color: #ff0000">(</span>= code <span style="color: #008000">2</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>= code <span style="color: #008000">3</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>= code <span style="color: #008000">6</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> ObjectList <span style="color: #ff0000">(</span>append ObjectList      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span>cons code value<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>or <span style="color: #ff0000">(</span>= code <span style="color: #008000">70</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>= code <span style="color: #008000">62</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>= code <span style="color: #008000">71</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> ObjectList <span style="color: #ff0000">(</span>append ObjectList      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span>cons code <span style="color: #ff0000">(</span>atoi value<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>or <span style="color: #ff0000">(</span>= code <span style="color: #008000">51</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>= code <span style="color: #008000">52</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="background-color: #e6e6e6; color: #800080">;; Code <span style="color: #008000">51</span> and <span style="color: #008000">52</span> must be converted into degrees.        <br /></span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> ObjectList&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>append ObjectList&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span>cons code&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>angtof value <span style="color: #008000">0</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>= code <span style="color: #008000">49</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> ObjectList&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt"><span style="color: #ff0000">(</span>append ObjectList      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span>list <span style="color: #ff0000">(</span>cons code <span style="color: #ff0000">(</span>atof value<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; ObjectList      <br /><span style="color: #ff0000">)</span></span></p>  <p>You can load a .MLN file from the AutoCAD command line by using the LOADMLSTYLES command. This command asks for the MLN file name. If you want to call this function from Lisp, you can use the (LOADMLN) function. There you can specify the MLN file name.</p>  <p>Once you've loaded a .MLN file, you can set the AutoCAD variable CMLSTYLE to one of the loaded styles, so the next created MLINE will use the style.</p>
