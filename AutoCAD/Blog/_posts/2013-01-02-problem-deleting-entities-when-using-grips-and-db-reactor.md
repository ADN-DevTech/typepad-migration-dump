---
layout: "post"
title: "Problem deleting entities when using grips and db reactor"
date: "2013-01-02 18:04:32"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "AutoCAD"
  - "Gopinath Taget"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/problem-deleting-entities-when-using-grips-and-db-reactor.html "
typepad_basename: "problem-deleting-entities-when-using-grips-and-db-reactor"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p>Problem scenario: You are using grips to modify entities that have database reactors attached to them in such a way that modifying them can cause other entities to be erased. Typically, you select several entities using grips, then modify one, causing the attached database reactor to delete one of the other selected entities. If you then try to pick any other selected entity, AutoCAD crashes. What could be going wrong and how can you work around this?</p>  <p>The root of the problem is that when using grips to modify objects, AutoCAD is creating an internal selection set that cannot be accessed or modified by the user called &quot;PICKFIRST&quot;. The problem you are having is that when you erase one of the entities that is in a selection set of many, the code returns, but the selection of the rest of the entities are still active, meaning that the PICKFIRST selection set is still active. So when you pick an entity's grip, AutoCAD tries to update the selection set that contains a deleted entity...crash. </p>  <p>The only way to remedy this is to clear the selection set by way of the internal CANCELCMD command. This should be done immediately after any entities are ever removed from the PICKFIRST selection set. The use of CANCELCMD is relatively benign, and will not affect your code flow. </p>  <p>The following is a simple example showing this remedy inside a database reactor handler:</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">extern</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> Adesk::Boolean acedPostCommand(</font></span><span style="line-height: 11pt"><font color="#0000ff">const</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> ACHAR*);</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">// global declaration required</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> DbTestReactor::modified(</font></span><span style="line-height: 11pt"><font color="#0000ff">const</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> AcDbObject* pDbObject) </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> ...</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> ...</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt"> pEntity-&gt;erase();</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Code to erase an entity </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt"> pEntity-&gt;close();</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Code to close the entity</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Code to cancel the internal selection set.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt"> acedPostCommand(L</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;CANCELCMD&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> ...</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p> </div>
