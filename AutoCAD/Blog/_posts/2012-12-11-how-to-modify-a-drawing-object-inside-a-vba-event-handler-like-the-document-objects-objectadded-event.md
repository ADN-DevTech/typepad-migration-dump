---
layout: "post"
title: "How to modify a drawing object inside a VBA event handler like the document object&rsquo;s ObjectAdded event"
date: "2012-12-11 17:46:07"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "ActiveX"
  - "AutoCAD"
  - "Gopinath Taget"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/how-to-modify-a-drawing-object-inside-a-vba-event-handler-like-the-document-objects-objectadded-event.html "
typepad_basename: "how-to-modify-a-drawing-object-inside-a-vba-event-handler-like-the-document-objects-objectadded-event"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p>Consider this: Using WithEvents in VB(A), you are trying to modify an object passed to the document's ObjectAdded, ObjectModified events, or drawing object's Modified event. However, this results in Error that look similar to this: &quot;Object was opened for read&quot; or similar. How can you work around this?</p>  <p>Firstly, modifying objects in events such as these is generally not recommended and not worth the trouble you might face later; especially if you are trying to modify objects that are already in the process of being modified. That is rarely a good idea.</p>  <p>However, if you absolutely need to modify objects in event handlers, there are some ways to achieve it.</p>  <p>ActiveX events are modeled on ObjectARX Event handling mechanism (reactors). There are many notifications when object is in an open state (for Read, Write or Notify) so in general, you cannot change it from within the event, evidenced by the fact for instance that the object is passed ByVal to the ObjectAdded event. You can however access any object for write in the CommandEnded event. So, you can set some global flags, trigger them in CommandStart, store ObjectIds during ObjectAdded and use the Ids in CommandEnded to change the relevant objects. For example, the code below will alter any line added to the document. This is the solution specific to VBA. For VB you have additional complexity of attaching events to docs (but that is a topic for another blog post).</p>  <p><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">Option Explicit</font></font></span></p>  <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Dim</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> cIDs </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">New</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Collection</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' collection for line IDs to be modified</font></span></font></p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Dim</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> bFlag </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Boolean</font></span><span style="line-height: 11pt"><font color="#000000">&#160;&#160; </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' flag to indicate when modification needed</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"></font></font></p>    <div style="font-family: ; background: white">     <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> AcadDocument_BeginCommand(</font></span><span style="line-height: 11pt"><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> CommandName </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">String</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)&#160;&#160;&#160; </font></span></font></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; ' Here we can set the flag ONLY for particular command.&#160; </font></font></span></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; ' For simplicity, set always in this sample&#160; </font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; bFlag = </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">True</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160; </font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">&#160; Call</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> ClearCollection(cIDs)</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'Just in case </font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; '(done already in EndCommand)</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>   </div> </div>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt"></font></font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> AcadDocument_ObjectAdded(</font></span><span style="line-height: 11pt"><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> Object </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Object</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">If</font></span><span style="line-height: 11pt"><font color="#000000"> bFlag </font></span><span style="line-height: 11pt"><font color="#0000ff">Then</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' If flag on and line - add the ID to the collection</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> obj </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> AcadObject&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; Set obj = </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Object</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">If</font></span><span style="line-height: 11pt"><font color="#000000"> obj.ObjectName = </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;AcDbLine&quot;</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Then</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cIDs.Add obj.ObjectID&#160;&#160;&#160; </font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>        <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> AcadDocument_EndCommand(</font></span><span style="line-height: 11pt"><font color="#0000ff">ByVal</font></span><span style="line-height: 11pt"><font color="#000000"> CommandName </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">String</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' Set all line start points to origin and color to magenta&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">If</font></span><span style="line-height: 11pt"><font color="#000000"> bFlag </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Then</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pntO(0 </font></span><span style="line-height: 11pt"><font color="#0000ff">To</font></span><span style="line-height: 11pt"><font color="#000000"> 2) </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Double</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pntO(0) = 0#: pntO(1) = 0#: pntO(2) = 0#&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> id </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Varian</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">t&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">For</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Each</font></span><span style="line-height: 11pt"><font color="#000000"> id </font></span><span style="line-height: 11pt"><font color="#0000ff">In</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> cIDs&#160;&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> line </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> AcadLine&#160;&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; Set line = ThisDrawing.ObjectIdToObject(id)&#160;&#160;&#160;&#160;&#160; </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; line.StartPoint = pntO&#160;&#160;&#160;&#160;&#160; </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; line.Color = acMagenta&#160;&#160;&#160; </font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Next</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> id&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' Reset flag and collection&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; bFlag = </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">False</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Call</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> ClearCollection(cIDs)&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">End</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">If</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt"></font></font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Sub</font></span><span style="line-height: 11pt"><font color="#000000"> ClearCollection(cCol </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#2b91af">Collection</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> iCnt </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">Long</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">For</font></span><span style="line-height: 11pt"><font color="#000000"> iCnt = 1 </font></span><span style="line-height: 11pt"><font color="#0000ff">To</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> cCol.Count&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; cCol.Remove 1 </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">' Since collections are reindexed </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'automatically, remove the first member&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Next</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> iCntEnd </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>
