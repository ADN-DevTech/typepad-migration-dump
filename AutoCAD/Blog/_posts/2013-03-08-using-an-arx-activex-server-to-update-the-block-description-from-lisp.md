---
layout: "post"
title: "Using an ARX ActiveX server to update the block description from LISP"
date: "2013-03-08 06:39:00"
author: "Xiaodong Liang"
categories:
  - "2013"
  - "AutoCAD"
  - "LISP"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2013/03/using-an-arx-activex-server-to-update-the-block-description-from-lisp.html "
typepad_basename: "using-an-arx-activex-server-to-update-the-block-description-from-lisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p><strong>Issue      <br /></strong>How can I update the Description Field in the Block Definition using lisp ? Using the Lisp entmod function does not seem to work.</p>
<p><a name="section2"></a></p>
<p><strong>Solution      <br /></strong>The only way to do this at present is to use the ActiveX server exposed in the adskUnSupp arx utility, the latest utility for AutoCAD 2013 is available at </p>
<h5><a href="http://adndevblog.typepad.com/autocad/2012/08/adn-autocad-utilities.html/">ADN AutoCAD Utilities</a></h5>
<p>With that ARX, and the following lisp code which loads the ARX module, connects to the ActiveX interface from adskUnSupp ARX, and loads it&#39;s type library to enable the Block Description Property to be set directly via a lisp function call.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="background-color: #e6e6e6; color: #800080;">;assume the utilities are installed at       <br /></span><span style="background-color: #e6e6e6; color: #800080;">; C:\Program Files\Autodesk\ADNUtilities2013_X64\AutoCADControls\       <br /></span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> RunAcadUnSupp <span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span> rtn <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>null <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> rtn <span style="color: #ff0000;">(</span>member <span style="color: #ff00ff;">&quot;AsdkUnsupp2013.arx&quot;</span>&#0160;<span style="color: #ff0000;">(</span>arx<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> rtn <span style="color: #ff0000;">(</span>arxload      <br /><span style="color: #ff00ff;">&quot;asdkunsupp2007.arx&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>null rtn<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nAsdkUnsupp2013.arx Not Loaded, Exiting.&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> AcadApp <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-get-acad-object</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;<span style="background-color: #e6e6e6; color: #800080;">;; Change the Path to adskUnSupp2007 here -&gt;         <br /></span></span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> unSupp_ARXPath <span style="color: #ff00ff;">&quot;C:\\Program Files\\Autodesk\\ADNUtilities2013_X64\\AutoCADControls\\\&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>null unsupM-AddAnonymousGroup<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>findfile <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> unSupp_ARXPath <span style="color: #ff00ff;">&quot;AsdkUnsupp2013.arx&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-import-type-library</span>      <br />&#0160;&#0160;&#0160;&#0160; :tlb-filename      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> unSupp_ARXPath <span style="color: #ff00ff;">&quot;AsdkUnsupp2013.arx&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; :methods-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;unsupM-&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160; :properties-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;unsupP-&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160; :constants-prefix      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;unsupC-&quot;</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">alert</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span>&#0160;<span style="color: #ff00ff;">&quot;Exiting - Can&#39;t find \&quot;</span>&quot; unSupp_ARXPath      <br /><span style="color: #ff00ff;">&quot;asdkunsupp2007.arx&quot;</span>&#0160;<span style="color: #ff00ff;">&quot;\&quot;</span>&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>exit<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> unSuppX <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-GetInterfaceObject</span> acadApp <span style="color: #ff00ff;">&quot;Asdkunsupp2007.Application.1&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> AcadDoc <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Get-ActiveDocument</span> AcadApp<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> UtilObj <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Get-Utility</span> AcadDoc<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> Blocks <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Get-Blocks</span> AcadDoc<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-GetEntity</span> UtilObj &#39;BlockRefObj &#39;selPt <span style="color: #ff00ff;">&quot;\nSelect a Inserted Block: &quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">equal</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> ObjType <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Get-ObjectName</span> BlockRefObj<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160; <span style="color: #ff00ff;">&quot;AcDbBlockReference&quot;</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> BlkName <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Get-Name</span> BlockRefObj<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> BlkObject <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-Item</span> Blocks BlkName<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> exBlkDescriptn <span style="color: #ff0000;">(</span>unsupP-Get-BlockDescription unSuppX BlkObject<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> aNewDescriptn <span style="color: #ff0000;">(</span>getString T <span style="color: #ff0000;">(</span><span style="color: #0000ff;">strcat</span> &quot;\nEnter New Block      <br />Description&lt;<span style="color: #ff00ff;">&quot; exBlkDescriptn &quot;</span>&gt;:<span style="color: #ff00ff;">&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>        <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span>&#0160;<span style="color: #ff0000;">(</span>and aNewDescriptn <span style="color: #ff0000;">(</span>not <span style="color: #ff0000;">(</span><span style="color: #0000ff;">equal</span> aNewDescriptn &quot;</span>&quot;<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">(</span>unsupP-Put-BlockDescription unSuppX BlkObject aNewDescriptn<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>&#0160; <br />&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span>CleanUpOnExit<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> CleanUpOnExit <span style="color: #ff0000;">(</span><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> BlockRefObj <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> BlockRefObj<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> BlockRefObj      <br />nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> Blocks <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> Blocks<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> Blocks nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> UtilObj <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> UtilObj<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> UtilObj nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> AcadDoc <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> AcadDoc<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> AcadDoc nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> unSuppX <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> unSuppX<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> unSuppX nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">if</span> AcadApp <span style="color: #ff0000;">(</span><span style="color: #0000ff;">progn</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vlax-Release-Object</span> AcadApp<span style="color: #ff0000;">)</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> AcadApp nil<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span>      <br />      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\nRunAcadUnSupp, CleanUpOnExit loaded, type <span style="color: #ff0000;">(</span>RunAcadUnSupp<span style="color: #ff0000;">)</span>, or        <br /><span style="color: #ff0000;">(</span>CleanUpOnExit<span style="color: #ff0000;">)</span> to run.&quot;</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span></span></p>
