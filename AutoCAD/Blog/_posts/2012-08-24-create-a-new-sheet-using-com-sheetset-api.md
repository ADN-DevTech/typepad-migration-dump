---
layout: "post"
title: "Create a new sheet using COM SheetSet API"
date: "2012-08-24 18:13:11"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "ActiveX"
  - "Augusto Goncalves"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/create-a-new-sheet-using-com-sheetset-api.html "
typepad_basename: "create-a-new-sheet-using-com-sheetset-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>
<p>This example will add a sheet to an existing Sheetset (DST file), on this sample <span style="text-decoration: underline;">c:\temp\test.dst</span>. The &quot;Sheet Creation Template&quot; property needs to be set on the sheetset for this example to work properly. The code uses .NET COM interoperability to program COM objects with .NET.</p>
<p><strong>Update</strong>: a reference to <span style="text-decoration: underline;">AcSmComponents Type Library</span> is required. Choose it at the COM tab of Visual Studio.</p>
<div style="background: white;">
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">[</span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">CommandMethod</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">&quot;testSheet&quot;</span></span><span style="color: #000000;">)]</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span><span style="color: #0000ff;"><span style="font-size: 8pt;">static</span></span></span><span style="font-size: 8pt;"><span style="color: #000000;"> </span><span><span style="color: #0000ff;">public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">void</span></span><span style="color: #000000;"> CmdTestSheet() </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">{</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">Editor</span></span><span style="color: #000000;"> ed = </span><span><span style="color: #2b91af;">Application</span></span><span style="color: #000000;">.DocumentManager.</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; MdiActiveDocument.Editor;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">string</span></span><span style="color: #000000;"> dstFile = </span><span><span style="color: #a31515;">&quot;C:\\temp\\test.dst&quot;</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">AcSmSheetSetMgr</span></span><span style="color: #000000;"> mgr = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">AcSmSheetSetMgr</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">AcSmDatabase</span></span><span style="color: #000000;"> db = </span><span><span style="color: #0000ff;">new</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">AcSmDatabase</span></span><span style="color: #000000;">();</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span><span style="font-size: 8pt; color: #008000;">// try open the database</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span><span style="font-size: 8pt; color: #0000ff;">try</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; db = mgr.OpenDatabase(dstFile, </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">catch</span></span><span style="color: #000000;"> (System.</span><span><span style="color: #2b91af;">Exception</span></span><span style="color: #000000;"> ex)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; ed.WriteMessage(ex.ToString());</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span><span style="font-size: 8pt; color: #008000;">// lock to perform the operations</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; db.LockDb(db);</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span><span style="font-size: 8pt; color: #0000ff;">try</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IAcSmSheetSet</span></span><span style="color: #000000;"> mySheetSet;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IAcSmSheet</span></span><span style="color: #000000;"> newSheet;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; mySheetSet = db.GetSheetSet();</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span><span style="font-size: 8pt; color: #008000;">// check the name and location</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">if</span></span><span style="color: #000000;"> ((mySheetSet.GetDefDwtLayout().GetFileName() == </span><span><span style="color: #a31515;">&quot;&quot;</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; || (mySheetSet.GetNewSheetLocation() == </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">))</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></span><span style="font-size: 8pt;"><span><span style="color: #a31515;">&quot;\nCannot add sheet.&quot;</span></span><span style="color: #000000;"> + </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #a31515;">&quot; Manually set the Sheet Creation Template&quot;</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">return</span></span><span style="color: #000000;">;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; </span></span><span><span style="font-size: 8pt; color: #0000ff;">else</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">AcSmAcDbLayoutReference</span></span><span style="color: #000000;"> lytRef2 = </span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mySheetSet.GetDefDwtLayout();</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></span><span><span style="font-size: 8pt; color: #a31515;">&quot;\nAdding a sheet using Layout1 in&quot;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; + lytRef2.GetFileName().ToString());</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #2b91af;">IAcSmFileReference</span></span><span style="color: #000000;"> fileRef2 =</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; mySheetSet.GetNewSheetLocation();</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; ed.WriteMessage(</span></span><span><span style="font-size: 8pt; color: #a31515;">&quot;\nNew drawing will be created in &quot;</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; + fileRef2.GetFileName().ToString());</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160; newSheet = mySheetSet.AddNewSheet(</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #a31515;">&quot;Layout1&quot;</span></span><span style="color: #000000;">, </span><span><span style="color: #a31515;">&quot;Some Description&quot;</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; newSheet.SetTitle(</span></span><span style="font-size: 8pt;"><span><span style="color: #a31515;">&quot;testTitle&quot;</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160;&#0160;&#0160; mySheetSet.InsertComponent(newSheet, </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">null</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">catch</span></span><span style="color: #000000;"> (System.</span><span><span style="color: #2b91af;">Exception</span></span><span style="color: #000000;"> ex)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; ed.WriteMessage(ex.ToString());</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160; </span></span><span><span style="font-size: 8pt; color: #0000ff;">finally</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; {</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="color: #000000;"><span style="font-size: 8pt;">&#0160;&#0160;&#0160; db.UnlockDb(db, </span></span><span style="font-size: 8pt;"><span><span style="color: #0000ff;">true</span></span><span style="color: #000000;">);</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160;&#0160;&#0160; mgr.Close(db);</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">&#0160; }</span></span></p>
<p style="margin: 0px;"><span style="font-family: Courier New;"><span style="font-size: 8pt; color: #000000;">}</span></span></p>
</div>
