---
layout: "post"
title: "Change the background mask property of AcDbMText object programmatically using ObjectARX"
date: "2013-05-14 11:00:31"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "2014"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/05/change-the-background-mask-property-of-acdbmtext-object-programmatically-using-objectarx.html "
typepad_basename: "change-the-background-mask-property-of-acdbmtext-object-programmatically-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>I need to create (or set) an AcDbMText object with the background mask turned on. How can I do so programmatically?</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>We can do this both in ObjectARX and LISP.</p>  <p>In ObjectARX, we can use setBackgroundFill() member function of class AcDbMText to do the job. Please find the following code which toggles the background mask property of an MText entity.</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">test_setBackgroundFill_MText</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_name</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ename</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">p</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// select the entity</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acedEntSel</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Please pick an MText entity: &quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">ename</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">p</font></span><font color="#000000"> );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">oId</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbGetObjectId</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">oId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">ename</font></span><font color="#000000"> );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbMText</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">oId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForWrite</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcCmColor</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">color</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">backgroundFillOn</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setUseBackgroundColor</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setBackgroundFill</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setBackgroundFill</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">color</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">setColorIndex</font></span><font color="#000000">(1);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setBackgroundFillColor</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">color</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMText</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setUseBackgroundColor</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nError - you need to select an MText entity...&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>  <p>In LISP, we can add group code 90 and set it as 1 to turn on the background mask. If we want to use a different color than the one used last time we can add group code 63 such as (63 . 1) - RED color - as well. We can turn off the mask by removing group code 90 and all related ones such as 63, 45, 441 and 421 (if applicable). A small tip here, we can substitute the original sub list of group code 90 with (90 . 2) to turn the mask off successfully and do not need to care about other related group codes. The following LISP code demonstrates how to do so…</p>  <p>&#160;</p>  <p><font size="1" face="Consolas">(defun toggleBackgroundMaskOfAMText (en / ed)     <br />&#160; (setq ed (entget en))&#160;&#160; ; Sets ed to the entity data      <br />&#160; (setq atom90 (assoc 90 ed))      <br />&#160; (if (= atom90 nil)      <br />&#160;&#160;&#160; ;; no 90 groud code at all      <br />&#160;&#160;&#160; (progn      <br />&#160;&#160;&#160;&#160;&#160; (setq lst90 (cons 90 1))      <br />&#160;&#160;&#160;&#160;&#160; (setq atom63 (cons 63 1))      <br />&#160;&#160;&#160;&#160;&#160; (setq ed (append ed (list atom63 lst90)))      <br />&#160;&#160;&#160;&#160;&#160; ;; Add the 63 group code to set the background color as 1 (RED)      <br />&#160;&#160;&#160; )      <br />&#160;&#160;&#160; (progn      <br />&#160;&#160;&#160;&#160;&#160; (setq maskProp (cdr atom90))      <br />&#160;&#160;&#160;&#160;&#160; (if (= (boole 1 maskProp 1) 1)      <br /> (setq new90 (cons 90 2))      <br /> (setq new90 (cons 90 1))      <br />&#160;&#160;&#160;&#160;&#160; )      <br />&#160;&#160;&#160;&#160;&#160; (setq ed      <br />&#160;&#160;&#160;&#160;&#160; (subst new90      <br />&#160;&#160;&#160;&#160;&#160; (assoc 90 ed) ; Toggle the value of 90 group in ed.      <br />&#160;&#160;&#160;&#160;&#160; ed      <br />&#160;&#160;&#160;&#160;&#160; )      <br />&#160;&#160;&#160;&#160;&#160; )      <br />&#160;&#160;&#160; )      <br />&#160; ) </font></p>  <p><font size="1" face="Consolas">&#160; (entmod ed)     <br />&#160; (princ)      <br />)</font></p>  <p><font size="1" face="Consolas">(defun c:testBGMask ()     <br />&#160; (toggleBackgroundMaskOfAMText      <br />&#160;&#160;&#160; (car (entsel))      <br />&#160; )      <br />)</font></p>  <p>&#160;</p>  <p>Here is some information about the DXF group codes related to Background Mask of MTEXT entities.</p>  <p>** Group code 90: Bit flags for background Mask </p>  <p>The possible values can be:</p>  <p><strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160; kFillTextBox&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 0x1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; kFillTextBoxBackground&#160; = 0x2      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; kUseWordBreak&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 0x4      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; kCheckedForUseWordBreak = 0x8</strong></p>  <p>In the Background Mask dialog UI (while in the text editor or double click on the text --&gt; right click context menu --&gt;&#160; [Background Mask..]), we can check the 'Use background mask' option to set the kFillTextBox bit and 'Use drawing background color' option in the 'Fill Color' group to set the kFillTextBoxBackground bit. In ARX API, We can use AcDbMText::backgroundFillOn() AcDbMText::setBackgroundFill() to get and set the kFillTextBoxBackground bit.</p>  <p><strong>** Group code 63:&#160; Fill Color </strong></p>  <p>Specifies the color for the background. If it is a true color, Group code 63 gives the ACI color value and the corresponding Group code 421 gives the AcCmColor’s value.</p>  <p>We can specify the background color of the MTEXT in the Background Mask dialog UI. In ARX API, we can use AcDbMText::getBackgroundFillColor and AcDbMText::setBackgroundFillColor to get and read the value.</p>  <p><strong>** Group code 45:&#160; Border Offset Factor </strong></p>  <p>Specifies the margin around the text for the opaque background. The value is based on the text height. A factor of 1.0 exactly fits the multiline text object. A factor of 1.5 extends the background by 0.5 times the text height.</p>  <p>In the Background Mask dialog UI, we can specify it in the 'Border offset factor' field. In ARX API, We can use AcDbMText::getBackgroundScaleFactor and AcDbMText::setBackgroundScaleFactor to get and set the value.</p>  <p><strong>** Group code 441: Transparency color.&#160; </strong></p>  <p>The corresponding data member is of AcCmTransparency Type. This can not be controlled by the Background Mask dialog UI. But we can get or set this value using AcDbMText::getBackgroundTransparency and AcDbMText::setBackgroundTransparency methods.</p>
