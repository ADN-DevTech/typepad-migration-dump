---
layout: "post"
title: "Batch process in-memory"
date: "2012-04-02 20:48:00"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/04/batch-process-in-memory-1.html "
typepad_basename: "batch-process-in-memory-1"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html" target="_self">Augusto Goncalves</a></p>
<p>When we try batch process files in memory, we must take special attention to which transaction is in use, but the real trick is how to save the file: AutoCAD will lock the file in use and therefore the <strong>SaveAs</strong> method is not available for the current file, so the trick could be save as a temporary file and then replace it. This approach can be used to batch process and is faster then open drawings “on scree” (visible). The trade-off is that some features may not be available, such as Layout Manager.</p>
<div style="background: white;">
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 1</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Public</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">Sub</span></span><span style="color: #000000;"> batchProcess()</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 2</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' get all DWG files from a specific folder</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 3</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Dim</span></span><span style="color: #000000;"> directory </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">New</span></span><span style="color: #000000;"> System.IO.</span><span><span style="color: #2b91af;">DirectoryInfo</span></span><span style="color: #000000;">(</span><span><span style="color: #a31515;">"C:\temp"</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 4</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Dim</span></span><span style="color: #000000;"> files </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> System.IO.</span><span><span style="color: #2b91af;">FileInfo</span></span><span style="color: #000000;">() = _</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 5</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; directory.GetFiles(</span><span><span style="color: #a31515;">"*.dwg"</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 6</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 7</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">For</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">Each</span></span><span style="color: #000000;"> file </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> System.IO.</span><span><span style="color: #2b91af;">FileInfo</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">In</span></span><span style="color: #000000;"> files</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 8</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' generate a temp file location</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp;&nbsp; 9</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Dim</span></span><span style="color: #000000;"> tempFileName </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">String</span></span><span style="color: #000000;"> = _</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 10</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.IO.</span><span><span style="color: #2b91af;">Path</span></span><span style="color: #000000;">.GetTempFileName()</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 11</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 12</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Using</span></span><span style="color: #000000;"> db </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">New</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Database</span></span><span style="color: #000000;">(</span><span><span style="color: #0000ff;">False</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">True</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 13</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' open the current file</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 14</span></span></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.ReadDwgFile(file.FullName, _</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 15</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.IO.</span><span><span style="color: #2b91af;">FileShare</span></span><span style="color: #000000;">.ReadWrite, _</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 16</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">True</span></span><span style="color: #000000;">, </span><span><span style="color: #0000ff;">String</span></span><span style="color: #000000;">.Empty)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 17</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 18</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">Using</span></span><span style="color: #000000;"> trans </span><span><span style="color: #0000ff;">As</span></span><span style="color: #000000;"> </span><span><span style="color: #2b91af;">Transaction</span></span><span style="color: #000000;"> = _</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 19</span></span></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.TransactionManager.StartTransaction()</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 20</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 21</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' ToDo:</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 22</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' Do your processing here</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 23</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 24</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 25</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' commit changes</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 26</span></span></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trans.Commit()</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 27</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">End</span></span><span style="color: #000000;"> </span></span><span><span style="color: #0000ff;">Using</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 28</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 29</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' save as temp file</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 30</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.SaveAs(tempFileName, </span><span><span style="color: #2b91af;">DwgVersion</span></span><span style="color: #000000;">.Current)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 31</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 32</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span><span style="color: #0000ff;">End</span></span><span style="color: #000000;"> </span><span><span style="color: #0000ff;">Using</span></span><span style="color: #000000;"> </span></span><span><span style="color: #008000;">' dispose the database</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 33</span></span></span><span style="color: #000000;">&nbsp;</span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 34</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' now replace</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 35</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.IO.</span><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.Copy(tempFileName, file.FullName, </span><span><span style="color: #0000ff;">True</span></span><span style="color: #000000;">)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 36</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #008000;">' and erase the temp file</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 37</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.IO.</span><span><span style="color: #2b91af;">File</span></span><span style="color: #000000;">.Delete(tempFileName)</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 38</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span><span style="color: #0000ff;">Next</span></span></span></p>
<p style="margin: 0px;"><span style="font-family: Consolas;"><span><span style="color: #2b91af;"><span>&nbsp;&nbsp; 39</span></span></span><span><span style="color: #000000;">&nbsp;&nbsp; </span><span><span style="color: #0000ff;">End</span></span><span style="color: #000000;"> </span></span><span><span style="color: #0000ff;">Sub</span></span></span></p>
</div>
