---
layout: "post"
title: "Asking for a password on the command line of AutoCAD using ObjectARX"
date: "2012-06-29 17:39:07"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/asking-for-a-password-on-the-command-line-of-autocad-using-objectarx.html "
typepad_basename: "asking-for-a-password-on-the-command-line-of-autocad-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>I have a command line that is asking the user for a password. In this situation I need to display a * for each entered character by the user. How is it possible to do it? </p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>It would not help to use acedGetString, as it always echoes the characters as they are typed. If you don't want to use a dialog, you can create your own function in ObjectARX to prompt the user for a password in AutoCAD, yet have the console show only &quot;*&quot; for each character typed, much like password entry in Windows. </p>  <p>The basic idea is to set a <a href="http://adndevblog.typepad.com/autocad/2012/06/how-to-react-to-the-cursor-keys-properly-without-affecting-autocad-using-objectarx.html">Windows Hook</a> which can monitor any keyboard input to a normal call to acedGetString() before AutoCAD gets it. From there you can record what has been typed in your own buffer, and replace the keystroke with a generic &quot;*&quot;. When the function is done, you can return your buffer instead of what AutoCAD has actually received (i.e. a string of &quot;****&quot;s).</p>  <p>This example creates the function adskGetPassword() which has the identical signature and return type as acedGetString(), and it can be used interchangeably, however any typed input will appear as '*' in adskGetPassword(). For questions about the arguments, have a look at the ObjectARX online help under acedGetString() for details. </p>  <p>As far as security is concerned, the routine is safe to use except if any applications have set hooks in the chain before this one, or if any application has sub classed the AutoCAD frame window. These applications may be able to monitor the keystrokes before our function is able to change them. If more security is desired, take a look at the Password Dialog available from Microsoft.</p>  <p>Here is the code:</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">ACHAR</font></font></span><font style="font-size: 8pt"><font color="#000000">*</font><span style="color: "><font color="#010001">pResult</font></span><font color="#000000">; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// a global pointer to the result...</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// a global lengh</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">crTerminated</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// a global flag for cronly</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">adskGetPassword</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">cronly</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">ACHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">prompt</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">ACHAR</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">result</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ACHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tempResult</font></span><font color="#000000">[256]; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pResult</font></span><font color="#000000">=</font><span style="color: "><font color="#010001">result</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// set our global pointer...</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">=0;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// and reset our length.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">resultVal</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// this is what acedGetString returns (ie escape etc)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">crTerminated</font></span><font color="#000000">=</font><span style="color: "><font color="#010001">cronly</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// set our global flag for cronly</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acedRegisterFilterWinMsg</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MessageFilter</font></span><font color="#000000">);</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Set the Hook.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">resultVal</font></span><font color="#000000">=</font><span style="color: "><font color="#010001">acedGetString</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">cronly</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">prompt</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">tempResult</font></span><font color="#000000">);</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Call GetString...</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acedRemoveFilterWinMsg</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MessageFilter</font></span><font color="#000000">);</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Remove the Hook.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">result</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">]=</font><span style="color: "><font color="#a31515">'\0'</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Null terminate the result</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">resultVal</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Here is the callback...it will be called for many types of messages sent to AutoCAD.</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">BOOL</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">MessageFilter</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MSG</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">message</font></span><font color="#000000">==</font><span style="color: "><font color="#010001">WM_CHAR</font></span><font color="#000000">)</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// a char has been typed...</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">=</font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">wParam</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">!=8 &amp;&amp; </font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">!=13 &amp;&amp; </font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">!=27 &amp;&amp; ((</font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">!=32)||</font><span style="color: "><font color="#010001">crTerminated</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// keyCode 8 is Backspace</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Keycode 27 is Escape</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Keycode 32 is Space (only avoided if cronly is used)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">wParam</font></span><font color="#000000">=42;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// For Security against subsequent hooks, and display,</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">lParam</font></span><font color="#000000">=589825;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Set these two to reflect '*' keystroke</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pResult</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">]=</font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">;</font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// but keep the real keycode.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">++;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">keyCode</font></span><font color="#000000">==8 &amp;&amp; </font><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">resultLen</font></span><font color="#000000">--;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>
