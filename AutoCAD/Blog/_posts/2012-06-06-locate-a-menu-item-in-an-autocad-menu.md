---
layout: "post"
title: "Locate a menu item in an AutoCAD menu"
date: "2012-06-06 00:07:02"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "AutoCAD"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/locate-a-menu-item-in-an-autocad-menu.html "
typepad_basename: "locate-a-menu-item-in-an-autocad-menu"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>  <p>With classic UI, if you want to add a item AutoCAD menu at run time, you can locate the menu by Application.MenuBar and call AddMenuItem. AddMenuItem specifies the index of your item and its corresponding macro to execute. </p>  <p>The following code finds the menu of File, and adds one custom item as the first one in the list of File menu. It provides a macro to execute Open.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: green">' This procedure finds a menu item in a pull down menu</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">' and inserts a new menu item above it</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> findMenuItem()</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> aMenuGrp </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">AcadMenuGroup</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> aPupMenu </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">AcadPopupMenu</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> aPupMenuItem </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">AcadPopupMenuItem</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> newMenuItem </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">AcadPopupMenuItem</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> int1 </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Integer</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> aPupName </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> strTestTag </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Dim</span><span style="line-height: 140%"> openMacro </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">String</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; int1 = -1</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">' Change the value to the Tag of the menu Item</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">' You want to insert above in the pull down menu</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">'strTestTag = &quot;ID_AcadWeb&quot; 'Only for AutoCAD 2000</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; strTestTag = </span><span style="line-height: 140%; color: #a31515">&quot;ID_New&quot;</span><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">'for All AutoCAD version</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: green">' Iterate through each menu group</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> aMenuGrp </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">App</span><span style="line-height: 140%">.MenuGroups&#160; </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Iterate through each popup menu</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> aPupMenu </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> aMenuGrp.Menus</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Iterate through each popup menu item</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">For</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Each</span><span style="line-height: 140%"> aPupMenuItem </span><span style="line-height: 140%; color: blue">In</span><span style="line-height: 140%"> aPupMenu</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Get the index of the object based on the TagString</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' and the name of the parent (a Popup Menu) if the</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' TagString is equal to the value in strTestTag</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> aPupMenuItem.TagString = strTestTag </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Get the name of the Popup menu</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; aPupName = aPupMenuItem.Parent.Name</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Get the index of the menu item</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int1 = aPupMenuItem.Index</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Exit For</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> int1 &lt;&gt; -1 </span><span style="line-height: 140%; color: blue">Then</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Exit For</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> int1 &lt;&gt; -1 </span><span style="line-height: 140%; color: blue">Then</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Exit For</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">Next</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">If</span><span style="line-height: 140%"> aPupName &lt;&gt; </span><span style="line-height: 140%; color: #a31515">&quot;&quot;</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Then</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Assign the macro the equivalent of &quot;ESC ESC _open &quot;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; openMacro = Chr(3) + Chr(3) +&#160; _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Chr(16) + Chr(95) + </span><span style="line-height: 140%; color: #a31515">&quot;open&quot;</span><span style="line-height: 140%"> + Chr(32)</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">' Insert a new menu Item above the item found above</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; newMenuItem = </span><span style="line-height: 140%; color: #2b91af">app</span><span style="line-height: 140%">.MenuBar(aPupName).AddMenuItem(int1, _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: #a31515">&quot;&amp;Test3...&quot;</span><span style="line-height: 140%">, openMacro)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">If</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p> </div>
