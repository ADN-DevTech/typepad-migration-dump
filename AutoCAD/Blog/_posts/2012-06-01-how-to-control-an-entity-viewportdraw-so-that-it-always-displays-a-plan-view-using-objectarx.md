---
layout: "post"
title: "How to control an Entity viewportDraw so that it always displays a Plan view using ObjectARX?"
date: "2012-06-01 16:25:28"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "AutoCAD OEM"
  - "Fenton Webb"
  - "ObjectARX"
  - "RealDWG"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/how-to-control-an-entity-viewportdraw-so-that-it-always-displays-a-plan-view-using-objectarx.html "
typepad_basename: "how-to-control-an-entity-viewportdraw-so-that-it-always-displays-a-plan-view-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Using ObjectARX to create and define a Custom Entity type you can implement Viewport specific draw functionality, amongst other things. The same can also be achieved with .NET Overrules which is really cool. A common question we get from developers is, how can I make my custom entity Text follow the same direction as the View, in other words, plan to the View.</p>  <p>Here’s how…</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">drawTextPlanView</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcGiViewportDraw</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pVd</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">insPnt</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">textStr</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the current viewport</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGiViewport</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000"> = &amp;</font><span style="color: "><font color="#010001">pVd</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">viewport</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">cam</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">tar</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// work out the viewing properties</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getCameraLocation</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">cam</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getCameraTarget</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tar</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now calc the normal vector</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">normal</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">cam</font></span><font color="#000000"> - </font><span style="color: "><font color="#010001">tar</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">normal</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">normalize</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// finally draw the text in the viewport</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGiTextStyle</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">giStyle</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">fromAcDbTextStyle</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">giStyle</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">curDoc</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">database</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">textstyle</font></span><font color="#000000">());</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">dir</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">insPnt</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">asVector</font></span><font color="#000000">().</font><span style="color: "><font color="#010001">crossProduct</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">normal</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">dir</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">y</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pVd</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">geometry</font></span><font color="#000000">().</font><span style="color: "><font color="#010001">text</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">insPnt</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">normal</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">dir</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">textStr</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_tcslen</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">textStr</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">Adesk</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kFalse</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">giStyle</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
