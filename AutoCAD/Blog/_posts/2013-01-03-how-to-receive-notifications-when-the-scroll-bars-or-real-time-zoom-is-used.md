---
layout: "post"
title: "How to receive notifications when the Scroll Bars or Real-time Zoom is used"
date: "2013-01-03 18:06:18"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Gopinath Taget"
  - "MFC"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/how-to-receive-notifications-when-the-scroll-bars-or-real-time-zoom-is-used.html "
typepad_basename: "how-to-receive-notifications-when-the-scroll-bars-or-real-time-zoom-is-used"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p><dt>There are a few ways you can make sure you are notified when the screen is updated with the mouse-wheel, or when the scroll bars are adjusted. </dt></p>  <p>The most straightforward way may be to subclass the AutoCAD drawing window, and catch any WM_VSCROLL, WM_HSCROLL or WM_MOUSEWHEEL messages. You know that the screen will be updated when AutoCAD receives these, and you can monitor or filter AutoCAD messages by implementing an AutoCAD message monitor or filter. But there is a catch. Your custom message monitor “monitors” AutoCAD messages *before* they are handled by AutoCAD. And there is really no clean way to monitor AutoCAD messages immediately after they have been handled by AutoCAD. So the simplest solution would be for you to set a timer for some arbitrarily small value to be used as a notification (this assumes that the AutoCAD screen will update within this time, so you may need to adjust this value). </p>  <p>Within the WindowProc, you can kill the timer, and reset it for every subsequent message that is received so that you only get one timer update. Here is the relevant code:</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">WNDPROC dwgWndProc = NULL;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Consolas"></font></span></p>    <div style="font-family: ; background: white">     <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">virtual</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> AcRx::AppRetCode On_kInitAppMsg (</font></span><span style="line-height: 11pt"><font color="#0000ff">void</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> *pkt) {</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// TODO: Load dependencies here</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// You *must* call On_kInitAppMsg here</font></span></font></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> AcRx::AppRetCode retCode =AcRxArxApp::On_kInitAppMsg (pkt) ;</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// TODO: Add your initialization code here</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt"> pReactor = </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> asdkEditorReactor(</font></span><span style="line-height: 11pt"><font color="#0000ff">true</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> dwgWndProc = (WNDPROC)::SetWindowLong(acedGetAcadDwgView()-&gt;m_hWnd,</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; GWL_WNDPROC, </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// Use GWLP_WNDPROC for x64 platforms</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; (</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">long</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)myWndProc);</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">return</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> (retCode) ;</font></span></font></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>      <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Consolas"></font></span></p>      <div style="font-family: ; background: white">       <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">LRESULT CALLBACK myWndProc(HWND hwnd, UINT uMsg,</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> WPARAM wParam,LPARAM lParam)</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>        <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">if</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(uMsg==WM_VSCROLL || uMsg==WM_HSCROLL || </font></span></font></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; uMsg==WM_MOUSEWHEEL)</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> {</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; acedGetAcadFrame()-&gt;KillTimer(10);</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; acedGetAcadFrame()-&gt;SetTimer(10,100,TimerProc);</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></span></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">return</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> ::CallWindowProc(dwgWndProc,hwnd,uMsg,wParam,lParam);</font></span></font></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Consolas"></font></span></p>        <div style="font-family: ; background: white">         <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CALLBACK TimerProc(HWND hWnd,UINT nMsg,</font></span></font></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> UINT_PTR nIDEvent,DWORD dwTime)</font></font></span></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> screenUpdated();</font></font></span></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> acedGetAcadFrame()-&gt;KillTimer(10);</font></font></span></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>          <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>          <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> screenUpdated()</font></span></font></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>          <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt"> acutPrintf(L</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Display Updated\n&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">); </font></span></font></p>          <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>       </div>     </div>      <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Consolas"></font></span></p>      <p style="margin: 0px">You can also use an editor reactor to handle the regular zoom commands, as well as the toolbar version of Realtime Zoom. Here is a sample snippet:</p>      <p style="margin: 0px">&#160;</p>      <div style="font-family: ; background: white">       <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> asdkEditorReactor::commandEnded(</font></span><span style="line-height: 11pt"><font color="#0000ff">const</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> ACHAR* cmdStr)</font></span></font></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>        <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000">(!wcscmp(cmdStr,L</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;ZOOM&quot;</font></span><span style="line-height: 11pt"><font color="#000000">) || !wcscmp(cmdStr,L</font></span><span style="line-height: 11pt"><font color="#a31515">&quot;PAN&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">))</font></span></font></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; screenUpdated();</font></font></span></p>        <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>     </div>   </div> </div>
