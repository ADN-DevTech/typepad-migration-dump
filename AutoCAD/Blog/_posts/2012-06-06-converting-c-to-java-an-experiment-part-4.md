---
layout: "post"
title: "Converting C# to Java â€“ An Experiment (Part 4)"
date: "2012-06-06 11:16:22"
author: "Madhukar Moogala"
categories:
  - "Mobile"
  - "Stephen Preston"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/converting-c-to-java-an-experiment-part-4.html "
typepad_basename: "converting-c-to-java-an-experiment-part-4"
typepad_status: "Publish"
---

<p>By&#0160;<a href="http://adndevblog.typepad.com/autocad/stephen-preston.html">Stephen Preston</a></p>
<p>(Links to previous installments: <a href="http://adndevblog.typepad.com/autocad/2012/05/converting-c-to-java-an-experiment-part-1.html" target="_self">Part 1</a>; <a href="http://adndevblog.typepad.com/autocad/2012/05/converting-c-to-java-an-experiment-part-1-1.html" target="_self">Part 2</a>; <a href="http://adndevblog.typepad.com/autocad/2012/05/converting-c-to-java-an-experiment-part-3.html" target="_self">Part 3</a>).</p>
<p>Its time to hook up our migrated Item.java and PrioritizerCore.java classes to a simple Android UI. No bells and whistles - or even editing for that matter - just enough to display some items in a <a href="http://developer.android.com/reference/android/widget/ListView.html" target="_blank">ListView</a>.</p>
<p>The core of an Android app is an <a href="http://developer.android.com/guide/topics/fundamentals/activities.html" target="_self">Activity</a>. An Activity represents a single screen displayed by the Android app. The display you see on the screen is composed of <a href="http://developer.android.com/guide/topics/ui/index.html" target="_self">View Groups and Views</a>, and you transfer control between Activities by creating an <a href="http://developer.android.com/guide/topics/intents/intents-filters.html" target="_self">Intent</a>. Each app includes a <a href="http://developer.android.com/guide/topics/manifest/manifest-intro.html" target="_self">manifest file</a>, which documents the various components that make up the app.&#0160;<a href="http://developer.android.com/guide/topics/fundamentals.html" target="_self">Read more about the Android basics here</a>.</p>
<p>We&#39;ve already created our basic Android Activity - when we created our Android project. This project was imaginatively named CSMigrationTest, and so our one and only Activity is called CSMigrationTestActivity:</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0167671fcc7e970b-pi" style="display: inline;"><img alt="Pt4Activity" class="asset  asset-image at-xid-6a0167607c2431970b0167671fcc7e970b" src="/assets/image_78970.jpg" style="display: block; margin-left: auto; margin-right: auto;" title="Pt4Activity" /></a></p>
<p>The default code looks like this:</p>
<p><span style="color: #7f0055;"><strong>package&#0160;</strong></span><span style="color: #000000;">Preston.Stephen.Prioritizer;</span><br /> <span style="color: #ffffff;">&#0160;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.app.Activity;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.os.Bundle;</span><br /> <br /> <span style="color: #7f0055;"><strong>public&#0160;class&#0160;</strong></span><span style="color: #000000;">CSMigrationTestActivity&#0160;</span><span style="color: #7f0055;"><strong>extends&#0160;</strong></span><span style="color: #000000;">Activity&#0160;</span><span style="color: #000000;">{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f5fbf;">/**&#0160;Called&#0160;when&#0160;the&#0160;activity&#0160;is&#0160;first&#0160;created.&#0160;*/</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>void&#0160;</strong></span><span style="color: #000000;">onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle&#0160;savedInstanceState</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>super</strong></span><span style="color: #000000;">.onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">setContentView</span><span style="color: #000000;">(</span><span style="color: #000000;">R.layout.main</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #000000;">}</span></p>
<p>Notice the call to &quot;setContentView(R.layout.main);&quot; - this is creating our screen display. Go to the Eclipse Project Explorer and open the res-&gt;layout folder and you&#39;ll see a file called main.xml. This is the XML that describes the screen layout, and which is being referenced by SetContentView:</p>
<p>&#0160;<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0163062c43f0970d-pi" style="display: inline;"><img alt="Pt4mainxml" class="asset  asset-image at-xid-6a0167607c2431970b0163062c43f0970d" src="/assets/image_605305.jpg" style="display: block; margin-left: auto; margin-right: auto;" title="Pt4mainxml" /></a></p>
<p>Double-click on that file to open it. The window displaying the file has tabs at the bottom to switch between the XML view and the <a href="http://en.wikipedia.org/wiki/Wysiwyg" target="_blank">WYSIWYG</a> editor view. Replace the existing XML with this:</p>
<p><span style="color: #000000;">&lt;?xml&#0160;version=</span><span style="color: #2a00ff;">&quot;1.0&quot;&#0160;</span><span style="color: #000000;">encoding=</span><span style="color: #2a00ff;">&quot;utf-8&quot;</span><span style="color: #000000;">?&gt;</span><br /> <span style="color: #000000;">&lt;LinearLayout&#0160;xmlns:android=</span><span style="color: #2a00ff;">&quot;http://schemas.android.com/apk/res/android&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_width=</span><span style="color: #2a00ff;">&quot;fill_parent&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_height=</span><span style="color: #2a00ff;">&quot;fill_parent&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:orientation=</span><span style="color: #2a00ff;">&quot;vertical&quot;&#0160;</span><span style="color: #000000;">&gt;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">&lt;ListView</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:id=</span><span style="color: #2a00ff;">&quot;@+id/ItemList&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_width=</span><span style="color: #2a00ff;">&quot;match_parent&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_height=</span><span style="color: #2a00ff;">&quot;wrap_content&quot;&#0160;</span><span style="color: #000000;">android:clickable=</span><span style="color: #2a00ff;">&quot;true&quot;</span><span style="color: #000000;">&gt;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">&lt;/ListView&gt;</span><br /> <span style="color: #000000;">&lt;/LinearLayout&gt;</span></p>
<p>This inserts a ListView in your default view. The WYSIWYG view now looks like this:</p>
<p style="text-align: center;">&#0160;  <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0176151580e8970c-pi" style="display: inline;"><img alt="Pt4listview" class="asset  asset-image at-xid-6a0167607c2431970b0176151580e8970c" src="/assets/image_548269.jpg" title="Pt4listview" /></a></p>
<p>If you&#39;ve already setup your Android virtual machine or setup some real Android hardware for debugging, you can go ahead and test your app now, but it doesn&#39;t do anything yet. (I&#39;ll talk more about running the app once we&#39;ve added some code).</p>
<p>To hook up a data source to a ListView, we use an Adapter class. An Adapter class is an interface between your data and the ListView. It retrieves the data item corresponding to an particular element in the List View, and it also provides the sub-View to be inserted in each element of the ListView. There are a number of pre-defined Adapters for various data types, but we&#39;re going to create a custom adapter derived from BaseAdapter.</p>
<p><em>(The simple Item class we&#39;re using could easily (and more simply) have been handled by storing items in a <a href="http://developer.android.com/guide/topics/data/data-storage.html#db" target="_blank">SQLite</a> database and using a <a href="http://developer.android.com/reference/android/widget/SimpleCursorAdapter.html" target="_blank">SimpleCursorAdaptor</a>, but we&#39;re looking at the more general case of accesing data stored in a class and also migrating code from C#).</em></p>
<p>Right click on your package folder in the src folder and selct New...Class. In the dialog that appears, click the Browse button by the Superclass editbox and choose the BaseAdapter class</p>
<p style="text-align: center;">&#0160;<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017615157eab970c-pi" style="display: inline;"><img alt="Pt4CreateBaseAdaptor" class="asset  asset-image at-xid-6a0167607c2431970b017615157eab970c" src="/assets/image_574272.jpg" title="Pt4CreateBaseAdaptor" /></a></p>
<p>Give the class a name (I called mine &#39;MyAdapter&#39;) and click &#39;Finish&#39;.</p>
<p>Now open MyAdapter.java and replace the default code with the following:</p>
<p><span style="color: #7f0055;"><strong>package&#0160;</strong></span><span style="color: #000000;">Preston.Stephen.Prioritizer;</span><br /> <span style="color: #ffffff;">&#0160;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.content.Context;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.view.LayoutInflater;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.view.View;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.view.ViewGroup;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.widget.BaseAdapter;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.widget.TextView;</span><br /> <span style="color: #ffffff;">&#0160;</span><br /> <span style="color: #7f0055;"><strong>public&#0160;class&#0160;</strong></span><span style="color: #000000;">MyAdapter&#0160;</span><span style="color: #7f0055;"><strong>extends&#0160;</strong></span><span style="color: #000000;">BaseAdapter&#0160;</span><span style="color: #000000;">{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>private&#0160;</strong></span><span style="color: #000000;">PrioritizerCore&#0160;m_prioritizer;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>private&#0160;</strong></span><span style="color: #000000;">LayoutInflater&#0160;m_inflater;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>private&#0160;</strong></span><span style="color: #000000;">Context&#0160;m_cxt;</span><br /> <br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Constructor&#0160;-&#0160;instantiates&#0160;our&#0160;PrioritizerCore&#0160;class,</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//&#0160;and&#0160;also&#0160;creates&#0160;an&#0160;Inflater&#0160;class&#0160;that&#0160;we&#0160;use&#0160;to&#0160;create&#0160;sub-Views&#0160;in&#0160;the&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//&#0160;getView&#0160;function.</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #000000;">MyAdapter</span><span style="color: #000000;">(</span><span style="color: #000000;">Context&#0160;c</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_cxt&#0160;=&#0160;c;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_prioritizer&#0160;=&#0160;</span><span style="color: #7f0055;"><strong>new&#0160;</strong></span><span style="color: #000000;">PrioritizerCore</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_inflater&#0160;=&#0160;</span><span style="color: #000000;">(</span><span style="color: #000000;">LayoutInflater</span><span style="color: #000000;">)</span><span style="color: #000000;">m_cxt.getSystemService</span><span style="color: #000000;">(</span><span style="color: #000000;">Context.LAYOUT_INFLATER_SERVICE</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Number&#0160;of&#0160;data&#0160;items</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>int&#0160;</strong></span><span style="color: #000000;">getCount</span><span style="color: #000000;">()&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">m_prioritizer.getItemCount</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Get&#0160;item&#0160;for&#0160;a&#0160;particular&#0160;position</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #000000;">Object&#0160;getItem</span><span style="color: #000000;">(</span><span style="color: #7f0055;"><strong>int&#0160;</strong></span><span style="color: #000000;">position</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">m_prioritizer.getAtIndex</span><span style="color: #000000;">(</span><span style="color: #000000;">position</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Get&#0160;row&#0160;Id&#0160;for&#0160;a&#0160;particular&#0160;position&#0160;in&#0160;list&#0160;its&#0160;the&#0160;same&#0160;in&#0160;this&#0160;case</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>long&#0160;</strong></span><span style="color: #000000;">getItemId</span><span style="color: #000000;">(</span><span style="color: #7f0055;"><strong>int&#0160;</strong></span><span style="color: #000000;">position</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">position;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Return&#0160;View&#0160;to&#0160;be&#0160;used&#0160;as&#0160;sub-View&#0160;for&#0160;ListView&#0160;element.</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//For&#0160;efficiency,&#0160;we&#0160;re-use&#0160;convertView&#0160;if&#0160;its&#0160;not&#0160;null.</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #000000;">View&#0160;getView</span><span style="color: #000000;">(</span><span style="color: #7f0055;"><strong>int&#0160;</strong></span><span style="color: #000000;">position,&#0160;View&#0160;convertView,&#0160;ViewGroup&#0160;parent</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>if&#0160;</strong></span><span style="color: #000000;">(</span><span style="color: #000000;">convertView&#0160;==&#0160;</span><span style="color: #7f0055;"><strong>null</strong></span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">convertView&#0160;=&#0160;m_inflater.inflate</span><span style="color: #000000;">(</span><span style="color: #000000;">R.layout.listentry,&#0160;</span><span style="color: #7f0055;"><strong>null</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f7f5f;">//Load&#0160;View&#0160;with&#0160;Item&#0160;data</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">TextView&#0160;txtView&#0160;=&#0160;</span><span style="color: #000000;">(</span><span style="color: #000000;">TextView</span><span style="color: #000000;">)</span><span style="color: #000000;">convertView;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">Item&#0160;i&#0160;=&#0160;m_prioritizer.getAtIndex</span><span style="color: #000000;">(</span><span style="color: #000000;">position</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">txtView.setTag</span><span style="color: #000000;">(</span><span style="color: #000000;">i</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">txtView.setText</span><span style="color: #000000;">(</span><span style="color: #000000;">i.getItemText</span><span style="color: #000000;">())</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">txtView;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//These&#0160;other&#0160;functions&#0160;have&#0160;nothing&#0160;to&#0160;do&#0160;with&#0160;the&#0160;ListView&#0160;-&#0160;they&#0160;just&#0160;relay</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//&#0160;function&#0160;calls&#0160;to&#0160;PrioritizerCore&#0160;so&#0160;our&#0160;main&#0160;Activity&#0160;doesn&#39;t&#0160;have&#0160;to&#0160;know&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//&#0160;about&#0160;PrioritizerCore.</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>boolean&#0160;</strong></span><span style="color: #000000;">add</span><span style="color: #000000;">(</span><span style="color: #000000;">String&#0160;itemText</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">m_prioritizer.addItem</span><span style="color: #000000;">(</span><span style="color: #000000;">itemText</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>boolean&#0160;</strong></span><span style="color: #000000;">hasPriorities</span><span style="color: #000000;">()&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>return&#0160;</strong></span><span style="color: #000000;">m_prioritizer.hasPriorities</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>void&#0160;</strong></span><span style="color: #000000;">sort</span><span style="color: #000000;">()&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_prioritizer.sort</span><span style="color: #000000;">()</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #000000;">}</span></p>
<p>There are certain base class functions we have to override. The overrides we&#39;ve supplied are marked with the &quot;<a href="http://docs.oracle.com/javase/tutorial/java/IandI/override.html" target="_blank">@Override</a>&quot; <a href="http://docs.oracle.com/javase/tutorial/java/javaOO/annotations.html" target="_blank">annotation</a>. The comments explain what&#39;s going on - it turns out that our Adapter is just a really shallow wrapper on top of what we&#39;d already implemented in PrioritizerCore. We could have simply edited PrioritizerCore to derive from BaseAdapter and added the additional required functions, but we don&#39;t want to pollute our PrioritizerCore code with Android specific code - just like we avoided polluting our C# versopn with AutoCAD-specific code.</p>
<p>Once you&#39;ve copied the above code, you&#39;ll see there&#39;s an error in it - because we&#39;ve not yet created the &#39;listentry&#39; layout the <a href="http://developer.android.com/reference/android/view/LayoutInflater.html" target="_blank">LayoutInflater</a> uses to create the View. The LayoutInflator is simply using an XML layout definition to instantiate the corresponding Android View classes.</p>
<p>You&#39;ll recall that layouts are defined by XML files in the res-&gt;layout folder. Right click on that folder and seelct New-&gt;Android XML File, set the filename to &#39;listentry&#39; and click Finish. Then open the XML file and replace the default XML with this:</p>
<p><span style="color: #000000;">&lt;?xml&#0160;version=</span><span style="color: #2a00ff;">&quot;1.0&quot;&#0160;</span><span style="color: #000000;">encoding=</span><span style="color: #2a00ff;">&quot;utf-8&quot;</span><span style="color: #000000;">?&gt;</span><br /> <span style="color: #000000;">&lt;TextView&#0160;xmlns:android=</span><span style="color: #2a00ff;">&quot;http://schemas.android.com/apk/res/android&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_width=</span><span style="color: #2a00ff;">&quot;fill_parent&quot;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:layout_height=</span><span style="color: #2a00ff;">&quot;fill_parent&quot;&#0160;</span><span style="color: #000000;">android:textSize=</span><span style="color: #2a00ff;">&quot;20pt&quot;</span><span style="color: #000000;">&gt;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">android:text=</span><span style="color: #2a00ff;">&quot;Large&#0160;Text&quot;&#0160;</span><span style="color: #000000;">android:textAppearance=</span><span style="color: #2a00ff;">&quot;?android:attr/textAppearanceLarge&quot;&#0160;</span><span style="color: #000000;">/&gt;</span><br /> <span style="color: #000000;">&lt;/TextView&gt;</span></p>
<p>(The textSize and textAppearance attributes aren&#39;t required. I put them there to make the text appear at a reasonable size on my 10&quot;tablet).</p>
<p>Now we have our Adapter defined, its time to go back to our Activity, hook the Adapter up to the ListView, and hardcode a few Items to put in the list. Open CSMigrationTestActivity.Java and replace the code you had with the code below:</p>
<p><span style="color: #7f0055;"><strong>package&#0160;</strong></span><span style="color: #000000;">Preston.Stephen.Prioritizer;</span><br /> <span style="color: #ffffff;">&#0160;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">Preston.Stephen.Prioritizer.MyAdapter;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">Preston.Stephen.Prioritizer.R;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.app.Activity;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.os.Bundle;</span><br /> <span style="color: #7f0055;"><strong>import&#0160;</strong></span><span style="color: #000000;">android.widget.ListView;</span><br /> <br /> <span style="color: #7f0055;"><strong>public&#0160;class&#0160;</strong></span><span style="color: #000000;">CSMigrationTestActivity&#0160;</span><span style="color: #7f0055;"><strong>extends&#0160;</strong></span><span style="color: #000000;">Activity&#0160;</span><span style="color: #000000;">{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f5fbf;">/**&#0160;Called&#0160;when&#0160;the&#0160;activity&#0160;is&#0160;first&#0160;created.&#0160;*/</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #3f7f5f;">//Member&#0160;variables</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">ListView&#0160;m_listView;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><span style="color: #000000;">MyAdapter&#0160;m_adapter;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #646464;">@Override</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>public&#0160;</strong></span><span style="color: #7f0055;"><strong>void&#0160;</strong></span><span style="color: #000000;">onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">Bundle&#0160;savedInstanceState</span><span style="color: #000000;">)&#0160;{</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #7f0055;"><strong>super</strong></span><span style="color: #000000;">.onCreate</span><span style="color: #000000;">(</span><span style="color: #000000;">savedInstanceState</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">setContentView</span><span style="color: #000000;">(</span><span style="color: #000000;">R.layout.main</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f7f5f;">//Store&#0160;ListView&#0160;for&#0160;this&#0160;activity&#0160;in&#0160;a&#0160;member&#0160;variable&#0160;for&#0160;convenience&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_listView&#0160;=&#0160;</span><span style="color: #000000;">(</span><span style="color: #000000;">ListView</span><span style="color: #000000;">)</span><span style="color: #7f0055;"><strong>this</strong></span><span style="color: #000000;">.findViewById</span><span style="color: #000000;">(</span><span style="color: #000000;">R.id.ItemList</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f7f5f;">//Create&#0160;our&#0160;Adapter&#0160;and&#0160;attach&#0160;it&#0160;to&#0160;our&#0160;ListView</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter&#0160;=&#0160;</span><span style="color: #7f0055;"><strong>new&#0160;</strong></span><span style="color: #000000;">MyAdapter</span><span style="color: #000000;">(</span><span style="color: #7f0055;"><strong>this</strong></span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_listView.setAdapter</span><span style="color: #000000;">(</span><span style="color: #000000;">m_adapter</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #3f7f5f;">//Add&#0160;some&#0160;items&#0160;to&#0160;the&#0160;list</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter.add</span><span style="color: #000000;">(</span><span style="color: #2a00ff;">&quot;Fix&#0160;the&#0160;roof&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter.add</span><span style="color: #000000;">(</span><span style="color: #2a00ff;">&quot;Paint&#0160;the&#0160;spare&#0160;bedroom&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter.add</span><span style="color: #000000;">(</span><span style="color: #2a00ff;">&quot;Paint&#0160;the&#0160;house&#0160;exterior&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter.add</span><span style="color: #000000;">(</span><span style="color: #2a00ff;">&quot;Dig&#0160;up&#0160;the&#0160;lawn&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">m_adapter.add</span><span style="color: #000000;">(</span><span style="color: #2a00ff;">&quot;Build&#0160;a&#0160;fence&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">;</span><br /> <span style="color: #ffffff;">&#0160;&#0160;&#0160;&#0160;</span><span style="color: #000000;">}</span><br /> <span style="color: #000000;">}</span></p>
<p>All this code is doing so far is adding five items to our list (via MyAdapter.add). We&#39;ve not implemented any of the functionality we need to add/edit/or remove items from the list, or to set priorities, or to sort by priority. But this post is getting quite long now so it&#39;s time to run this code in the debugger to make sure it works.&#0160;</p>
<p>If you don&#39;t have an Android device, then follow <a href="http://developer.android.com/guide/developing/devices/managing-avds.html" target="_blank">these instructions for creating a virtual device</a>. If you have an Android phone or tablet, then you may prefer to <a href="http://developer.android.com/guide/developing/device.html" target="_blank">setup your hardware for debugging</a> instead. I&#39;m using an <a href="http://eee.asus.com/eeepad/transformer-300/features/" target="_blank">Asus Transformer Pad TF300</a> for debugging. I find that debugging on a hardware device is a lot faster than using the software emulator. And when I read the instructions on setting up the device for debugging, I was really pleased I&#39;d arbitrarily decided to install Eclipse on my MacOS, and not on my Windows partition, because of the text I&#39;ve highlighted in the Android hardware setup instructions I&#39;ve copied below:</p>
<blockquote>
<p>Set up your system to detect your device.</p>
<ul>
<li>If you&#39;re developing on Windows, you need to install a USB driver for adb. For an installation guide and links to OEM drivers, see the&#0160;<a href="http://developer.android.com/sdk/oem-usb.html" style="color: #4040ff;">OEM USB Drivers</a>&#0160;document.</li>
<li><span style="background-color: #ffff00;">If you&#39;re developing on Mac OS X, it just works.</span> Skip this step.</li>
<li>If you&#39;re developing on Ubuntu Linux, you need to add a&#0160;<code>udev</code>&#0160;rules file that contains a USB configuration for each type of device you want to use for development. In the rules file, each device manufacturer is identified by a unique vendor ID, as specified by the&#0160;<code>ATTR{idVendor}</code>&#0160;property. For a list of vendor IDs, see&#0160;<a href="http://developer.android.com/guide/developing/device.html#VendorIds">USB Vendor IDs</a>, below. To set up device detection on Ubuntu Linux:</li>
</ul>
</blockquote>
<p><em>(<a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html" target="_self">Gopinath</a> was really unhappy when I told him this. He has a MacBook, but decided to use Windows for his Android debugging. He spent ages finding and installing the right driver for his device :-).&#0160;</em></p>
<p>Whatever device you do use, make sure you selected a compatible Android SDK version when you first created your project. My Tablet is running <a href="http://en.wikipedia.org/wiki/Android_Ice_Cream_Sandwich#Ice_Cream_Sandwich_4.0.x" target="_blank">Ice Cream Sandwich</a>, so I just chose the the latest API (level 15) for mine.</p>
<p>To Run or Debug your app, right click on your project in the Package Explorer, and select either Run As... or Debug As... and then Android Application.</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016767203383970b-pi" style="display: inline;"><img alt="Pt4RunAs" class="asset  asset-image at-xid-6a0167607c2431970b016767203383970b" src="/assets/image_347977.jpg" style="display: block; margin-left: auto; margin-right: auto;" title="Pt4RunAs" /></a><br /><br /></p>
<p>If you&#39;ve setup your hardware or virtual device correctly, your app should be loaded to the device ready to use. (BTW I&#39;ve noticed that I often have to perform the Run As or Debug As operation twice before my app gets loaded onto the device - I&#39;m not sure if that&#39;s a bug or something I&#39;m doing wrong).</p>
<p>Start up the app on the device and it will look something like this:</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0163062c9b00970d-pi" style="display: inline;"><img alt="Pt4AndroidEmulator" class="asset  asset-image at-xid-6a0167607c2431970b0163062c9b00970d" src="/assets/image_323503.jpg" style="display: block; margin-left: auto; margin-right: auto;" title="Pt4AndroidEmulator" /></a><br /><em>(I&#39;m using the emulator here because I had to take a screenshot. The text is very big because I deliberately hardcoded large text in listentry.xml so it would be a reasonable size on my 10&quot; tablet. I&#39;ve not made any allowance for smaller screen sizes so it looks a bit cramped on the default emulator screen size).</em></p>
<p>You can click on an item on the list and it will be highlighted, but we&#39;ve not implemented any code to respond to those clicks yet. That&#39;s what we&#39;ll look at next time.</p>
<p>&#0160;</p>
