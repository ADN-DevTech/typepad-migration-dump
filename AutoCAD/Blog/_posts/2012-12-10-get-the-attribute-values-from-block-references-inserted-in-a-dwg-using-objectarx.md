---
layout: "post"
title: "Get the Attribute values from Block References inserted in a DWG using ObjectARX"
date: "2012-12-10 15:01:41"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/get-the-attribute-values-from-block-references-inserted-in-a-dwg-using-objectarx.html "
typepad_basename: "get-the-attribute-values-from-block-references-inserted-in-a-dwg-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Here’s how to obtain the attribute values of all blocks inserted into Model Space DWG file using ObjectARX…</p>  <pre style="font-family: ; background: white; color: ; line-height: normal"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 9.8pt"><div style="font-size: 8pt; font-family: consolas; background: white; color: black"><p style="margin: 0px"><span style="color: blue">#include</span> <span style="color: #a31515">&lt;dbobjptr.h&gt;</span></p><div style="font-family: ; background: white; color: "><p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">PrintBlockAttributes</font></span><font color="#000000">()</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the current database</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acdbHostApplicationServices</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#010001">workingDatabase</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">assert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// in this sample we will only process block references in model space;</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// it is also possible to have block references in paper space</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// but I will leave it up to you to update the code to do so</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbBlockTableRecordPointer</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pModelSpace</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">ACDB_MODEL_SPACE</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pDb</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForRead</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">assert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pModelSpace</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// request an iterator for the entities in the block table record</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbBlockTableRecordIterator</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pModelSpace</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">newIterator</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// iterate through each entity</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">( ; !</font><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">done</font></span><font color="#000000">(); </font><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">step</font></span><font color="#000000">()) </font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getEntityId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// we are only interested in block references;</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// ignore anything else</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbBlockReference</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pBlockReference</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForRead</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pBlockReference</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() != </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">)</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">continue</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// lets request the block reference for an attribute iterator</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectIterator</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pBlockReference</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">attributeIterator</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// iterate through each attribute and print its value</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">( ; !</font><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">done</font></span><font color="#000000">(); </font><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">step</font></span><font color="#000000">())</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">attributeId</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">objectId</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// open the attribute</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbAttribute</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pAttribute</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pBlockReference</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">openAttribute</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pAttribute</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">attributeId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForRead</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// finally; we are at a point where we have access tothe</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// value of the attribute -- for now, simply display it</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// AcDbAttribute is derived from AcDbText where the tag</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// value is stored</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ACHAR</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pTag</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAttribute</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">tag</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">assert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pTag</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ACHAR</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pValue</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pAttribute</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">textString</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">assert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pValue</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// display</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;Tag: %s = Value: %s\n&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pTag</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pValue</font></span><font color="#000000">);</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// we no longer need this attribute so lets close it</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// and clean up the memory</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pAttribute</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">close</font></span><font color="#000000">();</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> [] </font><span style="color: "><font color="#010001">pTag</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> [] </font><span style="color: "><font color="#010001">pValue</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// it is the programmer's responsibility to delete the</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// attribute iterator</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pAttributeIterator</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// it is the programmer's responsibility to delete the</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// block table record iterator</font></span></font></p><p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pIterator</font></span><font color="#000000">;</font></font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p><p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p><p style="margin: 0px"></font></font></span></font><font face="Consolas"><font style="font-size: 9.8pt"><font color="#000000"></font></font></font>&#160;</p></div></div></pre>
