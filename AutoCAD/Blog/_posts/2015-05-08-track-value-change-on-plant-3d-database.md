---
layout: "post"
title: "Track value change on Plant 3D Database"
date: "2015-05-08 11:57:48"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "Plant3D"
original_url: "https://adndevblog.typepad.com/autocad/2015/05/track-value-change-on-plant-3d-database.html "
typepad_basename: "track-value-change-on-plant-3d-database"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>On AutoCAD entities we cannot track changes, although we can simulate some sort of tracking mechanism, <a href="http://adndevblog.typepad.com/autocad/2013/04/find-which-properties-changed-on-modified-event.html">see this blog post</a>. So if you need to track geometric properties, like position, youâ€™ll probably need something as described.</p>  <p>Now on Plant 3D there is a actual database storing information: the PnPDatabase, which includes a list of tables (PnPTable), that represent the classes. And there are some interesting events, such as ColumnChanged event.</p>  <p>Below is a sample that uses this event to track changes on database values (in this case, the Manufacturer) of EngineeringItems.</p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;trackTableChanges&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CmdTrackChanges()<br />{<br />&#160; TrackDBTableChanges(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;EngineeringItems&quot;</span>,<br />&#160;&#160;&#160; <span style="color: blue">new</span>&#160;<span style="color: blue">string</span>[] { <span style="color: #a31515">&quot;Manufacturer&quot;</span> });<br />}<br /> <br /><span style="color: blue">private</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> TrackDBTableChanges(<br />&#160; <span style="color: blue">string</span> tableName, <span style="color: blue">string</span>[] columns)<br />{<br />&#160; <span style="color: #2b91af">PlantProject</span> currentProj =<br />&#160;&#160;&#160; <span style="color: #2b91af">PlantApplication</span>.CurrentProject;<br />&#160; <span style="color: #2b91af">PipingProject</span> pipeProj =<br />&#160;&#160;&#160; (<span style="color: #2b91af">PipingProject</span>)currentProj.ProjectParts[<span style="color: #a31515">&quot;Piping&quot;</span>];<br />&#160; <span style="color: #2b91af">DataLinksManager</span> dlm = pipeProj.DataLinksManager;<br />&#160; <span style="color: #2b91af">PnPDatabase</span> db = dlm.GetPnPDatabase();<br /> <br />&#160; <span style="color: green">// the table we want to track</span><br />&#160; <span style="color: #2b91af">PnPTable</span> engItemsTable = db.Tables[tableName];<br /> <br />&#160; <span style="color: green">// just the columns we want to track</span><br />&#160; _collunsToTrack = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt;(columns);<br /> <br />&#160; <span style="color: green">// start tracking</span><br />&#160; engItemsTable.ColumnChanged +=<br />&#160;&#160;&#160; engItemsTable_ColumnChanged;<br />}<br /> <br /><span style="color: blue">private</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt; _collunsToTrack = <span style="color: blue">null</span>;<br /> <br /><span style="color: blue">static</span>&#160;<span style="color: blue">void</span> engItemsTable_ColumnChanged<br />&#160; (<span style="color: blue">object</span> sender, <span style="color: #2b91af">PnPColumnChangeEventArgs</span> e)<br />{<br />&#160; <span style="color: green">// filter by column name</span><br />&#160; <span style="color: blue">if</span> (!(_collunsToTrack.Contains(e.Column.Name))) <span style="color: blue">return</span>;<br /> <br />&#160; <span style="color: green">// simple output</span><br />&#160; <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.<br />&#160;&#160;&#160; Editor.WriteMessage(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;{0} of item {1} changed from {2} to {3}&quot;</span>,<br />&#160;&#160;&#160; e.Column.Name, e.Row.RowId,<br />&#160;&#160;&#160; e.CurrentValue, e.ProposedValue);<br />}</pre>
