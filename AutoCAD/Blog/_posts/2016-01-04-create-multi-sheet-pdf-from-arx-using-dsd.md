---
layout: "post"
title: "Create multi sheet PDF from ARX using DSD"
date: "2016-01-04 07:39:40"
author: "Adam Nagy"
categories:
  - "Adam Nagy"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2016/01/create-multi-sheet-pdf-from-arx-using-dsd.html "
typepad_basename: "create-multi-sheet-pdf-from-arx-using-dsd"
typepad_status: "Publish"
---

<p>By&#0160;<a href="http://adndevblog.typepad.com/autocad/adam-nagy.html">Adam Nagy</a></p>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<p>We already have a <a href="http://adndevblog.typepad.com/autocad/2012/05/how-to-use-the-autodeskautocadpublishingpublisherpublishdsd-api-in-net.html">blog post</a> on doing this from <strong>.NET</strong>, but it could take a bit of time to convert the code to <strong>ARX</strong>, so here it is.<br />It&#39;s not doing exactly the same but close enough :)</p>
<p>You&#39;ll have to include <strong>acplmisc.h</strong>&#0160;and make sure your project links to&#0160;<strong>AcPublish_crx.lib</strong></p>
<div style="color: #000; font-family: &#39;Courier New&#39;, Courier, Monospace; font-size: 10pt;">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="background: #ffffff; color: #0000ff;">static</span> <span style="background: #ffffff; color: #0000ff;">void</span><span style="background: #ffffff; color: #000000;"> plot (</span><span style="background: #ffffff; color: #2b91af;">AcDbDatabase</span><span style="background: #ffffff; color: #000000;"> *</span><span style="background: #ffffff; color: #808080;">pDb</span><span style="background: #ffffff; color: #000000;">)</span><br /> <span style="background: #ffffff; color: #000000;">{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">CString</span><span style="background: #ffffff; color: #000000;"> pdfPath = </span><span style="background: #ffffff; color: #a31515;">&quot;C:\\temp\\pdf\\myPDF.pdf&quot;</span><span style="background: #ffffff; color: #000000;">; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">CString</span><span style="background: #ffffff; color: #000000;"> deviceName =&#0160;&#0160;L</span><span style="background: #ffffff; color: #a31515;">&quot;DWG To PDF.pc3&quot;</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">Acad</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2b91af;">ErrorStatus</span><span style="background: #ffffff; color: #000000;"> es = </span><span style="background: #ffffff; color: #2b91af;">Acad</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2f4f4f;">eOk</span><span style="background: #ffffff; color: #000000;">;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">const</span> <span style="background: #ffffff; color: #2b91af;">TCHAR</span><span style="background: #ffffff; color: #000000;"> *docName;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;es = </span><span style="background: #ffffff; color: #808080;">pDb</span><span style="background: #ffffff; color: #000000;">-&gt;getFilename(docName);&#0160;&#0160;&#0160;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcDbLayoutManager</span><span style="background: #ffffff; color: #000000;"> *layoutManager = </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;acdbHostApplicationServices()-&gt;layoutManager();</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcDbDictionary</span><span style="background: #ffffff; color: #000000;"> *layoutDict = </span><span style="background: #ffffff; color: #6f008a;">NULL</span><span style="background: #ffffff; color: #000000;">;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;es = </span><span style="background: #ffffff; color: #808080;">pDb</span><span style="background: #ffffff; color: #000000;">-&gt;getLayoutDictionary(layoutDict, </span><span style="background: #ffffff; color: #2b91af;">AcDb</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2b91af;">OpenMode</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2f4f4f;">kForRead</span><span style="background: #ffffff; color: #000000;">);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// Start collecting info for the DSD data</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcPlDSDEntries</span><span style="background: #ffffff; color: #000000;"> dsdEntries;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcDbDictionaryIterator</span><span style="background: #ffffff; color: #000000;"> *layoutIterator = layoutDict-&gt;newIterator();</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// If we only want to plot paper spaces and not the model layout</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcDbObjectId</span><span style="background: #ffffff; color: #000000;"> msId = acdbSymUtil()-&gt;blockModelSpaceId(</span><span style="background: #ffffff; color: #808080;">pDb</span><span style="background: #ffffff; color: #000000;">);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">for</span><span style="background: #ffffff; color: #000000;"> (; layoutIterator &amp;&amp; !layoutIterator-&gt;done(); layoutIterator-&gt;next())</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;{</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcDbObjectPointer</span><span style="background: #ffffff; color: #000000;">&lt;</span><span style="background: #ffffff; color: #2b91af;">AcDbLayout</span><span style="background: #ffffff; color: #000000;">&gt; layout(</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;layoutIterator-&gt;objectId(), </span><span style="background: #ffffff; color: #2b91af;">AcDb</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2b91af;">OpenMode</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2f4f4f;">kForRead</span><span style="background: #ffffff; color: #000000;">); </span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">if</span><span style="background: #ffffff; color: #000000;"> (layout-&gt;getBlockTableRecordId() == msId)</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">continue</span><span style="background: #ffffff; color: #000000;">;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">const</span> <span style="background: #ffffff; color: #2b91af;">ACHAR&#0160;</span><span style="background: #ffffff; color: #000000;">*layoutName;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;layout-&gt;getLayoutName(layoutName);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcPlDSDEntry</span><span style="background: #ffffff; color: #000000;"> dsdEntry;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;dsdEntry.setLayout(layoutName);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;dsdEntry.setDwgName(docName);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;dsdEntry.setTitle(layoutName);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;&#0160;&#0160;dsdEntries.append(dsdEntry); &#0160;&#0160;&#0160;&#0160;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;}</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #0000ff;">delete</span><span style="background: #ffffff; color: #000000;"> layoutIterator; </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;layoutDict-&gt;close();</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcPlDSDData</span><span style="background: #ffffff; color: #000000;"> dsdData;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setDSDEntries(dsdEntries);&#0160;&#0160;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setProjectPath(L</span><span style="background: #ffffff; color: #a31515;">&quot;c:\\temp\\pdf\\&quot;</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setLogFilePath(L</span><span style="background: #ffffff; color: #a31515;">&quot;c:\\temp\\pdf\\logdwf.log&quot;</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setSheetType(</span><span style="background: #ffffff; color: #2b91af;">AcPlDSDEntry</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2b91af;">SheetType</span><span style="background: #ffffff; color: #000000;">::</span><span style="background: #ffffff; color: #2f4f4f;">kMultiPDF</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setNoOfCopies(1);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setDestinationName(pdfPath);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setPromptForDwfName(</span><span style="background: #ffffff; color: #0000ff;">false</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;dsdData.setSheetSetName(L</span><span style="background: #ffffff; color: #a31515;">&quot;PublisherSet&quot;</span><span style="background: #ffffff; color: #000000;">);</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #2b91af;">AcPlPlotConfig</span><span style="background: #ffffff; color: #000000;"> *plotConfig;</span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #6f008a;">acplPlotConfigManager</span><span style="background: #ffffff; color: #000000;">-&gt;setCurrentConfig(plotConfig, deviceName);&#0160;&#0160;&#0160;&#0160;</span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;</span><span style="background: #ffffff; color: #008000;">// We need this for acplPublishExecute </span><br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;acedArxLoad(L</span><span style="background: #ffffff; color: #a31515;">&quot;AcPublish.arx&quot;</span><span style="background: #ffffff; color: #000000;">); </span><br /> <br /> <span style="background: #ffffff; color: #000000;">&#0160;&#0160;acplPublishExecute(dsdData, plotConfig, </span><span style="background: #ffffff; color: #0000ff;">false</span><span style="background: #ffffff; color: #000000;">);</span><br /> <span style="background: #ffffff; color: #000000;">}</span></div>
</div>
