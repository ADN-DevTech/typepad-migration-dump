---
layout: "post"
title: "Creating Link Templates using ActiveX API in VBA and Lisp"
date: "2012-12-19 17:21:18"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "ActiveX"
  - "AutoCAD"
  - "Gopinath Taget"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/creating-link-templates-using-activex-api-in-vba-and-lisp.html "
typepad_basename: "creating-link-templates-using-activex-api-in-vba-and-lisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p>Here is the sample VBA and VLisp code that shows how to create and delete link templates in AutoCAD. Do not forget to set references to CAO type library before running this code in AutoCAD's VBA IDE.</p>  <p><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">Sub</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> fCreateLinkTemplate()</font></span></font></p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pDB </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CAO.DbConnect</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pLTs </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CAO.LinkTemplates</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pLT </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CAO.LabelTemplate</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> pKeyDescs </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> CAO.KeyDescriptions</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> psDataSrc </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">String</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> psLinkTempName1 </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">String</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">Dim</font></span><span style="line-height: 11pt"><font color="#000000"> psLinkTempName2 </font></span><span style="line-height: 11pt"><font color="#0000ff">As</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">String</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; psDataSrc = </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#a31515">&quot;jet_dbsamples&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; psLinkTempName1 = </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#a31515">&quot;LTCreatedByVBCAO&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; psLinkTempName2 = </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#a31515">&quot;LTtobeDeleted&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'get the DBCONNECT object</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; Set pDB = ThisDrawing.Application.</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; GetInterfaceObject(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;CAO.DBConnect.16&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; Set pLTs = pDB.GetLinkTemplates(ThisDrawing)</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'prepare the keydescriptions</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; Set pKeyDescs = ThisDrawing.Application.</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; GetInterfaceObject(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;CAO.KeyDescriptions.16&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pKeyDescs.Add </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;TAG_NUMBER&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, kCaoTypeInteger</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pKeyDescs.Add </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Manufacturer&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, kCaoTypeText</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'create two Link Templates</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pLTs.Add psDataSrc, </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Catalog1&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Schema1&quot;</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;Computer&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, psLinkTempName1, pKeyDescs</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; pLTs.Add psDataSrc, </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Catalog2&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Schema2&quot;</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;Computer&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">, psLinkTempName2, pKeyDescs</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'created Link Templates</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; MsgBox </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;Created Link Templates : &quot;</font></span><span style="line-height: 11pt"><font color="#000000"> &amp; Chr(13) &amp; </font></span><span style="line-height: 11pt"><font color="#a31515">&quot;1) &quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> &amp; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; pLTs.Item(psLinkTempName1).Name _</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; &amp; Chr(13) &amp; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#a31515">&quot;2) &quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> &amp; pLTs.Item(psLinkTempName2).Name _</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'connect to the datasource</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pDB.Connect psDataSrc</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'delete the second linktemplate. </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'Comment the following statement if </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">'you want to see both the link templates</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; pLTs.Delete psLinkTempName2</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000"> </font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>    <p>And hereâ€™s the Visual Lisp code using the ActiveX API:</p>  <p>(defun c:CreateLT()    <br />&#160; (vl-load-com)    <br />&#160; (setq pDoc (vla-get-ActiveDocument (vlax-get-acad-object)))</p>  <p>&#160; ;get the DBConnect   <br />&#160; (setq pDBObj (vla-GetInterfaceObject    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (vlax-get-acad-object) &quot;CAO.dbConnect&quot;))    <br />&#160; (if (null pDBObj)    <br />&#160;&#160;&#160; (progn     <br />&#160;&#160;&#160;&#160;&#160; (alert &quot;Cannot create CAO Automation server.&quot;)     <br />&#160;&#160;&#160;&#160;&#160; (exit))) </p>  <p>&#160; ;get the linktemplates   <br />&#160; (setq pLTs(    <br />&#160;&#160;&#160;&#160;&#160;&#160; vlax-invoke-method pDBObj &quot;GetLinkTemplates&quot; pDoc))</p>  <p>&#160; ;prepare the keydescriptions   <br />&#160; (setq pKeyDescs (    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vla-GetInterfaceObject (vlax-get-acad-object)    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;CAO.KeyDescriptions&quot;))    <br />&#160; (vlax-invoke-method pKeyDescs    <br />&#160; &quot;ADD&quot; &quot;TAG_NUMBER&quot; 3 nil nil)    <br />&#160; (vlax-invoke-method pKeyDescs    <br />&#160; &quot;ADD&quot; &quot;Manufacturer&quot; 1 nil nil)</p>  <p>&#160; ;create two link templates   <br />&#160; (vlax-invoke-method pLTs &quot;ADD&quot; &quot;jet_dbsamples&quot;    <br />&#160; nil nil &quot;COMPUTER&quot; &quot;LTCreatedByVLispCAO&quot; pKeyDescs)    <br />&#160; (vlax-invoke-method pLTs &quot;ADD&quot; &quot;jet_dbsamples&quot;    <br />&#160; nil nil &quot;COMPUTER&quot; &quot;LTtobeDeleted&quot; pKeyDescs)</p>  <p>&#160; ;sample code to show how to delete the link template   <br />&#160; (vlax-invoke-method pLTs &quot;delete&quot; &quot;LTtobeDeleted&quot;)    <br />)</p>
