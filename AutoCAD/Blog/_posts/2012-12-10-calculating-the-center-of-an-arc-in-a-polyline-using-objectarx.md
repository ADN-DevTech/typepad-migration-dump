---
layout: "post"
title: "Calculating the Center of an Arc in a Polyline using ObjectARX"
date: "2012-12-10 15:14:24"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/12/calculating-the-center-of-an-arc-in-a-polyline-using-objectarx.html "
typepad_basename: "calculating-the-center-of-an-arc-in-a-polyline-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>The easiest way to do this is to construct an AcGeCircArc2d or AcGeCircArc3d    <br />object and then use its center() method to get the point you want.</p>  <p>The following function finds any arc segments in a lightweight polyline and    <br />identifies the center by dropping a point entity (AcDbPoint) in the calculated     <br />location.</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&lt;dbobjptr.h&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">show_centers</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{&#160;&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// UI for selecting an entity&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_name</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">en</font></span><font color="#000000">;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000">;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rc</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acedEntSel</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;Select LW polyline: &quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">en</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000">);&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">rc</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000">) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;Nothing selected.\n&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">rc</font></span><font color="#000000">);&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }&#160;&#160;&#160;&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// convert ads_name to object id&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">eId</font></span><font color="#000000">;&#160;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acdbGetObjectId</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">eId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">en</font></span><font color="#000000">);&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// open object&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbPolyline</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">eId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForRead</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() != </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">)&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;You did not select a LW polyline.\n&quot;</font></span><font color="#000000">);&#160;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the number of segments&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">segments</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">numVerts</font></span><font color="#000000">() - 1;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> = 0; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> &lt; </font><span style="color: "><font color="#010001">segments</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000">++) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {&#160;&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">segType</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">i</font></span><font color="#000000">) != </font><span style="color: "><font color="#010001">AcDbPolyline</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kArc</font></span><font color="#000000">) </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">continue</font></span><font color="#000000">;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get arc segment on polyline&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGeCircArc2d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">geArc</font></span><font color="#000000">;&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getArcSegAt</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">i</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">geArc</font></span><font color="#000000">);&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get center&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGePoint2d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">center</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">geArc</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">center</font></span><font color="#000000">();&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// create a point entity&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbPoint</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pPoint</font></span><font color="#000000">;</font></font></font></p>    <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">&#160;&#160;&#160; AcDbPoint</font></font></span><font style="font-size: 8pt"><font color="#000000"> *</font><span style="color: "><font color="#010001">pointPtr</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">AcDbPoint</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">center</font></span><font color="#000000">[0], </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">center</font></span><font color="#000000">[1], 0.0));</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">&#160;&#160;&#160; pPoint</font></font></span><font style="font-size: 8pt"><font color="#000000">.</font><span style="color: "><font color="#010001">acquire</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pointPtr</font></span><font color="#000000">);&#160;&#160;&#160; </font></font></font><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>   </div>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// add the point entity to the block table record&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// containing the selected polyline&#160;&#160;&#160; </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbBlockTableRecordPointer</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">curSpace</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPolyline</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">blockId</font></span><font color="#000000">(), </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForWrite</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">curSpace</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">curSpace</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">appendAcDbEntity</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPoint</font></span><font color="#000000">);&#160;&#160;&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;\n - center: [%f, %f]&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">center</font></span><font color="#000000">[0], </font><span style="color: "><font color="#010001">center</font></span><font color="#000000">[1]); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }&#160;&#160; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
