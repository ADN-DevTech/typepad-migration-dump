---
layout: "post"
title: "Handoverto with Transaction"
date: "2012-05-22 01:43:54"
author: "Xiaodong Liang"
categories:
  - ".NET"
  - "AutoCAD"
  - "ObjectARX"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/handoverto-with-transaction.html "
typepad_basename: "handoverto-with-transaction"
typepad_status: "Publish"
---

<p>By <a href="http://adhttp://adndevblog.typepad.com/manufacturing/xiaodong-liang.htmlet=" _self?="_self?">Xiaodong Liang</a></p>  <p>If you try to handover the object id of a Transaction resident object with a new object, you will receive an error eInvalidContext. In fact, you cannot call the function handOverTo() on Transaction resident objects. This means that you have to switch to common way to open the object (acdbOpenObject).&#160; This also applies to .NET.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%; color: blue">bool</span><span style="line-height: 140%"> test()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">{</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; ads_name ename; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; ads_point ptResult;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; ads_matrix adsmat; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">struct</span><span style="line-height: 140%"> resbuf *info; </span></p>    <div style="font-family: courier new; background: white; color: black; font-size: 8pt">     <p style="margin: 0px"><span style="line-height: 140%; color: green"></span></p>      <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160; // select one entity</span></p>   </div>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%"> rt = acedNEntSelP(_T(</span><span style="line-height: 140%; color: #a31515">&quot;\nselect an entity:&quot;</span><span style="line-height: 140%">),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ename,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ptResult,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%"> ,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; adsmat,</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;info);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%">( rt!= RTNORM) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; acutPrintf(_T(</span><span style="line-height: 140%; color: #a31515">&quot;\nFailure in acedNEntSelP&quot;</span><span style="line-height: 140%">)); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; AcDbObjectId old__ent_id;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; acdbGetObjectId(old__ent_id,ename); </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160; AcDbCircle* newCircle =</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> AcDbCircle(</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; AcGePoint3d(0,0,0),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; AcGeVector3d(0,0,1),</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 10);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// correct usage</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160; AcDbObject *pObj;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; Acad::ErrorStatus es1 = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; acdbOpenObject(pObj,old__ent_id,AcDb::kForWrite);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (pObj == NULL)</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; Acad::ErrorStatus es = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pObj-&gt;handOverTo(newCircle); </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">if</span><span style="line-height: 140%"> (es ==</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Acad::eObjectToBeDeleted) </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; newCircle-&gt;close();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">delete</span><span style="line-height: 140%"> pObj;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">true</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">else</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pObj-&gt;close();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">return</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160; }</span>&#160; </p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">// wrong usage: with Transaction</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">/* AcTransaction *pTrans = </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; actrTransactionManager-&gt;startTransaction();</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160; AcDbObject *pObj;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160; pTrans-&gt;getObject(pObj,</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; old__ent_id, </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; AcDb::kForWrite);</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160; if (pObj == NULL)</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160; // will get eInvalidContext</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160; Acad::ErrorStatus es = </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pObj-&gt;handOverTo(newCircle); </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; if (es ==</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Acad::eObjectToBeDeleted) </span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160; delete pObj;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160; actrTransactionManager-&gt;endTransaction();</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160;&#160; return true;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; else</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160; {</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160; actrTransactionManager-&gt;abortTransaction();</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160;&#160;&#160; return false;</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; }</span></p>    <p style="margin: 0px"><span style="line-height: 140%; color: green">&#160;&#160;&#160;&#160; */</span></p> </div>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">}</span></p> </div>
