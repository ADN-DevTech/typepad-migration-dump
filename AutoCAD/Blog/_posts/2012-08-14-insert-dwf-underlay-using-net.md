---
layout: "post"
title: "Insert DWF underlay using .NET"
date: "2012-08-14 13:48:54"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/insert-dwf-underlay-using-net.html "
typepad_basename: "insert-dwf-underlay-using-net"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>DWF underlays are represented by the <strong>DwfDefinition</strong> and <strong>DwfReference</strong> classes in the AutoCAD .NET API. Basically it is required to open the NOD (Named Object Dictionary) and get the DWF Definitions to create a new, so it can be used by the DWF Reference. </p>  <div style="font-family: ; background: white">   <p style="margin: 0px">     <div style="font-family: ; background: white">       <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span><font color="#a31515">&quot;dwfInsert&quot;</font></span><font color="#000000">)]</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">static</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">public</font></span><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> CommandInsertDWF()</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// acess the database</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Database</font></span><font color="#000000"> db = </font><span><font color="#2b91af">Application</font></span><font color="#000000">.DocumentManager.</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; MdiActiveDocument.Database;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// start the transaction</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">using</font></span><font color="#000000"> (</font><span><font color="#2b91af">Transaction</font></span><font color="#000000"> trans = db.TransactionManager.</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; StartTransaction())</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// get the NOD</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">DBDictionary</font></span><font color="#000000"> nod = trans.GetObject(</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; db.NamedObjectsDictionaryId, </font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForWrite) </font><span><font color="#0000ff">as</font></span><font color="#000000"> </font><span><font color="#2b91af">DBDictionary</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// get the key for DWF Definition</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">string</font></span><font color="#000000"> defDictKey = </font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">UnderlayDefinition</font></span><font color="#000000">.GetDictionaryKey(</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">typeof</font></span><font color="#000000">(</font><span><font color="#2b91af">DwfDefinition</font></span><font color="#000000">));</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// if the dictionary is not there, create</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (!nod.Contains(defDictKey))</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">using</font></span><font color="#000000"> (</font><span><font color="#2b91af">DBDictionary</font></span><font color="#000000"> dict = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">DBDictionary</font></span><font color="#000000">())</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; nod.SetAt(defDictKey, dict);</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; trans.AddNewlyCreatedDBObject(dict, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">true</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// open the dictionary</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">ObjectId</font></span><font color="#000000"> idDwfDef;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">DBDictionary</font></span><font color="#000000"> dwfDict = trans.GetObject(</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; nod.GetAt(defDictKey),</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForWrite) </font><span><font color="#0000ff">as</font></span><font color="#000000"> </font><span><font color="#2b91af">DBDictionary</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// create a new definition</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">using</font></span><font color="#000000"> (</font><span><font color="#2b91af">DwfDefinition</font></span><font color="#000000"> dwfDef = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">DwfDefinition</font></span><font color="#000000">())</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; dwfDef.SourceFileName = </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;d:\\kitchen.dwf&quot;</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; idDwfDef = dwfDict.SetAt(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;kitchen&quot;</font></span><font color="#000000">, dwfDef);</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; trans.AddNewlyCreatedDBObject(dwfDef, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">true</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// append to the model space</font></span></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">BlockTable</font></span><font color="#000000"> bt = trans.GetObject(</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; db.BlockTableId, </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForRead) </font><span><font color="#0000ff">as</font></span><font color="#000000"> </font><span><font color="#2b91af">BlockTable</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> btr = trans.GetObject(</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; bt[</font></font><font style="font-size: 8pt"><span><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">.ModelSpace],</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#2b91af">OpenMode</font></span><font color="#000000">.ForWrite) </font><span><font color="#0000ff">as</font></span><font color="#000000"> </font><span><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">using</font></span><font color="#000000"> (</font><span><font color="#2b91af">DwfReference</font></span><font color="#000000"> dwf = </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">DwfReference</font></span><font color="#000000">())</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; dwf.DefinitionId = idDwfDef;</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; btr.AppendEntity(dwf);</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; trans.AddNewlyCreatedDBObject(dwf, </font></font><font style="font-size: 8pt"><span><font color="#0000ff">true</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; trans.Commit();</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p>     </div>   </p> </div>
