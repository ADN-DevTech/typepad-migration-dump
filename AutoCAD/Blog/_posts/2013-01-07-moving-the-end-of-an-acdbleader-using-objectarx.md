---
layout: "post"
title: "Moving the end of an AcDbLeader using ObjectARX"
date: "2013-01-07 14:51:01"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/moving-the-end-of-an-acdbleader-using-objectarx.html "
typepad_basename: "moving-the-end-of-an-acdbleader-using-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>How can I programmatically alter the end vertex of a leader? When I call    <br />AcDbLeader::setVertexAt, an error is not returned but when I next move the mtext     <br />associated with the leader, the leader jumps back to its old position. I can do     <br />it interactively, using Grip Points.</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>The issue is that when you drag the grip point, you are not just setting the end    <br />vertex, but instead altering an internal value called the offset, which     <br />determines how the leaders ends with respect to the MText object. Unfortunately,     <br />there is currently no access to this offset through ObjectARX. You can,     <br />however, alter the value through ads_entmod. The following sample alters the     <br />leader object, then triggers the reactor function on the leader by changing the     <br />MText.</p>  <div style="font-family: ; background: white; color: ">   <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;dblead.h&quot;</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">gr</font></span><font color="#000000">()</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_name</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">acedEntSel</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;\nPlease pick leader&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pt</font></span><font color="#000000"> ) )</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">id</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acdbGetObjectId</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">eName</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000"> &lt;</font><span style="color: "><font color="#010001">AcDbLeader</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pLeader</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">id</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForRead</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pLeader</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">openStatus</font></span><font color="#000000">() == </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">eOk</font></span><font color="#000000">) </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">oldPt</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">asPnt3d</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">oldPt</font></span><font color="#000000"> ) = </font><span style="color: "><font color="#010001">pLeader</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">lastVertex</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">annoId</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pLeader</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">annotationObjId</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_point</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">newPt</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acedGetPoint</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">oldPt</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;\nNew point&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">newPt</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">asPnt3d</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">newPt</font></span><font color="#000000"> ) - </font><span style="color: "><font color="#010001">asPnt3d</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">oldPt</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nOffset is %f %f %f &quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">x</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">y</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">z</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">struct</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">resbuf</font></span><font color="#000000">*</font><span style="color: "><font color="#010001">pRb</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ads_entget</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">eName</font></span><font color="#000000">), *</font><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000">(<span style="color: "><font color="#010001">pTempRb=</font></span></font><span style="color: "><font color="#010001">pRb</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">=</font><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">rbnext</font></span><font color="#000000"> ) </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">restype</font></span><font color="#000000"> == 213 ) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">resval</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">rpoint</font></span><font color="#000000">[0] = </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">x</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">resval</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">rpoint</font></span><font color="#000000">[1] = </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">y</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pTempRb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">resval</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">rpoint</font></span><font color="#000000">[2] = </font><span style="color: "><font color="#010001">offset</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">z</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ads_entmod</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">pRb</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">L</font></span><span style="color: "><font color="#a31515">&quot;\nResult of entmod is %d&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> );</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now force an update on the annotation object</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcDbObjectPointer</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcDbObject</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">pObj</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">annoId</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcDb</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kForWrite</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pObj</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">assertWriteEnabled</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">RTNORM</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>   </div>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000"></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
