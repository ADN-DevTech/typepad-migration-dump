---
layout: "post"
title: "Mirroring plane from a mirroring matrix"
date: "2013-01-04 15:33:58"
author: "Gopinath Taget"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Gopinath Taget"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/mirroring-plane-from-a-mirroring-matrix.html "
typepad_basename: "mirroring-plane-from-a-mirroring-matrix"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/gopinath-taget.html">Gopinath Taget</a></p>  <p>Wondering how you can get a mirroring plane from a matrix passed into transformBy( ) during a MIRROR command?</p>  <p>Here I present one way to calculate a mirroring plane from a matrix passed into transformBy( ) during a MIRROR command. This is done using vector algebra.</p>  <p>if [M] is a transformation matrix passed in during a mirroring operation, then the mirror of an arbitrary point P will be [M]P.</p>  <p>We know that a mirroring plane is midway between the point P and its mirror [M]P,</p>  <p>so any point on the mirroring plane = ( 1/2) .(P+ [ M ]P ). This by the way is the same as a vector P projected on this plane. </p>  <p>This can also be written as:</p>  <p>Point on mirroring plane = ( 1/2) .([I]P+ [ M ]P)</p>  <p>Or</p>  <p>Point on mirroring plane = ( 1/2) .([I]+ [ M ]) x P</p>  <p>Here [ I ] is the identity matrix.</p>  <p>So the transformation matrix applied to find the projection on this plane is ( 1/2) .( [ I ] + [ M ] ). You may then take two arbitrary vectors to find projections on this plane - so you have 2 coplanar vectors. You may then find the cross product of these two to find a vector normal to them. You then take an origin, say (0,0,0) and transform with the above transformation matrix to find a point on this plane.</p>  <p> So now you have a point on the mirroring plane and a vector normal to it. With these you can construct a mirroring plane. The code below shows how to do this.</p>  <p>xform is the transformation matrix passed into transformBy during a mirroring operation (you can do this with an editor reactor checking to see when &quot;MIRROR&quot; happens)</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">AcGePoint3d origin(0,0,0);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">AcGeVector3d normal, Axis1, Axis2, Axis3, </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> XAxis(1,0,0), YAxis(0,1,0), ZAxis(0,0,1);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">AcGeMatrix3d Identity, Temp;&#160; </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">AcGePlane MirrorPlane;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">AcGeMatrix3d Mirror;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Consolas"></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">Identity.setToIdentity();</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">for</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#0000ff">int</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> i=0; i&lt;4; i++) {</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">for</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt"><font color="#0000ff">int</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> j=0; j&lt;4; j++) {</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; Temp(i,j) = 0.5*(Identity(i,j) + xform(i,j));</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">Axis1 = (XAxis.transformBy(Temp)).normalize();</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">Axis2 = (YAxis.transformBy(Temp)).normalize();</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">Axis3 = (ZAxis.transformBy(Temp)).normalize();</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">origin = origin.transformBy(Temp);</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Choose two vectors out of the three Axis1, </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Axis2 and Axis3 to find the cross product. </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Make sure that the two selected vectors are of </font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#008000">// unit length and are not parallel</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> (Axis1.length() == 1 &amp;&amp; Axis2.length() == 1 &amp;&amp;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> fabs(Axis1.dotProduct(Axis2)) != 1) {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> normal = (Axis1.crossProduct(Axis2)).normalize();</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">} </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">else</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">if</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> (Axis2.length() == 1 &amp;&amp; Axis3.length() == 1 &amp;&amp;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> fabs(Axis2.dotProduct(Axis3)) != 1) {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> normal = (Axis2.crossProduct(Axis3)).normalize();</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">} </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt"><font color="#0000ff">else</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt"><font color="#0000ff">if</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> (Axis3.length() == 1 &amp;&amp; Axis1.length() == 1 &amp;&amp;&#160; </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> fabs(Axis3.dotProduct(Axis1)) != 1) {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000"> normal = (Axis3.crossProduct(Axis1)).normalize();</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">MirrorPlane.set(origin, normal); </font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#008000">// This is the mirroring plane</font></span></font></p> </div>
