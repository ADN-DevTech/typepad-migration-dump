---
layout: "post"
title: "extract information about the viewport dependent UCS's from vlisp"
date: "2013-03-15 03:52:00"
author: "Xiaodong Liang"
categories:
  - "AutoCAD"
  - "LISP"
  - "Xiaodong Liang"
original_url: "https://adndevblog.typepad.com/autocad/2013/03/extract-information-about-the-viewport-dependent-ucss-from-vlisp.html "
typepad_basename: "extract-information-about-the-viewport-dependent-ucss-from-vlisp"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/xiaodong-liang.html" target="_self">Xiaodong Liang</a></p>
<p><strong>Issue      <br /></strong>When I use the following code in a drawing that has several model space&#0160; viewports where each viewport has a different UCS, the name of the UCS that was set in the active viewport at the time the function was invoked always displays. How can I get information about the viewport-dependent UCS&#39;s using Visual LISP?</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> c:vp_ucs <span style="color: #ff0000;">(</span><span style="color: #0000ff;">/</span><span style="color: #ff0000;">)</span>       <br />&#0160;<span style="color: #ff0000;">(</span>foreach elem <span style="color: #ff0000;">(</span>vports<span style="color: #ff0000;">)</span>       <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setvar</span>&#0160;<span style="color: #ff00ff;">&quot;cvport&quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span> elem<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff00ff;">&quot;\n&quot;</span><span style="color: #ff0000;">)</span>       <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">getvar</span>&#0160;<span style="color: #ff00ff;">&quot;UCSNAME&quot;</span><span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>       <br />&#0160;<span style="color: #ff0000;">)</span>       <br /><span style="color: #ff0000;">)</span></span></p>
<p><strong>Solution      <br /></strong>This is a known problem.You can work around this by using the following ActiveX functions in Visual LISP as shown in the following sample code. To run it, make sure the drawing have some named UCS and the view ports apply the UCS.</p>
<p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt;"><span style="color: #ff0000;">(</span><span style="color: #0000ff;">defun</span> c:Test <span style="color: #ff0000;">(</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vl-load-com</span><span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;Enable ActiveX functions       <br /></span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> a_app <span style="color: #ff0000;">(</span>VLAX-GET-ACAD-OBJECT<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;Pointer to Acad Application       <br /></span>&#0160;&#0160;&#0160; a_doc <span style="color: #ff0000;">(</span>VLA-GET-ACTIVEDOCUMENT a_app<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;Pointer to ActiveDocument       <br /></span>&#0160;&#0160;&#0160; oldvar <span style="color: #ff0000;">(</span><span style="color: #0000ff;">getvar</span>&#0160;<span style="color: #ff00ff;">&quot;cmdecho&quot;</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">setvar</span>&#0160;<span style="color: #ff00ff;">&quot;cmdecho&quot;</span>&#0160;<span style="color: #008000;">0</span><span style="color: #ff0000;">)</span>      <br /><span style="background-color: #e6e6e6; color: #800080;">;Iterate through the various viewports by setting them active and then extracting the UCS name.       <br /></span>&#0160;<span style="color: #ff0000;">(</span>foreach itm <span style="color: #ff0000;">(</span>vports<span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setvar</span>&#0160;<span style="color: #ff00ff;">&quot;CVPORT&quot;</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">car</span> itm<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">command</span>&#0160;<span style="color: #ff00ff;">&quot;.redraw&quot;</span><span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;Force a command interaction with acad application to obtain the UCSNAME       <br /></span>&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">setq</span> oUCS <span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-get-activeucs</span> a_doc<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;&#0160; <span style="color: #ff0000;">(</span><span style="color: #0000ff;">print</span>&#0160;<span style="color: #ff0000;">(</span><span style="color: #0000ff;">vla-get-name</span> oUCS<span style="color: #ff0000;">)</span><span style="color: #ff0000;">)</span>      <br />&#0160;<span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">(</span><span style="color: #0000ff;">setvar</span>&#0160;<span style="color: #ff00ff;">&quot;cmdecho&quot;</span> oldvar<span style="color: #ff0000;">)</span>&#0160;<span style="background-color: #e6e6e6; color: #800080;">;reset cmdecho setvar back to its original state       <br /></span><span style="color: #ff0000;">(</span><span style="color: #0000ff;">princ</span><span style="color: #ff0000;">)</span>      <br /><span style="color: #ff0000;">)</span></span></p>
