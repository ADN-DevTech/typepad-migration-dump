---
layout: "post"
title: "Storing and retrieving handles from a resbuf using the .NET API"
date: "2012-06-20 11:45:01"
author: "Madhukar Moogala"
categories:
  - ".NET"
  - "AutoCAD"
  - "Stephen Preston"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/storing-and-retrieving-handles-from-a-resbuf-using-the-net-api.html "
typepad_basename: "storing-and-retrieving-handles-from-a-resbuf-using-the-net-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/stephen-preston.html">Stephen Preston</a></p>  <p>Here is some (fairly contrived) code to demonstrate one way to store a handle in a result buffer and then retrieve it later. If you’re storing data in an Xrecord, then you wouldn’t normally store the Handle - you’d use a HardPointerId or SoftPointerId instead. You’re more likely to store Handles in Xdata. Xdata doesn’t allow you to store DXF codes below 1000, which excludes hard and soft pointers. The benefit of using hard/soft pointers is that deep clone translation of linked entities is taken care of for you. </p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">Document</span><span style="line-height: 140%"> doc = </span><span style="line-height: 140%; color: #2b91af">Application</span><span style="line-height: 140%">.DocumentManager.MdiActiveDocument;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">Database</span><span style="line-height: 140%"> db = doc.Database;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">Editor</span><span style="line-height: 140%"> ed = doc.Editor;&#160; </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">//Use an arbitrary ObjectId as an example</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">ObjectId</span><span style="line-height: 140%"> id = db.NamedObjectsDictionaryId;</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ed.WriteMessage(</span><span style="line-height: 140%; color: #a31515">&quot;\nObjectId of NOD = &quot;</span><span style="line-height: 140%"> + id.ToString());</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">//Add the Handle to a resbuf</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%"> buf = </span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">ResultBuffer</span><span style="line-height: 140%">(</span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">((</span><span style="line-height: 140%; color: blue">int</span><span style="line-height: 140%">)</span><span style="line-height: 140%; color: #2b91af">DxfCode</span><span style="line-height: 140%">.Handle, id.Handle));</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: green">//Retrieve the Handle and use it to construct an ObjectId</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">TypedValue</span><span style="line-height: 140%">[] arr = buf.AsArray();</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: blue">long</span><span style="line-height: 140%"> val = </span><span style="line-height: 140%; color: #2b91af">Convert</span><span style="line-height: 140%">.ToInt64(arr[0].Value.ToString(), 16);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">Handle</span><span style="line-height: 140%"> hCG = </span><span style="line-height: 140%; color: blue">new</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Handle</span><span style="line-height: 140%">(val);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; </span><span style="line-height: 140%; color: #2b91af">ObjectId</span><span style="line-height: 140%"> newId = db.GetObjectId(</span><span style="line-height: 140%; color: blue">false</span><span style="line-height: 140%">, hCG, 0);</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160; ed.WriteMessage(</span><span style="line-height: 140%; color: #a31515">&quot;\nObjectId using the handle = &quot;</span><span style="line-height: 140%"> + id.ToString());</span></p> </div>
