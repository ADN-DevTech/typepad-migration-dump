---
layout: "post"
title: "Capturing a Screen Shot using ObjectARX"
date: "2013-01-30 13:41:52"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/capturing-a-screen-shot-using-objectarx.html "
typepad_basename: "capturing-a-screen-shot-using-objectarx"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><strong>Issue</strong></p>  <ol>   <li>How to capture the screen shot of a Viewport to save it to an image file? </li>    <li>Is it possible to temporarily display an image over the Viewport or alter the Viewport display? </li> </ol>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>There are two AcGs functions in ObjectARX SDK that can be used to get the screen shot of the specified Viewport in AutoCAD and also to set an image to be displayed in a specified Viewport. </p>  <p>The functions are:</p>  <ul>   <li>acgsGetScreenShot() </li>    <li>acgsDisplayImage() </li> </ul>  <p>The function acgsGetScreenShot() will get you the pointer to an AcGsScreenShot object for the specified viewport number. When in TILEMODE 1, just specify the Viewport that you are interested in or just specify “0” to get the entire ModelSpace (and same is the case with PaperSpace). Similarly just specify the Viewport number you are interested in if the TILEMODE is 0 (i.e. in PaperSpace). Also if you specify viewport number of 1 in TILEMODE 0 then you will get only the entities that exist in the PaperSpace.</p>  <p>You can get the image data using the method getScanline() of the AcGsScreenShot class. Using this you can fill in an array of truecolor long words which essentially will be the ARBG data. This data can be used to create an image file. You can use the ATIL SDK to create a bitmap or JPG easily from the image data. </p>  <p>The function acgsDisplayImage() on the other hand takes an array of truecolor long words and displays the image at the specified location on a specified Viewport. The image will stay till a redraw is called.</p>  <p>This function can be used to:</p>  <ol>   <li>Show a temporary external image quickly. </li>    <li>Blank the entire view port temporarily. </li>    <li>Change the colors of the Viewport. Say inverting the colors of the Viewport. </li> </ol>  <p>Note:The acgsGetScreenShot() does not get you the shaded or rendered view.</p>  <p>Here’s some code which shows how to use the functions, to use the Atil libs you need to link with the headers and libs in the Atil folder of the ObjectARX SDK:</p>  <div style="font-family: ; background: white; color: "><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">         <div style="font-size: 8pt; font-family: consolas; background: white; color: black">           <p style="margin: 0px"><span style="color: green">// by Fenton Webb, DevTech, 1/30/2013</span></p>         </div>          <p style="margin: 0px"><!--EndFragment-->// screen shoots the view details as a BMP</p>       </font></font></span>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">bool</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">R</font></span><span style="color: "><font color="#010001">ecordViewDetails</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">fieldWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">fieldHeight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">position</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">target</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">upVector</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">iVP</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">getCVPort</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Compute the viewport dimensions.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nLeft</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBottom</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nRight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nTop</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">iImageWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">iImageHeight</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acgsGetViewportInfo</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">iVP</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nLeft</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBottom</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nRight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nTop</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">iImageWidth</font></span><font color="#000000">&#160; = </font><span style="color: "><font color="#010001">nRight</font></span><font color="#000000"> - </font><span style="color: "><font color="#010001">nLeft</font></span><font color="#000000"> + 1;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">iImageHeight</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">nTop</font></span><font color="#000000"> - </font><span style="color: "><font color="#010001">nBottom</font></span><font color="#000000"> + 1;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Size</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">size</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">iImageWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">iImageHeight</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModel</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">bytesPerRow</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">iImageWidth</font></span><font color="#000000">, </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModelAttributes</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">k32</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">iImageHeight</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Create an ATIL image for accepting the rendered image.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">autoBuff</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000">]);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pSnapshotData</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">autoBuff</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">get</font></span><font color="#000000">();&#160; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// see if there is a GS view created</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGsView</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pView</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">acgsGetGsView</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">iVP</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">); </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if not </font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// then we must be in 2D wireframe mode, so use acgsGetScreenShot</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">AcGsScreenShot</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">autoScreenShot</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">acgsGetScreenShot</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">iVP</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">AcGsScreenShot</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">screenShot</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">autoScreenShot</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">get</font></span><font color="#000000">(); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// auto_ptr still owns the pointer.</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">screenShot</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">w</font></span><font color="#000000"> = 0, </font><span style="color: "><font color="#010001">h</font></span><font color="#000000"> = 0, </font><span style="color: "><font color="#010001">d</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">screenShot</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getSize</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">w</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">h</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">d</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pBufTemp</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pSnapshotData</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">row</font></span><font color="#000000"> = 0; </font><span style="color: "><font color="#010001">row</font></span><font color="#000000"> &lt; </font><span style="color: "><font color="#010001">h</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">row</font></span><font color="#000000">++)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">memcpy</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pBufTemp</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">screenShot</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getScanline</font></span><font color="#000000">(0, </font><span style="color: "><font color="#010001">row</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// convert from RGBA to BGRA</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pColor</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pBufTemp</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> = 0; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> &lt; </font><span style="color: "><font color="#010001">w</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000">++)&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Slow but it works</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">temp</font></span><font color="#000000"> = *</font><span style="color: "><font color="#010001">pColor</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; *</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pColor</font></span><font color="#000000"> = *(</font><span style="color: "><font color="#010001">pColor</font></span><font color="#000000"> + 2);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; *(</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pColor</font></span><font color="#000000"> + 2) = </font><span style="color: "><font color="#010001">temp</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pColor</font></span><font color="#000000"> += 4;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pBufTemp</font></span><font color="#000000"> += </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImage</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">constructAtilImg</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">reinterpret_cast</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">*&gt;(</font><span style="color: "><font color="#010001">pSnapshotData</font></span><font color="#000000">), </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">w</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">h</font></span><font color="#000000">, 32, 0);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">autodeleter</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// auto_ptr now owns the image</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">writeImageFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">kBMP</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nFailed to write image file %s&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nSuccessfully written %s&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">snapGSView</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">iImageWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">iImageHeight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">fieldHeight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">fieldWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">position</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">target</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">upVector</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px">&#160;</p>    <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">bool</font></font></span><font style="font-size: 8pt"><font color="#000000"> s</font><span style="color: "><font color="#010001">napGSView</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">AcGsView</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">width</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">height</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">fieldWidth</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">fieldHeight</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">position</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGePoint3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">target</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGeVector3d</font></span><font color="#000000"> &amp;</font><span style="color: "><font color="#010001">upVector</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Size</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">size</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">width</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">height</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModel</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">bytesPerRow</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">width</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModelAttributes</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">k32</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">height</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Create an ATIL image for accepting the rendered image.</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">apCharBuffer</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000">]);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pSnapshotData</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">apCharBuffer</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">get</font></span><font color="#000000">();&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">//&#160; auto_ptr still owns the buffer.</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// in shaded mode (from GS)</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImage</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">constructAtilImg</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pSnapshotData</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBufferSize</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">nBytesPerRow</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">width</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">height</font></span><font color="#000000">, 32, 0);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#010001">autodeleter</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">std</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">auto_ptr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">&gt;(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">); </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// auto_ptr now owns the image</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getSnapShot</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">AcGsDCPoint</font></span><font color="#000000">(0, 0));</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// add a temp image to invert the image. do we have a better way to turn an image around?</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">imgTempForInverted</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">read</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">(), </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Offset</font></span><font color="#000000">(0, 0), </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kBottomUpLeftRight</font></span><font color="#000000">));</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; *</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImage</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">imgTempForInverted</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">writeImageFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImage</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">kBMP</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">))</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nFailed to write image file %s&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nSuccessfully written %s&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">imagePath</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// record the view data</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">fieldHeight</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">fieldHeight</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">fieldWidth</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">fieldWidth</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">position</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">position</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">target</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">target</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">upVector</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pView</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">upVector</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>   </div>    <p style="margin: 0px"><font color="#000000" face="Consolas"></font></p>    <div style="font-family: ; background: white; color: ">     <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">bool</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">writeImageFile</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">eFormatType</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000">, </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">wchar_t</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">isValid</font></span><font color="#000000">());</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(!</font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">isValid</font></span><font color="#000000">())</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">PathFileExists</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">))</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DeleteFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">/*if(PathFileExists(pFileName)) {</font></span></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; if(IsFileReadOnly(pFileName)) {</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; RemoveReadonlyAttribute(pFileName);</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; DeleteFile(pFileName);</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; }</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">&#160; }*/</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">PathFileExists</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">))</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RowProviderInterface</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">read</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pImageSource</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">(), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Offset</font></span><font color="#000000">(0,0));</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERTE</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(!</font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileWriteDescriptor</font></span><font color="#000000">&#160; *</font><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ImageFormatCodec</font></span><font color="#000000">&#160;&#160;&#160;&#160; *</font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kJPG</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">JfifFormatCodec</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kPNG</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">PngFormatCodec</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kTIF</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TiffFormatCodec</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kBMP</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">BmpFormatCodec</font></span><font color="#000000">();</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERTE</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000">)</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(!</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileWriteDescriptor</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">isCompatibleFormatCodec</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000">, </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; &amp;(</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">dataModel</font></span><font color="#000000">()), </font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">())) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileWriteDescriptor</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pCodec</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERTE</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#ifdef</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">UNICODE</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#ifndef</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#010001">_ADESK_MAC_</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">fs</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">((</font><span style="color: "><font color="#010001">lstrlen</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">) + 1) * </font><span style="color: "><font color="#0000ff">sizeof</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; (</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Byte</font></span><font color="#000000"> *) </font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kUTF_16</font></span><font color="#000000">), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kFilePath</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#else</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">fs</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">((</font><span style="color: "><font color="#010001">lstrlen</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">) + 1) * </font><span style="color: "><font color="#0000ff">sizeof</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000">), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; (</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Byte</font></span><font color="#000000"> *) </font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kUTF_32</font></span><font color="#000000">), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kFilePath</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#else</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">fs</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">lstrlen</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">) + 1, </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; (</font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Byte</font></span><font color="#000000"> *) </font><span style="color: "><font color="#010001">pFileName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">StringBuffer</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kASCII</font></span><font color="#000000">), </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FileSpecifier</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kFilePath</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">#endif</font></font></span></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setFileSpecifier</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">fs</font></span><font color="#000000">))</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">createImageFrame</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">dataModel</font></span><font color="#000000">(), </font><span style="color: "><font color="#010001">pPipe</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">());</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kPNG</font></span><font color="#000000">) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FormatCodecPropertyInterface</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FormatCodecPropertyInterface</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kCompression</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">PngCompression</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pPngComp</font></span><font color="#000000"> = (</font><span style="color: "><font color="#010001">PngCompression</font></span><font color="#000000">*)(</font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ( </font><span style="color: "><font color="#010001">pPngComp</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> ) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Why not compress all we can? </font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pPngComp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">selectCompression</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">PngCompressionType</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kHigh</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pPngComp</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000">; </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">formatType</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">kTIF</font></span><font color="#000000">) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FormatCodecPropertyInterface</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">getProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">FormatCodecPropertyInterface</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kCompression</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TiffCompression</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pComp</font></span><font color="#000000"> = (</font><span style="color: "><font color="#010001">TiffCompression</font></span><font color="#000000">*)(</font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ( </font><span style="color: "><font color="#010001">pComp</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> ) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// G4 is only valid for 1 bit images. </font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ( </font><span style="color: "><font color="#010001">pComp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">selectCompression</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TiffCompressionType</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kCCITT_FAX4</font></span><font color="#000000">) == </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000"> ) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// So if that fails, resort to LZW now that it is patent free</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ( </font><span style="color: "><font color="#010001">pComp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">selectCompression</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TiffCompressionType</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kLZW</font></span><font color="#000000">) == </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000"> ) {</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// If that fails (and is shouldn't, be) then set none.</font></span></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pComp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">selectCompression</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TiffCompressionType</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kNone</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pFWD</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pComp</font></span><font color="#000000">);</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pProp</font></span><font color="#000000">; </font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pProp</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>      <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>      <div style="font-family: ; background: white; color: ">       <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// get the current vp</font></font></span></p>        <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int </font></font></span><font style="font-size: 8pt"><span style="color: "><font color="#010001">getCVPort</font></span><font color="#000000">()</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">struct</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">resbuf</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rb</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">ads_getvar</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;CVPORT&quot;</font></span><font color="#000000">), &amp;</font><span style="color: "><font color="#010001">rb</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rb</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">resval</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">rint</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Atil</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">DataModel</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">colorSpace</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> *&amp;</font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">)</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Setup a color space, with palette if needed</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModel</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pDm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">; </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000"> == 8) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbColor</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">space</font></span><font color="#000000">[256];</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbPaletteModel</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pPM</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbPaletteModel</font></span><font color="#000000">();</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pPM</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(!</font><span style="color: "><font color="#010001">pPM</font></span><font color="#000000">)</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pDm</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pPM</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">palette</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000"> += </font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> = 0; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> &lt; </font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">; </font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> += 4)</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">space</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">i</font></span><font color="#000000"> / 4] = </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbColor</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">palette</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">i</font></span><font color="#000000">+2],</font><span style="color: "><font color="#010001">palette</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">i</font></span><font color="#000000">+1],</font><span style="color: "><font color="#010001">palette</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">i</font></span><font color="#000000">], 255);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pPM</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">setEntries</font></span><font color="#000000">(0, 256, (</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbColor</font></span><font color="#000000"> *)&amp;</font><span style="color: "><font color="#010001">space</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; } </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pDm</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbModel</font></span><font color="#000000">(32);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pDm</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pDm</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">Atil</font></font></span><font style="font-size: 8pt"><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">constructAtilImg</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">char</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">, </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">bufferSize</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">rowBytes</font></span><font color="#000000">, </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">xSize</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">unsigned</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ySize</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">)</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((8 != </font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000">) &amp;&amp; (32 != </font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000">)) </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">) </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((</font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000"> &lt; 0) || (</font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000"> &gt; 255)) </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> ((</font><span style="color: "><font color="#010001">xSize</font></span><font color="#000000"> &lt;= 0) || (</font><span style="color: "><font color="#010001">ySize</font></span><font color="#000000"> &lt;= 0)) </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pImg</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Size</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">size</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">xSize</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">ySize</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// construct the Atil::Image object</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Check the buffer for size and definition</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">bufferSize</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (!</font><span style="color: "><font color="#010001">rowBytes</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// did they allocate enough?</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">rowBytes</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">ySize</font></span><font color="#000000"> &gt; </font><span style="color: "><font color="#010001">bufferSize</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModel</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pM</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">colorSpace</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">paletteSize</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pM</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">pM</font></span><font color="#000000">)</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">try</font></span><font color="#000000"> {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// BEWARE: pRGBData may be moved in colorSpace</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImg</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pRGBData</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">bufferSize</font></span><font color="#000000">,</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">rowBytes</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">size</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">pM</font></span><font color="#000000">);&#160; </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; } </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ATILException</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pExpCon</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// image construction failure</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pExpCon</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pM</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImg</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pM</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">else</font></span><font color="#000000"> {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbModel</font></span><font color="#000000">&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#010001">rgbM</font></span><font color="#000000">(32);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">RgbGrayModel</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">gM</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ImagePixel</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">initialColor</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000"> == 32 ? </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModelAttributes</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kRgba</font></span><font color="#000000"> : </font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">DataModelAttributes</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">kGray</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">initialColor</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">setToZero</font></span><font color="#000000">();</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">try</font></span><font color="#000000"> {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImg</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">Image</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">size</font></span><font color="#000000">,</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">colorDepth</font></span><font color="#000000"> == 32 ? &amp;</font><span style="color: "><font color="#010001">rgbM</font></span><font color="#000000"> : &amp;</font><span style="color: "><font color="#010001">gM</font></span><font color="#000000">,</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">initialColor</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; } </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">catch</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">Atil</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ATILException</font></span><font color="#000000">* </font><span style="color: "><font color="#010001">pExpCon</font></span><font color="#000000">) {</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// image construction failure</font></span></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pExpCon</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pImg</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_ASSERT</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#010001">pImg</font></span><font color="#000000">);</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pImg</font></span><font color="#000000">;</font></font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>        <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>     </div>   </div> </div>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">bool</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">getTempImgFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">fileName</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Here we create a temp bmp file as a transitional file</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">tempDic</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">];</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; ::</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">memset</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tempDic</font></span><font color="#000000">,0,</font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">DWORD</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">nRetSize</font></span><font color="#000000"> = ::</font><span style="color: "><font color="#010001">GetTempPath</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">tempDic</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">nRetSize</font></span><font color="#000000"> &gt; </font><span style="color: "><font color="#010001">MAX_PATH</font></span><font color="#000000"> || </font><span style="color: "><font color="#010001">nRetSize</font></span><font color="#000000"> == 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">const</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> * </font><span style="color: "><font color="#010001">tempStr</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;C:\\temp&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">wcscpy_s</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tempDic</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">tempStr</font></span><font color="#000000">) != 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (::</font><span style="color: "><font color="#010001">PathFileExists</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tempStr</font></span><font color="#000000">) == </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000"> &amp;&amp;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; ::</font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">CreateDirectory</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tempStr</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">NULL</font></span><font color="#000000">) == </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// create the temp file whose prefix is &quot;img&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (::</font><span style="color: "><font color="#010001">GetTempFileName</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">tempDic</font></span><font color="#000000">,</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;tmp&quot;</font></span><font color="#000000">),0,</font><span style="color: "><font color="#010001">fileName</font></span><font color="#000000">) == 0)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now split the filepath into its individual components</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">TCHAR</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">drive</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">_MAX_DRIVE</font></span><font color="#000000">], </font><span style="color: "><font color="#010001">dir</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">_MAX_DIR</font></span><font color="#000000">], </font><span style="color: "><font color="#010001">fname</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">_MAX_FNAME</font></span><font color="#000000">], </font><span style="color: "><font color="#010001">ext</font></span><font color="#000000">[</font><span style="color: "><font color="#010001">_MAX_EXT</font></span><font color="#000000">]; </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_tsplitpath</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">fileName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">drive</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">dir</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">fname</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">ext</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">_stprintf</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">fileName</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;%s%s%s.bmp&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">drive</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">dir</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">fname</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">true</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>
