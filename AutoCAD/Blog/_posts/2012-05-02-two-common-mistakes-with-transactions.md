---
layout: "post"
title: "Two common mistakes with Transactions"
date: "2012-05-02 13:55:00"
author: "Madhukar Moogala"
categories:
  - ".NET"
  - "AutoCAD"
  - "Stephen Preston"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/two-common-mistakes-with-transactions.html "
typepad_basename: "two-common-mistakes-with-transactions"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/stephen-preston.html">Stephen Preston</a></p>  <p>Maybe this will turn into a series of common mistakes&#160; <img style="border-bottom-style: none; border-right-style: none; border-top-style: none; border-left-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="/assets/image_594410.jpg" />. </p>  <p>My <a href="http://adndevblog.typepad.com/autocad/2012/05/disabled-event-handlers.html">last post</a> was about event handler exception handling, and <a href="http://adndevblog.typepad.com/autocad/2012/04/unknown-command-when-debugging.html">Adam wrote a note about unknown commands</a>. Now, here are two very common mistakes people make with Transactions when they first start using the AutoCAD .NET API that can waste hours of time debugging (and make you feel really stupid when you find them <img style="border-bottom-style: none; border-right-style: none; border-top-style: none; border-left-style: none" class="wlEmoticon wlEmoticon-confusedsmile" alt="Confused smile" src="/assets/image_102048.jpg" />).</p>  <p><strong>Forgetting to commit a Transaction</strong></p>  <p>I once spent hours as a young and innocent AutoCAD .NET programmer trying to work out why the entities I was trying to add to the database weren’t there after my code had run. The problem was simply that I’d forgotten to call Transaction.Commit() before I Disposed of the Transaction. An uncommitted Transaction is Aborted when it is Disposed, so every change you made to the Database in the Transaction is rolled back.</p>  <p>This is the first thing to check when something you expect to have been added to the database by your code isn’t there.</p>  <p><strong>Forgetting to end a Transaction</strong></p>  <p>A typical symptom of forgetting to end your Transaction before you return control to AutoCAD is that AutoCAD graphics will start to behave strangely. Often you’ll notice that the entity you just added to the drawing isn’t displaying at all. And when you close AutoCAD you’ll either see an error dialog, or the Visual Studio Output window will show a non-zero return value from acad.exe.</p>  <p>The best way to ensure you clean up your Transactions is to make use of the Using statement. Here is some very basic VB.NET to demonstrate:</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; &lt;CommandMethod(</span><span style="line-height: 140%; color: #a31515">&quot;MyCommand&quot;</span><span style="line-height: 140%">)&gt; _</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Public</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span><span style="line-height: 140%"> MyCommand()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">Using</span><span style="line-height: 140%"> tr </span><span style="line-height: 140%; color: blue">As</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: #2b91af">Transaction</span><span style="line-height: 140%"> = db.TransactionManager.StartTransaction</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: green">'Do stuff</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tr.Commit()</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Using</span></p>    <p style="margin: 0px"><span style="line-height: 140%">&#160;&#160;&#160; </span><span style="line-height: 140%; color: blue">End</span><span style="line-height: 140%"> </span><span style="line-height: 140%; color: blue">Sub</span></p>    <p style="margin: 0px"></p> </div>
