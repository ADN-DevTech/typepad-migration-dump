---
layout: "post"
title: "DIESEL expression in menu label not evaluated when used with AddMenuItem()"
date: "2012-05-08 03:28:26"
author: "Barbara Han"
categories:
  - "Barbara Han"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/diesel-expression-in-menu-label-not-evaluated-when-used-with-addmenuitem.html "
typepad_basename: "diesel-expression-in-menu-label-not-evaluated-when-used-with-addmenuitem"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/barbara-han.html" target="_self">Barbara Han</a></p>  <p><strong>Question</strong>: I use the following VB.NET code and instead of the label displaying &quot;Full Screen On&quot; or &quot;Full Screen Off&quot;, the DIESEL string is displayed in AutoCAD Classic menu.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px">&#160; <span style="color: blue">Sub</span> DIESEL_problem()</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> currMenuGroup <span style="color: blue">As</span> <span style="color: #2b91af">AcadMenuGroup</span></p>    <p style="margin: 0px">&#160;&#160;&#160; currMenuGroup = ThisDrawing.Application.MenuGroups.Item(0)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Create the new menu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> newMenu <span style="color: blue">As</span> <span style="color: #2b91af">AcadPopupMenu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; newMenu = currMenuGroup.Menus.Item(<span style="color: #a31515">&quot;DIESEL_Problem&quot;</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Catch</span> ex <span style="color: blue">As</span> <span style="color: #2b91af">Exception</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; newMenu = currMenuGroup.Menus.Add(<span style="color: #a31515">&quot;DIESEL_Problem&quot;</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Try</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> CommandName <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="margin: 0px">&#160;&#160;&#160; CommandName = <span style="color: #a31515">&quot;($if,$(=,$(getvar,tilemode),0),Full &amp;Screen ON,Full &amp;Screen OFF)&quot;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Add a menu item to the new menu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> newMenuItem <span style="color: blue">As</span> <span style="color: #2b91af">AcadPopupMenuItem</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> openMacro <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Assign the macro string the VB equivalent of &quot;ESC ESC _open &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; openMacro = Chr(3) &amp; Chr(3) &amp; Chr(95) &amp; <span style="color: #a31515">&quot;open&quot;</span> &amp; Chr(32)</p>    <p style="margin: 0px">&#160;&#160;&#160; newMenuItem = newMenu.AddMenuItem(newMenu.Count + 1, CommandName, openMacro)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Display the menu on the menu bar</span></p>    <p style="margin: 0px">&#160;&#160;&#160; newMenu.InsertInMenuBar(ThisDrawing.Application.MenuBar.Count + 1)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Sub</span></p> </div>  <p><strong>Solution</strong>: The work around is to use the label property. Here is an example that shows this. After creating the menu Item, the label property is set using the DIESEL expression.</p>  <div style="font-family: courier new; background: white; color: black; font-size: 8pt">   <p style="margin: 0px">&#160; <span style="color: blue">Sub</span> DIESEL_fix()</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> currMenuGroup <span style="color: blue">As</span> <span style="color: #2b91af">AcadMenuGroup</span></p>    <p style="margin: 0px">&#160;&#160;&#160; currMenuGroup = ThisDrawing.Application.MenuGroups.Item(0)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Create the new menu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> newMenu <span style="color: blue">As</span> <span style="color: #2b91af">AcadPopupMenu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Try</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; newMenu = currMenuGroup.Menus.Item(<span style="color: #a31515">&quot;DIESEL_fix&quot;</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Catch</span> ex <span style="color: blue">As</span> <span style="color: #2b91af">Exception</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160; newMenu = currMenuGroup.Menus.Add(<span style="color: #a31515">&quot;DIESEL_fix&quot;</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">End</span> <span style="color: blue">Try</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Add a menu item to the new menu</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> newMenuItem <span style="color: blue">As</span> <span style="color: #2b91af">AcadPopupMenuItem</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">Dim</span> openMacro <span style="color: blue">As</span> <span style="color: blue">String</span></p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Assign the macro string the VB equivalent of &quot;ESC ESC _open &quot;</span></p>    <p style="margin: 0px">&#160;&#160;&#160; openMacro = Chr(3) &amp; Chr(3) &amp; Chr(95) &amp; <span style="color: #a31515">&quot;open&quot;</span> &amp; Chr(32)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; newMenuItem = newMenu.AddMenuItem(newMenu.Count + 1, <span style="color: #a31515">&quot;placeHolder&quot;</span>, openMacro)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; newMenuItem.Label = <span style="color: #a31515">&quot;$(if,$(=,$(getvar,tilemode),0),Full &amp;Screen ON,Full &amp;Screen OFF)&quot;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">' Display the menu on the menu bar</span></p>    <p style="margin: 0px">&#160;&#160;&#160; newMenu.InsertInMenuBar(ThisDrawing.Application.MenuBar.Count + 1)</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160; <span style="color: blue">End</span> <span style="color: blue">Sub</span></p> </div>  <p>Addendum: Please refer to below sample to get the AutoCAD document which is used in above code:</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.Interop</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">Imports</font></font></span><font style="font-size: 8pt" color="#000000"> Autodesk.AutoCAD.Interop.Common</font></font></p>    <p style="margin: 0px"><font color="#000000" face="Courier New">……</font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Private</font></span><font color="#000000"> ThisDrawing </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Object</font></span></font></p> </div>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Private</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">Sub</font></span><font color="#000000"> Button1_Click(sender </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span style="color: "><font color="#2b91af">Object</font></span><font color="#000000">, e </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> System.</font><span style="color: "><font color="#2b91af">EventArgs</font></span><font color="#000000">) </font><span style="color: "><font color="#0000ff">Handles</font></span><font color="#000000"> Button1.Click</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Dim</font></span><font color="#000000"> acadApp </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">AcadApplication</font></span><font color="#000000"> = </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Nothing</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; acadApp = GetObject(, </font></font><font style="font-size: 8pt"><span style="color: "><font color="#a31515">&quot;AutoCAD.Application&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; acadApp.Visible = Visible</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Catch</font></span><font color="#000000"> ex </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#2b91af">Exception</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; acadApp = CreateObject(</font></font><font style="font-size: 8pt"><span style="color: "><font color="#a31515">&quot;AutoCAD.Application.18.2&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; acadApp.Visible = Visible</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">Catch</font></span><font color="#000000"> ex1 </font><span style="color: "><font color="#0000ff">As</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#2b91af">Exception</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; MsgBox(ex1.Message)</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Try</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; ThisDrawing = acadApp.ActiveDocument</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">'DIESEL_problem()</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; DIESEL_fix()</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">End</font></span><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>
