---
layout: "post"
title: "Display Forms inside async AutoCAD commands"
date: "2014-10-15 06:32:57"
author: "Philippe Leefsma"
categories:
  - ".NET"
  - "2015"
  - "Philippe Leefsma"
  - "UI"
original_url: "https://adndevblog.typepad.com/autocad/2014/10/display-forms-inside-async-autocad-commands.html "
typepad_basename: "display-forms-inside-async-autocad-commands"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>You may have given a try already at the very cool <a href="http://msdn.microsoft.com/en-us/library/hh191443.aspx">async</a> .Net 4.5 feature.</p>  <p>When displaying a form inside an async AutoCAD 2015 command, it happens that the synchronization context is not restored properly after closing the form, which provoke some undesirable behavior, for example the output of <em><strong>Editor.WriteMesage</strong></em> not being displayed in the command line.</p>  <p>A simple way to work around it is to save the current context prior to show the form and reset it once it closes.</p>  <p>An example of what Iâ€™m talking about just below:</p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#008000">// simulates an async function</font></font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff"><font style="font-size: 9.5pt">private</font></font></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">static</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">async</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">Task</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000">&lt;</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">string</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000">&gt; AsyncTask(</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">string</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> name)</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">await</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">Task</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.Delay(5000);</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">return</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#a31515">&quot;Hello &quot;</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> + name;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">}</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"><font style="font-size: 9.5pt">[</font></font></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">CommandMethod</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000">(</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#a31515">&quot;ADN&quot;</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000">, </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#a31515">&quot;SyncContextCmd&quot;</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000">, </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">CommandFlags</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.Transparent)]</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff"><font style="font-size: 9.5pt">async</font></font></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">static</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">public</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">void</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> SyncContextCmd()</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">{</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span lang="FR-CH" style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;; mso-ansi-language: fr-ch"><font color="#2b91af">Document</font></span><span lang="FR-CH" style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;; mso-ansi-language: fr-ch"><font color="#000000"> doc = </font></span><span lang="FR-CH" style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;; mso-ansi-language: fr-ch"><font color="#2b91af">Application</font></span></font><span lang="FR-CH" style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;; mso-ansi-language: fr-ch"><font style="font-size: 9.5pt" color="#000000">.DocumentManager.MdiActiveDocument;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span lang="FR-CH" style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;; mso-ansi-language: fr-ch"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">Database</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> db = doc.Database;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">Editor</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> ed = doc.Editor;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#008000">// saves current synchronization context</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">var</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> syncContext = </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">SynchronizationContext</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.Current;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">AdnForm</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> form = </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">new</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">AdnForm</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">();</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">var</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> dialogResult = </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">Application</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.ShowModalDialog(form);</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#008000">// restores synchronization context</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">SynchronizationContext</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.SetSynchronizationContext(</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9.5pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 9.5pt">syncContext);</font></font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">if</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> (dialogResult != System.Windows.Forms.</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#2b91af">DialogResult</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">.OK)</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">return</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">;</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#008000">// process form result asynchronously</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">string</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> result = </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#0000ff">await</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000"> AsyncTask(form.UserName);</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">&#160;</font></font></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><span style="mso-spacerun: yes"><font color="#000000"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></font></span></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#008000">// editor.WriteMessage works OK now</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal; text-autospace: ; mso-layout-grid-align: none"><font face="Consolas"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"><span style="mso-spacerun: yes"><font style="font-size: 9.5pt">&#160;&#160;&#160; </font></span><font style="font-size: 9.5pt">ed.WriteMessage(</font></font></span><font style="font-size: 9.5pt"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#a31515">&quot;\nResult: &quot;</font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#000000"> + result + </font></span><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font color="#a31515">&quot;\n&quot;</font></span></font><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font style="font-size: 9.5pt" color="#000000">);</font></span></font></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal"><span style="font-family: ; background-image: none; background-repeat: repeat; background-attachment: scroll; background-position: 0% 0%; color: ; mso-highlight: white; mso-fareast-font-family: &quot;Times New Roman&quot;"><font face="Consolas"><font style="font-size: 9.5pt" color="#000000">}</font></font></span><span style="font-family: ; color: ; mso-fareast-font-family: &quot;Times New Roman&quot;"></span></p>  <p class="MsoNormal" style="margin: 0in 0in 0pt; line-height: normal"><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>
