---
layout: "post"
title: "Calling AcDbDatabse::insert() on DWG opened with readDwgFile() Causes Fatal Error with INSERT Command"
date: "2012-08-03 15:59:09"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/08/maintaining-the-windows-message-loop-when-your-code-is-busy-in-autocad-objectarx.html "
typepad_basename: "maintaining-the-windows-message-loop-when-your-code-is-busy-in-autocad-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p><b>Issue</b></p>  <p>I am using readDwgFile() to open a drawing in memory. I then use AcDbDatabase::insert(). After saving this drawing and opening it in AutoCAD, an error occurs when I use the INSERT command to insert the block that was inserted. &quot;Error getting linetype from symbol table&quot;</p>  <p><a name="section2"></a></p>  <p><b>Solution</b></p>  <p>This problem occurs if the preserveSourceDatabase parameter for the insert() function is set to false. If this parameter is true then the block is added correctly to the database. When this parameter is false, a Hard Pointer to the AcDbLinetypeTableRecord for the entities in the block are missing. Here is a code example.</p>  <p><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 9.8pt">void</font></font></span><font style="font-size: 9.8pt"><font color="#000000">&#160;</font><span style="color: "><font color="#010001">ASDKtestSave</font></span></font></font><font style="font-size: 9.8pt"><font face="Consolas"><font color="#000000">()         <br />{          <br />&#160; </font><span style="color: "><font color="#010001">Acad</font></span><font color="#000000">::</font><span style="color: "><font color="#010001">ErrorStatus</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">es</font></span></font><font face="Consolas"><font color="#000000">;         <br />           <br />&#160; </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span></font><font face="Consolas"><font color="#000000">);         <br />&#160; </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">readDwgFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;C:\\test.dwg&quot;</font></span></font><font face="Consolas"><font color="#000000">));         <br />&#160; </font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">closeInput</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">true</font></span></font><font face="Consolas"><font color="#000000">);         <br />           <br />&#160; </font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pXrefDb</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">AcDbDatabase</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">false</font></span></font><font face="Consolas"><font color="#000000">);         <br />&#160; </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pXrefDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">readDwgFile</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;C:\\test2.dwg&quot;</font></span></font><font face="Consolas"><font color="#000000">));         <br />&#160; </font><span style="color: "><font color="#010001">pXrefDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">closeInput</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">true</font></span></font><font face="Consolas"><font color="#000000">);         <br />           <br />&#160; </font><span style="color: "><font color="#010001">AcDbObjectId</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">idOut</font></span></font><font face="Consolas"><font color="#000000">;         <br />&#160; </font><span style="color: "><font color="#008000">// if the preserverSourceDatabase parameter is false</font></span>        <br /><font color="#000000">&#160; </font><span style="color: "><font color="#008000">// the drawing corruption occurs - use true instead</font></span>        <br /><font color="#000000">&#160; </font><span style="color: "><font color="#008000">//es = pMasterDb-&gt;insert(idOut, _T(&quot;TestBlock&quot;), pXrefDb, false);</font></span>        <br /><font color="#000000">&#160; </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">insert</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">idOut</font></span><font color="#000000">, </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;TestBlock&quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#010001">pXrefDb</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">true</font></span></font><font face="Consolas"><font color="#000000">);         <br />           <br />&#160; </font><span style="color: "><font color="#010001">es</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">saveAs</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;C:\\TestDrawing2.dwg&quot;</font></span></font><font face="Consolas"><font color="#000000">));         <br />           <br />&#160; </font><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">pXrefDb</font></span></font></font><font face="Consolas"><font style="font-size: 9.8pt"><font color="#000000">;         <br />&#160; </font><span style="color: "><font color="#0000ff">delete</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#010001">pMasterDb</font></span><font color="#000000">;         <br />           <br />}          <br /></font></font></font></p>
