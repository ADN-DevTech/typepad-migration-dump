---
layout: "post"
title: "Accessing Support Files and Project Files Search Paths"
date: "2015-08-31 17:10:00"
author: "Madhukar Moogala"
categories:
  - "2014"
  - "2015"
  - "2016"
  - "ActiveX"
  - "AutoCAD"
  - "Madhukar Moogala"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2015/08/accessing-support-files-and-project-files-search-paths.html "
typepad_basename: "accessing-support-files-and-project-files-search-paths"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/Madhukar-Moogala.html" target="_self">Madhukar Moogala</a></p>  <p>I have received a recent query on how to programmatically accessing support and project files which are available in Options\Files tab.</p>  <p>We can leverage ActiveX API&#160; AcadPreferences.Files to get access on support and project files.</p>  <p>To get information on Support Files Search Path either we can using Acad system variable “ACADPREFIX” or following code:</p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">void</span> TestProj()</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: #2b91af">HRESULT</span> hr;</p>    <p style="margin: 0px"><span style="color: blue">try</span></p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">AutoCAD::<span style="color: #2b91af">IAcadApplication</span> *pAcad =<span style="color: #6f008a">NULL</span>;</p>    <p style="margin: 0px">hr = <span style="color: #6f008a">NOERROR</span>;</p>    <p style="margin: 0px"><span style="color: #2b91af">LPUNKNOWN</span> pUnk = <span style="color: #6f008a">NULL</span>;</p>    <p style="margin: 0px"><span style="color: #2b91af">LPDISPATCH</span> pAcadDisp = <span style="color: #6f008a">acedGetIDispatch</span>(<span style="color: #6f008a">TRUE</span>); </p>    <p style="margin: 0px"><span style="color: blue">if</span>(pAcadDisp==<span style="color: #6f008a">NULL</span>)</p>    <p style="margin: 0px"><span style="color: blue">return</span> ;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">hr = pAcadDisp-&gt;QueryInterface(AutoCAD::IID_IAcadApplication,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">void</span>**)&amp;pAcad);</p>    <p style="margin: 0px">pAcadDisp-&gt;Release();</p>    <p style="margin: 0px"><span style="color: blue">if</span> (<span style="color: #6f008a">FAILED</span>(hr))</p>    <p style="margin: 0px"><span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">if</span> (pAcad) </p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">AutoCAD::<span style="color: #2b91af">IAcadPreferences</span>* pPreferences&#160; = <span style="color: #6f008a">NULL</span>;</p>    <p style="margin: 0px">hr = pAcad-&gt;get_Preferences(&amp;pPreferences);</p>    <p style="margin: 0px"><span style="color: blue">if</span>(<span style="color: #6f008a">FAILED</span>(hr))&#160; <span style="color: blue">return</span>;</p>    <p style="margin: 0px">pAcad-&gt;Release();</p>    <p style="margin: 0px">AutoCAD::<span style="color: #2b91af">IAcadPreferencesFiles</span>* pPreferencesFiles = <span style="color: #6f008a">NULL</span>;</p>    <p style="margin: 0px">hr = pPreferences-&gt;get_Files(&amp;pPreferencesFiles);</p>    <p style="margin: 0px"><span style="color: blue">if</span>(<span style="color: #6f008a">FAILED</span>(hr)) <span style="color: blue">return</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">if</span>(pPreferencesFiles)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: green">/*To access Project file path*/</span></p>    <p style="margin: 0px"><span style="color: #2b91af">BSTR</span> projectFilePath,supportPath;</p>    <p style="margin: 0px"><span style="color: green">/*Created a Testproject interactively and added path to &quot;C:/Temp*/</span></p>    <p style="margin: 0px">pPreferencesFiles-&gt;GetProjectFilePath(<span style="color: #2b91af">_bstr_t</span>(<span style="color: #a31515">&quot;TESTPROJECT&quot;</span>),</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;projectFilePath);</p>    <p style="margin: 0px">std::<span style="color: #2b91af">wstring</span> ps(projectFilePath,SysStringLen(projectFilePath));</p>    <p style="margin: 0px">acutPrintf(<span style="color: #6f008a">_T</span>(<span style="color: #a31515">&quot;\nProject Search Path File : %s&quot;</span>),ps.c_str());</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">/*To get list of paths in Support Search*/</span></p>    <p style="margin: 0px">pPreferencesFiles-&gt;get_SupportPath(&amp;supportPath);</p>    <p style="margin: 0px">std::<span style="color: #2b91af">wstring</span> ws(supportPath,SysStringLen(supportPath));</p>    <p style="margin: 0px">acutPrintf(<span style="color: #6f008a">_T</span>(<span style="color: #a31515">&quot;\nSupport Search Path : %s&quot;</span>),ws.c_str());</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px"><span style="color: blue">catch</span>(...)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: blue">return</span>;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">}</p> </div>  <p>Above code only helps to get file path of mentioned Projects created in Applications, there is no API to get list of Projects created in the Application, following is way to read “Project Settings” key from Registry.</p>  <p>The mechanism to read registries is borrowed from <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724256%28v=vs.85%29.aspx" target="_blank">here</a></p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: green">/*Enumerating List of Projects available*/</span></p>    <p style="margin: 0px"><span style="color: blue">#define</span> <span style="color: #6f008a">MAX_KEY_LENGTH</span> 255</p>    <p style="margin: 0px"><span style="color: blue">#define</span> <span style="color: #6f008a">MAX_VALUE_NAME</span> 16383</p>    <p style="margin: 0px"><span style="color: blue">void</span> QueryKey(<span style="color: #2b91af">HKEY</span> <span style="color: gray">hKey</span>)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: #2b91af">TCHAR</span>&#160;&#160;&#160; achKey[<span style="color: #6f008a">MAX_KEY_LENGTH</span>];&#160;&#160; <span style="color: green">// buffer for subkey name</span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cbName;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// size of name string </span></p>    <p style="margin: 0px"><span style="color: #2b91af">TCHAR</span>&#160;&#160;&#160; achClass[<span style="color: #6f008a">MAX_PATH</span>] = <span style="color: #6f008a">TEXT</span>(<span style="color: #a31515">&quot;&quot;</span>);&#160; <span style="color: green">// buffer for class name </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cchClassName = <span style="color: #6f008a">MAX_PATH</span>;&#160; <span style="color: green">// size of class string </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cSubKeys = 0;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// number of subkeys </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cbMaxSubKey;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest subkey size </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cchMaxClass;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest class string </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cValues;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// number of values for key </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cchMaxValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest value name </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cbMaxValueData;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest value data </span></p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span>&#160;&#160;&#160; cbSecurityDescriptor; <span style="color: green">// size of security descriptor </span></p>    <p style="margin: 0px"><span style="color: #2b91af">FILETIME</span> ftLastWriteTime;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// last write time </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span> i, retCode;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: #2b91af">TCHAR</span>&#160; achValue[<span style="color: #6f008a">MAX_VALUE_NAME</span>];</p>    <p style="margin: 0px"><span style="color: #2b91af">DWORD</span> cchValue = <span style="color: #6f008a">MAX_VALUE_NAME</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// Get the class name and the value count. </span></p>    <p style="margin: 0px">retCode = <span style="color: #6f008a">RegQueryInfoKey</span>(</p>    <p style="margin: 0px"><span style="color: gray">hKey</span>,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// key handle </span></p>    <p style="margin: 0px">achClass,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// buffer for class name </span></p>    <p style="margin: 0px">&amp;cchClassName,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// size of class string </span></p>    <p style="margin: 0px"><span style="color: #6f008a">NULL</span>,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// reserved </span></p>    <p style="margin: 0px">&amp;cSubKeys,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// number of subkeys </span></p>    <p style="margin: 0px">&amp;cbMaxSubKey,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest subkey size </span></p>    <p style="margin: 0px">&amp;cchMaxClass,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest class string </span></p>    <p style="margin: 0px">&amp;cValues,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// number of values for this key </span></p>    <p style="margin: 0px">&amp;cchMaxValue,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest value name </span></p>    <p style="margin: 0px">&amp;cbMaxValueData,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// longest value data </span></p>    <p style="margin: 0px">&amp;cbSecurityDescriptor,&#160;&#160; <span style="color: green">// security descriptor </span></p>    <p style="margin: 0px">&amp;ftLastWriteTime);&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// last write time </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// Enumerate the subkeys, until RegEnumKeyEx fails.</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">if</span> (cSubKeys)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">printf(<span style="color: #a31515">&quot;\nNumber of subkeys: %d\n&quot;</span>, cSubKeys);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">for</span> (i = 0; i&lt;cSubKeys; i++)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; cbName = <span style="color: #6f008a">MAX_KEY_LENGTH</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; retCode = <span style="color: #6f008a">RegEnumKeyEx</span>(<span style="color: gray">hKey</span>, i,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; achKey,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;cbName,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;ftLastWriteTime);</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (retCode == <span style="color: #6f008a">ERROR_SUCCESS</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; acutPrintf(<span style="color: #6f008a">TEXT</span>(<span style="color: #a31515">&quot;(%d) %s\n&quot;</span>), i + 1, achKey);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">// Enumerate the key values. </span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">if</span> (cValues)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">printf(<span style="color: #a31515">&quot;\nNumber of values: %d\n&quot;</span>, cValues);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">for</span> (i = 0, retCode = ERROR_SUCCESS; i&lt;cValues; i++)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; cchValue = <span style="color: #6f008a">MAX_VALUE_NAME</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; achValue[0] = <span style="color: #a31515">'\0'</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160; retCode = <span style="color: #6f008a">RegEnumValue</span>(<span style="color: gray">hKey</span>, i,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; achValue,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;cchValue,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>,</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #6f008a">NULL</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">if</span> (retCode == <span style="color: #6f008a">ERROR_SUCCESS</span>)</p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; acutPrintf(<span style="color: #6f008a">TEXT</span>(<span style="color: #a31515">&quot;(%d) %s\n&quot;</span>), i + 1, achValue);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px"><span style="color: blue">void</span> TestList()</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: #2b91af">HKEY</span> hTestKey;</p>    <p style="margin: 0px"><span style="color: green">/*Hardcoded path, r20.1 is release numberfor ACAD 2016 version </span></p>    <p style="margin: 0px"><span style="color: green">ACAD-F001:409 : Product code for Acad vanilla</span></p>    <p style="margin: 0px"><span style="color: green">*/</span></p>    <p style="margin: 0px"><span style="color: green">/*Full product information, plz refer : </span></p>    <p style="margin: 0px"><span style="color: green">http://adndevblog.typepad.com/autocad/2013/08/registry-values-for-productid-and-localeid-for-autocad.html */</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">if</span> (<span style="color: #6f008a">RegOpenKeyEx</span>(<span style="color: #6f008a">HKEY_CURRENT_USER</span>,</p>    <p style="margin: 0px"><span style="color: #6f008a">TEXT</span>(<span style="color: #a31515">&quot;Software\\Autodesk\\AutoCAD\\R20.1\\ACAD-F001:409\\Profiles\\acad\\Project Settings&quot;</span>),</p>    <p style="margin: 0px">0,</p>    <p style="margin: 0px"><span style="color: #6f008a">KEY_READ</span>,</p>    <p style="margin: 0px">&amp;hTestKey) == <span style="color: #6f008a">ERROR_SUCCESS</span></p>    <p style="margin: 0px">)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">QueryKey(hTestKey);</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">RegCloseKey(hTestKey);</p>    <p style="margin: 0px">}</p> </div>  <p>Output running following programs:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7c72e47970b-pi"><img title="SupportSearch_ProjectSearch" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="SupportSearch_ProjectSearch" src="/assets/image_914930.jpg" width="244" height="38" /></a></p>  <p>You may also refer to change path of Project file :</p>  <p><a title="http://adndevblog.typepad.com/autocad/2012/12/setting-the-project-file-search-path.html" href="http://adndevblog.typepad.com/autocad/2012/12/setting-the-project-file-search-path.html">http://adndevblog.typepad.com/autocad/2012/12/setting-the-project-file-search-path.html</a></p>  <p>Same mechanism is applied to change path of Support file, use </p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">virtual</span> HRESULT <span style="color: blue">__stdcall</span> put_SupportPath (</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: green">/*[in]*/</span> BSTR orient ) = 0;</p> </div>
