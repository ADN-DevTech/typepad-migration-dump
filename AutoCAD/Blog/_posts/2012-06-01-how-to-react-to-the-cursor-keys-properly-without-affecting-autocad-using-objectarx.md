---
layout: "post"
title: "How to react to the cursor keys properly (without affecting AutoCAD) using ObjectARX?"
date: "2012-06-01 16:42:40"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "AutoCAD OEM"
  - "Fenton Webb"
  - "ObjectARX"
  - "RealDWG"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/how-to-react-to-the-cursor-keys-properly-without-affecting-autocad-using-objectarx.html "
typepad_basename: "how-to-react-to-the-cursor-keys-properly-without-affecting-autocad-using-objectarx"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>With ObjectARX you can add a filter function into the AutoCAD's Windows message loop (you can also PInvoke this functionality in .NET too). </p>  <p>The following example shows how to trap and filter out the cursor keys allowing your application to respond to the keys, rather than let the command line editor do it (return TRUE from the <span style="color: "><font color="#010001">filterCurs()</font></span>). It uses acedRegisterFilterWinMsg() to register a windows hook, and acedRemoveFilterWinMsg() to unregister the hook...</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#include</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span style="color: "><font style="font-size: 8pt" color="#a31515">&quot;rxmfcapi.h&quot;</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// After a call of this function AutoCAD will use filterCurs() function</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// to process key presses.</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//------------------------------------------------------------------------</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">curskeys</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">cursDone</font></span><font color="#000000"> ) </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// already has the hook??</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Cursor filtering enabled...\n&quot;</font></span><font color="#000000">) );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">acedRegisterFilterWinMsg</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">filterCurs</font></span><font color="#000000"> ) )</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Can't register Windows cursor-key msg hook\n&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">cursDone</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">static</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">BOOL</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">cursDone</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// Stop using filterCurs() for processing key presses</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//------------------------------------------------------------------</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">void</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">nocurskeys</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">cursDone</font></span><font color="#000000"> )</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acedRemoveFilterWinMsg</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">filterCurs</font></span><font color="#000000"> );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">cursDone</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// In this function your application can control presses of particular keys</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// or let AutoCAD do it.</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">//------------------------------------------------------------------------------</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#010001"><font style="font-size: 8pt">BOOL</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#010001">filterCurs</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">MSG</font></span><font color="#000000"> *</font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000"> )</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">WM_KEYDOWN</font></span><font color="#000000"> == </font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">message</font></span><font color="#000000"> &amp;&amp; </font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">wParam</font></span><font color="#000000"> &gt;= 37 &amp;&amp; </font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">wParam</font></span><font color="#000000"> &lt;= 40 )</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">switch</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">pMsg</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#010001">wParam</font></span><font color="#000000"> )</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> 37: </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// left</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Left\n&quot;</font></span><font color="#000000">) );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> 38: </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// up</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Up\n&quot;</font></span><font color="#000000">) );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> 39: </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// right</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Right\n&quot;</font></span><font color="#000000">) );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">case</font></span><font color="#000000"> 40: </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// down</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">acutPrintf</font></span><font color="#000000">( </font><span style="color: "><font color="#010001">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Down\n&quot;</font></span><font color="#000000">) );</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">TRUE</font></span><font color="#000000">; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// filter message</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">FALSE</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
