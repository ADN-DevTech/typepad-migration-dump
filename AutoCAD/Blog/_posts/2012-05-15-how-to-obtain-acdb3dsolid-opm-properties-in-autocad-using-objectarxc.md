---
layout: "post"
title: "How to obtain AcDb3dSolid OPM Properties in AutoCAD using ObjectARX/C++"
date: "2012-05-15 05:06:00"
author: "Fenton Webb"
categories:
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "AutoCAD OEM"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/05/how-to-obtain-acdb3dsolid-opm-properties-in-autocad-using-objectarxc.html "
typepad_basename: "how-to-obtain-acdb3dsolid-opm-properties-in-autocad-using-objectarxc"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>Someone just asked me how to obtain the Position, Height, Length, etc. from a 3D Box in AutoCAD. Actually, from a programming point of view, it’s kind of involved. The reason is because what we know as a Box, under the hood, is actually a generalized AcDb3dSolid object, generalized meaning that an AcDb3dSolid can also represent a Torus, Sphere, Cone etc., and, because an AcDb3dSolid can be all of these object types (and more, because you can Push, Pull, Union, Boolean and also Subtract these objects into whatever you want) the object properties that are displayed in the Property window of AutoCAD can vary a lot. We achieve this varying property set by means of an AutoCAD COM API known as Dynamic properties. We also have a slightly different version known as Static properties.</p>  <p>Dynamic Properties can be created on the fly, whereby Static properties are “hard coded” (easiest way to describe) into the object. I should also mention that we have two types of Dynamic properties, Per-Class registered and Per-Instance registered – AcDb3dSolid uses Per-Instance because it is the instance (in the drawing) defines the types of properties that it needs to expose… If you want to see these in action, along with some Static properties, you should check out my QuickProperties ObjectARX sample in the 2009 version of the SDK. </p>  <p>One point to note in the code is, you’ll see me obtaining the Length, Width, Height etc. properties one way, then the Position property in another - that’s because the Length, Width, Height are all Dynamic properties, and the Position is a Static property.</p>  <p>Now for the code… </p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><span style="color: "><font face="Courier New"><font style="font-size: 8pt" color="#008000">// by Fenton Webb, DevTech, Autodesk 28/May/2010</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#020002"><font style="font-size: 8pt">ads_point</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#020002">pnt</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#020002"><font style="font-size: 8pt">ads_name</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#020002">ename</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Courier New"><font style="font-size: 8pt" color="#008000">// pick a solid</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">int</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#020002">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">acedEntSel</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;\nPick a Solid : &quot;</font></span><font color="#000000">), </font><span style="color: "><font color="#020002">ename</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">pnt</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Courier New"><font style="font-size: 8pt" color="#008000">// if ok</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">if</font></font></span><font style="font-size: 8pt"><font color="#000000"> (</font><span style="color: "><font color="#020002">res</font></span><font color="#000000"> == </font><span style="color: "><font color="#020002">RTNORM</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">AcDbObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">id</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// convert from an ADS ename to ObjectARX ObjectId</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">acdbGetObjectId</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">id</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">ename</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the IUknown of the entity, we’ll need it to get the properties for the instance and also so we can set them</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComPtr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#020002">IUnknown</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#020002">entIUnknown</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">NULL</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">HRESULT</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">AcAxGetIUnknownOfObject</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#020002">entIUnknown</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">id</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">acedGetAcadWinApp</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#020002">GetIDispatch</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">TRUE</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">double</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">length</font></span><font color="#000000">=0.001, </font><span style="color: "><font color="#020002">height</font></span><font color="#000000">=0.001, </font><span style="color: "><font color="#020002">width</font></span><font color="#000000">=0.001;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the dynamic properties to obtain Box info</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">AcRxClass</font></span><font color="#000000">* </font><span style="color: "><font color="#020002">pAcrxClass</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">AcDb3dSolid</font></span><font color="#000000">::</font><span style="color: "><font color="#020002">desc</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Per-instance dynamic property managers</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">OPMPerInstancePropertyExtension</font></span><font color="#000000">* </font><span style="color: "><font color="#020002">pPerInstanceExtension</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">GET_OPM_PERINSTANCE_EXTENSION_PROTOCOL</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">pAcrxClass</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">NULL</font></span><font color="#000000"> != </font><span style="color: "><font color="#020002">pPerInstanceExtension</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">COleSafeArray</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">sourceNames</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComBSTR</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">sourceName</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the property source names stored on the extension object</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">pPerInstanceExtension</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#020002">GetObjectPropertySourceNames</font></span><font color="#000000">((</font><span style="color: "><font color="#020002">LPVARIANT</font></span><font color="#000000">)</font><span style="color: "><font color="#020002">sourceNames</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// find out how many we have</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">start</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">end</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">sourceNames</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetLBound</font></span><font color="#000000">(1, &amp;</font><span style="color: "><font color="#020002">start</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">sourceNames</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetUBound</font></span><font color="#000000">(1, &amp;</font><span style="color: "><font color="#020002">end</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// loop the property sources</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">i</font></span><font color="#000000">=</font><span style="color: "><font color="#020002">start</font></span><font color="#000000">; </font><span style="color: "><font color="#020002">i</font></span><font color="#000000">&lt;=</font><span style="color: "><font color="#020002">end</font></span><font color="#000000">; ++</font><span style="color: "><font color="#020002">i</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// extract each one of the property sources out</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComPtr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#020002">IPropertySource</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#020002">propertySource</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">sourceNames</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetElement</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#020002">i</font></span><font color="#000000">, (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;</font><span style="color: "><font color="#020002">sourceName</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// GetPropertySourceAt does AddRef, so we directly assign pointer here.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">propertySource</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">p</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">GET_OPM_PERINSTANCE_PROPERTY_SOURCES</font></span><font color="#000000">()-&gt;</font><span style="color: "><font color="#020002">GetPropertySourceAt</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#020002">sourceName</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if we have one</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">propertySource</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">p</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">SUCCEEDED</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">hr</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// extract the Dynamic properties from it</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">COleSafeArray</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">props</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">propertySource</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#020002">GetProperties</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">entIUnknown</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">props</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">SUCCEEDED</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">hr</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// loop all the dynamic properties that we have</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">start</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">end</font></span><font color="#000000"> = 0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">props</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetLBound</font></span><font color="#000000">(1, &amp;</font><span style="color: "><font color="#020002">start</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">props</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetUBound</font></span><font color="#000000">(1, &amp;</font><span style="color: "><font color="#020002">end</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">for</font></span><font color="#000000"> (</font><span style="color: "><font color="#0000ff">long</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">i</font></span><font color="#000000">=</font><span style="color: "><font color="#020002">start</font></span><font color="#000000">; </font><span style="color: "><font color="#020002">i</font></span><font color="#000000">&lt;=</font><span style="color: "><font color="#020002">end</font></span><font color="#000000">; ++</font><span style="color: "><font color="#020002">i</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// first get the iUknown to make sure we have something</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComPtr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#020002">IUnknown</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#020002">unknown</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">NULL</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">props</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetElement</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#020002">i</font></span><font color="#000000">, (</font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000">*)&amp;</font><span style="color: "><font color="#020002">unknown</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if we have</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">unknown</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">p</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// try and cast it to an updated IDynamicProperty2 </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComQIPtr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#020002">IDynamicProperty2</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#020002">dynProp</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">unknown</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if ok</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">dynProp</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">p</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComBSTR</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">propName</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// extract out the property name</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">dynProp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#020002">GetDisplayName</font></span><font color="#000000">(&amp;(</font><span style="color: "><font color="#020002">propName</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">m_str</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the value</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">COleVariant</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">getter</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">dynProp</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#020002">GetCurrentValueData</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">entIUnknown</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">getter</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// find out which property we are looking at</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt"></font></font><span style="color: "><font style="font-size: 8pt" color="#008000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // extend as you see fit</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "></span></font><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">CString</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">propName</font></span><font color="#000000">) == </font><span style="color: "><font color="#020002">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Length&quot;</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">length</font></span><font color="#000000"> = ((*(</font><span style="color: "><font color="#020002">tagVARIANT</font></span><font color="#000000">*)(&amp;</font><span style="color: "><font color="#020002">getter</font></span><font color="#000000">))).</font><span style="color: "><font color="#020002">dblVal</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">CString</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">propName</font></span><font color="#000000">) == </font><span style="color: "><font color="#020002">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Width&quot;</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">width</font></span><font color="#000000"> = ((*(</font><span style="color: "><font color="#020002">tagVARIANT</font></span><font color="#000000">*)(&amp;</font><span style="color: "><font color="#020002">getter</font></span><font color="#000000">))).</font><span style="color: "><font color="#020002">dblVal</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">CString</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">propName</font></span><font color="#000000">) == </font><span style="color: "><font color="#020002">_T</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Height&quot;</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">height</font></span><font color="#000000"> = ((*(</font><span style="color: "><font color="#020002">tagVARIANT</font></span><font color="#000000">*)(&amp;</font><span style="color: "><font color="#020002">getter</font></span><font color="#000000">))).</font><span style="color: "><font color="#020002">dblVal</font></span><font color="#000000">;;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now get the position from the solid</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CComQIPtr</font></span><font color="#000000">&lt;</font><span style="color: "><font color="#020002">IAcad3DSolid</font></span><font color="#000000">&gt; </font><span style="color: "><font color="#020002">solidCom</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">entIUnknown</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">solidCom</font></span><font color="#000000"> != </font><span style="color: "><font color="#020002">NULL</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">COleVariant</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">olePosition</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">hr</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">solidCom</font></span><font color="#000000">-&gt;</font><span style="color: "><font color="#020002">get_Position</font></span><font color="#000000">(&amp;</font><span style="color: "><font color="#020002">olePosition</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">AcAxPoint3d</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">position</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">olePosition</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">minPnt</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">x</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">position</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">x</font></span><font color="#000000"> - </font><span style="color: "><font color="#020002">length</font></span><font color="#000000">/2.0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">minPnt</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">y</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">position</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">y</font></span><font color="#000000"> - </font><span style="color: "><font color="#020002">width</font></span><font color="#000000">/2.0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">minPnt</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">z</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">position</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">z</font></span><font color="#000000"> - </font><span style="color: "><font color="#020002">height</font></span><font color="#000000">/2.0;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p> </div>
