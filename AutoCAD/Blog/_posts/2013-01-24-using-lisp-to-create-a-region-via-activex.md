---
layout: "post"
title: "Using LISP to create a region via ActiveX"
date: "2013-01-24 09:06:48"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "LISP"
original_url: "https://adndevblog.typepad.com/autocad/2013/01/using-lisp-to-create-a-region-via-activex.html "
typepad_basename: "using-lisp-to-create-a-region-via-activex"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>The main issue is related to the Safearray, so the following code creates a region from an arc and a line and alter its color. You should be able to easily convert it into just creating a region from a circle:</p>  <p><span style="line-height: 120%; font-family: &#39;courier new&#39;, courier; font-size: 8pt"><span style="color: #ff0000">(</span><span style="color: #0000ff">defun</span> AddRegion <span style="color: #ff0000">(</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">vl-load-com</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> acadapp <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-get-Acad-Object</span><span style="color: #ff0000">)</span>      <br /> acaddoc <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-get-ActiveDocument</span> acadapp<span style="color: #ff0000">)</span>      <br /> mspace <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-get-ModelSpace</span> acaddoc<span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> arcObj <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-AddArc</span>      <br />&#160;&#160; mspace      <br />&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-</span>3d-point '<span style="color: #ff0000">(</span>5.0 3.0 0.0<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160; 2.0      <br />&#160;&#160; 0.0      <br />&#160;&#160; pi      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> arcClr <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-Put-Color</span> arcObj acYellow<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> arcStrtPoint <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-Get-StartPoint</span> arcObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> arcEndPoint <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-Get-EndPoint</span> arcObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> lineObj <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-AddLine</span> mspace arcStrtPoint arcEndPoint<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> lClr <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-Put-Color</span> lineObj acGreen<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> objArray <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-make-safearray</span> vlax-vbObject '<span style="color: #ff0000">(</span><span style="color: #008000">0</span> . <span style="color: #008000">1</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-safearray-fill</span> objArray <span style="color: #ff0000">(</span>list arcObj lineObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />      <br />      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> regionObjList <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-AddRegion</span> mspace objArray<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> rSA <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-variant-value</span> regionObjList<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> regionList <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-safearray-</span>&gt;list rSA<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> regionObj <span style="color: #ff0000">(</span><span style="color: #0000ff">car</span> regionList<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> rClr <span style="color: #ff0000">(</span><span style="color: #0000ff">vla-Put-Color</span> regionObj acMagenta<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />      <br />      <br /><span style="background-color: #e6e6e6; color: #800080">;<span style="background-color: #e6e6e6; color: #800080">;; Release the Objects:         <br /></span></span>&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> regionObj      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> regionObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> regionObj<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> regionObj nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> arcObj      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> arcObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> arcObj<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> arcObj nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> lineObj      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> lineObj<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> lineObj<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> lineObj nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> mspace      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> mspace<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> mspace<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> mspace nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> acaddoc      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> acaddoc<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> acaddoc<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> acaddoc nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span> acadapp      <br />&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">if</span>&#160;<span style="color: #ff0000">(</span>null <span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-object-released-p</span> acadapp<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">progn</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">vlax-release-object</span> acadapp<span style="color: #ff0000">)</span>&#160;<span style="color: #ff0000">(</span><span style="color: #0000ff">setq</span> acadapp nil<span style="color: #ff0000">)</span><span style="color: #ff0000">)</span>      <br />&#160;&#160;&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">)</span>      <br />&#160; <span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span>&#160;<span style="color: #ff00ff">&quot;\nAddRegion loaded. Enter <span style="color: #ff0000">(</span>addregion<span style="color: #ff0000">)</span> to run.&quot;</span><span style="color: #ff0000">)</span>      <br /><span style="color: #ff0000">(</span><span style="color: #0000ff">princ</span><span style="color: #ff0000">)</span></span></p>
