---
layout: "post"
title: "Creating a Polyline3d without using Transactions"
date: "2012-06-15 16:05:02"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/06/creating-a-polyline3d-without-using-transactions.html "
typepad_basename: "creating-a-polyline3d-without-using-transactions"
typepad_status: "Publish"
---

<p>by <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html">Fenton Webb</a></p>  <p>You may or may not be aware, but you can actually handle AutoCAD database entities without using transactions… The sample code below shows how to do this using Open and Close (Close happens via the end bracket of the using statement) along with also showing how to create a Polyline3d with its associated PolylineVertex3d’s.</p>  <p>I like using Open and Close above transactions for a couple of reasons… </p>  <ul>   <li>First of all, in my opinion, the Open and Close style is much cleaner in terms of the amount of code needed. </li>    <li>Second, StartTransaction() has a huge overhead for small operations – about 100 times slower that Open and Close style for entity read operations totaling less than about 80 in a single transaction. StartOpenCloseTransaction() can be easily substituted for StartTransaction() calls, thus regaining your performance while maintaining the same code layout. I should mention that StartTransaction() really comes into it’s own on large datasets, quickly becoming 1000+ times quicker than Open and Close for write operations.</li> </ul>  <p>Now to talk about Polyline3d and Polyline2d a little… These types of entities are known as Complex Entities inside of AutoCAD. They are called this because their point data is made up of different vertex entity entries in the database, namely, PolylineVertex3d and PolylineVertex2d objects respectively. People don’t really use Polyline2d anymore because they are slower to process and very heavy in data size – instead the lightweight Polyline class type is used more because it’s much faster to process the point data and, of course, takes up less data space. </p>  <p>We haven’t created a lightweight 3d Polyline type in AutoCAD yet, so Polyline3d’s are still being used as before… When creating Polyline3d vertices, you need to make sure the host Polyline3d is added to the database before you start adding the Polyline3dVertex’s, this is shown in the code below…</p>  <p><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// create a 3d polyline, using open and close (no transactions)</font></font></span></p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><span style="color: "><font face="Consolas"><font style="font-size: 8pt" color="#008000">// by Fenton Webb, Autodesk, 15/06/2012</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">[</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;My3dPoly&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">My3dPoly</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// get the std items</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Database</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">db</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">HostApplicationServices</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">WorkingDatabase</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Editor</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">ed</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Editor</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">Point3dCollection</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pnts</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Point3dCollection</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now input some points</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">PromptPointResult</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">do</font></span><font color="#000000"> </font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// pint the point</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">GetPoint</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Pick a 3d point&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if point picked</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">res</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Status</font></span><font color="#000000"> == </font><span style="color: "><font color="#2b91af">PromptStatus</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">OK</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// add it to our list of points</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">pnts</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Add</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">res</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Value</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; } </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">while</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">res</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Status</font></span><font color="#000000"> == </font><span style="color: "><font color="#2b91af">PromptStatus</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">OK</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// if we have enough points</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#010001">pnts</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">Count</font></span><font color="#000000"> &gt;= 2)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Create a 3D polyline with two segments (3 points)</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Polyline3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">poly3d</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">Polyline3d</font></span><font color="#000000">())</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">poly3d</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">SetDatabaseDefaults</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// Add the new object to the current space block table record</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">curSpace</font></span><font color="#000000"> = </font><span style="color: "><font color="#010001">db</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">CurrentSpaceId</font></span><font color="#000000">.</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt"><span style="color: "><font color="#010001">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Open</font></span></font></font><font face="Consolas"><font style="font-size: 8pt"><font color="#000000">(</font><span style="color: "><font color="#2b91af">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">ForWrite</font></span><font color="#000000">) </font><span style="color: "><font color="#0000ff">as</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">BlockTableRecord</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// because before adding vertexes, the polyline must be in the drawing</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">curSpace</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">AppendEntity</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">poly3d</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">Point3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pnt</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">pnts</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// now create the vertices</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">PolylineVertex3d</font></span><font color="#000000"> </font><span style="color: "><font color="#010001">poly3dVertex</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#2b91af">PolylineVertex3d</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">pnt</font></span><font color="#000000">))</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><span style="color: "><font style="font-size: 8pt" color="#008000">// and add them to the 3dpoly (this adds them to the db also</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#010001">poly3d</font></span><font color="#000000">.</font><span style="color: "><font color="#010001">AppendVertex</font></span><font color="#000000">(</font><span style="color: "><font color="#010001">poly3dVertex</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p> </div>
