---
layout: "post"
title: "Programmatically Attaching Digital Signatures to AutoCAD Drawings"
date: "2015-02-26 16:10:00"
author: "Madhukar Moogala"
categories:
  - ".NET"
  - "2014"
  - "2015"
  - "Madhukar Moogala"
original_url: "https://adndevblog.typepad.com/autocad/2015/02/programmatically-attaching-digital-signatures-to-autocad-drawings.html "
typepad_basename: "programmatically-attaching-digital-signatures-to-autocad-drawings"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/Madhukar-Moogala.html" target="_self">Madhukar Moogala</a></p>  <p>In this blog we will see how we can leverage SecurityParams AutoCAD .NET API to digitally sign drawings[read DWG\DXF].</p>  <p>First and foremost important thing is to have Digital Certificate issued from a recognised vendor, about code signing fundamentals you can refer to <a href="https://msdn.microsoft.com/en-us/library/ie/ms537361%28v=vs.85%29.aspx" target="_blank">this</a>, Certificate vendor generally issues a PFX and password which is require to register in store, for registration of Certificate in store, we can take help of Certificate Import Wizard available in Internet Explorer Tools\Internet Options\Content\Certificates</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7556236970b-pi"><img title="CertificateImport" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="CertificateImport" src="/assets/image_787195.jpg" width="244" height="136" /></a></p>  <p>After registering Certificate in store, here are few preliminary checks.</p>  <ol>   <li>Launch “AcSignApply.exe” Tool shipped with AutoCAD and available in ProgramFiles\AutoDesk\AutoCAD XXX\. And check if your Digital Certificate is available. </li>    <li>Interactively attach your Digital signature to DWG and check if drawing is getting signed. </li> </ol>  <p>In the below screen shot I have shown a Certificate issued by VeriSign which I used for testing.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d0deab9b970c-pi"><img title="AttachDigitalSign" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="AttachDigitalSign" src="/assets/image_394774.jpg" width="244" height="230" /></a></p>  <p>If you are able to sign the drawings interactively the same should be possible using API, here is the code to do.</p>  <div style="font-size: 9pt; font-family: consolas; background: white; color: black">   <p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">void</span> DWGSign() <span style="color: green">// This method can have any name</span></p>    <p style="margin: 0px">{</p>    <p style="margin: 0px"><span style="color: blue">string</span> subject;</p>    <p style="margin: 0px"><span style="color: blue">string</span> issuer;</p>    <p style="margin: 0px"><span style="color: blue">string</span> serialNumber;</p>    <p style="margin: 0px"><span style="color: blue">string</span> comment;</p>    <p style="margin: 0px"><span style="color: blue">string</span> timeServer;</p>    <p style="margin: 0px"><span style="color: blue">uint</span> keyLength;</p>    <p style="margin: 0px"><span style="color: blue">uint</span> providerType;</p>    <p style="margin: 0px"><span style="color: green">// The path to the certificate. </span></p>    <p style="margin: 0px"><span style="color: blue">string</span> PFXpath = <span style="color: #a31515">&quot;C:\\Sign\\Test.pfx&quot;</span>;</p>    <p style="margin: 0px"><span style="color: green">/*password given by CA,</span></p>    <p style="margin: 0px"><span style="color: green">* this is same password which you enter while installing PFX in store*/</span></p>    <p style="margin: 0px"><span style="color: blue">string</span> pwd = <span style="color: #a31515">&quot;TestPassword&quot;</span>;</p>    <p style="margin: 0px"><span style="color: green">// Load the certificate into an X509Certificate object.</span></p>    <p style="margin: 0px"><span style="color: #2b91af">X509Certificate2</span> cert = <span style="color: blue">new</span> <span style="color: #2b91af">X509Certificate2</span>();</p>    <p style="margin: 0px"><span style="color: green">/*Importing certificate*/</span></p>    <p style="margin: 0px">cert.Import(PFXpath, pwd, <span style="color: #2b91af">X509KeyStorageFlags</span>.PersistKeySet);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">/*verify certificate*/</span></p>    <p style="margin: 0px"><span style="color: blue">bool</span> verificationResult = cert.Verify();</p>    <p style="margin: 0px"><span style="color: green">/*Get the CommanName, CN of CA*/</span></p>    <p style="margin: 0px">issuer = cert.GetNameInfo(<span style="color: #2b91af">X509NameType</span>.SimpleName, <span style="color: blue">true</span>);</p>    <p style="margin: 0px">subject = cert.GetNameInfo(<span style="color: #2b91af">X509NameType</span>.SimpleName, <span style="color: blue">false</span>);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">/*get serial number*/</span></p>    <p style="margin: 0px">serialNumber = cert.SerialNumber;</p>    <p style="margin: 0px">comment = <span style="color: #a31515">&quot;You can describe the Drawing info here&quot;</span>;</p>    <p style="margin: 0px"><span style="color: green">/*If timeserver is null, application picks computer time*/</span></p>    <p style="margin: 0px">timeServer = <span style="color: #a31515">&quot;Natl Inst of Standards and Technology(time.nist.gov)&quot;</span>;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: green">/*Encyrption key size*/</span></p>    <p style="margin: 0px">keyLength = (<span style="color: blue">uint</span>)cert.PublicKey.Key.KeySize;</p>    <p style="margin: 0px"><span style="color: green">/*Numeric Id*/</span></p>    <p style="margin: 0px">providerType = (<span style="color: blue">uint</span>)cert.Version;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">try</span></p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">string</span> mainfullpath = <span style="color: #a31515">&quot;C:\\Temp\\Architectural - Metric.dwg&quot;</span>;</p>    <p style="margin: 0px"><span style="color: #2b91af">Database</span> tempDb;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">using</span> (tempDb = <span style="color: blue">new</span> <span style="color: #2b91af">Database</span>(<span style="color: blue">false</span>, <span style="color: blue">true</span>))</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">tempDb.ReadDwgFile(mainfullpath,</p>    <p style="margin: 0px"><span style="color: #2b91af">FileShare</span>.ReadWrite,</p>    <p style="margin: 0px"><span style="color: blue">false</span>,</p>    <p style="margin: 0px"><span style="color: #a31515">&quot;&quot;</span>);</p>    <p style="margin: 0px">tempDb.CloseInput(<span style="color: blue">true</span>);</p>    <p style="margin: 0px"><span style="color: #2b91af">SecurityParameters</span> sp = <span style="color: blue">new</span> <span style="color: #2b91af">SecurityParameters</span>(<span style="color: blue">null</span>,</p>    <p style="margin: 0px"><span style="color: blue">null</span>,</p>    <p style="margin: 0px">subject,</p>    <p style="margin: 0px">issuer,</p>    <p style="margin: 0px">serialNumber,</p>    <p style="margin: 0px">comment,</p>    <p style="margin: 0px">timeServer,</p>    <p style="margin: 0px"><span style="color: #2b91af">SecurityActions</span>.SignData,</p>    <p style="margin: 0px"><span style="color: #2b91af">SecurityAlgorithm</span>.RC4,</p>    <p style="margin: 0px">keyLength,</p>    <p style="margin: 0px">providerType);</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">mainfullpath = <span style="color: #a31515">&quot;C:\\Temp\\Signednew.dwg&quot;</span>;</p>    <p style="margin: 0px">tempDb.SaveAs(mainfullpath, <span style="color: blue">false</span>, <span style="color: #2b91af">DwgVersion</span>.Current, sp);</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px"><span style="color: blue">catch</span> (<span style="color: #2b91af">SystemException</span> ex)</p>    <p style="margin: 0px">{</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: #2b91af">Editor</span> ed = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Editor;</p>    <p style="margin: 0px">&#160;&#160;&#160; ed.WriteMessage(ex.Message);</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><font size="2" face="Arial">After succeeding code, you would see a logo on the DWG thumbnail and when opened in AutoCAD you would get entire signing information of the drawing.</font></p>    <p style="margin: 0px"><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d0deab9f970c-pi"><img title="Signature" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Signature" src="/assets/image_829803.jpg" width="143" height="144" /></a></p>    <p style="margin: 0px"></p> </div>
