---
layout: "post"
title: "Converting Paper Space point to Model Space using AutoCAD.NET"
date: "2012-03-29 10:56:05"
author: "Fenton Webb"
categories:
  - ".NET"
  - "2010"
  - "2011"
  - "2012"
  - "2013"
  - "AutoCAD"
  - "Fenton Webb"
original_url: "https://adndevblog.typepad.com/autocad/2012/03/converting-paper-space-point-to-model-space-using-autocadnet.html "
typepad_basename: "converting-paper-space-point-to-model-space-using-autocadnet"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/fenton-webb.html" target="_self">Fenton Webb</a></p>  <p>Recently I tried to find some information on how to convert a Paper Space point to a Model Space point, and was shocked to find there was no simple to use sample code!!! Perhaps I missed something obvious, nevertheless, I opted to create my own and share it with you.</p>  <p>The code below utilizes the acedTrans() (which has been around since the R11 ADS days) using PInvoke, it’s very simple to use when you know how.</p>  <p>To run and test the code out:</p>  <ol>   <li>Run AutoCAD and load the code below </li>    <li>Switch to Paper Space, either click the Layout tab or set TILEMODE=0 </li>    <li>Create a VPort </li>    <li>Make sure you have TILEMODE=0 </li>    <li>Run my “ps2ms” command and click somewhere over the MS VPort. You will see a DBPoint appear directly under your cursor, but in Model space. </li>    <li>If you can’t see the DBPoint, simply set PDSIZE=10 and PDMODE=98 </li> </ol>  <p>Hope you like it.</p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// convert a PS point to MS and then add a DBPoint to MS to show where we picked</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// by Fenton Webb, DevTech, Autodesk, 20/Aug/2012</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="color: "><font color="#0000ff"><font style="font-size: 8pt">#if</font></font></span><font color="#000000" style="font-size: 8pt"> NOTACAD2013</font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Courier New"><font color="#808080" style="font-size: 8pt">&#0160; [DllImport(&quot;acad.exe&quot;, CallingConvention = CallingConvention.Cdecl, EntryPoint=&quot;acedTrans&quot;)]</font></font></span></p>    <p style="margin: 0px"><span style="color: "><font face="Courier New"><font color="#0000ff" style="font-size: 8pt">#else</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; [</font></font><font style="font-size: 8pt"><span style="color: "><font color="#2b91af">DllImport</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;accore.dll&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">CallingConvention</font></span><font color="#000000"> = </font><span style="color: "><font color="#2b91af">CallingConvention</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Cdecl</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">EntryPoint</font></span><font color="#000000"> = </font><span style="color: "><font color="#a31515">&quot;acedTrans&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><span style="color: "><font face="Courier New"><font color="#0000ff" style="font-size: 8pt">#endif</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">extern</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">acedTrans</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[] </font><span style="color: "><font color="#020002">point</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">fromRb</font></span><font color="#000000">, </font><span style="color: "><font color="#2b91af">IntPtr</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">toRb</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">int</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">disp</font></span><font color="#000000">, </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[] </font><span style="color: "><font color="#020002">result</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; [</font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;ps2ms&quot;</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">CommandFlags</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">NoTileMode</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">static</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">void</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ps2ms</font></span><font color="#000000">()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;&#0160;&#0160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">Editor</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ed</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">Application</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">DocumentManager</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">MdiActiveDocument</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Editor</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// pick some point in PS</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">PromptPointResult</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">res</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">GetPoint</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Pick Model Space Point&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">if</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">res</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Status</font></span><font color="#000000"> == </font><span style="color: "><font color="#020002">PromptStatus</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">OK</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// now to make sure this works for all viewpoints</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">psdcs</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">TypedValue</font></span><font color="#000000">(5003, 3));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">dcs</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">TypedValue</font></span><font color="#000000">(5003, 2));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">wcs</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ResultBuffer</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">TypedValue</font></span><font color="#000000">(5003, 0));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[] </font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#0000ff">double</font></span><font color="#000000">[] { 0, 0, 0 };</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// translate from the DCS of Paper Space (PSDCS) RTSHORT=3 to </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// the DCS of the current model space viewport RTSHORT=2</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">acedTrans</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">psdcs</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">UnmanagedObject</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">dcs</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">UnmanagedObject</font></span><font color="#000000">, 0, </font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">//translate the DCS of the current model space viewport RTSHORT=2</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">//to the WCS RTSHORT=0</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">acedTrans</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">dcs</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">UnmanagedObject</font></span><font color="#000000">, </font><span style="color: "><font color="#020002">wcs</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">UnmanagedObject</font></span><font color="#000000">, 0, </font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">ObjectId</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">btId</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">ed</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Document</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Database</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">BlockTableId</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><span style="color: "><font color="#008000" style="font-size: 8pt">// create a new DBPoint and add it to model space to show where we picked</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">DBPoint</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">pnt</font></span><font color="#000000"> = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">DBPoint</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">Point3d</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">[0], </font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">[1], </font><span style="color: "><font color="#020002">retPoint</font></span><font color="#000000">[2])))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">BlockTable</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">bt</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">btId</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">ForRead</font></span><font color="#000000">) </font><span style="color: "><font color="#0000ff">as</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">BlockTable</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">using</font></span><font color="#000000"> (</font><span style="color: "><font color="#020002">BlockTableRecord</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">ms</font></span><font color="#000000"> = </font><span style="color: "><font color="#020002">bt</font></span><font color="#000000">[</font><span style="color: "><font color="#020002">BlockTableRecord</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">ModelSpace</font></span><font color="#000000">].</font><span style="color: "><font color="#020002">Open</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">OpenMode</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">ForWrite</font></span><font color="#000000">) </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#0000ff">as</font></span><font color="#000000"> </font><span style="color: "><font color="#020002">BlockTableRecord</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; </font></font><font style="font-size: 8pt"><span style="color: "><font color="#020002">ms</font></span><font color="#000000">.</font><span style="color: "><font color="#020002">AppendEntity</font></span><font color="#000000">(</font><span style="color: "><font color="#020002">pnt</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;&#0160;&#0160;&#0160;&#0160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000" style="font-size: 8pt">&#0160;&#0160;&#0160; }</font></font></p> </div>  <p style="margin: 0px"><span style="font-family: consolas"><span style="color: #000000"></span></span></p>
