---
layout: "post"
title: "Undefining AutoCAD Commands"
date: "2012-07-02 05:42:55"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD"
  - "ObjectARX"
original_url: "https://adndevblog.typepad.com/autocad/2012/07/undefining-autocad-commands.html "
typepad_basename: "undefining-autocad-commands"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html" target="_blank">Augusto Goncalves</a></p>  <p>The initial option, <strong>acedRegCmds-&gt;removeCmd()</strong>, only works with ARX registered commands. It does not undefine AutoCAD native commands. The AutoCAD command UNDEFINE is definitively the way to go. Because after a OPEN or a NEW, the commands are redefined by AutoCAD you have to call Undefine each time AutoCAD sends the <strong>kLoadDwgMsg</strong> notification to your program. </p>  <p>The problem is that we cannot use <strong>acedCommand</strong>() within the <strong>kLoadDwgMsg</strong> notification. The workaround is to use the undocumented function <strong>ads_queueexpr</strong>() to queue the command in form of a LISP expression:</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">virtual</font></font></span><font style="font-size: 8pt"><font color="#000000"> AcRx::AppRetCode On_kLoadDwgMsg(</font><span><font color="#0000ff">void</font></span><font color="#000000"> * pkt)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; AcRx::AppRetCode retCode =AcRxArxApp::On_kLoadDwgMsg (pkt) ;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">// queue the expression</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; ads_queueexpr(_T(</font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;(command \&quot;_.undefine\&quot; \&quot;saveas\&quot;)&quot;</font></span><font color="#000000">));</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><font style="font-size: 8pt"><span><font color="#0000ff">return</font></span><font color="#000000"> (retCode) ;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></p> </div>  <p><strong>ads_queueexpr</strong> will send a command to the AutoCAD command line, but won't process it until the command processor is ready. Also, that is why it is the only command capable of passing a command in while opening a drawing from zero document state</p>
