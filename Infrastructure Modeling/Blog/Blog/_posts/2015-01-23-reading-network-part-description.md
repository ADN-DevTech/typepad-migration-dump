---
layout: "post"
title: "Reading Network Part Description"
date: "2015-01-23 11:03:23"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D 2015"
original_url: "https://adndevblog.typepad.com/infrastructure/2015/01/reading-network-part-description.html "
typepad_basename: "reading-network-part-description"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>If you try read the Pipe or Structure Description using the API, it will return the size information, which is not what we need. In fact that information is on the database, but we need to get it from the part family. The code below show how it can be done. Note the method signature for Extensions.</p>  <p>Here is the code:</p>  <pre style="font-size: 12px; font-family: consolas; background: white; color: black"><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">string</span> GetPartDescription(<span style="color: blue">this</span>&#160;<span style="color: #2b91af">Part</span> p)<br />{<br />&#160; <span style="color: blue">using</span> (<span style="color: #2b91af">Transaction</span> trans = p.Database.TransactionManager.StartTransaction())<br />&#160; {<br />&#160;&#160;&#160; <span style="color: green">// access the part (pipe or structure) network</span><br />&#160;&#160;&#160; <span style="color: #2b91af">Network</span> pipenetwork = trans.GetObject(p.NetworkId, <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">Network</span>;<br />&#160;&#160;&#160; <span style="color: green">// get the parts list of the network</span><br />&#160;&#160;&#160; <span style="color: #2b91af">PartsList</span> partsList = trans.GetObject(pipenetwork.PartsListId, <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">PartsList</span>;<br />&#160;&#160;&#160; <span style="color: green">// for each family on the parts list...</span><br />&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> f = 0; f &lt; partsList.PartFamilyCount; f++)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// ... get the information and...</span><br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">PartFamily</span> partFam = trans.GetObject(partsList[f], <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">PartFamily</span>;<br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// ... get all sizes and...</span><br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">for</span> (<span style="color: blue">int</span> s = 0; s &lt; partFam.PartSizeCount; s++)<br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// for each size, check if the name match</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">PartSize</span> partSize = trans.GetObject(partFam[s], <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">PartSize</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// if the name match, return the part family name </span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// which is the information we're looking for</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (partSize.Name.Equals(p.PartDescription)) <span style="color: blue">return</span> partFam.Name;<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />&#160; }<br />&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">string</span>.Empty;<br />}</pre>

<p>That can be used like a property (thanks to .NET Extension mechanism):</p>

<pre style="font-size: 12px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;showpartdesc&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CmdShowPartDescription()<br />{<br />&#160; <span style="color: #2b91af">Editor</span> ed = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Editor;<br />&#160; <span style="color: #2b91af">PromptEntityOptions</span> peo = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">PromptEntityOptions</span>(<span style="color: #a31515">&quot;\nSelect a pipe or structure: &quot;</span>);<br />&#160; peo.SetRejectMessage(<span style="color: #a31515">&quot;\nOnly pipes or structures&quot;</span>);<br />&#160; peo.AddAllowedClass(<span style="color: blue">typeof</span>(<span style="color: #2b91af">Part</span>), <span style="color: blue">false</span>);<br />&#160; <span style="color: #2b91af">PromptEntityResult</span> per = ed.GetEntity(peo);<br />&#160; <span style="color: blue">if</span> (per.Status != <span style="color: #2b91af">PromptStatus</span>.OK) <span style="color: blue">return</span>;<br /> <br />&#160; <span style="color: #2b91af">Database</span> db = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Database;<br />&#160; <span style="color: blue">using</span> (<span style="color: #2b91af">Transaction</span> trans = db.TransactionManager.StartTransaction())<br />&#160; {<br />&#160;&#160;&#160; <span style="color: #2b91af">Part</span> p = trans.GetObject(per.ObjectId, <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">Part</span>;<br />&#160;&#160;&#160; ed.WriteMessage(<span style="color: #a31515">&quot;\nPipe description: {0}&quot;</span>, p.GetPartDescription());<br />&#160; }<br />}</pre>
