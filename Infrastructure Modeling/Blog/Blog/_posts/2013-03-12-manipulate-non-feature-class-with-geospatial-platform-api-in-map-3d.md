---
layout: "post"
title: "Manipulate non-feature class with Geospatial Platform API in Map 3D"
date: "2013-03-12 01:23:09"
author: "Daniel Du"
categories:
  - "AIMS 2012"
  - "AIMS 2013"
  - "AutoCAD Map 3D 2012"
  - "AutoCAD Map 3D 2013"
  - "Daniel Du"
  - "FDO"
original_url: "https://adndevblog.typepad.com/infrastructure/2013/03/manipulate-non-feature-class-with-geospatial-platform-api-in-map-3d.html "
typepad_basename: "manipulate-non-feature-class-with-geospatial-platform-api-in-map-3d"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/daniel-du.html">Daniel Du</a></p>  <p>Firstly what is feature class and non-feature class? Generally speaking, a Feature Class is a class with associated geometry, so that it is possible to create a layer in Map 3D or AIMS. A non-feature class just contains non-spatial data that can be used as a standalone or contained class has not geometry field. Geospatial Plat for API, which uses FDO, can manipulate both feature class and non feature class.</p>  <p>let’s say we have a feature schema as below, which is a SDF data source, there are two classes in the schema, one is feature class with Geometry field, another is non-feature class, just attribute fields.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c37939c4a970b-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_c40eae.jpg" width="484" height="430" /></a></p>  <p>&#160;</p>  <p>If you connect to this data source in Map 3D, you will notice that the non-feature class is gray out as it cannot be added to map as layer.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c37939cbd970b-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_7e5f51.jpg" width="499" height="392" /></a></p>  <p>&#160;</p>  <p>Now let’s add some data into this non-feature class with Geospatial platform API. The important thing is to get the resource identifier of the data source, since it is connected to Map 3D and add a layer, I use following code to demo how to get the resource ID:</p>  <pre style="line-height: normal; font-family: ; background: white; color: "><font face="新宋体"><font color="#000000"><font style="font-size: 7.8pt">[</font></font><font style="font-size: 7.8pt"><span style="color: "><font color="#2b91af">CommandMethod</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;InsertNonFeatureClass&quot;</font></span><font color="#000000">)]</font><br /><span style="color: "><font color="#0000ff">public</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#0000ff">void</font></span></font></font><font style="font-size: 7.8pt"><font face="新宋体"><font color="#000000"> InsertNonFeatureClass()<br />{<br />&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">const</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> LAYERNAME = </font><span style="color: "><font color="#a31515">&quot;River&quot;</font></span></font><font face="新宋体"><font color="#000000">;<br />&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgFeatureService</font></span><font color="#000000"> featuerSvc = </font><span style="color: "><font color="#2b91af">AcMapServiceFactory</font></span><br /><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .GetService(</font><span style="color: "><font color="#2b91af">MgServiceType</font></span></font><font face="新宋体"><font color="#000000">.FeatureService) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">as</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgFeatureService</font></span></font><font face="新宋体"><font color="#000000">;<br /> <br />&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//This is just for demonstration of the format of FeatureSourceId</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">AcMapMap</font></span><font color="#000000"> currentMap = </font><span style="color: "><font color="#2b91af">AcMapMap</font></span></font><font face="新宋体"><font color="#000000">.GetCurrentMap();<br />&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgLayerBase</font></span><font color="#000000"> layer = </font><span style="color: "><font color="#0000ff">null</font></span></font><font face="新宋体"><font color="#000000">;<br />&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgLayerCollection</font></span></font><font face="新宋体"><font color="#000000"> allLayers = currentMap.GetLayers();<br />&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">foreach</font></span><font color="#000000"> (</font><span style="color: "><font color="#2b91af">MgLayerBase</font></span><font color="#000000"> lyr </font><span style="color: "><font color="#0000ff">in</font></span></font><font face="新宋体"><font color="#000000"> allLayers)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">if</font></span></font><font face="新宋体"><font color="#000000"> (lyr.Name == LAYERNAME)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; layer = lyr;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">break</font></span></font><font face="新宋体"><font color="#000000">;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//Just to demonstrate the format of FeatureSource</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">string</font></span></font><font face="新宋体"><font color="#000000"> resId = layer.FeatureSourceId;<br />&#160;&#160;&#160; System.Windows.Forms.</font><span style="color: "><font color="#2b91af">MessageBox</font></span></font><font face="新宋体"><font color="#000000">.Show(resId);<br /> <br />&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//---------------------------</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//Library://River.FeatureSource</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//---------------------------</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//OK&#160;&#160; </font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//---------------------------</font></span><br /></font><font face="新宋体"><font color="#000000"> <br /> <br /> <br /> <br />&#160;&#160;&#160; </font><span style="color: "><font color="#008000">// Insert into non-feature class</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgResourceIdentifier</font></span><font color="#000000"> featureSourceId = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgResourceIdentifier</font></span></font><font face="新宋体"><font color="#000000">(resId);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> className = </font><span style="color: "><font color="#a31515">&quot;DefaultSchema:RiverAttributes&quot;</font></span><font color="#000000">; </font><span style="color: "><font color="#008000">//feature class name</font></span><br /><font color="#000000">&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgPropertyCollection</font></span><font color="#000000"> properities = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgPropertyCollection</font></span></font><font face="新宋体"><font color="#000000">();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; </font><span style="color: "><font color="#008000">//ID is auto generated</font></span><br /></font><font face="新宋体"><font color="#000000">&#160;&#160;&#160; properities.Add(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgStringProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Name&quot;</font></span></font><font face="新宋体"><font color="#000000">, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#a31515">&quot;Yangzi River&quot;</font></span></font><font face="新宋体"><font color="#000000">));<br />&#160;&#160;&#160; properities.Add(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgStringProperty</font></span><font color="#000000">(</font><span style="color: "><font color="#a31515">&quot;Desciption&quot;</font></span></font><font face="新宋体"><font color="#000000">, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#a31515">&quot;The longest river in China&quot;</font></span></font><font face="新宋体"><font color="#000000">));<br />&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgInsertFeatures</font></span></font><font face="新宋体"><font color="#000000"> insFeature = <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgInsertFeatures</font></span></font><font face="新宋体"><font color="#000000">(className, properities);<br /> <br />&#160;&#160;&#160; </font><span style="color: "><font color="#2b91af">MgFeatureCommandCollection</font></span><font color="#000000"> commands = </font><span style="color: "><font color="#0000ff">new</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#2b91af">MgFeatureCommandCollection</font></span></font></font><font face="新宋体"><font style="font-size: 7.8pt"><font color="#000000">();<br />&#160;&#160;&#160; commands.Add(insFeature);<br /> <br />&#160;&#160;&#160; featuerSvc.UpdateFeatures(featureSourceId, commands, </font><span style="color: "><font color="#0000ff">false</font></span><font color="#000000">);<br /> <br />}</font></font></font></pre>

<p>&#160;</p>

<p>here is the result in Data table: </p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017ee936c8cd970d-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_a4da90.jpg" width="535" height="119" /></a></p>

<p>&#160;</p>

<p>From the code snippet, it is exactly the same as operating a feature class, with feature service. Actually for a feature class has been added to map as layer, there is a simple way, that is ： 
  <br />&quot;Layer.UpdateFeatures() &quot;</p>

<p>This method actually call underlay feature service to update features. But if you want to update a non-feature class, that does not have a corresponding layer, you have to use the lower lever API - featureService.UpdateFeatures() as demoed in ditto code snippet. Please note that this concept also applies to AIMS as well, The code can be migrated to AIMS with only minor changes. </p>

<p>Hope this helps.</p>
