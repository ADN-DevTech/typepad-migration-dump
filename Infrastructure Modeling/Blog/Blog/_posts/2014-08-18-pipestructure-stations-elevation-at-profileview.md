---
layout: "post"
title: "Pipe/Structure stations &amp; elevation at ProfileView"
date: "2014-08-18 12:14:28"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D 2015"
original_url: "https://adndevblog.typepad.com/infrastructure/2014/08/pipestructure-stations-elevation-at-profileview.html "
typepad_basename: "pipestructure-stations-elevation-at-profileview"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>There is an interesting object available on the Civil 3D API: the <strong>ProfileViewPart</strong>. Actually it’s a database resident object, meaning we can select and get its <strong>ObjectId</strong>, but also acts as a ‘proxy’ for Part (Pipe and Structure) that are on a specific <strong>ProfileView</strong>.</p>  <p>More than that, from this <strong>ProfileViewPart</strong>, we can reach the original Part and get all the profile views showing it. Now the tricky part is: how get the station and elevation? In fact there is no direct API for it, but we can workaround this with the geometry of the part at the profile view getting its <strong>GeometryExtent</strong> and, from the XY, get the station and elevation.</p>  <p>The sample below demonstrate the idea.</p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;getPartOnProfileView&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CmdGetPartOnProfileView()<br />{<br />&#160; <span style="color: green">// select a part on the profile view</span><br />&#160; <span style="color: #2b91af">Editor</span> ed = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Editor;<br />&#160; <span style="color: #2b91af">PromptEntityOptions</span> peo = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">PromptEntityOptions</span>(<br />&#160;&#160;&#160; <span style="color: #a31515">&quot;Select a part on the profile view: &quot;</span>);<br />&#160; peo.SetRejectMessage(<span style="color: #a31515">&quot;\nOnly parts on profile view&quot;</span>);<br />&#160; peo.AddAllowedClass(<span style="color: blue">typeof</span>(<span style="color: #2b91af">ProfileViewPart</span>), <span style="color: blue">true</span>);<br />&#160; <span style="color: #2b91af">PromptEntityResult</span> per = ed.GetEntity(peo);<br />&#160; <span style="color: blue">if</span> (per.Status != <span style="color: #2b91af">PromptStatus</span>.OK) <span style="color: blue">return</span>;<br /> <br />&#160; <span style="color: #2b91af">Database</span> db = <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument.Database;<br />&#160; <span style="color: blue">using</span> (<span style="color: #2b91af">Transaction</span> trans = db.TransactionManager.StartTransaction())<br />&#160; {<br />&#160;&#160;&#160; <span style="color: green">// get the part showing on the view</span><br />&#160;&#160;&#160; <span style="color: #2b91af">ProfileViewPart</span> partPV = trans.GetObject(per.ObjectId,<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">ProfileViewPart</span>;<br />&#160;&#160;&#160; <span style="color: #2b91af">Part</span> part = trans.GetObject(partPV.ModelPartId,<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">Part</span>;<br /> <br />&#160;&#160;&#160; <span style="color: green">// may have several PVs showing this part...</span><br />&#160;&#160;&#160; <span style="color: #2b91af">ObjectIdCollection</span> pvIds = part.GetProfileViewsDisplayingMe();<br />&#160;&#160;&#160; <span style="color: blue">foreach</span> (ObjectId pvId <span style="color: blue">in</span> pvIds)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// get the average point of this structure on the profile view</span><br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// you may change this X,Y to the max or min...</span><br />&#160;&#160;&#160;&#160;&#160; Extents3d ext = partPV.GeometricExtents;<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> x = (ext.MaxPoint.X - ext.MinPoint.X) / 2 + ext.MinPoint.X;<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> y = (ext.MaxPoint.Y - ext.MinPoint.Y) / 2 + ext.MinPoint.Y;<br /> <br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// get the profile view</span><br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ProfileView</span> pv = trans.GetObject(pvId, <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">ProfileView</span>;<br /> <br />&#160;&#160;&#160;&#160;&#160; <span style="color: green">// and the station/elevation on the profile view</span><br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> station = 0.0;<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">double</span> elevation = 0.0;<br />&#160;&#160;&#160;&#160;&#160; pv.FindStationAndElevationAtXY(x, y, <span style="color: blue">ref</span> station, <span style="color: blue">ref</span> elevation);<br /> <br />&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;\n{0} showing on {1} at station: {2:0.00} | Elevation: {3:0.00}&quot;</span>,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; part.Name, pv.Name, station, elevation);<br />&#160;&#160;&#160; }<br />&#160; }<br />}</pre>
