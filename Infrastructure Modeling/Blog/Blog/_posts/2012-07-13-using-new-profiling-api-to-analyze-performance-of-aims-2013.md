---
layout: "post"
title: "Using New Profiling API to Analyze Performance of AIMS 2013"
date: "2012-07-13 03:07:00"
author: "Daniel Du"
categories:
  - "AIMS 2013"
  - "Daniel Du"
original_url: "https://adndevblog.typepad.com/infrastructure/2012/07/using-new-profiling-api-to-analyze-performance-of-aims-2013.html "
typepad_basename: "using-new-profiling-api-to-analyze-performance-of-aims-2013"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/daniel-du.html">Daniel Du</a></p>  <p>In <a href="http://adndevblog.typepad.com/infrastructure/2012/07/understanding-the-performance-report-of-aims2013.html" target="_blank">previous post</a>, I introduce how to understand the result of performance report. In this post, I will introduce how to use the new profiling API, which makes it possible to create you own performance report.</p>  <p>In AIMS 2013 API, a new service is added, which is MgProfilingService, it is used to profile existing MapGuide APIs.</p>  <p>Here are two methods of MgProfilingService:</p>  <p>virtual MgByteReader *&#160;&#160;&#160;&#160; ProfileRenderDynamicOverlay (    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgMap *map,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgSelection *selection,&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgRenderingOptions *options)=0</p>  <p>Profile the process of rendering all dynamic layers in the specified MgMap to a dynamic overlay image with a transparent background.   <br />    <br />virtual MgByteReader *&#160;&#160;&#160;&#160; ProfileRenderMap (     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgMap *map,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgSelection *selection,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgCoordinate *center,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; double scale,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; INT32 width, INT32 height,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MgColor *backgroundColor,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CREFSTRING format,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bool bKeepSelection)=0</p>  <p>Profile the process of rendering a MgMap to the requested image format with specified center point and scale. </p>  <p>Now let's look at how to use these APIs to get detailed performance report information. AIMS API can be used in Java, PHP or .NET, I would like to use .NET here. Firstly create a AIMS custom WebApplication, and create a custom command to invoke an URL, which is an ASP.NET web page. Here is the source code of web page: </p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Collections.Generic;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Linq;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Web;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Web.UI;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> System.Web.UI.WebControls;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">using</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> OSGeo.MapGuide;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">namespace</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> HelloAIMS2013</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">{</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">partial</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">class</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">ProfilingAPI</font></span><span style="line-height: 11pt"><font color="#000000"> : System.Web.UI.</font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">Page</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">protected</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">void</font></span><span style="line-height: 11pt"><font color="#000000"> Page_Load(</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">object</font></span><span style="line-height: 11pt"><font color="#000000"> sender, </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">EventArgs</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> e)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">UtilityClass</font></span><span style="line-height: 11pt"><font color="#000000"> util = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">UtilityClass</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; util.InitializeWebTier(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">HttpContext</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Current.Request);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">String</font></span><span style="line-height: 11pt"><font color="#000000"> sessionId = Request[</font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;SESSION&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">].ToString();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; util.ConnectToServer(sessionId);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgSiteConnection</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> siteConn = util.GetSiteConnection();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgResourceService</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> resourceService = siteConn</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .CreateService(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgServiceType</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ResourceService) </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">as</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgResourceService</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//Create MgProfilingService instance</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgProfilingService</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> profilingService = siteConn</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .CreateService(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgServiceType</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ProfilingService) </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">as</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgProfilingService</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//open current map</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgMap</font></span><span style="line-height: 11pt"><font color="#000000"> map = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgMap</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000"> (Request[</font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;mapname&quot;</font></span><span style="line-height: 11pt"><font color="#000000">] != </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">null</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span><span style="line-height: 11pt"><font color="#000000"> mapName = Request[</font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;mapname&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">].ToString();</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.Open(resourceService, mapName);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//remove base layer, profiling API doesn't apply to base layers</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">for</font></span><span style="line-height: 11pt"><font color="#000000"> (</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">int</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> i = 0; i &lt; map.GetLayers().Count; i++)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgLayerBase</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> lyr = map.GetLayers().GetItem(i);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">if</font></span><span style="line-height: 11pt"><font color="#000000"> (lyr.LayerType == </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgLayerType</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.BaseMap)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.GetLayers().Remove(lyr);</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.Save(resourceService);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #region</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> sample 1, dome of ProfileRenderDynamicOverlay()</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span><span style="line-height: 11pt"><font color="#000000"> format = </font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;PNG&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">// enum&#160;&#160;&#160; { RenderSelection = 1, RenderLayers = 2, KeepSelection = 4 }</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">// Rendering behavior values. </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//RenderSelection - Renders the selected feature(s). </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//RenderLayers - Renders the features on the map. </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//KeepSelection - Renders the selected feature(s) even if they are outside the current scale.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">int</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> behavior = 2;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgColor</font></span><span style="line-height: 11pt"><font color="#000000"> selectionColor = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgColor</font></span><span style="line-height: 11pt"><font color="#000000">(System.Drawing.</font></span><span style="line-height: 11pt; color: "><font color="#2b91af">Color</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Blue);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgRenderingOptions</font></span><span style="line-height: 11pt"><font color="#000000"> renderingOptions = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgRenderingOptions</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(format,behavior, selectionColor);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteReader</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> byteReader = profilingService.ProfileRenderDynamicOverlay(</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; map, </font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">null</font></span><span style="line-height: 11pt"><font color="#000000">, </font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//MgSelection, do not have selection here</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderingOptions);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//Store in a file</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteSink</font></span><span style="line-height: 11pt"><font color="#000000"> byteSink = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteSink</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(byteReader);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; byteSink.ToFile(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">@&quot;c:\delete\profilingResult.txt&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Response.Write(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">@&quot;write result to c:\delete\profilingResult.txt &lt;br/&gt;&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt; color: "><font face="Courier New"><font style="font-size: 8pt" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #endregion</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt; color: "><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #region</font></font></span><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> Sample 2, demo of ProfileRenderMap</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgCoordinate</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> center = map.ViewCenter.Coordinate;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">double</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> scale = map.ViewScale;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">int</font></span><span style="line-height: 11pt"><font color="#000000"> width = </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">Convert</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ToInt32(map.GetDisplayWidth());</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">int</font></span><span style="line-height: 11pt"><font color="#000000"> height = </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">Convert</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.ToInt32(map.GetDisplayHeight());</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgColor</font></span><span style="line-height: 11pt"><font color="#000000"> backgroundColor = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgColor</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(map.GetBackgroundColor());</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span><span style="line-height: 11pt"><font color="#000000"> format2 = </font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;PNG&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">bool</font></span><span style="line-height: 11pt"><font color="#000000"> bKeepSelection = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">true</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteReader</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> byteReader2 = profilingService.ProfileRenderMap(</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; map,</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">null</font></span><span style="line-height: 11pt"><font color="#000000">,</font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//MgSelection</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; center,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; scale,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; width,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; height,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; backgroundColor,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; format2,</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bKeepSelection);</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//Store in a file</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteSink</font></span><span style="line-height: 11pt"><font color="#000000"> byteSink2 = </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgByteSink</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">(byteReader2);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; byteSink2.ToFile(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">@&quot;c:\delete\profilingResult2.txt&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; Response.Write(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">@&quot;write result to c:\delete\profilingResult2.txt&lt;br/&gt;&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt; color: "><font face="Courier New"><font style="font-size: 8pt" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160; #endregion</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">}</font></font></span></p> </div>  <p>The code is selfexplanatory, it does performance report based on current map extent and current scale, and write the performance report result into a text file in XML format. These XML files include detailed information of performance. For example, you can find the total rendering time and time cost of each layer:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01774351ef75970d-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_230ab3.jpg" width="470" height="739" /></a></p>  <p>With these detailed information, you can implement your own performance report yourself. </p>  <p>If you want to know more about the performance report of AIMS Site Administrator, it is in PHP, all source code is released with the product, you can find then at &lt;Infrastructure Web Server Extension 2013&gt;\www\mapadmin.</p>  <p>OK, with that I draw an end to this post, do you think the profiling API is useful? You are welcome to leave us a comment below about your thought. We are always eager to hear from you.</p>
