---
layout: "post"
title: "Using LINQ with Civil 3D ActiveX objects"
date: "2012-05-21 13:13:31"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D 2011"
  - "AutoCAD Civil 3D 2012"
original_url: "https://adndevblog.typepad.com/infrastructure/2012/05/using-linq-with-civil-3d-activex-objects.html "
typepad_basename: "using-linq-with-civil-3d-activex-objects"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>Yes it is possible use .NET LINQ (Language-Integrated Query) features with Civil 3D ActiveX objects, this Microsoft technology consists in a set of extensions to .NET languages and supporting libraries that allow users to formulate queries within the programming language itself.</p>  <p>We can use it for a Civil 3D ActiveX collection like points, the following code sample demonstrate it. It can also be used for .NET collections in a similar way, but the new Point .NET API on Civil 3D 2013 have better features.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">private </font></font></span><font style="font-size: 10pt" color="#000000">Autodesk.AECC.Interop.UiLand.AeccApplication aeccApp;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">private</font></font></span><font style="font-size: 10pt" color="#000000"> Autodesk.AECC.Interop.UiLand.AeccDocument aeccDoc;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">private</font></font></span><font style="font-size: 10pt" color="#000000"> Autodesk.AECC.Interop.Land.AeccDatabase aeccDb;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Consolas"><font style="font-size: 10pt" color="#008000">//Get Civil 3D objects</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">public</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> getCivilObjects()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; AcadApplication oApp = (AcadApplication)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font style="font-size: 10pt"><span><font color="#2b91af">Application</font></span><font color="#000000">.AcadApplication;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">string</font></span><font color="#000000"> sAppName = </font><span><font color="#a31515">&quot;AeccXUiLand.AeccApplication.9.0&quot;</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; aeccApp = (AeccApplication)oApp.GetInterfaceObject(sAppName);</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; aeccDoc = (AeccDocument)aeccApp.ActiveDocument;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; aeccDb = (AeccDatabase)aeccDoc.Database;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Consolas"><font style="font-size: 10pt" color="#008000">//release Civil 3D objects</font></font></span></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">public</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> releaseCivilObjects()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; Marshal.ReleaseComObject(aeccDb);</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; Marshal.ReleaseComObject(aeccDoc);</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; Marshal.ReleaseComObject(aeccApp);</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">public</font></font></span><font style="font-size: 10pt"><font color="#000000"> AeccPoint[] findPoints(</font><span><font color="#0000ff">double</font></span><font color="#000000"> easting, </font><span><font color="#0000ff">double</font></span><font color="#000000"> northing, </font><span><font color="#0000ff">double</font></span><font color="#000000"> tolerance)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">var</font></span><font color="#000000"> pointLinqSearch = </font><span><font color="#0000ff">from</font></span><font color="#000000"> AeccPoint pto </font><span><font color="#0000ff">in</font></span><font color="#000000"> aeccDb.Points</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#0000ff">where</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#008000">//easting with tolerance</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160; (pto.Easting &gt;= easting - tolerance &amp;&amp; </font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160; pto.Easting &lt;= easting + tolerance) &amp;&amp;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#008000">//northing with tolerance</font></span></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160; (pto.Northing &gt;= northing - tolerance &amp;&amp;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160; pto.Northing &lt;= northing + tolerance)</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">select</font></span><font color="#000000"> pto;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">return</font></span><font color="#000000"> pointLinqSearch.ToArray();</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">[CommandMethod(</font></font><font style="font-size: 10pt"><span><font color="#a31515">&quot;findpto&quot;</font></span><font color="#000000">)]</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><span><font color="#0000ff"><font style="font-size: 10pt">public</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font><span><font color="#0000ff">void</font></span><font color="#000000"> testFindPoint()</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; getCivilObjects();</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; Editor ed = </font></font><font style="font-size: 10pt"><span><font color="#2b91af">Application</font></span><font color="#000000">.DocumentManager.MdiActiveDocument.Editor;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">double</font></span><font color="#000000"> easting, northing, tolerance;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; easting = northing = tolerance = 0.0;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">for</font></span><font color="#000000"> (</font><span><font color="#0000ff">int</font></span><font color="#000000"> i = 0; i &lt; 3; i++)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; PromptDoubleResult pdr = </font></font><font style="font-size: 10pt"><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; PromptDoubleOptions o;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">switch</font></span><font color="#000000"> (i)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 0: pdr = ed.GetDouble(</font><span><font color="#a31515">&quot;Enter easting: &quot;</font></span><font color="#000000">); </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 1: pdr = ed.GetDouble(</font><span><font color="#a31515">&quot;Enter northing: &quot;</font></span><font color="#000000">); </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 2: pdr = ed.GetDouble(</font><span><font color="#a31515">&quot;Enter tolerance: &quot;</font></span><font color="#000000">); </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (pdr.Status != PromptStatus.OK) </font><span><font color="#0000ff">return</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">switch</font></span><font color="#000000"> (i)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 0: easting = pdr.Value; </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 1: northing = pdr.Value; </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">case</font></span><font color="#000000"> 2: tolerance = pdr.Value; </font><span><font color="#0000ff">break</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; AeccPoint[] ptos = findPoints(easting, northing, tolerance);</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">foreach</font></span><font color="#000000"> (AeccPoint pto </font><span><font color="#0000ff">in</font></span><font color="#000000"> ptos)</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; pto.Highlight(</font></font><font style="font-size: 10pt"><span><font color="#0000ff">true</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">&#160; releaseCivilObjects();</font></font></p>    <p style="margin: 0px"><font face="Consolas"><font style="font-size: 10pt" color="#000000">}</font></font></p> </div>
