---
layout: "post"
title: "Disposing COM objects"
date: "2012-05-30 12:21:07"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D 2011"
original_url: "https://adndevblog.typepad.com/infrastructure/2012/05/disposing-com-objects.html "
typepad_basename: "disposing-com-objects"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/autocad/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>While programming with Civil 3D COM objects, it is very common create <strong>AeccXxxx</strong> variables as class variables (modifiers <strong><em>shared</em></strong> in VB.NET or <strong><em>static</em></strong> in C#), like in the code below. This makes like easier, but leaves the Aecc reference longer than required, which can result in problems.</p>  <p>One way to improve that is call <strong>ReleaseComObject</strong> for each variable declared with this modifier. This is not required for variables declared inside methods, which are automatically disposed when the method ends. Also, as the <strong>AcadApplication</strong> is the host, there is no need to manually release it either.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Shared</font></span><font color="#000000"> _acadApp </font><span><font color="#0000ff">As</font></span><font color="#000000"> AcadApplication</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Shared</font></span><font color="#000000"> _aeccApp </font><span><font color="#0000ff">As</font></span><font color="#000000"> AeccApplication</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> GetCivilObjects()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' get Acad App</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; _acadApp = </font></font><font style="font-size: 8pt"><span><font color="#2b91af">Application</font></span><font color="#000000">.AcadApplication</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' get Aecc App</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; _aeccApp = _acadApp.GetInterfaceObject( _</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 8pt"><span><font color="#a31515">&quot;AeccXUiLand.AeccApplication.10.0&quot;</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span><font face="Courier New"><font style="font-size: 8pt" color="#008000">' in the end (before exit) </font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Private</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> ReleaseCivilObjects()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' then release/dispose Aecc App</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; System.Runtime.InteropServices.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">Marshal</font></span><font color="#000000">.ReleaseComObject(_aeccApp)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; _aeccApp = </font></font><span><font style="font-size: 8pt" color="#0000ff">Nothing</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">' call garbage collector (suggested only once at the end)</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; System.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">GC</font></span><font color="#000000">.WaitForPendingFinalizers()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; System.</font></font><font style="font-size: 8pt"><span><font color="#2b91af">GC</font></span><font color="#000000">.Collect()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">Public</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font><span><font color="#0000ff">Sub</font></span><font color="#000000"> MyRoutine()</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; GetCivilObjects()</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">'use aeccApp the variable</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">'...</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 8pt">&#160; </font></font><span><font style="font-size: 8pt" color="#008000">'...</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160; ReleaseCivilObjects()</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 8pt">End</font></font></span><font style="font-size: 8pt"><font color="#000000"> </font></font><span><font style="font-size: 8pt" color="#0000ff">Sub</font></span></font></p> </div>
