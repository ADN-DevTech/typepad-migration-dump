---
layout: "post"
title: "Convert coordinates from GPS (LL84) to Civil 3D active project settings"
date: "2012-10-19 11:36:48"
author: "Augusto Goncalves"
categories:
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D 2013"
original_url: "https://adndevblog.typepad.com/infrastructure/2012/10/convert-coordinates-from-gps-ll84-to-civil-3d-active-project-settings.html "
typepad_basename: "convert-coordinates-from-gps-ll84-to-civil-3d-active-project-settings"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/manufacturing/augusto-goncalves.html">Augusto Goncalves</a></p>  <p>In preparation for my class at AU 2012 Las Vegas, <a href="https://www.autodeskuniversity2012.com/connect/sessionDetail.ww?SESSION_ID=3325">From Mobile and Through the Cloud to AutoCAD Civil 3D</a>, I needed to convert the coordinates of a point captured with my phone to active project coordinate system. This is required to place the photo (taken with the phone camera) at the correct project location.</p>  <p>The basic code came from this <a href="http://adndevblog.typepad.com/infrastructure/2012/09/how-to-apply-coordinate-system-transformation-using-api-.html">blog post</a>, but you may notice that this applies to Map 3D and do not work for Civil 3D. So below is the modified version. Note this requires some additional references not commonly used on Civil 3D development.</p>  <div style="font-family: ; background: white">   <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;summary&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> Convert the point from LL84 (GPS Coordinate System) into </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> Civil 3D active document coordinate system</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;/summary&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;remarks&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> Requires C:\Program Files\Autodesk\</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> AutoCAD Civil 3D 2013\OSGeo.MapGuide.Geometry.dll</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> Requires C:\Program Files\Autodesk\</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> AutoCAD Civil 3D 2013\OSGeo.MapGuide.Foundation.dll</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;/remarks&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 10pt">public</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font><span><font color="#0000ff">static</font></span><font color="#000000"> </font><span><font color="#2b91af">Point3d</font></span><font color="#000000"> ConvertPointCoordinate(</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">Point3d</font></span><font color="#000000"> point_LL84)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">MgCoordinate</font></span><font color="#000000"> coord = </font><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (CSTransform != </font><span><font color="#0000ff">null</font></span><font color="#000000"> &amp;&amp;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; !</font></font><font style="font-size: 10pt"><span><font color="#0000ff">double</font></span><font color="#000000">.IsNaN(point_LL84.Z))</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; coord = CSTransform.Transform(</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; point_LL84.X, point_LL84.Y, point_LL84.Z);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><span><font style="font-size: 10pt" color="#0000ff">else</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; coord = CSTransform.Transform(</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; point_LL84.X, point_LL84.Y);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">return</font></span><font color="#000000"> </font><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">Point3d</font></span><font color="#000000">(</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; coord.X, coord.Y, coord.Z);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">}</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 10pt">private</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font><span><font color="#0000ff">static</font></span><font color="#000000"> </font><span><font color="#2b91af">MgCoordinateSystemTransform</font></span><font color="#000000"> </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt"><font color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; _cstransform = </font><span><font color="#0000ff">null</font></span><font color="#000000">;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;summary&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><span><font style="font-size: 10pt" color="#008000"> Get the Coordinate System Transform.</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#808080"><font style="font-size: 10pt">///</font></font></span><font style="font-size: 10pt"><span><font color="#008000"> </font></span></font><span><font style="font-size: 10pt" color="#808080">&lt;/summary&gt;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span><font color="#0000ff"><font style="font-size: 10pt">private</font></font></span><font style="font-size: 10pt"><font color="#000000"> </font></font><span><font style="font-size: 10pt" color="#0000ff">static</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><span><font style="font-size: 10pt" color="#2b91af">MgCoordinateSystemTransform</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160; CSTransform</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">{</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160; </font></font><span><font style="font-size: 10pt" color="#0000ff">get</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160; {</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">if</font></span><font color="#000000"> (_cstransform != </font><span><font color="#0000ff">null</font></span><font color="#000000">)</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">return</font></span><font color="#000000"> _cstransform;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#008000">// get Civil3D current coordinate system</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">CivilDocument</font></span><font color="#000000"> civilDoc = </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">CivilApplication</font></span><font color="#000000">.ActiveDocument;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">string</font></span><font color="#000000"> code = civilDoc.Settings.</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; DrawingSettings.UnitZoneSettings.</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; CoordinateSystemCode;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#008000">// get the transformation </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">MgCoordinateSystemFactory</font></span><font color="#000000"> coordSysFactory </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; = </font></font><font style="font-size: 10pt"><span><font color="#0000ff">new</font></span><font color="#000000"> </font><span><font color="#2b91af">MgCoordinateSystemFactory</font></span><font color="#000000">();</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">MgCoordinateSystem</font></span><font color="#000000"> coordSys = </font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; coordSysFactory.CreateFromCode(code);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#2b91af">MgCoordinateSystem</font></span><font color="#000000"> wgs84Sys =</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160;&#160;&#160; coordSysFactory.Create(</font></font><font style="font-size: 10pt"><span><font color="#a31515">&quot;LL84&quot;</font></span><font color="#000000">);</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><span><font style="font-size: 10pt" color="#008000">// convert the coordinates</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160; _cstransform = coordSysFactory.</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;&#160;&#160;&#160;&#160; GetTransform(wgs84Sys, coordSys);</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font color="#000000"><font style="font-size: 10pt">&#160;&#160;&#160; </font></font><font style="font-size: 10pt"><span><font color="#0000ff">return</font></span><font color="#000000"> _cstransform;</font></font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">&#160; }</font></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 10pt" color="#000000">}</font></font></p> </div>  <p>See you in Las Vegas!</p>
