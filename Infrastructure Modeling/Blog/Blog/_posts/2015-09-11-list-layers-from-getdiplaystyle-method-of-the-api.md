---
layout: "post"
title: "List layers from GetDiplayStyle method of the API"
date: "2015-09-11 12:58:47"
author: "Augusto Goncalves"
categories:
  - ".NET"
  - "Augusto Goncalves"
  - "AutoCAD Civil 3D"
original_url: "https://adndevblog.typepad.com/infrastructure/2015/09/list-layers-from-getdiplaystyle-method-of-the-api.html "
typepad_basename: "list-layers-from-getdiplaystyle-method-of-the-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/augusto-goncalves.html">Augusto Goncalves</a> (<a href="https://twitter.com/augustomaia">@augustomaia</a>)</p>  <p>One of my favorites features of .NET is the ability to use Reflection. This is particularly powerful when we need to find something on the API that we’re not completely sure.</p>  <p>In this case we want to get all layers used on GetDisplay methods for some objects, let’s say AlignmentStyle. This specific case has GetDisplayStyleModel, GetDisplayStylePlan and GetDisplayStyleSection, but all options start with GetDisplay. Interesting!</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d15649f6970c-pi"><img title="Style Display on Civil 3D" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="Style Display on Civil 3D" src="/assets/image_cb8ab9.jpg" width="473" height="338" /></a> </p>  <p>So using Reflection let enumerate all methods that start with this prefix, then invoke them for all possible parameters. We assume the parameters are values from a enumeration, which can be found by Reflection.</p>  <p><strong>Updates (January, 2016): </strong><a href="http://forums.autodesk.com/t5/autocad-civil-3d-customization/displaystyle-layers/m-p/5965872">Jeff improved the code</a> to support some other types. See new version below.</p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black"><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt; GetDisplayStylesLayer(StyleBase style)<br />{<br />&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt; layers = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt;();<br />&#160; <span style="color: green">// get all methods that contains &quot;DisplayStyle&quot; on their names</span><br />&#160; <span style="color: blue">var</span> methods = style.GetType().GetMethods()<br />&#160;&#160;&#160; .Where(m =&gt; (m.Name.Contains(<span style="color: #a31515">&quot;DisplayStyle&quot;</span>)<br />    &amp;&amp; !m.Name.Contains(<span style="color: #a31515">&quot;_&quot;</span>)));<br />&#160; <span style="color: green">// run through the collection of methods</span><br />&#160; <span style="color: blue">foreach</span> (MethodInfo method <span style="color: blue">in</span> methods)<br />&#160; {<br />&#160;&#160;&#160; <span style="color: blue">var</span> methodparams = method.GetParameters();<br />&#160;&#160;&#160; <span style="color: blue">if</span> (methodparams.Length &gt; 1)<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">continue</span>; <span style="color: green">// if more than 1, then we don't know</span><br />&#160;&#160;&#160; <span style="color: blue">if</span> (methodparams.Length == 0)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; DisplayStyle dispStyle = method.Invoke(style, <br />            <span style="color: blue">new</span>&#160;<span style="color: blue">object</span>[] { }) <span style="color: blue">as</span> DisplayStyle;<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (dispStyle == <span style="color: blue">null</span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">continue</span>;<br />&#160;&#160;&#160;&#160;&#160; layers.Add(dispStyle.Layer);<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">continue</span>;<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160; ParameterInfo param = methodparams[0];<br />&#160;&#160;&#160; <span style="color: blue">if</span> (!param.ParameterType.IsEnum)<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">continue</span>; <span style="color: green">// not a enum, skip</span><br />&#160;&#160;&#160; <span style="color: green">// check all values on the enum</span><br />&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">var</span> enumValue <span style="color: blue">in</span>&#160;<span style="color: #2b91af">Enum</span>.GetValues(<br />&#160;&#160;&#160;&#160;&#160; param.ParameterType))<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">try</span><br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; DisplayStyle dispStyle = method.Invoke(style,<br />           <span style="color: blue">new</span>&#160;<span style="color: blue">object</span>[] { enumValue }) <span style="color: blue">as</span> DisplayStyle;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (dispStyle == <span style="color: blue">null</span> || enumValue.<br />          ToString().Contains(<span style="color: #a31515">&quot;Curvature&quot;</span>))<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">continue</span>;<span style="color: green">// something went wrong</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; layers.Add(dispStyle.Layer);<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160; <span style="color: blue">catch</span> { }</pre>

<pre style="font-size: 13px; font-family: consolas; background: white; color: black">&#160;&#160;&#160; }<br />&#160; }<br />&#160; <span style="color: blue">return</span> layers;<br />}</pre>

<p>To use it, simply call the Extension method, below is a quick example:</p>

<pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;getLayersFromDisplayStyle&quot;</span>)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">void</span> CmdGetLayers()<br />{<br />&#160; <span style="color: #2b91af">CivilDocument</span> civilDoc = <span style="color: #2b91af">CivilApplication</span>.ActiveDocument;<br />&#160; <span style="color: blue">using</span> (<span style="color: #2b91af">Transaction</span> trans = <span style="color: #2b91af">Application</span>.DocumentManager<br />&#160;&#160;&#160; .MdiActiveDocument.Database.TransactionManager<br />    .StartTransaction())<br />&#160; {<br />&#160;&#160;&#160; <span style="color: #2b91af">StyleBase</span> st = trans.GetObject(<br />&#160;&#160;&#160;&#160;&#160; civilDoc.Styles.AlignmentStyles[0], <br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OpenMode</span>.ForRead) <span style="color: blue">as</span>&#160;<span style="color: #2b91af">StyleBase</span>;<br />&#160;&#160;&#160; <span style="color: #2b91af">List</span>&lt;<span style="color: blue">string</span>&gt; res = st.GetDisplayStyleLayer();<br />&#160;&#160;&#160; <span style="color: blue">foreach</span> (<span style="color: blue">string</span> s <span style="color: blue">in</span> res)<br />&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Application</span>.DocumentManager.MdiActiveDocument<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; .Editor.WriteMessage(<span style="color: #a31515">&quot;\n{0}&quot;</span>, s);<br />&#160; }<br />}</pre>
