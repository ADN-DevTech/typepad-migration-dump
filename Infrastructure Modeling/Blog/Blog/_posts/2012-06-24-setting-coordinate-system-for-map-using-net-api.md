---
layout: "post"
title: "Setting coordinate system for map using .net API"
date: "2012-06-24 20:51:47"
author: "Daniel Du"
categories:
  - "AutoCAD Map 3D 2011"
  - "AutoCAD Map 3D 2012"
  - "AutoCAD Map 3D 2013"
  - "Daniel Du"
original_url: "https://adndevblog.typepad.com/infrastructure/2012/06/setting-coordinate-system-for-map-using-net-api.html "
typepad_basename: "setting-coordinate-system-for-map-using-net-api"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/daniel-du.html">Daniel Du</a></p>  <p>You probably have already known that we can get the current coordinate system of map with following code snippet: </p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">CommandMethod</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;GetMapCoordinateSystem&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)]</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">void</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> GetMapCoordinateSystem()</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">AcMapMap</font></span><span style="line-height: 11pt"><font color="#000000"> currentMap = </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">AcMapMap</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.GetCurrentMap();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> srs = currentMap.GetMapSRS();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">Editor</font></span><span style="line-height: 11pt"><font color="#000000"> ed = Autodesk.AutoCAD.ApplicationServices.</font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">Application</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .DocumentManager.MdiActiveDocument.Editor;</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;current coordinate system is : &quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> + srs);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></span></p> </div>  <p>And I have been asked many times, how to set a coordinate system to a map? Here is the solution: </p>  <div style="font-family: ; background: white; color: ">   <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; [</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">CommandMethod</font></span><span style="line-height: 11pt"><font color="#000000">(</font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;SetMapCoordinateSystem&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">)]</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">void</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> SetMapCoordinateSystem()</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#008000">//the parameter is coordinate system code</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; SetMapSRS(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;CA-I&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span><span style="line-height: 11pt"><font color="#000000"> wkt = </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">AcMapMap</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.GetCurrentMap().GetMapSRS();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">Editor</font></span><span style="line-height: 11pt"><font color="#000000"> ed = Autodesk.AutoCAD.ApplicationServices.</font></span></font><span style="line-height: 11pt; color: "><font style="font-size: 8pt" color="#2b91af">Application</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .DocumentManager.MdiActiveDocument.Editor;</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MgCoordinateSystemFactory</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> coordSysFac = </font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">new</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#2b91af">MgCoordinateSystemFactory</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">();</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> code = coordSysFac.ConvertWktToCoordinateSystemCode(wkt);</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#a31515">&quot;\n MapSRS is Changed to: &quot;</font></span><span style="line-height: 11pt"><font color="#000000"> + code + </font></span><span style="line-height: 11pt; color: "><font color="#a31515">&quot;\n&quot;</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">);</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160; </font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#0000ff">public</font></span><span style="line-height: 11pt"><font color="#000000"> </font></span><span style="line-height: 11pt; color: "><font color="#0000ff">void</font></span><span style="line-height: 11pt"><font color="#000000"> SetMapSRS(</font></span><span style="line-height: 11pt; color: "><font color="#0000ff">string</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> srsCode)</font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; {</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; Autodesk.Gis.Map.</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">MapApplication</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> mapApp = Autodesk.Gis.Map</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; .</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">HostMapApplicationServices</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000">.Application;</font></span></font></p>    <p style="margin: 0px"><font face="Courier New"><span style="line-height: 11pt"><font color="#000000"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; Autodesk.Gis.Map.Project.</font></font></span><font style="font-size: 8pt"><span style="line-height: 11pt; color: "><font color="#2b91af">ProjectModel</font></span></font><span style="line-height: 11pt"><font style="font-size: 8pt" color="#000000"> projModel </font></span></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; = mapApp.ActiveProject;</font></font></span></p>    <p style="margin: 0px"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;</font></font></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160;&#160;&#160; projModel.Projection = srsCode;</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font face="Courier New"><font style="font-size: 8pt" color="#000000">&#160;&#160;&#160; }</font></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000" face="Courier New"></font></span></p>    <p style="margin: 0px"><span style="line-height: 11pt"><font color="#000000">Hope this helps.</font></span></p> </div>
