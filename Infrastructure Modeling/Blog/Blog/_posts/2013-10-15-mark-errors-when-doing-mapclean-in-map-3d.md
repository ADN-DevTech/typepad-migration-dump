---
layout: "post"
title: "Mark errors when doing mapclean in Map 3D"
date: "2013-10-15 21:13:18"
author: "Daniel Du"
categories:
  - "AutoCAD Map 3D 2011"
  - "AutoCAD Map 3D 2012"
  - "AutoCAD Map 3D 2013"
  - "Daniel Du"
original_url: "https://adndevblog.typepad.com/infrastructure/2013/10/mark-errors-when-doing-mapclean-in-map-3d.html "
typepad_basename: "mark-errors-when-doing-mapclean-in-map-3d"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/infrastructure/daniel-du.html">Daniel Du</a></p>  <p>In Map 3D map clean tool, it marks the errors it finds.Here is an example to demonstrate how to use do it with API: </p>  <p>[CommandMethod(&quot;clean&quot;)]    <br />public void DrawingCleanUp()     <br />{     <br />&#160;&#160;&#160; string sGroupKeyword = &quot;GROUP&quot;;     <br />&#160;&#160;&#160; string sErrorKeyword = &quot;ERROR&quot;;     <br />&#160;&#160;&#160; string sYes = &quot;YES&quot;;     <br />&#160;&#160;&#160; string sNo = &quot;NO&quot;;</p>  <p>&#160;&#160;&#160; int iGrpErrCnt = 0;    <br />&#160;&#160;&#160; Editor ed = Application.DocumentManager.MdiActiveDocument.Editor;</p>  <p>&#160;&#160;&#160; Autodesk.Gis.Map.Topology.Variable cadAction =    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; new Autodesk.Gis.Map.Topology.Variable();     <br />&#160;&#160;&#160; cadAction.LoadProfile(@&quot;C:\MapCleanDemo\myClean.dpf&quot;);</p>  <p>   <br />&#160;&#160;&#160; PromptKeywordOptions pkoCleanupType =     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; new PromptKeywordOptions(&quot;Cleanup Type:&quot;);     <br />&#160;&#160;&#160; pkoCleanupType.Keywords.Add(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; sGroupKeyword, sGroupKeyword, sGroupKeyword, true, true);     <br />&#160;&#160;&#160; pkoCleanupType.Keywords.Add(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; sErrorKeyword, sErrorKeyword, sErrorKeyword, true, true);     <br />&#160;&#160;&#160; pkoCleanupType.AllowNone = true;</p>  <p>&#160;&#160;&#160; PromptKeywordOptions pkoFixError = new PromptKeywordOptions(&quot;Fix?&quot;);    <br />&#160;&#160;&#160; pkoFixError.Keywords.Add(sYes, sYes, sYes, true, true);     <br />&#160;&#160;&#160; pkoFixError.Keywords.Add(sNo, sNo, sNo, true, true);     <br />&#160;&#160;&#160; pkoFixError.AllowNone = true;</p>  <p>   <br />&#160;&#160;&#160; PromptResult pres = ed.GetKeywords(pkoCleanupType);     <br />&#160;&#160;&#160; if (pres.Status != PromptStatus.Cancel)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; using (Autodesk.Gis.Map.Topology.TopologyClean cadCleanobj     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = new Autodesk.Gis.Map.Topology.TopologyClean())     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.Init(cadAction, null);</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.Start();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupNext();     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (pres.StringResult.ToUpper().Equals(sErrorKeyword))     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; while (!cadCleanobj.Completed)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; iGrpErrCnt = cadCleanobj.GroupErrorCount;</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\nGroup Error Count: &quot; + iGrpErrCnt);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\n* Iterating over Errors.&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; for (int i = 0; i &lt; iGrpErrCnt; i++)    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.ErrorCur(i);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\n* Current Error (X: &quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; + Math.Round(cadCleanobj.ErrorPoint.X, 2)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; + &quot; Y: &quot; + Math.Round(cadCleanobj.ErrorPoint.Y, 2) + &quot;)&quot;);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.ErrorDraw();</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (ed.GetKeywords(pkoFixError).StringResult.ToUpper().Equals(sYes))    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.ErrorFix();     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.ErrorMark();     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupNext();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else if (pres.StringResult.ToUpper().Equals(sGroupKeyword))     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\nGroup Cleanup&quot;);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\n* Iterating over Groups.&quot;);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; while (!cadCleanobj.Completed)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; iGrpErrCnt = cadCleanobj.GroupErrorCount;</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\nGroup Error Count: &quot; + iGrpErrCnt);</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupDraw();</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (ed.GetKeywords(pkoFixError).StringResult.ToUpper().Equals(sYes))    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupFix();     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupMark();</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.GroupNext();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ed.WriteMessage(&quot;\n&quot; + pres.StringResult + &quot; is not a valid option.&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cadCleanobj.End();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160; }     <br />} </p>
