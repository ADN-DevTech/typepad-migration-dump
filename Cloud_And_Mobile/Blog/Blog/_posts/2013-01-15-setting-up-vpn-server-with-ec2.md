---
layout: "post"
title: "Setting up VPN Server with EC2"
date: "2013-01-15 00:24:56"
author: "Daniel Du"
categories:
  - "Amazon Web Services"
  - "Cloud"
  - "Daniel Du"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2013/01/setting-up-vpn-server-with-ec2.html "
typepad_basename: "setting-up-vpn-server-with-ec2"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/cloud_and_mobile/daniel-du.html">Daniel Du</a></p>  <p>A few days back, I tried to set up a VPN server with AWS EC2 with PPTP service, I am writing down what I did in this post. PPTP means Point-to-Point Tunneling Protocol, which is a method for implementing virtual private network, please refer to <a href="http://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol">Wikipedia</a> for more information about PPTP. PPTP is commonly used, many clients including mobile devices like iPhone/iPad and Android devices support this to connect to VPN.</p>  <p>Firstly I log in to AWS console and switch EC2 service to start an instance,To make it simple, I use Linux micro instance, it is good enough to run such a service, and it is included in the AWS Free Usage Tier for new AWS user.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017ee76e73b2970d-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_f51814.jpg" width="454" height="277" /></a></p>  <p>It is pretty straight forward to launch a new instance following the wizard. If you have already used EC2 service before, you probably have already created a key pair and download the pem file. You can use the exiting one if you have one or create a new key pair. I will use my existing one:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017ee76e740a970d-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_ce847c.jpg" width="461" height="305" /></a></p>  <p>PPTP service uses TCP 1723 port by default, so please add this port to the security group:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c35cb1f39970b-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_f96ef3.jpg" width="457" height="298" /></a></p>  <p>If everything goes fine, you will create an Linux 32bit Micro instance and launch it, after a few minute, it will be running.</p>  <p>To make it convenient, I suggest to assign an elastic IP to this instance, but please note that when you stop this instance, do remember to release the elastic IP as well, otherwise you will be charged as punishment, because you are wasting limited IP address resources :)</p>  <p>Next step is to log in EC2 Linux instance and install PPTP service. To remote login Linux instance on EC2 from a windows machine, we can use a SSH client, like <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a>. PuTTY does not natively support the private key format generated by Amazon EC2. Fortunately, PuTTY has a tool called PuTTYgen, which can convert keys to the required PuTTY format. </p>  <p>Once we login to EC2 instance with your key pair(as ec2-user), we can start to install PPTP service. I am using a script from github, run the following commands one by one in SSH console:</p>  <p>sudo yum -y install rpm-build gcc make</p>  <p>sudo wget https://gist.github.com/raw/666241/e8f3030a9e7066b8deb0a3d9ec761360e2d94227/pptpd.sh   <br />sudo sh pptpd.sh</p>  <p>The PPTP service will be installed automatically and a default VPN user will be created. To add new VPN users, we can edit /etc/ppp/chap-secrets file with vim, the format is: </p>  <p>username&#160; pptpd mypassword * </p>  <p>The asterisk(*) means the VPN user can connect to this PPTP service from any IP address.</p>  <p>OK, that's it, quite simple, now I can connect to my VPN server on EC2 from my iPhone and check the updates of my friends on Facebook now. Of cause you may have other reason to use it. Enjoy!</p>
