---
layout: "post"
title: "Working seamlessly online/offline when developing your Web applications with the Forge Viewer "
date: "2016-10-21 01:33:22"
author: "Philippe Leefsma"
categories:
  - "Cloud"
  - "Database"
  - "HTML5"
  - "Javascript"
  - "MongoDB"
  - "Philippe Leefsma"
  - "Server"
  - "View and Data API"
  - "Viewer"
  - "Web Development"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2016/10/working-seamlessly-onlineoffline-when-developing-apps-with-the-forge-viewer-.html "
typepad_basename: "working-seamlessly-onlineoffline-when-developing-apps-with-the-forge-viewer-"
typepad_status: "Publish"
---

<p><span style="font-family: arial, helvetica, sans-serif;">By&#0160;<a href="http://adndevblog.typepad.com/cloud_and_mobile/philippe-leefsma.html" target="_blank">Philippe Leefsma</a> <a href="https://twitter.com/F3lipek" target="_blank">(@F3lipek)</a></span></p>
<p><img alt="" src="/assets/Viewer-v2.10-green.svg" /></p>
<p>&#0160;&#0160;&#0160;&#0160;Whether you are a frequent traveler or not, if you are developing a Web application using the Forge Viewer chances are that at some point you may be interested in doing offline viewing, that is loading your models not from the Autodesk Cloud but from the local machine. I can see various advantages of doing that: the first one obviously is being able to develop and work on your app with no internet connection at all, but even if you do have a connection, you may enjoy faster loading time of your model when you have to repeatedly reload the scene&#0160;to see your code modifications when working on a viewer plugin. Other customers may be interested in running a&#0160;viewer application in a closed environment&#0160;&#0160;or behind firewalls of their company with no http calls to the outside world. The offline approach applies to this type of requirement as well...</p>
<p>&#0160; &#0160; My application&#0160;is using the following technologies: NodeJS server, mongoDB database, RESTful API, React and ES6 for the building the frontend.&#0160;The&#0160;details I&#39;m exposing here relate to that&#0160;specific stack, however the concepts I am discussing&#0160;in that post should easily apply to any other backend/frontend stack combination you may use&#0160;on your side.</p>
<p>&#0160; &#0160; Here is the general idea of the workflow: you first need to upload and translate the models you want to view offline. Typically when you develop your application, one or a few different models can be used for testing purpose, so you won&#39;t have to store locally all the designs your app is working with. Once you have your local models, they can be served as static resources by your server. You use the database to store information about each model, including a specific field that indicates if the model is local or Cloud-based. The bootstrapping JavaScript code that initializes the viewer&#0160;will first look at the info in the database prior to load the model and either perform local or Cloud initialization. That way when using the local database in dev, models will be loaded from the local files and when your app is connected to the production database, models will be loaded from the Autodesk Cloud. All of that being transparent to the JavaScript code in your app.</p>
<p>&#0160; &#0160; Here are the detailed steps you&#0160;can&#0160;follow to get that set up:</p>
<p>&#0160;<strong>1/</strong> Upload your design to Autodesk Cloud and use the Model Derivatives API to generate the svf viewable format: see our <a href="https://developer.autodesk.com/en/docs/model-derivative/v2/tutorials/prepare-file-for-viewer/" target="_blank">Prepare a File for the Viewer</a>&#0160;step-by-step tutorial</p>
<p><strong>&#0160;2/</strong> Upon successful translation, download the design package locally. You can use the following npm package for that: <a href="https://github.com/Developer-Autodesk/view-and-data-npm" target="_blank">view-and-data-npm</a>. Even if it is still relying on the V1 API, it does the job. See the &quot;Offline&quot; section in the readme</p>
<p><strong>&#0160;3/</strong> Populate your mongoDB database with the correct records. In the case of my app, it is using a <strong><em>models</em></strong> collection with the following schema for each record:</p>
<pre style="line-height: 100%; font-family: monospace; background-color: #ffffff; padding: 4px; font-size: 10pt; border: 0.01mm solid #000000;"><span style="color: #800000; background-color: #f0f0f0;"> 1 </span><span style="background-color: #ffffff;">{
</span><span style="color: #800000; background-color: #f0f0f0;"> 2 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;_id&quot;</span><span style="background-color: #ffffff;"> : ObjectId(</span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;57efaf0377c8eb0a560ef467&quot;</span><span style="background-color: #ffffff;">),
</span><span style="color: #800000; background-color: #f0f0f0;"> 3 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;urn&quot;</span><span style="background-color: #ffffff;"> : </span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bGVlZnNtcC1mb3JnZS1kZXYvZW5naW5lLmR3Zg&quot;</span><span style="background-color: #ffffff;">,
</span><span style="color: #800000; background-color: #f0f0f0;"> 4 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;name&quot;</span><span style="background-color: #ffffff;"> : </span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;Engine&quot;</span><span style="background-color: #ffffff;">,
</span><span style="color: #800000; background-color: #f0f0f0;"> 5 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;path&quot;</span><span style="background-color: #ffffff;"> : </span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;resources/models/engine/0.svf&quot;</span><span style="background-color: #ffffff;">,
</span><span style="color: #800000; background-color: #f0f0f0;"> 6 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;env&quot;</span><span style="background-color: #ffffff;"> : </span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;Local&quot;</span><span style="background-color: #ffffff;">,
</span><span style="color: #800000; background-color: #f0f0f0;"> 7 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;options&quot;</span><span style="background-color: #ffffff;"> : {
</span><span style="color: #800000; background-color: #f0f0f0;"> 8 </span>        <span style="color: #808080; background-color: #ffffff; font-style: italic;">//some app specific options
</span><span style="color: #800000; background-color: #f0f0f0;"> 9 </span><span style="background-color: #ffffff;">      },
</span><span style="color: #800000; background-color: #f0f0f0;">10 </span>      <span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;thumbnail&quot;</span><span style="background-color: #ffffff;"> : </span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">&quot;... base64 encoded thumbnail of the model ... &quot;
</span><span style="color: #800000; background-color: #f0f0f0;">11 </span><span style="background-color: #ffffff;">    }</span></pre>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;The <strong><em>path</em></strong> field has to point to the location of the .svf file in the static resources route server by your server</p>
<p>&#0160; &#0160; the <strong><em>env</em></strong> field has to be set to <em><strong>Local</strong></em> for offline viewing and <em><strong>AutodeskProduction</strong></em> for Cloud-based viewing. That is the only field that is changed between my development &#0160;and production databases</p>
<p><strong>&#0160;4/</strong> You also need a complete local copy of the Viewer API files. There is more than the .css and .js you would reference in an online setup. The Viewer will dynamically fetch the extra scripts and resources needed once it gets loaded. It will look for those file relatively to the <em>viewer3D.js</em> or <em>viewer3D.min.js</em> that you loaded in your app, so if you keep the file hierarchy of the lib, things should be ok. You can find all the required files for the v 2.10 of the API <a href="https://github.com/Autodesk-Forge/forge-rcdb.nodejs/tree/master/resources/libs/viewer" target="_blank">in my project</a>.</p>
<p><strong>&#0160;5/</strong> The rest of the job will be handled by the JavaScript code initializing your viewer application based on the <em><strong>env</strong></em> field set in the DB when loading a specific model. You will pass that value to <strong><em>Autodesk.Viewing.Initializer</em></strong> and let the viewer lib do the initialization. Below is the code that I&#39;m using to seamlessly load a design offline or online. You can notice that in the offline case, we already know the viewable path that we want to load. In online case you need to first load all viewable path and select the one you want to load - in case your document has <a href="http://adndevblog.typepad.com/cloud_and_mobile/2015/09/how-to-export-multiple-3d-views-for-view-and-data-api.html" target="_blank">multiple&#0160;views</a>&#0160;- my code here is simply loading the first viewable path, but you can tweak that based on your needs:</p>
<script src="https://gist.github.com/leefsmp/0afdb89de1971187ad402bb2b37fbc2e.js"></script>
<p><strong>6/</strong> I am using an <a href="https://github.com/Autodesk-Forge/forge-rcdb.nodejs/blob/master/src/client/layouts/index.ejs" target="_blank">.ejs template</a> to generate my main html layout, this way when creating a dev build of my app, it will use the local viewer3D.js and when creating a prod build, it will reference the online version.&#0160;The template is being generated by the webpack build, you can see&#0160;my build config <a href="https://github.com/Autodesk-Forge/forge-rcdb.nodejs/tree/master/build" target="_blank">there</a>.</p>
<p>&#0160; &#0160; Having worked with the viewer API for a while&#0160;now, I came to use that setup by refining my experience with those tools and I find it pretty convenient so far.</p>
<p>&#0160;&#0160;&#0160;&#0160;The complete project applying all those concept is located at: <br /><a href="https://github.com/Autodesk-Forge/forge-rcdb.nodejs" target="_blank">https://github.com/Autodesk-Forge/forge-rcdb.nodejs</a></p>
