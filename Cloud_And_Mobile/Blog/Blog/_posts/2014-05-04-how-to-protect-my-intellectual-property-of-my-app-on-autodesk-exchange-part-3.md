---
layout: "post"
title: "How to protect my intellectual property of my App on Autodesk Exchange &ndash; part 3"
date: "2014-05-04 03:53:43"
author: "Daniel Du"
categories: []
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2014/05/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-3.html "
typepad_basename: "how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-3"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/cloud_and_mobile/daniel-du.html">Daniel Du</a></p>  <p>In <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/04/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-2.html">previous post</a>, I introduced how to check user’s entitlement from a web service with the <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html">new check entitlement API</a>, it can be applied to desktop based app as well. In this post, I will introduce how to do it in an AutoCAD based plug-in app. With the new check-entitlement API, we can check whether a user has entitlement to use this app, that means we can check whether he paid on Autodesk Exchange to download this app, rather than copy it from somewhere else. As we said in <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html">previous post</a>, This API needs two parameter, one is your AppId.&#160; You can get your AppId from your app index page on Exchange, and you may need to url-decode it with tools like <a href="http://meyerweb.com/eric/tools/dencoder/">this</a>. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a511b0325e970c-pi"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/assets/image_f32e09.jpg" width="387" height="124" /></a> </p>  <p>Another parameter is user’s internal Autodesk ID, for AutoCAD, you can use undocumented system variables – ONLINEUSERID, but in this blog post, I will introduce the standard way, get the user’s internal ID with OAuth. We have already posted some <a href="https://github.com/ADN-DevTech/AutodeskOAuthSamples">OAuth samples on github</a>, please go through these samples if you are not familiar with OAuth. </p>  <p>My sample App is an AutoCAD plug-in, user starts my app by typing “StartMyApp” command, of cause you can create a nice UI with ribbon, I am using the simplest way just for demonstration.</p>  <p></p>  <pre style="font-size: 13px; font-family: consolas; background: white; color: black">[<span style="color: #2b91af">CommandMethod</span>(<span style="color: #a31515">&quot;MyAppGroup&quot;</span>, <span style="color: #a31515">&quot;StartMyApp&quot;</span>, <span style="color: #a31515">&quot;StartMyApp&quot;</span>, <span style="color: #2b91af">CommandFlags</span>.Modal)]<br /><span style="color: blue">public</span>&#160;<span style="color: blue">void</span> MyCommand() <span style="color: green">// This method can have any name</span><br />{<br />&#160;&#160;&#160; Autodesk.AutoCAD.ApplicationServices.<span style="color: #2b91af">Application<br />             </span>.ShowModelessWindow(<span style="color: blue">new</span>&#160;<span style="color: #2b91af">myAppWin</span>());<br /> <br />}</pre>

<p>When my custom window start up, I ask user to login with his Autodesk ID to verify whether he has entitlement to use my app, if verification is passed, the “real” functional button is enabled, otherwise, I would suggest him to buy this app from Autodesk Exchange. </p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a3fd008660970b-pi"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/assets/image_33d192.jpg" width="373" height="378" /></a></p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a3fd008664970b-pi"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/assets/image_ca0414.jpg" width="381" height="323" /></a>&#160;</p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a73dbbdd7b970d-pi"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/assets/image_9a3c99.jpg" width="381" height="389" /></a> </p>

<p></p>

<p>OK, let’s write some code, here is the code snippet,please read the comments:</p>

<pre style="font-size: 13px; font-family: consolas; background: white; color: black">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Hard coded consumer and secret keys and base URL.</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// In real world Apps, these values need to secured.</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// One approach is to encrypt and/or obfuscate these values</span><br /><br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">const</span>&#160;<span style="color: blue">string</span> m_ConsumerKey = <span style="color: #a31515">&quot;your consumer key&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">const</span>&#160;<span style="color: blue">string</span> m_ConsumerSecret = <span style="color: #a31515">&quot;your consumer secret&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">const</span>&#160;<span style="color: blue">string</span> m_baseURL = <span style="color: #a31515"><a href="https://accounts.autodesk.com">https://accounts.autodesk.com</a></span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">const</span>&#160;<span style="color: blue">string</span> AUTODESK_EXCHANGE_URL = <span style="color: #a31515">&quot;https://apps.exchange.autodesk.com&quot;</span>;<br /> <br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">const</span>&#160;<span style="color: blue">string</span> CHECK_ENTITLEMENT_ENDPOINT <br />                   = <span style="color: #a31515">&quot;webservices/checkentitlement&quot;</span>;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: #2b91af">RestClient</span> m_Client;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_oAuthReqToken;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_oAuthReqTokenSecret;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_strPIN;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_oAuthAccessToken;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_oAuthAccessTokenSecret;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> m_sessionHandle;<br /> <br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> myAppWin()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; InitializeComponent();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">void</span> Button_Click(<span style="color: blue">object</span> sender, <span style="color: #2b91af">RoutedEventArgs</span> e)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> internalUserId = GetUserIdWithOAuth();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (internalUserId == <span style="color: blue">string</span>.Empty)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;You are not entitled to use this app.&quot;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; +<span style="color: #a31515">&quot;please buy it from Autodesk Exchange.&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//Since you probably do not know this AppId until you publish it, </span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//so let's save the AppId in config file so that it can be edit latter</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//without changing the source code</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">//read this appId from config file</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> thisAppId = <span style="color: #2b91af">ConfigReader</span>.ReadConfig(<span style="color: #a31515">&quot;thisAppId&quot;</span>);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span> hasEntitilement = CheckEntitlement(internalUserId, thisAppId);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (hasEntitilement)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;You are entitled to use this app. Thank you for purchasing!&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; btnDoMyWork.IsEnabled = <span style="color: blue">true</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;You are not entitled to use this app.&quot;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; +<span style="color: #a31515">&quot;please buy it from Autodesk Exchange.&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">string</span> GetUserIdWithOAuth()<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Instantiate the RestSharp library object RestClient. RestSharp is free and makes it</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// very easy to build apps that use the OAuth and OpenID protocols with a provider supporting</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// these protocols</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestClient</span>(m_baseURL);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client.Authenticator =<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">OAuth1Authenticator</span>.ForRequestToken(m_ConsumerKey, m_ConsumerSecret);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Build the HTTP request for a Request token and execute it against the OAuth provider</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> request = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestRequest</span>(<span style="color: #a31515">&quot;OAuth/RequestToken&quot;</span>, <span style="color: #2b91af">Method</span>.POST);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> response = m_Client.Execute(request);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (response.StatusCode != <span style="color: #2b91af">HttpStatusCode</span>.OK)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client = <span style="color: blue">null</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;couldn't request token from Autodesk oxygen provider&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">string</span>.Empty;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// The HTTP request succeeded. Get the request token and associated parameters.</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> qs = <span style="color: #2b91af">HttpUtility</span>.ParseQueryString(response.Content);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_oAuthReqToken = qs[<span style="color: #a31515">&quot;oauth_token&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_oAuthReqTokenSecret = qs[<span style="color: #a31515">&quot;oauth_token_secret&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> oauth_callback_confirmed = qs[<span style="color: #a31515">&quot;oauth_callback_confirmed&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> x_oauth_client_identifier = qs[<span style="color: #a31515">&quot;x_oauth_client_identifier&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> xoauth_problem = qs[<span style="color: #a31515">&quot;xoauth_problem&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> oauth_error_message = qs[<span style="color: #a31515">&quot;oauth_error_message&quot;</span>];<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// For in band authorization build URL for Authorization HTTP request</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RestRequest</span> authorizeRequest = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestRequest</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Resource = <span style="color: #a31515">&quot;OAuth/Authorize&quot;</span>,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; };<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; authorizeRequest.AddParameter(<span style="color: #a31515">&quot;viewmode&quot;</span>, <span style="color: #a31515">&quot;desktop&quot;</span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; authorizeRequest.AddParameter(<span style="color: #a31515">&quot;oauth_token&quot;</span>, m_oAuthReqToken);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Uri</span> authorizeUri = m_Client.BuildUri(authorizeRequest);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Launch another window with browser control and navigate to the Authorization URL</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">BrowserAuthenticate</span> frm = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">BrowserAuthenticate</span>();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; frm.Uri = authorizeUri;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (frm.ShowDialog() != <span style="color: blue">true</span>)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client = <span style="color: blue">null</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;In band Authorization failed&quot;</span>;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">string</span>.Empty;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Build the HTTP request for an access token</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; request = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestRequest</span>(<span style="color: #a31515">&quot;OAuth/AccessToken&quot;</span>, <span style="color: #2b91af">Method</span>.POST);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client.Authenticator = <span style="color: #2b91af">OAuth1Authenticator</span>.ForAccessToken(<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_ConsumerKey, m_ConsumerSecret, m_oAuthReqToken, m_oAuthReqTokenSecret<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; );<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// Execute the access token request</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; response = m_Client.Execute(request);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (response.StatusCode != <span style="color: #2b91af">HttpStatusCode</span>.OK)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_Client = <span style="color: blue">null</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; logOutput.Text = <span style="color: #a31515">&quot;couldn't get access token from your Autodesk account&quot;</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">string</span>.Empty;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// The request for access token is successful. Parse the response and store token,token secret and session handle</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; qs = <span style="color: #2b91af">HttpUtility</span>.ParseQueryString(response.Content);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_oAuthAccessToken = qs[<span style="color: #a31515">&quot;oauth_token&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; m_oAuthAccessTokenSecret = qs[<span style="color: #a31515">&quot;oauth_token_secret&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> x_oauth_user_name = qs[<span style="color: #a31515">&quot;x_oauth_user_name&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> x_oauth_user_guid = qs[<span style="color: #a31515">&quot;x_oauth_user_guid&quot;</span>];<br /> <br />&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> x_oauth_user_guid;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green">&#160;</span><span style="color: gray">&lt;summary&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green"> check whether a user has entitlement to use an app</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green">&#160;</span><span style="color: gray">&lt;/summary&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green">&#160;</span><span style="color: gray">&lt;param name=</span><span style="color: gray">&quot;internalUserId&quot;</span><span style="color: gray">&gt;&lt;/param&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green">&#160;</span><span style="color: gray">&lt;param name=</span><span style="color: gray">&quot;thisAppId&quot;</span><span style="color: gray">&gt;&lt;/param&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: gray">///</span><span style="color: green">&#160;</span><span style="color: gray">&lt;returns&gt;&lt;/returns&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span>&#160;<span style="color: blue">bool</span> CheckEntitlement(<span style="color: blue">string</span> internalUserId, <span style="color: blue">string</span> thisAppId)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RestClient</span> client = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestClient</span>(AUTODESK_EXCHANGE_URL);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RestRequest</span> req = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestRequest</span>(CHECK_ENTITLEMENT_ENDPOINT);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.Method = <span style="color: #2b91af">Method</span>.GET;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.AddParameter(<span style="color: #a31515">&quot;userid&quot;</span>, internalUserId);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; req.AddParameter(<span style="color: #a31515">&quot;appid&quot;</span>, thisAppId);<br /><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">ServicePointManager</span>.ServerCertificateValidationCallback <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; += (sender, certificate, chain, sslPolicyErrors) =&gt; <span style="color: blue">true</span>;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">IRestResponse</span>&lt;<span style="color: #2b91af">EntitlementResult</span>&gt; resp = client.Execute&lt;<span style="color: #2b91af">EntitlementResult</span>&gt;(req);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> (resp.Data != <span style="color: blue">null</span> &amp;&amp; resp.Data.IsValid)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">true</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">false</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /> <pre style="font-size: 13px; font-family: consolas; background: white; color: black">&#160;&#160;&#160; <span style="color: blue">class</span>&#160;<span style="color: #2b91af">EntitlementResult</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> UserId { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> AppId { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">bool</span> IsValid { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> Message { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br /> <br />&#160;&#160;&#160; }</pre><br /></pre>

<p>Pretty simple, right? Please find the complete source code on <a href="https://github.com/ADN-DevTech/ExchangeAppsCopyrightProtectionExample">github</a>, hope it helps. </p>
