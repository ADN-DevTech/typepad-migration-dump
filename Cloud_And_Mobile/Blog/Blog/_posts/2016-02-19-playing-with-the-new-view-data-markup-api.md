---
layout: "post"
title: "Playing with the new View & Data - Markup API"
date: "2016-02-19 02:55:45"
author: "Philippe Leefsma"
categories:
  - "Philippe Leefsma"
  - "View and Data API"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2016/02/playing-with-the-new-view-data-markup-api.html "
typepad_basename: "playing-with-the-new-view-data-markup-api"
typepad_status: "Publish"
---

<p>By&nbsp;<a href="http://adndevblog.typepad.com/cloud_and_mobile/philippe-leefsma.html">Philippe Leefsma</a> <a href="https://twitter.com/F3lipek">(@F3lipek)</a></p>
<p>The latest release of the viewer API is coming with a 2D markup feature that allows you to draw svg shapes on top of your 2d/3d&nbsp;models, potentially save the markup information you created and restore them at a later time.</p>
<p>There is a tutorial <a href="https://developer.api.autodesk.com/viewingservice/v1/viewers/docs/tutorial-feature_markup.html">here</a> that illustrates the basics of how to work with those markups. However I found it lacks a bit of information and some parts are not completely up-to-date yet, hence this post trying to bring a complement.</p>
<p>First of all the markups is an API-only feature, meaning there is no UI provided out of the box by the viewer to create and manipulate the markups, so you will have to create your own (alternatively get somebody to do it for you - manager saying). This might be a bit of work depending what kind of feature you want to expose to your users. I'm planning to have a custom panel that lets me test all - or most - of the features provided by the Markup API, so better spend a bit of time having a convenient&nbsp;UI.</p>
<p>What the doc doesn't say is that the markup extension isn't part of the <em>viewer3d.js</em>, so you have to include an extra script before attempting to use it:</p>
<p><a href="https://autodeskviewer.com/viewers/2.2/extensions/MarkupsCore.js" target="_blank">https://autodeskviewer.com/viewers/2.2/extensions/MarkupsCore.js</a>&nbsp;</p>
<p><a href="https://autodeskviewer.com/viewers/2.2/extensions/MarkupsCore.min.js" target="_blank">https://autodeskviewer.com/viewers/2.2/extensions/MarkupsCore.min.js</a>&nbsp;(minified version)</p>
<p>You then need to explicitly load the extension in the viewer as parameter when creating the viewer object with options or at a later stage:</p>
<pre style="line-height: 100%; font-family: monospace; background-color: #ffffff; padding: 4px; font-size: 11pt; border: 0.01mm solid #000000;"><span style="color: #800000; background-color: #f0f0f0;">1 </span><span style="background-color: #ffffff;">viewer.loadExtension(</span><span style="color: #008000; background-color: #ffffff; font-weight: bold;">"Autodesk.Viewing.MarkupsCore"</span><span style="background-color: #ffffff;">);
</span><span style="color: #800000; background-color: #f0f0f0;">2 
3 </span><span style="color: #000080; background-color: #ffffff; font-weight: bold;">var</span><span style="background-color: #ffffff;"> markupsExtension = viewer.getExtension(
</span><span style="color: #800000; background-color: #f0f0f0;">4 </span>  <span style="color: #008000; background-color: #ffffff; font-weight: bold;">"Autodesk.Viewing.MarkupsCore"</span><span style="background-color: #ffffff;">);<br></span></pre>
<p>You are now all set to start using the extension object by invoking its methods. See there for the complete <a href="https://developer.api.autodesk.com/viewingservice/v1/viewers/docs/Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.html">Markups Core API reference</a>.&nbsp;</p>
<p>How the API is working? Well you have two modes: Edit and View. In edit mode the user can draw markups onto the screen, your app can then ask the extension to save the current state of the markups as a string. In view mode your app&nbsp;can load previously created markups from the strings into named layers and then toggle ON&nbsp;or OFF&nbsp;those layers at will. Storage of that markup information is&nbsp;upon your responsibility. It is also important to mention&nbsp;that while in&nbsp;edit mode you cannot load previous markups and while in&nbsp;view mode you cannot create new markups, this is as-designed. Finally, while in view mode the extension maintains a stack of actions that allows to easily undo/redo the actions a user may perform: creating markup, moving, resizing, deleting, ...</p>
<p>For more details on how to perform those actions, you can refer to the <a href="https://developer.api.autodesk.com/viewingservice/v1/viewers/docs/tutorial-feature_markup.html" target="_blank">tutorial</a> mentioned above. One modification to take into account is that methods <strong><em>enterViewMode</em></strong> and <strong><em>leaveViewMode</em></strong> have been renamed respectively <strong><em>show</em></strong> and <em><strong>hide</strong></em>. You however still have methods <strong><em>enterEditMode</em></strong> and <em><strong>leaveEditMode</strong></em>.&nbsp;</p>
<p>At the time of this writing, I was not able to modify the svg style of the markups, so width, stroke style and colour stick to the default values. I'm working on it and will update the code when I can sort it out...</p>
<p>That's it, most what the API offers now it doable from my custom panel, it can save current markups to named layer and while in view mode you can toggle those layers visibility. It's a demo sample, so it does not persist the layers across sessions or if you unload the extension but from there it would be easily extensible to save that to a database.</p>
<p>Here is how it looks when loaded in the viewer and a link where you can test it <a href="http://viewer.autodesk.io/node/gallery/embed?id=5502100f75464da00d7c4cb0&amp;extIds=Autodesk.ADN.Viewing.Extension.Markup" target="_blank">live</a>. The next step will be to create my own custom kind of markup (custom EditMode, as mentioned by the tutorial). Stay tuned ...</p>


<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d1a1bcf7970c-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b01b8d1a1bcf7970c image-full img-responsive" alt="Screen Shot 2016-02-19 at 10.43.01" title="Screen Shot 2016-02-19 at 10.43.01" src="/assets/image_d958db.jpg" border="0" /></a><br />

Complete code with all source files is available from <a target="_blank" href="https://github.com/Developer-Autodesk/library-javascript-viewer-extensions/tree/master/Autodesk.ADN.Viewing.Extension.Markup">Autodesk.ADN.Viewing.Extension.Markup</a>

<br>
<br>

<script src="https://gist.github.com/leefsmp/aba0627a5a0892ee32f5.js"></script>


<fieldset class="zemanta-related"><legend class="zemanta-related-title">Related articles</legend><div style="margin: 0; padding: 0; overflow: hidden;" class="zemanta-article-ul zemanta-article-ul-image"><div style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size:11px; margin: 2px 10px 10px 2px;" class="zemanta-article-ul-li-image zemanta-article-ul-li"><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2015/05/building-self-contained-ui-components-for-the-viewer.html" style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="/assets/341792778_80_80.jpg"></a><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2015/05/building-self-contained-ui-components-for-the-viewer.html" style="display: block; overflow:hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;">Building self-contained UI components for the viewer</a></div><div style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size:11px; margin: 2px 10px 10px 2px;" class="zemanta-article-ul-li-image zemanta-article-ul-li"><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2015/01/what-is-this-view-data-api-thing-anyway.html" style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="/assets/320763761_80_80.jpg"></a><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2015/01/what-is-this-view-data-api-thing-anyway.html" style="display: block; overflow:hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;">What is this View &amp; Data API thing anyway?</a></div><div style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size:11px; margin: 2px 10px 10px 2px;" class="zemanta-article-ul-li-image zemanta-article-ul-li"><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2016/02/integrating-sphero-bb8-droid-with-view-data-api-part-ii.html" style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="/assets/noimg_38_80_80.jpg"></a><a target="_blank" href="http://adndevblog.typepad.com/cloud_and_mobile/2016/02/integrating-sphero-bb8-droid-with-view-data-api-part-ii.html" style="display: block; overflow:hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;">Integrating Sphero BB8 Droid with View &amp; Data API - Part II</a></div></div></fieldset>
