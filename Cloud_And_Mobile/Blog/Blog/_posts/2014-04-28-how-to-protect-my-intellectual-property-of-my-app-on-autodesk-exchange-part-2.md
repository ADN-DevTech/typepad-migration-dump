---
layout: "post"
title: "How to protect my intellectual property of my App on Autodesk Exchange &ndash; part 2"
date: "2014-04-28 21:07:40"
author: "Daniel Du"
categories:
  - "ASP .NET"
  - "Daniel Du"
  - "Server"
  - "Web Server"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2014/04/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-2.html "
typepad_basename: "how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-2"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/cloud_and_mobile/daniel-du.html">Daniel Du</a></p>  <p>In <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html">previous post</a>, I introduced a new API to enable publishers to check the entitlement with user’s userid and appId. For a web service, the easiest way is to ask users login your web service with Autodesk ID, you do not need to maintain your own user system. As described in previous post, you need to specify “Sign in with Autodesk account” when publishing your web service on Autodesk Exchange. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01a3fcde3eef970b-pi"><img title="image" border="0" alt="image" src="/assets/image_f2b608.jpg" width="479" height="73" /></a></p>  <p>Now let’s create an example web service, which enable users login with their Autodesk ID and check whether he has entitlement to use this web service. In this sample I will use ASP.NET MVC to create my web service. To enable user login with Autodesk ID, I need to use OAuth, please refer to <a href="https://github.com/ADN-DevTech/AutodeskOAuthSamples/tree/master/AdskOAuthAspnetMVC">this sample on github</a> for the details. If you have not read this sample, I would suggest you to stop here and download the sample and run it at your side first. </p>  <p>In this sample, let’s move on, when Authentication is successful, we can get the user’s userID, and then we can check his entitlement with APIs as we introduced in <a href="http://adndevblog.typepad.com/cloud_and_mobile/2014/03/how-to-protect-my-intellectual-property-of-my-app-on-autodesk-exchange-part-1.html">previous post</a>.</p>  <pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><span style="color: blue">public</span>&#160;<span style="color: #2b91af">ActionResult</span> AuthenticationSucceed(<span style="color: #2b91af">OAuthResult</span> result)<br />{<br />&#160;&#160;&#160; <span style="color: green">//ViewBag.userId = result.oauth_user_guid;</span><br />&#160;&#160;&#160; <span style="color: green">//return View(result);</span><br /> <br />&#160;&#160;&#160; <span style="color: blue">return</span> RedirectToAction(<span style="color: #a31515">&quot;CheckEntitlement&quot;</span>, <span style="color: #a31515">&quot;License&quot;</span>, result);<br /> <br />}</pre>

<p>Now let’s look at the CheckEntitiement action of License control:</p>

<p>&#160;</p>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><span style="color: blue">public</span>&#160;<span style="color: #2b91af">ActionResult</span> CheckEntitlement(<span style="color: #2b91af">OAuthResult</span> result)<br />{<br />&#160;&#160;&#160; <span style="color: green">//get the appId from web.config</span><br />&#160;&#160;&#160; <span style="color: blue">string</span> appId = <span style="color: #2b91af">ConfigurationManager</span>.AppSettings[<span style="color: #a31515">&quot;thisAppId&quot;</span>] == <span style="color: blue">null</span>&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ? <span style="color: #a31515">&quot;&quot;</span>&#160;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; : <span style="color: #2b91af">ConfigurationManager</span>.AppSettings[<span style="color: #a31515">&quot;thisAppId&quot;</span>];<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; <span style="color: blue">bool</span> entitled = IsEntitledUser(result.oauth_user_guid, appId);<br /> <br />&#160;&#160;&#160; <span style="color: blue">if</span> (entitled)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ViewBag.Message = <span style="color: #a31515">&quot;you are entitled to use this app.&quot;</span>;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">UserInfo</span> usrInfo = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">UserInfo</span>();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usrInfo.IsLoggedIn = <span style="color: blue">true</span>;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usrInfo.UserType = <span style="color: #2b91af">LoginType</span>.AutodeskId;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usrInfo.UserId = result.oauth_user_guid;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usrInfo.UserName = result.oauth_user_name;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> RedirectToAction(<span style="color: #a31515">&quot;index&quot;</span>, <span style="color: #a31515">&quot;Home&quot;</span>, usrInfo);<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160; <span style="color: blue">else</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ViewBag.Message = <span style="color: #a31515">&quot;you are not entitled to use this app. &quot;</span> +<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #a31515">&quot;please buy it from Autodesk Exchange store.&quot;</span>;<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: blue">return</span> View();<br />}<br /> <br /><span style="color: blue">private</span>&#160;<span style="color: blue">bool</span> IsEntitledUser(<span style="color: blue">string</span> userId, <span style="color: blue">string</span> appId)<br />{<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">RestClient</span> client = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestClient</span>(<span style="color: #2b91af">Constants</span>.AUTODESK_EXCHANGE_URL);<br />&#160;&#160;&#160; <span style="color: #2b91af">RestRequest</span> req = <span style="color: blue">new</span>&#160;<span style="color: #2b91af">RestRequest</span>(<span style="color: #2b91af">Constants</span>.CHECK_ENTITLEMENT_ENDPOINT);<br />&#160;&#160;&#160; req.Method = <span style="color: #2b91af">Method</span>.GET;<br />&#160;&#160;&#160; req.AddParameter(<span style="color: #a31515">&quot;userid&quot;</span>, userId);<br />&#160;&#160;&#160; req.AddParameter(<span style="color: #a31515">&quot;appid&quot;</span>, appId);<br /><br /> <br />&#160;&#160;&#160; <span style="color: #2b91af">IRestResponse</span>&lt;<span style="color: #2b91af">EntitlementResult</span>&gt; resp= client.Execute&lt;<span style="color: #2b91af">EntitlementResult</span>&gt;(req);<br /> <br />&#160;&#160;&#160; <span style="color: blue">if</span> (resp.Data != <span style="color: blue">null</span> &amp;&amp; resp.Data.IsValid)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">true</span>;<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160; <span style="color: blue">else</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>&#160;<span style="color: blue">false</span>;<br />&#160;&#160;&#160; }<br /> <br />}<br /></pre>

<p>&#160;</p>

<p>&#160;</p>

<pre>public const string AUTODESK_EXCHANGE_URL = &quot;https://apps.exchange.autodesk.com&quot;;<br />public const string CHECK_ENTITLEMENT_ENDPOINT = &quot;webservices/checkentitlement&quot;;</pre>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><font face="Verdana"></font>&#160;</pre>

<p>And here are some model classes you may need to run this code snippet in your project: </p>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><font face="Verdana"></font>&#160;</pre>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><span style="color: blue">namespace</span> DummyService.Models<br />{<br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">class</span>&#160;<span style="color: #2b91af">OAuthResult</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> AccessToken { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> AccessTokenSecret { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> oauth_user_name { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> oauth_user_guid { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> scope { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> oauth_problem { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> oauth_error_message { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> sessionHandle { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br /> <br />&#160;&#160;&#160; }<br /> <br /> <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">class</span>&#160;<span style="color: #2b91af">EntitlementResult</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> UserId { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> AppId { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">bool</span> IsValid { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> Message { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br /> <br />&#160;&#160;&#160; }<br /> <br /> <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">enum</span>&#160;<span style="color: #2b91af">LoginType</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; AutodeskId,<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; CustomerUserId<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">class</span>&#160;<span style="color: #2b91af">UserInfo</span><br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: #2b91af">LoginType</span> UserType { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> UserId { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">string</span> UserName { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">bool</span> IsLoggedIn { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }<br />&#160;&#160;&#160; }<br />}</pre>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black"><font face="Verdana"></font>&#160;</pre>

<p>With this code snippet, we can check user’s entitlement after he logged in with Autodesk account, you can check user’s entitlement periodically or even check for entitlement for every single web service call if you prefer a strict license protection. Hope it is helpful for you. All source code has been posted to <a href="https://github.com/ADN-DevTech/ExchangeAppsCopyrightProtectionExample">github</a>.</p>

<pre style="font-size: 13px; font-family: nsimsun; background: white; color: black">&#160;</pre>
