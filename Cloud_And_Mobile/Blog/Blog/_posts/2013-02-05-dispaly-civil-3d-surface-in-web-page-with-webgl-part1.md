---
layout: "post"
title: "Display Civil 3D Surface in Web Page with WebGL - part1"
date: "2013-02-05 22:32:57"
author: "Daniel Du"
categories:
  - "Daniel Du"
  - "Javascript"
  - "WebGL"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2013/02/dispaly-civil-3d-surface-in-web-page-with-webgl-part1.html "
typepad_basename: "dispaly-civil-3d-surface-in-web-page-with-webgl-part1"
typepad_status: "Publish"
---

<p><span style="text-align: left; widows: 2; text-transform: none; background-color: #ffffff; text-indent: 0px; letter-spacing: normal; display: inline !important; font: small/19px arial, sans-serif; white-space: normal; orphans: 2; float: none; color: #232323; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">By</span> <a style="text-align: left; widows: 2; text-transform: none; background-color: #ffffff; text-indent: 0px; letter-spacing: normal; font: small/19px arial, sans-serif; white-space: normal; orphans: 2; color: #118888; word-spacing: 0px; text-decoration: underline; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" href="http://adndevblog.typepad.com/cloud_and_mobile/daniel-du.html">Daniel Du</a></p>  <p>I am documenting my learning process of webGL here, so you may find similar code snippet somewhere else. My purpose is to display Civil 3D surface in web page without any plug-ins. WebGL is a good way to do this. Many libraries make life easier for WebGL programming, <a href="http://mrdoob.github.com/three.js">Three.JS</a> is one of them.</p>  <p>Firstly we need to choose a &quot;right&quot; browser, as not all browsers support WebGL right now. My colleague Partha published a test webGL in <a href="http://adndevblog.typepad.com/cloud_and_mobile/2013/01/playing-with-webgl.html">this post</a>, if you cannot see it, your browser may do not support WebGL. If you are using IE, you may need to try <a href="http://www.mozilla.org/en-US/products/download.html">Firefox</a> or <a href="http://www.google.com/chrome/">Chrome</a>. If you are using latest version of FireFox or Chrome, please check following to enable WebGL for browser :</p>  <p>For FireFox:</p>  <ol>   <li>Input &quot;about:config&quot; in adress </li>    <li>Search &quot;WebGL&quot; in filter </li>    <li>Set &quot;webgl.force-enabled&quot; to true; </li>    <li>Set &quot;webgl.disabled&quot; to false; </li>    <li>Search “security.fileuri.strict_origin_policy” in filter </li>    <li>Set &quot;security.fileuri.strict_origin_policy&quot; to false </li>    <li>Close all Tab and restart firefox. </li> </ol>  <p>For Chrome, I created a new shortcut as below :</p>  <blockquote>   <p>&quot;ChromePath\chrome.exe&quot; --enable-webgl --ignore-gpu-blacklist --allow-file-access-from-files </p> </blockquote>  <p>For Civil 3D TinSurface, it is composed of many triangular facet, so in this post, I will firstly to create a simple prototype to verify the feasibility. I will try to create some simple triangles with WebGL. First step is to create a web page, it can be a simplest HTML or an ASPX for asp.net. You can use your favorite notepad editor, I am using Visual Studio here, it is pretty good to me with some code intelligence. I go ahead to create an ASP.NET website, and add Three.JS to the project. This file can be found from <a href="https://github.com/mrdoob/three.js/">Three.JS</a> website, if you downloaded the source code from <a href="https://github.com/mrdoob/three.js/">Github</a>, this file can be found in \build folder. Then I added a DIV tag and script reference to in web page.</p>  <pre style="font-family: consolas; background: white; color: black; font-size: 13px"><span style="background: yellow">&lt;%</span><span style="color: blue">@</span>&#160;<span style="color: maroon">Page</span>&#160;<span style="color: red">Title</span><span style="color: blue">=</span><span style="color: blue">&quot;Home Page&quot;</span>&#160;<span style="color: red">Language</span><span style="color: blue">=</span><span style="color: blue">&quot;C#&quot;</span>&#160;<span style="color: red">MasterPageFile</span><span style="color: blue">=</span><span style="color: blue">&quot;~/Site.master&quot;</span>&#160;<span style="color: red">AutoEventWireup</span><span style="color: blue">=</span><span style="color: blue">&quot;true&quot;</span><br />&#160;&#160;&#160; <span style="color: red">CodeBehind</span><span style="color: blue">=</span><span style="color: blue">&quot;Default.aspx.cs&quot;</span>&#160;<span style="color: red">Inherits</span><span style="color: blue">=</span><span style="color: blue">&quot;WebGLStudy1._Default&quot;</span>&#160;<span style="background: yellow">%&gt;</span><br /> <br /><span style="color: blue">&lt;</span><span style="color: maroon">asp</span><span style="color: blue">:</span><span style="color: maroon">Content</span>&#160;<span style="color: red">ID</span><span style="color: blue">=</span><span style="color: blue">&quot;HeaderContent&quot;</span>&#160;<span style="color: red">runat</span><span style="color: blue">=</span><span style="color: blue">&quot;server&quot;</span>&#160;<span style="color: red">ContentPlaceHolderID</span><span style="color: blue">=</span><span style="color: blue">&quot;HeadContent&quot;</span><span style="color: blue">&gt;</span><br /><span style="color: blue">&lt;/</span><span style="color: maroon">asp</span><span style="color: blue">:</span><span style="color: maroon">Content</span><span style="color: blue">&gt;</span><br /><span style="color: blue">&lt;</span><span style="color: maroon">asp</span><span style="color: blue">:</span><span style="color: maroon">Content</span>&#160;<span style="color: red">ID</span><span style="color: blue">=</span><span style="color: blue">&quot;BodyContent&quot;</span>&#160;<span style="color: red">runat</span><span style="color: blue">=</span><span style="color: blue">&quot;server&quot;</span>&#160;<span style="color: red">ContentPlaceHolderID</span><span style="color: blue">=</span><span style="color: blue">&quot;MainContent&quot;</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span>&#160;<span style="color: red">src</span><span style="color: blue">=</span><span style="color: blue">&quot;Scripts/three.js&quot;</span>&#160;<span style="color: red">type</span><span style="color: blue">=</span><span style="color: blue">&quot;text/javascript&quot;</span><span style="color: blue">&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span>&#160;<span style="color: red">src</span><span style="color: blue">=</span><span style="color: blue">&quot;Scripts/three.min.js&quot;</span>&#160;<span style="color: red">type</span><span style="color: blue">=</span><span style="color: blue">&quot;text/javascript&quot;</span><span style="color: blue">&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span>&#160;<span style="color: red">src</span><span style="color: blue">=</span><span style="color: blue">&quot;Scripts/jquery-1.4.1.js&quot;</span>&#160;<span style="color: red">type</span><span style="color: blue">=</span><span style="color: blue">&quot;text/javascript&quot;</span><span style="color: blue">&gt;&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">h2</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Show Civil 3D Surface below:<br />&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">h2</span><span style="color: blue">&gt;</span><br /> <br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">div</span>&#160;<span style="color: red">id</span><span style="color: blue">=</span><span style="color: blue">&quot;container&quot;</span>&#160;<span style="color: red">style</span><span style="color: blue">=</span><span style="color: blue">&quot;</span><span style="color: red">border-style</span><span style="color: blue">: </span><span style="color: blue">none</span><span style="color: blue">; </span><span style="color: red">border-color</span><span style="color: blue">: </span><span style="color: blue">inherit</span><span style="color: blue">; </span><span style="color: red">border-width</span><span style="color: blue">: </span><span style="color: blue">medium</span><span style="color: blue">;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: red">height</span><span style="color: blue">: </span><span style="color: blue">500px</span><span style="color: blue">; </span><span style="color: red">background-color</span><span style="color: blue">: </span><span style="color: blue">#808000</span><span style="color: blue">;&quot;</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">div</span><span style="color: blue">&gt;</span><br />&#160;&#160;&#160; <span style="color: blue">&lt;</span><span style="color: maroon">script</span>&#160;<span style="color: red">type</span><span style="color: blue">=</span><span style="color: blue">&quot;text/javascript&quot;</span><span style="color: blue">&gt;</span><br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; window.onload = <span style="color: blue">function</span> () {<br />           // alert(“hello”);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</pre>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160; <span style="color: blue">&lt;/</span><span style="color: maroon">script</span><span style="color: blue">&gt;</span><br /><span style="color: blue">&lt;/</span><span style="color: maroon">asp</span><span style="color: blue">:</span><span style="color: maroon">Content</span><span style="color: blue">&gt;</span></pre>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;</pre>

<p>Basically, here are the steps to add a webGL with Three.JS in a web page, initialize a renderer, initialize a scene, add a camera, add some objects, then render the scene. First step, iniliazieer a renderer: </p>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> renderer;<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> initThree = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> container = document.getElementById(<span style="color: maroon">&quot;container&quot;</span>);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; width = container.clientWidth;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; height = container.clientHeight;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer = <span style="color: blue">new</span> THREE.WebGLRenderer({<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; antialias: <span style="color: blue">true</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; });<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer.setSize(width, height);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; container.appendChild(renderer.domElement);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer.setClearColorHex(0xFFFFFF, 1.0);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /></pre>

<p>Next is to add a carmera: </p>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> camera;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> initCamera = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera = <span style="color: blue">new</span> THREE.PerspectiveCamera(45, width / height, 1, 5000); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.position.x = 0; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.position.y = 50;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.position.z = 100;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.up.x = 0; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.up.y = 1; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.up.z = 0; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; camera.lookAt({ x: 0, y: 0, z: 0 }); <br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</pre>

<p>Now it is time to create a scene and add a light to it:</p>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: darkgreen">//set a scene</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> scene;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> initScene = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; scene = <span style="color: blue">new</span> THREE.Scene();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</pre>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px"><span style="color: darkgreen">       // set light</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> light;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> initLight = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; light = <span style="color: blue">new</span> THREE.DirectionalLight(0xff0000, 1.0, 0); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; light.position.set(200, 200, 200); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; scene.add(light); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</pre>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;</pre>

<p>Okay, next step is to add some objects to the scene, Thress.Js has many built-in objects, like sphere, cube, torus, etc., but for me, I would like to display Civil 3D TinSurface, which is composed of small triangles, I have to use the common geomtry to create the simplest triangle. <a href="http://jsfiddle.net/CoryG89/hyvng/10/">This link</a> helps me a lot. We need the coordinates of vertexes of the triangle, please note that the order should be counter clock-wise.</p>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px"><span style="color: blue">           var</span> geometry = <span style="color: blue">new</span> THREE.Geometry(200, 200, 200);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> v1 = <span style="color: blue">new</span> THREE.Vector3(100, 0, 0);&#160;&#160; <span style="color: darkgreen">// Vector3 used to specify position</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> v2 = <span style="color: blue">new</span> THREE.Vector3(-100, 0, 0);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> v3 = <span style="color: blue">new</span> THREE.Vector3(0, 100, 0);&#160;&#160; <span style="color: darkgreen">// 2d = all vertices in the same plane.. z = 0</span><br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: darkgreen">// Push vertices represented by position vectors</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; geometry.vertices.push(v1);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; geometry.vertices.push(v2);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; geometry.vertices.push(v3);<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: darkgreen">// Push face, defined with vertices in counter clock-wise order</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; geometry.faces.push(<span style="color: blue">new</span> THREE.Face3(0, 2, 1));<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: darkgreen">// Create a material and combine with geometry to create our mesh</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> redMat = <span style="color: blue">new</span> THREE.MeshLambertMaterial({ color: 0xff0000 });<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> triangle = <span style="color: blue">new</span> THREE.Mesh(geometry, redMat);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; scene.add(triangle);</pre>

<p>Finally render the scene and set it up in window.onload(). </p>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> render = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer.render(scene, camera);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: darkgreen">//execute</span><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> threeStart = <span style="color: blue">function</span> () {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; initThree();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; initCamera();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; initScene();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; initLight();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; initObject();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer.clear();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; renderer.render(scene, camera);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /></pre>

<pre style="font-family: consolas; background: white; color: black; font-size: 13px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; window.onload = <span style="color: blue">function</span> () {<br /> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; threeStart();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</pre>

<p>With that, I can draw a simplese triangle on web page, so next step is to add more triangles into the scene to combine the TinSurface. I will continue in next post. </p>

<p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017c36a17b43970b-pi"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_328ac7.jpg" width="480" height="285" /></a></p>

<p>(screen-shot)</p>
