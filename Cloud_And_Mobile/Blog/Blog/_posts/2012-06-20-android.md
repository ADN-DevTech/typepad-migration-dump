---
layout: "post"
title: "Fast debugging of Android applications"
date: "2012-06-20 14:55:45"
author: "Philippe Leefsma"
categories:
  - "Android"
  - "Mobile"
  - "Philippe Leefsma"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2012/06/android.html "
typepad_basename: "android"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/cloud_and_mobile/philippe-leefsma.html" target="_self">Philippe Leefsma</a></p>  <p>Before starting posting about Android applications development, I though it would be useful to take a tour about the debugging possibilities that we currently have access to.</p>  <p>If you’ve ever given a try at Android development through Eclipse Platform, you probably noticed that when debugging using a virtual device, the Android emulator is unbearably slow. This is due to the fact that it simulates a real ARM processor, which can have pros and cons.</p>  <p>So what are the options in order to speed your debugging process up? I investigated various possibilities that I’m going to present below:</p>  <p><em><strong>#1 - Using emulator snapshots</strong></em></p>  <p>The Android emulator now has the ability to save and restore its state to a snapshot file in each AVD (Android Virtual device). Once a snapshot has been saved, no booting is required, so loading will be faster (about few seconds). </p>  <p>You can find more info on that feature <a href="http://tools.android.com/recent/emulatorsnapshots" target="_self">here</a>.</p>  <p><em><strong>#2 - Connecting a physical device to your development machine through USB cable</strong></em></p>  <p>That’s a rather straightforward option although it may have potential inconvenient: first you obviously need to own or have access to an Android device, which is most likely going to be the case if you do some serious development on that platform but not necessarily if you just want to give a shot at Android programming. Second, and more annoying, is that for Windows programmers, it is required to install a device specific driver on your machine in order to have it recognized. It might be an issue searching and finding that driver. For Mac users, no driver required. Plug the device to the machine through USB and it should just appear as selectable choice when you run your app in debug mode through Eclipse, as simple as that!</p>  <p>In both cases you will most likely need to enable debugging in your device settings: Settings –&gt; Development –&gt; Enable Android debug mode (their should be some kind of checkbox there…).</p>  <p><strong><em>#3 - Remote TCP/IP debugging over network</em></strong></p>  <p>That’s a cool feature that allows you to connect your device through TCP/IP and remotely debug into it. The drawback is that you need to have rooted access to the device in order to allow that feature. </p>  <p>Same as previously, you should in first place allow this from your device settings: Settings –&gt; Development –&gt; ADB over network</p>  <p>You would then need to install a small helper app on the device, such as “AdbWireless” that will automatically set up the device for you. Note that it can also be achieved manually through commands typed in a terminal emulator. </p>  <p>Start AdbWireless or equivalent app on the device, you obviously need to be connected to a network, then it should let you know the ip address your device is running on.</p>  <p>Based on that you will be able to use ADB (<a href="http://developer.android.com/guide/developing/tools/adb.html" target="_self">Android Debug Bridge</a>) a commandline utility provided with your Android SDK that is used to connect to a device and perform actions such as connecting to a device, installing/removing packages…</p>  <p>Fire a command prompt and type the following (replacing the path of Android SDK and the device ip with the actual ones you’ve got): </p>  <p><em>&lt;Android-sdk-path-on-your-machine&gt;/adb connect 10.145.214.31</em></p>  <p>You should get a message from ADB that the connection was successful and you can debug apps from Eclipse as we did in #2.</p>  <p>Note that depending on your proxy/firewall settings, it might not always be possible to remotely connect your device this way.</p>  <p><strong><em>#4 - Using a virtual Android machine</em></strong></p>  <p>This is probably, at least for me, the most interesting approach, as it doesn’t involve using an actual device neither the slow emulator.</p>  <p>Since Android is an open source operating system, some developers kindly achieved a port of the OS to x86 based architectures. This allows to either install the Android OS on a virtual machine through the use of one of the numerous virtualization solution available these days or install it on a dedicated physical computer.</p>  <p>We will investigate the virtual machine solution here, as it allows to run both Eclipse and the Android system from the same development machine.</p>  <p>Here are the steps I went through in order to get that approach working on my machine. By the way I am using a Mac OS-X platform with Parallels 7.0 as virtualization software, so those steps may differ slightly based on your own configuration.</p>  <p>1/ Download an ISO image of the Android OS. One of those can be found from one of the two projects achieving a 32-bit implementation of Android:</p>  <p><a href="http://www.android-x86.org/">http://www.android-x86.org/</a> </p>  <p><a href="http://code.google.com/p/live-android/">http://code.google.com/p/live-android/</a> </p>  <p>We need to have an Ethernet-enabled version of Android if we want to be able to connect to it our development machine. I’ve found one here:</p>  <p><a href="http://www.buildroid.org/Download/android-x86-vm-20120130.iso.gz">http://www.buildroid.org/Download/android-x86-vm-20120130.iso.gz</a></p>  <p>2/ Create a new virtual machine</p>  <p>2/ Browse to the path of your android-x86 iso image </p>  <p>3/ Parallels prompts me for the type of operating system it is going to be, I just choose “Linux Others”. At this point you are able to directly run Android as a virtual machine without installation! However I prefer to have it on my hard disk, so changes to the VM will be preserved through sessions. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01774292be6f970d-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.04.47 AM_thumb[1]" border="0" alt="Screen shot 2012-06-20 at 11.04.47 AM_thumb[1]" src="/assets/image_d582f6.jpg" width="488" height="367" /></a> </p>  <p>4/ So select the 4th choice, install to harddisk. It will prompt you to choose a partition on which to install the OS </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016767b79a17970b-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.05.28 AM_thumb[2]" border="0" alt="Screen shot 2012-06-20 at 11.05.28 AM_thumb[2]" src="/assets/image_9d7e58.jpg" width="491" height="306" /></a> </p>  <p>5/ Select Create/Modify partitions.It will take you to another menu where you should perform the following choices: </p>  <p>New -&gt; Primary –&gt; Bootable (set partition bootable) –&gt; Write </p>  <p>6/ Select the partition you just created, then select file system to format partition -&gt; choose “ext3” </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017615ad0a23970c-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.08.16 AM_thumb[2]" border="0" alt="Screen shot 2012-06-20 at 11.08.16 AM_thumb[2]" src="/assets/image_dd8d4a.jpg" width="486" height="287" /></a> </p>  <p>7/ Couple of other questions will be asked: </p>  <p>Do you want to install boot loader Grub -&gt; yes </p>  <p>Make System directory read/write -&gt; yes </p>  <p>Create a fake sdcard -&gt; yes -&gt; set sdcard size </p>  <p>Reboot </p>  <p>The whole process should take you a couple of minutes to achieve, it is really fast and the Android OS should run on your computer even faster than it does on a physical mobile device! </p>  <p>We are couple of steps away from debugging our app on the virtual machine now… </p>  <p>8/ Set the network adapter of the VM to shared (or whatever equivalent choice on your virtualization software). In case you do not have an Internet connection, you would need to use the “Host-Only” network adapter to be able to connect the virtual OS. Choosing “Shared Network” will allow your machine to connect to the VM and at the same time the VM to connect to the Internet, in case you plan to develop apps that are using web-services. </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016767b79a2a970b-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.13.34 AM_thumb[2]" border="0" alt="Screen shot 2012-06-20 at 11.13.34 AM_thumb[2]" src="/assets/image_40f08d.jpg" width="495" height="342" /></a></p>  <p>9/ From the Android machine, make sure the Ethernet is enabled and set to DHCP. Note that you may have to shut it down then up again in order to get it to work. Fire a brother just to make sure you are actually connected to the web.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01774292be81970d-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.12.41 AM_thumb[1]" border="0" alt="Screen shot 2012-06-20 at 11.12.41 AM_thumb[1]" src="/assets/image_c33434.jpg" width="501" height="379" /></a></p>  <p>10/ Spawn a terminal session using the terminal emulator already installed on the Android and fire command “netcfg” to retrieve the ip the VM is running on, in my case it is eth0 with value <em>10.211.55.26</em>:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01774292be88970d-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.24.04 AM_thumb[1]" border="0" alt="Screen shot 2012-06-20 at 11.24.04 AM_thumb[1]" src="/assets/image_cbf815.jpg" width="504" height="94" /></a></p>  <p>11/ On your development machine use ADB to remotely connect to it as we did in #3 for TCP/IP debugging. A message from ADB should confirm the connection is done:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017615ad0a4f970c-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.25.12 AM_thumb[1]" border="0" alt="Screen shot 2012-06-20 at 11.25.12 AM_thumb[1]" src="/assets/image_17e64d.jpg" width="506" height="92" /></a></p>  <p>12/ That’s it! Launch your app from Eclipse in debug mode, set breakpoints if you need to and select the VM from the list of devices (in my case I have the VM and a physical device connected to my machine):</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016767b79a56970b-pi"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.27.45 AM_thumb[2]" border="0" alt="Screen shot 2012-06-20 at 11.27.45 AM_thumb[2]" src="/assets/image_107434.jpg" width="507" height="373" /></a></p>  <p>Done! You will surely appreciate the speed of booting time and execution of your new Android virtual machine…</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01774292bea5970d-pi"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Screen shot 2012-06-20 at 11.28.20 AM_thumb[2]" border="0" alt="Screen shot 2012-06-20 at 11.28.20 AM_thumb[2]" src="/assets/image_b02b0e.jpg" width="506" height="169" /></a></p>  <p>Here are some points of comparison concerning this VM approach versus the AVD emulator:</p>  <p>Virtual Machine: </p>  <ul>   <li>Fast: X86 based ( same as iOS or WP7 emulator) </li>    <li>Only emulate User-mode </li>    <li>OS image easy to transfer, customizable to meet different needs. </li>    <li>Allow quick and convenient Snapshot </li> </ul>  <p>Google Android SDK AVD: </p>  <ul>   <li>Slow: ARM based </li>    <li>Full system emulation </li>    <li>Additional Dalvik VM, need to run bytecodes for Android Apps </li> </ul>
