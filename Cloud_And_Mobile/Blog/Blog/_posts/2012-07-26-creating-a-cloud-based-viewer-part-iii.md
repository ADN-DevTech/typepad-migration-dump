---
layout: "post"
title: "Creating a cloud based viewer &ndash; Part III"
date: "2012-07-26 07:10:45"
author: "Philippe Leefsma"
categories:
  - "Amazon Web Services"
  - "Cloud"
  - "Philippe Leefsma"
  - "Server"
original_url: "https://adndevblog.typepad.com/cloud_and_mobile/2012/07/creating-a-cloud-based-viewer-part-iii.html "
typepad_basename: "creating-a-cloud-based-viewer-part-iii"
typepad_status: "Publish"
---

<p>By <a href="http://adndevblog.typepad.com/cloud_and_mobile/philippe-leefsma.html">Philippe Leefsma</a></p>  <p>In the previous post <a href="http://adndevblog.typepad.com/cloud_and_mobile/2012/07/creating-a-cloud-based-viewer-part-ii.html">previous post</a> we completed our cloud based viewer by adding Amazon Web Services functionalities, so our data could be hosted and retrieved from the cloud, although our custom web service was still running locally. Today we are going to deploy that same web service on a cloud machine, so it will become a real cloud hosted service accessible from any desktop computer connected to the Internet.</p>  <p>For deploying our service on the cloud, we will continue our investigation of the services provided by the Amazon platform, focusing for that on EC2, the Elastic Cloud Computing service. You will be able to find a lot more information about this service, pricing and so on here: <a href="http://aws.amazon.com/ec2/">http://aws.amazon.com/ec2/</a></p>  <p>I’m going to present you how to create and configure a basic virtual machine instance running on EC2 and to deploy our viewer service on it. The whole process should take you about 15 to 20 minutes, including at least 10 minutes waiting for the virtual machine to be created, so that’s 5 minutes of effective work! Don’t mention that to your boss;)</p>  <p><strong>I – Creating an EC2 instance</strong></p>  <p>You first need to sign up for Amazon EC2 which is free, but the actual use of a cloud machine and the storage is not. Once you’ve signed up, go to EC2 and the first thing to determine is where your cloud machine will be based. Although it will be accessible from anywhere on the web, you might want to choose a geo location that makes sense depending on where your users are likely to be located in order to reduce latency time. Once the machine is launched from a specific region, it won’t be possible to move it across another geo, so you don’t want to mess this one up…</p>  <p>I select US East (Virginia) for my example:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017743a30d44970d-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image001" border="0" alt="clip_image001" src="/assets/image_9143f6.jpg" width="204" height="236" /></a></p>  <p>Then click the Launch Instance button:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7dc80970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image002" border="0" alt="clip_image002" src="/assets/image_89eef0.jpg" width="529" height="118" /></a></p>  <p>You will be proposed in preconfigured set of virtual machines running either Windows, Linux, Unix, … OS’s. </p>  <p>Our web service is implemented in WCF, so we need a Windows OS. I select the Windows Server 2008 with SQL Express and IIS already installed. The only thing you will need to install on that virtual machine once it’s up and running is the <a href="http://www.iis.net/download/WebDeploy">Web Deploy</a> for IIS like we did in the first post.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7dccd970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image003" border="0" alt="clip_image003" src="/assets/image_357094.jpg" width="522" height="323" /></a></p>  <p>You can keep going by accepting a couple of default options. Create a new key (alternatively use an existing one for subsequent machines you will create) that will be used to retrieve the generated password of the virtual machine.</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7dd2e970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image004" border="0" alt="clip_image004" src="/assets/image_4dcbd5.jpg" width="510" height="158" /></a></p>  <p>The next step is to create a Security Group that will define which ports will be open to the external web. Keep in mind that those settings will be completely independent of the firewall settings defined inside your virtual OS, so depending on which ports you want to have open, you will also need to configure the OS firewall separately.</p>  <p>I want my service to run on HTTP port 80 for a start, so I’m adding a predefined HTTP rule to allow <u>any IP</u> (that’s why my source equals 0.0.0.0/0) to connect through that port. It <u>won’t be possible</u> to affect a different security group once the instance is running, however you can modify an existing one at any time, just keep that in mind:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017616bcc0c8970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image005" border="0" alt="clip_image005" src="/assets/image_13f1b1.jpg" width="525" height="343" /></a></p>  <p>Let’s click continue when you are done configuring rules and you will land to the final dialog that recaps your new virtual machine settings. Click “Launch” and allow 10 to 15 minutes for the virtual machine to be ready:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7dd82970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image006" border="0" alt="clip_image006" src="/assets/image_255263.jpg" width="529" height="347" /></a></p>  <p>When the machine is ready to be connected, you should see something like the following (in that case we have other machines running, but just focus on <b><i>Leefsmp1</i></b>):</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7ddbb970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image007" border="0" alt="clip_image007" src="/assets/image_2c2bad.jpg" width="484" height="108" /></a></p>  <p>A final step will be to assign what they call an Elastic IP address to our machine, it is the IP that will be visible from the outside world wide web. So go to Elatic IPs in the left menu of the AWS management console and click “Allocate New Address”: </p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017743a30e94970d-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image008" border="0" alt="clip_image008" src="/assets/image_2ab952.jpg" width="484" height="76" /></a></p>  <p>You then need to associate the EIP to your instance:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017743a30eb5970d-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image009" border="0" alt="clip_image009" src="/assets/image_b43f60.jpg" width="488" height="214" /></a></p>  <p>And done! You now need to connect through Remote Desktop to your running instance, click “Connect” from the right-click menu option display from your instances list, you should be able to retrieve the default password using the key file you generated in previous step:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017616bcc21d970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image010" border="0" alt="clip_image010" src="/assets/image_e90baf.jpg" width="481" height="217" /></a></p>  <p>All the actions described above have been performed from the AWS management console, but I wanted to mention that Amazon also provides a nice little plug-in that integrates inside Visual Studio and that allows you to do pretty much the same (with some limitations though comparing with the online console).</p>  <p>At least once your machine is up and running, it is very convenient to use it to Remote Desktop into your instance, it can also remember your credentials:</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017616bcc26f970c-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image011" border="0" alt="clip_image011" src="/assets/image_77c528.jpg" width="521" height="396" /></a></p>  <p><strong><font color="#ffffff">-</font></strong></p>  <p><strong>II- Deploying our web service to the cloud instance</strong></p>  <p>This step will be 100% identical to the local machine deployment in IIS I detailed in the <a href="http://adndevblog.typepad.com/cloud_and_mobile/2012/07/creating-a-cloud-based-viewer-part-i.html">previous post</a>, so I won’t expand on that again. You can just copy the generated WCF service package compiled on your development machine to the remote instance and deploy it using IIS. </p>  <p>The only thing I needed to copy separately was the <em>AWSSDK.dll</em> and place it in the same folder than my WCF Service dll. If you know how to let Visual Studio automatically include that dependency in the package, feel free to let me know…</p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7de9a970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image013" border="0" alt="clip_image013" src="/assets/image_41d630.jpg" width="488" height="365" /></a></p>  <p>You will need to update your console and client app config files with the relevant IP of the cloud instance, here is how my endpoints declaration look like:</p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff"><font style="font-size: 8pt">&lt;</font></font></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#a31515">client</font></span></font><span style="font-family: ; color: "><font style="font-size: 8pt" color="#0000ff">&gt;</font></span></font><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">&lt;</font></font></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#a31515">endpoint</font></span></font><span style="font-family: ; color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></font><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">address</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span><span style="font-family: "><font color="#000000">&quot;</font></span><span style="font-family: ; color: ; mso-ansi-language: fr" lang="FR"><a href="http://23.23.212.64:80/AdnCloudViewer/AdnCloudViewerSrv.svc/mex"><font color="#0000ff">http://23.23.212.64:80/AdnCloudViewer/AdnCloudViewerSrv.svc/mex</font></a></span></font><span style="font-family: ; mso-ansi-language: fr" lang="FR"><font style="font-size: 8pt" color="#000000">&quot;</font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: ; mso-ansi-language: fr" lang="FR"><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">binding</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">wsHttpBinding</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">bindingConfiguration</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">MetadataExchangeHttpBinding_IAdnCloudViewerSrv</font></span><font color="#000000">&quot;</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">contract</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">AdnCloudViewerSrv.IAdnCloudViewerSrv</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">name</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">MetadataExchangeHttpBinding_IAdnCloudViewerSrv</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> /&gt;</font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff"><span style="mso-spacerun: yes"><font style="font-size: 8pt">&#160;&#160;&#160; </font></span><font style="font-size: 8pt">&lt;</font></font></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#a31515">endpoint</font></span></font><span style="font-family: ; color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></font><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">address</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><a href="http://23.23.212.64:80/AdnCloudViewer/AdnCloudViewerSrv.svc"><font color="#0000ff">http://23.23.212.64:80/AdnCloudViewer/AdnCloudViewerSrv.svc</font></a></span><font color="#000000">&quot;</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">binding</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">basicHttpBinding</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">bindingConfiguration</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">WCFClientEndpoint</font></span><font color="#000000">&quot;</font></font></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">contract</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">AdnCloudViewerSrv.IAdnCloudViewerSrv</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> </font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font color="#0000ff"><font style="font-size: 8pt">&#160;&#160;&#160;&#160;&#160; </font></font></span></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#ff0000">name</font></span><span style="font-family: ; color: "><font color="#0000ff">=</font></span></font><span style="font-family: "><font style="font-size: 8pt"><font color="#000000">&quot;</font><span style="color: "><font color="#0000ff">WCFClientEndpoint</font></span><font color="#000000">&quot;</font></font><span style="color: "><font style="font-size: 8pt" color="#0000ff"> /&gt;</font></span></span></font></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: "><span style="mso-spacerun: yes"><font face="Consolas"><font style="font-size: 8pt" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font></span></span><span style="font-family: "></span></p>  <p style="line-height: normal; margin: 0in 0in 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><font face="Consolas"><span style="font-family: ; color: "><font color="#0000ff"><font style="font-size: 8pt">&lt;/</font></font></span><font style="font-size: 8pt"><span style="font-family: ; color: "><font color="#a31515">client</font></span></font><span style="font-family: ; color: "><font style="font-size: 8pt" color="#0000ff">&gt;</font></span></font></p>  <p>Compile, run and boom! You can see there my client and console apps connected to my cloud service. The changes to the source are so minimalistic here that I won’t provide an attachment, you can just refer to the project I provided in <a href="http://adndevblog.typepad.com/cloud_and_mobile/2012/07/creating-a-cloud-based-viewer-part-ii.html">the previous post.</a></p>  <p><a href="http://adndevblog.typepad.com/.a/6a0167607c2431970b016768c7dec1970b-pi"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image015" border="0" alt="clip_image015" src="/assets/image_0d7adf.jpg" width="526" height="350" /></a></p>
