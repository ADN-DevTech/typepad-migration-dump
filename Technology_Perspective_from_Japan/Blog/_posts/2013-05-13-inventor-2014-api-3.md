---
layout: "post"
title: "Inventor 2014 API 新機能 その３"
date: "2013-05-13 02:30:00"
author: "Shigelazu Saitou"
categories:
  - "API カスタマイズ"
  - "デスクトップ製品"
original_url: "https://adndevblog.typepad.com/technology_perspective/2013/05/inventor-2014-api-%E6%96%B0%E6%A9%9F%E8%83%BD-%E3%81%9D%E3%81%AE%EF%BC%93.html "
typepad_basename: "inventor-2014-api-新機能-その３"
typepad_status: "Publish"
---

<p>「<a href="http://adndevblog.typepad.com/technology_perspective/2013/04/inventor-2014-api-%E6%96%B0%E6%A9%9F%E8%83%BD-%E6%9B%B4%E6%96%B0%E6%83%85%E5%A0%B1.html">Inventor 2014 API 新機能 その１</a>」「<a href="http://adndevblog.typepad.com/technology_perspective/2013/05/inventor-2014-api-%E6%96%B0%E6%A9%9F%E8%83%BD-%E3%81%9D%E3%81%AE%EF%BC%92.html">Inventor 2014 API 新機能 その２</a>」に続き、Inventor 2014の新しいAPIについてご紹介させていただきます。</p>

<p>Inventor 2014 製品では、材料（マテリアル）の設定の他に、新たにCivil3D製品などと同じ「外観」というコンセプトが導入されました。<br />
これにより、「スタイルおよび規格エディター」で設定されていた「レンダー」機能が取り除かれ、「外観」に置き換わります。<br />
今回は、この「外観」を中心にご案内させていただきます。<br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01901c0c129c970b-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b01901c0c129c970b image-full" alt="Fig1" title="Fig1" src="/assets/image_862475.jpg" border="0" /></a><br /></p>

<p><strong>１．	アセンブリファイル内の「オカレンス」を規定で用意されている「外観ライブラリ」よりドキュメント毎に設定できる「ローカルな外観コレクション」に追加し、オカレンスの外観表現をオーバーライドして変更する。</strong><br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017eeb098570970d-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b017eeb098570970d image-full" alt="Fig2" title="Fig2" src="/assets/image_520531.jpg" border="0" /></a><br /><br />
' アセンブリ内のオカレンスに対し Assetオブジェクトを使用し<br />
' 外観の表現を変更<br />
<strong>Public Sub SetOccurrenceAppearance()</strong><br />
    On Error Resume Next<br />
    Dim asmDoc As AssemblyDocument<br />
    Set asmDoc = ThisApplication.ActiveDocument<br />
    <br />
    If asmDoc Is Nothing Then<br />
      MsgBox "AssemblyJointサンプルを動作させるか" & vbCrLf _<br />
      & "アセンブリファイルを開いてください"<br />
      Exit Sub<br />
    End If<br />
    ' ドキュメントの外観を得る。<br />
    ' ローカルな外観が設定されていない場合は、ドキュメントの外観ライブラリより<br />
    ' 外観オブジェクトにCopyToメソッドを使ってセットする<br />
    <br />
    Dim localAsset As Asset<br />
    Set localAsset = asmDoc.AppearanceAssets.Item("ACADGen-082")<br />
    <br />
    On Error GoTo 0<br />
    <br />
    If localAsset Is Nothing Then<br />
      ' ライブラリ名でエラーの場合は、内部名が使用可能<br />
      Dim assetLib As AssetLibrary<br />
      Set assetLib = ThisApplication.AssetLibraries.Item("Autodesk Appearance Library")<br />
      'Set assetLib = ThisApplication.AssetLibraries.Item("314DE259-5443-4621-BFBD-1730C6CC9AE9")<br />
      <br />
      ' ライブラリ内より「ACADGen-082」のAssetを確保<br />
      Dim libAsset As Asset<br />
      Set libAsset = assetLib.AppearanceAssets.Item("ACADGen-082")<br />
      <br />
      ' ライブラリからドキュメントのAppearenceAssetsコレクションにＣｏｐｙする<br />
      Set localAsset = libAsset.CopyTo(asmDoc)<br />
    <br />
   End If<br />
    <br />
    On Error GoTo 0<br />
           <br />
    ' オカレンスの選択<br />
    Dim occ As ComponentOccurrence<br />
    Set occ = ThisApplication.CommandManager.Pick(kAssemblyOccurrenceFilter, "Select an occurrence.")<br />
    <br />
    ' オカレンスの外観を変更<br />
    occ.appearance = localAsset<br />
<strong>End Sub</strong></p>

<p><br />
<strong>２．	ドキュメントに「任意の外観オブジェクトを新たに作成」し、作成した任意の外観オブジェクトを用いて、フェースやオカレンスの外観表現をオーバーライド設定する。</strong><br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01901c0c16a9970b-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b01901c0c16a9970b image-full" alt="Fig3" title="Fig3" src="/assets/image_234721.jpg" border="0" /></a><br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017eeb0989b7970d-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b017eeb0989b7970d image-full" alt="Fig4" title="Fig4" src="/assets/image_835006.jpg" border="0" /></a><br /><br />
' カスタム外観オブジェクトの作成<br />
<strong>Public Sub CreateSimpleColorAppearance()</strong><br />
    On Error Resume Next<br />
    Dim doc As Document<br />
    Set doc = ThisApplication.ActiveDocument<br />
    <br />
    If doc Is Nothing Then<br />
      MsgBox "AssemblyJointサンプルを動作させるか" & vbCrLf _<br />
      & "パーツファイルを開いてください"<br />
      Exit Sub<br />
    End If<br />
    <br />
    ' ドキュメントの外観コレクションの確保<br />
    Dim docAssets As Assets<br />
    Set docAssets = doc.Assets<br />
    <br />
    '　カスタム外観オブジェクトの存在チェック<br />
    Dim appearance As Asset<br />
    For Each appearance In docAssets<br />
      If appearance.DisplayName = "My Shiny Red Color" Then<br />
        Exit For<br />
      End If<br />
    Next<br />
    On Error Resume Next<br />
    If appearance Is Nothing Then<br />
        On Error GoTo 0<br />
      ' 外観オブジェクト（Asset）の新規作成<br />
       Set appearance = docAssets.Add(kAssetTypeAppearance, "Generic", _<br />
                                      "MyShinyRed", "My Shiny Red Color")<br />
      Dim tobjs As TransientObjects<br />
      Set tobjs = ThisApplication.TransientObjects<br />
      '<br />
      Dim color As ColorAssetValue<br />
      Set color = appearance.Item("generic_diffuse")<br />
      color.value = tobjs.CreateColor(255, 15, 15)<br />
      <br />
      Dim floatValue As FloatAssetValue<br />
      Set floatValue = appearance.Item("generic_reflectivity_at_0deg")<br />
      floatValue.value = 0.5<br />
      <br />
      Set floatValue = appearance.Item("generic_reflectivity_at_90deg")<br />
      floatValue.value = 0.5<br />
    <br />
    End If<br />
    <br />
    On Error GoTo 0<br />
    ' 外観を変更するオブジェクトの選択<br />
    Dim occ As Object<br />
    If doc.DocumentType = kPartDocumentObject Then<br />
      Set occ = ThisApplication.CommandManager.Pick(kAllEntitiesFilter, "Select a Face.")<br />
    ElseIf doc.DocumentType = kAssemblyDocumentObject Then<br />
      Set occ = ThisApplication.CommandManager.Pick(kAssemblyOccurrenceFilter, "Select an occurrence.")<br />
    End If<br />
    ' オブジェクトの外観表現を変更<br />
    occ.appearance = appearance<br />
        <br />
<strong>End Sub</strong></p>

<p><br />
<strong>３．	アセンブリファイル内のオーバーライドされた外観表現をマテリアルで指定された状態に戻す</strong><br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b017eeb098e76970d-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b017eeb098e76970d" alt="Fig5" title="Fig5" src="/assets/image_619076.jpg" /></a><br /><br />
<strong>Public Sub RemoveAssemblyOverrides()</strong><br />
    ' アセンブリドキュメントを得る<br />
    Dim asmDoc As AssemblyDocument<br />
    Set asmDoc = ThisApplication.ActiveDocument</p>

<p>    ' イテレートしてオーバーライドされたComponentOccurrenceオブジェクトを確保<br />
    Dim obj As ComponentOccurrence<br />
    For Each obj In asmDoc.ComponentDefinition.AppearanceOverridesObjects<br />
        ' パーツのオリジナルの色に戻す<br />
        obj.AppearanceSourceType = kPartAppearance<br />
    Next<br />
<strong>End Sub</strong></p>

<p><br />
<strong>４．	パーツファイル内のオーバーライドされた外観表現を「フィーチャどおり」状態に戻す</strong>。<br />
<a class="asset-img-link"  style="display: inline;" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b019102021f4f970c-pi"><img class="asset  asset-image at-xid-6a0167607c2431970b019102021f4f970c" alt="Fig6" title="Fig6" src="/assets/image_424940.jpg" /></a><br /><br />
' パーツファイル内のオーバーライドされた外観表現を元に戻す<br />
<strong>Public Sub RemovePartOverrides()</strong><br />
    ' アクティブなパーツファイルの確保<br />
    Dim partDoc As PartDocument<br />
    Set partDoc = ThisApplication.ActiveDocument</p>

<p>    ' イテレートしてオーバーライドされたObjectを確保<br />
    Dim obj As Object<br />
    For Each obj In partDoc.ComponentDefinition.AppearanceOverridesObjects<br />
        'それぞれのオブジェクトタイプによって､オリジナルに戻す<br />
        ' サーフェスボディの場合<br />
        If TypeOf obj Is SurfaceBody Then<br />
            obj.AppearanceSourceType = kPartAppearance<br />
        ' パールツィーチャーの場合<br />
        ElseIf TypeOf obj Is PartFeature Then<br />
            obj.AppearanceSourceType = kBodyAppearance<br />
        ' フェースの場合<br />
        ElseIf TypeOf obj Is Face Then<br />
            obj.AppearanceSourceType = kFeatureAppearance<br />
        ' その他<br />
        Else<br />
            MsgBox "Unexpected type with appearance override: " & TypeName(obj)<br />
        End If<br />
    Next<br />
<strong>End Sub</strong></p>

<p><br />
サンプルは <span class="asset  asset-generic at-xid-6a0167607c2431970b0191020225a9970c"><a href="http://adndevblog.typepad.com/files/sample2.zip">ここ</a></span> よりダウンロードする事ができます。<br />
（解凍後、C:\TempホルダーにInventor2014_J_Ver2.ivbとSamplePart.ipt"を配置し、「ツール」->「アプリケーションオプション」の「ファイル」タブ内「既存のVBAプロジェクト」に「C:\Temp\Inventor2014_J_Ver2.ivb」と設定する事で動作確認ができます）</p>

<p>By Shigekazu Saito.<br />
</p>
