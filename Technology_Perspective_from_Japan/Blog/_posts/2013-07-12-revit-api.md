---
layout: "post"
title: "Revit ファミリAPI - その１"
date: "2013-07-12 11:00:00"
author: "Mikako Harada"
categories:
  - "API カスタマイズ"
  - "デスクトップ製品"
original_url: "https://adndevblog.typepad.com/technology_perspective/2013/07/revit-%E3%83%95%E3%82%A1%E3%83%9F%E3%83%AAapi.html "
typepad_basename: "revit-ファミリapi"
typepad_status: "Publish"
---

<p>2週間ほど前に、「<a href="http://adndevblog.typepad.com/technology_perspective/2013/06/revit-%E3%83%95%E3%82%A1%E3%83%9F%E3%83%AA%E4%BD%9C%E6%88%90%E3%81%AE%E7%A7%98%E8%A8%A3.html" target="_self" title="Revit ファミリ作成の秘訣">Revitファミリの作成の秘訣</a>」というタイトルで、Revitファミリの作成の際の概念、特にパラメトリックなモデルを作成する上で大切な考え方や注意点を「骨格、筋肉、皮」にたとえてお話しました。今回は、その手順に従ってAPIで作成する方法のお話をしたいと思います。&#0160;</p>
<p>（なお、コードは、<a href="http://www.autodesk.com/developrevit" target="_self" title="Revit ADN サイト">Revit ADN Open のサイトにポストしてあるRevit 2013/2014 API Labs</a>&#0160;にありますので、必要に応じて参考にしてください。）</p>
<p><span style="text-decoration: underline;">概要</span></p>
<p>まず、ファミリAPIの定義ですが、私たちがファミリAPIと呼んでいるのは、Revit APIの一部で、UIでいうファミリ エディタの部分に相当します。ファミリ
エディタでは、窓や扉、柱といった、いわゆるコンポーネントファミリを作成することが可能です。壁や屋根といった要素は、システムファミリに属し、これらは、ファミリエディタでは編集できませんが、この点はAPIに関しても同じです。基本的に、ファミリAPIはファミリ エディタの部分を公開したAPIです。</p>
<p>ファミリAPIをもちいることにより、ファミリのライブラリの生成を自動化したり、あるいは、Revitプロジェクトの実行中に、他のライブラリやデータベースにアクセスして、適宜ファミリを作成したりすることが可能となります。また、既存のファミリから情報を抽出し、修正することも可能です。手順は基本的にはUIに類似しますが、いくつかの相違点と制限があります。これについては後ほど適宜触れることにします。</p>
<p><span style="text-decoration: underline;">ファミリ</span><span style="text-decoration: underline;">API</span><span style="text-decoration: underline;">特有のクラスとメソッド</span></p>
<p>ファミリのコンテキストで使用される特有のクラスとメソッドには以下があります。</p>
<p>FamilyManagerクラス：</p>
<ul>
<li>タイプの追加/削除/名前を変更、パラメータの追加/削除、値と数式の設定に使用します。</li>
</ul>
<p>ファミリのコンテキストに固有なドキュメントのメソッド：</p>
<ul>
<li>IsFamilyDocument - 現在開いているドキュメントが、ファミリのドキュメントであるかどうかを識別します。</li>
<li>OwnerFamily - このファミリドキュメントを所有するファミリを返します。</li>
<li>FamilyManager – ファミリの種類やパラメータへのアクセスを提供するFamilyManagerオブジェクトを返します。</li>
<li>FamilyCreate –　ファミリドキュメント内で新しいインスタンス要素を作成するFamilyItemCreateオブジェクトを返します。プロジェクトで作成するオブジェクトに類似します。</li>
<li>EditFamily - プロジェクトドキュメントにロードされているファミリを編集します。</li>
</ul>
<p><span style="text-decoration: underline;">ベストプラクティスに準じたファミリ</span><span style="text-decoration: underline;">API</span><span style="text-decoration: underline;">の使用例</span></p>
<p>それでは、ベストプラクティスに沿ったファミリAPIを、単純なL字型柱ファミリを例にとって見ていきましょう。ベストプラクティス、あるいは最適な手順としては、以下を常に意識する必要があることをお話しました：</p>
<ul>
<li>計画</li>
<li>参照面</li>
<li>パラメータ</li>
<li>タイプ</li>
<li>ジェオメトリ（幾何）</li>
</ul>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0192abe5fb3b970d-pi" style="display: inline;"><img alt="Plan" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0192abe5fb3b970d image-full" src="/assets/image_617510.jpg" title="Plan" /></a></p>
<p>具体的には、以下の手順を踏むことになります：</p>
<p style="padding-left: 30px;">1．計画</p>
<p style="padding-left: 30px;">２．参照面の設定</p>
<p style="padding-left: 30px;">３．パラメータの追加</p>
<p style="padding-left: 30px;">４．タイプの追加</p>
<p style="padding-left: 30px;">５．パラメトリックな動作のテスト - フレックス（Flex）</p>
<p style="padding-left: 30px;">６．ジェオメトリの追加</p>
<p style="padding-left: 30px;">7. 拘束（alignment）の追加</p>
<p style="padding-left: 30px;">８．ステップ５～８を繰り返す</p>
<p>今回は、その前半にあたる１～５のお話をしたいと思います。</p>
<p>&#0160;</p>
<p>1．計画</p>
<p>UIと同様、まずは、作成しようとするファミリがどういった動きをするかを考える必要があります。正しいテンプレートを選択します。例えば、ここでは、「Metric Column.rft」を選択します。そして、テンプレートを理解します。テンプレートにはあらかじめ基本となる参照面や寸法線が名前付きで定義されています。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0192abe5fc93970d-pi" style="display: inline;"><img alt="2 understand template" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0192abe5fc93970d image-full" src="/assets/image_832627.jpg" title="2 understand template" /></a><br /><br /></p>
<p>API でファミリを作成、編集する場合、まず与えられたドキュメントがファミリドキュメントであるかどうかを確認する必要があります。また、目的に応じたテンプレートやファミリのファイルを使用します。以下のコードでは、柱のファミリテンプレートであることを確認しています：</p>
<div>
<div>
<p>Function ValidateDocument(ByVal rvtDoc As Document) As Boolean<br />
<br />
</p>
<p>&#0160; &#39; 現在のドキュメントは、ファミリドキュメントであるかどうかをチェック<br />
<br />
</p>
<p>&#0160; If Not
rvtDoc.<strong>IsFamilyDocument</strong> Then</p>
<p>&#0160;&#0160;&#0160; TaskDialog.Show(</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; &quot;Family
API&quot;, &quot;このドキュメントはファミリドキュメントではありません。&quot;)</p>
<p>&#0160;&#0160;&#0160; Return False</p>
<p>&#0160; End If<br />
<br />
</p>
<p>&#0160; &#39; 正しいテンプレートかどうかをチェック。このドキュメントのオーナーファミリを取得</p>
<p>&#0160; Dim ownerFamily As Family = rvtDoc.<strong>OwnerFamily</strong></p>
<p>&#0160; If ownerFamily Is Nothing Then</p>
<p>&#0160;&#0160;&#0160; TaskDialog.Show(<br />
&#0160;&#0160;&#0160;&#0160;&#0160; &quot;Family
API&quot;, &quot;このドキュメントはオーナーファミリーを含みません。&quot;)</p>
<p>&#0160;&#0160;&#0160; Return False</p>
<p>&#0160; End If<br />
<br />
</p>
<p>&#0160; &#39; このドキュメントのオーナーファミリのカテゴリをチェック。</p>
<p>&#0160; Dim
catColumn As
Category = _ <br />
&#0160;&#0160;&#0160; rvtDoc.Settings.Categories.Item(BuiltInCategory.OST_Columns)</p>
<p>&#0160;&#0160;&#0160; If Not
ownerFamily.<strong>FamilyCategory</strong>.Id.Equals(catColumn.Id) Then</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; TaskDialog.Show(<br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &quot;Family
API&quot;, &quot;Metric
Column.rfを使用してください。&quot;)</p>
<p>&#0160;&#0160;&#0160; End If</p>
<p>&#0160; Return True<br />
<br />
</p>
<p>End Function</p>
</div>
<p>&#0160;</p>
<p>２．参照面の設定</p>
<p>次に参照面を追加します。例えば、L字型の柱の断面形状を定義する場合、縦・横方向に追加します。そしてそれらに名前をつけます。ここでは、OffsetV、OffsetHといった名前にすることします。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01901e26c9b9970b-pi" style="display: inline;"><img alt="3 reference plane" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01901e26c9b9970b" src="/assets/image_381678.jpg" title="3 reference plane" /></a></p>
<p>以下が、縦の参照面OffsetVの作成例です。ここでは、<strong>FamilyCreate.NewReferencePlane（）</strong>メソッドを用いています。（コードをわかりやすくするために、ビューの取得には、ユーティリティを用いた形で書いていますが、すでにRevit APIの基本を修得されている方にとっては、エレメントフィルターを用いた基本的な操作であることはお分かりかと思います。）<br /><br /></p>
<div>
<p>Sub AddReferencePlane_VerticalOffset()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 参照面の作成。NewReferencePlane
を使用。<br />
<br />
</p>
<p>&#0160; &#0160;&#0160;Dim pt1 As New XYZ(-0.5, -2.0, 0.0) &#39; 端点</p>
<p>&#0160;&#0160;&#0160; Dim pt2 As New XYZ(-0.5, 2.0, 0.0)&#0160; &#39; もう一方の端点</p>
<p>&#0160;&#0160;&#0160; Dim vec As
XYZ = XYZ.BasisZ&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#39; 最初のラインに垂直方向</p>
<p>&#0160;&#0160;&#0160; Dim
view As
View = _ </p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; Utils.FindElement(rvtDoc, GetType(ViewPlan), &quot;Lower Ref. Level&quot;)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim refPlane As ReferencePlane = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc.<strong>FamilyCreate.NewReferencePlane</strong>(pt1,
pt2, vec, view)</p>
<p>&#0160;&#0160;&#0160; refPlane.Name = &quot;OffsetV&quot;</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0191041cf186970c-pi" style="display: inline;"><img alt="4 new reference plane 1" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0191041cf186970c" src="/assets/image_672258.jpg" title="4 new reference plane 1" /></a></p>
<p>参照面の作成にはもうひとつのメソッド、<em>NewReferencePlane2()&#0160; </em>があります。これは、3つの点を指定して、参照面を定義します。</p>
<div>
<p>Sub AddReferencePlane_VerticalOffset2()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 参照面の作成。NewReferencePlane2を使用</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim
pt1 As New XYZ(-0.5, -2.0, 0.0) &#39; 第一端点 </p>
<p>&#0160;&#0160;&#0160; Dim pt2 As New XYZ(-0.5, 2.0, 0.0)&#0160; &#39; 第二端点 </p>
<p>&#0160;&#0160;&#0160; Dim pt3 As New XYZ(-0.5, -1.0, 1.0) &#39; 第三端点&#0160; </p>
<p>&#0160;&#0160;&#0160; Dim
view As
View = _ </p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; Utils.FindElement(rvtDoc, GetType(ViewPlan), &quot;Lower Ref. Level&quot;)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim refPlane As ReferencePlane = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc.<strong>FamilyCreate.NewReferencePlane2</strong>(pt1,
pt2, pt3, view)</p>
<p>&#0160;&#0160;&#0160; refPlane.Name = &quot;OffsetV&quot;</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0191041cf2f2970c-pi" style="display: inline;"><img alt="5 new reference plane 2" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0191041cf2f2970c" src="/assets/image_617993.jpg" title="5 new reference plane 2" /></a></p>
<p>&#0160;</p>
<p>３．パラメータの追加</p>
<p>&#0160;</p>
<p>次にパラメータと寸法線を追加します。例えば、左側にある縦の参照面の寸法をパラメータTwとすることとします。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0192abe6060a970d-pi" style="display: inline;"><img alt="6 add parameters" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0192abe6060a970d image-full" src="/assets/image_690698.jpg" title="6 add parameters" /></a><br /><br /></p>
<p>パラメータの追加には、FamilyManagerクラスのAddParameter()を使用します。以下が、Twの定義例です。</p>
<p>&#0160;</p>
<p>Dim m_familyMgr As FamilyManager = m_rvtDoc.<strong>FamilyManager</strong></p>
<div>
<p>&#0160;</p>
<p>Sub AddParameter_Tw()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; パラメータ
&quot;Tw&quot;の追加</p>
<p><br />
&#0160;&#0160; &#0160;Dim
isInstance As Boolean = False</p>
<p>&#0160;&#0160;&#0160; Dim
paramTw As
FamilyParameter = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_familyMgr.<strong>AddParameter</strong>(
_ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;&#0160;&#0160;&#0160;&quot;Tw&quot;, _<br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; BuiltInParameterGroup.PG_GEOMETRY,
_　&#39; パラメータのグループ</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; ParameterType.Length, _ </p>
<p>　　　　　　　isInstance)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 初期値を与える </p>
<p><br />
&#0160;&#0160;&#0160; Dim tw As Double = Utils.mmToFeet(150.0) &#39; メトリック</p>
<p>&#0160;&#0160;&#0160; &#39;Dim
tw As Double = 0.5&#0160; &#39; フィート</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; m_familyMgr.<strong>Set</strong>(paramTw, tw)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; フォーミュラ（数式）を追加（オプション）</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; m_familyMgr.<strong>SetFormula</strong>( _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; paramTw, &quot;Width / 4.0“)</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01901e26ce57970b-pi" style="display: inline;"><img alt="7 family types" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01901e26ce57970b image-full" src="/assets/image_694653.jpg" title="7 family types" /></a></p>
<p>&#0160;</p>
<p>パラメータColume Finish はここでは仕上げのマテリアルです。グループをマテリアルとします。また、今回は、タイプ パラメータではなく、インスタンス&#0160; パラメータとします。</p>
<div>
<p>Sub AddParameter_Material()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; &quot;Column
Finish&quot; パラメータの追加</p>
<p><br />
&#0160;&#0160;&#0160; Dim param As FamilyParameter = _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_familyMgr.AddParameter( _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &quot;Column
Finish&quot;, _ </p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;&#0160;&#0160;&#0160;BuiltInParameterGroup.PG_MATERIALS, _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;ParameterType.Material, _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; True)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 後ほどソリッドへの追加を行います。 </p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>&#0160;</p>
<p>次に寸法線を追加します。ここでも、Twを例にとった例を示します。ここでの作業では、<strong>FamilyCreate</strong>.<strong>NewDimension</strong>() をもちいて寸法線を作成しています。そして、pDimTw.<strong>Label</strong>で<strong>、</strong>寸法線のラベルにパラメータTwを結び付けているところに注目してください。</p>
<div>
<p>Sub AddDimention_Tw()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 寸法線を追加する平面ビューを取得 </p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim pViewPlan As View = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;Utils.FindElement( _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc, GetType(ViewPlan), &quot;Lower Ref. Level&quot;)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 寸法線を追加する2つの参照面を取得&#0160; </p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim ref1 As
ReferencePlane = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Utils.FindElement( _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc, GetType(ReferencePlane), &quot;Left&quot;)</p>
<p>&#0160;&#0160;&#0160; Dim ref2 As
ReferencePlane = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Utils.FindElement( _</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc, GetType(ReferencePlane), &quot;OffsetV&quot;)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 参照面の配列の作成 </p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim pRefArray As New
ReferenceArray</p>
<p>&#0160;&#0160;&#0160; pRefArray.Append(ref1.Reference)</p>
<p>&#0160;&#0160;&#0160; pRefArray.Append(ref2.Reference)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 寸法線の定義</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim p0 As
XYZ = ref1.FreeEnd</p>
<p>&#0160;&#0160;&#0160; Dim p1 As
XYZ = ref2.FreeEnd</p>
<p>&#0160;&#0160;&#0160; Dim pLine As Line = Line.CreateBound(p0, p1)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 寸法線の作成 </p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim pDimTw As Dimension = _ <br />
&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_rvtDoc.<strong>FamilyCreate</strong>.<strong>NewDimension</strong>(
_</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pViewPlan, pLine, pRefArray)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 寸法線にラベルをつける</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; pDimTw.<strong>Label </strong>=
m_familyMgr.Parameter(&quot;Tw&quot;)</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0191041cf6cd970c-pi" style="display: inline;"><img alt="8 add parameters to dimensions" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0191041cf6cd970c" src="/assets/image_114985.jpg" title="8 add parameters to dimensions" /></a></p>
<p>4．タイプの追加</p>
<p>&#0160;</p>
<p>次に、２つ以上のタイプを追加します。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0192abe60a17970d-pi" style="display: inline;"><img alt="9 add types" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0192abe60a17970d image-full" src="/assets/image_917885.jpg" title="9 add types" /></a></p>
<p>&#0160;</p>
<p>以下の関数は与えられた名前とパラメータの値で、1つのタイプを定義します。ファミリマネージャークラスのFamilyManager.
NewType()メソッドを用いてタイプを新規作成します。また、パラメータに値をセットするのもFamilyManagerのSet() 関数をもちいます。</p>
<div>
<p>Sub AddType( _</p>
<p>&#0160;&#0160;&#0160; ByVal name As String, _</p>
<p>&#0160;&#0160;&#0160; ByVal w As Double, _</p>
<p>&#0160;&#0160;&#0160; ByVal d As Double)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; 与えられた名前で新しいタイプの追加</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim
type1 As
FamilyType = m_familyMgr.<strong>NewType</strong>(name)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; &#39; &#39;Width&#39;
と
&#39;Depth&#39; パラメータの値を定義</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim paramW As FamilyParameter = m_familyMgr.<strong>Parameter</strong>(&quot;Width&quot;)</p>
<p>&#0160;&#0160;&#0160; Dim valW As Double = Utils.mmToFeet(w)</p>
<p>&#0160;&#0160;&#0160; If paramW IsNot Nothing Then</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_familyMgr.<strong>Set</strong>(paramW,
valW)</p>
<p>&#0160;&#0160;&#0160; End If</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160; Dim paramD As FamilyParameter = m_familyMgr.Parameter(&quot;Depth&quot;)</p>
<p>&#0160;&#0160;&#0160; Dim valD As Double = Utils.mmToFeet(d)</p>
<p>&#0160;&#0160;&#0160; If paramD IsNot Nothing Then</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_familyMgr.<strong>Set</strong>(paramD, valD)</p>
<p>&#0160;&#0160;&#0160; End If</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>&#0160;</p>
<p>上で定義した関数を用いて3つのタイプを定義します。</p>
<div>
<p>Sub AddTypes()</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; &#39; AddType(name,Width,Depth)</p>
<p>&#0160;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; AddType(&quot;600x900&quot;, 600.0, 900.0)</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; AddType(&quot;1000x300&quot;, 1000.0, 300.0)</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160; AddType(&quot;600x600&quot;, 600.0, 600.0)</p>
<p>&#0160;</p>
<p>End Sub</p>
</div>
<p>&#0160;</p>
<p>5．パラメトリックな動作のテスト - フレックス（Flex）</p>
<p>&#0160;</p>
<p>ここで一度テストを行ってみてください。</p>
<p>ここまでの時点では、ジェオメトリがまだ、定義されていないので、本来なら、ファミリーをプロジェクトにロードしても、何も目に見える要素はなく、意味がないように思われるかもしれません。実はこの時点で、テストをしておくのはとても大切なことなのです。以前お話したように、ジェオメトリは「皮」に過ぎず、動作を定義するのはあくまで、骨格と筋肉 - 参照面とパラメータでコントロールされる寸法線なのです。パラメータや寸法を変更してみて、意図した動きをするかどうか確認する作業をフレックス（Flex）と呼んでいます。</p>
<p>上記のコードで作成されたタイプをUIで選択して、意図したように参照面の位置が変更されるかどうか確認してみてください。</p>
<p>&#0160;</p>
<p>さて、参照面がパラメータによって、意図する動きが加わったら、ここでようやくジェオメトリの追加です。</p>
<p>少々ブログのポストが長くなりましたので、今日のところは、これくらいにさせていただいて、次回に　「６．ジェオメトリの追加」からのお話をさせていただくこととします。</p>
<p>原田</p>
<p>&#0160;</p>
</div>
