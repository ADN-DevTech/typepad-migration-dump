---
layout: "post"
title: "Postman を使った 2-legged 認証(OAuth v2)"
date: "2023-07-31 00:08:15"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2023/07/2lo-v2-on-postman.html "
typepad_basename: "2lo-v2-on-postman"
typepad_status: "Publish"
---

<p><a href="https://adndevblog.typepad.com/technology_perspective/2023/05/migration-guide-oauth2-v1-to-v2.html" rel="noopener" target="_blank">OAuth2 v1 から v2 への移行ガイド</a> でご案内のとおり、Authentication API（OAuth API）が v2 に移行して、アクセストークン取得の方法が変っています。過去にご紹介した <a href="https://adndevblog.typepad.com/technology_perspective/2016/09/understanding-steps-to-use-viewer-on-postman.html" rel="noopener" target="_blank">Postman による Viewer 利用手順の理解 - 2 legged 認証</a> についても、アクセストークンの取得方法を変更する必要が生じます。</p>
<p>具体的には、使用するエンドポイントが従来の <a href="https://aps.autodesk.com/en/docs/oauth/v1/reference/http/authenticate-POST/" rel="noopener" target="_blank">POST authenticate</a>&#0160;エンドポイントから <a href="https://aps.autodesk.com/en/docs/oauth/v2/reference/http/gettoken-POST/">POST token</a> エンドポイントに変わるほか、Client ID と Client Secret の指定方法も変更されています。ここでは、<a href="https://www.postman.com/" rel="noopener" target="_blank">Postman</a> 上での検証方法も含め、新しいエンドポイントでアクセストークンを取得する方法をご紹介しておきます。</p>
<hr />
<ol>
<li><span class="asset  asset-generic at-xid-6a0167607c2431970b02b751ad0b84200c img-responsive"><strong><a href="https://adndevblog.typepad.com/files/2.-%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9-%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97-v2.postman_collection.json">2. アクセス トークンの取得 v2.postman_collection</a>&#0160;</strong>をダウンロードして、Postman の任意の Workspace に Import します。<br /></span> <a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c1b25b625d200d-pi" style="display: inline;"><img alt="Import" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c1b25b625d200d image-full img-responsive" src="/assets/image_236906.jpg" title="Import" /></a></li>
<li><strong>2. アクセス トークンの取得 v2</strong> フォルダ下に<strong> POST Token</strong> エンドポイントがインポートされます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02b751ad0b97200c-pi" style="display: inline;"><img alt="Post_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02b751ad0b97200c image-full img-responsive" src="/assets/image_441683.jpg" title="Post_token" /></a></li>
<li><strong>POST Token</strong> をクリックして、<strong>Headers</strong> タブに切り替えたら、<strong>Authorization</strong> キーの値を &lt;client_id&gt;:&lt;client_secret&gt; の形式で <a href="https://ja.wikipedia.org/wiki/Base64" rel="noopener" target="_blank"><strong>Base64 エンコード</strong></a>化して指定します。<br /><img alt="Client_id_secret" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c1a6cfa989200b image-full img-responsive" src="/assets/image_658977.jpg" title="Client_id_secret" /><br />例えば、Client ID が <strong>ufENaQGHgSxraC81JLEV51CWoG8kAqf</strong>、Client Secret が <strong>VpRAgBpr4ekOg3Q</strong> の場合、<strong>ufENaQGHgSxraC81JLEV51CWoG8kAqf:VpRAgBpr4ekOg3Q</strong> の文字列を、&#0160;<strong><a href="https://www.base64encode.org/" rel="noopener noreferrer" target="_blank">https://www.base64encode.org/</a></strong> サイト等で Base64 変換して <strong>dWZFTmFRR0hnU3hyYUM4MUpMRVY1MUNXb0c4a0FxZjpWcFJBZ0JwcjRla09nM1E=&#0160;</strong>を取得したら、&quot;<strong>Basic</strong> &quot; を先頭に挿入して<strong> Basic dWZFTmFRR0hnU3hyYUM4MUpMRVY1MUNXb0c4a0FxZjpWcFJBZ0JwcjRla09nM1E=</strong>&#0160;を&#0160;Authorization キー値に指定します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c1a6cfa9a2200b-pi" style="display: inline;"><img alt="Base64_encoded" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c1a6cfa9a2200b image-full img-responsive" src="/assets/image_114565.jpg" title="Base64_encoded" /></a></li>
<li><strong>Headers</strong> タブの <strong>Content-Type</strong> キーには、<strong>application/x-www-form-urlencoded</strong> 値が設定されていることを確認します。</li>
<li>次に、<strong>Body</strong> タブに切り替えたら、<strong>grant_type</strong> キーの値に <strong>client_credentials</strong> が、<a href="https://aps.autodesk.com/en/docs/oauth/v2/developers_guide/scopes/" rel="noopener" target="_blank"><strong>scope</strong></a> キーの値に使用するエンドポイントに合わせた必要な値を設定します。scope に複数の値を指定する場合は、半角スペース区切りで指定します。<strong>2. アクセス トークンの取得 v2.postman_collection</strong> では、<strong>bucket:create bucket:read data:read data:write data:create</strong> を埋め込んであります。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c1a6cfa9c1200b-pi" style="display: inline;"><img alt="Body" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c1a6cfa9c1200b image-full img-responsive" src="/assets/image_665182.jpg" title="Body" /></a></li>
<li><strong><span style="color: #ffffff; background-color: #a040ff;">[Send]</span></strong> ボタンでアクセストークンを取得することが出来ます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c1a6cfaa08200b-pi" style="display: inline;"><img alt="Access_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c1a6cfaa08200b image-full img-responsive" src="/assets/image_732179.jpg" title="Access_token" /></a></li>
</ol>
<hr />
<p>従来の <strong><a href="https://aps.autodesk.com/en/docs/oauth/v1/reference/http/authenticate-POST/" rel="noopener" target="_blank">POST authenticate</a></strong> エンドポイントと異なり、Client ID と Client Secret の指定方法がリクエストボディからリクエストヘッダーに移動して、かつ、Base64 エンコードが必須になっていることがわかります。また、新しい <strong><a href="https://aps.autodesk.com/en/docs/oauth/v2/reference/http/gettoken-POST/">POST token</a></strong> エンドポイントは、リクエストボディの <strong>grant_type</strong> キーの値によって、3-legged 認証・認可のオーソライゼーション コードからのアクセス トークンの取得やリフレッシュ トークンの取得でも使用出来ることがわかります。</p>
<p>By Toshiaki Isezaki</p>
