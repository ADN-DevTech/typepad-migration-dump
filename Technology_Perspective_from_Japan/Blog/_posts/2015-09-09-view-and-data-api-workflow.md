---
layout: "post"
title: "View and Data API ワークフロー"
date: "2015-09-09 00:25:00"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-workflow.html "
typepad_basename: "view-and-data-api-workflow"
typepad_status: "Publish"
---

<p><span style="background-color: #ffff00;">View and Data API は2016年6月に Viewer と &#0160;Model Derivative API に分離、及び、名称変更されました。</span></p>
<p>&#0160;</p>
<p>以前、次のブログ記事で &#0160;View and Data API の開発環境の準備やキーの取得までの手順をご案内しています。</p>
<p style="padding-left: 30px;"><a href="http://adndevblog.typepad.com/technology_perspective/2015/09/about-view-and-data-api.html" target="_blank"><strong>View and Data API とは ?</strong></a>&#0160;</p>
<p style="padding-left: 30px;"><a href="http://adndevblog.typepad.com/technology_perspective/2015/01/a360-api-and-storage.html" target="_blank"><strong>A360 API とストレージの考え方</strong></a></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/08/setup-development-environment-view-and-data-api.html" target="_blank">View and Data API の開発環境</a></strong></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-app-register-and-getting-keys.html" target="_blank">View and Data API アプリ登録とキーの入手</a></strong></p>
<p>もし、まだ、これらをお読みになっていないようであれば、このブログ記事を読み進める前に、先に目を通していただくことをお勧めします。</p>
<p>さて、 今回は、いよいよ View and Data API の利用手順について、オートデスク デベロッパ ポータル（https://developer.autodesk.com）で公開されている機能を使ってご紹介してきます。この手順は、基本的に過去のブログ記事&#0160;<a href="http://adndevblog.typepad.com/technology_perspective/2015/01/view-data-api-quick-start-sample.html" target="_blank"><strong>View &amp; Data API クイック スタート サンプル</strong></a>&#0160;で紹介した内容と同じです。ただし、今回の機能はオンラインで試すことができので、サンプルをダウンロードするような手間が省けて便利です。</p>
<p>View and Data API の利用手順は、おおまかに次のようになります。<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7c8c22e970b-pi" style="display: inline;"><img alt="Workflow" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7c8c22e970b image-full img-responsive" src="/assets/image_159779.jpg" title="Workflow" /></a></p>
<p>最初にある「アカウント登録とアプリケーションの作成」は、前述のブログ記事&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-app-register-and-getting-keys.html" target="_blank">View and Data API アプリ登録とキーの入手</a></strong>&#0160;でご説明していると思います。 ここでは、それ以降の手順をシミュレーションしていきます。通常、これらはプログラム側で実装するべき内容である点にご注意ください。具体的には、「アクセス トークンの取得」から「変換リクエスト」までは、View and Data API の REST API で、「クライアントからのアクセス」で表現される Web ブラウザ上での 3D モデル/ 2D 図面の表示は、同じく JavaScript API を利用することになります。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d152b26b970c-pi" style="display: inline;"><img alt="Api_kind" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d152b26b970c image-full img-responsive" src="/assets/image_323894.jpg" title="Api_kind" /></a></p>
<p>それでは、ライブデモで手順を確認していきましょう。</p>
<p><strong>ライブデモ ページの表示手順</strong></p>
<ol>
<li>Web ブラウザで&#0160;<strong><a href="https://developer.autodesk.com/" target="_blank">オートデスク デベロッパ ポータル（https://developer.autodesk.com）</a>&#0160;</strong>を開いて、上部の API リンクメニューから <a href="https://developer.autodesk.com/api/view-and-data-api/" target="_blank"><strong>View and Data Service</strong> </a>をクリックします。<br /> &#0160;<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb086d1931970d-pi" style="display: inline;"><img alt="Choose_api" class="asset  asset-image at-xid-6a0167607c2431970b01bb086d1931970d img-responsive" src="/assets/image_347459.jpg" style="width: 420px;" title="Choose_api" /></a></li>
<li>View and Data API の Web ページが開いたら、左手のメニューリンクの中から <a href="http://developer-autodesk.github.io/LmvQuickStart/" target="_blank"><strong>Try This API</strong></a> をクリックします。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7c9ff6e970b-pi" style="display: inline;"><img alt="Link_to_try_this_api" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7c9ff6e970b image-full img-responsive" src="/assets/image_148425.jpg" title="Link_to_try_this_api" /><br /></a></li>
<li>表示された Try View and Data API ページが、手順を確認するライブデモのページです。左手に手順を示す各ステップ（Step）へのリンクメニューが表示されているはずです。手順は、<strong>Step 1</strong> &#0160;から <strong>Step 13</strong> までになっているはずです。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb086e502e970d-pi" style="display: inline;"><img alt="Try_this_api" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb086e502e970d image-full img-responsive" src="/assets/image_677769.jpg" title="Try_this_api" /></a><br /><br /></li>
</ol>
<p><strong>ライブデモ ページの操作手順</strong></p>
<ol>
<li><strong>Step 1 : Try the Viewer Live&#0160;</strong>では、View and Data API の機能を理解するためのサンプルを確認するすことが出来ます。</li>
<li><strong>Step 2 : Sign Up</strong>&#0160;の部分に書かれているのは、デベロッパ ポータルへのサインアップとアプリ登録（Consumer Key と Consumer Secret の取得）方法です。この手順は、ブログ記事 <a href="http://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-app-register-and-getting-keys.html" target="_blank"><strong>View and Data API アプリ登録とキーの入手</strong></a>&#0160;で詳しくご紹介していますので、もし、アプリ登録がまだの方は、そちらをご覧ください。</li>
<li><span style="color: #000000;"><strong>Step3 : Get Access Token</strong> では、View and Data API でクラウドストレージにアクセスするためのアクセス トークンを取得します。ここでは、Curl でアクセス トークンを取得することにします。メモ帳などのテキスト エディタで、<strong>Step 2 : Sign Up&#0160;</strong>で 入手した Consumer Key と Consumer Secret を次の Curl 構文に挿入します。<br /><br />curl --data &quot;client_id=<span style="background-color: #ffff00;">MY_CONSUMER_KEY</span>&amp;client_secret=<span style="background-color: #ffff00;">MY_CONSUMER_SECRET</span>&amp;grant_type=client_credentials&quot; https://developer.api.autodesk.com/authentication/v1/authenticate --header &quot;Content-Type: application/x-www-form-urlencoded&quot; -k<br /><br />デベロッパ ポータルで登録したアプリの Consumer Key と Consumer Secret が、次のようになっていたら、作成すべき Curl 構文は、次のようになります。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d153ed0b970c-pi" style="display: inline;"><img alt="Myapp_info" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d153ed0b970c image-full img-responsive" src="/assets/image_432128.jpg" title="Myapp_info" /></a><br />curl --data &quot;client_id=<span style="background-color: #ffff00;">7XYKfPIIYssYPfDgyJTxy8kCmZPt7AB1</span>&amp;client_secret=<span style="background-color: #ffff00;">sp0GZXAuDWVTQPTy</span>&amp;grant_type=client_credentials&quot; https://developer.api.autodesk.com/authentication/v1/authenticate --header &quot;Content-Type: application/x-www-form-urlencoded&quot; -k<br /><br />次に、Windows のコマンド プロンプトを起動後に、ブログ記事 <strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/08/setup-development-environment-view-and-data-api.html" target="_blank">View and Data API の開発環境</a></strong>&#0160;でセットアップした Curl フォルダに移動して、 作成した Curl 構文を貼り付けてからリターンキーで実行します。ここでは、Curl で REST API がコールされます。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb086e5187970d-pi" style="display: inline;"><img alt="Access_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb086e5187970d image-full img-responsive" src="/assets/image_146733.jpg" title="Access_token" /></a><br />しばらくすると、コマンド プロンプト上に Consumer Key と Consumer Secret から生成されたアクセス トークンが、JSON 形式で返されてきます。<br />黄色い下線の部分がアクセス トークンです。この部分だけをクリップボードにコピーして、<strong>Step3 : Get Access Token</strong>&#0160;の Auth Token 欄に貼り付けてから、[Authenticate] リンクボタンをクリックしてください。これで、API からクラウドへアクセスするアクセス権限が手に入りました。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d153ee32970c-pi" style="display: inline;"><img alt="Auth_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d153ee32970c image-full img-responsive" src="/assets/image_31866.jpg" title="Auth_token" /></a></span></li>
<li><span style="color: #000000;"><strong>Step 4 : Create Bucket</strong> では、2D 図面ファイルや 3D モデル ファイルをアップロードする場所を API 専用領域に Bucket（バケツ）として作成します。ここでは、他の開発者と重複しないよう、Bucket にユニークな名前を付けなければなりません。利用できるのは、小文字アルファベット、数字、&quot;-&quot;（ハイフン） と &quot;_&quot;（アンダーバー）のみです。日本語や大文字アルファベットなどは利用できませんので注意してください。もちろん、この処理でも背後で REST API がコールされています。<br />Retention Policy &#0160;は、Bucket にアップロードしたファイルの寿命を示します。transient は 24時間、temporary は 30 日間、persistent は削除命令をするまで永久、です。時間が経過すると自動的にクラウドからファイルが削除されます。<br />ここでは、Bucket 名を &quot;<strong>auj-japan-test-001</strong>&quot;、Retention Policy を &quot;<strong>ｔransient</strong>&quot; として、[Create Bucket] ボタンをクリックします。正常に作成できると、Result 欄に、クラウドからの応答が &#0160;JSON で表示されます。同じ名前の Bucket が既に存在している場合には、409 Conflict エラーの JSON が表示されます。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7ca0272970b-pi" style="display: inline;"><img alt="Create_bucket" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7ca0272970b image-full img-responsive" src="/assets/image_109577.jpg" title="Create_bucket" /></a></span></li>
<li><span style="color: #000000;">Step 5: Get Bucket Details で、作成した Bucket の情報を取得します。Bucket が既に登録されているか調べるような際にも、この REAT API コードを利用することが出来ます。Bucket Name 欄に作成した Bucket 名を入力して、[Get Bucket Details] ボタンをクリックします。正常に取得できると、Result 欄に、クラウドからの応答が &#0160;JSON で表示されます。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb086e528a970d-pi" style="display: inline;"><img alt="Get_bucket_details" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb086e528a970d image-full img-responsive" src="/assets/image_249308.jpg" title="Get_bucket_details" /></a></span></li>
<li><span style="color: #000000;"><strong>Step 6: Get Supported Formats</strong> では、[Get Supported Formats] ボタンをクリックすることで、View and Data API で変換処理がサポートされているファイル拡張子を取得できます。必要に応じて、テストしてみてください。&#0160;Result 欄をスクロールすることで、すべてのファイル拡張子を把握することが出来ます。<br /><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7ca0305970b-pi" style="display: inline;"><img alt="Get_supported_formats" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7ca0305970b image-full img-responsive" src="/assets/image_363383.jpg" title="Get_supported_formats" /></a></span></li>
<li><span style="color: #000000;"><strong>Step 7: Upload File to Bucket</strong> で、作成した Bucket に View and Data API で表示したいファイルをアップロードします。Bucket Name 欄に&#0160;Bucket 名を入力したら、[参照] ボタンでサポートされるファイル形式を持つ任意のデータ ファイルを指定してください。指定後に [Upload File to Bucket] ボタンでアップロードを完了します。<br />アップロードが正常に完了すると、Result 欄にクラウドからの応答が JSON で表示されます。&quot;key&quot; となっているのが Bucket 内の識別で使われる Key で、一般には次の赤線部のファイル名となります。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d153ef77970c-pi" style="display: inline;"><img alt="Upload_file_to_bucket" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d153ef77970c image-full img-responsive" src="/assets/image_160586.jpg" title="Upload_file_to_bucket" /></a><br /></span></li>
<li><span style="color: #000000;"><strong>Step 8: Get Bucket Object</strong> では、Bucket 内にファイルが存在しているか確認出来ます。Bucket Name 欄に Bucket 名を、Object Key 欄にStep 7 で取得した &quot;key&quot;、ここでは Desktop_Fan.nwd を入力して [Get Bucket Object] ボタンをクリックします。<br />Bucket に指定した Object Key のファイルが存在していれば、Result 欄に JSON が返されます。もし、ファイルが存在しなければ、404 Not Found エラーの JSON が表示されます。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7ca0410970b-pi" style="display: inline;"><img alt="Get_bucket_object" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7ca0410970b image-full img-responsive" src="/assets/image_473022.jpg" title="Get_bucket_object" /></a><br /></span></li>
<li><span style="color: #000000;"><strong>Step 9: Set References</strong> では、同じ Bucket にアップロードしたファイルの親子関係を JSON で指定します。これには、外部参照を持つ DWG 図面ファイルや、Inventor や Solid Works のアセンブリ構造などがあげられます。今回は、単一ファイルをアップロードしているので、何もせずにスキップします。</span></li>
<li><span style="color: #000000;">View and Data では、クライアントからの表示を JavaScript で行う場合、エンコードされた Bucket 名と Object Key 名を使用して指定します。</span><strong>Step 10: Encode URN</strong> では、Step 8 で取得した &#0160;JSON から、&quot;id&quot; で示されるドキュメント ID の文字列をエンコードします。<br />ここでは、URN to Encode 欄に、Step 8 の Result 欄からクリップボードにコピーした&#0160;<strong>urn:adsk.objects:os.object:auj-japan-test-001/Desktop_Fan.nwd</strong> を貼り付けて、[Encode Base64] ボタンをクリックします。変換が完了すると、Result 欄にエンコードされたドキュメント ID が表示されます。右スクロールでドキュメント ID すべての文字列を把握することが出来ます。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7ca0450970b-pi" style="display: inline;"><img alt="Encode_urn" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7ca0450970b image-full img-responsive" src="/assets/image_146515.jpg" title="Encode_urn" /></a></li>
<li><span style="color: #000000;"><strong>Step 11: Translate the File</strong> では、エンコードされたドキュメント ID を使って、ストリーミング配信用の変換処理を命令します。Encoded URN of file to translate 欄に、Step 10 の Result 欄からクリップボードにコピーしたドキュメント ID を貼り付けて、[Translate] ボタンで変換を指示してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d153f098970c-pi" style="display: inline;"><img alt="Translate_the_file" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d153f098970c image-full img-responsive" src="/assets/image_470432.jpg" title="Translate_the_file" /></a><br /></span></li>
<li><span style="color: #000000;">ストリーミング配信用に</span>変換するための処理時間は、アップロードしたファイルのボリュームによって変化します。<strong>Step 12: View Translation Status</strong> では、変換処理が終了したらチェックするフェーズです。一般には、REST API を定期的に呼び出すポーリング処理を実装して、変換完了を待つように実装します。<br />ここでは、Encoded URN of file 欄に Step 11 と同じドキュメント ID を貼り付けて、何回かに渡って [Get Status] ボタンをクリックします。Result 欄に表示される JOSN から、&quot;progress&quot; 値が &quot;complete&quot; になれば、変化処理は完了です。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb086e548b970d-pi" style="display: inline;"><img alt="View_translation_status" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb086e548b970d image-full img-responsive" src="/assets/image_972989.jpg" title="View_translation_status" /></a></li>
<li>いよいよ、View and Data API でアップロードしたファイルを表示させる準備が整いました。Encoded URN of file to view 欄に Step 12 で変換処理が終了したファイルのドキュメント ID を貼り付けて [View it] ボタンをクリックしてください。しばらくして、ビューワー上にモデルが表示されるはずです。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d153f22a970c-pi" style="display: inline;"><img alt="View_your_file" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d153f22a970c image-full img-responsive" src="/assets/image_366077.jpg" title="View_your_file" /></a></li>
</ol>
<p>少々長めではありますが、これが、ライブデモで把握いただける View and Data API の利用手順です。繰り返しになりますが、Step 3 から Step 13 はプログラム実装でカバーする内容です。また、Bucket の作成やファイルのアップロード、ストリーミング配信用の変換処理は、毎回必須というわけではありません。電子カタログのような場合には、persistent 属性で作成した Bucket 内のドキュメント ID を使いまわすことも出来ます。</p>
<p>さて、ここまでの内容を動画にしてみましたので、内容をご確認ください。</p>
<p style="text-align: center;"><iframe allowfullscreen="" frameborder="0" height="281" src="https://www.youtube.com/embed/0Tbhnd6tq6s?feature=oembed" width="500"></iframe>&#0160;&#0160;</p>
<p>あとは、GitHub にある各種サンプルを参照して、目的にあった実装にチェレンジしてみてください。</p>
<p>By Toshiaki Isezaki</p>
