---
layout: "post"
title: "Fusion 360 API：カスタム ダイアログ"
date: "2016-01-06 00:54:35"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2016/01/fusion-360-api-custom-dialog.html "
typepad_basename: "fusion-360-api-custom-dialog"
typepad_status: "Publish"
---

<p>カスタム コマンドから独自に作成したダイアログ ボックスを作って、その後の処理に必要な入力値をユーザに入力させたい場合があります。もちろん、API を使ってカスタム ダイアログ表示させることは可能です。まず、カスタム コマンドを定義する手順をおさらいしておきます。&#0160;</p>
<ol>
<li>コマンド定義を作成<br />&#0160;&#0160;&#0160;&#0160; －&#0160;CommandDefinition オブジェクト</li>
<li>ユーザ インタフェース上にカスタム コマンドをどう表示するか、コントロール定義を追加&#0160;<br /> &#0160;&#0160;&#0160;&#0160;－&#0160;CommandDefinitions.addButtonDefinition メソッド</li>
<li>コマンド定義をコマンド作成イベントを接続<br />&#0160; &#0160; －&#0160;CommandDefinition.commandCreated.add メソッド</li>
<li>コマンド作成イベント内でコマンド実行イベントを接続<br />&#0160; &#0160; － CommandEvent.add メソッド</li>
</ol>
<p>この手順に沿って、[モデル ワークスペース] の [アドイン] パネルに [マイコマンド] の名前のついたコマンドを配置することを考えてみます。&#0160;</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d18c05e0970c-pi" style="display: inline;"><img alt="Custom_command" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d18c05e0970c image-full img-responsive" src="/assets/image_961823.jpg" title="Custom_command" /></a></p>
<p>この状態は、次のアドイン コードで実現するこが出来ます。ここでは、JavaScript で例を示します。&#0160;</p>
<table cellpadding="0pt" cellspacing="0pt" style="background-color: #c0c0c0;">
<tbody>
<tr>
<td>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">function run(context) {</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;&quot;use strict&quot;;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;if (adsk.debug === true) {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;/*jslint debug: true*/</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;debugger;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;/*jslint debug: false*/</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;}</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;var app;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;var ui;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;try</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160; &#0160; &#0160; &#0160; app = adsk.core.Application.get();</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui = app.userInterface;</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;// CommandExecuted event handler.</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var onCommandExecuted = function(args)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;try</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;args.isValidResult = true;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;CommandExecuted&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;} </span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;catch (e)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{ </span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;CommandExecuted Failed : &#39; + (e.description ? e.description : e));</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;};</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;// CommandCreated event handler.</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var onCommandCreated = function(args)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;try</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var cmd = args.command;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;cmd .execute .add(onCommandExecuted);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;catch (e)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;CommandCreated Failed : &#39; + (e.description ? e.description : e));</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;};</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var onInputChanged = function(args)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;try</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var command = adsk.core.Command(args.firingEvent.sender);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;Input: &#39; + command.parentCommandDefinition.id + &#39; changed event triggered&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;catch (e)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;Input changed event failed: &#39; + errorDescription(e));</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;};</span></strong></span><br /> <br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var cdfs = ui.commandDefinitions;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var cdf = ui.commandDefinitions.itemById(&#39;adnjapan-ui-test1&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;if (!cdf)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var myCommand = cdfs.addButtonDefinition(&#39;adnjapan-ui-test1&#39;, &#39;マイコマンド&#39;, &#39;カスタム ダイアログを表示&#39;, &#39;./Resources&#39;);</span></strong></span><br /> <br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var ws = ui.workspaces.itemById(&#39;FusionSolidEnvironment&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var tps = ws.toolbarPanels;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var tp = tps.itemById(&#39;SolidScriptsAddinsPanel&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;tp.controls.addCommand(myCommand);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var commandCreatedEvent = myCommand.commandCreated;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;commandCreatedEvent.add(onCommandCreated); </span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;catch (e)<br />&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;if (ui)<br />&#0160;&#0160;&#0160;&#0160;&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;Failed : &#39; + (e.description ? e.description : e));</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">}</span></strong></span></p>
<p><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">function stop(context) {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;var ui;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;try<br />&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var app = adsk.core.Application.get();</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui = app.userInterface;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var cdf = ui.commandDefinitions.itemById(&#39;adnjapan-ui-test1&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;if (cdf)</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;{</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var ws = ui.workspaces.itemById(&#39;FusionSolidEnvironment&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var tps = ws.toolbarPanels;</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var tp = tps.itemById(&#39;SolidScriptsAddinsPanel&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var mycommand = tp.controls.itemById(&#39;adnjapan-ui-test1&#39;);</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;mycommand.deleteMe();</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;cdf.deleteMe();</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;catch (e)<br />&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;if (ui)<br />&#0160;&#0160;&#0160;&#0160;&#0160; &#0160; {</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;Failed : &#39; + (e.description ? e.description : e));</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;}</span></strong></span><br /><span style="font-size: 10pt;"><strong><span style="font-family: &#39;courier new&#39;, courier;">}</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p>ここで作成したカスタム コマンド [マイコマンド] には、一意な ID として&#0160;&#39;adnjapan-ui-test1&#39; を与えています。この ID は、Fusion 360 のセッション中存続し続けるので、カスタム コマンドと関連付けられたボタン コントロールの有無を識別に利用することが出来ます。このコードでは、アドインが停止する際にコマンド定義とボタン コントロールを削除しています。</p>
<p>カスタム コマンドが実行された際にカスタム ダイアログを表示させるには、コマンド作成イベント中で&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/11/fusion-360-api-object-model.html" target="_blank">オブジェクト モデル</a></strong>&#0160;のブログ記事でご紹介したインプット オブジェクトを利用します。最も一般的なのは、ValueInput オブジェクトです。</p>
<p>ここでは、下記のようなカスタム ダイアログを表示させる場合を考えてみます。&#0160;</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c80226e6970b-pi" style="display: inline;"><img alt="Custom_dialog" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c80226e6970b img-responsive" src="/assets/image_308597.jpg" title="Custom_dialog" /></a></p>
<p>このカスタム ダイアログは、前述のコードにあるコマンド作成イベント内で、下記の<span style="color: #0000ff;"><strong>青字</strong></span>部分を追加します。コマンド作成イベントのパラメータから Command オブジェクトを取得することが出来るので、CommandInputs.addValueInput メソッドを呼び出して、&#0160;adsk.core.ValueInput.createByString(&#39;2&#39;); のように静的な呼び出しで作成した ValueInput オブジェクトを追加します。ValueInput オブジェクトには、文字列を入力させるための&#0160;createByString メソッドと、実数を入力させるための&#0160;createByReal メソッドがあり、それぞれのパラメータにダイアログ上に表示される際の初期値、単位表記を指定することが出来ます。</p>
<table style="width: 100%; background-color: #c0c0c0;">
<tbody>
<tr>
<td>
<p><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong>// CommandCreated event handler.</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> var onCommandCreated = function(args)</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> {</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;try</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;{</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var cmd = args.command;</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;cmd. execute. add(onCommandExecuted);</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #ff0004;">cmd.inputChanged.add(onInputChanged);</span></strong></span></p>
<p><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var uom = app.activeProduct.unitsManager;</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var inputs = cmd.commandInputs;</strong></span></p>
<p><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var value = adsk.core.ValueInput.createByString(&#39;2&#39;);</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var val1 = inputs.addValueInput(&#39;val1&#39;, &#39;文字列&#39;, uom.defaultLengthUnits, value);</strong></span></p>
<p><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;value = adsk.core.ValueInput.createByReal(5);</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var val2 = inputs.addValueInput(&#39;val2&#39;, &#39;実数&#39;, uom.defaultLengthUnits, value);</strong></span></p>
<p><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;value = adsk.core.ValueInput.createByReal(3.14159);</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier; color: #0000ff;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;var val3 = inputs.addValueInput(&#39;val3&#39;, &#39;角度&#39;, &#39;deg&#39;, value);</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;}</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;catch (e)</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;{</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;CommandCreated Failed : &#39; + (e.description ? e.description : e));</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> &#0160;&#0160;&#0160;&#0160;}</strong></span><br /><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"><strong> };</strong></span></p>
</td>
</tr>
</tbody>
</table>
<p>Fusion 360 API では、上記のような処理で自動的に&#0160;[OK] ボタンと [キャンセル] ボタンを持つダイアログ ボックスが表示されるようになります。この部分は、他のオブジェクト指向 API とは大分異なります。ただ、設定した各入力項目は、自動的に桁数や数値の判断が実施されます。例えば、createByReal メソッドで作成した項目にアルファベットを入力すると、&#0160;[OK] ボタンがマスクされてクリック出来なくなるばかりか、入力値が不正であることを知らせるために、値が赤く表示されます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d18c096c970c-pi" style="display: inline;"><img alt="Custom_dialog_invalid_input" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d18c096c970c img-responsive" src="/assets/image_934763.jpg" title="Custom_dialog_invalid_input" /></a></p>
<p>もし、独自のチェックが必要な場合には、<strong><span style="color: #ff0004;">赤字</span></strong>で指定した InputChanged イベントハンドラで実装が可能です。</p>
<p>なお、上記コード内で&#0160;UnitsManager オブジェクトの&#0160;defaultLengthUnits プロパティを参照していますが、これは、[基本設定] ダイアログの設定値を参照しています。このコード例の場合には、[モデル] ワークスペースでの使用を想定しているので、「デザイン」の単位が採用されることになります。指定した値が指定した単位で変換されている点にもご注意ください。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08a6cb12970d-pi" style="display: inline;"><img alt="Units_of_measure" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb08a6cb12970d image-full img-responsive" src="/assets/image_262588.jpg" title="Units_of_measure" /></a></p>
<p>カスタム ダイアログ上の項目が正しく入力されて [OK] ボタンがクリックされた場合のみ、コマンド実行イベントが発生します。実際の処理は、このコマンド実行イベントで処理しますが、[キャンセル] ボタンがクリックされた際には、このイベントは発生しません。なお、ダイアログ上の各値は、コマンド実行イベント内で&#0160;args.command.commandInputs.itemById(&#39;val1&#39;).value のように取得することが可能です。</p>
<table style="width: 100%; background-color: #c0c0c0;">
<tbody>
<tr>
<td><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> // CommandExecuted event handler.</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> var onCommandExecuted = function(args)</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> {</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;try</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;{</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;args.isValidResult = true; </span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(args.command.commandInputs.itemById(&#39;val1&#39;).value + &#39;\n&#39; +</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; args.command.commandInputs.itemById(&#39;val2&#39;).value + &#39;\n&#39; +</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160; &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;args.command.commandInputs.itemById(&#39;val3&#39;).value);</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;} </span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;catch (e)</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;{ </span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;ui.messageBox(&#39;CommandExecuted Failed : &#39; + (e.description ? e.description : e));</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> &#0160;&#0160;&#0160;&#0160;}</span></strong><br /><strong><span style="font-size: 10pt; font-family: &#39;courier new&#39;, courier;"> };</span></strong></td>
</tr>
</tbody>
</table>
<p>ここまでの説明を実装したコマンドの動作をまとめましたので、下記の動画でご確認ください。なお、カスタム コマンドのボタン定義で使用するリソース ファイルも含め、完全なアドインのソースコード一式は、<span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d18d9652970c img-responsive"><strong><a href="http://adndevblog.typepad.com/files/newaddin1.zip">こちら</a></strong>&#0160;からダウンロードすることが出来ます。</span></p>
<p><iframe allowfullscreen="" frameborder="0" height="281" src="https://www.youtube.com/embed/Y0qxz0Or9rs?feature=oembed" width="500"></iframe>&#0160;</p>
<p>なお、カスタム ダイアログには、ValueInput オブジェクトで指定可能な文字列と実数のほかにも、多彩なコントロールを表示することが出来ます。 詳細は、<strong><a href="http://fusion360.autodesk.com/learning/learning.html?guid=GUID-3922697A-7BF1-4799-9A5B-C8539DF57051" target="_blank">オンラインヘルプ</a></strong>を参照してみてください。</p>
<p>By Toshiaki Isezaki</p>
