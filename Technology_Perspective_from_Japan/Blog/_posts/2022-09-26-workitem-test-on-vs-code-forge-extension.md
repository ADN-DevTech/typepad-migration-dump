---
layout: "post"
title: "Design Automation API：VS Code を使った WorkItem テスト"
date: "2022-09-26 00:05:29"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2022/09/workitem-test-on-vs-code-forge-extension.html "
typepad_basename: "workitem-test-on-vs-code-forge-extension"
typepad_status: "Publish"
---

<p>VS Code 用に用意された APS Extension（旧 Forge Extension）を利用して、Design Automation API をテストすることが出来ます。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02dad0cbb336200d-pi" style="display: inline;"><img alt="Aps_extension_da" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02dad0cbb336200d image-full img-responsive" src="/assets/image_820928.jpg" title="Aps_extension_da" /></a></p>
<p>もし、APS Extension（旧 Forge Extension）をご存じない場合には、次のブログ記事に目を通してみてください。</p>
<p style="padding-left: 40px;"><a href="https://adndevblog.typepad.com/technology_perspective/2020/06/forge-development-using-vs-code.html" rel="noopener" target="_blank">Visual Studio Code での Forge 開発</a></p>
<p style="padding-left: 40px;"><a href="https://adndevblog.typepad.com/technology_perspective/2020/09/viewer-workflow-on-vs-code-forge-extension.html" rel="noopener" target="_blank">VS Code Forge Extension を使った Viewer ワークフローの確認</a></p>
<p style="padding-left: 40px;"><a href="https://adndevblog.typepad.com/technology_perspective/2021/09/switching-environment-on-vs-code-forge-tools.html" rel="noopener" target="_blank">VS Code Forge Tools での環境変更</a></p>
<p style="padding-left: 40px;"><a href="https://adndevblog.typepad.com/technology_perspective/2021/09/3-legged-oauth-on-vs-code-forge-tools.html" rel="noopener" target="_blank">VS Code Forge Tools での 3-legged OAuth</a></p>
<p>ここでは、AppBundle を使わずに、オートデスクが事前に用意した AutoCAD コアエンジン（Design Automation API fot AutoCAD）用の共有 Activity である <strong>AutoCAD.PlotToPDF.prod</strong>&#0160;を使って、OSS Bucket 内に用意した DWG ファイルを PDF ファイル化する例をご紹介したいと思います。</p>
<hr />
<ol>
<li>まず、<strong>AutoCAD.PlotToPDF.prod</strong> Activity の内容（登録されている定義）を見てみます。VS Code の画面左手のアクティビティバーから Forge アイコンを選択して、Forge パネル下（VS Code 画面左下）の <strong>DESIGN AUTOMATION</strong> ペインから <strong>Shared Activities</strong> を見つけてクリックします。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3bb8113200b-pi" style="display: inline;"><img alt="Shared_activities" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3bb8113200b image-full img-responsive" src="/assets/image_529400.jpg" title="Shared_activities" /></a></li>
<li>表示された共有 Activity のリストから <strong>AutoCAD.PlotToPDF.prod</strong> を見つけたら、マウスの右ボタンをクリックして <strong>View Activity Details</strong> を選択します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3bb8142200b-pi" style="display: inline;"><img alt="Plottopdf" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3bb8142200b image-full img-responsive" src="/assets/image_373795.jpg" title="Plottopdf" /></a></li>
<li>AutoCAD.PlotToPDF.prod Activity の詳細が表示されて、その仕様を把握することが出来ます。<strong>Parameters</strong> セクションを見ると、処理対象の素材ファイルが <strong>DWG ファイル</strong>（ストレージから get）、成果ファイルが <strong>result.pdf</strong> の固定名（ストレージへ post）である点、<strong>Steeings</strong> セクションを見ると、WorkItem が実行する <strong>Script</strong> が <strong>Values</strong> 値にある <strong>_tilemode 0 -export _pdf _all result.pdf</strong> （EXPORT コマンドで全レイアウトを PDF 出力）になっている点が理解出来ます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e08f200c-pi" style="display: inline;"><img alt="Plottopdf_details" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e08f200c image-full img-responsive" src="/assets/image_83982.jpg" title="Plottopdf_details" /></a></li>
<li>WorkItem が処理する素材ファイルの取得元と成果ファイルの保存先になる Bucket を作成します。<strong>BUCKET ＆ DERIVATIVES</strong> 右の <strong>＋</strong> アイコンをクリック後、Bucket 名を入力してリターンキーで Bucket を作成します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e402200c-pi" style="display: inline;"><img alt="Create_bucket" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e402200c image-full img-responsive" src="/assets/image_703697.jpg" title="Create_bucket" /></a></li>
<li>作成した Bucket に素材ファイルの DWG ファイルをアップロードします。Bucket 名をマウス右ボタンでメニュー表示させたら、<strong>Upload Object</strong> を選択して、ローカル コンピュータ上の DWG ファイルを指定、アップロードします。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02a308dcf02c200c-pi" style="display: inline;"><img alt="Upload_object" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02a308dcf02c200c image-full img-responsive" src="/assets/image_610730.jpg" title="Upload_object" /></a></li>
<li>Workitem が Bucket に保存する成果ファイルの署名付き URL を得るために、中身のない空の PDF ファイルを用意します。 Bucket 名をマウス右ボタンでメニュー表示させてから <strong>Create Empty&#0160;Object</strong> を選択して、固定名 <strong>result.pdf</strong> を入力します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02a2eed2fec2200d-pi" style="display: inline;"><img alt="Create_empty_object" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02a2eed2fec2200d image-full img-responsive" src="/assets/image_330713.jpg" title="Create_empty_object" /></a></li>
<li><strong>AutoCAD.PlotToPDF.prod</strong> Activity を使った Workitem を実行します。<strong>DESIGN AUTOMATION</strong> ペインの <strong>Shared Activities</strong> の共有 Activity のリストから <strong>AutoCAD.PlotToPDF.prod</strong> を見つけたら、マウスの右ボタンメニューから <strong>Create Workitem</strong>&#0160;をクリックします。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e04f200c-pi" style="display: inline;"><img alt="Create_workitem" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e04f200c image-full img-responsive" src="/assets/image_988402.jpg" title="Create_workitem" /></a></li>
<li><strong>AutoCAD.PlotToPDF.prod</strong> Activity の入出力パラメータにあわせた Workitem ページが表示されます。HostDwg の Value 値に素材ファイルの署名付き URL（Signed URL）を、Result の Value 値に成果ファイル（この Activity では result.pdf）の署名付き URL を、それぞれ指定していきます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02dad0cbb033200d-pi" style="display: inline;"><img alt="Workitem" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02dad0cbb033200d image-full img-responsive" src="/assets/image_332878.jpg" title="Workitem" /></a></li>
<li>作成した Bucket の素材ファイル上をマウス右ボタンでメニュー表示させて、<strong>Generate Signed URL</strong> を選択します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e2fd200c-pi" style="display: inline;"><img alt="Generate_signed_url" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e2fd200c image-full img-responsive" src="/assets/image_83721.jpg" title="Generate_signed_url" /></a></li>
<li>次の画面が表示されたら、<strong>read</strong> をクリックします。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02dad0cbb2da200d-pi" style="display: inline;"><img alt="Signed_url_read" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02dad0cbb2da200d image-full img-responsive" src="/assets/image_123657.jpg" title="Signed_url_read" /></a></li>
<li>画面の右下に「Signed URL」通知が表示されるので、[Copy URL to Clipboard] ボタンをクリックして生成された署名付き URL をクリップボードにコピー、HostDwg の Value 値に Ctrl＋V のキーボード操作で貼り付けます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3bb83f1200b-pi" style="display: inline;"><img alt="Copy_signed_url" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3bb83f1200b image-full img-responsive" src="/assets/image_809717.jpg" title="Copy_signed_url" /></a></li>
<li>同様に、成果ファイル result.pdf の署名付き URL を生成します。result.pdf上をマウス右ボタンで メニュー表示させて、<strong>Generate Signed URL</strong> を選択します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e321200c-pi" style="display: inline;"><img alt="Generate_signed_url2" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e321200c image-full img-responsive" src="/assets/image_21434.jpg" title="Generate_signed_url2" /></a></li>
<li>次の画面が表示されたら、<strong>write</strong>&#0160;をクリックします。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3bb8418200b-pi" style="display: inline;"><img alt="Signed_url_write" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3bb8418200b image-full img-responsive" src="/assets/image_694806.jpg" title="Signed_url_write" /></a></li>
<li>画面の右下に「Signed URL」通知が表示されるので、[Copy URL to Clipboard] で生成された署名付き URL をクリップボードにコピー、Result の Value 値に貼り付けます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e329200c-pi" style="display: inline;"><img alt="Copy_signed_url2" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e329200c image-full img-responsive" src="/assets/image_141792.jpg" title="Copy_signed_url2" /></a></li>
<li>Result の Verb（動作）を既定値の POST から <strong>PUT</strong>&#0160;に変更したら、 2つのパラメーターにチェックして、[Create] ボタンをクリックして WorkItem を実行します。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02c8d3b7e017200c-pi" style="display: inline;"><img alt="Run_workitem" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02c8d3b7e017200c image-full img-responsive" src="/assets/image_822293.jpg" title="Run_workitem" /></a></li>
<li>WorkItem の実行が終了すると、画面右下に通知が表示されます。[View Report] ボタンをクリックするとログを表示させることが出来ます。通知は WorkItem 実行が失敗した際にも表示されるので、ログの内容を参照して失敗の原因を調べるすることが出来ます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02dad0cbafc4200d-pi" style="display: inline;"><img alt="View_report" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02dad0cbafc4200d image-full img-responsive" src="/assets/image_53800.jpg" title="View_report" /></a></li>
<li>Workitem が処理した result.pdf は <strong>Download Objec</strong>t でダウンロードすることが出来ます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02dad0cbb31d200d-pi" style="display: inline;"><img alt="Download_object" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02dad0cbb31d200d image-full img-responsive" src="/assets/image_285423.jpg" title="Download_object" /></a></li>
<li>素材ファイルの全レイアウトを出力した PDF ファイルを確認することが出来ます。<br /><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02a30d4a5940200b-pi" style="display: inline;"><img alt="Generated_pdf" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02a30d4a5940200b image-full img-responsive" src="/assets/image_804912.jpg" title="Generated_pdf" /></a></li>
</ol>
<hr />
<p>もちろん、独自に Activity や AppBundle を登録したり、それらの Workitem 実行のテスト可能です。JSON ファイルに格納したパラメータ ファイルを Bucket に保存しておけば、署名付き URLを使って Workitem に渡し、テストすることも出来ます。</p>
<p>By Toshiaki Isezaki</p>
