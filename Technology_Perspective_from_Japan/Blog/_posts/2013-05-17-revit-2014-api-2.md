---
layout: "post"
title: "Revit 2014 API の新機能 - その２"
date: "2013-05-17 00:19:00"
author: "Mikako Harada"
categories:
  - "API カスタマイズ"
  - "デスクトップ製品"
original_url: "https://adndevblog.typepad.com/technology_perspective/2013/05/revit-2014-api-%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD-%E3%81%9D%E3%81%AE%EF%BC%92.html "
typepad_basename: "revit-2014-api-の新機能-その２"
typepad_status: "Publish"
---

<p>このところ、サンフランシスコ、ニューヨークと出張続きで、私のブログポストに間があいてしまいましたが、<a href="http://adndevblog.typepad.com/technology_perspective/2013/04/revit-2014-api-%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD.html" target="_self" title="Revit2014API-Part1">以前、前半としてご紹介したRevit 2014 APIの新機能</a>の続きをようやくここでご紹介したいと思います。</p>
<p>強化点としての新機能は、今リリースでは、大きく次の4つの分野に焦点がおかれていることを以前のポストでお話しました：</p>
<ul>
<li>統合（インテグレーション）</li>
<li>ドキュメンテーション</li>
<li>モデリング</li>
<li>コーディネーション</li>
<li>その他</li>
</ul>
<p>今回は、4番目の項目、コーディネーションとその他の分野のAPI の強化点の概要を見ていきたいと思います。</p>
<p><span style="text-decoration: underline;">コーディネーション</span></p>
<ul>
<li>ドキュメント オープン オプション</li>
<li>ドキュメント保存</li>
<li>ワークシェアリング API</li>
<li>リンクの操作とプロパティ API</li>
<li>リンクAPIに影響を与える操作</li>
<li>インポート・エクスポートAPI</li>
<li>カスタム エクスポート</li>
<li>コピー＆ペースト API</li>
</ul>
<p>&#0160;</p>
<p>ドキュメント オープン オプション</p>
<p>Revitのファイルを開く際に、いくつかのオプションがありますが、それらを指定できるようになりました。 具体的には、</p>
<ul>
<li>OpenOption.Audit －ファイルの破損の有無を確認するために、すべての要素を展開するかどうかを指定します。デフォルトはfalse。</li>
<li>OpenOptions.AllowOpeningLocalByWrongUser －ローカルファイルが、その所有者以外のユーザーによってReadOnlyで開くことを許可するかどうかを指定します。</li>
<li>OpenOptions.GetOpenWorksetsConfiguration()/ OpenOptions.SetOpenWorksetsConfiguration() －ドキュメントを開いたときに、どのユーザーが作成したワークセットをオープン/クローズされるべきかを指定するためにWorksetConfigurationにアクセスします。</li>
</ul>
<p>&#0160;</p>
<p>また、ドキュメント保存のオプションとしては、</p>
<ul>
<li>Document.Save()　 
<ul>
<li>SaveOptions.Compact&#0160; -&#0160; OS がディスク上のファイルから、全ての不要なデータを排除するべきかどうかを指定します。</li>
</ul>
</li>
<li>Document.SaveAs() 
<ul>
<li>SaveAsOptions.MaximumBackups&#0160; - &#0160;ディスク上に保存するバックアップの最大数を指定します。</li>
<li>SaveAsOptions.Compact&#0160; - OS がディスク上のファイルから、全ての不要なデータを排除するべきかどうかを指定します。</li>
<li>新しいプロパティ SaveAsOptions.WorksharingOptions はワークシェアファイルに固有のオプションを提供します: 
<ul>
<li>WorksharingSaveAsOptions.SaveAsCentral</li>
<li>WorksharingSaveAsOptions.OpenWorksetsDefault</li>
<li>WorksharingSaveAsOptions.ClearTransmitted</li>
</ul>
</li>
<li>新しいメソッド: SaveAs(ModelPath, SaveAsOptions)　が用意されました。</li>
</ul>
</li>
</ul>
<p>ワークシェアリング API は、今リリースで強化された大きな点です。以下が追加されました：</p>
<ul>
<li>最新ファイルのの再ロード 
<ul>
<li>Document.ReloadLatest()</li>
<li>Document.HasAllChangesFromCentral()</li>
</ul>
</li>
<li>セントラルファイルとの同期 
<ul>
<li>&#0160;Document.SynchronizeWithCentral()&#0160;</li>
</ul>
</li>
<li>要素のオーナシップ 
<ul>
<li>WorksharingUtils.CheckoutElements()</li>
<li>WorksharingUtils.CheckoutWorksets()</li>
<li>WorksharingUtils.RelinquishOwnership()</li>
</ul>
</li>
<li>新規のローカルファイルの作成 
<ul>
<li>WorksharingUtil.CreateNewLocal()</li>
</ul>
</li>
<li>ワークシェアリングの有効化　 
<ul>
<li>Document.EnableWorksharing()</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>リンクの操作とプロパティ API</p>
<ul>
<li>リンクのロードおよびアンロード 
<ul>
<li>RevitLinkType.Load()</li>
<li>RevitLinkType.LoadFrom()</li>
<li>RevitLinkType.Unload()</li>
</ul>
</li>
<li>リンクと共有座標の変更</li>
<li>リンクパスのタイプの設定</li>
<li>新しいリンクを作成する際に、ワークセットが開くように指定</li>
</ul>
<p>&#0160;</p>
<p>リンクAPIに影響を与える操作</p>
<ul>
<li>リンクされたドキュメントを識別 
<ul>
<li>Document.IsLinked</li>
</ul>
</li>
<li>リンクされたドキュメントを取得 
<ul>
<li>RevitLinkInstance.GetLinkedDocument()</li>
</ul>
</li>
<li>リンクされた部屋から部屋タグを作成</li>
<li>リンクで要素選択（Pick)</li>
<li>
<p>リンクとホストの間の幾何学的な参照の変換&#0160;</p>
<ul>
<li>
<p>幾何学的な解析（部屋の境界）のような操作を容易にします。</p>
</li>
<li>面ベースのファミリーインスタンスの配置</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>インポート・エクスポートAPI</p>
<ul>
<li>SATファイルのインポート/リンク </li>
<li>SketchUpファイルインポート/リンク　</li>
<li>DWF マークアップインポート</li>
<li>Navisworksファイルエクスポート　</li>
<li>テーブルコンテンツのエクスポート 　 
<ul>
<li>ExportLayerTable</li>
<li>ExportLinetypeTable</li>
<li>ExportFontTable</li>
<li>ExportPatternTable</li>
<li>ExportLineweightTable 
<ul>
<li>DWG、IFCとDGN などの様々なフォーマットにマッピングするために使用されるテーブルへのアクセス。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>カスタム エクスポート</p>
<ul>
<li>CustomExporter 
<ul>
<li>Revitのレンダリング出力パイプラインへのアクセス。</li>
<li>カスタムエクスポートコンテキストを介して3Dビューをエクスポート可能</li>
</ul>
</li>
<li>
<p>IExportContext </p>
<ul>
<li>出力は、Revit上で表示されているのと全く同様にモデルを表現。</li>
<li>すべてのジオメトリとマテリアルプロパティが含まれる。</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>コピー＆ペースト API</p>
<ul>
<li>ElementTransformUtils.CopyElements(Document, ICollection&lt;ElementId&gt;, Document, Transform) 
<ul>
<li>文書内、または文書から文書へのコピーをサポート。</li>
</ul>
</li>
<li>
<p>ElementTransformUtils.CopyElements(View, ICollection&lt;ElementId&gt;, View, Transform) </p>
<ul>
<li>ビュー固有の要素のコピーをサポート</li>
</ul>
</li>
<li>
<p>ElementTransformUtils.GetTransformFromViewToView(View, View) </p>
<ul>
<li>二つのビュー間の座標変換を取得</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p><span style="text-decoration: underline;">その他 </span></p>
<p>これだけでは、ありません。その他の強化点としは、以下があります。</p>
<ul>
<li>マテリアル API</li>
<li>MEP API 機能強化</li>
<li>MEPの外部化された計算</li>
<li>MEP API の機能強化</li>
<li>拡張ストレージ</li>
<li>Add-ins</li>
<li>マクロ環境</li>
</ul>
<p>&#0160;</p>
<p>マテリアル API</p>
<ul>
<li>マテリアルに AppearanceAsset&#0160; を割り当てることができます。 
<ul>
<li>Material.AppearanceAssetId</li>
</ul>
</li>
<li>
<p>AppearanceAssetElements </p>
<ul>
<li>要素フィルタリングを介して見つけることが可能です。</li>
<li>AppearanceAssetElement.Create（） - 指定したレンダリング·アセットと名前から新しいアセット要素を作成できます。</li>
<li>AppearanceAssetElement.GetAppearanceAssetElementByNameは（） - 与えられた名前から、アセット要素のハンドルを取得できます。</li>
<li>AppearanceAssetElement.SetRenderingAssetは（） - 要素にレンダリング・アセットを設定します。</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>MEP API 機能強化</p>
<ul>
<li>ElectricalLoadClassificationData 
<ul>
<li>ElectricalLoadClassificationData は電気のパネルスケジュールの負荷分類部に対応するいくつかの新しい文字列型のプロパティを持ちます。</li>
</ul>
</li>
<li>
<p>CSVフィッティングパラメータの削除 </p>
<ul>
<li>CSVファイルは、もはやMEPフィッティングパラメータを駆動するために使用されていないため、Revitは、フィッティングパラメータを管理するための新しいAPIのセットをサポートします。</li>
</ul>
</li>
<li>
<p>フィッティング角度使用設定のAPI </p>
<ul>
<li>ダクト設定、パイプの設定、電気的設定用</li>
</ul>
</li>
<li>
<p>新しいダクト設定 </p>
<ul>
<li>サイズの接頭辞と接尾辞、注釈、空気密度と粘度。</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>MEPの外部計算</p>
<ul>
<li>外部サービスに基づいた新しいインタフェースとクラスが、パイプやダクトの計算のためにサポートされます： 
<ul>
<li>IPipePlumbingFixtureFlowServer</li>
<li>IPipePressureDropServer</li>
<li>IDuctPressureDropServer</li>
<li>IDuctFittingAndAccessoryPressureDropServer</li>
<li>IPipeFittingAndAccessoryPressureDropServer</li>
<li>IDuctFittingAndAccessoryPressureDropUIServer</li>
<li>IPipeFittingAndAccessoryPressureDropUIServer</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>MEP API の機能強化</p>
<ul>
<li>要素作成 
<ul>
<li>ダクト、パイプ、FlexDuct、そしてFlexPipeにはそれぞれのクラスでスタティックメソッドとして利用可能。</li>
</ul>
</li>
<li>
<p>ConnectorElement </p>
<ul>
<li>与えられた面の内部ループの中心にファミリのコネクタ要素を作成。</li>
<li>コネクタシステムタイプを取得(Get)</li>
<li>コネクタの方向を取得/設定(Get/Set)</li>
</ul>
</li>
<li>その他の機能強化</li>
</ul>
<p>&#0160;</p>
<p>拡張ストレージ</p>
<ul>
<li>ExtensibleStorage API の変更点 
<ul>
<li>Element.GetEntitySchemaGuids() 
<ul>
<li>要素上に存在するすべてのエンティティのスキーマのGUID</li>
</ul>
</li>
<li>Schema.GetField() / Schema.ListFields() 
<ul>
<li>Schemaで定義された読み取り許可に基づいて制限。</li>
</ul>
</li>
</ul>
</li>
<li>ExtensibleStorageFilter 
<ul>
<li>与えられたスキーマGUIDを持つエンティティを含む要素を見つけるためのElementQuickFilter。</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>Add-ins</p>
<ul>
<li>アクティブなセッションからアドインを自動ロード 
<ul>
<li>Revitを再起動せずに新しく追加されたアドインマニフェストファイルを読み込み自動的にアドインをロードすることが可能です。</li>
<li>セッションロードを行いたくない場合は.addin　ファイルで &lt;AllowLoadIntoExistingSession&gt; タグを使用。&#0160;</li>
<li>UIApplication.LoadAddIn() 
<ul>
<li>プログラムでマニフェストファイルからアドインを読み込むことが可能。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#0160;</p>
<p>マクロ環境</p>
<ul>
<li>Ruby/Python 環境 
<ul>
<li>マクロはC＃やVB.NETと同様にRubyやPythonでコーディングすることが可能</li>
</ul>
</li>
<li>
<p>マクロおよびマクロモジュールのAPI </p>
<ul>
<li>RevitAPIMacros.dllとRevitAPIUIMacros.dll</li>
<li>マクロモジュールをリスト/追加/削除</li>
<li>マクロをリスト/削除/作成/編集</li>
<li>マクロのセキュリティ設定にアクセス</li>
</ul>
</li>
</ul>
<p>今リリースも盛りだくさんなRevitAPIの新機能を列挙してみました。ぜひ試してみてください。</p>
<p>原田</p>
