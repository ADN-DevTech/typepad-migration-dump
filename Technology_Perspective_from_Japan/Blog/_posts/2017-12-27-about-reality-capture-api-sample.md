---
layout: "post"
title: "Reality Capture API サンプルについて"
date: "2017-12-27 00:18:40"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2017/12/about-reality-capture-api-sample.html "
typepad_basename: "about-reality-capture-api-sample"
typepad_status: "Publish"
---

<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09e2eefd970d-pi" style="float: right;"><img alt="API-REcap-Blue" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb09e2eefd970d img-responsive" src="/assets/image_953455.jpg" style="margin: 0px 0px 5px 5px;" title="API-REcap-Blue" /></a>既にご案内のとおり、Forge DevCon 2017 のタイミングで長らく Beta 扱いだった Reality Capture API が、正式に Forge Platform API としてサポートされるようになりました。サンプル コードも&#0160;GitHub 上の&#0160;<strong><a href="https://github.com/Autodesk-Forge/photo-to-3d-sample">https://github.com/Autodesk-Forge/photo-to-3d-sample</a></strong>&#0160;で公開されていますが、正式サポート時の仕様変更や ReCap Photo 製品の仕様変更等もあり、そのままダウンロードしてセットアップしても、残念ながら、うまく動作しないことが分かっています。</p>
<p>ここでは Beta 段階の Reality Capture API との変更点などを含め説明し、とりあえず、&#0160;<strong><a href="https://github.com/Autodesk-Forge/photo-to-3d-sample">https://github.com/Autodesk-Forge/photo-to-3d-sample</a></strong>&#0160;を動作させられるよう改修してみたいと思います。なお、この影響や矛盾から、このサンプルは今後改訂される可能性がありますのでご注意ください。</p>
<hr />
<p><strong>Reality Capture API の処理手順</strong></p>
<p>ご参考まで、現在、<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/overview/" rel="noopener noreferrer" target="_blank">デベロッパ ポータル</a></strong>で紹介されている Reality Capture API のおおまかな処理手順は次のとおりです。</p>
<ol>
<li><strong>画像イメージを撮影（準備）:</strong>&#0160;互いに重複するよう、対象物や景観をさまざまな角度、高さから撮影して Jpeg 画像を用意</li>
<li><strong>Reality Capture Forge API で認証:</strong>&#0160;Reality Capture API を利用する Forge クライアント（3rd Party アプリ）でユーザ認証を得る</li>
<li><strong>画像イメージをアップロード:</strong>&#0160;HTTPS アクセス可能なクラウド ストレージ（AWS S3）にアップロード</li>
<li><strong>フォトシーンの作成:</strong>&#0160;処理オプションなどを指定して新規にフォトシーンを作成</li>
<li><strong>フォトシーンへに画像イメージを関連付け:</strong>&#0160;既存の URL リンクを参照するか（3. による）、直接、撮影した画像イメージをアップロード</li>
<li><strong>フォトシーンの処理を開始:</strong>&#0160;撮影した画像イメージの合成処理をリクエストして 3D メッシュを生成開始</li>
<li><strong>処理ステータスをチェック:</strong>&#0160;処理の進捗状況をリクエストしてチェック</li>
<li><strong>処理完了の通知を得るコールバックを受諾:</strong>&#0160;処理終了後に Email、または、HTTP/HTTPS コールバックを介して通知を受信</li>
<li><strong>生成結果を評価/ダウンロード:</strong>&#0160;生成された出力結果のリンクをリクエストして、3D メッシュやオルソ画像をダウンロード</li>
</ol>
<hr />
<p><strong>Beta 時からの変更点</strong>&#0160;</p>
<p style="padding-left: 30px;">約 3 年の間 Private Beta の扱いを受けていた Reality Capture API ですが、正式サポートにあたって次の点が変更されることになります。なお、使用する endpoint に変更はありません。</p>
<ul>
<li>写真から 3D オブジェクトの生成時、生成されたシーンは&#0160;<strong>ReCap 360 サービス（<a href="https://recap.autodesk.com/" rel="noopener noreferrer" target="_blank">https://recap.autodesk.com/</a>）</strong>上にも表示され、閲覧が出来る。</li>
<li>同じくに含まれる RCM ファイル、OBJ ファイルなどのファイル群は、<strong>A360 ドライブ（<a href="https://a360.autodesk.com/drive/" rel="noopener noreferrer" target="_blank">https://a360.autodesk.com/drive</a>）</strong>上に指定したシーン名でフォルダが作成され、個別にダウンロード出来る。</li>
<li>ReCap 360、A360 ドライブ とも、ユーザの Autodesk ID でサインインしたアカウントのみアクセス可能なことから、Reality Capture API を利用するアプリは、3-leggeed OAuth で取得する Access Token が必要となる。また、そのため、デベロッパ ポータルでのアプリ登録時には正しい Callback URL の設定が必須となり、同実装も必要。</li>
<li><strong><a href="https://developer.api.autodesk.com/photo-to-3d/v1/photoscene" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/photo-to-3d/v1/photoscene</a></strong>&#0160;endpoint 呼び出しで指定可能なオプション内容（新エンジン Taitan 時と異なる）。</li>
<li><strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/reference/http/file-POST/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/photo-to-3d/v1/file</a></strong> endpoint 呼び出しで画像ファイルをアップロードする際には、次の点で制限があります。<br />・<strong>JPEG</strong>&#0160;画像ファイルのみをサポート<br />・一回の endpoint 呼び出しでアップロード出来るファイル数は最大で 20（10 を推奨）<br />・画像ファイル 1 つの最大サイズは&#0160; 128 MB<br />・メモリ内に画像の非圧縮サイズ最大サイズは 512 MB</li>
</ul>
<p style="padding-left: 30px;">現時点では、下記の ReCap クラウド サービスで新規に写真プロジェクトを作成出来ない、との仕様変更にともない、Reality Capture API で生成されたシーンは ReCap 360、A360 ドライブには表示されなくなっています。写真プロジェクトの作成は、過去に&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2013/10/recap-photo-cloud-service.html" rel="noopener noreferrer" target="_blank">ReCap 360 クラウドサービス（旧名 ReCap Photo）</a></strong>でご紹介した方法は利用出来ません。</p>
<p style="padding-left: 30px;"><img alt="Recap360" border="0" class="asset asset-image at-xid-6a0167607c2431970b01b7c93fdaf4970b image-full img-responsive" src="/assets/image_971555.jpg" title="Recap360" /></p>
<p style="padding-left: 30px;">紛らわしくて恐縮なのですが、この時点で<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/05/autodesk-remake-released.html" rel="noopener noreferrer" target="_blank"> Autodesk ReMake </a></strong>が Autodesk ReCap Pro に統合され廃止されています。ReCap Pro 内には、同 Subscription でお使いいただける ReCap Photo が用意され（旧 ReCap 360 への名称変更前の ReCap Photo クラウド サービスとは異なる）、写真プロジェクトを新規作成出来るようになっています。</p>
<p style="padding-left: 30px;">つまり、Reality Capture API 利用にはユーザ アカウント領域へのアクセスは必須ではなくなっています。このため、3-leggeed OAuth やアプリ登録時の&#0160;Callback URL の設定が不要になります。</p>
<hr />
<p><strong>サンプルの修正手順</strong></p>
<p style="padding-left: 30px;"><strong><a href="https://github.com/Autodesk-Forge/photo-to-3d-sample">https://github.com/Autodesk-Forge/photo-to-3d-sample</a></strong>&#0160;サンプルは、旧仕様に基づいて作成されているため、3-leggeed OAuth を利用し、デベロッパ ポータルでのアプリ登録時の Callback URL 設定が必要です、仕様変更でこれらは必須でななくなったため、冗長な実装になりますが、最小の変更で動作させるため、ここではそのまま利用することにします。</p>
<ol>
<li>git for Windows と Node.js をインストールされていない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/01/development-environment-for-forge.html" rel="noopener noreferrer" target="_blank">Forge の開発環境</a></strong>&#0160;の内容をご確認の上、アカウント取得とインストールを完了させてください。</li>
<li>Forge を利用するために必要な Client ID と Client Secret（別名 Consumer Key と Consumer Secret）を取得していない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/07/app-registration-and-getting-keys-for-forge-api.html" rel="noopener noreferrer" target="_blank">Forge API を利用するアプリの登録とキーの取得</a>&#0160;</strong>の内容に沿って、キーを取得してください。この時、アプリ登録の API 指定には <strong>Reality Capture API</strong> を、Callback URL には <strong>http://localhost.autodesk.com/callback&#0160;</strong>を指定してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09e2f017970d-pi" style="display: inline;"><img alt="My_app_regist" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb09e2f017970d image-full img-responsive" src="/assets/image_674493.jpg" title="My_app_regist" /></a></li>
<li><strong><a href="https://github.com/Autodesk-Forge/photo-to-3d-sample" rel="noopener noreferrer" target="_blank">https://github.com/Autodesk-Forge/photo-to-3d-sample</a></strong> リポジトリ&#0160;ページを Web ブラウザで表示して、コピー対象の URL をページ上でクリップボードにコピーします。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c93fdc88970b-pi" style="display: inline;"><img alt="Github_repo" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c93fdc88970b image-full img-responsive" src="/assets/image_26522.jpg" title="Github_repo" /></a></li>
<li><strong>コマンド プロンプト</strong>&#0160;を起動後、<strong>cd documents</strong>&#0160;と入力してカレント フォルダを Documents フォルダに変更します。</li>
<li>git clone コマンドでクリップ ボードにコピーした&#0160;URL をパラメータに指定して、<strong><a href="https://github.com/yochiyochirb/meetups/wiki/clone-a-repository" rel="noopener noreferrer" target="_blank">リポジトリ</a>&#0160;</strong>の内容をクライアント コンピュータにコピーします。具体的には、<strong>git clone&#0160;https://github.com/Autodesk-Forge/photo-to-3d-sample.git&#0160;</strong>と入力してください。リポジトリのコピーが始まります。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2ca2e42970c-pi" style="display: inline;"><img alt="Git_clone" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d2ca2e42970c image-full img-responsive" src="/assets/image_902113.jpg" title="Git_clone" /></a></li>
<li>C:\Users\&lt;<em>Windows ログイン ユーザ名</em>&gt;\Documents フォルダ（ドキュメント フォルダ）直下に photo-to-3d-sample フォルダが作成されていることを確認の上、コマンド プロンプトで&#0160;<strong>cd photo-to-3d-sample</strong>&#0160;と入力してカレント フォルダを変更してください。</li>
<li>続いて、<strong><a href="https://ja.wikipedia.org/wiki/Npm_(%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E7%AE%A1%E7%90%86%E3%83%84%E3%83%BC%E3%83%AB)" rel="noopener noreferrer" target="_blank">ノード パッケージ マネージャ（npm）</a></strong>を利用し、package.json 内に記載された依存関係に沿って 、Node.js 機能を拡張するパッケージ（ミドルウェア）をインストールしていきます。&#0160;<strong>npm install</strong>&#0160;と入力してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09e2f095970d-pi" style="display: inline;"><img alt="Npm_inst" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb09e2f095970d image-full img-responsive" src="/assets/image_777805.jpg" title="Npm_inst" /></a></li>
<li>Node パッケージは photo-to-3d-sample フォルダ直下に新しく作られた&#0160;node_modules フォルダにインストールされます。念のため、同フォルダが作成されていることを確認してください。</li>
<li>このサンプルでは、Web サーバーを構築する目的で Node.js を利用します。ここでは、<strong>phototo3d.js</strong>&#0160;を Adobe Brackets で開いて、下記の<span style="color: #0000ff;"><strong>青字部分</strong></span>を<strong>&#0160;</strong>2. で取得済の Client ID と Client Secret で置き換えます。<br />
<pre>var express = require(&#39;express&#39;);var express = require(&#39;express&#39;);<br />var bodyParser = require(&#39;body-parser&#39;);<br />var favicon = require(&#39;serve-favicon&#39;);<br />var async = require(&#39;async&#39;);<br />var unirest = require(&#39;unirest&#39;);<br />var ejs = require(&#39;ejs&#39;);<br /><br />var app = express();<br />app.use(bodyParser.json ());<br />app.use(express.static (__dirname + &#39;/www&#39;));<br />app.use(favicon (__dirname + &#39;/www/images/favicon.ico&#39;));<br />app.set(&#39;view engine&#39;, &#39;ejs&#39;);<br /><br />var client_id = &#39;<span style="color: #0000ff;"><strong>&lt;REPLACE_WITH_FORGE_CLIENT_ID&gt;</strong></span>&#39;;<br />var client_secret = &#39;<span style="color: #0000ff;"><strong>&lt;REPLACE_WITH_FORGE_CLIENT_SECRET&gt;</strong></span>&#39;;<br />var access_token = &#39;&#39;;<br />var redirect_uri = &#39;http://localhost.autodesk.com/callback&#39;;</pre>
</li>
<li>app ルーティング定義内の<span style="color: #00bf00;"><strong>赤字</strong></span>の JSON.parse 行を<strong><span style="color: #0000ff;">青字</span></strong>行で置き換えます。下記コードでは JSON.parse をコメント化しています。<br />
<pre>app.get(&#39;/app&#39;, function (req, res) {app.get(&#39;/app&#39;, function (req, res) {<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<strong><span style="color: #00bf00;">&#0160;//var json = JSON.parse (response.body.toString().trim());</span></strong><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #0000ff;"><strong>var json = response.body;</strong></span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />});</pre>
</li>
<li>/app/createscene ルーティング定義内の<span style="color: #00bf00;"><strong>赤字</strong></span>の JSON.parse 行を<strong><span style="color: #0000ff;">青字</span></strong>行で置き換えます。下記コードでは JSON.parse をコメント化しています。また、同様に RCM ファイルの生成を指定している&#0160;&#39;format&#39;: &#39;rcm&#39; 行を検証しやすい OBJ ファイル指定に変更します。ここでは、<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/reference/http/photoscene-POST/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/photo-to-3d/v1/photoscene</a></strong> endpoint を呼び出して、フォトシーンを作成しています<br />
<pre>app.get(&#39;/app/createscene&#39;, function (req, res) {app.get(&#39;/app&#39;, function (req, res) {<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;.send ({<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#39;scenename&#39;: sceneName,<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #00bf00;"><strong>//&#0160;&#39;format&#39;: &#39;rcm&#39;</strong></span><br /><span style="color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#39;format&#39;: &#39;obj&#39;</strong></span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;})<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<strong><span style="color: #00bf00;">//var json = JSON.parse (response.body.toString().trim());</span></strong><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<strong>var json = response.body;</strong><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />});</pre>
</li>
<li>/app/post ルーティング定義内の<span style="color: #00bf00;"><strong>赤字</strong></span>の JSON.parse 行を<span style="color: #0000ff;"><strong>青字</strong></span>行で置き換えます。下記コードでは JSON.parse をコメント化しています。ここでは&#0160;<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/reference/http/file-POST/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/photo-to-3d/v1/file</a></strong> endpoint を呼び出して、AWS S3 にポストされている画像イメージとフォトシーンの関連付けをしています。<br />
<pre>app.get(&#39;/app/post&#39;, function (req, res) {app.get(&#39;/app&#39;, function (req, res) {<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br /><strong><span style="color: #00bf00;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;//var json = JSON.parse (response.body.toString().trim());</span></strong><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #0000ff;"><strong>var json = response.body;</strong></span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />});</pre>
</li>
<li>/app/results ルーティング定義内の<span style="color: #00bf00;"><strong>赤字</strong></span>の JSON.parse 行を<span style="color: #0000ff;"><strong>青字</strong></span>行で置き換えます。下記コードでは JSON.parse をコメント化しています。また、同様に RCM ファイルの生成有無を指定している var endpoint = BASE_ENDPOINT + &#39;/photoscene/&#39; + sceneId + &#39;?format=rcm&#39;; 行を OBJ ファイル指定に変更します。ここでは&#0160;<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/reference/http/photoscene-:photosceneid-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/photo-to-3d/v1/photoscene/:photosceneid</a></strong> endpoint を使って、OBJ ファイルの生成をチェックしています。（このサンプルでは通知コールバックでの処理終了検出はしていません。）<br />
<pre>app.get(&#39;/app/results&#39;, function (req, res) {app.get(&#39;/app&#39;, function (req, res) {<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />&#0160;&#0160;&#0160;&#0160;<span style="color: #00bf00;"><strong>//var endpoint = BASE_ENDPOINT + &#39;/photoscene/&#39; + sceneId + &#39;?format=rcm&#39;;</strong></span><br /><span style="color: #0000ff;"><strong>&#0160;&#0160;&#0160;&#0160;var endpoint = BASE_ENDPOINT + &#39;/photoscene/&#39; + sceneId + &#39;?format=obj&#39;;</strong></span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br /><strong><span style="color: #00bf00;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;//var json = JSON.parse (response.body.toString().trim());</span></strong><br /><span style="color: #0000bf;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<strong>var json = response.body;</strong></span><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;：<br />});</pre>
</li>
<li>お使いになるクライアント コンピュータの Node.js で Callback URL が正しく認識されるよう、Windows の Hosts ファイルにホスト名を追記します（参考：<a href="https://support.microsoft.com/ja-jp/kb/972034" rel="noopener noreferrer" target="_blank">https://support.microsoft.com/ja-jp/kb/972034</a>）。<span style="text-decoration: underline;"><strong>管理者権限で起動した</strong></span>メモ帳で C:\Windows\System32\drivers\etc フォルダ直下 \hosts &#0160;を開いて、最後に次の<strong><span style="color: #0000ff;">青字</span></strong>の 1 行 <strong><span style="color: #0000ff;">127.0.0.1 localhost.autodesk.com</span>&#0160;</strong>を追加して上書き保存します。
<pre># Copyright (c) 1993-2009 Microsoft Corp.<br />#<br /># This is a sample HOSTS file used by Microsoft TCP/IP for Windows.<br />#<br /># This file contains the mappings of IP addresses to host names. Each<br /># entry should be kept on an individual line. The IP address should<br /># be placed in the first column followed by the corresponding host name.<br /># The IP address and the host name should be separated by at least one<br /># space.<br />#<br /># Additionally, comments (such as these) may be inserted on individual<br /># lines or following the machine name denoted by a &#39;#&#39; symbol.<br />#<br /># For example:<br />#<br /># 102.54.94.97 rhino.acme.com # source server<br /># 38.25.63.10 x.acme.com # x client host<br /><br /># localhost name resolution is handled within DNS itself.<br /># 127.0.0.1 localhost<br /># ::1 localhost<br /><span style="color: #0000ff;"><strong>127.0.0.1 localhost.autodesk.com</strong></span></pre>
。</li>
<li>（オプション）photo-to-3d-sample フォルダ直下の www フォルダ内の<strong>&#0160;index.html</strong> と、views フォルダの&#0160;<strong>explore.ejs</strong>&#0160;には、Forge Viewer で利用していたライブラリ参照が含まれています。このサンプルでは表示はおこないませんので、それぞれを Adobe Brackets で開いて次の<strong><span style="color: #00bf00;">赤字</span></strong>&#0160;3 行を削除、あるいは、コメント化することをお勧めします。<br />
<pre> &lt;!-- Autodesk View &amp; Data API --&gt;<br /><span style="color: #00bf00;"><strong> &lt;link rel=&quot;stylesheet&quot; href=&quot;https://autodeskviewer.com/viewers/2.5/style.min.css&quot; /&gt;</strong></span><br /> &lt;!-- script src=&quot;https://autodeskviewer.com/viewers/2.5/three.min.js&quot;&gt;&lt;/script --&gt;<br /><span style="color: #00bf00;"><strong> &lt;script src=&quot;https://autodeskviewer.com/viewers/2.5/viewer3D.min.js&quot;&gt;&lt;/script&gt;</strong></span><br /><br /> &lt;!-- Our scripts/css --&gt;<br /><span style="color: #00bf00;"><strong> &lt;link rel=&quot;stylesheet&quot; href=&quot;./view.css&quot;&gt;;</strong></span></pre>
</li>
</ol>
<hr />
<p><strong>サンプルの利用手順&#0160;</strong></p>
<ol>
<li>&#0160;コマンド プロンプトを起動してカレント フォルダを Documents フォルダに変更後、<strong>node phototo3d.js</strong>&#0160;と入力しても Web サーバーを起動します。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c93fdf0a970b-pi" style="display: inline;"><img alt="Node_run" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c93fdf0a970b image-full img-responsive" src="/assets/image_656277.jpg" title="Node_run" /></a></li>
<li>Google Chrome などの WebGL 互換 Web ブラウザを起動して、URL 欄に&#0160;<strong>http://localhost.autodesk.com</strong>&#0160;と入力、実行してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2ca303b970c-pi" style="display: inline;"><img alt="Authorize_me" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d2ca303b970c image-full img-responsive" src="/assets/image_102504.jpg" title="Authorize_me" /></a></li>
<li>Authorize me とリンクが表示されたら、それをクリックします。3-legded OAuth の処理が始まります。任意の Autodesk ID とそのパスワードを入力して、（実際には何もおこないませんが）アカウントのストレージ アクセスに対しての権限認可の確認画面が表示されます。[許可] をクリックしてください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09e31ef2970d-pi" style="display: inline;"><img alt="Authorize" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb09e31ef2970d image-full img-responsive" src="/assets/image_17471.jpg" title="Authorize" /></a></li>
<li>explore.ejs テンプレートによって次のページが表示されたら、「Name」欄にアルファベットでシーン名を入力し、[Create] ボタンをクリックします。</li>
<li>シーンが作成されると、「ID created」横にシーン ID を表示します。</li>
<li>次に [Post] ボタンをクリックして、サンプルが参照している AWS S3 上の Jpeg 画像の Reality Capture API へのダウンロードを実行します。</li>
<li>しばらく後に、「Nb posted」横の 7 個の Jpeg 画像のダウンロードが完了した意味の 7 と表示されます。</li>
<li>続いて、[Launch photoscene] ボタンをクリックして 3D オブジェクトの生成を開始します。正常に生成が開始されると、ボタンの下に Launched と表示されます。</li>
<li>3D 生成には時間がかかります。[Get Result]&#0160;ボタンをクリックすると、obj ファイルの有無を JSON で返します。<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/overview/error-codes/" rel="noopener noreferrer" target="_blank">エラー</a></strong>が表示される場合は、まだ演算中です。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c9401604970b-pi" style="display: inline;"><img alt="Test_steps" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c9401604970b image-full img-responsive" src="/assets/image_197788.jpg" title="Test_steps" /></a></li>
<li>時間をおいて何度か [Get Result]&#0160;ボタンをクリックした際に、次のような JSON が表示されたら、3D オブジェクトの生成が終了です。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c93fdf82970b-pi" style="display: inline;"><img alt="Test_result" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c93fdf82970b image-full img-responsive" src="/assets/image_960621.jpg" title="Test_result" /></a></li>
<li>この JSON に含まれる <strong>scenelink</strong>&#0160;の値が、生成された 3D オブジェクトのダウンロードリンクです。このリンクは 7 日間有効です。有効期間内に、Web ブラウザで、この URL を指定してクライアント側にファイル（この場合 obj.zip ファイル）ダウンロードすることが出来ます。</li>
<li>ダウンロードした obj.zip ファイルを<strong> A360 ドライブ</strong>にアップロードすると、Viewer 上で 3D オブジェクトを表示するこが出来ます。obj.zip ファイルは、プロジェクト ベースの A360 では変換・表示されませんので注意してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09e2f30d970d-pi" style="display: inline;"><img alt="Result" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb09e2f30d970d image-full img-responsive" src="/assets/image_277977.jpg" title="Result" /></a></li>
</ol>
<p style="padding-left: 30px;">この状態の&#0160;obj.zip ファイルを独自に Model Derivative API で変換すると、Forge Viewer 上に表示することも出来ます。表示時には <strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/12/mesh-representation-on-viewer.html" rel="noopener noreferrer" target="_blank">Viewer でのメッシュ状表示</a></strong> でご紹介した方法でメッシュ状に表示させることも可能です。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c9400b77970b-pi" style="display: inline;">&#0160; &#0160;&#0160;<img alt="Mesh_representation" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c9400b77970b image-full img-responsive" src="/assets/image_826040.jpg" title="Mesh_representation" /></a>&#0160;</p>
<hr />
<p><span style="background-color: #ffff00;">繰り返しますが、ここでご紹介したサンプルは現在、仕様変更にともなう矛盾を含んでいます。今後、内容が改訂される可能性がありますのでご注意ください。 変更、その他情報があった際には、このブログでお知らせします。</span></p>
<p><span style="background-color: #ff0000; color: #ffffff;">2018年2月1日追記：<strong><a href="https://developer.autodesk.com/en/docs/reality-capture/v1/overview/basics/" rel="noopener noreferrer" target="_blank">https://developer.autodesk.com/en/docs/reality-capture/v1/overview/basics/</a></strong>にある&#0160;Typical Photo to 3D Workflow の&#0160; <strong>9.Review/download processed output:</strong>&#0160;Request links to processed output. View generated 3D preview mesh and ortho image via mobile (remotely) via ReCap 360 Dashboard and other Forge services. の記述は、現在の Realoty Capture API には当てはまらないとのフィードバックが開発チームからありました。将来的に再度、A360 Drive や ReCap 360 からアクセス出来るようにする計画はあるようですが、実装の予定は未定だそうです。ご迷惑をお掛けして申し訳ございません。</span></p>
<p>By Toshiaki Isezaki</p>
