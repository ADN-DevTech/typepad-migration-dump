---
layout: "post"
title: "Postman による 3 legged 認証"
date: "2016-12-08 04:56:55"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2016/12/3-legged-authentication-on-postman.html "
typepad_basename: "3-legged-authentication-on-postman"
typepad_status: "Publish"
---

<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2299168970c-pi" style="float: left;"><img alt="Postman" class="asset  asset-image at-xid-6a0167607c2431970b01b8d2299168970c img-responsive" src="/assets/image_987865.jpg" style="margin: 0px 5px 5px 0px;" title="Postman" /></a></p>
<ul>
<li>（2023年8月追記）Authentication API（OAuth API）は v1 から v2 に移行しています。詳細は、<strong><a href="https://adndevblog.typepad.com/technology_perspective/2023/05/migration-guide-oauth2-v1-to-v2.html" rel="noopener" target="_blank">OAuth2 v1 から v2 への移行ガイド</a></strong> の記事を確認してください。Postman を使った 3 legged 認証については、<strong><a href="https://adndevblog.typepad.com/technology_perspective/2023/08/3lo-v2-on-postman.html" rel="noopener" target="_blank">Postman を使った 3-legged 認証・認可(OAuth v2)</a></strong>&#0160;をご参照ください。</li>
</ul>
<p><span style="text-decoration: line-through;">以前の&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/09/understanding-steps-to-use-viewer-on-postman.html" rel="noopener noreferrer" target="_blank">ブログ記事</a>&#0160;</strong>で <strong><a href="https://www.getpostman.com/" rel="noopener noreferrer" target="_blank">Postman</a></strong>&#0160;のコレクション機能を使って、最もシンプルな <strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/08/oauth-authentication-scenario-on-forge.html#_2-legged" rel="noopener noreferrer" target="_blank">2-legged 認証</a></strong> を利用した Bucket へのデザイン ファイルのアップロードと変換、 Viewer に表示までを、使用する&#0160;<a href="http://adndevblog.typepad.com/technology_perspective/2016/07/forge-api-glossary.html#_endpoint" rel="noopener noreferrer" target="_blank"><strong>endpoint</strong></a>&#0160;とともにご紹介しました。<span style="background-color: #ffff00;">（本記事は2022年5月更新）</span></span></p>
<p><span style="text-decoration: line-through;">今回は、同じ Postman コレクションを使って、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/08/oauth-authentication-scenario-on-forge.html#_3-legged" rel="noopener noreferrer" target="_blank">3-legged 認証</a>&#0160;</strong>と Viewer での表示までの手順を 2 回に渡ってご紹介していきたいと思います。</span></p>
<p><span style="text-decoration: line-through;">3-Legged 認証は、OSS に作成した Bucket 内のデザイン ファイルではなく、A360 や Fusion 360、BIM 360 などのオートデスクのクラウド サービスがアクセスするストレージ上のデザイン ファイルへのアクセスが目的となります。</span></p>
<p><span style="text-decoration: line-through;">繰り返しになりますが、2-Legged 認証との違いは、本来、Forge アプリがアクセス出来ないユーザ ストレージ領域へのアクセスを、ユーザからの明示的な権限付与によって可能にする点です。つまり、目的にデザイン ファイルが格納されているクラウド サービスへユーザにサインインしてもらってから、ユーザのストレージにアクセスする許可を得るプロセスが必要です。もちろん、使用する endpoint も 2-legged 認証のものとは異なります。</span></p>
<p><span style="text-decoration: line-through;">3-legged 認証では、Forge を利用するアプリは、次の手順に沿って Access Token（アクセス トークン）を取得します。 下図の 1. でユーザに A360 クラウド サービスにサインインするためのサインイン ページを表示させることになります。ここで使用する endpoint は&#0160;<strong><a href="https://developer.autodesk.com/en/docs/oauth/v2/reference/http/authorize-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/authentication/v1/authorize</a></strong>、メソッドは <strong>GET</strong> です。同じく、下図の 4. で使用する endpoint は <strong><a href="https://developer.autodesk.com/en/docs/oauth/v2/reference/http/gettoken-POST/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/authentication/v1/gettoken</a></strong>、メソッドは <strong>POST</strong> です。詳細は、過去のブログ記事<strong> <a href="http://adndevblog.typepad.com/technology_perspective/2016/08/oauth-authentication-scenario-on-forge.html" rel="noopener noreferrer" target="_blank">Forge での OAuth 認証シナリオ</a></strong>&#0160;の「3-legged 認証のワークフロー詳細」を確認ください。</span></p>
<p><span style="text-decoration: line-through;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2331bb3970c-pi" style="display: inline;"><img alt="Authorization" class="asset  asset-image at-xid-6a0167607c2431970b01b8d2331bb3970c img-responsive" src="/assets/image_663290.jpg" style="width: 1000px;" title="Authorization" /></a><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2331bb3970c-pi" style="display: inline;"></a></span></p>
<p><span style="text-decoration: line-through;">この認証プロセスでは、上図 3. の Callback URL でリダイレクトする実装が必要になります。今回は、この処理を Postman で実現するための設定と、Access Token を取得する部分をご紹介しておきます。</span></p>
<ol>
<li><span style="text-decoration: line-through;">Postman 上で 3 Legged 認証で使用する Callback URL は、<strong><a href="https://www.getpostman.com/oauth2/callback">https://www.getpostman.com/oauth2/callback</a></strong>&#0160;に設定する必要があります。まず、<strong><a href="https://forge.autodesk.com/" rel="noopener noreferrer" target="_blank">Forge ポータル（https://forge.autodesk.com）</a></strong>に新規にアプリを作成するか登録済のアプリを編集して、Callback URL を、この値に変更してください。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0278807af719200d-pi" style="display: inline;"> </a><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0282e153865e200b-pi" style="display: inline;"><img alt="Developer_portal_settings" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0282e153865e200b image-full img-responsive" src="/assets/image_590073.jpg" title="Developer_portal_settings" /></a></span></li>
<li><span style="text-decoration: line-through;">続いて、Postman 側で OAuth2 の 3 legged 認証の設定をしていきます。 Postman を起動して、新しいタブ上で「Authorization」を選択します。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02942fa8b18a200c-pi" style="display: inline;"><img alt="Postman_authirization_tab" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02942fa8b18a200c image-full img-responsive" src="/assets/image_566933.jpg" title="Postman_authirization_tab" /></a>&#0160;</span></li>
<li><span style="text-decoration: line-through;">「Authorization」タブ名の下にある Type には、ドロップダウン リストから「<strong>OAuth 2.0</strong>」を選択します。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02942fa8b1a0200c-pi" style="display: inline;"><img alt="Oauth2" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02942fa8b1a0200c image-full img-responsive" src="/assets/image_912254.jpg" title="Oauth2" /></a></span></li>
<li><span style="text-decoration: line-through;">画面右下の [Configuration Options] タブをスクロールして値を入力していきます。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02942fa8b27f200c-pi" style="display: inline;"><img alt="Postman_endpoint_and_type" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02942fa8b27f200c image-full img-responsive" src="/assets/image_585316.jpg" title="Postman_endpoint_and_type" /></a></span></li>
<li><span style="text-decoration: line-through;">[Configuration Options] タブの各項目に、次の値を入力していきます。</span><br /><span style="text-decoration: line-through;">- <strong>Token Name</strong> = Postman 上の保存名です。他の Postman コレクション名と同じく任意で結構です。</span><br /><span style="text-decoration: line-through;">- <strong>Grant Type</strong> = Authorization Code （固定）</span><br /><span style="text-decoration: line-through;">- <strong>Callback URL</strong> = https://www.getpostman.com/oauth2/callback（1. で指定）</span><br /><span style="text-decoration: line-through;">-<strong> Auth URL</strong> =&#0160;https://developer.api.autodesk.com/authentication/v1/authorize</span><br /><span style="text-decoration: line-through;">- <strong>Access Token URL</strong> = https://developer.api.autodesk.com/authentication/v1/gettoken</span><br /><span style="text-decoration: line-through;">- <strong>Client ID</strong> = Forge ポータルで作成したアプリ設定の&#0160;<strong>Client ID</strong></span><br /><span style="text-decoration: line-through;">- <strong>Client Secret</strong> = Forge ポータルで作成したアプリ設定の&#0160;<strong>Client Secret</strong></span><br /><span style="text-decoration: line-through;">- <strong>Scope</strong> = Forge アプリで必要となる<strong> Scope</strong> の値（例：data:read data:write data:create）</span><br /><span style="text-decoration: line-through;">- <strong>State</strong> = 未指定</span><br /><span style="text-decoration: line-through;">- <strong>Client Authentication</strong> = ”Send client credentials in body”</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0282e1538907200b-pi" style="display: inline;"><img alt="Get_new_access_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0282e1538907200b image-full img-responsive" src="/assets/image_57900.jpg" title="Get_new_access_token" /></a></span></li>
<li><span style="text-decoration: line-through;">ここまでの設定で、3 legged 認証の準備が整いました。<span style="background-color: #f47023;">&#0160;<span style="color: #ffffff; text-decoration: line-through;">[Get New Access Token] </span></span><span style="color: #ffffff; background-color: #ffffff; text-decoration: line-through;">&#0160;</span>ボタンをクリックしてみてください。Autodesk ID（ユーザ名）の入力を促す画面が表示されるはずです。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02942fa8b401200c-pi" style="display: inline;"><img alt="Enter_autodesk_id" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02942fa8b401200c image-full img-responsive" src="/assets/image_462597.jpg" title="Enter_autodesk_id" /></a></span></li>
<li><span style="text-decoration: line-through;">Autodesk ID を入力して&#0160;<span style="background-color: #0696d7; color: #ffffff; text-decoration: line-through;"> [ &#0160; &#0160; 次へ &#0160; ]&#0160;<span style="background-color: #ffffff;">&#0160;</span></span>をクリックすると、パスワードの入力画面に遷移します。&#0160;パスワードの入力後、<span style="background-color: #0696d7; color: #ffffff; text-decoration: line-through;"> [ &#0160; &#0160; サイン &#0160;イン &#0160; ]&#0160;<span style="background-color: #ffffff;">&#0160;</span></span>をクリックしてサインインを完了してください。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b022ad3e0c260200b-pi" style="display: inline;"> </a><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0282e1538aba200b-pi" style="display: inline;"><img alt="Enter_password" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0282e1538aba200b image-full img-responsive" src="/assets/image_422362.jpg" title="Enter_password" /></a><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b022ad3e0c260200b-pi" style="display: inline;"><br /></a></span></li>
<li><span style="text-decoration: line-through;">入力した Autodesk ID とパスワードで認証が完了すると、この Autodesk ID を持つユーザのストレージに Forge アプリがアクセスする許可を求められます。画面中央に表示されているアクセス権限は、5. で指定した Scope の内容に沿ったものとなります。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0278807afbba200d-pi" style="display: inline;"><img alt="Enter_authorize" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0278807afbba200d image-full img-responsive" src="/assets/image_469614.jpg" title="Enter_authorize" /></a></span></li>
<li><span style="text-decoration: line-through;"><span style="background-color: #0696d7; color: #ffffff; text-decoration: line-through;">&#0160;[ &#0160; &#0160;許可 &#0160; &#0160;] </span>をクリックすると、Forge アプリがユーザ ストレージにアクセスすることを許可（認可）したことになります。</span></li>
<li><span style="text-decoration: line-through;">取得出来た Access Token を含むダイアログが表示されます。<span style="background-color: #f26b00; color: #ffffff; text-decoration: line-through;">&#0160;[Use Token]&#0160;</span> をクリックします。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b02942fa8b509200c-pi" style="display: inline;"><img alt="Manage_access_token" border="0" class="asset  asset-image at-xid-6a0167607c2431970b02942fa8b509200c image-full img-responsive" src="/assets/image_141354.jpg" title="Manage_access_token" /></a></span></li>
<li><span style="text-decoration: line-through;">ここまでの処理で、「Access Token」欄に取得した Access Token の値が追加されているはずです。この値を利用して、RESTful 呼び出しで他の&#0160; endpoint のテストをおこなうことが出来ます。</span><br /><span style="text-decoration: line-through;"><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0282e1538ae4200b-pi" style="display: inline;"><img alt="Authorized" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0282e1538ae4200b image-full img-responsive" src="/assets/image_83699.jpg" title="Authorized" /></a></span></li>
</ol>
<p><span style="text-decoration: line-through;">&#0160;一度、使用した認証プロセスは、<strong>Token Name&#0160;</strong>名で再利用することが出来ます（ここでは Forge Access Token）。A360 などのストレージ アクセスを Postman でテストする場合は、ここまでの手順で Callback URL をした <strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/08/oauth-authentication-scenario-on-forge.html#_3-legged" rel="noopener noreferrer" target="_blank">3-legged 認証</a></strong><strong>&#0160;</strong>をシミュレーションすることが出来ます。次回、実際の endpoint を用いて、ストレージにアクセスしていきます。&#0160;</span></p>
<p>By Toshiaki Isezaki</p>
