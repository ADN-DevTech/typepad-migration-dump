---
layout: "post"
title: "View and Data API チュートリアル ～ その1 ～ Node.js Basic"
date: "2016-03-15 01:41:08"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2016/03/view-and-data-api-tutorial-part1-nodejs-basic.html "
typepad_basename: "view-and-data-api-tutorial-part1-nodejs-basic"
typepad_status: "Publish"
---

<p><span style="background-color: #ffff00;">ご注意：View and Data API は2016年6月に Viewer と &#0160;Model Derivative API に分離、及び、名称変更されました。</span></p>
<p>今回から、数回に渡って GitHub で公開されている <strong><a href="https://github.com/Developer-Autodesk/tutorial-getting.started-view.and.data" target="_blank">Autodesk View &amp; Data API – Getting Started Tutorial リポジトリ</a>&#0160;</strong>を使って、View and Data API &#0160;の基本的な実装を学んでいきたいと思います。具体的には、<a href="https://ja.wikipedia.org/wiki/Node.js" target="_blank">Node.js</a>&#0160;を使って&#0160;View and Data API &#0160;を使った Web ページをローカルな Web サーバーにホストします。若干、手順に違いがありますが、ここで紹介する内容は、リポジトリの <strong><a href="https://github.com/Developer-Autodesk/tutorial-getting.started-view.and.data/blob/master/chapter-1.md#Chapter1" target="_blank">Chapter 1</a> </strong>&#0160;相当の内容となります。</p>
<p style="text-align: center;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d1ac7e1e970c-pi" style="display: inline;"><img alt="Nodejs+lmv" class="asset  asset-image at-xid-6a0167607c2431970b01b8d1ac7e1e970c img-responsive" src="/assets/image_113528.jpg" title="Nodejs+lmv" /></a></p>
<ol>
<li>GitHub アカウントをお持ちでない場合や、GitHub Desktop と Node.js、Curl をインストールされていない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/08/setup-development-environment-view-and-data-api.html" target="_blank">View and Data API の開発環境</a></strong>&#0160; の内容をご確認の上、アカウント取得とインストールを完了させてください。実際の開発に GitHub アカウントや GitHub Desktop は必須ではありませんが、GirHub 上で公開されている View and Data API サンプルを参照する場合に便利です。<br /><br /></li>
<li>View and Data API を利用するために必要な Consumer Key と Consumer Secret を取得していない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-app-register-and-getting-keys.html" target="_blank">View and Data API アプリ登録とキーの入手</a>&#0160;</strong>の内容に沿って、キーを取得してください。<br /><br /></li>
<li>まず、チュートリアルの環境をセットアップしてきます。&#0160;<strong><a href="https://github.com/Developer-Autodesk/workflow-node.js-view.and.data.api" target="_blank">Autodesk View and Data API Node.js Basic Sample リポジトリ</a></strong>&#0160;ページを表示して、右上の [Sign In] ボタンでから GitHub アカウントでサインインします。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08c6d9fc970d-pi" style="display: inline;"><img alt="Github_signin" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb08c6d9fc970d image-full img-responsive" src="/assets/image_788771.jpg" title="Github_signin" /></a><br /><br /></li>
<li>Git Shell 上の git コマンドを使って素材となるソースコードをクライアント コンピュータにコピーします。まずは、コピー対象の URL をページ上で確認します。<br /><br /><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0939b575970d-pi" style="display: inline;"><img alt="Git_clone_url_new" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb0939b575970d image-full img-responsive" src="/assets/image_796663.jpg" title="Git_clone_url_new" /></a><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8224c25970b-pi" style="display: inline;"><br /><br /></a></li>
<li>Git Shell を起動して、確認した&#0160;URL をパラメータに git clone コマンドで<strong><a href="https://github.com/yochiyochirb/meetups/wiki/clone-a-repository" target="_blank">リポジトリ</a></strong>をクライアント コンピュータにコピーします。<strong>git clone https://github.com/Developer-Autodesk/workflow-node.js-view.and.data.api.git</strong> と入力してください。リポジトリのコピーが始まるはずです。<br /><br /> <img alt="Git_clone2" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d1ac8196970c image-full img-responsive" src="/assets/image_2465.jpg" title="Git_clone2" /><br /><br />もし、Git Shell を利用せずにサンプルをダウンロードしたい場合には、隣にある [Download ZIP] ボタンを使って、任意に ZIP 圧縮されたソースコードを入手することも可能です。<br /><br /></li>
<li>コピーされたリポジトリが、<strong>C:\Users\&lt;<em>Windows ユーザ名</em>&gt;\Documents\GitHub</strong>&#0160;フォルダ直下の<strong>&#0160;workflow-node.js-view.and.data.api</strong> フォルダにあることを確認してください。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8224ef4970b-pi" style="display: inline;"><img alt="Copied_source" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8224ef4970b image-full img-responsive" src="/assets/image_851164.jpg" title="Copied_source" /></a><br /><br /></li>
<li>コピー先のフォルダにディレクトリを変更して、コピーしたソースコードをチェックアウトします。最初に&#0160;<strong>cd workflow-node.js-view.and.data.api</strong> と入力してディレクトリを変更後、&#0160;<strong>git checkout v1.0-workshop</strong> と入力して、この<strong><a href="https://github.com/yochiyochirb/meetups/wiki/create-and-checkout-branch" target="_blank">ブランチ</a></strong>で作業することを宣言します。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d1ac87b0970c-pi" style="display: inline;"><img alt="Git_chekcout" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d1ac87b0970c image-full img-responsive" src="/assets/image_696444.jpg" title="Git_chekcout" /></a><br /><br /></li>
<li>Node.js を利用した Web サーバーをローカル コンピュータ上に構築していきます。コピーしたリポジトリ内のサンプル コードが利用している Node Package を、npm コマンド（Node Package Manager）を使ってインストールしていきます。Node.js command prompt を起動してローカル リポジトリのディレクトリに移動したら、<strong>npm install</strong> と入力してください。インストールが開始されて、<strong><a href="https://www.npmjs.com/package/serve-favicon" target="_blank">serve-favicon</a></strong>、<strong><a href="https://www.npmjs.com/package/express" target="_blank">express</a></strong>、<strong><a href="https://www.npmjs.com/package/request" target="_blank">request</a></strong>、の 3つの Node Package がインストールされるはずです。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c82259d7970b-pi" style="display: inline;"><img alt="Npm_install" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c82259d7970b image-full img-responsive" src="/assets/image_9590.jpg" title="Npm_install" /></a><br /><br /></li>
<li>同じ <strong>workflow-node.js-view.and.data.api</strong>&#0160;フォルダ内で、copy コマンドを使って&#0160;credentials_.js ファイルを&#0160;credentials.js の名前でコピーします。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8225a65970b-pi" style="display: inline;"><img alt="Copy_credentials" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8225a65970b image-full img-responsive" src="/assets/image_903148.jpg" title="Copy_credentials" /></a><br /><br /></li>
<li>コピーした&#0160;credentials.js ファイルを Adobe Bracket で開いて、 <strong><a href="https://developer.autodesk.com" target="_blank">Developer Portal</a></strong>&#0160;サイトで取得済の Consumer Key と Consumer Secret の値に置き換えて上書き保存します。&lt;replace with your consumer key&gt; を Consumer Key で、&lt;replace with your consumer secret&gt; を Consumer Secret で書き換えて、ファイルを上書き保存してください。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8886863970b-pi" style="display: inline;"><img alt="Override_key" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8886863970b image-full img-responsive" src="/assets/image_343163.jpg" title="Override_key" /></a><br /><br /></li>
<li>&#0160;/www/index.js ファイルを開いて、表示させるドキュメントの URN を指定します。URN は、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/09/view-and-data-api-workflow.html" target="_blank">View and Data API ワークフロー</a></strong>&#0160;ページで紹介した手順で取得した Base64 でエンコードした値か、こちらの<strong><a href="http://models.autodesk.io/" target="_blank">テスト サイト</a></strong>から取得することが出来ます。&lt;replace with your encoded urn&gt; を置き換えて、ファイルを上書き保存してください。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08c6e710970d-pi" style="display: inline;"><img alt="Orverride_urn" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb08c6e710970d image-full img-responsive" src="/assets/image_514051.jpg" title="Orverride_urn" /></a><br /><br /></li>
<li>Node.js command prompt で Node.js で作成した Web サーバーを起動します。<strong>node server.js</strong> と入力して、Server listening on port 3000 と表示されることを確認してください。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08c6e920970d-pi" style="display: inline;"><img alt="Launch_node" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb08c6e920970d image-full img-responsive" src="/assets/image_346513.jpg" title="Launch_node" /></a><br /><br /></li>
<li>Google Chrome か、他の WebGL がサポートされる Web ブラウザを起動して、URL に localhost:3000 と入力してください。指定したドキュメントが表示されるはずです。<br /><br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d1ac9599970c-pi" style="display: inline;"><img alt="Mode_on_browser" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d1ac9599970c image-full img-responsive" src="/assets/image_181531.jpg" title="Mode_on_browser" /></a><br /><br /></li>
</ol>
<p>&#0160;ここまでの手順で、Node.js で Web サーバーを構築して、View and Data API を使ったページを作成することが出来ました。表示される 3D モデルは、あらかじめ別の場所で変換されて URN が取得出来ていることを前提としていますが、A360 Viewer のように、毎回、ファイルをアップロードしてストリーミング配信用に変換して表示させることも可能です。逆に言えば、バケット ポリシーが Persistent であれば、一度、ファイルをアップロード、変換して URN が取得できてしまえば、いつでも、3D モデルを表示できることも出来るということになります。</p>
<p>なお、このチュートリアルでは、 Web サーバーのホストに Node.js を利用していますが、ASP.NET など、他の手法を利用しても問題はありません。</p>
<p><strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/03/view-and-data-api-tutorial-part2-upload-and-translation.html" target="_blank">次回</a>&#0160;</strong>からは、この Web サイトを徐々に拡張してきます。</p>
<p>By Toshiaki Isezaki</p>
