---
layout: "post"
title: "Revit SDKサンプルのちょっといい話し（かも）"
date: "2013-10-17 01:04:26"
author: "Akira Kudo"
categories:
  - "API カスタマイズ"
original_url: "https://adndevblog.typepad.com/technology_perspective/2013/10/revit-sdk%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%84%E3%81%84%E8%A9%B1%E3%81%97%E3%81%8B%E3%82%82.html "
typepad_basename: "revit-sdkサンプルのちょっといい話しかも"
typepad_status: "Publish"
---

<p>Autodesk Developer Networkの工藤　暁です。昨日Revitの御質問を調査した際に、製品コマンドとSDKサンプルを組み合わせた調査を行いましたので御紹介させて頂きます。未だRevitプログラマとしては未熟者ですので、他に良い方法等あればご意見を伺えれば幸いです。</p>
<p>さて、御質問は大まかには「プロジェクトで使う単位」を変更するプログラムが2014で動作しなくなったというものでした。回答については、The
Building Coderに<a href="http://thebuildingcoder.typepad.com/blog/units/">関連記事</a>とSDKサンプルC:\Revit
2014 SDK\Samples\Unitsより以下の様な”長さ”の単位を変更する簡単な動作検証プログラムを作成する事が出来ました。</p>
<p>&lt;code_begin&gt;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
<span style="color: #4040ff;">public</span> <span style="color: #00bfbf;">Result
</span>Execute(<span style="color: #00bfbf;">ExternalCommandData</span> commandData,<span style="color: #4040ff;"> ref string</span> message, <span style="color: #00bfbf;">ElementSet</span> elements)</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
{</p>
<p>&#0160;&#0160;&#0160; &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;Document
doc = commandData.Application.ActiveUIDocument.Document;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
<span style="color: #4040ff;">try</span></p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
{</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #00bfbf;">Units</span> projectUnit = doc.GetUnits();</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #4040ff;">using
</span>(<span style="color: #00bfbf;">Transaction</span> t = <span style="color: #4040ff;">new
</span><span style="color: #00bfbf;">Transaction</span>(doc))</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; {</p>
<p>&#0160;&#0160; &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;t.Start(&quot;Set Units&quot;);</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span style="color: #00bfbf;">FormatOptions
</span>formatoptions = <span style="color: #4040ff;">new</span> <span style="color: #00bfbf;">FormatOptions</span>(<span style="color: #00bfbf;">UnitSymbolType</span>.UST_MM, <span style="color: #00bfbf;">DisplayUnitType</span>.DUT_MILLIMETERS);</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; formatoptions.UseDefault = <span style="color: #4040ff;">false</span>;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; formatoptions.Accuracy =
0.01;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
formatoptions.SuppressTrailingZeros = <span style="color: #4040ff;">false</span>;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
formatoptions.SuppressLeadingZeros = <span style="color: #4040ff;">false</span>;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; formatoptions.UsePlusPrefix
= <span style="color: #4040ff;">false</span>;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; formatoptions.UseGrouping =
<span style="color: #4040ff;">false</span>;</p>
<p>&#0160; &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;formatoptions.SuppressSpaces
= <span style="color: #4040ff;">false</span>;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
projectUnit.SetFormatOptions(<span style="color: #00bfbf;">UnitType</span>.UT_Length,
formatoptions);</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doc.SetUnits(projectUnit);</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; t.Commit();</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
}</p>
<p>&#0160;&#0160;&#0160; &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #4040ff;">catch</span> (<span style="color: #00bfbf;">Exception</span> ex)</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
{</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;<span style="color: #00bfbf;">MessageBox</span>.Show(ex.Message);</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
}</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
<span style="color: #4040ff;">return</span> Result.Succeeded;</p>
<p>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;
}</p>
<p>&lt;code_end&gt;</p>
<p>しかしながら、作成時に<span style="color: #00bfbf;">FormatOptions</span>()に指定する<span style="color: #00bfbf;">UnitSymbolType</span>と<span style="color: #00bfbf;">DisplayUnitType</span>の値に何を指定して良いか悩んでしました。というのも、SDKマニュアルにはUnitSymbolTypeの各Enum値が列記されておりますが、Descriptionが空白です。</p>
<p>Remarksには</p>
<p>Most unit symbols appear as suffixes after the formatted
number, for example &quot;mm&quot; for millimeters. Some currency symbols
appear as prefixes, for example &quot;$&quot; for dollars. </p>
<p>とありますが、M&amp;E系の私には少し想像しずらかったです。</p>
<p>さらにSDKサンプルでは「プロジェクトで使う単位」が行う様に<span style="color: #00bfbf;">UnitSymbolType</span> を<span style="color: #00bfbf;">DisplayUnitType</span> に合わせてプルダウンメニューを構成してくれません。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b019b0016aa2b970b-pi" style="display: inline;"><img alt="Capture" border="0" class="asset  asset-image at-xid-6a0167607c2431970b019b0016aa2b970b image-full" src="/assets/image_560397.jpg" title="Capture" /></a><br /><br /></p>
<p>そこでSDKサンプルをデバッグし、「プロジェクトで使う単位」コマンドにて確認したい<span style="color: #00bfbf;">UnitSymbolType</span>と<span style="color: #00bfbf;">DisplayUnitType</span>値を変更し、SDKサンプルにて「プロジェクトで使う単位」コマンドが設定した値を確認することで、<span style="color: #00bfbf;">UnitSymbolType</span>と<span style="color: #00bfbf;">DisplayUnitType</span>の値を確認しました。</p>
<p>
<a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b019b00167fb4970c-pi" style="display: inline;"><img alt="Capture" border="0" class="asset  asset-image at-xid-6a0167607c2431970b019b00167fb4970c image-full" src="/assets/image_358525.jpg" title="Capture" /></a><br /><br /></p>
<p>私自身の為にも、UnitSymbolTypeの各Enum値のDescriptionを埋めるのが一番良いかもしれません。</p>
