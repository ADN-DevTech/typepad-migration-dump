---
layout: "post"
title: "AutoCAD JavaScript API の使い方 ～ その 3"
date: "2013-06-12 00:49:57"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "その他カスタマイズ"
  - "デスクトップ製品"
original_url: "https://adndevblog.typepad.com/technology_perspective/2013/06/autocad-javascript-api-part3.html "
typepad_basename: "autocad-javascript-api-part3"
typepad_status: "Publish"
---

<p>少し時間が空いてしまいましたが、引き続き、AutoCAD 2014 で登場した JavaScript API をご紹介します。前回までは、JavaScript で書かれたソース ファイル（*.js）を直接 AutoCAD に WEBLOAD コマンドを使ってロードしていました。今回は、HTML にソースコードを埋め込んで、その HTML をユーザインタフェースとして AutoCAD 上で利用する方法をご紹介しましょう。ちょうど、AutoLISP に例えるなら、HTML は DCL&#0160;的なユーザ インタフェース定義に利用することになります。</p>
<p>まず、HTML ページをデザインしていきます。HTML をデザインするツールは、有償版/無償版も含めて特に限定しません。ただし、ここではユーザ インタフェースとして HTML ページを使用することが目的なので、ダイアログボックスのように文字を入力するテキストボックスやボタンをグラフィカルに配置することができるツールをお勧めします。もし、有償版の Microsoft Visual Studio&#0160;をお持ちであれば、もちろん、HTML のデザインをおこなうことが出来ます。無償版では、&#0160;<a href="http://www.microsoft.com/visualstudio/jpn#products/visual-studio-express-for-web+product-express-web" target="_blank">Microsoft Visual Studio Express for Web</a> などでも OK です。</p>
<p>初めて HTML とともに JavaScript API をご紹介しますので、今回は&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2013/05/autocad-javascript-api-part2.html" target="_blank">前回</a></strong> ご紹介した円の作図のコードをそのまま流用することにします。また、最も分かり易いページとするため、次のような簡単な構成を想定することにします。</p>
<ol>
<li>円の半径を HTML ページの入力ボックスから取得する。</li>
<li>ボタンをクリックすることで中心点を指定させて円を作図する。</li>
</ol>
<p style="text-align: center;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0191032a2cf9970c-pi" style="display: inline;"></a> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01901d340e4a970b-popup" onclick="window.open( this.href, &#39;_blank&#39;, &#39;width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39; ); return false" style="display: inline;"><img alt="WebForm" class="asset  asset-image at-xid-6a0167607c2431970b01901d340e4a970b" src="/assets/image_836030.jpg" title="WebForm" /></a></p>
<p>この要求を満たす HTML は、下記のような感じになるかと思います。</p>
<table align="left" border="0" cellpadding="0" cellspacing="0" class="auto-style3" style="margin-left: 4.85pt; margin-right: 4.85pt; width: 100%; background: #f2f2f2;">
<tbody>
<tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes;">
<td style="width: 435.1pt; padding: 0mm 5.4pt 0mm 5.4pt;" valign="top" width="580">
<p class="auto-style6" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; text-align: left; mso-pagination: widow-orphan; layout-grid-mode: char; mso-element: frame; mso-element-frame-hspace: 7.1pt; mso-element-wrap: around; mso-element-anchor-horizontal: margin; mso-element-top: 26.3pt; mso-height-rule: exactly;"><span class="auto-style3">&lt;html&gt;</span><br class="auto-style3" /> <span class="auto-style3">&lt;head&gt;<br />&lt;meta content=&quot;text/html; charset=utf-8&quot; http-equiv=&quot;Content-Type&quot;&gt;<br />&lt;title&gt;円の作図&lt;/title&gt;<br /><br />&lt;/head&gt;<br /> &lt;body&gt;<br />&lt;!-- Create a tabular UI with headings and comboboxes --&gt;<br /> &lt;h3 class=&quot;auto-style4&quot;&gt;円の作図&lt;/h3&gt;<br />&#0160; &lt;table border=&quot;0&quot; class=&quot;auto-style3&quot;&gt;<br />&#0160;&#0160;&#0160; &lt;tr&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;th width=&quot;250&quot; class=&quot;auto-style4&quot;&gt;半径&lt;/th&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;td&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;input type=&quot;text&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160; &#0160;<strong>id=&#39;radius&#39;</strong><br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;size=&quot;10&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;value=&quot;10.0&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;class=&quot;auto-style2&quot; /&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;span class=&quot;auto-style2&quot;&gt;&lt;/span&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/td&gt;<br />&#0160;&#0160;&#0160; &lt;/tr&gt;<br />&#0160;&#0160;&#0160; &lt;tr&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;th class=&quot;auto-style2&quot; style=&quot;width: 63px&quot;&gt;&amp;nbsp;&lt;/th&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;td style=&quot;width: 180&quot;&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;input type=&#39;button&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; style=&quot;width: 100px&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <strong>onclick=&#39;myCircle()&#39;</strong><br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; value=&#39;作図&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;class=&quot;auto-style2&quot; /&gt;<br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span class="auto-style3">&lt;span class=&quot;auto-style2&quot;&gt;&lt;/span&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/td&gt;<br />&#0160;&#0160;&#0160; &lt;/tr&gt;<br />&#0160; &lt;/table&gt;</span><br /> <span class="auto-style3">&lt;/body&gt;<br />&lt;/html&gt;</span></p>
</td>
</tr>
</tbody>
</table>
<p class="auto-style3"><span class="auto-style5" lang="EN-US">&#0160;</span></p>
<p class="auto-style2">この HTML には、まだ JavaScript のコードは埋め込んでいませんが、後で JavaScript コード上で使用することになる情報は埋め込んでいます。1つは、テキストボックスに入力された値を取得するために利用する、このテキストボックスのために付けた識別子です。太字で <strong>id=&#39;radius&#39; </strong>となっているのは、このテキストボックスを <strong>radius</strong> という識別子で指定できるようにしています。また、ボタン定義の <strong>onclick=&#39;myCircle()&#39;</strong> は、ボタンがクリックされた場合に、JavaScript&#0160;て定義した myCircle() 関数を呼び出すように指定しています。この HTML ファイルは、文字化けを防ぐため、JavaScript ファイルと同様に UTF-8 形式で保存してください。</p>
<p class="auto-style2">次に作成した&#0160; HTML ファイルに JavaScript コードを埋め込みます。埋め込みには、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2013/05/autocad-javascript-api-part1.html" target="_blank">以前</a></strong> 紹介した &lt;script language=&quot;JavaScript&quot;&gt;&#0160;タグを使用します。円の作図コードを少し修正して埋め込むと、次のようになります。青字のコード部分が先程の HTML 記述に追加した部分です。&#0160;</p>
<table align="left" border="0" cellpadding="0" cellspacing="0" class="auto-style3" style="margin-left: 4.85pt; margin-right: 4.85pt; width: 100%; background: #f2f2f2;">
<tbody>
<tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes;">
<td style="width: 435.1pt; padding: 0mm 5.4pt 0mm 5.4pt;" valign="top" width="580">
<p class="auto-style6" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; text-align: left; mso-pagination: widow-orphan; layout-grid-mode: char; mso-element: frame; mso-element-frame-hspace: 7.1pt; mso-element-wrap: around; mso-element-anchor-horizontal: margin; mso-element-top: 26.3pt; mso-height-rule: exactly;"><span class="auto-style3">&lt;html&gt;</span><br class="auto-style3" /> <span class="auto-style3">&lt;head&gt;<br />&lt;meta content=&quot;text/html; charset=utf-8&quot; http-equiv=&quot;Content-Type&quot;&gt;<br />&lt;title&gt;円の作図&lt;/title&gt;<br /> <span style="color: #0000ff;">&lt;script</span><br /><span style="color: #0000ff;">&#0160; type=&quot;text/javascript&quot;</span><br /><span style="color: #0000ff;">&#0160; src=&quot;http://www.autocadws.com/jsapi/v1/Autodesk.AutoCAD.js&quot;&gt;</span><br /><span style="color: #0000ff;"> &lt;/script&gt;</span><br /><span style="color: #0000ff;">&lt;script type=&quot;text/javascript&quot;&gt;</span><br /><br /><span style="color: #0000ff;">&#0160; var m_rad = 0.0;</span><br /><span style="color: #0000ff;">&#0160; var m_cpt = new Acad.Point3d(0.0, 0.0, 0.0);</span><br /><br /><span style="color: #0000ff;">&#0160; function pointToString(pt) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; var ret =</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; pt.x.toString() + &quot;,&quot; +</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; pt.y.toString() + &quot;,&quot; +</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; pt.z.toString();</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; return ret;</span><br /><span style="color: #0000ff;">&#0160; }</span><br /><br /><span style="color: #0000ff;">&#0160; function doubleToString(value) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; return value.toString();</span><br /><span style="color: #0000ff;">&#0160; }</span><br /><br /><span style="color: #0000ff;">&#0160; function myCircle() {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; try {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; var ppo = new Acad.PromptPointOptions();</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; ppo.useBasePoint = false;</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; ppo.allowNone = false;</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; ppo.setMessageAndKeywords(&quot;\n中心点を入力&quot;, &quot;&quot;);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; Acad.Editor.getPoint(ppo).then(onCompleteCpt, onError);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; catch(ex) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; write(ex.message);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160; }</span><br /><br /><span style="color: #0000ff;">&#0160; function onCompleteCpt(jsonPromptResult) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; try { </span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; var resultObj = JSON.parse(jsonPromptResult);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; if (resultObj &amp;&amp; resultObj.status == 5100) { </span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; try {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_cpt = resultObj.value;</span><br /><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; if (document.getElementById(&#39;radius&#39;).value)</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; m_rad = document.getElementById(&#39;radius&#39;).value;</span><br /><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; Acad.Editor.executeCommand(&quot;CIRCLE&quot;,</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; pointToString(m_cpt),</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; doubleToString(m_rad));</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; catch(ex) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; write(ex.message);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; catch(ex) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160;&#0160;&#0160; write(ex.message);</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; }</span><br /><span style="color: #0000ff;">&#0160; }</span><br /><br /><span style="color: #0000ff;">&#0160; function onError(jsonPromptResult) {</span><br /><span style="color: #0000ff;">&#0160;&#0160;&#0160; write(&quot;\nProblem encountered&quot;);</span><br /><span style="color: #0000ff;">&#0160; }</span><br /><br /><span style="color: #0000ff;">&lt;/script&gt;</span><br /><br />&lt;/head&gt;<br /> &lt;body&gt;<br />&lt;!-- Create a tabular UI with headings and comboboxes --&gt;<br /> &lt;h3 class=&quot;auto-style4&quot;&gt;円の作図&lt;/h3&gt;<br />&#0160; &lt;table border=&quot;0&quot; class=&quot;auto-style3&quot;&gt;<br />&#0160;&#0160;&#0160; &lt;tr&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;th width=&quot;250&quot; class=&quot;auto-style4&quot;&gt;半径&lt;/th&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;td&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;input type=&quot;text&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;id=&#39;radius&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; size=&quot;10&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;value=&quot;10.0&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;class=&quot;auto-style2&quot; /&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;span class=&quot;auto-style2&quot;&gt;&lt;/span&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/td&gt;<br />&#0160;&#0160;&#0160; &lt;/tr&gt;<br />&#0160;&#0160;&#0160; &lt;tr&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160; &lt;th class=&quot;auto-style2&quot; style=&quot;width: 63px&quot;&gt;&amp;nbsp;&lt;/th&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;td style=&quot;width: 180&quot;&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;input type=&#39;button&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; style=&quot;width: 100px&quot;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; onclick=&#39;myCircle()&#39;<br /> &#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; value=&#39;作図&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;class=&quot;auto-style2&quot; /&gt;<br /></span>&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; <span class="auto-style3">&lt;span class=&quot;auto-style2&quot;&gt;&lt;/span&gt;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &lt;/td&gt;<br />&#0160;&#0160;&#0160; &lt;/tr&gt;<br />&#0160; &lt;/table&gt;</span><br /> <span class="auto-style3">&lt;/body&gt;<br />&lt;/html&gt;</span></p>
</td>
</tr>
</tbody>
</table>
<p class="auto-style3"><span class="auto-style5" lang="EN-US">&#0160;</span></p>
<p class="auto-style3">この JavaScript コードでは、ボタンがクリックされた際に呼び出される myCircle() 関数を実装しています。myCircle() 関数内では、getPoint() 関数で円の中心点を指定させて、正常に点の指定が完了すると、onCompleteCpt() 関数を呼び出すよう &#0160;<a href="http://www.autocadws.com/jsapi/v1/docs/Acad_Promise_then@success@error.html" target="_blank">Promise Pattern</a>&#0160;が指定されていることがわかります。</p>
<p class="auto-style3">onCompleteCpt() 関数では、JSON で返された指定点とともに、HTML ページ上で radius の ID で識別されるテキストボックスから、半径の値をグローバル変数に代入してます。その後、executeCommand() 関数で CIRCLE コマンドを実行しています。つまり、HTML ページの [作図] ボタンをクリックすることで、円の中心点を指定して円を作図できます。</p>
<p class="auto-style3">JavaScript コードを含む HTML ファイルをこのブログを記載している Web サイトにポストしていますので、クリックして表示してみてください。</p>
<p class="auto-style2"><a href="http://adndevblog.typepad.com/files/createcircle-2.html">CreateCircleをダウンロード</a></p>
<p class="auto-style2">表示されたページの [作図]&#0160; ボタンをクリックしても、当然、何も起こりません。実行には、AutoCAD 上で HTML ページを開く必要があります。さて、どのように HTML ページを表示すればいいのでしょう？</p>
<p class="auto-style2">実は、AutoCAD JavaScript API 自身にも <a href="http://www.autocadws.com/jsapi/v1/docs/Acad_Application_activedocument_showModalDialog@value.html" target="_blank">Acad.Application.activedocument.showModalDialog</a>&#0160;や <a href="http://www.autocadws.com/jsapi/v1/docs/Acad_Application_activedocument_addPalette@strPaletteName@uriOfHtmlPage.html" target="_blank">Acad.Application.activedocument.addPalette</a>&#0160;といった関数で、ダイアログ ボックスやパレットに HTML ページを表示する機能が用意されています。ただし、それを実装するコマンドも JavaScript API で実装するとなると、そのコードを WEBLOAD コマンドで事前にロードする必要が出てきます。そうするとなると少し面倒なので、HTML ページを&#0160;ロードして AutoCAD 内に表示する処理は、従来の AutoCAD API で実装する方法も用意されています。</p>
<p class="auto-style2">ここでは、AutoCAD .NET API を使って、HTML ページをパレット ダイアログに表示することにします。少し実装内容が異なりますは、.NET API を利用してパレットを作成する手順は、Autodesk Knowledge Network に記載されています。&#0160;</p>
<p class="auto-style2" style="padding-left: 30px;"><strong><a href="https://knowledge.autodesk.com/ja/support/autocad/troubleshooting/caas/sfdcarticles/sfdcarticles/kA230000000u02n.html" target="_blank">AutoCAD .NET API でパレット ダイアログを作成する方法</a></strong></p>
<p class="auto-style2">HTML ページを表示する方法は、.NET API の他に、ObjectARX と AutoLISP にも用意されています。</p>
<p class="auto-style2">次のコードでは、JsPallete コマンドを実装して、パレット ダイアログ上に先にダウンロードできるようにした HTML ページ <a href="http://adndevblog.typepad.com/files/createcircle-2.html" target="_self">http://adndevblog.typepad.com/files/createcircle-2.html</a>&#0160;を表示するようにしています。</p>
<table align="left" border="0" cellpadding="0" cellspacing="0" class="auto-style3" style="margin-left: 4.85pt; margin-right: 4.85pt; width: 100%; background: #f2f2f2;">
<tbody>
<tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes;">
<td style="width: 435.1pt; padding: 0mm 5.4pt 0mm 5.4pt;" valign="top" width="580">
<p class="auto-style6" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-pagination: widow-orphan; layout-grid-mode: char; mso-element: frame; mso-element-frame-hspace: 7.1pt; mso-element-wrap: around; mso-element-anchor-horizontal: margin; mso-element-top: 26.3pt; mso-height-rule: exactly;">&#0160;Public Class MyCommands<br /><br />&#0160; &#39; パレットセット用変数の宣言<br />&#0160; Public Shared oPs As Autodesk.AutoCAD.Windows.PaletteSet = Nothing<br /> <br />&#0160; &lt;CommandMethod(&quot;JsPalette&quot;)&gt; _<br />&#0160; Public Sub MyCommand()<br /><br />&#0160;&#0160;&#0160; &#39; パレットセットの作成<br />&#0160;&#0160;&#0160; If oPs Is Nothing Then<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs = New Autodesk.AutoCAD.Windows.PaletteSet(&quot;JavaScript デモ&quot;)<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs.Style = PaletteSetStyles.ShowPropertiesMenu Or _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; PaletteSetStyles.ShowAutoHideButton Or _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; PaletteSetStyles.ShowCloseButton Or _<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; PaletteSetStyles.Snappable<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs.Visible = True<br />&#0160;&#0160;&#0160; Else<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs.Visible = True<br />&#0160;&#0160;&#0160; End If<br /><br />&#0160;&#0160;&#0160; &#39; パレットの作成<br />&#0160;&#0160;&#0160; If oPs.Count = 0 Then<br />&#0160;&#0160;&#0160;&#0160;&#0160; Dim oUri As Uri = New Uri(&quot;http://adndevblog.typepad.com/files/createcircle-2.html&quot;)<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs.Add(&quot;JavaScript デモ&quot;, oUri)<br />&#0160;&#0160;&#0160;&#0160;&#0160; oPs.Dock = DockSides.None<br />&#0160;&#0160;&#0160; End If<br /><br />&#0160; End Sub<br /><br />End Class</p>
</td>
</tr>
</tbody>
</table>
<p class="auto-style2">&#0160;</p>
<p class="auto-style2">JSPALETTE コマンドを実行して、半径を指定してから [作図]&#0160;ボタンをクリック、作図画面上で中心点を指定することで、円を作図することが出来るはずです。</p>
<p class="auto-style2" style="text-align: center;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b0192aaf4d5f5970d-popup" onclick="window.open( this.href, &#39;_blank&#39;, &#39;width=640,height=480,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=no,left=0,top=0&#39; ); return false" style="display: inline;"><img alt="AutoCAD" class="asset  asset-image at-xid-6a0167607c2431970b0192aaf4d5f5970d" src="/assets/image_61067.jpg" title="AutoCAD" /></a></p>
<p class="auto-style2">NETLOAD コマンドなどで .NET API アプリケーション（.dll ファイル）をロードする時と、パレット ダイアログが表示されて HTML ページがロードされるタイミングで、セキュアロードの警告ダイアログが表示されます。</p>
<p class="auto-style2">前者は、</p>
<p class="auto-style2" style="padding-left: 30px;"><strong><a href="https://knowledge.autodesk.com/ja/support/autocad/troubleshooting/caas/sfdcarticles/sfdcarticles/kA230000000u0cf.html" target="_blank">セキュリティ警告ダイアログについて</a></strong></p>
<p class="auto-style2">でご案内した方法で、後者は、システム変数 <a href="http://docs.autodesk.com/ACD/2014/JPN/files/GUID-BA2AE331-A1EB-4617-B321-697D77746545.htm" target="_blank">TRUSTEDDMAINS</a> にロード先のドメインを指定することで、警告ダイアログの表示を抑止することができます。</p>
<p class="auto-style2">AutoCAD&#0160;JavaScript API の利点は、HTML ページも含めてサーバー側でソースコードを管理できる点です。もし、修正が必要なコードがあったとしても、サーバー側で修正をポストしておけば、クライアントで再読み込みすれば、最新のコードを実行することができます。前回まは、.JavaScript のソースコードを新しく AutoCAD に認識させるために、AutoCAD を再起動して、毎回&#0160;、WEBLOAD コマンドで js ファイルをロードする必要がありました。HTML ファイルに埋め込まれた JavaScript コードを AutoCAD に認識させるためには、HTML 側で工夫をすることで、AutoCAD の再起動は必要なくなります。次の HTML タグと JavaScript コードを使って、表示している HTML（と埋め込まれた JavaScript コード）を再ロードさせることもできます。ちょうど、Web ブラウザ上で [F5] キーを使ってページを再ロードするような感じです。</p>
<table align="left" border="0" cellpadding="0" cellspacing="0" class="auto-style3" style="margin-left: 4.85pt; margin-right: 4.85pt; width: 100%; background: #f2f2f2;">
<tbody>
<tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes;">
<td style="width: 435.1pt; padding: 0mm 5.4pt 0mm 5.4pt;" valign="top" width="580">
<p class="auto-style6" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; text-align: left; mso-pagination: widow-orphan; layout-grid-mode: char; mso-element: frame; mso-element-frame-hspace: 7.1pt; mso-element-wrap: around; mso-element-anchor-horizontal: margin; mso-element-top: 26.3pt; mso-height-rule: exactly;"><span class="auto-style3">&lt;input type=&#39;button&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160; onclick=&#39;window.location.reload(true)&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; &#0160;value=&#39;再ロード&#39;<br />&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160;&#0160; style=&quot;display:inline&quot;/&gt;</span></p>
</td>
</tr>
</tbody>
</table>
<p class="auto-style2">&#0160;</p>
<p class="auto-style2">また、C:\Users\&lt;ユーザ名&gt;\AppData\Local\Temp\cache フォルダのファイルを削除すると、クライアント上のキャッシュを削除して、最新の HTML ページを AutoCAD 上に作成したパレットなどに表示させることもできます。ただし、キャッシュ全体が消えてしまうので、ブラウザで閲覧した他の履歴も消えてしまいます。注意してください。</p>
<p class="auto-style2">By Toshiaki Isezaki</p>
<p class="auto-style2">&#0160;</p>
