---
layout: "post"
title: "Fusion 360:テキスト コマンド"
date: "2015-12-09 01:23:34"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2015/12/fusion-360-text-command.html "
typepad_basename: "fusion-360-text-command"
typepad_status: "Publish"
---

<p>今回は、Fusion 360 上に表示されるテキスト コマンド ウィンドウについて、触れておきたいと思います。テキスト コマンドは、既定で Fusion 360 の画面下部に表示されますが、ファイル メニューの [表示] &gt;&gt; [テキスト コマンドを非表示] / [テキスト コマンドを表示] メニューで表示状態を切り替えることが出来ます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7f76c9e970b-pi" style="display: inline;"><img alt="Text_command" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7f76c9e970b image-full img-responsive" src="/assets/image_309363.jpg" title="Text_command" /></a></p>
<p>テキスト コマンドの使用方法と利点をご紹介する前に、ライブラリについて説明しておく必要があります。&#0160;</p>
<p>Fusion 360 API で利用可能なすべてのオブジェクトは、主に 2 つのライブラリから提供されています。<strong>Core ライブラリ</strong>と <strong>Fusion ライブラリ</strong>です。現在、Fusion 360 API で制御可能な機能は、[モデル] ワークスペースと [パッチ] ワークスペースのみになっていますが、これらは、Fusion 360 の各種機能を API 化したもので、Fusion ライブラリで提供されています。一方、どのワークスペースにも共通する基本機能は、Core ライブラリとして提供されています。Fusion 360 API は、Core ライブラリ上に構築された Fusion ライブラリを同時に利用していると考えることも出来ます。</p>
<p>言語上では、このライブラリを名前空間として捕らえることも可能です。JavaScript でスクリプトやアドインを作成した場合には、.js ファイルと同時に生成される .html ファイルに、次のような &lt;script&gt; タグの記述を見出すことが出来るはずです。</p>
<p style="padding-left: 30px;"><span style="font-size: 10pt; font-family: helvetica;">&lt;!DOCTYPE html&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;html&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>core</strong></span>/application.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>core</strong></span>/geometry.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>core</strong></span>/materials.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>core</strong></span>/userInterface.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/utilities.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/bRep.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/components.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/construction.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/features.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/fusion.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/meshBody.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/meshData.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/sketch.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;../../JavaScript/src/adsk/<span style="color: #0000ff;"><strong>Fusion</strong></span>/tSpline.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;script type=&quot;text/javascript&quot; charset=&quot;UTF-8&quot; src=&quot;xxxxx.js&quot;&gt;&lt;/script&gt;<br /></span><span style="font-size: 10pt; font-family: helvetica;">&lt;body&gt;</span><br /><span style="font-size: 10pt; font-family: helvetica;">&lt;/body&gt;</span><br /><span style="font-size: 10pt; font-family: helvetica;">&lt;/html&gt;</span></p>
<p>同様に、Python の場合には、次のような import 記述が存在しているはずです。</p>
<p style="padding-left: 30px;">import <strong>adsk.core</strong>, <strong>adsk.fusion</strong>, traceback</p>
<p>これらの記述によって、作成したスクリプトやアドインにライブラリが適切に読み込まれて、オブジェクト モデルにあるオブジェクトをカスタム プログラム内で利用できるようになっているわけです。逆に、上記の記述を削除してしまうと、スクリプトもアドインも正しく動作しなくなってしまいます。将来、[CAM] ワークスペースや [レンダリング] ワークスペース、[シミュレーション] ワークスペースなどの機能が、別名のライブラリで導入される予定です。</p>
<p>さて、主要ライブラリと役割を理解いただけたかと思いますので、続いて、テキスト コマンドの利用方法を説明していきます。テキスト コマンドは、主にスクリプトやアドインをプログラムする際のデバッグ ツールとして利用することが出来ます。テキスト コマンドには、ウィンドウ右下にあるチェックボックスから、使用する言語を選択することが出来ます。今回は、オートデスク社内でテスト環境としても利用されている Python を用いてご案内していきます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7f76dfd970b-pi" style="display: inline;"><img alt="Text_command_window" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7f76dfd970b img-responsive" src="/assets/image_924742.jpg" title="Text_command_window" /></a></p>
<p>Fusion 360 の起動して各種機能が利用できる状態であっても、テキスト コマンドを利用する際には、事前に前述のライブラリをインポートする必要があります。まず、テキスト コマンド ウィンドウの入力領域に</p>
<p><strong>from adsk.core import *</strong></p>
<p>と入力します。これで、Core ライブラリに定義されているオブジェクトにアクセスすることが出来るようになります。同様に、</p>
<p><strong>from adsk.fusion import *</strong></p>
<p>と入力することで、Fusion ライブラリに定義されているオブジェクトにアクセスすることが出来るようになります。次に、モデルパラメータにアクセスしていく例をご紹介します。ここでは、d23 という名前のモデル パラメータが使われていると仮定します。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7f770ae970b-pi" style="display: inline;"><img alt="Parameters" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7f770ae970b image-full img-responsive" src="/assets/image_90153.jpg" title="Parameters" /></a></p>
<p>Fusion 360API を利用する際のルールとして、オブジェクトモデルのトップ オブジェクトである Application オブジェクトを最初に取得して、関連するプロパティやメソッドにアクセスしていく、というものがあります。まずは、Application オブジェクトを変数に代入します。テキスト コマンドの入力領域に、次のように入力します。</p>
<p><strong>app = adsk.core.Application.get()</strong></p>
<p>これで、app 変数に Application オブジェクトが代入されたはずです。変数の内容を確認するには、</p>
<p><strong>dir(app)</strong></p>
<p>と入力します。すると、Application オブジェクトが持つメソッドとプロパティが表示されて、変数に Application オブジェクトが正しく代入されていることがわかります。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d1811860970c-pi" style="display: inline;"><img alt="Application_variable" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d1811860970c image-full img-responsive" src="/assets/image_200799.jpg" title="Application_variable" /></a></p>
<p>後は、スクリプトやアドイン プログラムと同様に変数に値を代入しながら、当該パラメータを取得できるまで、入力を続けていきます。まずは、Application オブジェクトの activeProduct プロパティを使用して、Product オブジェクトを取得します。なお、ここでは、[モデル] ワークスペースがアクティブになっていて、モデル パラメータの編集が可能な状態になっているものとします。</p>
<p><strong>design = app.activeProduct</strong></p>
<p>次に、Product オブジェクトの rootComponent プロパティから、モデル パラメータを管理する ModelParameters コレクション オブジェクトを取得します。&#0160;</p>
<p><strong>modelparas = root.modelParameters</strong></p>
<p>取得した ModelParameters コレクションは、内包する ModelParameter オブジェクトのオーナーです。count プロパティで、その数を調べたり、配列添字（インデックス）を利用して name プロパティにアクセスなどして、モデル パラメータにアクセスすることが出来ます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7f76fe2970b-pi" style="display: inline;"><img alt="Modelparameters" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7f76fe2970b image-full img-responsive" src="/assets/image_416168.jpg" title="Modelparameters" /></a></p>
<p>この調査では、4 つめの ModelParameter が、ターゲットにしているモデル パラメータであることが分かります。この場合、暗黙のうちに ModelParameters.item メソッドが呼び出していることになります。また、添字は 0 から始まるので、4 つめを指定する添字は 3 になる点に注意してください。もし、直接パラメータ名で ModelParameter オブジェクトにアクセスする場合には、itemByName メソッドを使用します。ModelParameter オブジェクトにアクセス出来れば、各種プロパティにアクセスして、各種情報を取得することが出来ます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c7f77092970b-pi" style="display: inline;"><img alt="Modelparameter" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c7f77092970b image-full img-responsive" src="/assets/image_666366.jpg" title="Modelparameter" /></a></p>
<p>もちろん、読み取り専用にプロパティでなければ、ここで新しい値を代入するなどの編集も可能です。</p>
<p><iframe allowfullscreen="" frameborder="0" height="281" src="https://www.youtube.com/embed/XvUGynqzTzc?feature=oembed" width="500"></iframe>&#0160;</p>
<p>Python 環境に限定されてしまいますが、このように、テキスト コマンドを利用して基本的な手順をトレースすることが出来ます。通常はあまり使わない機能ですが、開発する際には有用です。</p>
<p>By Toshiak Isezaki</p>
