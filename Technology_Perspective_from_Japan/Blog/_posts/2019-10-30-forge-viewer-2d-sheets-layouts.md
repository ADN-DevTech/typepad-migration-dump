---
layout: "post"
title: "Forge Viewer：2D シート/レイアウト"
date: "2019-10-30 00:01:58"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2019/10/forge-viewer-2d-sheets-layouts.html "
typepad_basename: "forge-viewer-2d-sheets-layouts"
typepad_status: "Publish"
---

<p>Forge Viewer サンプルやデモでは、カンバスに表示するコンテンツの多くが 3D モデルになっています。見た目のインパクトを狙って意図的に扱っているためですが、もちろん 2D 図面を表示させることも可能です。具体的には、<a href="https://adndevblog.typepad.com/technology_perspective/2019/10/forge-viewer-v7-code.html" rel="noopener" target="_blank"><strong>Forge Viewer：v7 コード</strong></a> の記事でご紹介した onDocumentLoadSuccess() の記述を 3d から <strong>2d</strong> に置き換えていただくだけです。</p>
<pre class="code-snippet more-toggle--slide snippet-container js-more-toggle more-toggle" data-toggle-end-color="rgba(250, 250, 250, 1)" data-toggle-height="400" data-toggle-less="Hide Code" data-toggle-more="Show Code"><code class="language-javascript code-overflow-x hljs " id="snippet-4"><span style="font-size: 12pt;">  var viewables = viewerDocument.getRoot().search({<br />    &#39;role&#39;: &#39;<strong>2d</strong>&#39;<br />  });</span></code></pre>
<p>多くの場合、2D 図面のデザイン ファイル（シード ファイル）として、Revit プロジェクト ファイル（.rvt）や AutoCAD 図面ファイル（.dwg）が利用されています。この場合、1 のデザイン ファイルの中に複数のシート（Revit）やレイアウト（AutoCAD）が含まれているのが一般的です。</p>
<p>Forge Viewer 用に&#0160;<strong><a href="https://adndevblog.typepad.com/technology_perspective/2017/05/translatable-file-format-with-model-derivative-api-and-role.html" rel="noopener" target="_blank">Model Derivative API</a></strong> で&#0160; SVF 変換すると、すべてのシート/レイアウトに表示用の <strong><a href="https://forge.autodesk.com/en/docs/viewer/v7/developers_guide/glossary/" rel="noopener" target="_blank">viewable</a></strong> と呼ばれる表示情報が用意されます。複数のシート/レイアウトは、viewable の配列としてJSON 形式で情報を得ることが出来ます。この中に、シート名、あるいは、レイアウト名も含まれています。Web ページ上で表示切替用のコントロールを用意するような場面では、次のようにシート/レイアウト名の一覧を得ることが出来ます。<code class="language-javascript code-overflow-x hljs " id="snippet-4"></code></p>
<pre class="code-snippet more-toggle--slide snippet-container js-more-toggle more-toggle" data-toggle-end-color="rgba(250, 250, 250, 1)" data-toggle-height="400" data-toggle-less="Hide Code" data-toggle-more="Show Code"><code class="language-javascript code-overflow-x hljs " id="snippet-4"><span style="font-size: 12pt;">  viewables.forEach(function (value) {<br />    $(&#39;#sheets&#39;).append($(&#39;&lt;option&gt;&#39;).val(index).text(<strong>value.data.name</strong>));<br />  });<br /></span></code></pre>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4bd14b0200d-pi" style="display: inline;"><img alt="Revit_sheets" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4bd14b0200d image-full img-responsive" src="/assets/image_661866.jpg" title="Revit_sheets" /></a></p>
<p>2D 図面を表示した場合には、[設定] &gt;&gt; [外観] &gt;&gt; [2D シートの色] で背景色を白か黒に変更することが出来ます。この設定値は、<a href="https://forge.autodesk.com/en/docs/viewer/v7/reference/Viewing/Viewer3D/#setswapblackandwhite-value" rel="noopener" target="_blank">Viewer3D.setSwapBlackAndWhite()</a> で変更することも出来ます。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4c04c84200d-pi" style="display: inline;"><img alt="Vector_background" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4c04c84200d image-full img-responsive" src="/assets/image_642641.jpg" title="Vector_background" /></a></p>
<p>もし、AutoCAD で作成した図面が複数の外部参照図面が構成されているようなら、Model Derivative API での変換時に、親図面のファイルと外部参照の図面ファイルを 、1 つの ZIP ファイルにまとめて変換するようにしてください。このとき、<a href="https://forge.autodesk.com/en/docs/model-derivative/v2/reference/http/job-POST/" rel="noopener" target="_blank"><strong>POST job</strong></a> endpoint 呼び出し時の Body JSON には、親図面のファイル名と、圧縮ファイルである点を明示的に記述する必要があります。</p>
<pre class="code-snippet more-toggle--slide snippet-container js-more-toggle more-toggle" data-toggle-end-color="rgba(250, 250, 250, 1)" data-toggle-height="400" data-toggle-less="Hide Code" data-toggle-more="Show Code"><code class="language-javascript code-overflow-x hljs " id="snippet-4"><span style="font-size: 12pt;">&#0160;       {</span><br /><span style="font-size: 12pt;">            input: {</span><br /><span style="font-size: 12pt;">                urn: encodedURN,</span><br /><span style="font-size: 12pt;"><strong>                rootFilename: &quot;8th floor.dwg&quot;,</strong></span><br /><span style="font-size: 12pt;"><strong>                compressedUrn: true</strong></span><br /><span style="font-size: 12pt;">            },</span><br /><span style="font-size: 12pt;">            output: {</span><br /><span style="font-size: 12pt;">                formats: [</span><br /><span style="font-size: 12pt;">                    {</span><br /><span style="font-size: 12pt;">                        type: &quot;svf&quot;,</span><br /><span style="font-size: 12pt;">                        views: [&quot;2d&quot;, &quot;3d&quot;]</span><br /><span style="font-size: 12pt;">                    }</span><br /><span style="font-size: 12pt;">                ]</span><br /><span style="font-size: 12pt;">            }</span><br /><span style="font-size: 12pt;">        }</span></code></pre>
<p>この状態で SVF 変換すると、ZIP 圧縮ファイルの URN で、外部参照した親図面ファイルの各レイアウトを表示させることが出来るようになります。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4bd9c47200d-pi" style="display: inline;"><img alt="Zipped_8th_floor_dwg" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4bd9c47200d image-full img-responsive" src="/assets/image_620361.jpg" title="Zipped_8th_floor_dwg" /></a></p>
<p>By Toshiaki Isezaki</p>
