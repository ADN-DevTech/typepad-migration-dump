---
layout: "post"
title: "Forge Viewer チュートリアル ～ その1 ～ Node.js サーバーの実装"
date: "2017-01-18 01:35:32"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2017/01/forge-viewer-tutorial-part1-implement-nodejs-server.html "
typepad_basename: "forge-viewer-tutorial-part1-implement-nodejs-server"
typepad_status: "Publish"
---

<p>今回から 2 回、GitHub で公開されている <strong><a href="https://github.com/Developer-Autodesk/viewer-javascript-tutorial" rel="noopener noreferrer" target="_blank">viewer-javascript-tutorial リポジトリ</a></strong>&#0160;を使って、Forge Viewer &#0160;の基本的な実装を学んでいきたいと思います。具体的には、<a href="https://ja.wikipedia.org/wiki/Node.js" rel="noopener noreferrer" target="_blank">Node.js</a>&#0160;上に Forge Viewer を使った Web サーバーをローカルに作成してテストしていきます。若干、手順に違いがありますが、ここで紹介する内容は、リポジトリの <strong><a href="https://github.com/Developer-Autodesk/viewer-javascript-tutorial/blob/master/chapters/chapter-1.md#Chapter1" rel="noopener noreferrer" target="_blank">Chapter 1</a> </strong>&#0160;の後半部分の内容となります。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8c7b477970b-pi" style="display: inline;"><img alt="Nodejs-forge" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8c7b477970b image-full img-responsive" src="/assets/image_400048.jpg" title="Nodejs-forge" /></a></p>
<ol>
<li>GitHub アカウントをお持ちでない場合や、GitHub Desktop と Node.js、Postman をインストールされていない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/01/development-environment-for-forge.html" rel="noopener noreferrer" target="_blank">Forge の開発環境</a></strong>&#0160;の内容をご確認の上、アカウント取得とインストールを完了させてください。実際の開発に GitHub アカウントや GitHub Desktop は必須ではありませんが、GirHub 上で公開されている Forge サンプルを参照する場合に便利です。</li>
<li>Forge を利用するために必要な Client ID と Client Secret（別名 Consumer Key と Consumer Secret）を取得していない場合には、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/07/app-registration-and-getting-keys-for-forge-api.html" rel="noopener noreferrer" target="_blank">Forge API を利用するアプリの登録とキーの取得</a>&#0160;</strong>の内容に沿って、キーを取得してください。</li>
<li>まず、チュートリアルの環境をセットアップしてきます。&#0160;<strong><a href="https://github.com/Developer-Autodesk/workflow-node.js-view.and.data.api" rel="noopener noreferrer" target="_blank">Autodesk View and Data API Node.js Basic Sample リポジトリ</a></strong>&#0160;ページを表示して、右上の [Sign In] ボタンでから GitHub アカウントでサインインします。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb096a95b7970d-pi" style="display: inline;"><img alt="Github_signin" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb096a95b7970d image-full img-responsive" src="/assets/image_636177.jpg" title="Github_signin" /></a></li>
<li>Git Shell 上の git コマンドを使って素材となるソースコード一式をクライアント コンピュータにコピーします。まずは、コピー対象の URL をページ上で確認します。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d251a74e970c-pi" style="display: inline;"><img alt="Github_repository_url" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d251a74e970c image-full img-responsive" src="/assets/image_336908.jpg" title="Github_repository_url" /></a></li>
<li><strong>Git Shell</strong> を起動して、git clone コマンドで確認した&#0160;URL をパラメータに指定して、<strong><a href="https://github.com/yochiyochirb/meetups/wiki/clone-a-repository" rel="noopener noreferrer" target="_blank">リポジトリ</a>&#0160;</strong>をクライアント コンピュータにコピーします。具体的には、<strong>git clone https://github.com/Developer-Autodesk/workflow-node.js-view.and.data.api.git</strong> と入力してください。リポジトリのコピーが始まるはずです。もし、Git Shell を利用せずにサンプルをダウンロードしたい場合には、隣にある [Download ZIP] ボタンを使って、任意に ZIP 圧縮されたソースコードを入手することも可能です。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb096a95cb970d-pi" style="display: inline;"><img alt="Clone_source_from_github" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb096a95cb970d image-full img-responsive" src="/assets/image_800598.jpg" title="Clone_source_from_github" /></a></li>
<li>コピーされたリポジトリが、<strong>C:\Users\&lt;<em>Windows ユーザ名</em>&gt;\Documents\GitHub</strong>&#0160;フォルダ直下の<strong>&#0160;workflow-node.js-view.and.data.api</strong> フォルダにあることを確認してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d251a75d970c-pi" style="display: inline;"><img alt="Cloned_sample_from_github" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d251a75d970c image-full img-responsive" src="/assets/image_792711.jpg" title="Cloned_sample_from_github" /></a></li>
<li>コピー先のフォルダにディレクトリを変更して、コピーしたソースコードをチェックアウトします。最初に&#0160;<strong>cd workflow-node.js-view.and.data.api</strong> と入力してディレクトリを変更後に、&#0160;<strong>git checkout -b v1.0-workshop</strong> と入力して、この<strong><a href="https://github.com/yochiyochirb/meetups/wiki/create-and-checkout-branch" rel="noopener noreferrer" target="_blank">ブランチ</a></strong>で作業することを宣言します。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8c7b99c970b-pi" style="display: inline;"><img alt="Create_new_branch" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8c7b99c970b image-full img-responsive" src="/assets/image_614109.jpg" title="Create_new_branch" /></a></li>
<li>Node.js を利用した Web サーバーをローカル コンピュータ上に構築していきます。コピーしたリポジトリ内のサンプル コードが利用している Node Package を、npm コマンド（Node Package Manager）を使ってインストールしていきます。<strong>Node.js command prompt</strong> を起動してローカル リポジトリのディレクトリに移動したら、<strong>npm install</strong> と入力してください。インストールが開始されて、<strong><a href="https://www.npmjs.com/package/serve-favicon" rel="noopener noreferrer" target="_blank">serve-favicon</a></strong>、<strong><a href="https://www.npmjs.com/package/express" rel="noopener noreferrer" target="_blank">express</a></strong>、<strong><a href="https://www.npmjs.com/package/request" rel="noopener noreferrer" target="_blank">request</a></strong>、の 3つの Node Package がインストールされるはずです。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb096a95da970d-pi" style="display: inline;"><img alt="Npm_install" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb096a95da970d image-full img-responsive" src="/assets/image_481286.jpg" title="Npm_install" /></a></li>
<li>同じ <strong>workflow-node.js-view.and.data.api</strong>&#0160;フォルダ内で、copy コマンドを使って&#0160;credentials_.js ファイルを&#0160;credentials.js の名前でコピーします。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d251a774970c-pi" style="display: inline;"><img alt="Copy_credentials" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d251a774970c image-full img-responsive" src="/assets/image_141616.jpg" title="Copy_credentials" /></a></li>
<li>コピーした&#0160;credentials.js ファイルを Adobe Brackets で開いて、 <strong><a href="https://developer.autodesk.com/" rel="noopener noreferrer" target="_blank">Developer Portal</a></strong>&#0160;サイトで取得済の Client ID と Client Secret の値に置き換えて上書き保存します。&lt;replace with your consumer key&gt; を Client ID で、&lt;replace with your consumer secret&gt; を Client Secret で書き換えて、ファイルを上書き保存してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb096a95f1970d-pi" style="display: inline;"><img alt="Write_credentials" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb096a95f1970d image-full img-responsive" src="/assets/image_314177.jpg" title="Write_credentials" /></a></li>
<li>&#0160;/www/index.js ファイルを Adobe Brackets で開き、表示させるドキュメントの URN を指定します。URN は、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/09/understanding-steps-to-use-viewer-on-postman.html" rel="noopener noreferrer" target="_blank">Postman による Viewer 利用手順の理解 - 2 legged 認証</a></strong> で紹介した手順で取得した Base64 エンコード済みの値か、こちらの<strong><a href="http://models.autodesk.io/" rel="noopener noreferrer" target="_blank">テスト サイト</a></strong>から取得することが出来ます。&lt;replace with your encoded urn&gt; を置き換えて、ファイルを上書き保存してください。<br /><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb08c6e710970d-pi"><img alt="Orverride_urn" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb08c6e710970d image-full img-responsive" src="/assets/image_514051.jpg" title="Orverride_urn" /></a></li>
<li>Node.js command prompt で Node.js で作成した Web サーバーを起動します。<strong>node server.js</strong> と入力して、Server listening on port 3000 と表示されることを確認してください。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d251a798970c-pi" style="display: inline;"><img alt="Run_node_server" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d251a798970c image-full img-responsive" src="/assets/image_638853.jpg" title="Run_node_server" /></a></li>
<li>Google Chrome か、他の WebGL がサポートされる Web ブラウザを起動して、URL に localhost:3000 と入力してください。指定したドキュメントが表示されるはずです。<br /> <a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb096a9610970d-pi" style="display: inline;"><img alt="Chair_on_viewer" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb096a9610970d image-full img-responsive" src="/assets/image_81913.jpg" title="Chair_on_viewer" /></a></li>
</ol>
<p>ここまでの手順で、Node.js で Web サーバーを構築して、Forge Viewer を使ったページを作成することが出来ました。表示される 3D モデルは、あらかじめ別の場所で変換されて URN が取得出来ていることを前提としていますが、A360 Viewer のように、毎回、ファイルをアップロードしてストリーミング配信用に変換して表示させることも可能です。逆に言えば、バケット ポリシーが Persistent であれば、一度、ファイルをアップロード、変換して URN が取得できてしまえば、いつでも、3D モデルを表示できることも出来るということになります。</p>
<p>なお、このチュートリアルでは、 Web サーバーのホストに Node.js を利用していますが、Apache や ASP.NET などの手法を利用しても問題はありません。</p>
<p>By Toshiaki Isezaki</p>
