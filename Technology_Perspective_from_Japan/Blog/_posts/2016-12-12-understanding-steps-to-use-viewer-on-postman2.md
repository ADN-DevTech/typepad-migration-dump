---
layout: "post"
title: "Postman による Viewer 利用手順の理解 - 3 legged 認証"
date: "2016-12-12 00:01:27"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2016/12/understanding-steps-to-use-viewer-on-postman2.html "
typepad_basename: "understanding-steps-to-use-viewer-on-postman2"
typepad_status: "Publish"
---

<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8b90d5a970b-pi" style="float: left;"><img alt="Postman" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8b90d5a970b img-responsive" src="/assets/image_420272.jpg" style="margin: 0px 5px 5px 0px;" title="Postman" /></a><a href="http://adndevblog.typepad.com/technology_perspective/2016/12/3-legged-authentication-on-postman.html" rel="noopener noreferrer" target="_blank"></a></p>
<p><span style="background-color: #ffff00;">&lt;本記事は2019年12月10日に&#0160; Forge Viewer v7 にあわせて一部改定しています。&gt;</span></p>
<p><strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/12/3-legged-authentication-on-postman.html" rel="noopener noreferrer" target="_blank">前回</a></strong>、Postman で 3-legged 認証の Callback URL を使った認証プロセスの設定と方法をご紹介しました。今回は、認証後にユーザの A360 のプロジェクト内に保存されているデザイン ファイルにアクセスして、Viewer 上に 3D モデルを表示する手順をご案内していきます。<strong><a href="https://adndevblog.typepad.com/technology_perspective/2023/08/3lo-v2-on-postman.html" rel="noopener" target="_blank">Postman を使った 3-legged 認証・認可(OAuth v2)</a></strong><span style="background-color: #ffff00;">（2023年8月追記）</span><a href="https://adndevblog.typepad.com/technology_perspective/2023/08/3lo-v2-on-postman.html" rel="noopener" target="_blank"></a>を見比べていただくと、手順を含めた違いをご理解いただけるはずです。</p>
<ul>
<li><span style="background-color: #ffff00;">（2023年8月追記）</span>Authentication API（OAuth API）は v1 から v2 に移行しています。詳細は、<strong><a href="https://adndevblog.typepad.com/technology_perspective/2023/05/migration-guide-oauth2-v1-to-v2.html" rel="noopener" target="_blank">OAuth2 v1 から v2 への移行ガイド</a></strong>&#0160;の記事を確認してください。</li>
</ul>
<p>実際の手順と endpoint の説明に入る前に、A360 が持つ構造を見ていきます。2-legged 認証の際には、Object Storage Service（OSS）上に作成した Bucket を使って、デザイン ファイルをアップロード→変換→表示の順で使用していました。Forge アプリの開発者は、その開発者だけがアクセスする Bucket を操作対象にしていたので、データ アクセスに関わる操作はシンプルでした。</p>
<p>一方、A360 は少し複雑です。ストレージ内の論理構造は、次の図のようになっています。Forge では、Data Management API でこれらの構造にアクセスしていくことになりますが、ここでは、まず、基本的な役割と解説しておきます。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b8d2435014970c-pi" style="display: inline;"><img alt="Storage_structure" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b8d2435014970c image-full img-responsive" src="/assets/image_852814.jpg" title="Storage_structure" /></a></p>
<p><strong>Hub（ハブ）：</strong></p>
<p style="padding-left: 30px;">オートデスクには A360、Fusion Team、BIM 360 Team など、複数の異なるクラウド サービスがありますが、ユーザがこれらクラウド サービスを Subscription を購入した際には、必ず1つの Hub に関連付けられます。もし、他の Hub 上にある Project への招待を受け入れた場合には、本来関連付けられた Hub 以外の Hub にも関連付けられます。すなわち、1 つのアカウントで複数の Hub を持つことが出来ます。</p>
<p><strong>Project（プロジェクト）：</strong></p>
<p style="padding-left: 30px;">1 つの Hub には複数の Project を持つことが出来ます。Project を作成出来るのは Administrator 権限を持つユーザで、Hub 内に作成出来る Project 数は、無償版の 5 Project を除いて無制限です。Project 直下には、デザイン ファイルなど、アップロードしたファイルが <strong>Item（アイテム）</strong> という単位で格納されます。また、Project 直下に&#0160;<strong>Folder（フォルダ）</strong>を作成して、更に、その配下に Item を持つことも出来ます。Item と Folder は、A360 を利用するユーザによって任意にアップロード/作成されることになります。</p>
<p><strong>Version（バージョン）：</strong></p>
<p style="padding-left: 30px;">Item はバージョン管理の対象になります。同じ名前の Item を同じ場所（Project 直下、ないしは、Folder 直下）にアップロードすると、 Item の新しいバージョンとして認識されます。また、Fusion 360 のように、デザイン ファイルを直接編集して内容を更新した場合でも、新しいバージョンとして認識されます。Data Management API では、バージョン付けされた Item を、バージョンを指定して個々にアクセス出来るようになっています。指定された Item バージョンは、OSS 上に格納されたデザイン データと直接関連付けられています。</p>
<p>それでは、A360 上のデザインファイルを Forge Viewer で表示するまでの手順を、endpoint とともに見ていきましょう。なお、Access Token は、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/12/3-legged-authentication-on-postman.html" rel="noopener noreferrer" target="_blank">Postman による 3 legged 認証</a></strong>&#0160;の手順で既に取得しているものとします。</p>
<p><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b022ad3b943f4200b-pi" style="display: inline;"><img alt="Access_steps" border="0" class="asset  asset-image at-xid-6a0167607c2431970b022ad3b943f4200b image-full img-responsive" src="/assets/image_615273.jpg" title="Access_steps" /></a></p>
<p>ここでアクセスするストレージは、サインイン画面で A360 にサインインして、Forge アプリ（ここでは Postman）にアクセス許可を与えた <span style="text-decoration: underline;">A360 ユーザの</span>ストレージ領域になる点に注意してください。</p>
<p><strong>1.Hub へのアクセス&#0160;</strong></p>
<p style="padding-left: 30px;">アクセスするユーザがいくつの Hub に関連付けられているかは、調べてみないとわかりません。まずは、 <strong><a href="https://developer.autodesk.com/en/docs/data/v2" rel="noopener noreferrer" target="_blank">Data Management API</a></strong>&#0160;の&#0160;endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs</a></strong>、メソッド <strong>GET</strong> を使って、関連付けられた Hub のリストを取得してみます。</p>
<p style="padding-left: 30px;">この endpoint を呼び出すと、JSON レスポンスで返されます。この中に、関連付けられた Hub の情報が含まれています。この後の操作で、特定の Hub に含まれる Project → Folder → Item → Version の順にアクセスしていくことになります。特定の Hub の詳細情報にアクセスするには、ここで取得した JSON 内の &quot;<strong>id</strong>&quot; 値が必要となります。</p>
<pre style="padding-left: 30px;">{<br />  &quot;jsonapi&quot;: {<br />    &quot;version&quot;: &quot;1.0&quot;<br />  },<br />  &quot;links&quot;: {<br />    &quot;self&quot;: {<br />      &quot;href&quot;: &quot;https://developer.api.autodesk.com/project/v1/hubs&quot;<br />    }<br />  },<br />  &quot;data&quot;: [<br />    {<br />      &quot;type&quot;: &quot;hubs&quot;,<br />     <strong> &quot;id&quot;: &quot;a.YnVzaW5lc3M6bXlpMzYy&quot;,</strong><br />      &quot;attributes&quot;: {<br />        &quot;name&quot;: &quot;俊明 伊勢崎&quot;,<br />        &quot;extension&quot;: {<br />          &quot;type&quot;: &quot;hubs:autodesk.core:Hub&quot;,<br />          &quot;version&quot;: &quot;1.0&quot;,<br />          &quot;schema&quot;: {<br />            &quot;href&quot;: &quot;https://developer.api.autodesk.com/schema/v1/versions/hubs%3Aautodesk.core%3AHub-1.0&quot;<br />          },<br />          &quot;data&quot;: {}<br />        }<br />      },</pre>
<p style="padding-left: 30px;">特定の Hub へアクセスして詳細情報を取得するには、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-hub_id-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs/:hub_id</a></strong>、メソッド<strong>GET</strong> を利用します。<strong>:hub_id</strong> に当たる部分は、前述の&#0160;<strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs</a></strong>&#0160;から得られた当該 Hub の <strong>id</strong> となります。</p>
<p style="padding-left: 60px;"><strong> <span class="asset  asset-generic at-xid-6a0167607c2431970b01bb095dc2b4970d img-responsive"><a href="http://adndevblog.typepad.com/files/1.hub-%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9.postman_collection.json">1.Hub へのアクセス.postman_collectionをダウンロード</a></span></strong></p>
<p><strong>2.Project へのアクセス</strong></p>
<p style="padding-left: 30px;">アクセスしたいデザイン データを持つ Hub の情報を得られたら、次に、Hub 配下の Project を取得します。Hub 内のすべての Project を得るには、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-hub_id-projects-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs/:hub_id/projects</a></strong>、メソッド <strong>GET</strong> を利用します。このレスポンスで、すべての Project の情報が JSON で返されます。</p>
<p style="padding-left: 30px;">Project が持つ <strong>id</strong>&#0160;が分かれば、特定の Project 情報のみを取得することが出来ます。その場合、使用する endpoint は <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-hub_id-projects-project_id-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs/:hub_id/projects/:project_id</a></strong>、メソッドは <strong>GET</strong> です。もちろん、URI 中の&#0160;<strong>:hub_id</strong> は Hub の<strong> id</strong>、<strong>:project_id</strong> は Project の<strong> id</strong> です。</p>
<pre style="padding-left: 30px;">{<br />  &quot;jsonapi&quot;: {<br />    &quot;version&quot;: &quot;1.0&quot;<br />  },<br />  &quot;links&quot;: {<br />    &quot;self&quot;: {<br />      &quot;href&quot;: &quot;https://developer.api.autodesk.com/project/v1/hubs/a.YnVzaW5lc3M6bXlpMzYy/projects/a.YnVzaW5lc3M6bXlpMzYyIzIwMTYxMDE5NDcyODYyNTE&quot;<br />    }<br />  },<br />  &quot;data&quot;: {<br />    &quot;type&quot;: &quot;projects&quot;,<br />    <strong>&quot;id&quot;: &quot;a.YnVzaW5lc3M6bXlpMzYyIzIwMTYxMDE5NDcyODYyNTE&quot;,</strong><br />    &quot;attributes&quot;: {<br />      &quot;name&quot;: &quot;My Project&quot;,<br />      &quot;extension&quot;: {<br />        &quot;type&quot;: &quot;projects:autodesk.core:Project&quot;,<br />        &quot;version&quot;: &quot;1.0&quot;,<br />        &quot;schema&quot;: {<br />          &quot;href&quot;: &quot;https://developer.api.autodesk.com/schema/v1/versions/projects%3Aautodesk.core%3AProject-1.0&quot;<br />        },<br />        &quot;data&quot;: {}<br />      }<br />    },</pre>
<p style="padding-left: 30px;">このendpoint の呼び出しを実行すると、返される JSON レスポンスに Project 直下の Folder を表す&#0160;rootFolder 情報を得ることが出来ます。</p>
<p style="padding-left: 30px;">Project 直下の rootFolder には、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/hubs-hub_id-projects-project_id-topFolders-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/project/v1/hubs/:hub_id/projects/:project_id/topFolders</a></strong>、メソッド <strong>GET</strong> で直接アクセスすることも出来ます。</p>
<p style="padding-left: 60px;"><strong> <span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d2448022970c img-responsive"><a href="http://adndevblog.typepad.com/files/2.project-%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9.postman_collection.json">2.Project へのアクセス.postman_collectionをダウンロード</a></span></strong></p>
<p><strong>3.Folder へのアクセス</strong></p>
<p style="padding-left: 30px;">Project 直下の&#0160;rootFolder にアクセスすることが出来たら、その配下の Item、または、Folder にアクセスすることが出来るようになります。Folder 内には、Item か Folder が格納されていると考えられます。すべてをリストするには、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-folders-folder_id-contents-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/folders/:folder_id/contents</a></strong>、メソッド <strong>GET</strong> を使用します。ここで返される JSON 中で、Type 値が&#0160;&quot;folders&quot; になっているのが、rootFolder 内の Folder、同じく、Type 値が &quot;items&quot; になっているのが Item です。それぞれ、id &#0160;を持っているので、適切な endpoint で指定することで、Folder や Item の詳細を得ることが出来ます。</p>
<p style="padding-left: 30px;">特定の Folder の&#0160;id が分かれば、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-folders-folder_id-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/folders/:folder_id</a></strong>、メソッド <strong>GET</strong> で Folder 詳細を取得することもできます。</p>
<p style="padding-left: 60px;"><strong><span class="asset  asset-generic at-xid-6a0167607c2431970b01b7c8e7f654970b img-responsive"> <span class="asset  asset-generic at-xid-6a0167607c2431970b0282e1538366200b img-responsive"><a href="https://adndevblog.typepad.com/files/3.folder-%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9.postman_collection-1.json">3.folder-へのアクセス.postman_collectionをダウンロード</a></span></span></strong></p>
<p><strong>4.Item へのアクセス</strong></p>
<p style="padding-left: 30px;">Item は、実際に A360 にアップロードしたファイルに相当します。特定の Item に辿り着くことが出来れば、3D モデルや 2D 図面の表示をおこなうことが出来ることになります。注意が必要なのは、変換処理です。2-legged 認証時には、Bucket へデザイン ファイルをアップロードして、Viewer 表示用に変換する処理は、Forge アプリを開発する開発者がプログラムでおこなう必要がありました。A360 クラウドサービスの場合、A360 のユーザがデザイン ファイルをアップロードすると、A360 上での表示のため、A360 自身が自動的に変換処理をおこないます。従って、もし、A360 による変換処理が完了していて、かつ、Viewable と呼ばれる SVF ファイルが生成されていれば、そのドキュメント ID（URN）を取得することで、直ぐに JavaScript コードを介してクライアントの Web ブラウザでデザインを表示することが出来ます。</p>
<p style="padding-left: 30px;">残念ながら、Folder 内保存されている Item 一覧だけを取得する API はされていないので、<strong>3.Folder へのアクセス&#0160;</strong>で紹介した endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-folders-folder_id-contents-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/folders/:folder_id/contents</a></strong>、メソッド <strong>GET&#0160;</strong>で目的の Item の id を得る必要があります。</p>
<p style="padding-left: 30px;">目的の Item の id が取得できたら、Item 詳細を取得出来ます。使用する endpoint は <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-items-item_id-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/items/:item_id</a></strong>、メソッドは <strong>GET</strong> です。この endpoint で取得した JSON には、Item に複数の Version が存在している場合でも、常に最新の Version 情報が含まれます。取得した Item の Version は、&quot;versionNumber&quot; の値で判別することが可能です。</p>
<pre style="padding-left: 30px;">&#0160; &quot;included&quot;: [<br />  {<br />    &quot;type&quot;: &quot;versions&quot;,<br />    &quot;id&quot;: &quot;urn:adsk.wipprod:fs.file:vf.gBoEOhq6SIacqwFPaVx9pA?version=3&quot;,<br />    &quot;attributes&quot;: {<br />      &quot;name&quot;: &quot;Diesel_Car_JNR.f3d&quot;,<br />      &quot;displayName&quot;: &quot;Diesel_Car_JNR.f3d&quot;,<br />      &quot;createTime&quot;: &quot;2016-12-09T02:08:42.0000000Z&quot;,<br />      &quot;createUserId&quot;: &quot;200708030638689&quot;,<br />      &quot;lastModifiedTime&quot;: &quot;2016-12-09T02:08:42.0000000Z&quot;,<br />      &quot;lastModifiedUserId&quot;: &quot;200708030638689&quot;,<br />      <strong>&quot;versionNumber&quot;: 3,</strong><br />      &quot;mimeType&quot;: &quot;application/vnd.autodesk.f3d&quot;,<br />      &quot;storageSize&quot;: 49945660,<br />      &quot;fileType&quot;: &quot;f3d&quot;,<br />      &quot;extension&quot;: {<br />        &quot;type&quot;: &quot;versions:autodesk.core:File&quot;,<br />        &quot;version&quot;: &quot;1.0&quot;,<br />        &quot;schema&quot;: {<br />          &quot;href&quot;: &quot;https://developer.api.autodesk.com/schema/v1/versions/versions%3Aautodesk.core%3AFile-1.0&quot;<br />        },<br />        &quot;data&quot;: {}<br />      }<br />    },</pre>
<p style="padding-left: 30px;">もし、JSON 内に &quot;derivatives&quot; が存在している場合、A360 が変換処理を実行した形跡と考えることが出来ます。&quot;derivatives&quot; &#0160;セクション内の id 値が、ドキュメントID、つまり、URN になります。</p>
<pre style="padding-left: 30px;"><span class="pl-c"> &quot;derivatives&quot;: {<br />   &quot;data&quot;: {<br />     &quot;type&quot;: &quot;derivatives&quot;,<br />     <strong>&quot;id&quot;: &quot;dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLmdCb0VPaHE2U0lhY3F3RlBhVng5cEE_dmVyc2lvbj0z&quot;</strong><br />   },</span>
</pre>
<p style="padding-left: 30px;">ただし、ここに id を見つけることが出来ても、そのまま Forge Viewer に表示出来るとは限りません。この場合、A360 などのクラウドサービスか、Model Derivative API が変換した際の Manifest（マニフェスト）をチェックしてみてください。Manifest は、デザイン ファイルの変換時に変換状況や結果を記したもので、endpoint <strong><a href="https://developer.autodesk.com/en/docs/model-derivative/v2/reference/http/urn-manifest-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/modelderivative/v2/designdata/:urn/manifest</a></strong>、メソッド GET で JSON を取得することが出来ます。Manifest 内の &quot;derivative&quot; セクションで、変換結果を示す &quot;status&quot; 値が <strong>success</strong>、変換処理の進行状況を示す&quot;progress&quot; 値が<strong> complete</strong>、変換後の形式を示す &quot;outputType&quot; 値が Viewer 表示用の<strong> svf</strong> であるなら、ドキュメントID（URN）を指定して 3D モデルを表示させることが出来るはずです。</p>
<pre style="padding-left: 30px;">{<br />  &quot;type&quot;: &quot;manifest&quot;,<br />  &quot;hasThumbnail&quot;: &quot;true&quot;,<br />  &quot;status&quot;: &quot;success&quot;,<br />  &quot;progress&quot;: &quot;complete&quot;,<br />  &quot;region&quot;: &quot;US&quot;,<br />  &quot;urn&quot;: &quot;dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLmdCb0VPaHE2U0lhY3F3RlBhVng5cEE_dmVyc2lvbj0x&quot;,<br />  &quot;version&quot;: &quot;1.0&quot;,<br />  &quot;derivatives&quot;: [<br />    {<br />      &quot;name&quot;: &quot;Diesel_Car_JNR.f3d&quot;,<br />      &quot;hasThumbnail&quot;: &quot;true&quot;,<br /><strong>      &quot;status&quot;: &quot;success&quot;,</strong><br /><strong>      &quot;progress&quot;: &quot;complete&quot;,</strong><br /><strong>      &quot;outputType&quot;: &quot;svf&quot;,</strong><br />      &quot;children&quot;: [<br />        {</pre>
<p style="padding-left: 30px;">Item が持つすべてのバージョンの詳細を取得する場合には、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-items-item_id-versions-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/items/:item_id/versions</a></strong>、メソッド <strong>GET</strong> を利用することも出来ます。返される JSON には、各 Version の指定で利用する id （URN ）が含まれます。&#0160;</p>
<p style="padding-left: 60px;"><strong> <span class="asset  asset-generic at-xid-6a0167607c2431970b01b7c8bac55a970b img-responsive"><a href="http://adndevblog.typepad.com/files/4.item%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9.postman_collection.json">4.Itemへのアクセス.postman_collectionをダウンロード</a></span></strong></p>
<p><strong>5.Version アクセス</strong></p>
<p style="padding-left: 30px;">A360 は、Version 毎に異なる id（URN）を保持していますので、A360 上の操作で特定の Version を削除しない限り、指定した Version 情報を取得して個別に Viewer で表示するようなことも出来ます。<strong>4.Item へのアクセス</strong><strong>&#0160;</strong>で紹介した endpoint&#0160;<strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-items-item_id-versions-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/items/:item_id/versions</a></strong>、メソッド <strong>GET</strong> で、参照したい Version のid を取得してください。&#0160;</p>
<pre style="padding-left: 30px;">&#0160; {<br />    &quot;type&quot;: &quot;versions&quot;,<br />   <strong> &quot;id&quot;: &quot;urn:adsk.wipprod:fs.file:vf.gBoEOhq6SIacqwFPaVx9pA?version=1&quot;,</strong><br />    &quot;attributes&quot;: {<br />      &quot;name&quot;: &quot;Diesel_Car_JNR.f3d&quot;,<br />        &quot;displayName&quot;: &quot;Diesel_Car_JNR.f3d&quot;,<br />        &quot;createTime&quot;: &quot;2016-12-06T05:01:30.0000000Z&quot;,<br />        &quot;createUserId&quot;: &quot;200708030638689&quot;,<br />        &quot;lastModifiedTime&quot;: &quot;2016-12-06T05:01:30.0000000Z&quot;,<br />        &quot;lastModifiedUserId&quot;: &quot;200708030638689&quot;,<br />        <strong>&quot;versionNumber&quot;: 1,</strong><br />        &quot;mimeType&quot;: &quot;application/vnd.autodesk.f3d&quot;,<br />        &quot;storageSize&quot;: 49943955,<br />        &quot;fileType&quot;: &quot;f3d&quot;,<br />        &quot;extension&quot;: {<br />          &quot;type&quot;: &quot;versions:autodesk.core:File&quot;,<br />          &quot;version&quot;: &quot;1.0&quot;,<br />          &quot;schema&quot;: {<br />            &quot;href&quot;: &quot;https://developer.api.autodesk.com/schema/v1/versions/versions%3Aautodesk.core%3AFile-1.0&quot;<br />          },<br />        &quot;data&quot;: {}<br />      }<br />   },</pre>
<p style="padding-left: 30px;">個々の id が取得出来たら、endpoint <strong><a href="https://developer.autodesk.com/en/docs/data/v2/reference/http/projects-project_id-versions-version_id-GET/" rel="noopener noreferrer" target="_blank">https://developer.api.autodesk.com/data/v1/projects/:project_id/versions/:version_id</a></strong>、メソッド <strong>GET</strong> で、指定した Version 情報を得ることが出来ます。このとき、Version の id は、<strong><a href="https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%BC%E3%82%BB%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0" rel="noopener noreferrer" target="_blank">URL encode（URL エンコード）</a></strong>&#0160;する必要があります。URL encode は、<strong><a href="http://www.urlencoder.org/" rel="noopener noreferrer" target="_blank">http://www.urlencoder.org/</a></strong>&#0160;サイトでおこなうことが出来ます。例えば、上記 JSON にある urn:adsk.wipprod:fs.file:vf.gBoEOhq6SIacqwFPaVx9pA?version=1 は、urn%3Aadsk.wipprod%3Afs.file%3Avf.gBoEOhq6SIacqwFPaVx9pA%3Fversion%3D1 にエンコードされるはずです。</p>
<p style="padding-left: 30px;">取得した JSON から&#0160;&quot;derivatives&quot; 配下の&#0160;id 値を読み取ってください。この値が、その Version の URN になります。もちろん、その URN で直ぐに表示可能か否かは、Model Derivative API で Manifest をチェックすることで判別可能です。</p>
<p style="padding-left: 60px;"><strong> <span class="asset  asset-generic at-xid-6a0167607c2431970b01b7c8bac560970b img-responsive"><a href="http://adndevblog.typepad.com/files/5.version-%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9.postman_collection.json">5.Version へのアクセス.postman_collectionをダウンロード</a></span></strong></p>
<p><strong>6.&#0160;クライアントからのアクセス</strong></p>
<p style="padding-left: 30px;">ここまでの手順で Viewer に表示する URN を得ることが出来たことになります。</p>
<p>次の HTML ファイルをダウンロードして、accessToken パラメータに Access Token を、urn パラメータに SVF ファイル変換が終了したデザイン ファイルの URN を与えてみてください。</p>
<p><strong><span class="asset  asset-generic at-xid-6a0167607c2431970b0240a4cf4776200d img-responsive"><a href="https://adndevblog.typepad.com/files/viewer.htm">Viewer.htm をダウンロード</a></span></strong></p>
<p><span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d222c3e4970c img-responsive">Viewer.htmの後に ? でパラメータを接続して、パラメータ間は &amp; で統合します。例えば、Access Token が&#0160;<span style="background-color: #ffff80;">eyJhbGciOiJIUzI1NiIsImtpZCI6Imp3dF9zeW1tZXRyaWNfa2V5In0.eyJjbGllbnRfaWQiOiJWMlpQcmNaR242eWVqTXRSNzZHM2lMR2pxRng&#0160;</span>、ドキュメント ID（URN）が&#0160;<span style="background-color: #bfffff;">dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6ZnBkLWphcGFuLXNhbXBsZS1idWNrZXQvQmlrZSUyMGZyYW1lLmYzZA==&#0160;</span>の場合、C:\Forge-Workshop フォルダにダウンロード済みの Viewer.htm で表示するには、次のような指定で表示するドキュメントを引き渡すことが出来ます。</span></p>
<p><span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d222c3e4970c img-responsive">file:///C:/Forge-Workshop/viewer.htm?accessToken=<span style="background-color: #ffff80;">eyJhbGciOiJIUzI1NiIsImtpZCI6Imp3dF9zeW1tZXRyaWNfa2V5In0.eyJjbGllbnRfaWQiOiJWMlpQcmNaR242eWVqTXRSNzZHM2lMR2pxRng</span>&amp;urn=<span style="background-color: #bfffff;">dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6ZnBkLWphcGFuLXNhbXBsZS1idWNrZXQvQmlrZSUyMGZyYW1lLmYzZA==</span></span></p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8ba5f5e970b-pi" style="display: inline;"><img alt="Different_version" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8ba5f5e970b img-responsive" src="/assets/image_289354.jpg" style="width: 800px;" title="Different_version" /></a></p>
<ul>
<li><span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d222c3e4970c img-responsive">この HTML ファイルでは、URL パラメータに Access Token を指定しますが、表示確認を目的としたサンプルのためです。通常、Consumer Key、Consumer Secret も含め、Access Token の内容を含む実装は Web サーバー側の実装で隠蔽すべきです。</span></li>
<li><span class="asset  asset-generic at-xid-6a0167607c2431970b01b8d222c3e4970c img-responsive">URL パラメータとして Access Token を渡した場合、Web ブラウザが持つ&#0160;<strong><a href="https://developer.mozilla.org/ja/docs/Web/HTTP/HTTP_access_control" rel="noopener noreferrer" target="_blank">CORS(Cross-Origin Resource Sharing)</a></strong>&#0160; を抑止するセキュリティ上の制限によって、表示が出来ない場合があります（ブラウザ依存）。Google Chrome の場合には、No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. 等のエラーが発生してしまいますので、Chrome の起動ショートカットにパラメータ、<strong>--disable-web-security --user-data-dir</strong>、または、<strong>--allow-file-access-from-files --allow-file-access --allow-cross-origin-auth-prompt</strong> を指定することで、このセキュリティ機能を無効化して開発時のテストをおこなうことが出来ます。もちろん、一般利用時には、この設定での Chrome 起動はお勧めしません。ご注意ください。<br /><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb09fe359d970d-pi" style="display: inline;"><img alt="Chrome_disable_web_security" class="asset  asset-image at-xid-6a0167607c2431970b01bb09fe359d970d img-responsive" src="/assets/image_461296.jpg" title="Chrome_disable_web_security" /></a><br /></span></li>
</ul>
<p>ここでは、Folder に新しい Item、Version をアップロードしたり、アップロードした Item や Version を変換する endpoint には言及していませんが、適切な endpoint を使用することで、それらを実装することも出来ます。ここまでの内容で、 Forge が提供する Data Management API や Model Derivative API の RESTful API の利用方法は把握できるかと思います、後は、Forge&#0160; ポータルのリファレンスを参照しながら、Postman で各 endpoint をお試しいただけるはずです。&#0160;</p>
<p>By Toshiaki Isezaki</p>
