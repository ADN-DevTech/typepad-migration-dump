---
layout: "post"
title: "AutoCAD 2018 のカスタマイズ互換性"
date: "2017-04-05 00:26:51"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "デスクトップ製品"
original_url: "https://adndevblog.typepad.com/technology_perspective/2017/04/autocad-2018-interoperability-for-customization.html "
typepad_basename: "autocad-2018-interoperability-for-customization"
typepad_status: "Publish"
---

<p>今回は、カスタマイズを含む AutoCAD 2018 の互換性についてご案内します。AutoCAD 2018 自体の新機能については、次のブログ記事をご確認ください。</p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/03/new-features-on-autocad-2018-part1.html" rel="noopener noreferrer" target="_blank">AutoCAD 2018の新機能 ～ その1</a></strong></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/03/new-features-on-autocad-2018-part2.html" rel="noopener noreferrer" target="_blank">AutoCAD 2018 の新機能 ～ その2</a></strong></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/03/new-features-on-autocad-2018-part3.html" rel="noopener noreferrer" target="_blank">AutoCAD 2018 の新機能 ～ その3</a></strong></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/03/new-features-on-autocad-2018-part4.html" rel="noopener noreferrer" target="_blank">AutoCAD 2018 の新機能 ～ その4</a></strong></p>
<p><strong>図面ファイル形式</strong></p>
<p style="padding-left: 30px;"><strong><a href="http://adndevblog.typepad.com/technology_perspective/2017/03/new-features-on-autocad-2018-part4.html" rel="noopener noreferrer" target="_blank">AutoCAD 2018 の新機能 ～ その4</a></strong> でもご案内していますが、AutoCAD 2018、AutoCAD LT 2018 では、新しく <strong>2018 図面ファイル形式</strong>&#0160;が採用されています。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb098d6b2d970d-pi" style="display: inline;"><img alt="Dwg_compatible" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb098d6b2d970d image-full img-responsive" src="/assets/image_913262.jpg" title="Dwg_compatible" /></a><br />もちろん、旧バージョンとのデータ交換に必要な下位図面ファイル形式の保存機能も備えています。</p>
<p style="padding-left: 30px;"><strong>図面読み込み：</strong></p>
<ul style="list-style-type: square;">
<li>すべての AutoCAD バージョンで作成した DWG ファイル</li>
<li>すべての AutoCAD バージョンで作成した DXF ファイル</li>
</ul>
<p style="padding-left: 30px;"><strong>図面の保存：</strong></p>
<ul style="list-style-type: square;">
<li>R14, 2000, 2004, 2007, 2010, 2013, 2018 形式の DWG ファイル</li>
<li>R12, 2000, 2004, 2007, 2010, 2013, 2018&#0160; 形式の DXF ファイル</li>
</ul>
<p style="padding-left: 30px;">すべての図面ファイルで明確な恩恵を体感出来るわけではありませんが、今回の 2018 DWG ファイル形式の採用で、図面保存時のパフォーマンスが向上しています。過去の図面ファイル形式の改変理由については、過去のブログ記事 <strong><a href="http://adndevblog.typepad.com/technology_perspective/2014/08/reason-for-updating-drawing-format.html" rel="noopener noreferrer" target="_blank">図面ファイル形式の更新について</a></strong>&#0160;を参照してみてください。</p>
<p style="padding-left: 30px;">なお、AutoCAD 2016 から DWG 図面ファイルへのパスワード設定の機能は削除されていますのでご注意ください。詳しくは、ブログ記事 <strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/04/autocad-2016-interoperability-for-customization.html" rel="noopener noreferrer" target="_blank">AutoCAD 2016 のカスタマイズ互換性</a></strong>&#0160;で触れていますので、必要に応じてご確認ください。</p>
<p><strong>アドイン アプリケーションの互換性</strong></p>
<p style="padding-left: 30px;">AutoCAD 2018 は、引き続き、AutoLISP/Visual LISP、ActiveX オートメーション（COM）、ObjectARX、.NET API、JavaScript API の 5 &#0160;つの AutoCAD API をサポートします。今回のリリースは前リリースから&#0160;<strong>バイナリ非互換リリース&#0160;</strong>となるため、前リリース用に各 AutoCAD API 作成されたアドイン アプリケーションは移植作業が必要になります。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8e77489970b-pi" style="display: inline;"><img alt="Api_compatibility" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8e77489970b image-full img-responsive" src="/assets/image_306475.jpg" title="Api_compatibility" /></a></p>
<p style="padding-left: 30px;"><strong>ObjectARX</strong></p>
<p style="padding-left: 30px;">既存の ObjectARX プロジェクトは、<strong><a href="http://www.autodesk.com/objectarx" rel="noopener noreferrer" target="_blank">ObjectARX SDK for AutoCAD 2018</a> </strong>を参照して新しい開発環境となる <strong>Visual Studio 2015 Update 3</strong>で再ビルドする必要があります。旧バージョンの Visual Studio で作成した プロジェクト は、Visual Studio 2015 で開くことで自動的にアップグレードされて、「プラットフォーム ツールセット」が <strong>Visual Studio 2015(v140)</strong> に変更されます。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c853f520970b-pi"><img alt="Upgrade_arx_project_for_vs2015" class="asset  asset-image at-xid-6a0167607c2431970b01b7c853f520970b img-responsive" src="/assets/image_943497.jpg" title="Upgrade_arx_project_for_vs2015" /></a></p>
<p style="padding-left: 30px;">あとは、リンクするスタティック リンク ライブラリを&#0160;<strong>*</strong><strong>22.lib</strong>&#0160;に変更するだけです。例えば、AutoCAD 2017 時に Visual Studio 2015 で参照していた&#0160;ac1st21.lib は、AutoCAD 2018 用に ac1st22.lib に置き換えてください。</p>
<p style="padding-left: 30px;">ObjectARX でカスタム オブジェクトを定義していて、COM サーバーとしてオブジェクト、メソッド、プロパティを COM で公開している場合には、.idl ファイルでインポートしているタイプライブラリも&#0160;<strong>axdb22enu.tlb</strong> ないし、<strong>axdb22jpn.tlb</strong> に置き換える必要があります。</p>
<p style="padding-left: 30px;">2018 で廃止、変更されたクラスや関数については、<strong><a href="http://www.autodesk.com/objectarx" rel="noopener noreferrer" target="_blank">http://www.autodesk.com/objectarx</a></strong> からダウンロード可能な&#0160;ObjectARX SDK for AutoCAD 2018 のインストール後、docs フォルダの <strong>Reference Guide（arxref.chm）</strong>の<strong> ObjectARX Migration Guide</strong> セクションを確認してみてください。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8dfc022970b-pi" style="display: inline;"><img alt="Oarx_migration_guide" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8dfc022970b image-full img-responsive" src="/assets/image_525972.jpg" title="Oarx_migration_guide" /></a><br /><strong>.NET API</strong></p>
<p style="padding-left: 30px;">サポートされる .NET Framework は .NET Framework &#0160;4.6 です。このため、前バージョンの AutoCAD 2017 用に作成されたアドイン アプリケーションは、そのままロードして実行できるはずです。ただ、可能であれば、AutoCAD 2018 のアセンブリ ファイルを参照して再ビルドすることをお勧めします。もちろん、一部のクラスやメソッド、プロパティが変更されている場合がありますので、その場合には、ソースコードに適切な変更を加える必要があります。</p>
<p style="padding-left: 30px;">2018 で廃止、変更されたクラスやメソッド、プロパティについては、<strong><a href="http://www.autodesk.com/objectarx" rel="noopener noreferrer" target="_blank">http://www.autodesk.com/objectarx</a></strong>&#0160;からダウンロード可能な&#0160;ObjectARX SDK for AutoCAD 2018 のインストール後、docs フォルダの <strong>Managed Class Reference Guide（arxmgd.chm）</strong>の <strong>.NET Migration Guide</strong> セクションを確認してみてください。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb0982f128970d-pi" style="display: inline;"><img alt="Dotnet_migration_guide" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01bb0982f128970d image-full img-responsive" src="/assets/image_411958.jpg" title="Dotnet_migration_guide" /></a></p>
<p style="padding-left: 30px;"><strong>AutoLISP/ActiveX オートメーション（COM）/JavaScript</strong></p>
<p style="padding-left: 30px;">前バージョン用に作成されたアドイン アプリケーションは、そのままロードして実行できるはずです。こちらも、可能であれば、新しいバージョンのタイプライブラリを参照しなおしてテストすることをお勧めします。タイプライブラリの詳細は、AutoCAD 2018 の<strong><a href="http://help.autodesk.com/view/ACD/2018/JPN/?guid=GUID-927E71C2-E515-438E-9D7A-246D97BEF93F" rel="noopener noreferrer" target="_blank">オンラインヘルプ</a></strong>をご確認ください。</p>
<p style="padding-left: 30px;">VBA をお使いの場合、VBA コンポーネントは<a href="http://www.autodesk.com/vba-download" rel="noopener noreferrer" target="_blank"> h<strong>ttp://www.autodesk.com/vba-download</strong></a>&#0160;から参照可能な Autodesk &#0160;Knowledge Network 記事からダウンロードすることが出来ます。<strong><a href="http://www.autodesk.com/vba-download-jpn" rel="noopener noreferrer" target="_blank">http://www.autodesk.com/vba-download-jpn</a>&#0160;</strong>を参照すれば、日本語の&#0160;Autodesk &#0160;Knowledge Network 記事を表示させることも出来ます。</p>
<p style="padding-left: 30px;">JavaScript ライブラリには変更はありませんので移植作業は不要です。</p>
<p style="padding-left: 30px;">その他、アドイン アプリケーションの互換性に関する情報は、AutoCAD 2018 の<strong><a href="http://help.autodesk.com/view/ACD/2018/JPN/?guid=GUID-E69C877D-F84B-4282-807D-E084C931D533" rel="noopener noreferrer" target="_blank">オンライン ヘルプ</a></strong>をご参照ください。&#0160;&#0160;</p>
<p><strong>AutoCAD 2014 以前からアドインを移植される際の注意</strong></p>
<p style="padding-left: 30px;">AutoCAD 2015 より前のリリースからアドイン アプリケーションを移植する場合には、リリース毎に加えられたアーキテクチャとセキュリティ仕様等の変更に注意が必要です。特に、次に説明する点は単なる移植ではなく、コードの変更やアプリケーション構成の見直しが必要になる場合があります。</p>
<p style="padding-left: 30px;"><strong>ファイバー削除</strong></p>
<p style="padding-left: 30px;">AutoCAD 2015 では、AutoCAD ウィンドウ内に複数の図面を表示させることが出来るようになった AutoCAD 2000 以降、初めてとなる大きな変更が加えられています。AutoCAD 2014 までは、 図面を表示する子ウィンドウ間の切り替え処理に「ファイバー」という機構が利用されてきましたが、Microsoft 社がファイバーのサポートを終了するのにあわせ、AutoCAD 2015 ではファイバーを使用しない仕組みを導入しています。これが「ファイバー削除」と呼ばれる所以です。</p>
<p style="padding-left: 30px;">ファイバー削除によって、子ウィンドウの切り替え時の振る舞いに仕様変更が加えられています。また、ドキュメントの切り替えなど、各種 API を利用してイベントの発生順序に依存するような処理を実装している場合には、従来の構成が期待通り動作しない可能性もあります。AutoCAD 2015 で導入されたファイバー削除の影響については、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2014/04/autocad-2015-interoperability-for-customization.html" rel="noopener noreferrer" target="_blank">AutoCAD 2015 のカスタマイズ互換性</a>&#0160;</strong>の&#0160;<strong>ファイバー削除の影響 </strong>項をご参照ください。</p>
<p style="padding-left: 30px;"><strong>ゼロドキュメントの状態</strong>&#0160;</p>
<p style="padding-left: 30px;">AutoCAD 2015 では、いままでのバージョンのように、起動直後に図面を表示する図面子ウィンドウは表示されません。既定では [新しいタブ] が表示されます（AutoCAD 2016 以降は [スタート] タブに名称変更）。ObjectARX や AutoCAD .NET API を使ったアプリケーションがアクティブなドキュメント（AcApDocument、Document）や図面データベース（AcDbDatabase、Database）を参照している場合には、図面が表示されていない状態、つまり、ゼロドキュメント状態 を想定したプログラム改修が必要です。例えば、現在アクティブな図面データベースの取得を実装している場合には、acdbHostApplicationServices()-&gt;workingDatabase() や&#0160;HostApplicationServices.WorkingDatabase の戻り値が、null、Null、Nothing（言語によって異なる）でないことを明示的に確認する必要があります。</p>
<p style="padding-left: 30px;">&#0160;<strong>デジタル署名</strong></p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8e30532970b-pi" style="float: right;"><img alt="Addin_security" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8e30532970b img-responsive" src="/assets/image_935300.jpg" style="width: 80px; margin: 0px 0px 5px 5px;" title="Addin_security" /></a>AutoCAD 2016 以降、セキュリティ向上の観点から、使用する API の種類を問わず、すべてのアドイン アプリケーションにはデジタル署名が求められます。デジタル署名のないアドインを AutoCAD にロードしようとすると、警告メッセージが表示されますのでご注意ください。アドイン アプリケーションに対するデジタル署名埋め込みの詳細については、ブログ記事 <strong><a href="http://adndevblog.typepad.com/technology_perspective/2015/08/security-on-autocad-2016-and-digital-signature-to-addin.html" rel="noopener noreferrer" target="_blank">AutoCAD 2016 のセキュリティとアドインのデジタル署名</a></strong>&#0160;をご確認ください。この内容は、AutoCAD 2018 にも当てはまります。</p>
<p style="padding-left: 30px;"><strong>メニュー ボタン</strong></p>
<p style="padding-left: 30px;">旧バージョンでカスタム ボタンの背景を透明に表現する目的で使用できた RGB 値、192,192,192 の色指定は、仕様変更によって AutoCAD 2017 から無効になっています。このため、AutoCAD 2017 以降のバージョンで透過性を持つカスタム ボタンのイメージを利用するためには、BMP ファイル形式ではなく、標準で透過性をサポートする PNG ファイルをお使いください。</p>
<p style="padding-left: 30px;">PNG ファイルへの変換手順は、AutoCAD 2018 オンライン ヘルプの<strong><a href="http://help.autodesk.com/view/ACD/2018/JPN/?guid=GUID-94A0EA14-5165-4D84-A2F1-F44D33F80BCC" rel="noopener noreferrer" target="_blank">記事</a></strong>をご確認ください。もし、リソース DLL でカスタム ボタンのビットマップ イメージを管理される場合は、ブログ記事&#0160;<strong><a href="http://adndevblog.typepad.com/technology_perspective/2016/07/resource-only-dll-with-png-files.html" rel="noopener noreferrer" target="_blank">PNG ファイルを使ったリソース DLL</a></strong>&#0160;に PNG ファイルを使ったリソース DLL ファイルの作成方法をご紹介していますのでご参照ください。<br />この方法で、ダークテーマとライトテーマの両方を 1 つの画像ファイルでサポート出来るようになります。</p>
<p><strong>Windows 10 での &#0160;Wizards の問題</strong></p>
<p style="padding-left: 30px;">オートデスクは、AutoCAD アドイン開発用に Visual Studio のスケルトン プロジェクトを作成する Wizards を、.NET API 用と ObjectARX 用にそれぞれ提供しています。両 Wizards は、<a href="http://www.autodesk.com/developautocad" rel="noopener noreferrer" target="_blank">http://www.autodesk.com/developautocad</a>&#0160;から入手することが出来ます。両者とも msi 形式のインストーラで Visual Studio 2015 Update 3 がセットアップされた開発環境にインストールすることが出来ますが、インストーラ自体にデジタル署名が施されていないため、インストール時に警告メッセージが表示されてしまう問題があります。</p>
<p style="padding-left: 30px;">インストール開始時に「Windows によって PC が保護されました」とメッセージが表示されたら、画面上に表示されてる <strong>詳細情報</strong>&#0160;リンクをクリックして、[実行] ボタンからインストールをしてみてください。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb098678b2970d-pi" style="display: inline;"><img alt="Install_wizard_onto_win10_1" class="asset  asset-image at-xid-6a0167607c2431970b01bb098678b2970d img-responsive" src="/assets/image_675292.jpg" style="width: 600px;" title="Install_wizard_onto_win10_1" /></a></p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb098678b9970d-pi" style="display: inline;"><img alt="Install_wizard_onto_win10_2" class="asset  asset-image at-xid-6a0167607c2431970b01bb098678b9970d img-responsive" src="/assets/image_815687.jpg" style="width: 600px;" title="Install_wizard_onto_win10_2" /></a></p>
<p style="padding-left: 30px;"><strong>Windows 10 への ObjectARX Wizards のインストール</strong></p>
<p style="padding-left: 30px;">ObjectARX Wizards を Windows 10 にインストールする場合にも、上記の方法を使用してインストール自体を完了することは出来ます。ただし、Visual Studio 2015 Update 3 上でインストールされた ObjectARX 2018 Wizards を起動し て&#0160;<strong>ObjectARX/DBX Project テンプレート</strong>を指定し、新規プロジェクトを作成しようとしても、何も処理されません。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01bb098694dd970d-pi" style="display: inline;"><img alt="Failed_on_win10" class="asset  asset-image at-xid-6a0167607c2431970b01bb098694dd970d img-responsive" src="/assets/image_95130.jpg" style="width: 800px;" title="Failed_on_win10" /></a></p>
<p style="padding-left: 30px;">この問題を回避するには、Windows 10 上でコマンド プロンプトを管理者モードで起動して、<strong><a href="https://msdn.microsoft.com/ja-jp/library/cc759262%28v=ws.10%29.aspx" rel="noopener noreferrer" target="_blank">msiexec</a></strong> を使って ObjectARX Wizard をインストールしてください。コマンド プロンプトを管理者モードで起動するには、スタート ボタンから [Windows システム ツール] &gt;&gt; [コマンド プロンプト] を見つけて、マウスの右ボタン メニューから [その他] &gt;&gt; [管理者として実行] を選択します。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8e34658970b-pi" style="display: inline;"><img alt="Launch_command_prompt" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8e34658970b img-responsive" src="/assets/image_443016.jpg" style="width: 800px;" title="Launch_command_prompt" /></a></p>
<p style="padding-left: 30px;">コマンド プロンプト上で misexec の実行する際には、<strong>msiexec /i ObjectARXWizards.msi</strong> と入力をしてください。</p>
<p style="padding-left: 30px;"><a class="asset-img-link" href="http://adndevblog.typepad.com/.a/6a0167607c2431970b01b7c8e3469c970b-pi" style="display: inline;"><img alt="Execute_misexec" border="0" class="asset  asset-image at-xid-6a0167607c2431970b01b7c8e3469c970b image-full img-responsive" src="/assets/image_830043.jpg" title="Execute_misexec" /></a></p>
<p><strong>AutoCAD .NET API の参照アセンブリ</strong></p>
<p style="padding-left: 30px;">以前、<strong><a href="http://adndevblog.typepad.com/technology_perspective/2014/12/nugetorg-and-autocadnet-api.html" rel="noopener noreferrer" target="_blank">NuGet と AutoCAD.NET API</a></strong>&#0160;のブログ記事でもご案内したのと同様に、AutoCAD 2018 上で .NET API で使用する際に参照するアセンブリは、Visual Studio 上の NuGet パッケージ マネージャか、オンラインで入手することも出来ます。当該 NuGet ページは&#0160;<a href="https://www.nuget.org/packages/AutoCAD.NET/22.0.0">https://www.nuget.org/packages/AutoCAD.NET/22.0.0</a>&#0160;です。&#0160;</p>
<p>By Toshiaki Isezaki</p>
