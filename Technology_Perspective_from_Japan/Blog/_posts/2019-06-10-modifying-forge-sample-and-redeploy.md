---
layout: "post"
title: "Web アプリのデプロイ：Forge サンプルの改編とデプロイ"
date: "2019-06-10 00:07:54"
author: "Toshiaki Isezaki"
categories:
  - "API カスタマイズ"
  - "クラウドサービス"
original_url: "https://adndevblog.typepad.com/technology_perspective/2019/06/modifying-forge-sample-and-redeploy.html "
typepad_basename: "modifying-forge-sample-and-redeploy"
typepad_status: "Publish"
---

<p>ご存知のように、<a href="https://forge.autodesk.com" rel="noopener" target="_blank"><strong>Forge ポータル（https://forge.autodesk.com）</strong></a>のフッターにある&#0160;<strong><a href="https://forge.autodesk.com/code-samples" rel="noopener" target="_blank">Code samples</a></strong> リンク経由で、数多くのサンプルが 公開されています。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4b1cfc9200b-pi" style="display: inline;"><img alt="Link_to_samples" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4b1cfc9200b image-full img-responsive" src="/assets/image_987332.jpg" title="Link_to_samples" /></a></p>
<p>各サンプルは GitHub リポジトリとして公開されているので、<strong><a href="https://github.com/joshnh/Git-Commands" rel="noopener" target="_blank">git コマンド</a></strong>でローカル コンピュータにクローンして実行することが出来ます。不定期に開催している Forge Workshop でも、この方法を利用/活用しています。</p>
<p>これらの Forge サンプルは、<strong><a href="https://ja.wikipedia.org/wiki/MIT_License" rel="noopener" target="_blank">MIT ライセンス</a></strong>を採用しているので、そのままの状態でも、また、ローカル環境で修正を加えてからでも、独自のドメインでデプロイして評価することが出来ます。例えば、ご紹介した &#0160;<strong><a data-pjax="#js-repo-pjax-container" href="https://github.com/Autodesk-Forge/learn.forge.viewhubmodels" rel="noopener" target="_blank">learn.forge.viewhubmodels</a>&#0160;</strong>サンプルも、ページ下部で当該サンプルが MIT ライセンスであることを示しています。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4884ac2200d-pi" style="display: inline;"><img alt="Mit_license" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4884ac2200d image-full img-responsive" src="/assets/image_251692.jpg" title="Mit_license" /></a></p>
<p>もし、Forge サンプルをクローンしてデプロイする場合には、いくつか注意すべき点があります。GitHub からサンプルは、クローンされたフォルダ直下の隠しフォルダ .git でオリジナルのリモート リポジトリとの関係を保持しています。ローカルにクローンしたサンプルを改編して、クローン元のリモート リポジトリに反映する必要がないなら、この .git フォルダを削除しても構いません。</p>
<p>逆に、この .git フォルダを削除する事で、<strong><a href="https://adndevblog.typepad.com/technology_perspective/2019/05/push-web-app-to-github-using-github-desktop.html" rel="noopener" target="_blank">Web アプリのデプロイ：GitHub Desktop を使った GitHub へのプッシュ</a></strong> の手順で、ローカル リポジトリの内容を master ブランチとしてご自身のリモート リポジトリへプッシュ後、独自ドメインでデプロイして試すことが可能になります。</p>
<p>ただし、3-legged OAuth で利用する <strong>CallBack URL</strong> の設定に注意が必要です。先にご紹介した <strong><a data-pjax="#js-repo-pjax-container" href="https://github.com/Autodesk-Forge/learn.forge.viewhubmodels" rel="noopener" target="_blank">learn.forge.viewhubmodels</a>&#0160;</strong>サンプルでは、ローカル開発環境でサンプルを実行することを前提に、CallBack URL&#0160;に<strong>&#0160;http://localhost:3000/api/forge/callback/oauth</strong> を設定しています。ところが、このままの値でデプロイしてしまうと、デプロイ先のドメイン名と localhost:3000 が一致しないため、サンプルが正しく動作しない結果になってしまいます。</p>
<p>この場合、デプロイ先の URL を意識して、デプロイ前に CallBack URL を補正しておく必要があります。例えば、最終的なデプロイ先 URL を <a href="https://viewhubmodels-modified0.herokuapp.com/" rel="noopener" target="_blank">&#0160;https://<strong>viewhubmodels-modified0.herokuapp.com</strong>/</a>にする場合には、http://<strong>localhost:3000</strong>/api/forge/callback/oauth<strong> に代わって </strong>https://<strong>viewhubmodels-modified0.herokuapp.com</strong>/api/forge/callback/oauth にしておく必要があります。</p>
<p>もちろん、Forge ポータル上に作成した App 設定も、同じ Callback URL を設定しておく必要があります。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4985821200d-pi" style="display: inline;"><img alt="Create_app" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4985821200d image-full img-responsive" src="/assets/image_306454.jpg" title="Create_app" /></a></p>
<p>なお、<strong><a href="https://adndevblog.typepad.com/technology_perspective/2019/02/sample-which-shows-a360-data-using-3-legged-oauth.html" rel="noopener" target="_blank">3-Legged OAuth で A360 データを表示するサンプル</a></strong> の内容では、環境変数を用いて Client ID と Client Secret、Callback URL を設定していました。もし、これらの値をサーバー実装のコード内に埋め込んでしまいたい場合は、デプロイ前のローカル開発環境で learn.forge.viewhubmodels\<strong>config.js</strong> ファイルの次の青字箇所に書き込んでしまうことも出来ます。</p>
<pre class="code-snippet more-toggle--slide snippet-container js-more-toggle more-toggle" data-toggle-end-color="rgba(250, 250, 250, 1)" data-toggle-height="400" data-toggle-less="Hide Code" data-toggle-more="Show Code"><code class="language-javascript code-overflow-x hljs " id="snippet-3">// Autodesk Forge configuration<br />module.exports = {<br />    // Set environment variables or hard-code here<br />    credentials: {<br />        client_id: <span style="color: #0000ff;"><strong>process.env.FORGE_CLIENT_ID</strong></span>,<br />        client_secret: <strong><span style="color: #0000ff;">process.env.FORGE_CLIENT_SECRET</span></strong>,<br />        callback_url: <span style="color: #0000ff;"><strong>process.env.FORGE_CALLBACK_URL</strong></span><br />    },lmvToLonLat( lmvPoint&#0160;)</code><code class="language-javascript code-overflow-x hljs " id="snippet-3">&#0160;</code></pre>
<p>&#0160; &gt;&gt; 例 &gt;&gt;</p>
<pre class="code-snippet more-toggle--slide snippet-container js-more-toggle more-toggle" data-toggle-end-color="rgba(250, 250, 250, 1)" data-toggle-height="400" data-toggle-less="Hide Code" data-toggle-more="Show Code"><code class="language-javascript code-overflow-x hljs " id="snippet-3">// Autodesk Forge configuration<br />module.exports = {<br />    // Set environment variables or hard-code here<br />    credentials: {<br />        client_id: <strong>&#39;lzzAgNjGyMWT6cm0s6M0ZoqvPLqNsDrG&#39;</strong>,<br />        client_secret: <strong>&#39;LoYe1cJDFjSPjlnP&#39;</strong>,<br />        callback_url: <strong>&#39;https://viewhubmodels-modified0.herokuapp.com/api/forge/callback/oauth&#39;</strong><br />    },lmvToLonLat( lmvPoint&#0160;)</code></pre>
<p>下図は、この方法で編集、デプロイした <strong><a href="https://viewhubmodels-modified0.herokuapp.com/" rel="noopener" target="_blank">https://viewhubmodels-modified0.herokuapp.com/</a></strong>です。</p>
<p><a class="asset-img-link" href="https://adndevblog.typepad.com/.a/6a0167607c2431970b0240a4bcf8b4200b-pi" style="display: inline;"><img alt="Deployed_sample" border="0" class="asset  asset-image at-xid-6a0167607c2431970b0240a4bcf8b4200b image-full img-responsive" src="/assets/image_662880.jpg" title="Deployed_sample" /></a></p>
<p>By Toshiaki Isezaki</p>
